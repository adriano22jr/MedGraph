!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).G6Extension3D={})}(this,(function(t){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function o(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{l(r.next(t))}catch(t){o(t)}}function s(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function u(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function c(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}"function"==typeof SuppressedError&&SuppressedError;var h=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();function d(t,e,n,r){for(;t.length;){const i=t.shift();if(n(i))return!0;e.add(i.id),r(i.id).forEach((n=>{e.has(n.id)||(e.add(n.id),t.push(n))}))}return!1}function f(t,e,n,r){if(n(t))return!0;e.add(t.id);for(const i of r(t.id))if(!e.has(i.id)&&f(i,e,n,r))return!0;return!1}const p=()=>!0;class g{graph;nodeFilter;edgeFilter;cacheEnabled;inEdgesMap=new Map;outEdgesMap=new Map;bothEdgesMap=new Map;allNodesMap=new Map;allEdgesMap=new Map;constructor(t){this.graph=t.graph;const e=t.nodeFilter||p,n=t.edgeFilter||p;this.nodeFilter=e,this.edgeFilter=t=>{const{source:r,target:i}=this.graph.getEdgeDetail(t.id);return!(!e(r)||!e(i))&&n(t,r,i)},"auto"===t.cache?(this.cacheEnabled=!0,this.startAutoCache()):"manual"===t.cache?this.cacheEnabled=!0:this.cacheEnabled=!1}clearCache=()=>{this.inEdgesMap.clear(),this.outEdgesMap.clear(),this.bothEdgesMap.clear(),this.allNodesMap.clear(),this.allEdgesMap.clear()};refreshCache=()=>{this.clearCache(),this.updateCache(this.graph.getAllNodes().map((t=>t.id)))};updateCache=t=>{const e=new Set;t.forEach((t=>{const n=this.bothEdgesMap.get(t);if(n&&n.forEach((t=>e.add(t.id))),this.hasNode(t)){const n=this.graph.getRelatedEdges(t,"in").filter(this.edgeFilter),r=this.graph.getRelatedEdges(t,"out").filter(this.edgeFilter),i=Array.from(new Set([...n,...r]));i.forEach((t=>e.add(t.id))),this.inEdgesMap.set(t,n),this.outEdgesMap.set(t,r),this.bothEdgesMap.set(t,i),this.allNodesMap.set(t,this.graph.getNode(t))}else this.inEdgesMap.delete(t),this.outEdgesMap.delete(t),this.bothEdgesMap.delete(t),this.allNodesMap.delete(t)})),e.forEach((t=>{this.hasEdge(t)?this.allEdgesMap.set(t,this.graph.getEdge(t)):this.allEdgesMap.delete(t)}))};startAutoCache(){this.refreshCache(),this.graph.on("changed",this.handleGraphChanged)}stopAutoCache(){this.graph.off("changed",this.handleGraphChanged)}handleGraphChanged=t=>{const e=new Set;t.changes.forEach((n=>{switch(n.type){case"NodeAdded":case"NodeRemoved":e.add(n.value.id);break;case"NodeDataUpdated":e.add(n.id);break;case"EdgeAdded":case"EdgeRemoved":e.add(n.value.source),e.add(n.value.target);break;case"EdgeUpdated":"source"!==n.propertyName&&"target"!==n.propertyName||(e.add(n.oldValue),e.add(n.newValue));break;case"EdgeDataUpdated":if(t.graph.hasEdge(n.id)){const r=t.graph.getEdge(n.id);e.add(r.source),e.add(r.target)}}})),this.updateCache(e)};checkNodeExistence(t){this.getNode(t)}hasNode(t){if(!this.graph.hasNode(t))return!1;const e=this.graph.getNode(t);return this.nodeFilter(e)}areNeighbors(t,e){return this.checkNodeExistence(t),this.getNeighbors(e).some((e=>e.id===t))}getNode(t){const e=this.graph.getNode(t);if(!this.nodeFilter(e))throw new Error("Node not found for id: "+t);return e}getRelatedEdges(t,e){if(this.checkNodeExistence(t),this.cacheEnabled)return"in"===e?this.inEdgesMap.get(t):"out"===e?this.outEdgesMap.get(t):this.bothEdgesMap.get(t);return this.graph.getRelatedEdges(t,e).filter(this.edgeFilter)}getDegree(t,e){return this.getRelatedEdges(t,e).length}getSuccessors(t){const e=this.getRelatedEdges(t,"out").map((t=>this.getNode(t.target)));return Array.from(new Set(e))}getPredecessors(t){const e=this.getRelatedEdges(t,"in").map((t=>this.getNode(t.source)));return Array.from(new Set(e))}getNeighbors(t){const e=this.getPredecessors(t),n=this.getSuccessors(t);return Array.from(new Set([...e,...n]))}hasEdge(t){if(!this.graph.hasEdge(t))return!1;const e=this.graph.getEdge(t);return this.edgeFilter(e)}getEdge(t){const e=this.graph.getEdge(t);if(!this.edgeFilter(e))throw new Error("Edge not found for id: "+t);return e}getEdgeDetail(t){const e=this.getEdge(t);return{edge:e,source:this.getNode(e.source),target:this.getNode(e.target)}}hasTreeStructure(t){return this.graph.hasTreeStructure(t)}getRoots(t){return this.graph.getRoots(t).filter(this.nodeFilter)}getChildren(t,e){return this.checkNodeExistence(t),this.graph.getChildren(t,e).filter(this.nodeFilter)}getParent(t,e){this.checkNodeExistence(t);const n=this.graph.getParent(t,e);return n&&this.nodeFilter(n)?n:null}getAllNodes(){return this.cacheEnabled?Array.from(this.allNodesMap.values()):this.graph.getAllNodes().filter(this.nodeFilter)}getAllEdges(){return this.cacheEnabled?Array.from(this.allEdgesMap.values()):this.graph.getAllEdges().filter(this.edgeFilter)}bfs(t,e,n="out"){const r={in:this.getPredecessors.bind(this),out:this.getSuccessors.bind(this),both:this.getNeighbors.bind(this)}[n];d([this.getNode(t)],new Set,e,r)}dfs(t,e,n="out"){const r={in:this.getPredecessors.bind(this),out:this.getSuccessors.bind(this),both:this.getNeighbors.bind(this)}[n];f(this.getNode(t),new Set,e,r)}}let v=class t extends h{nodeMap=new Map;edgeMap=new Map;inEdgesMap=new Map;outEdgesMap=new Map;bothEdgesMap=new Map;treeIndices=new Map;changes=[];batchCount=0;onChanged=()=>{};constructor(t){super(),t&&(t.nodes&&this.addNodes(t.nodes),t.edges&&this.addEdges(t.edges),t.tree&&this.addTree(t.tree),t.onChanged&&(this.onChanged=t.onChanged))}batch=t=>{this.batchCount+=1,t(),this.batchCount-=1,this.batchCount||this.commit()};commit(){const t=this.changes;this.changes=[];const e={graph:this,changes:t};this.emit("changed",e),this.onChanged(e)}reduceChanges(t){let e=[];return t.forEach((t=>{switch(t.type){case"NodeRemoved":{let n=!1;e=e.filter((e=>{if("NodeAdded"===e.type){const r=e.value.id===t.value.id;return r&&(n=!0),!r}return"NodeDataUpdated"===e.type?e.id!==t.value.id:"TreeStructureChanged"!==e.type||e.nodeId!==t.value.id})),n||e.push(t);break}case"EdgeRemoved":{let n=!1;e=e.filter((e=>{if("EdgeAdded"===e.type){const r=e.value.id===t.value.id;return r&&(n=!0),!r}return"EdgeDataUpdated"!==e.type&&"EdgeUpdated"!==e.type||e.id!==t.value.id})),n||e.push(t);break}case"NodeDataUpdated":case"EdgeDataUpdated":case"EdgeUpdated":{const n=e.findIndex((e=>e.type===t.type&&e.id===t.id&&(void 0===t.propertyName||e.propertyName===t.propertyName))),r=e[n];r?void 0!==t.propertyName?r.newValue=t.newValue:(e.splice(n,1),e.push(t)):e.push(t);break}case"TreeStructureDetached":e=e.filter((e=>"TreeStructureAttached"===e.type?e.treeKey!==t.treeKey:"TreeStructureChanged"!==e.type||e.treeKey!==t.treeKey)),e.push(t);break;case"TreeStructureChanged":{const n=e.find((e=>"TreeStructureChanged"===e.type&&e.treeKey===t.treeKey&&e.nodeId===t.nodeId));n?n.newParentId=t.newParentId:e.push(t);break}default:e.push(t)}})),e}checkNodeExistence(t){this.getNode(t)}hasNode(t){return this.nodeMap.has(t)}areNeighbors(t,e){return this.getNeighbors(e).some((e=>e.id===t))}getNode(t){const e=this.nodeMap.get(t);if(!e)throw new Error("Node not found for id: "+t);return e}getRelatedEdges(t,e){if(this.checkNodeExistence(t),"in"===e){const e=this.inEdgesMap.get(t);return Array.from(e)}if("out"===e){const e=this.outEdgesMap.get(t);return Array.from(e)}{const e=this.bothEdgesMap.get(t);return Array.from(e)}}getDegree(t,e){return this.getRelatedEdges(t,e).length}getSuccessors(t){const e=this.getRelatedEdges(t,"out").map((t=>this.getNode(t.target)));return Array.from(new Set(e))}getPredecessors(t){const e=this.getRelatedEdges(t,"in").map((t=>this.getNode(t.source)));return Array.from(new Set(e))}getNeighbors(t){const e=this.getPredecessors(t),n=this.getSuccessors(t);return Array.from(new Set([...e,...n]))}doAddNode(t){if(this.hasNode(t.id))throw new Error("Node already exists: "+t.id);this.nodeMap.set(t.id,t),this.inEdgesMap.set(t.id,new Set),this.outEdgesMap.set(t.id,new Set),this.bothEdgesMap.set(t.id,new Set),this.treeIndices.forEach((e=>{e.childrenMap.set(t.id,new Set)})),this.changes.push({type:"NodeAdded",value:t})}addNodes(t){this.batch((()=>{for(const e of t)this.doAddNode(e)}))}addNode(t){this.addNodes([t])}doRemoveNode(t){const e=this.getNode(t),n=this.bothEdgesMap.get(t);n?.forEach((t=>this.doRemoveEdge(t.id))),this.nodeMap.delete(t),this.treeIndices.forEach((e=>{e.childrenMap.get(t)?.forEach((t=>{e.parentMap.delete(t.id)})),e.parentMap.delete(t),e.childrenMap.delete(t)})),this.changes.push({type:"NodeRemoved",value:e})}removeNodes(t){this.batch((()=>{t.forEach((t=>this.doRemoveNode(t)))}))}removeNode(t){this.removeNodes([t])}updateNodeDataProperty(t,e,n){const r=this.getNode(t);this.batch((()=>{const i=r.data[e],o=n;r.data[e]=o,this.changes.push({type:"NodeDataUpdated",id:t,propertyName:e,oldValue:i,newValue:o})}))}mergeNodeData(t,e){this.batch((()=>{Object.entries(e).forEach((([e,n])=>{this.updateNodeDataProperty(t,e,n)}))}))}updateNodeData(...t){const e=t[0],n=this.getNode(e);if("string"==typeof t[1])return void this.updateNodeDataProperty(e,t[1],t[2]);let r;if("function"==typeof t[1]){const e=t[1];r=e(n.data)}else"object"==typeof t[1]&&(r=t[1]);this.batch((()=>{const t=n.data,i=r;n.data=r,this.changes.push({type:"NodeDataUpdated",id:e,oldValue:t,newValue:i})}))}checkEdgeExistence(t){if(!this.hasEdge(t))throw new Error("Edge not found for id: "+t)}hasEdge(t){return this.edgeMap.has(t)}getEdge(t){return this.checkEdgeExistence(t),this.edgeMap.get(t)}getEdgeDetail(t){const e=this.getEdge(t);return{edge:e,source:this.getNode(e.source),target:this.getNode(e.target)}}doAddEdge(t){if(this.hasEdge(t.id))throw new Error("Edge already exists: "+t.id);this.checkNodeExistence(t.source),this.checkNodeExistence(t.target),this.edgeMap.set(t.id,t);const e=this.inEdgesMap.get(t.target),n=this.outEdgesMap.get(t.source),r=this.bothEdgesMap.get(t.source),i=this.bothEdgesMap.get(t.target);e.add(t),n.add(t),r.add(t),i.add(t),this.changes.push({type:"EdgeAdded",value:t})}addEdges(t){this.batch((()=>{for(const e of t)this.doAddEdge(e)}))}addEdge(t){this.addEdges([t])}doRemoveEdge(t){const e=this.getEdge(t),n=this.outEdgesMap.get(e.source),r=this.inEdgesMap.get(e.target),i=this.bothEdgesMap.get(e.source),o=this.bothEdgesMap.get(e.target);n.delete(e),r.delete(e),i.delete(e),o.delete(e),this.edgeMap.delete(t),this.changes.push({type:"EdgeRemoved",value:e})}removeEdges(t){this.batch((()=>{t.forEach((t=>this.doRemoveEdge(t)))}))}removeEdge(t){this.removeEdges([t])}updateEdgeSource(t,e){const n=this.getEdge(t);this.checkNodeExistence(e);const r=n.source,i=e;this.outEdgesMap.get(r).delete(n),this.bothEdgesMap.get(r).delete(n),this.outEdgesMap.get(i).add(n),this.bothEdgesMap.get(i).add(n),n.source=e,this.batch((()=>{this.changes.push({type:"EdgeUpdated",id:t,propertyName:"source",oldValue:r,newValue:i})}))}updateEdgeTarget(t,e){const n=this.getEdge(t);this.checkNodeExistence(e);const r=n.target,i=e;this.inEdgesMap.get(r).delete(n),this.bothEdgesMap.get(r).delete(n),this.inEdgesMap.get(i).add(n),this.bothEdgesMap.get(i).add(n),n.target=e,this.batch((()=>{this.changes.push({type:"EdgeUpdated",id:t,propertyName:"target",oldValue:r,newValue:i})}))}updateEdgeDataProperty(t,e,n){const r=this.getEdge(t);this.batch((()=>{const i=r.data[e],o=n;r.data[e]=o,this.changes.push({type:"EdgeDataUpdated",id:t,propertyName:e,oldValue:i,newValue:o})}))}updateEdgeData(...t){const e=t[0],n=this.getEdge(e);if("string"==typeof t[1])return void this.updateEdgeDataProperty(e,t[1],t[2]);let r;if("function"==typeof t[1]){const e=t[1];r=e(n.data)}else"object"==typeof t[1]&&(r=t[1]);this.batch((()=>{const t=n.data,i=r;n.data=r,this.changes.push({type:"EdgeDataUpdated",id:e,oldValue:t,newValue:i})}))}mergeEdgeData(t,e){this.batch((()=>{Object.entries(e).forEach((([e,n])=>{this.updateEdgeDataProperty(t,e,n)}))}))}checkTreeExistence(t){if(!this.hasTreeStructure(t))throw new Error("Tree structure not found for treeKey: "+t)}hasTreeStructure(t){return this.treeIndices.has(t)}attachTreeStructure(t){this.treeIndices.has(t)||(this.treeIndices.set(t,{parentMap:new Map,childrenMap:new Map}),this.batch((()=>{this.changes.push({type:"TreeStructureAttached",treeKey:t})})))}detachTreeStructure(t){this.checkTreeExistence(t),this.treeIndices.delete(t),this.batch((()=>{this.changes.push({type:"TreeStructureDetached",treeKey:t})}))}addTree(t,e){this.batch((()=>{this.attachTreeStructure(e);const n=[],r=Array.isArray(t)?t:[t];for(;r.length;){const t=r.shift();n.push(t),t.children&&r.push(...t.children)}this.addNodes(n),n.forEach((t=>{t.children?.forEach((n=>{this.setParent(n.id,t.id,e)}))}))}))}getRoots(t){return this.checkTreeExistence(t),this.getAllNodes().filter((e=>!this.getParent(e.id,t)))}getChildren(t,e){this.checkNodeExistence(t),this.checkTreeExistence(e);const n=this.treeIndices.get(e).childrenMap.get(t);return Array.from(n||[])}getParent(t,e){this.checkNodeExistence(t),this.checkTreeExistence(e);return this.treeIndices.get(e).parentMap.get(t)||null}getAncestors(t,e){const n=[];let r,i=this.getNode(t);for(;r=this.getParent(i.id,e);)n.push(r),i=r;return n}setParent(t,e,n){this.checkTreeExistence(n);const r=this.treeIndices.get(n),i=this.getNode(t),o=r.parentMap.get(t);if(o?.id===e)return;if(void 0===e)return o&&r.childrenMap.get(o.id)?.delete(i),void r.parentMap.delete(t);const a=this.getNode(e);r.parentMap.set(t,a),o&&r.childrenMap.get(o.id)?.delete(i);let s=r.childrenMap.get(a.id);s||(s=new Set,r.childrenMap.set(a.id,s)),s.add(i),this.batch((()=>{this.changes.push({type:"TreeStructureChanged",treeKey:n,nodeId:t,oldParentId:o?.id,newParentId:a.id})}))}dfsTree(t,e,n){return f(this.getNode(t),new Set,e,(t=>this.getChildren(t,n)))}bfsTree(t,e,n){return d([this.getNode(t)],new Set,e,(t=>this.getChildren(t,n)))}getAllNodes(){return Array.from(this.nodeMap.values())}getAllEdges(){return Array.from(this.edgeMap.values())}bfs(t,e,n="out"){const r={in:this.getPredecessors.bind(this),out:this.getSuccessors.bind(this),both:this.getNeighbors.bind(this)}[n];return d([this.getNode(t)],new Set,e,r)}dfs(t,e,n="out"){const r={in:this.getPredecessors.bind(this),out:this.getSuccessors.bind(this),both:this.getNeighbors.bind(this)}[n];return f(this.getNode(t),new Set,e,r)}clone(){const e=this.getAllNodes().map((t=>({...t,data:{...t.data}}))),n=this.getAllEdges().map((t=>({...t,data:{...t.data}}))),r=new t({nodes:e,edges:n});return this.treeIndices.forEach((({parentMap:t,childrenMap:e},n)=>{const i=new Map;t.forEach(((t,e)=>{i.set(e,r.getNode(t.id))}));const o=new Map;e.forEach(((t,e)=>{o.set(e,new Set(Array.from(t).map((t=>r.getNode(t.id)))))})),r.treeIndices.set(n,{parentMap:i,childrenMap:o})})),r}toJSON(){return JSON.stringify({nodes:this.getAllNodes(),edges:this.getAllEdges()})}createView(t){return new g({graph:this,...t})}};var m=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},y=function(t,e){return void 0===e&&(e=[]),function(t,e){if(!m(t))return t;for(var n=[],r=0;r<t.length;r++){var i=t[r];e(i,r)&&n.push(i)}return n}(t,(function(t){return!function(t,e){return!!m(t)&&t.indexOf(e)>-1}(e,t)}))},E=function(t){return"function"==typeof t},_=function(t){return null==t},b={}.toString,x=function(t,e){return b.call(t)==="[object "+e+"]"},S=function(t){return Array.isArray?Array.isArray(t):x(t,"Array")},M=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};function A(t,e){if(t)if(S(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(M(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break}var R=function(t){return"object"==typeof t&&null!==t},T=function(t){if(!R(t)||!x(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},w=function(t){if(S(t))return t.reduce((function(t,e){return Math.max(t,e)}),t[0])},P=function(t){if(S(t))return t.reduce((function(t,e){return Math.min(t,e)}),t[0])},N=function(t){return x(t,"String")},C=Object.prototype.hasOwnProperty;var O=function(t,e,n){return t<e?e:t>n?n:t},I=function(t){return x(t,"Number")},L=1e-5;function D(t,e,n){return void 0===n&&(n=L),Math.abs(t-e)<n}var B=function(t,e){if(S(t)){for(var n,r=-1/0,i=0;i<t.length;i++){var o=t[i],a=E(e)?e(o):o[e];a>r&&(n=o,r=a)}return n}},k=function(t,e){if(S(t)){for(var n,r=1/0,i=0;i<t.length;i++){var o=t[i],a=E(e)?e(o):o[e];a<r&&(n=o,r=a)}return n}},F=function(t,e){return(t%e+e)%e},U=function(t){return _(t)?"":t.toString()},G=function(t){var e=U(t);return e.charAt(0).toLowerCase()+e.substring(1)};var z=function(t){var e=U(t);return e.charAt(0).toUpperCase()+e.substring(1)},V={}.toString,W=function(t){return x(t,"Boolean")},j=Object.prototype,H=function(t){return void 0===t},X=function(t){if("object"!=typeof t||null===t)return t;var e;if(S(t)){e=[];for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=X(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=X(t[i]):e[i]=t[i];return e};function Y(t,e){if(Object.hasOwn)return Object.hasOwn(t,e);if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}function K(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(Y(e,i)){var o=e[i];null!==o&&T(o)?(T(t[i])||(t[i]={}),n<r?K(t[i],o,n+1,r):t[i]=e[i]):S(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}var $=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)K(t,e[r]);return t},q=Object.prototype.hasOwnProperty;function Z(t){if(_(t))return!0;if(m(t))return!t.length;var e=function(t){return V.call(t).replace(/^\[object /,"").replace(/]$/,"")}(t);if("Map"===e||"Set"===e)return!t.size;if(function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||j)}(t))return!Object.keys(t).length;for(var n in t)if(q.call(t,n))return!1;return!0}var Q=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(N(t)||N(e))return!1;if(m(t)||m(e)){if(t.length!==e.length)return!1;for(var n=!0,r=0;r<t.length&&(n=Q(t[r],e[r]));r++);return n}if(R(t)||R(e)){var i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(n=!0,r=0;r<i.length&&(n=Q(t[i[r]],e[i[r]]));r++);return n}return!1},J=function(t,e,n){for(var r=0,i=N(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t},tt=function(t,e,n){var r=t,i=N(e)?e.split("."):e;return i.forEach((function(t,e){e<i.length-1?(M(r[t])||(r[t]=I(i[e+1])?[]:{}),r=r[t]):r[t]=n})),t},et=Object.prototype.hasOwnProperty,nt=function(t,e){if(null===t||!T(t))return{};var n={};return A(e,(function(e){et.call(t,e)&&(n[e]=t[e])})),n},rt=function(t,e){return function(t,e,n){if(!S(t)&&!T(t))return t;var r=n;return A(t,(function(t,n){r=e(r,t,n)})),r}(t,(function(t,n,r){return e.includes(r)||(t[r]=n),t}),{})},it={},ot=function(){},at=function(t){return t},st=1e-6,lt="undefined"!=typeof Float32Array?Float32Array:Array;function ut(){var t=new lt(9);return lt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ct(){var t=new lt(16);return lt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ht(t){var e=new lt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function dt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ft(t,e,n,r,i,o,a,s,l,u,c,h,d,f,p,g){var v=new lt(16);return v[0]=t,v[1]=e,v[2]=n,v[3]=r,v[4]=i,v[5]=o,v[6]=a,v[7]=s,v[8]=l,v[9]=u,v[10]=c,v[11]=h,v[12]=d,v[13]=f,v[14]=p,v[15]=g,v}function pt(t,e,n,r,i,o,a,s,l,u,c,h,d,f,p,g,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=d,t[12]=f,t[13]=p,t[14]=g,t[15]=v,t}function gt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vt(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],v=e[14],m=e[15],y=n*s-r*a,E=n*l-i*a,_=n*u-o*a,b=r*l-i*s,x=r*u-o*s,S=i*u-o*l,M=c*g-h*p,A=c*v-d*p,R=c*m-f*p,T=h*v-d*g,w=h*m-f*g,P=d*m-f*v,N=y*P-E*w+_*T+b*R-x*A+S*M;return N?(N=1/N,t[0]=(s*P-l*w+u*T)*N,t[1]=(i*w-r*P-o*T)*N,t[2]=(g*S-v*x+m*b)*N,t[3]=(d*x-h*S-f*b)*N,t[4]=(l*R-a*P-u*A)*N,t[5]=(n*P-i*R+o*A)*N,t[6]=(v*_-p*S-m*E)*N,t[7]=(c*S-d*_+f*E)*N,t[8]=(a*w-s*R+u*M)*N,t[9]=(r*R-n*w-o*M)*N,t[10]=(p*x-g*_+m*y)*N,t[11]=(h*_-c*x-f*y)*N,t[12]=(s*A-a*T-l*M)*N,t[13]=(n*T-r*A+i*M)*N,t[14]=(g*E-p*b-v*y)*N,t[15]=(c*b-h*E+d*y)*N,t):null}function yt(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],f=t[12],p=t[13],g=t[14],v=t[15];return(e*a-n*o)*(h*v-d*g)-(e*s-r*o)*(c*v-d*p)+(e*l-i*o)*(c*g-h*p)+(n*s-r*a)*(u*v-d*f)-(n*l-i*a)*(u*g-h*f)+(r*l-i*s)*(u*p-c*f)}function Et(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],v=e[13],m=e[14],y=e[15],E=n[0],_=n[1],b=n[2],x=n[3];return t[0]=E*r+_*s+b*h+x*g,t[1]=E*i+_*l+b*d+x*v,t[2]=E*o+_*u+b*f+x*m,t[3]=E*a+_*c+b*p+x*y,E=n[4],_=n[5],b=n[6],x=n[7],t[4]=E*r+_*s+b*h+x*g,t[5]=E*i+_*l+b*d+x*v,t[6]=E*o+_*u+b*f+x*m,t[7]=E*a+_*c+b*p+x*y,E=n[8],_=n[9],b=n[10],x=n[11],t[8]=E*r+_*s+b*h+x*g,t[9]=E*i+_*l+b*d+x*v,t[10]=E*o+_*u+b*f+x*m,t[11]=E*a+_*c+b*p+x*y,E=n[12],_=n[13],b=n[14],x=n[15],t[12]=E*r+_*s+b*h+x*g,t[13]=E*i+_*l+b*d+x*v,t[14]=E*o+_*u+b*f+x*m,t[15]=E*a+_*c+b*p+x*y,t}function _t(t,e,n){var r,i,o,a,s,l,u,c,h,d,f,p,g=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*g+e[4]*v+e[8]*m+e[12],t[13]=e[1]*g+e[5]*v+e[9]*m+e[13],t[14]=e[2]*g+e[6]*v+e[10]*m+e[14],t[15]=e[3]*g+e[7]*v+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=r*g+s*v+h*m+e[12],t[13]=i*g+l*v+d*m+e[13],t[14]=o*g+u*v+f*m+e[14],t[15]=a*g+c*v+p*m+e[15]),t}function bt(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function xt(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=l*i+d*r,t[8]=u*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=d*i-l*r,t}function St(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=l*i-d*r,t[8]=o*r+u*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=l*r+d*i,t}function Mt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function At(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rt(t,e,n){var r,i,o,a=n[0],s=n[1],l=n[2],u=Math.hypot(a,s,l);return u<st?null:(a*=u=1/u,s*=u,l*=u,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+l*r,t[2]=l*a*o-s*r,t[3]=0,t[4]=a*s*o-l*r,t[5]=s*s*o+i,t[6]=l*s*o+a*r,t[7]=0,t[8]=a*l*o+s*r,t[9]=s*l*o-a*r,t[10]=l*l*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Tt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Nt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,l=i+i,u=o+o,c=r*s,h=r*l,d=r*u,f=i*l,p=i*u,g=o*u,v=a*s,m=a*l,y=a*u;return t[0]=1-(f+g),t[1]=h+y,t[2]=d-m,t[3]=0,t[4]=h-y,t[5]=1-(c+g),t[6]=p+v,t[7]=0,t[8]=d+m,t[9]=p-v,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ct(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ot(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],l=e[8],u=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(l,u,c),t}function It(t,e){var n=new lt(3);Ot(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,l=e[2]*o,u=e[4]*r,c=e[5]*i,h=e[6]*o,d=e[8]*r,f=e[9]*i,p=e[10]*o,g=a+c+p,v=0;return g>0?(v=2*Math.sqrt(g+1),t[3]=.25*v,t[0]=(h-f)/v,t[1]=(d-l)/v,t[2]=(s-u)/v):a>c&&a>p?(v=2*Math.sqrt(1+a-c-p),t[3]=(h-f)/v,t[0]=.25*v,t[1]=(s+u)/v,t[2]=(d+l)/v):c>p?(v=2*Math.sqrt(1+c-a-p),t[3]=(d-l)/v,t[0]=(s+u)/v,t[1]=.25*v,t[2]=(h+f)/v):(v=2*Math.sqrt(1+p-a-c),t[3]=(s-u)/v,t[0]=(d+l)/v,t[1]=(h+f)/v,t[2]=.25*v),t}function Lt(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],l=e[3],u=o+o,c=a+a,h=s+s,d=o*u,f=o*c,p=o*h,g=a*c,v=a*h,m=s*h,y=l*u,E=l*c,_=l*h,b=r[0],x=r[1],S=r[2],M=i[0],A=i[1],R=i[2],T=(1-(g+m))*b,w=(f+_)*b,P=(p-E)*b,N=(f-_)*x,C=(1-(d+m))*x,O=(v+y)*x,I=(p+E)*S,L=(v-y)*S,D=(1-(d+g))*S;return t[0]=T,t[1]=w,t[2]=P,t[3]=0,t[4]=N,t[5]=C,t[6]=O,t[7]=0,t[8]=I,t[9]=L,t[10]=D,t[11]=0,t[12]=n[0]+M-(T*M+N*A+I*R),t[13]=n[1]+A-(w*M+C*A+L*R),t[14]=n[2]+R-(P*M+O*A+D*R),t[15]=1,t}function Dt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,l=i+i,u=n*a,c=r*a,h=r*s,d=i*a,f=i*s,p=i*l,g=o*a,v=o*s,m=o*l;return t[0]=1-h-p,t[1]=c+m,t[2]=d-v,t[3]=0,t[4]=c-m,t[5]=1-u-p,t[6]=f+g,t[7]=0,t[8]=d+v,t[9]=f-g,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bt(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var kt=Bt;function Ft(t,e,n,r,i,o,a){var s=1/(e-n),l=1/(r-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=(a+o)*u,t[15]=1,t}var Ut=Ft;function Gt(t,e,n,r,i,o,a){var s=1/(e-n),l=1/(r-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=o*u,t[15]=1,t}function zt(t,e,n,r){var i,o,a,s,l,u,c,h,d,f,p=e[0],g=e[1],v=e[2],m=r[0],y=r[1],E=r[2],_=n[0],b=n[1],x=n[2];return Math.abs(p-_)<st&&Math.abs(g-b)<st&&Math.abs(v-x)<st?gt(t):(c=p-_,h=g-b,d=v-x,i=y*(d*=f=1/Math.hypot(c,h,d))-E*(h*=f),o=E*(c*=f)-m*d,a=m*h-y*c,(f=Math.hypot(i,o,a))?(i*=f=1/f,o*=f,a*=f):(i=0,o=0,a=0),s=h*a-d*o,l=d*i-c*a,u=c*o-h*i,(f=Math.hypot(s,l,u))?(s*=f=1/f,l*=f,u*=f):(s=0,l=0,u=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(i*p+o*g+a*v),t[13]=-(s*p+l*g+u*v),t[14]=-(c*p+h*g+d*v),t[15]=1,t)}function Vt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}var Wt=Et,jt=Vt,Ht=Object.freeze({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],v=e[14],m=e[15];return t[0]=s*(d*m-f*v)-h*(l*m-u*v)+g*(l*f-u*d),t[1]=-(r*(d*m-f*v)-h*(i*m-o*v)+g*(i*f-o*d)),t[2]=r*(l*m-u*v)-s*(i*m-o*v)+g*(i*u-o*l),t[3]=-(r*(l*f-u*d)-s*(i*f-o*d)+h*(i*u-o*l)),t[4]=-(a*(d*m-f*v)-c*(l*m-u*v)+p*(l*f-u*d)),t[5]=n*(d*m-f*v)-c*(i*m-o*v)+p*(i*f-o*d),t[6]=-(n*(l*m-u*v)-a*(i*m-o*v)+p*(i*u-o*l)),t[7]=n*(l*f-u*d)-a*(i*f-o*d)+c*(i*u-o*l),t[8]=a*(h*m-f*g)-c*(s*m-u*g)+p*(s*f-u*h),t[9]=-(n*(h*m-f*g)-c*(r*m-o*g)+p*(r*f-o*h)),t[10]=n*(s*m-u*g)-a*(r*m-o*g)+p*(r*u-o*s),t[11]=-(n*(s*f-u*h)-a*(r*f-o*h)+c*(r*u-o*s)),t[12]=-(a*(h*v-d*g)-c*(s*v-l*g)+p*(s*d-l*h)),t[13]=n*(h*v-d*g)-c*(r*v-i*g)+p*(r*d-i*h),t[14]=-(n*(s*v-l*g)-a*(r*v-i*g)+p*(r*l-i*s)),t[15]=n*(s*d-l*h)-a*(r*d-i*h)+c*(r*l-i*s),t},clone:ht,copy:dt,create:ct,determinant:yt,equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],v=t[14],m=t[15],y=e[0],E=e[1],_=e[2],b=e[3],x=e[4],S=e[5],M=e[6],A=e[7],R=e[8],T=e[9],w=e[10],P=e[11],N=e[12],C=e[13],O=e[14],I=e[15];return Math.abs(n-y)<=st*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-E)<=st*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(i-_)<=st*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-b)<=st*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-x)<=st*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-S)<=st*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(l-M)<=st*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(u-A)<=st*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-R)<=st*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-T)<=st*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(d-w)<=st*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-P)<=st*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(p-N)<=st*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-C)<=st*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(v-O)<=st*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(m-I)<=st*Math.max(1,Math.abs(m),Math.abs(I))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},fromQuat:Dt,fromQuat2:function(t,e){var n=new lt(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+c*r+l*o-u*i)/h,n[1]=2*(l*a+c*i+u*r-s*o)/h,n[2]=2*(u*a+c*o+s*i-l*r)/h):(n[0]=2*(s*a+c*r+l*o-u*i),n[1]=2*(l*a+c*i+u*r-s*o),n[2]=2*(u*a+c*o+s*i-l*r)),Nt(t,e,n),t},fromRotation:Rt,fromRotationTranslation:Nt,fromRotationTranslationScale:function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],l=i+i,u=o+o,c=a+a,h=i*l,d=i*u,f=i*c,p=o*u,g=o*c,v=a*c,m=s*l,y=s*u,E=s*c,_=r[0],b=r[1],x=r[2];return t[0]=(1-(p+v))*_,t[1]=(d+E)*_,t[2]=(f-y)*_,t[3]=0,t[4]=(d-E)*b,t[5]=(1-(h+v))*b,t[6]=(g+m)*b,t[7]=0,t[8]=(f+y)*x,t[9]=(g-m)*x,t[10]=(1-(h+p))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromRotationTranslationScaleOrigin:Lt,fromScaling:At,fromTranslation:Mt,fromValues:ft,fromXRotation:Tt,fromYRotation:wt,fromZRotation:Pt,frustum:function(t,e,n,r,i,o,a){var s=1/(n-e),l=1/(i-r),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*l,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*u,t[15]=0,t},getRotation:It,getScaling:Ot,getTranslation:Ct,identity:gt,invert:mt,lookAt:zt,mul:Wt,multiply:Et,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},ortho:Ut,orthoNO:Ft,orthoZO:Gt,perspective:kt,perspectiveFromFieldOfView:function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+s),u=2/(i+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-s)*l*.5,t[9]=(i-o)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},perspectiveNO:Bt,perspectiveZO:function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t},rotate:function(t,e,n,r){var i,o,a,s,l,u,c,h,d,f,p,g,v,m,y,E,_,b,x,S,M,A,R,T,w=r[0],P=r[1],N=r[2],C=Math.hypot(w,P,N);return C<st?null:(w*=C=1/C,P*=C,N*=C,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],l=e[1],u=e[2],c=e[3],h=e[4],d=e[5],f=e[6],p=e[7],g=e[8],v=e[9],m=e[10],y=e[11],E=w*w*a+o,_=P*w*a+N*i,b=N*w*a-P*i,x=w*P*a-N*i,S=P*P*a+o,M=N*P*a+w*i,A=w*N*a+P*i,R=P*N*a-w*i,T=N*N*a+o,t[0]=s*E+h*_+g*b,t[1]=l*E+d*_+v*b,t[2]=u*E+f*_+m*b,t[3]=c*E+p*_+y*b,t[4]=s*x+h*S+g*M,t[5]=l*x+d*S+v*M,t[6]=u*x+f*S+m*M,t[7]=c*x+p*S+y*M,t[8]=s*A+h*R+g*T,t[9]=l*A+d*R+v*T,t[10]=u*A+f*R+m*T,t[11]=c*A+p*R+y*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:xt,rotateY:St,rotateZ:function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=l*i+d*r,t[4]=u*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=d*i-l*r,t},scale:bt,set:pt,str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},sub:jt,subtract:Vt,targetTo:function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],l=r[1],u=r[2],c=i-n[0],h=o-n[1],d=a-n[2],f=c*c+h*h+d*d;f>0&&(c*=f=1/Math.sqrt(f),h*=f,d*=f);var p=l*d-u*h,g=u*c-s*d,v=s*h-l*c;return(f=p*p+g*g+v*v)>0&&(p*=f=1/Math.sqrt(f),g*=f,v*=f),t[0]=p,t[1]=g,t[2]=v,t[3]=0,t[4]=h*v-d*g,t[5]=d*p-c*v,t[6]=c*g-h*p,t[7]=0,t[8]=c,t[9]=h,t[10]=d,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t},translate:_t,transpose:vt});function Xt(){var t=new lt(3);return lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Yt(t){var e=new lt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Kt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function $t(t,e,n){var r=new lt(3);return r[0]=t,r[1]=e,r[2]=n,r}function qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Zt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Qt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Jt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function te(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ee(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ne(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function re(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],l=n[2];return t[0]=i*l-o*s,t[1]=o*a-r*l,t[2]=r*s-i*a,t}function ie(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function oe(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function ae(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=st*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=st*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=st*Math.max(1,Math.abs(i),Math.abs(s))}var se=Jt,le=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)},ue=Kt;function ce(){var t=new lt(4);return lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function he(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function de(){var t=new lt(4);return lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function fe(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function pe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],l=n[1],u=n[2],c=n[3];return t[0]=r*c+a*s+i*u-o*l,t[1]=i*c+a*l+o*s-r*u,t[2]=o*c+a*u+r*l-i*s,t[3]=a*c-r*s-i*l-o*u,t}function ge(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function ve(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),l=Math.cos(n),u=Math.sin(r),c=Math.cos(r);return t[0]=o*l*c-a*s*u,t[1]=a*s*c+o*l*u,t[2]=a*l*u-o*s*c,t[3]=a*l*c+o*s*u,t}Xt(),function(){var t=ce()}();var me=function(t,e,n,r){var i=new lt(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i},ye=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ee=pe,_e=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t};Xt(),$t(1,0,0),$t(0,1,0),de(),de(),ut(),function(){var t,e=(t=new lt(2),lt!=Float32Array&&(t[0]=0,t[1]=0),t)}();var be={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null};function xe(t,e,n){if(t[n].length>7){t[n].shift();for(var r=t[n],i=n;r.length;)e[n]="A",t.splice(i+=1,0,["C"].concat(r.splice(0,6)));t.splice(n,1)}}var Se={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function Me(t){return Array.isArray(t)&&t.every((function(t){var e=t[0].toLowerCase();return Se[e]===t.length-1&&"achlmqstvz".includes(e)}))}function Ae(t){return Me(t)&&t.every((function(t){var e=t[0];return e===e.toUpperCase()}))}function Re(t){return Ae(t)&&t.every((function(t){var e=t[0];return"ACLMQZ".includes(e)}))}function Te(t){for(var e=t.pathValue[t.segmentStart],n=e.toLowerCase(),r=t.data;r.length>=Se[n]&&("m"===n&&r.length>2?(t.segments.push([e].concat(r.splice(0,2))),n="l",e="m"===e?"l":"L"):t.segments.push([e].concat(r.splice(0,Se[n]))),Se[n]););}function we(t){var e=t.index,n=t.pathValue,r=n.charCodeAt(e);return 48===r?(t.param=0,void(t.index+=1)):49===r?(t.param=1,void(t.index+=1)):void(t.err='[path-util]: invalid Arc flag "'+n[e]+'", expecting 0 or 1 at index '+e)}function Pe(t){return t>=48&&t<=57||43===t||45===t||46===t}function Ne(t){return t>=48&&t<=57}function Ce(t){var e,n=t.max,r=t.pathValue,i=t.index,o=i,a=!1,s=!1,l=!1,u=!1;if(o>=n)t.err="[path-util]: Invalid path value at index "+o+', "pathValue" is missing param';else if(43!==(e=r.charCodeAt(o))&&45!==e||(o+=1,e=r.charCodeAt(o)),Ne(e)||46===e){if(46!==e){if(a=48===e,o+=1,e=r.charCodeAt(o),a&&o<n&&e&&Ne(e))return void(t.err="[path-util]: Invalid path value at index "+i+', "'+r[i]+'" illegal number');for(;o<n&&Ne(r.charCodeAt(o));)o+=1,s=!0;e=r.charCodeAt(o)}if(46===e){for(u=!0,o+=1;Ne(r.charCodeAt(o));)o+=1,l=!0;e=r.charCodeAt(o)}if(101===e||69===e){if(u&&!s&&!l)return void(t.err="[path-util]: Invalid path value at index "+o+', "'+r[o]+'" invalid float exponent');if(o+=1,43!==(e=r.charCodeAt(o))&&45!==e||(o+=1),!(o<n&&Ne(r.charCodeAt(o))))return void(t.err="[path-util]: Invalid path value at index "+o+', "'+r[o]+'" invalid integer exponent');for(;o<n&&Ne(r.charCodeAt(o));)o+=1}t.index=o,t.param=+t.pathValue.slice(i,o)}else t.err="[path-util]: Invalid path value at index "+o+', "'+r[o]+'" is not a number'}function Oe(t){for(var e,n=t.pathValue,r=t.max;t.index<r&&(10===(e=n.charCodeAt(t.index))||13===e||8232===e||8233===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(e));)t.index+=1}function Ie(t){var e=t.max,n=t.pathValue,r=t.index,i=n.charCodeAt(r),o=Se[n[r].toLowerCase()];if(t.segmentStart=r,function(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:return!0;default:return!1}}(i))if(t.index+=1,Oe(t),t.data=[],o){for(;;){for(var a=o;a>0;a-=1){if(97!=(32|i)||3!==a&&4!==a?Ce(t):we(t),t.err.length)return;t.data.push(t.param),Oe(t),t.index<e&&44===n.charCodeAt(t.index)&&(t.index+=1,Oe(t))}if(t.index>=t.max)break;if(!Pe(n.charCodeAt(t.index)))break}Te(t)}else Te(t);else t.err='[path-util]: Invalid path value "'+n[r]+'" is not a path command'}var Le=function(t){this.pathValue=t,this.segments=[],this.max=t.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err=""};function De(t){if(Ae(t))return[].concat(t);var e=function(t){if(Me(t))return[].concat(t);var e=new Le(t);for(Oe(e);e.index<e.max&&!e.err.length;)Ie(e);return e.err?e.err:e.segments}(t),n=0,r=0,i=0,o=0;return e.map((function(t){var e,a=t.slice(1).map(Number),s=t[0],l=s.toUpperCase();if("M"===s)return n=a[0],r=a[1],i=n,o=r,["M",n,r];if(s!==l)switch(l){case"A":e=[l,a[0],a[1],a[2],a[3],a[4],a[5]+n,a[6]+r];break;case"V":e=[l,a[0]+r];break;case"H":e=[l,a[0]+n];break;default:var u=a.map((function(t,e){return t+(e%2?r:n)}));e=[l].concat(u)}else e=[l].concat(a);var c=e.length;switch(l){case"Z":n=i,r=o;break;case"H":n=e[1];break;case"V":r=e[1];break;default:n=e[c-2],r=e[c-1],"M"===l&&(i=n,o=r)}return e}))}function Be(t,e){var n=t[0],r=e.x1,i=e.y1,o=e.x2,a=e.y2,s=t.slice(1).map(Number),l=t;if("TQ".includes(n)||(e.qx=null,e.qy=null),"H"===n)l=["L",t[1],i];else if("V"===n)l=["L",r,t[1]];else if("S"===n){var u=2*r-o,c=2*i-a;e.x1=u,e.y1=c,l=["C",u,c].concat(s)}else if("T"===n){var h=2*r-e.qx,d=2*i-e.qy;e.qx=h,e.qy=d,l=["Q",h,d].concat(s)}else if("Q"===n){var f=s[0],p=s[1];e.qx=f,e.qy=p}return l}function ke(t){if(Re(t))return[].concat(t);for(var e=De(t),n=r({},be),i=0;i<e.length;i+=1){e[i]=Be(e[i],n);var o=e[i],a=o.length;n.x1=+o[a-2],n.y1=+o[a-1],n.x2=+o[a-4]||n.x1,n.y2=+o[a-3]||n.y1}return e}function Fe(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}function Ue(t,e,n,r,i,o,a,s,l,u){var c,h,d,f,p,g=t,v=e,m=n,y=r,E=s,_=l,b=120*Math.PI/180,x=Math.PI/180*(+i||0),S=[];if(u)h=u[0],d=u[1],f=u[2],p=u[3];else{g=(c=Fe(g,v,-x)).x,v=c.y;var M=(g-(E=(c=Fe(E,_,-x)).x))/2,A=(v-(_=c.y))/2,R=M*M/(m*m)+A*A/(y*y);R>1&&(m*=R=Math.sqrt(R),y*=R);var T=m*m,w=y*y,P=(o===a?-1:1)*Math.sqrt(Math.abs((T*w-T*A*A-w*M*M)/(T*A*A+w*M*M)));f=P*m*A/y+(g+E)/2,p=P*-y*M/m+(v+_)/2,h=Math.asin(((v-p)/y*Math.pow(10,9)|0)/Math.pow(10,9)),d=Math.asin(((_-p)/y*Math.pow(10,9)|0)/Math.pow(10,9)),h=g<f?Math.PI-h:h,d=E<f?Math.PI-d:d,h<0&&(h=2*Math.PI+h),d<0&&(d=2*Math.PI+d),a&&h>d&&(h-=2*Math.PI),!a&&d>h&&(d-=2*Math.PI)}var N=d-h;if(Math.abs(N)>b){var C=d,O=E,I=_;d=h+b*(a&&d>h?1:-1),S=Ue(E=f+m*Math.cos(d),_=p+y*Math.sin(d),m,y,i,0,a,O,I,[d,C,f,p])}N=d-h;var L=Math.cos(h),D=Math.sin(h),B=Math.cos(d),k=Math.sin(d),F=Math.tan(N/4),U=4/3*m*F,G=4/3*y*F,z=[g,v],V=[g+U*D,v-G*L],W=[E+U*k,_-G*B],j=[E,_];if(V[0]=2*z[0]-V[0],V[1]=2*z[1]-V[1],u)return V.concat(W,j,S);for(var H=[],X=0,Y=(S=V.concat(W,j,S)).length;X<Y;X+=1)H[X]=X%2?Fe(S[X-1],S[X],x).y:Fe(S[X],S[X+1],x).x;return H}function Ge(t,e,n){var r=t[0],i=t[1];return[r+(e[0]-r)*n,i+(e[1]-i)*n]}var ze=function(t,e,n,r){return u(u([],Ge([t,e],[n,r],.5),!0),[n,r,n,r],!1)};function Ve(t,e){var n,r,i,o,a,s,l,u,c,h=t[0],d=t.slice(1).map(Number),f=d[0],p=d[1],g=e.x1,v=e.y1,m=e.x,y=e.y;switch("TQ".includes(h)||(e.qx=null,e.qy=null),h){case"M":return e.x=f,e.y=p,t;case"A":return n=[g,v].concat(d),["C"].concat(Ue(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9]));case"Q":return e.qx=f,e.qy=p,n=[g,v].concat(d),["C"].concat((r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],[(u=1/3)*r+(c=2/3)*o,u*i+c*a,u*s+c*o,u*l+c*a,s,l]));case"L":return["C"].concat(ze(g,v,f,p));case"Z":return g===m&&v===y?["C",g,v,m,y,m,y]:["C"].concat(ze(g,v,m,y))}return t}function We(t,e){if(void 0===e&&(e=!1),function(t){return Re(t)&&t.every((function(t){var e=t[0];return"MC".includes(e)}))}(t)){var n=[].concat(t);return e?[n,[]]:n}for(var i,o,a=ke(t),s=r({},be),l=[],u="",c=a.length,h=[],d=0;d<c;d+=1){a[d]&&(u=a[d][0]),l[d]=u;var f=Ve(a[d],s);a[d]=f,xe(a,l,d),c=a.length,"Z"===u&&h.push(d),o=(i=a[d]).length,s.x1=+i[o-2],s.y1=+i[o-1],s.x2=+i[o-4]||s.x1,s.y2=+i[o-3]||s.y1}return e?[a,h]:a}function je(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}function He(t,e,n,r,i){var o=je([t,e],[n,r]),a={x:0,y:0};if("number"==typeof i)if(i<=0)a={x:t,y:e};else if(i>=o)a={x:n,y:r};else{var s=Ge([t,e],[n,r],i/o);a={x:s[0],y:s[1]}}return{length:o,point:a,min:{x:Math.min(t,n),y:Math.min(e,r)},max:{x:Math.max(t,n),y:Math.max(e,r)}}}function Xe(t,e){var n=t.x,r=t.y,i=e.x,o=e.y,a=n*i+r*o,s=Math.sqrt((Math.pow(n,2)+Math.pow(r,2))*(Math.pow(i,2)+Math.pow(o,2)));return(n*o-r*i<0?-1:1)*Math.acos(a/s)}function Ye(t,e,n,r,i,o,a,s,l,u){var c=Math.abs,h=Math.sin,d=Math.cos,f=Math.sqrt,p=Math.PI,g=c(n),v=c(r),m=(i%360+360)%360*(p/180);if(t===s&&e===l)return{x:t,y:e};if(0===g||0===v)return He(t,e,s,l,u).point;var y=(t-s)/2,E=(e-l)/2,_={x:d(m)*y+h(m)*E,y:-h(m)*y+d(m)*E},b=Math.pow(_.x,2)/Math.pow(g,2)+Math.pow(_.y,2)/Math.pow(v,2);b>1&&(g*=f(b),v*=f(b));var x=(Math.pow(g,2)*Math.pow(v,2)-Math.pow(g,2)*Math.pow(_.y,2)-Math.pow(v,2)*Math.pow(_.x,2))/(Math.pow(g,2)*Math.pow(_.y,2)+Math.pow(v,2)*Math.pow(_.x,2)),S=(o!==a?1:-1)*f(x=x<0?0:x),M=S*(g*_.y/v),A=S*(-v*_.x/g),R=d(m)*M-h(m)*A+(t+s)/2,T=h(m)*M+d(m)*A+(e+l)/2,w={x:(_.x-M)/g,y:(_.y-A)/v},P=Xe({x:1,y:0},w),N=Xe(w,{x:(-_.x-M)/g,y:(-_.y-A)/v});!a&&N>0?N-=2*p:a&&N<0&&(N+=2*p);var C=P+(N%=2*p)*u,O=g*d(C),I=v*h(C);return{x:d(m)*O-h(m)*I+R,y:h(m)*O+d(m)*I+T}}function Ke(t,e,n,r,i,o,a,s,l,u,c){var h,d=c.bbox,f=void 0===d||d,p=c.length,g=void 0===p||p,v=c.sampleSize,m=void 0===v?30:v,y="number"==typeof u,E=t,_=e,b=0,x=[E,_,b],S=[E,_],M={x:0,y:0},A=[{x:E,y:_}];y&&u<=0&&(M={x:E,y:_});for(var R=0;R<=m;R+=1){if(E=(h=Ye(t,e,n,r,i,o,a,s,l,R/m)).x,_=h.y,f&&A.push({x:E,y:_}),g&&(b+=je(S,[E,_])),S=[E,_],y&&b>=u&&u>x[2]){var T=(b-u)/(b-x[2]);M={x:S[0]*(1-T)+x[0]*T,y:S[1]*(1-T)+x[1]*T}}x=[E,_,b]}return y&&u>=b&&(M={x:s,y:l}),{length:b,point:M,min:{x:Math.min.apply(null,A.map((function(t){return t.x}))),y:Math.min.apply(null,A.map((function(t){return t.y})))},max:{x:Math.max.apply(null,A.map((function(t){return t.x}))),y:Math.max.apply(null,A.map((function(t){return t.y})))}}}function $e(t,e,n,r,i,o,a,s,l){var u=1-l;return{x:Math.pow(u,3)*t+3*Math.pow(u,2)*l*n+3*u*Math.pow(l,2)*i+Math.pow(l,3)*a,y:Math.pow(u,3)*e+3*Math.pow(u,2)*l*r+3*u*Math.pow(l,2)*o+Math.pow(l,3)*s}}function qe(t,e,n,r,i,o,a,s,l,u){var c,h=u.bbox,d=void 0===h||h,f=u.length,p=void 0===f||f,g=u.sampleSize,v=void 0===g?10:g,m="number"==typeof l,y=t,E=e,_=0,b=[y,E,_],x=[y,E],S={x:0,y:0},M=[{x:y,y:E}];m&&l<=0&&(S={x:y,y:E});for(var A=0;A<=v;A+=1){if(y=(c=$e(t,e,n,r,i,o,a,s,A/v)).x,E=c.y,d&&M.push({x:y,y:E}),p&&(_+=je(x,[y,E])),x=[y,E],m&&_>=l&&l>b[2]){var R=(_-l)/(_-b[2]);S={x:x[0]*(1-R)+b[0]*R,y:x[1]*(1-R)+b[1]*R}}b=[y,E,_]}return m&&l>=_&&(S={x:a,y:s}),{length:_,point:S,min:{x:Math.min.apply(null,M.map((function(t){return t.x}))),y:Math.min.apply(null,M.map((function(t){return t.y})))},max:{x:Math.max.apply(null,M.map((function(t){return t.x}))),y:Math.max.apply(null,M.map((function(t){return t.y})))}}}function Ze(t,e,n,r,i,o,a){var s=1-a;return{x:Math.pow(s,2)*t+2*s*a*n+Math.pow(a,2)*i,y:Math.pow(s,2)*e+2*s*a*r+Math.pow(a,2)*o}}function Qe(t,e,n,r,i,o,a,s){var l,u=s.bbox,c=void 0===u||u,h=s.length,d=void 0===h||h,f=s.sampleSize,p=void 0===f?10:f,g="number"==typeof a,v=t,m=e,y=0,E=[v,m,y],_=[v,m],b={x:0,y:0},x=[{x:v,y:m}];g&&a<=0&&(b={x:v,y:m});for(var S=0;S<=p;S+=1){if(v=(l=Ze(t,e,n,r,i,o,S/p)).x,m=l.y,c&&x.push({x:v,y:m}),d&&(y+=je(_,[v,m])),_=[v,m],g&&y>=a&&a>E[2]){var M=(y-a)/(y-E[2]);b={x:_[0]*(1-M)+E[0]*M,y:_[1]*(1-M)+E[1]*M}}E=[v,m,y]}return g&&a>=y&&(b={x:i,y:o}),{length:y,point:b,min:{x:Math.min.apply(null,x.map((function(t){return t.x}))),y:Math.min.apply(null,x.map((function(t){return t.y})))},max:{x:Math.max.apply(null,x.map((function(t){return t.x}))),y:Math.max.apply(null,x.map((function(t){return t.y})))}}}function Je(t,e,n){for(var r,i,o,a,s,l,u,c,h,d=ke(t),f="number"==typeof e,p=[],g=0,v=0,m=0,y=0,E=[],_=[],b=0,x={x:0,y:0},S=x,M=x,A=x,R=0,T=0,w=d.length;T<w;T+=1)p=(u="M"===(c=(h=d[T])[0]))?p:[g,v].concat(h.slice(1)),u?(S=x={x:m=h[1],y:y=h[2]},b=0,f&&e<.001&&(A=x)):"L"===c?(b=(r=He(p[0],p[1],p[2],p[3],(e||0)-R)).length,x=r.min,S=r.max,M=r.point):"A"===c?(b=(i=Ke(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],(e||0)-R,n||{})).length,x=i.min,S=i.max,M=i.point):"C"===c?(b=(o=qe(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],(e||0)-R,n||{})).length,x=o.min,S=o.max,M=o.point):"Q"===c?(b=(a=Qe(p[0],p[1],p[2],p[3],p[4],p[5],(e||0)-R,n||{})).length,x=a.min,S=a.max,M=a.point):"Z"===c&&(b=(s=He((p=[g,v,m,y])[0],p[1],p[2],p[3],(e||0)-R)).length,x=s.min,S=s.max,M=s.point),f&&R<e&&R+b>=e&&(A=M),_.push(S),E.push(x),R+=b,g=(l="Z"!==c?h.slice(-2):[m,y])[0],v=l[1];return f&&e>=R&&(A={x:g,y:v}),{length:R,point:A,min:{x:Math.min.apply(null,E.map((function(t){return t.x}))),y:Math.min.apply(null,E.map((function(t){return t.y})))},max:{x:Math.max.apply(null,_.map((function(t){return t.x}))),y:Math.max.apply(null,_.map((function(t){return t.y})))}}}function tn(t,e){var n=t.length-1,r=[],i=0,o=function(t){var e=t.length,n=e-1;return t.map((function(r,i){return t.map((function(r,o){var a,s=i+o;return 0===o||t[s]&&"M"===t[s][0]?(a=t[s],["M"].concat(a.slice(-2))):(s>=e&&(s-=n),t[s])}))}))}(t);return o.forEach((function(o,a){t.slice(1).forEach((function(r,o){i+=je(t[(a+o)%n].slice(-2),e[o%n].slice(-2))})),r[a]=i,i=0})),o[r.indexOf(Math.min.apply(null,r))]}function en(t){return function(t){var e=0,n=0,r=0;return We(t).map((function(t){var i;if("M"===t[0])return e=t[1],n=t[2],0;var o=t.slice(1),a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],h=o[5];return r=function(t,e,n,r,i,o,a,s){return 3*((s-e)*(n+i)-(a-t)*(r+o)+r*(t-i)-n*(e-o)+s*(i+t/3)-a*(o+e/3))/20}(e,n,a,s,l,u,c,h),i=t.slice(-2),e=i[0],n=i[1],r})).reduce((function(t,e){return t+e}),0)}(t)>=0}function nn(t){return t.map((function(t,e,n){var r=e&&n[e-1].slice(-2).concat(t.slice(1)),i=e?qe(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],{bbox:!1}).length:0;return{s:t,ss:e?i?function(t,e){void 0===e&&(e=.5);var n=t.slice(0,2),r=t.slice(2,4),i=t.slice(4,6),o=t.slice(6,8),a=Ge(n,r,e),s=Ge(r,i,e),l=Ge(i,o,e),u=Ge(a,s,e),c=Ge(s,l,e),h=Ge(u,c,e);return[["C"].concat(a,u,h),["C"].concat(c,l,o)]}(r):[t,t]:[t],l:i}}))}function rn(t,e,n){var r=nn(t),i=nn(e),o=r.length,a=i.length,s=r.filter((function(t){return t.l})).length,l=i.filter((function(t){return t.l})).length,u=r.filter((function(t){return t.l})).reduce((function(t,e){return t+e.l}),0)/s||0,c=i.filter((function(t){return t.l})).reduce((function(t,e){return t+e.l}),0)/l||0,h=n||Math.max(o,a),d=[u,c],f=[h-o,h-a],p=0,g=[r,i].map((function(t,e){return t.l===h?t.map((function(t){return t.s})):t.map((function(t,n){return p=n&&f[e]&&t.l>=d[e],f[e]-=p?1:0,p?t.ss:[t.s]})).flat()}));return g[0].length===g[1].length?g:rn(g[0],g[1],h)}function on(t){var e=document.createElement("div");e.innerHTML=t;var n=e.childNodes[0];return n&&e.contains(n)&&e.removeChild(n),n}const an=(t,e)=>{if("next"!==t&&"prev"!==t)return e},sn=t=>{t.prev.next=t.next,t.next.prev=t.prev,delete t.next,delete t.prev};let ln=class{constructor(){const t={};t.prev=t,t.next=t.prev,this.shortcut=t}dequeue(){const t=this.shortcut,e=t.prev;if(e&&e!==t)return sn(e),e}enqueue(t){const e=this.shortcut;t.prev&&t.next&&sn(t),t.next=e.next,e.next.prev=t,e.next=t,t.prev=e}toString(){const t=[],e=this.shortcut;let n=e.prev;for(;n!==e;)t.push(JSON.stringify(n,an)),n=null==n?void 0:n.prev;return`[${t.join(", ")}]`}},un=class extends ln{};const cn=()=>1,hn=(t,e,n)=>{let r=[];const i=e[e.length-1],o=e[0];let a;for(;t.getAllNodes().length;){for(;a=o.dequeue();)dn(t,e,n,a);for(;a=i.dequeue();)dn(t,e,n,a);if(t.getAllNodes().length)for(let i=e.length-2;i>0;--i)if(a=e[i].dequeue(),a){r=r.concat(dn(t,e,n,a,!0));break}}return r},dn=(t,e,n,r,i)=>{var o,a;const s=[];return t.hasNode(r.v)&&(null===(o=t.getRelatedEdges(r.v,"in"))||void 0===o||o.forEach((r=>{const o=r.data.weight,a=t.getNode(r.source);i&&s.push({v:r.source,w:r.target,in:0,out:0}),void 0===a.data.out&&(a.data.out=0),a.data.out-=o,pn(e,n,Object.assign({v:a.id},a.data))})),null===(a=t.getRelatedEdges(r.v,"out"))||void 0===a||a.forEach((r=>{const i=r.data.weight,o=r.target,a=t.getNode(o);void 0===a.data.in&&(a.data.in=0),a.data.in-=i,pn(e,n,Object.assign({v:a.id},a.data))})),t.removeNode(r.v)),i?s:void 0},fn=(t,e)=>{const n=new v;let r=0,i=0;t.getAllNodes().forEach((t=>{n.addNode({id:t.id,data:{v:t.id,in:0,out:0}})})),t.getAllEdges().forEach((t=>{const o=n.getRelatedEdges(t.source,"out").find((e=>e.target===t.target)),a=(null==e?void 0:e(t))||1;o?n.updateEdgeData(null==o?void 0:o.id,Object.assign(Object.assign({},o.data),{weight:o.data.weight+a})):n.addEdge({id:t.id,source:t.source,target:t.target,data:{weight:a}}),i=Math.max(i,n.getNode(t.source).data.out+=a),r=Math.max(r,n.getNode(t.target).data.in+=a)}));const o=[],a=i+r+3;for(let t=0;t<a;t++)o.push(new un);const s=r+1;return n.getAllNodes().forEach((t=>{pn(o,s,Object.assign({v:t.id},n.getNode(t.id).data))})),{buckets:o,zeroIdx:s,graph:n}},pn=(t,e,n)=>{n.out?n.in?t[n.out-n.in+e].enqueue(n):t[t.length-1].enqueue(n):t[0].enqueue(n)},gn=(t,e)=>{const n="greedy"===e?((t,e)=>{var n;if(t.getAllNodes().length<=1)return[];const r=fn(t,e||cn);return null===(n=hn(r.graph,r.buckets,r.zeroIdx).map((e=>t.getRelatedEdges(e.v,"out").filter((({target:t})=>t===e.w)))))||void 0===n?void 0:n.flat()})(t,(t=>t.data.weight||1)):vn(t);null==n||n.forEach((e=>{const n=e.data;t.removeEdge(e.id),n.forwardName=e.data.name,n.reversed=!0,t.addEdge({id:e.id,source:e.target,target:e.source,data:Object.assign({},n)})}))},vn=t=>{const e=[],n={},r={},i=o=>{r[o]||(r[o]=!0,n[o]=!0,t.getRelatedEdges(o,"out").forEach((t=>{n[t.target]?e.push(t):i(t.target)})),delete n[o])};return t.getAllNodes().forEach((t=>i(t.id))),e},mn=(t,e,n,r)=>{let i;do{i=`${r}${Math.random()}`}while(t.hasNode(i));return n.dummy=e,t.addNode({id:i,data:n}),i},yn=t=>{const e=new v;return t.getAllNodes().forEach((n=>{t.getChildren(n.id).length||e.addNode(Object.assign({},n))})),t.getAllEdges().forEach((t=>{e.addEdge(t)})),e},En=(t,e)=>{const n=Number(t.x),r=Number(t.y),i=Number(e.x)-n,o=Number(e.y)-r;let a,s,l=Number(t.width)/2,u=Number(t.height)/2;return i||o?(Math.abs(o)*l>Math.abs(i)*u?(o<0&&(u=-u),a=u*i/o,s=u):(i<0&&(l=-l),a=l,s=l*o/i),{x:n+a,y:r+s}):{x:0,y:0}},_n=t=>{const e=[],n=xn(t)+1;for(let t=0;t<n;t++)e.push([]);t.getAllNodes().forEach((t=>{const n=t.data.rank;void 0!==n&&e[n]&&e[n].push(t.id)}));for(let r=0;r<n;r++)e[r]=e[r].sort(((e,n)=>{return r=t.getNode(e).data.order,i=t.getNode(n).data.order,Number(r)-Number(i);var r,i}));return e},bn=(t,e,n,r)=>{const i={width:0,height:0};return I(n)&&I(r)&&(i.rank=n,i.order=r),mn(t,"border",i,e)},xn=t=>{let e;return t.getAllNodes().forEach((t=>{const n=t.data.rank;void 0!==n&&(void 0===e||n>e)&&(e=n)})),e||(e=0),e},Sn=(t,e)=>t.reduce(((t,n)=>e(t)>e(n)?n:t)),Mn=(t,e,n,r,i,o)=>{r.includes(e.id)||(r.push(e.id),n||o.push(e.id),i(e.id).forEach((e=>Mn(t,e,n,r,i,o))),n&&o.push(e.id))},An=(t,e,n,r)=>{const i=Array.isArray(e)?e:[e],o=e=>t.getNeighbors(e),a=[],s=[];return i.forEach((e=>{if(!t.hasNode(e.id))throw new Error(`Graph does not have node: ${e}`);Mn(t,e,"post"===n,s,o,a)})),a},Rn=(t,e,n,r,i,o)=>{const a={rank:o,borderType:e,width:0,height:0},s=i.data[e][o-1],l=mn(t,"border",a,n);i.data[e][o]=l,t.setParent(l,r),s&&t.addEdge({id:`e${Math.random()}`,source:s,target:l,data:{weight:1}})},Tn=t=>{t.getAllNodes().forEach((t=>{wn(t)})),t.getAllEdges().forEach((t=>{wn(t)}))},wn=t=>{const e=t.data.width;t.data.width=t.data.height,t.data.height=e},Pn=t=>{t.getAllNodes().forEach((t=>{Nn(t.data)})),t.getAllEdges().forEach((t=>{var e;null===(e=t.data.points)||void 0===e||e.forEach((t=>Nn(t))),t.data.hasOwnProperty("y")&&Nn(t.data)}))},Nn=t=>{(null==t?void 0:t.y)&&(t.y=-t.y)},Cn=t=>{t.getAllNodes().forEach((t=>{On(t.data)})),t.getAllEdges().forEach((t=>{var e;null===(e=t.data.points)||void 0===e||e.forEach((t=>On(t))),t.data.hasOwnProperty("x")&&On(t.data)}))},On=t=>{const e=t.x;t.x=t.y,t.y=e},In=(t,e,n,r,i,o,a)=>{const s=t.getChildren(a);if(!(null==s?void 0:s.length))return void(a!==e&&t.addEdge({id:`e${Math.random()}`,source:e,target:a,data:{weight:0,minlen:n}}));const l=bn(t,"_bt"),u=bn(t,"_bb"),c=t.getNode(a);t.setParent(l,a),c.data.borderTop=l,t.setParent(u,a),c.data.borderBottom=u,null==s||s.forEach((s=>{In(t,e,n,r,i,o,s.id);const c=s.data.borderTop?s.data.borderTop:s.id,h=s.data.borderBottom?s.data.borderBottom:s.id,d=s.data.borderTop?r:2*r,f=c!==h?1:i-o[a]+1;t.addEdge({id:`e${Math.random()}`,source:l,target:c,data:{minlen:f,weight:d,nestingEdge:!0}}),t.addEdge({id:`e${Math.random()}`,source:h,target:u,data:{minlen:f,weight:d,nestingEdge:!0}})})),t.getParent(a)||t.addEdge({id:`e${Math.random()}`,source:e,target:l,data:{weight:0,minlen:i+o[a]}})},Ln=t=>{const e={},n=(r,i)=>{const o=t.getChildren(r);null==o||o.forEach((t=>n(t.id,i+1))),e[r]=i};return t.getRoots().forEach((t=>n(t.id,1))),e},Dn=t=>{let e=0;return t.getAllEdges().forEach((t=>{e+=t.data.weight})),e},Bn="edge-label",kn=(t,e,n)=>{let r=e.source,i=t.getNode(r).data.rank;const o=e.target,a=t.getNode(o).data.rank,s=e.data.labelRank;if(a===i+1)return;let l,u,c;for(t.removeEdge(e.id),c=0,++i;i<a;++c,++i)e.data.points=[],u={originalEdge:e,width:0,height:0,rank:i},l=mn(t,"edge",u,"_d"),i===s&&(u.width=e.data.width,u.height=e.data.height,u.dummy=Bn,u.labelpos=e.data.labelpos),t.addEdge({id:`e${Math.random()}`,source:r,target:l,data:{weight:e.data.weight}}),0===c&&n.push(l),r=l;t.addEdge({id:`e${Math.random()}`,source:r,target:o,data:{weight:e.data.weight}})},Fn=t=>{let e;for(;t.hasNode(e=`_root${Math.random()}`););return e},Un=(t,e,n)=>{const r=(i=n,o=n.map(((t,e)=>e)),null==i?void 0:i.reduce(((t,e,n)=>(t[e]=o[n],t)),{}));var i,o;const a=e.map((e=>{const n=t.getRelatedEdges(e,"out").map((t=>({pos:r[t.target]||0,weight:t.data.weight})));return null==n?void 0:n.sort(((t,e)=>t.pos-e.pos))})),s=a.flat().filter((t=>void 0!==t));let l=1;for(;l<n.length;)l<<=1;const u=2*l-1;l-=1;const c=Array(u).fill(0,0,u);let h=0;return null==s||s.forEach((t=>{if(t){let e=t.pos+l;c[e]+=t.weight;let n=0;for(;e>0;)e%2&&(n+=c[e+1]),e=e-1>>1,c[e]+=t.weight;h+=t.weight*n}})),h},Gn=(t,e)=>{let n=0;for(let r=1;r<(null==e?void 0:e.length);r+=1)n+=Un(t,e[r-1],e[r]);return n},zn=t=>{const e={},n=t.getAllNodes(),r=n.map((t=>{var e;return null!==(e=t.data.rank)&&void 0!==e?e:-1/0})),i=Math.max(...r),o=[];for(let t=0;t<i+1;t++)o.push([]);const a=n.sort(((e,n)=>t.getNode(e.id).data.rank-t.getNode(n.id).data.rank)),s=a.filter((e=>void 0!==t.getNode(e.id).data.fixorder)).sort(((e,n)=>t.getNode(e.id).data.fixorder-t.getNode(n.id).data.fixorder));return null==s||s.forEach((n=>{isNaN(t.getNode(n.id).data.rank)||o[t.getNode(n.id).data.rank].push(n.id),e[n.id]=!0})),null==a||a.forEach((n=>t.dfsTree(n.id,(t=>{if(e.hasOwnProperty(t.id))return!0;e[t.id]=!0,isNaN(t.data.rank)||o[t.data.rank].push(t.id)})))),o},Vn=t=>{var e,n;const r=[];for(;null==t?void 0:t.length;){const i=t.pop();r.push(i),null===(e=i.in.reverse())||void 0===e||e.forEach((t=>{return(e=i,t=>{t.merged||(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&Wn(e,t)})(t);var e})),null===(n=i.out)||void 0===n||n.forEach((e=>{return(n=i,e=>{e.in.push(n),0==--e.indegree&&t.push(e)})(e);var n}))}const i=r.filter((t=>!t.merged)),o=["vs","i","barycenter","weight"];return i.map((t=>{const e={};return null==o||o.forEach((n=>{void 0!==t[n]&&(e[n]=t[n])})),e}))},Wn=(t,e)=>{var n;let r=0,i=0;t.weight&&(r+=t.barycenter*t.weight,i+=t.weight),e.weight&&(r+=e.barycenter*e.weight,i+=e.weight),t.vs=null===(n=e.vs)||void 0===n?void 0:n.concat(t.vs),t.barycenter=r/i,t.weight=i,t.i=Math.min(e.i,t.i),e.merged=!0},jn=(t,e,n)=>{let r,i=n;for(;e.length&&(r=e[e.length-1]).i<=i;)e.pop(),null==t||t.push(r.vs),i++;return i},Hn=(t,e)=>(n,r)=>{if(void 0!==n.fixorder&&void 0!==r.fixorder)return n.fixorder-r.fixorder;if(n.barycenter<r.barycenter)return-1;if(n.barycenter>r.barycenter)return 1;if(e&&void 0!==n.order&&void 0!==r.order){if(n.order<r.order)return-1;if(n.order>r.order)return 1}return t?r.i-n.i:n.i-r.i},Xn=(t,e,n,r,i,o)=>{var a,s,l,u;let c=t.getChildren(e).map((t=>t.id));const h=t.getNode(e),d=h?h.data.borderLeft:void 0,f=h?h.data.borderRight:void 0,p={};d&&(c=null==c?void 0:c.filter((t=>t!==d&&t!==f)));const g=((t,e)=>e.map((e=>{const n=t.getRelatedEdges(e,"in");if(!(null==n?void 0:n.length))return{v:e};const r={sum:0,weight:0};return null==n||n.forEach((e=>{const n=t.getNode(e.source);r.sum+=e.data.weight*n.data.order,r.weight+=e.data.weight})),{v:e,barycenter:r.sum/r.weight,weight:r.weight}})))(t,c||[]);null==g||g.forEach((e=>{var i;if(null===(i=t.getChildren(e.v))||void 0===i?void 0:i.length){const i=Xn(t,e.v,n,r,o);p[e.v]=i,i.hasOwnProperty("barycenter")&&Kn(e,i)}}));const v=((t,e)=>{var n,r,i;const o={};null==t||t.forEach(((t,e)=>{o[t.v]={i:e,indegree:0,in:[],out:[],vs:[t.v]};const n=o[t.v];void 0!==t.barycenter&&(n.barycenter=t.barycenter,n.weight=t.weight)})),null===(n=e.getAllEdges())||void 0===n||n.forEach((t=>{const e=o[t.source],n=o[t.target];void 0!==e&&void 0!==n&&(n.indegree++,e.out.push(o[t.target]))}));const a=null===(i=(r=Object.values(o)).filter)||void 0===i?void 0:i.call(r,(t=>!t.indegree));return Vn(a)})(g,n);Yn(v,p),null===(a=v.filter((t=>t.vs.length>0)))||void 0===a||a.forEach((e=>{const n=t.getNode(e.vs[0]);n&&(e.fixorder=n.data.fixorder,e.order=n.data.order)}));const m=((t,e,n,r)=>{const i=((t,e)=>{const n={lhs:[],rhs:[]};return null==t||t.forEach((t=>{e(t)?n.lhs.push(t):n.rhs.push(t)})),n})(t,(t=>{const e=t.hasOwnProperty("fixorder")&&!isNaN(t.fixorder);return r?!e&&t.hasOwnProperty("barycenter"):e||t.hasOwnProperty("barycenter")})),o=i.lhs,a=i.rhs.sort(((t,e)=>-t.i- -e.i)),s=[];let l=0,u=0,c=0;null==o||o.sort(Hn(!!e,!!n)),c=jn(s,a,c),null==o||o.forEach((t=>{var e;c+=null===(e=t.vs)||void 0===e?void 0:e.length,s.push(t.vs),l+=t.barycenter*t.weight,u+=t.weight,c=jn(s,a,c)}));const h={vs:s.flat()};return u&&(h.barycenter=l/u,h.weight=u),h})(v,r,i,o);if(d&&(m.vs=[d,m.vs,f].flat(),null===(s=t.getPredecessors(d))||void 0===s?void 0:s.length)){const e=t.getNode((null===(l=t.getPredecessors(d))||void 0===l?void 0:l[0].id)||""),n=t.getNode((null===(u=t.getPredecessors(f))||void 0===u?void 0:u[0].id)||"");m.hasOwnProperty("barycenter")||(m.barycenter=0,m.weight=0),m.barycenter=(m.barycenter*m.weight+e.data.order+n.data.order)/(m.weight+2),m.weight+=2}return m},Yn=(t,e)=>{null==t||t.forEach((t=>{var n;const r=null===(n=t.vs)||void 0===n?void 0:n.map((t=>e[t]?e[t].vs:t));t.vs=r.flat()}))},Kn=(t,e)=>{void 0!==t.barycenter?(t.barycenter=(t.barycenter*t.weight+e.barycenter*e.weight)/(t.weight+e.weight),t.weight+=e.weight):(t.barycenter=e.barycenter,t.weight=e.weight)},$n=(t,e,n)=>e.map((e=>((t,e,n)=>{const r=Fn(t),i=new v({tree:[{id:r,children:[],data:{}}]});return t.getAllNodes().forEach((o=>{const a=t.getParent(o.id);(o.data.rank===e||o.data.minRank<=e&&e<=o.data.maxRank)&&(i.hasNode(o.id)||i.addNode(Object.assign({},o)),(null==a?void 0:a.id)&&!i.hasNode(null==a?void 0:a.id)&&i.addNode(Object.assign({},a)),i.setParent(o.id,(null==a?void 0:a.id)||r),t.getRelatedEdges(o.id,n).forEach((e=>{const n=e.source===o.id?e.target:e.source;i.hasNode(n)||i.addNode(Object.assign({},t.getNode(n)));const r=i.getRelatedEdges(n,"out").find((({target:t})=>t===o.id)),a=void 0!==r?r.data.weight:0;r?i.updateEdgeData(r.id,Object.assign(Object.assign({},r.data),{weight:e.data.weight+a})):i.addEdge({id:e.id,source:n,target:o.id,data:{weight:e.data.weight+a}})})),o.data.hasOwnProperty("minRank")&&i.updateNodeData(o.id,Object.assign(Object.assign({},o.data),{borderLeft:o.data.borderLeft[e],borderRight:o.data.borderRight[e]})))})),i})(t,e,n))),qn=(t,e,n,r)=>{const i=new v;null==t||t.forEach((t=>{var o;const a=t.getRoots()[0].id,s=Xn(t,a,i,e,n,r);for(let e=0;e<(null===(o=s.vs)||void 0===o?void 0:o.length);e++){const n=t.getNode(s.vs[e]);n&&(n.data.order=e)}((t,e,n)=>{const r={};let i;null==n||n.forEach((n=>{let o,a,s=t.getParent(n);for(;s;){if(o=t.getParent(s.id),o?(a=r[o.id],r[o.id]=s.id):(a=i,i=s.id),a&&a!==s.id)return e.hasNode(a)||e.addNode({id:a,data:{}}),e.hasNode(s.id)||e.addNode({id:s.id,data:{}}),void(e.hasEdge(`e${a}-${s.id}`)||e.addEdge({id:`e${a}-${s.id}`,source:a,target:s.id,data:{}}));s=o}}))})(t,i,s.vs)}))},Zn=(t,e)=>{null==e||e.forEach((e=>{null==e||e.forEach(((e,n)=>{t.getNode(e).data.order=n}))}))},Qn=(t,e)=>{const n=(t=>{const e={};let n=0;const r=i=>{const o=n;t.getChildren(i).forEach((t=>r(t.id))),e[i]={low:o,lim:n++}};return t.getRoots().forEach((t=>r(t.id))),e})(t);e.forEach((e=>{var r,i;let o=e,a=t.getNode(o);const s=a.data.originalEdge;if(!s)return;const l=((t,e,n,r)=>{var i,o;const a=[],s=[],l=Math.min(e[n].low,e[r].low),u=Math.max(e[n].lim,e[r].lim);let c,h;c=n;do{c=null===(i=t.getParent(c))||void 0===i?void 0:i.id,a.push(c)}while(c&&(e[c].low>l||u>e[c].lim));for(h=c,c=r;c&&c!==h;)s.push(c),c=null===(o=t.getParent(c))||void 0===o?void 0:o.id;return{lca:h,path:a.concat(s.reverse())}})(t,n,s.source,s.target),u=l.path,c=l.lca;let h=0,d=u[h],f=!0;for(;o!==s.target;){if(a=t.getNode(o),f){for(;d!==c&&(null===(r=t.getNode(d))||void 0===r?void 0:r.data.maxRank)<a.data.rank;)h++,d=u[h];d===c&&(f=!1)}if(!f){for(;h<u.length-1&&(null===(i=t.getNode(u[h+1]))||void 0===i?void 0:i.data.minRank)<=a.data.rank;)h++;d=u[h]}t.hasNode(d)&&t.setParent(o,d),o=t.getSuccessors(o)[0].id}}))},Jn=(t,e)=>{const n={};function r(e,r){const i=function(t){return JSON.stringify(t.slice(1))}(e);r.get(i)||(!function(e,r,i,o,a){var s,l;let u;for(let c=r;c<i;c++)u=e[c],(null===(s=t.getNode(u))||void 0===s?void 0:s.data.dummy)&&(null===(l=t.getPredecessors(u))||void 0===l||l.forEach((e=>{const r=t.getNode(e.id);r.data.dummy&&(r.data.order<o||r.data.order>a)&&er(n,e.id,u)})))}(...e),r.set(i,!0))}const i=(e,n)=>{let i,o=-1,a=0;const s=new Map;return null==n||n.forEach(((l,u)=>{var c;if("border"===(null===(c=t.getNode(l))||void 0===c?void 0:c.data.dummy)){const e=t.getPredecessors(l)||[];e.length&&(i=t.getNode(e[0].id).data.order,r([n,a,u,o,i],s),a=u,o=i)}r([n,a,n.length,i,e.length],s)})),n};return(null==e?void 0:e.length)&&e.reduce(i),n},tr=(t,e)=>{var n,r;if(null===(n=t.getNode(e))||void 0===n?void 0:n.data.dummy)return null===(r=t.getPredecessors(e))||void 0===r?void 0:r.find((e=>t.getNode(e.id).data.dummy))},er=(t,e,n)=>{let r=e,i=n;if(r>i){const t=r;r=i,i=t}let o=t[r];o||(t[r]=o={}),o[i]=!0},nr=(t,e,n)=>{let r=e,i=n;if(r>n){r=n,i=e}return!!t[r]},rr=(t,e,n,r,i,o)=>{const a=new v,s=ir(r,i,o);return null==e||e.forEach((e=>{let r;null==e||e.forEach((e=>{const i=n[e];if(a.hasNode(i)||a.addNode({id:i,data:{}}),r){const o=n[r],l=a.getRelatedEdges(o,"out").find((t=>t.target===i));l?a.updateEdgeData(l.id,Object.assign(Object.assign({},l.data),{weight:Math.max(s(t,e,r),l.data.weight||0)})):a.addEdge({id:`e${Math.random()}`,source:o,target:i,data:{weight:Math.max(s(t,e,r),0)}})}r=e}))})),a};const ir=(t,e,n)=>(r,i,o)=>{const a=r.getNode(i),s=r.getNode(o);let l=0,u=0;if(l+=a.data.width/2,a.data.hasOwnProperty("labelpos"))switch((a.data.labelpos||"").toLowerCase()){case"l":u=-a.data.width/2;break;case"r":u=a.data.width/2}if(u&&(l+=n?u:-u),u=0,l+=(a.data.dummy?e:t)/2,l+=(s.data.dummy?e:t)/2,l+=s.data.width/2,s.data.labelpos)switch((s.data.labelpos||"").toLowerCase()){case"l":u=s.data.width/2;break;case"r":u=-s.data.width/2}return u&&(l+=n?u:-u),u=0,l},or=(t,e)=>t.getNode(e).data.width||0,ar=(t,e)=>{const{align:n,nodesep:r=0,edgesep:i=0}=e||{},o=_n(t),a=Object.assign(((t,e)=>{const n={},r=(e,r)=>{let i=0,o=0;const a=e.length,s=null==r?void 0:r[(null==r?void 0:r.length)-1];return null==r||r.forEach(((e,l)=>{var u;const c=tr(t,e),h=c?t.getNode(c.id).data.order:a;(c||e===s)&&(null===(u=r.slice(o,l+1))||void 0===u||u.forEach((e=>{var r;null===(r=t.getPredecessors(e))||void 0===r||r.forEach((r=>{var o;const a=t.getNode(r.id),s=a.data.order;!(s<i||h<s)||a.data.dummy&&(null===(o=t.getNode(e))||void 0===o?void 0:o.data.dummy)||er(n,r.id,e)}))})),o=l+1,i=h)})),r};return(null==e?void 0:e.length)&&e.reduce(r),n})(t,o),Jn(t,o)),s={};let l=[];["u","d"].forEach((e=>{l="u"===e?o:Object.values(o).reverse(),["l","r"].forEach((n=>{"r"===n&&(l=l.map((t=>Object.values(t).reverse())));const o=("u"===e?t.getPredecessors:t.getSuccessors).bind(t),u=((t,e,n,r)=>{const i={},o={},a={};return null==e||e.forEach((t=>{null==t||t.forEach(((t,e)=>{i[t]=t,o[t]=t,a[t]=e}))})),null==e||e.forEach((t=>{let e=-1;null==t||t.forEach((t=>{let s=r(t).map((t=>t.id));if(s.length){s=s.sort(((t,e)=>a[t]-a[e]));const r=(s.length-1)/2;for(let l=Math.floor(r),u=Math.ceil(r);l<=u;++l){const r=s[l];o[t]===t&&e<a[r]&&!nr(n,t,r)&&(o[r]=t,o[t]=i[t]=i[r],e=a[r])}}}))})),{root:i,align:o}})(0,l,a,o),c=((t,e,n,r,i,o,a)=>{var s;const l={},u=rr(t,e,n,i,o,a),c=a?"borderLeft":"borderRight",h=(t,e)=>{let n=u.getAllNodes(),r=n.pop();const i={};for(;r;)i[r.id]?t(r.id):(i[r.id]=!0,n.push(r),n=n.concat(e(r.id))),r=n.pop()};return h((t=>{l[t]=(u.getRelatedEdges(t,"in")||[]).reduce(((t,e)=>Math.max(t,(l[e.source]||0)+e.data.weight)),0)}),u.getPredecessors.bind(u)),h((e=>{const n=(u.getRelatedEdges(e,"out")||[]).reduce(((t,e)=>Math.min(t,(l[e.target]||0)-e.data.weight)),Number.POSITIVE_INFINITY),r=t.getNode(e);n!==Number.POSITIVE_INFINITY&&r.data.borderType!==c&&(l[e]=Math.max(l[e],n))}),u.getSuccessors.bind(u)),null===(s=Object.values(r))||void 0===s||s.forEach((t=>{l[t]=l[n[t]]})),l})(t,l,u.root,u.align,r,i,"r"===n);"r"===n&&Object.keys(c).forEach((t=>c[t]=-c[t])),s[e+n]=c}))}));const u=((t,e)=>Sn(Object.values(e),(e=>{var n;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return null===(n=Object.keys(e))||void 0===n||n.forEach((n=>{const o=e[n],a=or(t,n)/2;r=Math.max(o+a,r),i=Math.min(o-a,i)})),r-i})))(t,s);return u&&function(t,e){const n=Object.values(e),r=Math.min(...n),i=Math.max(...n);["u","d"].forEach((n=>{["l","r"].forEach((o=>{const a=n+o,s=t[a];let l;if(s===e)return;const u=Object.values(s);l="l"===o?r-Math.min(...u):i-Math.max(...u),l&&(t[a]={},Object.keys(s).forEach((e=>{t[a][e]=s[e]+l})))}))}))}(s,u),((t,e)=>{const n={};return Object.keys(t.ul).forEach((r=>{if(e)n[r]=t[e.toLowerCase()][r];else{const e=Object.values(t).map((t=>t[r]));n[r]=(e[0]+e[1])/2}})),n})(s,n)},sr=(t,e)=>{var n;const r=yn(t);((t,e)=>{const{ranksep:n=0}=e||{},r=_n(t);let i=0;null==r||r.forEach((e=>{const r=e.map((e=>t.getNode(e).data.height)),o=Math.max(...r,0);null==e||e.forEach((e=>{t.getNode(e).data.y=i+o/2})),i+=o+n}))})(r,e);const i=ar(r,e);null===(n=Object.keys(i))||void 0===n||n.forEach((t=>{r.getNode(t).data.x=i[t]}))},lr=t=>{const e={},n=r=>{var i;const o=t.getNode(r);if(!o)return 0;if(e[r])return o.data.rank;let a;return e[r]=!0,null===(i=t.getRelatedEdges(r,"out"))||void 0===i||i.forEach((t=>{const e=n(t.target)-t.data.minlen;e&&(void 0===a||e<a)&&(a=e)})),a||(a=0),o.data.rank=a,a};t.getAllNodes().filter((e=>0===t.getRelatedEdges(e.id,"in").length)).forEach((t=>n(t.id)))},ur=(t,e)=>t.getNode(e.target).data.rank-t.getNode(e.source).data.rank-e.data.minlen,cr=(t,e)=>{const n=r=>{e.getRelatedEdges(r,"both").forEach((i=>{const o=i.source,a=r===o?i.target:o;t.hasNode(a)||ur(e,i)||(t.addNode({id:a,data:{}}),t.addEdge({id:i.id,source:r,target:a,data:{}}),n(a))}))};return t.getAllNodes().forEach((t=>n(t.id))),t.getAllNodes().length},hr=(t,e)=>{const n=r=>{var i;null===(i=e.getRelatedEdges(r,"both"))||void 0===i||i.forEach((i=>{const o=i.source,a=r===o?i.target:o;t.hasNode(a)||void 0===e.getNode(a).data.layer&&ur(e,i)||(t.addNode({id:a,data:{}}),t.addEdge({id:i.id,source:r,target:a,data:{}}),n(a))}))};return t.getAllNodes().forEach((t=>n(t.id))),t.getAllNodes().length},dr=(t,e)=>Sn(e.getAllEdges(),(n=>t.hasNode(n.source)!==t.hasNode(n.target)?ur(e,n):1/0)),fr=(t,e,n)=>{t.getAllNodes().forEach((t=>{const r=e.getNode(t.id);r.data.rank||(r.data.rank=0),r.data.rank+=n}))},pr=t=>{const e=(t=>{const e=new v;return t.getAllNodes().forEach((t=>{e.addNode(Object.assign({},t))})),t.getAllEdges().forEach((t=>{const n=e.getRelatedEdges(t.source,"out").find((e=>e.target===t.target));n?e.updateEdgeData(null==n?void 0:n.id,Object.assign(Object.assign({},n.data),{weight:n.data.weight+t.data.weight||0,minlen:Math.max(n.data.minlen,t.data.minlen||1)})):e.addEdge({id:t.id,source:t.source,target:t.target,data:{weight:t.data.weight||0,minlen:t.data.minlen||1}})})),e})(t);lr(e);const n=(t=>{const e=new v({tree:[]}),n=t.getAllNodes()[0],r=t.getAllNodes().length;let i,o;for(e.addNode(n);cr(e,t)<r;)i=dr(e,t),o=e.hasNode(i.source)?ur(t,i):-ur(t,i),fr(e,t,o);return e})(e);let r,i;for(yr(n),gr(n,e);r=_r(n);)i=br(n,e,r),xr(n,e,r,i)},gr=(t,e)=>{let n=An(t,t.getAllNodes(),"post");n=n.slice(0,(null==n?void 0:n.length)-1),n.forEach((n=>{vr(t,e,n)}))},vr=(t,e,n)=>{const r=t.getNode(n).data.parent;t.getRelatedEdges(n,"both").find((t=>t.target===r||t.source===r)).data.cutvalue=mr(t,e,n)},mr=(t,e,n)=>{const r=t.getNode(n).data.parent;let i=!0,o=e.getRelatedEdges(n,"out").find((t=>t.target===r)),a=0;return o||(i=!1,o=e.getRelatedEdges(r,"out").find((t=>t.target===n))),a=o.data.weight,e.getRelatedEdges(n,"both").forEach((e=>{const o=e.source===n,s=o?e.target:e.source;if(s!==r){const r=o===i,l=e.data.weight;if(a+=r?l:-l,Mr(t,n,s)){const e=t.getRelatedEdges(n,"both").find((t=>t.source===s||t.target===s)).data.cutvalue;a+=r?-e:e}}})),a},yr=(t,e=t.getAllNodes()[0].id)=>{Er(t,{},1,e)},Er=(t,e,n,r,i)=>{var o;const a=n;let s=n;const l=t.getNode(r);return e[r]=!0,null===(o=t.getNeighbors(r))||void 0===o||o.forEach((n=>{e[n.id]||(s=Er(t,e,s,n.id,r))})),l.data.low=a,l.data.lim=s++,i?l.data.parent=i:delete l.data.parent,s},_r=t=>t.getAllEdges().find((t=>t.data.cutvalue<0)),br=(t,e,n)=>{let r=n.source,i=n.target;e.getRelatedEdges(r,"out").find((t=>t.target===i))||(r=n.target,i=n.source);const o=t.getNode(r),a=t.getNode(i);let s=o,l=!1;o.data.lim>a.data.lim&&(s=a,l=!0);const u=e.getAllEdges().filter((e=>l===Ar(t.getNode(e.source),s)&&l!==Ar(t.getNode(e.target),s)));return Sn(u,(t=>ur(e,t)))},xr=(t,e,n,r)=>{const i=t.getRelatedEdges(n.source,"both").find((t=>t.source===n.target||t.target===n.target));i&&t.removeEdge(i.id),t.addEdge({id:`e${Math.random()}`,source:r.source,target:r.target,data:{}}),yr(t),gr(t,e),Sr(t,e)},Sr=(t,e)=>{const n=t.getAllNodes().find((t=>!t.data.parent));let r=An(t,n,"pre");r=r.slice(1),r.forEach((n=>{const r=t.getNode(n).data.parent;let i=e.getRelatedEdges(n,"out").find((t=>t.target===r)),o=!1;!i&&e.hasNode(r)&&(i=e.getRelatedEdges(r,"out").find((t=>t.target===n)),o=!0),e.getNode(n).data.rank=(e.hasNode(r)&&e.getNode(r).data.rank||0)+(o?null==i?void 0:i.data.minlen:-(null==i?void 0:i.data.minlen))}))},Mr=(t,e,n)=>t.getRelatedEdges(e,"both").find((t=>t.source===n||t.target===n)),Ar=(t,e)=>e.data.low<=t.data.lim&&t.data.lim<=e.data.lim,Rr=lr,Tr=t=>{(t=>{const e={};let n;const r=i=>{var o;const a=t.getNode(i);if(!a)return 0;if(e[i])return a.data.rank;let s;return e[i]=!0,null===(o=t.getRelatedEdges(i,"out"))||void 0===o||o.forEach((t=>{const e=r(t.target)-t.data.minlen;e&&(void 0===s||e<s)&&(s=e)})),s||(s=0),(void 0===n||s<n)&&(n=s),a.data.rank=s,s};t.getAllNodes().filter((e=>0===t.getRelatedEdges(e.id,"in").length)).forEach((t=>{t&&r(t.id)})),void 0===n&&(n=0);const i={},o=(e,n)=>{var r;const a=t.getNode(e),s=isNaN(a.data.layer)?n:a.data.layer;(void 0===a.data.rank||a.data.rank<s)&&(a.data.rank=s),i[e]||(i[e]=!0,null===(r=t.getRelatedEdges(e,"out"))||void 0===r||r.forEach((t=>{o(t.target,s+t.data.minlen)})))};t.getAllNodes().forEach((t=>{const e=t.data;e&&(isNaN(e.layer)?e.rank-=n:o(t.id,e.layer))}))})(t),(t=>{const e=new v({tree:[]}),n=t.getAllNodes()[0],r=t.getAllNodes().length;let i,o;for(e.addNode(n);hr(e,t)<r;)i=dr(e,t),o=e.hasNode(i.source)?ur(t,i):-ur(t,i),fr(e,t,o)})(t)},wr=t=>{pr(t)},Pr=(t,e)=>{const{acyclicer:n,ranker:r,rankdir:i="tb",nodeOrder:o,keepNodeOrder:a,align:s,nodesep:l=50,edgesep:u=20,ranksep:c=50}=e;Yr(t),gn(t,n);const{nestingRoot:h,nodeRankFactor:d}=(t=>{const e=mn(t,"root",{},"_root"),n=Ln(t);let r=Math.max(...Object.values(n));Math.abs(r)===1/0&&(r=1);const i=r-1,o=2*i+1;t.getAllEdges().forEach((t=>{t.data.minlen*=o}));const a=Dn(t)+1;return t.getRoots().forEach((r=>{In(t,e,o,a,i,n,r.id)})),{nestingRoot:e,nodeRankFactor:o}})(t);((t,e)=>{switch(e){case"network-simplex":wr(t);break;case"tight-tree":default:Tr(t);break;case"longest-path":Rr(t)}})(yn(t),r),Ur(t),((t,e=0)=>{const n=t.getAllNodes(),r=n.filter((t=>void 0!==t.data.rank)).map((t=>t.data.rank)),i=Math.min(...r),o=[];n.forEach((t=>{const e=(t.data.rank||0)-i;o[e]||(o[e]=[]),o[e].push(t.id)}));let a=0;for(let n=0;n<o.length;n++){const r=o[n];void 0===r?n%e!=0&&(a-=1):a&&(null==r||r.forEach((e=>{const n=t.getNode(e);n&&(n.data.rank=n.data.rank||0,n.data.rank+=a)})))}})(t,d),((t,e)=>{e&&t.removeNode(e),t.getAllEdges().forEach((e=>{e.data.nestingEdge&&t.removeEdge(e.id)}))})(t,h),(t=>{const e=t.getAllNodes().filter((t=>void 0!==t.data.rank)).map((t=>t.data.rank)),n=Math.min(...e);t.getAllNodes().forEach((t=>{t.data.hasOwnProperty("rank")&&n!==1/0&&(t.data.rank-=n)}))})(t),Gr(t),zr(t);const f=[];((t,e)=>{t.getAllEdges().forEach((n=>kn(t,n,e)))})(t,f),Qn(t,f),(t=>{const e=n=>{const r=t.getChildren(n),i=t.getNode(n);if((null==r?void 0:r.length)&&r.forEach((t=>e(t.id))),i.data.hasOwnProperty("minRank")){i.data.borderLeft=[],i.data.borderRight=[];for(let e=i.data.minRank,r=i.data.maxRank+1;e<r;e+=1)Rn(t,"borderLeft","_bl",n,i,e),Rn(t,"borderRight","_br",n,i,e)}};t.getRoots().forEach((t=>e(t.id)))})(t),a&&((t,e)=>{const n=t.getAllNodes().filter((e=>{var n;return!(null===(n=t.getChildren(e.id))||void 0===n?void 0:n.length)})),r=n.map((t=>t.data.rank)),i=Math.max(...r),o=[];for(let t=0;t<i+1;t++)o[t]=[];null==e||e.forEach((e=>{const n=t.getNode(e);n&&!n.data.dummy&&(isNaN(n.data.rank)||(n.data.fixorder=o[n.data.rank].length,o[n.data.rank].push(e)))}))})(t,o),((t,e)=>{const n=xn(t),r=[],i=[];for(let t=1;t<n+1;t++)r.push(t);for(let t=n-1;t>-1;t--)i.push(t);const o=$n(t,r,"in"),a=$n(t,i,"out");let s=zn(t);Zn(t,s);let l,u=Number.POSITIVE_INFINITY;for(let n=0,r=0;r<4;++n,++r){qn(n%2?o:a,n%4>=2,!1,e),s=_n(t);const i=Gn(t,s);i<u&&(r=0,l=X(s),u=i)}s=zn(t),Zn(t,s);for(let n=0,r=0;r<4;++n,++r){qn(n%2?o:a,n%4>=2,!0,e),s=_n(t);const i=Gn(t,s);i<u&&(r=0,l=X(s),u=i)}Zn(t,l)})(t,a),Kr(t),((t,e)=>{const n=e.toLowerCase();"lr"!==n&&"rl"!==n||Tn(t)})(t,i),sr(t,{align:s,nodesep:l,edgesep:u,ranksep:c}),$r(t),Xr(t),((t,e)=>{e.forEach((e=>{let n=t.getNode(e);const{data:r}=n,i=r.originalEdge;let o;i&&t.addEdge(i);let a=e;for(;n.data.dummy;)o=t.getSuccessors(a)[0],t.removeNode(a),i.data.points.push({x:n.data.x,y:n.data.y}),n.data.dummy===Bn&&(i.data.x=n.data.x,i.data.y=n.data.y,i.data.width=n.data.width,i.data.height=n.data.height),a=o.id,n=t.getNode(a)}))})(t,f),jr(t),((t,e)=>{const n=e.toLowerCase();"bt"!==n&&"rl"!==n||Pn(t),"lr"!==n&&"rl"!==n||(Cn(t),Tn(t))})(t,i);const{width:p,height:g}=Vr(t);return Wr(t),Hr(t),(t=>{t.getAllEdges().forEach((e=>{const n=e.data;if(n.reversed){t.removeEdge(e.id);const r=n.forwardName;delete n.reversed,delete n.forwardName,t.addEdge({id:e.id,source:e.target,target:e.source,data:Object.assign(Object.assign({},n),{forwardName:r})})}}))})(t),{width:p,height:g}},Nr=(t,e)=>{t.getAllNodes().forEach((n=>{const r=t.getNode(n.id);if(e.hasNode(n.id)){const t=e.getNode(n.id);r.data.fixorder=t.data._order,delete t.data._order}else delete r.data.fixorder}))},Cr=(t,e)=>{t.getAllNodes().forEach((n=>{var r;const i=t.getNode(n.id);if(i){const t=e.getNode(n.id);i.data.x=t.data.x,i.data.y=t.data.y,i.data._order=t.data.order,i.data._rank=t.data.rank,(null===(r=e.getChildren(n.id))||void 0===r?void 0:r.length)&&(i.data.width=t.data.width,i.data.height=t.data.height)}})),t.getAllEdges().forEach((n=>{const r=t.getEdge(n.id),i=e.getEdge(n.id);r.data.points=i?i.data.points:[],i&&i.data.hasOwnProperty("x")&&(r.data.x=i.data.x,r.data.y=i.data.y)}))},Or=["width","height","layer","fixorder"],Ir={width:0,height:0},Lr=["minlen","weight","width","height","labeloffset"],Dr={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Br=["labelpos"],kr=t=>{const e=new v({tree:[]});return t.getAllNodes().forEach((n=>{const r=Zr(t.getNode(n.id).data),i=Object.assign(Object.assign({},Ir),r),o=qr(i,Or);e.hasNode(n.id)||e.addNode({id:n.id,data:Object.assign({},o)});const a=t.hasTreeStructure("combo")?t.getParent(n.id,"combo"):t.getParent(n.id);_(a)||(e.hasNode(a.id)||e.addNode(Object.assign({},a)),e.setParent(n.id,a.id))})),t.getAllEdges().forEach((n=>{const r=Zr(t.getEdge(n.id).data),i={};null==Br||Br.forEach((t=>{void 0!==r[t]&&(i[t]=r[t])})),e.addEdge({id:n.id,source:n.source,target:n.target,data:Object.assign({},Dr,qr(r,Lr),i)})})),e},Fr=(t,e)=>{const{ranksep:n=0,rankdir:r}=e;return t.getAllNodes().forEach((t=>{isNaN(t.data.layer)||t.data.layer||(t.data.layer=0)})),t.getAllEdges().forEach((t=>{var e;t.data.minlen*=2,"c"!==(null===(e=t.data.labelpos)||void 0===e?void 0:e.toLowerCase())&&("TB"===r||"BT"===r?t.data.width+=t.data.labeloffset:t.data.height+=t.data.labeloffset)})),n/2},Ur=t=>{t.getAllEdges().forEach((e=>{if(e.data.width&&e.data.height){const n=t.getNode(e.source),r={e:e,rank:(t.getNode(e.target).data.rank-n.data.rank)/2+n.data.rank};mn(t,"edge-proxy",r,"_ep")}}))},Gr=t=>{let e=0;return t.getAllNodes().forEach((n=>{var r,i;n.data.borderTop&&(n.data.minRank=null===(r=t.getNode(n.data.borderTop))||void 0===r?void 0:r.data.rank,n.data.maxRank=null===(i=t.getNode(n.data.borderBottom))||void 0===i?void 0:i.data.rank,e=Math.max(e,n.data.maxRank||-1/0))})),e},zr=t=>{t.getAllNodes().forEach((e=>{"edge-proxy"===e.data.dummy&&(t.getEdge(e.data.e.id).data.labelRank=e.data.rank,t.removeNode(e.id))}))},Vr=(t,e)=>{let n,r,i=0,o=0;const{marginx:a=0,marginy:s=0}={},l=t=>{if(!t.data)return;const e=t.data.x,a=t.data.y,s=t.data.width,l=t.data.height;isNaN(e)||isNaN(s)||(void 0===n&&(n=e-s/2),n=Math.min(n,e-s/2),i=Math.max(i,e+s/2)),isNaN(a)||isNaN(l)||(void 0===r&&(r=a-l/2),r=Math.min(r,a-l/2),o=Math.max(o,a+l/2))};return t.getAllNodes().forEach((t=>{l(t)})),t.getAllEdges().forEach((t=>{(null==t?void 0:t.data.hasOwnProperty("x"))&&l(t)})),n-=a,r-=s,t.getAllNodes().forEach((t=>{t.data.x-=n,t.data.y-=r})),t.getAllEdges().forEach((t=>{var e;null===(e=t.data.points)||void 0===e||e.forEach((t=>{t.x-=n,t.y-=r})),t.data.hasOwnProperty("x")&&(t.data.x-=n),t.data.hasOwnProperty("y")&&(t.data.y-=r)})),{width:i-n+a,height:o-r+s}},Wr=t=>{t.getAllEdges().forEach((e=>{const n=t.getNode(e.source),r=t.getNode(e.target);let i,o;e.data.points?(i=e.data.points[0],o=e.data.points[e.data.points.length-1]):(e.data.points=[],i={x:r.data.x,y:r.data.y},o={x:n.data.x,y:n.data.y}),e.data.points.unshift(En(n.data,i)),e.data.points.push(En(r.data,o))}))},jr=t=>{t.getAllEdges().forEach((t=>{if(t.data.hasOwnProperty("x"))switch("l"!==t.data.labelpos&&"r"!==t.data.labelpos||(t.data.width-=t.data.labeloffset),t.data.labelpos){case"l":t.data.x-=t.data.width/2+t.data.labeloffset;break;case"r":t.data.x+=t.data.width/2+t.data.labeloffset}}))},Hr=t=>{t.getAllEdges().forEach((t=>{var e;t.data.reversed&&(null===(e=t.data.points)||void 0===e||e.reverse())}))},Xr=t=>{t.getAllNodes().forEach((e=>{var n,r,i;if(null===(n=t.getChildren(e.id))||void 0===n?void 0:n.length){const n=t.getNode(e.id),o=t.getNode(n.data.borderTop),a=t.getNode(n.data.borderBottom),s=t.getNode(n.data.borderLeft[(null===(r=n.data.borderLeft)||void 0===r?void 0:r.length)-1]),l=t.getNode(n.data.borderRight[(null===(i=n.data.borderRight)||void 0===i?void 0:i.length)-1]);n.data.width=Math.abs((null==l?void 0:l.data.x)-(null==s?void 0:s.data.x))||10,n.data.height=Math.abs((null==a?void 0:a.data.y)-(null==o?void 0:o.data.y))||10,n.data.x=((null==s?void 0:s.data.x)||0)+n.data.width/2,n.data.y=((null==o?void 0:o.data.y)||0)+n.data.height/2}})),t.getAllNodes().forEach((e=>{"border"===e.data.dummy&&t.removeNode(e.id)}))},Yr=t=>{t.getAllEdges().forEach((e=>{if(e.source===e.target){const n=t.getNode(e.source);n.data.selfEdges||(n.data.selfEdges=[]),n.data.selfEdges.push(e),t.removeEdge(e.id)}}))},Kr=t=>{const e=_n(t);null==e||e.forEach((e=>{let n=0;null==e||e.forEach(((e,r)=>{var i;const o=t.getNode(e);o.data.order=r+n,null===(i=o.data.selfEdges)||void 0===i||i.forEach((e=>{mn(t,"selfedge",{width:e.data.width,height:e.data.height,rank:o.data.rank,order:r+ ++n,e:e},"_se")})),delete o.data.selfEdges}))}))},$r=t=>{t.getAllNodes().forEach((e=>{const n=t.getNode(e.id);if("selfedge"===n.data.dummy){const r=t.getNode(n.data.e.source),i=r.data.x+r.data.width/2,o=r.data.y,a=n.data.x-i,s=r.data.height/2;t.hasEdge(n.data.e.id)?t.updateEdgeData(n.data.e.id,n.data.e.data):t.addEdge({id:n.data.e.id,source:n.data.e.source,target:n.data.e.target,data:n.data.e.data}),t.removeNode(e.id),n.data.e.data.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{y:o,x:i+a},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],n.data.e.data.x=n.data.x,n.data.e.data.y=n.data.y}}))},qr=(t,e)=>{const n={};return null==e||e.forEach((e=>{void 0!==t[e]&&(n[e]=+t[e])})),n},Zr=(t={})=>{const e={};return Object.keys(t).forEach((n=>{e[n.toLowerCase()]=t[n]})),e},Qr=Array.isArray,Jr=t=>{const e=[],n=t.length;for(let r=0;r<n;r+=1){e[r]=[];for(let i=0;i<n;i+=1)r===i?e[r][i]=0:0!==t[r][i]&&t[r][i]?e[r][i]=t[r][i]:e[r][i]=1/0}for(let t=0;t<n;t+=1)for(let r=0;r<n;r+=1)for(let i=0;i<n;i+=1)e[r][i]>e[r][t]+e[t][i]&&(e[r][i]=e[r][t]+e[t][i]);return e},ti=(t,e)=>{const{nodes:n,edges:r}=t,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach(((t,e)=>{o[t.id]=e;i.push([])})),null==r||r.forEach((t=>{const{source:e,target:n}=t,r=o[e],a=o[n];void 0!==r&&void 0!==a&&(i[r][a]=1,i[a][r]=1)})),i},ei=(t,e)=>Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),ni=(t,e,n,r="TB",i,o={})=>{if(!(null==e?void 0:e.length))return;const{stopBranchFn:a,stopAllFn:s}=o;for(let l=0;l<e.length;l++){const u=e[l];if(t.hasNode(u.id)&&!(null==a?void 0:a(u))){if(null==s?void 0:s(u))return;"TB"===r&&n(u),ni(t,t.getChildren(u.id,i),n,r,i,o),"TB"!==r&&n(u)}}},ri=t=>{if(null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){const e=[];return t.forEach((t=>{e.push(t)})),e.map((t=>ri(t)))}if("object"==typeof t){const e={};return Object.keys(t).forEach((n=>{e[n]=ri(t[n])})),e}return t},ii=(t,e)=>{const n=ri(t);return n.data=n.data||{},e&&(I(n.data.x)||(n.data.x=Math.random()*e[0]),I(n.data.y)||(n.data.y=Math.random()*e[1])),n};function oi(t,e){let n;return n=E(e)?e:I(e)?()=>e:()=>t,n}function ai(t,e,n=!0){return e||0===e?E(e)?e:I(e)?()=>e:Array.isArray(e)?()=>{if(n){const n=Math.max(...e);return isNaN(n)?t:n}return e}:M(e)?()=>{if(n){const n=Math.max(e.width,e.height);return isNaN(n)?t:n}return[e.width,e.height]}:()=>t:e=>{const{size:n}=e.data||{};return n?Array.isArray(n)?n[0]>n[1]?n[0]:n[1]:M(n)?n.width>n.height?n.width:n.height:n:t}}const si=(t,e)=>{let n,r;return r=I(e)?()=>e:E(e)?e:()=>0,n=t?Array.isArray(t)?e=>(t[0]>t[1]?t[0]:t[1])+r(e):E(t)?t:e=>t+r(e):t=>{var e,n;if(null===(e=t.data)||void 0===e?void 0:e.bboxSize)return Math.max(t.data.bboxSize[0],t.data.bboxSize[1])+r(t);if(null===(n=t.data)||void 0===n?void 0:n.size){if(Array.isArray(t.data.size))return Math.max(t.data.size[0],t.data.size[1])+r(t);const e=t.data.size;if(M(e)){return(e.width>e.height?e.width:e.height)+r(t)}return e+r(t)}return 10+r(t)},n},li={rankdir:"TB",nodesep:50,ranksep:50,edgeLabelSpace:!0,ranker:"tight-tree",controlPoints:!1,radial:!1,focusNode:null};const ui=(t,e,n,r,i,o,a)=>{let s=(null==t?void 0:t.slice(1,t.length-1))||[];if(e&&n){let{x:t,y:l}=e.data,{x:u,y:c}=n.data;if(i&&(t=e.data.y,l=e.data.x,u=n.data.y,c=n.data.x),c!==l&&t!==u){const h=r.indexOf(l),d=r[h+1];if(d){const t=s[0],e=i?{x:(l+d)/2,y:(null==t?void 0:t.y)||u}:{x:(null==t?void 0:t.x)||u,y:(l+d)/2};t&&!o(t,e)||s.unshift(e)}const f=r.indexOf(c),p=Math.abs(f-h);if(1===p)s=a(s,e.data,n.data),s.length||s.push(i?{x:(l+c)/2,y:t}:{x:t,y:(l+c)/2});else if(p>1){const e=r[f-1];if(e){const n=s[s.length-1],r=i?{x:(c+e)/2,y:(null==n?void 0:n.y)||u}:{x:(null==n?void 0:n.x)||t,y:(c+e)/2};n&&!o(n,r)||s.push(r)}}}}return s},ci=(t,e,n)=>{const r=t.getAllNodes(),i=t.getAllEdges();if(!(null==r?void 0:r.length)){return{nodes:[],edges:i}}if(1===r.length){e&&t.mergeNodeData(r[0].id,{x:n[0],y:n[1]});return{nodes:[Object.assign(Object.assign({},r[0]),{data:Object.assign(Object.assign({},r[0].data),{x:n[0],y:n[1]})})],edges:i}}},hi={radius:null,startRadius:null,endRadius:null,startAngle:0,endAngle:2*Math.PI,clockwise:!0,divisions:1,ordering:null,angleRatio:1};const di=(t,e,n=!1)=>{const r=[ii(e[0])],i={},o=e.length;i[e[0].id]=!0;let a=0;return e.forEach(((s,l)=>{if(0!==l)if(l!==o-1&&t.getDegree(s.id,"both")===t.getDegree(e[l+1].id,"both")&&!t.areNeighbors(r[a].id,s.id)||i[s.id]){const l=n?t.getSuccessors(r[a].id):t.getNeighbors(r[a].id);let u=!1;for(let e=0;e<l.length;e++){const n=l[e];if(t.getDegree(n.id)===t.getDegree(s.id)&&!i[n.id]){r.push(ii(n)),i[n.id]=!0,u=!0;break}}let c=0;for(;!u&&(i[e[c].id]||(r.push(ii(e[c])),i[e[c].id]=!0,u=!0),c++,c!==o););}else r.push(ii(s)),i[s.id]=!0,a++})),r};const fi=(t,e,n)=>{let r=t,i=e,o=n;return r||"undefined"==typeof window||(r=window.innerWidth),i||"undefined"==typeof window||(i=window.innerHeight),o||(o=[r/2,i/2]),[r,i,o]},pi={nodeSize:30,nodeSpacing:10,preventOverlap:!1,sweep:void 0,equidistant:!1,startAngle:1.5*Math.PI,clockwise:!0,maxLevelDiff:void 0,sortBy:"degree"};class gi{constructor(t={}){this.options=t,this.id="concentric",this.options=Object.assign(Object.assign({},pi),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericConcentricLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericConcentricLayout(!0,t,e)}))}genericConcentricLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{center:i,width:o,height:a,sortBy:s,maxLevelDiff:l,sweep:u,clockwise:c,equidistant:h,preventOverlap:d,startAngle:f=1.5*Math.PI,nodeSize:p,nodeSpacing:g}=r,v=e.getAllNodes(),m=e.getAllEdges(),y=o||"undefined"==typeof window?o:window.innerWidth,_=a||"undefined"==typeof window?a:window.innerHeight,b=i||[y/2,_/2];if(!(null==v?void 0:v.length)||1===v.length)return ci(e,t,b);const x=[];let S,A=0;Qr(p)?S=Math.max(p[0],p[1]):E(p)?(S=-1/0,v.forEach((t=>{const e=p(t);e>S&&(S=e)}))):S=p,Qr(g)?A=Math.max(g[0],g[1]):I(g)&&(A=g),v.forEach((t=>{const e=ii(t);x.push(e);let n=S;const{data:r}=e;Qr(r.size)?n=Math.max(r.size[0],r.size[1]):I(r.size)?n=r.size:M(r.size)&&(n=Math.max(r.size.width,r.size.height)),S=Math.max(S,n),E(g)&&(A=Math.max(g(t),A))}));const R={};x.forEach(((t,e)=>{R[t.id]=e}));let T=s;N(T)&&void 0!==x[0].data[T]||(T="degree"),"degree"===T?x.sort(((t,n)=>e.getDegree(n.id,"both")-e.getDegree(t.id,"both"))):x.sort(((t,e)=>e.data[T]-t.data[T]));const w=x[0],P=(l||("degree"===T?e.getDegree(w.id,"both"):w.data[T]))/4,C=[{nodes:[]}];let O=C[0];x.forEach((t=>{if(O.nodes.length>0){const n="degree"===T?Math.abs(e.getDegree(O.nodes[0].id,"both")-e.getDegree(t.id,"both")):Math.abs(O.nodes[0].data[T]-t.data[T]);P&&n>=P&&(O={nodes:[]},C.push(O))}O.nodes.push(t)}));let L=S+A;if(!d){const t=C.length>0&&C[0].nodes.length>1,e=(Math.min(y,_)/2-L)/(C.length+(t?1:0));L=Math.min(L,e)}let D=0;if(C.forEach((t=>{const e=void 0===u?2*Math.PI-2*Math.PI/t.nodes.length:u;if(t.dTheta=e/Math.max(1,t.nodes.length-1),t.nodes.length>1&&d){const e=Math.cos(t.dTheta)-Math.cos(0),n=Math.sin(t.dTheta)-Math.sin(0),r=Math.sqrt(L*L/(e*e+n*n));D=Math.max(r,D)}t.r=D,D+=L})),h){let t=0,e=0;for(let n=0;n<C.length;n++){const r=(C[n].r||0)-e;t=Math.max(t,r)}e=0,C.forEach(((n,r)=>{0===r&&(e=n.r||0),n.r=e,e+=t}))}C.forEach((t=>{const e=t.dTheta||0,n=t.r||0;t.nodes.forEach(((t,r)=>{const i=f+(c?1:-1)*e*r;t.data.x=b[0]+n*Math.cos(i),t.data.y=b[1]+n*Math.sin(i)}))})),t&&x.forEach((t=>e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})));return{nodes:x,edges:m}}))}}function vi(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,l,u,c,h,d,f=t._root,p={data:r},g=t._x0,v=t._y0,m=t._x1,y=t._y1;if(!f)return t._root=p,t;for(;f.length;)if((u=e>=(o=(g+m)/2))?g=o:m=o,(c=n>=(a=(v+y)/2))?v=a:y=a,i=f,!(f=f[h=c<<1|u]))return i[h]=p,t;if(s=+t._x.call(null,f.data),l=+t._y.call(null,f.data),e===s&&n===l)return p.next=f,i?i[h]=p:t._root=p,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(u=e>=(o=(g+m)/2))?g=o:m=o,(c=n>=(a=(v+y)/2))?v=a:y=a}while((h=c<<1|u)==(d=(l>=a)<<1|s>=o));return i[d]=f,i[h]=p,t}function mi(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function yi(t){return t[0]}function Ei(t){return t[1]}function _i(t,e,n){var r=new bi(null==e?yi:e,null==n?Ei:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function bi(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function xi(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Si=_i.prototype=bi.prototype;function Mi(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var o,a,s,l,u,c,h,d,f,p,g,v,m=t._root,y={data:i},E=t._x0,_=t._y0,b=t._z0,x=t._x1,S=t._y1,M=t._z1;if(!m)return t._root=y,t;for(;m.length;)if((d=e>=(a=(E+x)/2))?E=a:x=a,(f=n>=(s=(_+S)/2))?_=s:S=s,(p=r>=(l=(b+M)/2))?b=l:M=l,o=m,!(m=m[g=p<<2|f<<1|d]))return o[g]=y,t;if(u=+t._x.call(null,m.data),c=+t._y.call(null,m.data),h=+t._z.call(null,m.data),e===u&&n===c&&r===h)return y.next=m,o?o[g]=y:t._root=y,t;do{o=o?o[g]=new Array(8):t._root=new Array(8),(d=e>=(a=(E+x)/2))?E=a:x=a,(f=n>=(s=(_+S)/2))?_=s:S=s,(p=r>=(l=(b+M)/2))?b=l:M=l}while((g=p<<2|f<<1|d)==(v=(h>=l)<<2|(c>=s)<<1|u>=a));return o[v]=m,o[g]=y,t}function Ai(t,e,n,r,i,o,a){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=o,this.z1=a}function Ri(t){return t[0]}function Ti(t){return t[1]}function wi(t){return t[2]}function Pi(t,e,n,r){var i=new Ni(null==e?Ri:e,null==n?Ti:n,null==r?wi:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function Ni(t,e,n,r,i,o,a,s,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=l,this._root=void 0}function Ci(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Si.copy=function(){var t,e,n=new bi(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=xi(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=xi(e));return n},Si.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return vi(this.cover(e,n),e,n,t)},Si.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),l=1/0,u=1/0,c=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>h&&(h=i));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),n=0;n<o;++n)vi(this,a[n],s[n],t[n]);return this},Si.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=u,u=a,l*=2,s){case 0:i=n+l,o=r+l;break;case 1:n=i-l,o=r+l;break;case 2:i=n+l,r=o-l;break;case 3:n=i-l,r=o-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},Si.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Si.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Si.find=function(t,e,n){var r,i,o,a,s,l,u,c=this._x0,h=this._y0,d=this._x1,f=this._y1,p=[],g=this._root;for(g&&p.push(new mi(g,c,h,d,f)),null==n?n=1/0:(c=t-n,h=e-n,d=t+n,f=e+n,n*=n);l=p.pop();)if(!(!(g=l.node)||(i=l.x0)>d||(o=l.y0)>f||(a=l.x1)<c||(s=l.y1)<h))if(g.length){var v=(i+a)/2,m=(o+s)/2;p.push(new mi(g[3],v,m,a,s),new mi(g[2],i,m,v,s),new mi(g[1],v,o,a,m),new mi(g[0],i,o,v,m)),(u=(e>=m)<<1|t>=v)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var y=t-+this._x.call(null,g.data),E=e-+this._y.call(null,g.data),_=y*y+E*E;if(_<n){var b=Math.sqrt(n=_);c=t-b,h=e-b,d=t+b,f=e+b,r=g.data}}return r},Si.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,l,u,c,h,d,f=this._root,p=this._x0,g=this._y0,v=this._x1,m=this._y1;if(!f)return this;if(f.length)for(;;){if((u=o>=(s=(p+v)/2))?p=s:v=s,(c=a>=(l=(g+m)/2))?g=l:m=l,e=f,!(f=f[h=c<<1|u]))return this;if(!f.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;f.data!==t;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[d]=f:this._root=f),this):(this._root=i,this)},Si.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Si.root=function(){return this._root},Si.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Si.visit=function(t){var e,n,r,i,o,a,s=[],l=this._root;for(l&&s.push(new mi(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&l.length){var u=(r+o)/2,c=(i+a)/2;(n=l[3])&&s.push(new mi(n,u,c,o,a)),(n=l[2])&&s.push(new mi(n,r,c,u,a)),(n=l[1])&&s.push(new mi(n,u,i,o,c)),(n=l[0])&&s.push(new mi(n,r,i,u,c))}return this},Si.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new mi(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.x1,u=e.y1,c=(a+l)/2,h=(s+u)/2;(o=i[0])&&n.push(new mi(o,a,s,c,h)),(o=i[1])&&n.push(new mi(o,c,s,l,h)),(o=i[2])&&n.push(new mi(o,a,h,c,u)),(o=i[3])&&n.push(new mi(o,c,h,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Si.x=function(t){return arguments.length?(this._x=t,this):this._x},Si.y=function(t){return arguments.length?(this._y=t,this):this._y};var Oi=Pi.prototype=Ni.prototype;Oi.copy=function(){var t,e,n=new Ni(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=Ci(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=Ci(e));return n},Oi.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return Mi(this.cover(e,n,r),e,n,r,t)},Oi.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let o=1/0,a=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h,d,f,p,g=0;g<e;++g)isNaN(d=+this._x.call(null,h=t[g]))||isNaN(f=+this._y.call(null,h))||isNaN(p=+this._z.call(null,h))||(n[g]=d,r[g]=f,i[g]=p,d<o&&(o=d),d>l&&(l=d),f<a&&(a=f),f>u&&(u=f),p<s&&(s=p),p>c&&(c=p));if(o>l||a>u||s>c)return this;this.cover(o,a,s).cover(l,u,c);for(let o=0;o<e;++o)Mi(this,n[o],r[o],i[o],t[o]);return this},Oi.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,o=this._z0,a=this._x1,s=this._y1,l=this._z1;if(isNaN(r))a=(r=Math.floor(t))+1,s=(i=Math.floor(e))+1,l=(o=Math.floor(n))+1;else{for(var u,c,h=a-r||1,d=this._root;r>t||t>=a||i>e||e>=s||o>n||n>=l;)switch(c=(n<o)<<2|(e<i)<<1|t<r,(u=new Array(8))[c]=d,d=u,h*=2,c){case 0:a=r+h,s=i+h,l=o+h;break;case 1:r=a-h,s=i+h,l=o+h;break;case 2:a=r+h,i=s-h,l=o+h;break;case 3:r=a-h,i=s-h,l=o+h;break;case 4:a=r+h,s=i+h,o=l-h;break;case 5:r=a-h,s=i+h,o=l-h;break;case 6:a=r+h,i=s-h,o=l-h;break;case 7:r=a-h,i=s-h,o=l-h}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=l,this},Oi.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Oi.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},Oi.find=function(t,e,n,r){var i,o,a,s,l,u,c,h,d,f=this._x0,p=this._y0,g=this._z0,v=this._x1,m=this._y1,y=this._z1,E=[],_=this._root;for(_&&E.push(new Ai(_,f,p,g,v,m,y)),null==r?r=1/0:(f=t-r,p=e-r,g=n-r,v=t+r,m=e+r,y=n+r,r*=r);h=E.pop();)if(!(!(_=h.node)||(o=h.x0)>v||(a=h.y0)>m||(s=h.z0)>y||(l=h.x1)<f||(u=h.y1)<p||(c=h.z1)<g))if(_.length){var b=(o+l)/2,x=(a+u)/2,S=(s+c)/2;E.push(new Ai(_[7],b,x,S,l,u,c),new Ai(_[6],o,x,S,b,u,c),new Ai(_[5],b,a,S,l,x,c),new Ai(_[4],o,a,S,b,x,c),new Ai(_[3],b,x,s,l,u,S),new Ai(_[2],o,x,s,b,u,S),new Ai(_[1],b,a,s,l,x,S),new Ai(_[0],o,a,s,b,x,S)),(d=(n>=S)<<2|(e>=x)<<1|t>=b)&&(h=E[E.length-1],E[E.length-1]=E[E.length-1-d],E[E.length-1-d]=h)}else{var M=t-+this._x.call(null,_.data),A=e-+this._y.call(null,_.data),R=n-+this._z.call(null,_.data),T=M*M+A*A+R*R;if(T<r){var w=Math.sqrt(r=T);f=t-w,p=e-w,g=n-w,v=t+w,m=e+w,y=n+w,i=_.data}}return i},Oi.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t))||isNaN(s=+this._z.call(null,t)))return this;var e,n,r,i,o,a,s,l,u,c,h,d,f,p,g,v=this._root,m=this._x0,y=this._y0,E=this._z0,_=this._x1,b=this._y1,x=this._z1;if(!v)return this;if(v.length)for(;;){if((h=o>=(l=(m+_)/2))?m=l:_=l,(d=a>=(u=(y+b)/2))?y=u:b=u,(f=s>=(c=(E+x)/2))?E=c:x=c,e=v,!(v=v[p=f<<2|d<<1|h]))return this;if(!v.length)break;(e[p+1&7]||e[p+2&7]||e[p+3&7]||e[p+4&7]||e[p+5&7]||e[p+6&7]||e[p+7&7])&&(n=e,g=p)}for(;v.data!==t;)if(r=v,!(v=v.next))return this;return(i=v.next)&&delete v.next,r?(i?r.next=i:delete r.next,this):e?(i?e[p]=i:delete e[p],(v=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&v===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!v.length&&(n?n[g]=v:this._root=v),this):(this._root=i,this)},Oi.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Oi.root=function(){return this._root},Oi.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Oi.visit=function(t){var e,n,r,i,o,a,s,l,u=[],c=this._root;for(c&&u.push(new Ai(c,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=u.pop();)if(!t(c=e.node,r=e.x0,i=e.y0,o=e.z0,a=e.x1,s=e.y1,l=e.z1)&&c.length){var h=(r+a)/2,d=(i+s)/2,f=(o+l)/2;(n=c[7])&&u.push(new Ai(n,h,d,f,a,s,l)),(n=c[6])&&u.push(new Ai(n,r,d,f,h,s,l)),(n=c[5])&&u.push(new Ai(n,h,i,f,a,d,l)),(n=c[4])&&u.push(new Ai(n,r,i,f,h,d,l)),(n=c[3])&&u.push(new Ai(n,h,d,o,a,s,f)),(n=c[2])&&u.push(new Ai(n,r,d,o,h,s,f)),(n=c[1])&&u.push(new Ai(n,h,i,o,a,d,f)),(n=c[0])&&u.push(new Ai(n,r,i,o,h,d,f))}return this},Oi.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ai(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.z0,u=e.x1,c=e.y1,h=e.z1,d=(a+u)/2,f=(s+c)/2,p=(l+h)/2;(o=i[0])&&n.push(new Ai(o,a,s,l,d,f,p)),(o=i[1])&&n.push(new Ai(o,d,s,l,u,f,p)),(o=i[2])&&n.push(new Ai(o,a,f,l,d,c,p)),(o=i[3])&&n.push(new Ai(o,d,f,l,u,c,p)),(o=i[4])&&n.push(new Ai(o,a,s,p,d,f,h)),(o=i[5])&&n.push(new Ai(o,d,s,p,u,f,h)),(o=i[6])&&n.push(new Ai(o,a,f,p,d,c,h)),(o=i[7])&&n.push(new Ai(o,d,f,p,u,c,h))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},Oi.x=function(t){return arguments.length?(this._x=t,this):this._x},Oi.y=function(t){return arguments.length?(this._y=t,this):this._y},Oi.z=function(t){return arguments.length?(this._z=t,this):this._z};function Ii(t,e,n,r,i=2){const o=e/n,a=t.getAllNodes(),s=a.map(((t,e)=>{const{nodeStrength:n,x:r,y:i,z:a,size:s}=t.data;return{x:r,y:i,z:a,size:s,index:e,id:t.id,vx:0,vy:0,vz:0,weight:o*n}})),l=(2===i?_i(s,(t=>t.x),(t=>t.y)):Pi(s,(t=>t.x),(t=>t.y),(t=>t.z))).visitAfter(Li),u=new Map;return s.forEach((t=>{u.set(t.id,t),function(t,e,n){e.visit(((e,r,i,o,a)=>Di(e,r,i,o,a,t,n)))}(t,l,i)})),s.map(((t,e)=>{const{id:n,data:i}=a[e],{mass:o=1}=i;r[n]={x:t.vx/o,y:t.vy/o,z:t.vz/o}})),r}function Li(t){let e=0,n=0,r=0,i=0,o=0;const a=t.length;if(a){for(let s=0;s<a;s++){const a=t[s];a&&a.weight&&(e+=a.weight,n+=a.x*a.weight,r+=a.y*a.weight,i+=a.z*a.weight,o+=a.size*a.weight)}t.x=n/e,t.y=r/e,t.z=i/e,t.size=o/e,t.weight=e}else{const e=t;t.x=e.data.x,t.y=e.data.y,t.z=e.data.z,t.size=e.data.size,t.weight=e.data.weight}}const Di=(t,e,n,r,i,o,a)=>{var s;if((null===(s=t.data)||void 0===s?void 0:s.id)===o.id)return;const l=[n,r,i][a-1],u=o.x-t.x||.1,c=o.y-t.y||.1,h=o.z-t.z||.1,d=[u,c,h],f=l-e;let p=0;for(let t=0;t<a;t++)p+=d[t]*d[t];const g=Math.sqrt(p)*p;if(f*f*.81<p){const e=t.weight/g;return o.vx+=u*e,o.vy+=c*e,o.vz+=h*e,!0}if(t.length)return!1;if(t.data!==o){const e=t.data.weight/g;o.vx+=u*e,o.vy+=c*e,o.vz+=h*e}};const Bi={dimensions:2,maxIteration:500,gravity:10,factor:1,edgeStrength:50,nodeStrength:1e3,coulombDisScale:.005,damping:.9,maxSpeed:200,minMovement:.4,interval:.02,linkDistance:200,clusterNodeStrength:20,preventOverlap:!0,distanceThresholdMode:"mean"};class ki{constructor(t={}){this.options=t,this.id="force",this.timeInterval=0,this.judgingDistance=0,this.running=!1,this.options=Object.assign(Object.assign({},Bi),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericForceLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericForceLayout(!0,t,e)}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval),this.running=!1}tick(t=this.options.maxIteration||1){if(this.lastResult)return this.lastResult;for(let e=0;(this.judgingDistance>this.lastOptions.minMovement||e<1)&&e<t;e++)this.runOneStep(this.lastCalcGraph,this.lastGraph,e,this.lastVelMap,this.lastOptions),this.updatePosition(this.lastGraph,this.lastCalcGraph,this.lastVelMap,this.lastOptions);const e={nodes:this.lastLayoutNodes,edges:this.lastLayoutEdges};return this.lastAssign&&e.nodes.forEach((t=>this.lastGraph.mergeNodeData(t.id,{x:t.data.x,y:t.data.y,z:3===this.options.dimensions?t.data.z:void 0}))),e}genericForceLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),i=e.getAllNodes(),o=e.getAllEdges(),a=this.formatOptions(r,e),{dimensions:s,width:l,height:u,nodeSize:c,getMass:h,nodeStrength:d,edgeStrength:f,linkDistance:p}=a,g=i.map(((t,e)=>Object.assign(Object.assign({},t),{data:Object.assign(Object.assign({},t.data),{x:I(t.data.x)?t.data.x:Math.random()*l,y:I(t.data.y)?t.data.y:Math.random()*u,z:I(t.data.z)?t.data.z:Math.random()*Math.sqrt(l*u),size:c(t)||30,mass:h(t),nodeStrength:d(t)})}))),m=o.map((t=>Object.assign(Object.assign({},t),{data:Object.assign(Object.assign({},t.data),{edgeStrength:f(t),linkDistance:p(t,e.getNode(t.source),e.getNode(t.target))})})));if(!(null==i?void 0:i.length))return this.lastResult={nodes:[],edges:o},{nodes:[],edges:o};const y={};i.forEach(((t,e)=>{y[t.id]={x:0,y:0,z:0}}));const E=new v({nodes:g,edges:m});this.formatCentripetal(a,E);const{maxIteration:_,minMovement:b,onTick:x}=a;if(this.lastLayoutNodes=g,this.lastLayoutEdges=m,this.lastAssign=t,this.lastGraph=e,this.lastCalcGraph=E,this.lastOptions=a,this.lastVelMap=y,"undefined"==typeof window)return;let S=0;return new Promise((n=>{this.timeInterval=window.setInterval((()=>{i&&this.running||n({nodes:Vi(e,g),edges:o}),this.runOneStep(E,e,S,y,a),this.updatePosition(e,E,y,a),t&&g.forEach((t=>e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y,z:3===s?t.data.z:void 0}))),null==x||x({nodes:Vi(e,g),edges:o}),S++,(S>=_||this.judgingDistance<b)&&(window.clearInterval(this.timeInterval),n({nodes:Vi(e,g),edges:o}))}),0),this.running=!0}))}))}formatOptions(t,e){const n=Object.assign({},t),{width:r,height:i,getMass:o,nodeSize:a}=t;n.width=r||"undefined"==typeof window?r:window.innerWidth,n.height=i||"undefined"==typeof window?i:window.innerHeight,t.center||(n.center=[n.width/2,n.height/2]),o||(n.getMass=t=>{let n=1;I(null==t?void 0:t.data.mass)&&(n=null==t?void 0:t.data.mass);const r=e.getDegree(t.id,"both");return!r||r<5?n:5*r*n});const s=oi(0,t.nodeSpacing);let l;l=a?E(a)?t=>a(t)+s(t):Qr(a)?t=>{const e=a;return Math.max(e[0],e[1])+s(t)}:t=>a+s(t):t=>{const{size:e}=(null==t?void 0:t.data)||{};return e?Qr(e)?Math.max(e[0],e[1])+s(t):M(e)?Math.max(e.width,e.height)+s(t):e+s(t):10+s(t)},n.nodeSize=l;const u=t.linkDistance?oi(1,t.linkDistance):t=>1+n.nodeSize(e.getNode(t.source))+n.nodeSize(e.getNode(t.target));return n.linkDistance=u,n.nodeStrength=oi(1,t.nodeStrength),n.edgeStrength=oi(1,t.edgeStrength),n}formatCentripetal(t,e){const{dimensions:n,centripetalOptions:r,center:i,clusterNodeStrength:o,leafCluster:a,clustering:s,nodeClusterBy:l}=t,u=e.getAllNodes(),c=r||{leaf:2,single:2,others:1,center:t=>({x:i[0],y:i[1],z:3===n?i[2]:void 0})};let h,d;if("function"!=typeof o&&(t.clusterNodeStrength=t=>o),a&&l&&(h=Fi(e,l),d=Array.from(new Set(null==u?void 0:u.map((t=>t.data[l]))))||[],t.centripetalOptions=Object.assign(c,{single:100,leaf:e=>{const{siblingLeaves:n,sameTypeLeaves:r}=h[e.id]||{};return(null==r?void 0:r.length)===(null==n?void 0:n.length)||1===(null==d?void 0:d.length)?1:t.clusterNodeStrength(e)},others:1,center:t=>{const n=e.getDegree(t.id,"both");if(!n)return{x:100,y:100,z:0};let r;if(1===n){const{sameTypeLeaves:e=[]}=h[t.id]||{};1===e.length?r=void 0:e.length>1&&(r=zi(e))}else r=void 0;return{x:null==r?void 0:r.x,y:null==r?void 0:r.y,z:null==r?void 0:r.z}}})),s&&l){h||(h=Fi(e,l)),d||(d=Array.from(new Set(u.map((t=>t.data[l]))))),d=d.filter((t=>void 0!==t));const n={};d.forEach((t=>{const r=u.filter((e=>e.data[l]===t)).map((t=>e.getNode(t.id)));n[t]=zi(r)})),t.centripetalOptions=Object.assign(c,{single:e=>t.clusterNodeStrength(e),leaf:e=>t.clusterNodeStrength(e),others:e=>t.clusterNodeStrength(e),center:t=>{const e=n[t.data[l]];return{x:null==e?void 0:e.x,y:null==e?void 0:e.y,z:null==e?void 0:e.z}}})}const{leaf:f,single:p,others:g}=t.centripetalOptions||{};f&&"function"!=typeof f&&(t.centripetalOptions.leaf=()=>f),p&&"function"!=typeof p&&(t.centripetalOptions.single=()=>p),g&&"function"!=typeof g&&(t.centripetalOptions.others=()=>g)}runOneStep(t,e,n,r,i){const o={},a=t.getAllNodes(),s=t.getAllEdges();if(!(null==a?void 0:a.length))return;const{monitor:l}=i;if(this.calRepulsive(t,o,i),s&&this.calAttractive(t,o,i),this.calGravity(t,e,o,i),this.updateVelocity(t,o,r,i),l){l({energy:this.calTotalEnergy(o,a),nodes:e.getAllNodes(),edges:e.getAllEdges(),iterations:n})}}calTotalEnergy(t,e){if(!(null==e?void 0:e.length))return 0;let n=0;return e.forEach(((e,r)=>{const i=t[e.id].x,o=t[e.id].y,a=3===this.options.dimensions?t[e.id].z:0,s=i*i+o*o+a*a,{mass:l=1}=e.data;n+=l*s*.5})),n}calRepulsive(t,e,n){const{dimensions:r,factor:i,coulombDisScale:o}=n;Ii(t,i,o*o,e,r)}calAttractive(t,e,n){const{dimensions:r,nodeSize:i}=n;t.getAllEdges().forEach(((n,o)=>{const{source:a,target:s}=n,l=t.getNode(a),u=t.getNode(s);if(!l||!u)return;let c=u.data.x-l.data.x,h=u.data.y-l.data.y,d=3===r?u.data.z-l.data.z:0;c||h||(c=.01*Math.random(),h=.01*Math.random(),3!==r||d||(d=.01*Math.random()));const f=Math.sqrt(c*c+h*h+d*d);if(f<i(l)+i(u))return;const p=c/f,g=h/f,v=d/f,{linkDistance:m=200,edgeStrength:y=200}=n.data||{},E=(m-f)*y,_=1/(l.data.mass||1),b=1/(u.data.mass||1),x=p*E,S=g*E,M=v*E;e[a].x-=x*_,e[a].y-=S*_,e[a].z-=M*_,e[s].x+=x*b,e[s].y+=S*b,e[s].z+=M*b}))}calGravity(t,e,n,r){const{getCenter:i}=r,o=t.getAllNodes(),a=e.getAllNodes(),s=e.getAllEdges(),{width:l,height:u,center:c,gravity:h,centripetalOptions:d}=r;o&&o.forEach((r=>{const{id:o,data:f}=r,{mass:p,x:g,y:v,z:m}=f,y=e.getNode(o);let E=0,_=0,b=0,x=h;const S=t.getDegree(o,"in"),M=t.getDegree(o,"out"),A=t.getDegree(o,"both"),R=null==i?void 0:i(y,A);if(R){const[t,e,n]=R;E=g-t,_=v-e,x=n}else E=g-c[0],_=v-c[1],b=m-c[2];if(x&&(n[o].x-=x*E/p,n[o].y-=x*_/p,n[o].z-=x*b/p),d){const{leaf:t,single:e,others:r,center:i}=d,{x:c,y:h,z:f,centerStrength:E}=(null==i?void 0:i(y,a,s,l,u))||{x:0,y:0,z:0,centerStrength:0};if(!I(c)||!I(h))return;const _=(g-c)/p,b=(v-h)/p,x=(m-f)/p;if(E&&(n[o].x-=E*_,n[o].y-=E*b,n[o].z-=E*x),0===A){const t=e(y);if(!t)return;return n[o].x-=t*_,n[o].y-=t*b,void(n[o].z-=t*x)}if(0===S||0===M){const e=t(y,a,s);if(!e)return;return n[o].x-=e*_,n[o].y-=e*b,void(n[o].z-=e*x)}const R=r(y);if(!R)return;n[o].x-=R*_,n[o].y-=R*b,n[o].z-=R*x}}))}updateVelocity(t,e,n,r){const{damping:i,maxSpeed:o,interval:a,dimensions:s}=r,l=t.getAllNodes();(null==l?void 0:l.length)&&l.forEach((t=>{const{id:r}=t;let l=(n[r].x+e[r].x*a)*i||.01,u=(n[r].y+e[r].y*a)*i||.01,c=3===s?(n[r].z+e[r].z*a)*i||.01:0;const h=Math.sqrt(l*l+u*u+c*c);if(h>o){const t=o/h;l*=t,u*=t,c*=t}n[r]={x:l,y:u,z:c}}))}updatePosition(t,e,n,r){const{distanceThresholdMode:i,interval:o,dimensions:a}=r,s=e.getAllNodes();if(!(null==s?void 0:s.length))return void(this.judgingDistance=0);let l=0;"max"===i?this.judgingDistance=-1/0:"min"===i&&(this.judgingDistance=1/0),s.forEach((r=>{const{id:s}=r,u=t.getNode(s);if(I(u.data.fx)&&I(u.data.fy))return void e.mergeNodeData(s,{x:u.data.fx,y:u.data.fy,z:3===a?u.data.fz:void 0});const c=n[s].x*o,h=n[s].y*o,d=3===a?n[s].z*o:0;e.mergeNodeData(s,{x:r.data.x+c,y:r.data.y+h,z:r.data.z+d});const f=Math.sqrt(c*c+h*h+d*d);switch(i){case"max":this.judgingDistance<f&&(this.judgingDistance=f);break;case"min":this.judgingDistance>f&&(this.judgingDistance=f);break;default:l+=f}})),i&&"mean"!==i||(this.judgingDistance=l/s.length)}}const Fi=(t,e)=>{const n=t.getAllNodes();if(!(null==n?void 0:n.length))return{};const r={};return n.forEach(((n,i)=>{1===t.getDegree(n.id,"both")&&(r[n.id]=Ui(t,"leaf",n,e))})),r},Ui=(t,e,n,r)=>{const i=t.getDegree(n.id,"in"),o=t.getDegree(n.id,"out");let a=n,s=[];0===i?(a=t.getSuccessors(n.id)[0],s=t.getNeighbors(a.id)):0===o&&(a=t.getPredecessors(n.id)[0],s=t.getNeighbors(a.id)),s=s.filter((e=>0===t.getDegree(e.id,"in")||0===t.getDegree(e.id,"out")));return{coreNode:a,siblingLeaves:s,sameTypeLeaves:Gi(t,e,r,n,s)}},Gi=(t,e,n,r,i)=>{const o=r.data[n]||"";let a=(null==i?void 0:i.filter((t=>t.data[n]===o)))||[];return a=a.filter((e=>0===t.getDegree(e.id,"in")||0===t.getDegree(e.id,"out"))),a},zi=t=>{const e={x:0,y:0};t.forEach((t=>{const{x:n,y:r}=t.data;e.x+=n||0,e.y+=r||0}));const n=t.length||1;return{x:e.x/n,y:e.y/n}},Vi=(t,e)=>e.map((e=>{const{id:n,data:r}=e,i=t.getNode(n);return Object.assign(Object.assign({},i),{data:Object.assign(Object.assign({},i.data),{x:r.x,y:r.y,z:r.z})})}));var Wi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ji(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Hi(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var Xi={};const Yi=Object.prototype.toString;function Ki(t){const e=Yi.call(t);return e.endsWith("Array]")&&!e.includes("Big")}var $i=Hi(Object.freeze({__proto__:null,isAnyArray:Ki}));var qi=Object.freeze({__proto__:null,default:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Ki(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!Ki(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Ki(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,o=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],s=r+1;s<o;s++)t[s]<a&&(a=t[s]);return a}(t),i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Ki(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,o=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],s=r+1;s<o;s++)t[s]>a&&(a=t[s]);return a}(t);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=n.min,a=void 0===o?n.autoMinMax?r:0:o,s=n.max,l=void 0===s?n.autoMinMax?i:1:s;if(a>=l)throw new RangeError("min option must be smaller than max option");for(var u=(l-a)/(i-r),c=0;c<t.length;c++)e[c]=(t[c]-r)*u+a;return e}}),Zi=Hi(qi);Object.defineProperty(Xi,"__esModule",{value:!0});var Qi=$i,Ji=Zi;const to=" ".repeat(2),eo=" ".repeat(4);function no(t,e={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8,padMinus:o="auto"}=e;return`${t.constructor.name} {\n${to}[\n${eo}${function(t,e,n,r,i){const{rows:o,columns:a}=t,s=Math.min(o,e),l=Math.min(a,n),u=[];if("auto"===i){i=!1;t:for(let e=0;e<s;e++)for(let n=0;n<l;n++)if(t.get(e,n)<0){i=!0;break t}}for(let e=0;e<s;e++){let n=[];for(let o=0;o<l;o++)n.push(ro(t.get(e,o),r,i));u.push(`${n.join(" ")}`)}l!==a&&(u[u.length-1]+=` ... ${a-n} more columns`);s!==o&&u.push(`... ${o-e} more rows`);return u.join(`\n${eo}`)}(t,n,r,i,o)}\n${to}]\n${to}rows: ${t.rows}\n${to}columns: ${t.columns}\n}`}function ro(t,e,n){return(t>=0&&n?` ${io(t,e-1)}`:io(t,e)).padEnd(e)}function io(t,e){let n=t.toString();if(n.length<=e)return n;let r=t.toFixed(e);if(r.length>e&&(r=t.toFixed(Math.max(0,e-(r.length-e)))),r.length<=e&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let i=t.toExponential(e);return i.length>e&&(i=t.toExponential(Math.max(0,e-(i.length-e)))),i.slice(0)}function oo(t,e,n){let r=n?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function ao(t,e,n){let r=n?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function so(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function lo(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function uo(t,e){if(!Qi.isAnyArray(e))throw new TypeError("row indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.rows)throw new RangeError("row indices are out of range")}function co(t,e){if(!Qi.isAnyArray(e))throw new TypeError("column indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.columns)throw new RangeError("column indices are out of range")}function ho(t,e,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(po("startRow",e),po("endRow",n),po("startColumn",r),po("endColumn",i),e>n||r>i||e<0||e>=t.rows||n<0||n>=t.rows||r<0||r>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function fo(t,e=0){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function po(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function go(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class vo{static from1DArray(t,e,n){if(t*e!==n.length)throw new RangeError("data length does not match given dimensions");let r=new yo(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++)r.set(i,t,n[i*e+t]);return r}static rowVector(t){let e=new yo(1,t.length);for(let n=0;n<t.length;n++)e.set(0,n,t[n]);return e}static columnVector(t){let e=new yo(t.length,1);for(let n=0;n<t.length;n++)e.set(n,0,t[n]);return e}static zeros(t,e){return new yo(t,e)}static ones(t,e){return new yo(t,e).fill(1)}static rand(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{random:r=Math.random}=n;let i=new yo(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r());return i}static randInt(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{min:r=0,max:i=1e3,random:o=Math.random}=n;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(r>=i)throw new RangeError("min must be smaller than max");let a=i-r,s=new yo(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=r+Math.round(o()*a);s.set(n,t,e)}return s}static eye(t,e,n){void 0===e&&(e=t),void 0===n&&(n=1);let r=Math.min(t,e),i=this.zeros(t,e);for(let t=0;t<r;t++)i.set(t,t,n);return i}static diag(t,e,n){let r=t.length;void 0===e&&(e=r),void 0===n&&(n=e);let i=Math.min(r,e,n),o=this.zeros(e,n);for(let e=0;e<i;e++)o.set(e,e,t[e]);return o}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new yo(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.min(t.get(o,n),e.get(o,n)));return i}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new this(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.max(t.get(o,n),e.get(o,n)));return i}static checkMatrix(t){return vo.isMatrix(t)?t:new yo(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.call(this,e,n);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let n=0;n<this.columns;n++)t[e].push(this.get(e,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(0!==this.get(t,t))return!1;return!0}isEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);t++}return r}isReducedEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);for(let n=e+1;n<this.rows;n++)0!==this.get(t,n)&&(r=!1);t++}return r}echelonForm(){let t=this.clone(),e=0,n=0;for(;e<t.rows&&n<t.columns;){let r=e;for(let i=e;i<t.rows;i++)t.get(i,n)>t.get(r,n)&&(r=i);if(0===t.get(r,n))n++;else{t.swapRows(e,r);let i=t.get(e,n);for(let r=n;r<t.columns;r++)t.set(e,r,t.get(e,r)/i);for(let r=e+1;r<t.rows;r++){let i=t.get(r,n)/t.get(e,n);t.set(r,n,0);for(let o=n+1;o<t.columns;o++)t.set(r,o,t.get(r,o)-t.get(e,o)*i)}e++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,n=t.rows,r=n-1;for(;r>=0;)if(0===t.maxRow(r))r--;else{let i=0,o=!1;for(;i<n&&!1===o;)1===t.get(r,i)?o=!0:i++;for(let n=0;n<r;n++){let o=t.get(n,i);for(let a=i;a<e;a++){let e=t.get(n,a)-o*t.get(r,a);t.set(n,a,e)}}r--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let r=new yo(this.rows*e,this.columns*n);for(let t=0;t<e;t++)for(let e=0;e<n;e++)r.setSubMatrix(this,this.rows*t,this.columns*e);return r}fill(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,t);return this}neg(){return this.mulS(-1)}getRow(t){oo(this,t);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}getRowVector(t){return yo.rowVector(this.getRow(t))}setRow(t,e){oo(this,t),e=so(this,e);for(let n=0;n<this.columns;n++)this.set(t,n,e[n]);return this}swapRows(t,e){oo(this,t),oo(this,e);for(let n=0;n<this.columns;n++){let r=this.get(t,n);this.set(t,n,this.get(e,n)),this.set(e,n,r)}return this}getColumn(t){ao(this,t);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,t));return e}getColumnVector(t){return yo.columnVector(this.getColumn(t))}setColumn(t,e){ao(this,t),e=lo(this,e);for(let n=0;n<this.rows;n++)this.set(n,t,e[n]);return this}swapColumns(t,e){ao(this,t),ao(this,e);for(let n=0;n<this.rows;n++){let r=this.get(n,t);this.set(n,t,this.get(n,e)),this.set(n,e,r)}return this}addRowVector(t){t=so(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[n]);return this}subRowVector(t){t=so(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[n]);return this}mulRowVector(t){t=so(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[n]);return this}divRowVector(t){t=so(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[n]);return this}addColumnVector(t){t=lo(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[e]);return this}subColumnVector(t){t=lo(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[e]);return this}mulColumnVector(t){t=lo(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[e]);return this}divColumnVector(t){t=lo(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[e]);return this}mulRow(t,e){oo(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this}mulColumn(t,e){ao(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){go(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){go(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}maxRow(t){if(oo(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxRowIndex(t){oo(this,t),go(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),n[1]=r);return n}minRow(t){if(oo(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minRowIndex(t){oo(this,t),go(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),n[1]=r);return n}maxColumn(t){if(ao(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t));return e}maxColumnIndex(t){ao(this,t),go(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t),n[0]=r);return n}minColumn(t){if(ao(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t));return e}minColumnIndex(t){ao(this,t),go(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t),n[0]=r);return n}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let n=0;n<t;n++)e.push(this.get(n,n));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n),this.set(e,n,t);return this}dot(t){vo.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}mmul(t){t=yo.checkMatrix(t);let e=this.rows,n=this.columns,r=t.columns,i=new yo(e,r),o=new Float64Array(n);for(let a=0;a<r;a++){for(let e=0;e<n;e++)o[e]=t.get(e,a);for(let t=0;t<e;t++){let e=0;for(let r=0;r<n;r++)e+=this.get(t,r)*o[r];i.set(t,a,e)}}return i}strassen2x2(t){t=yo.checkMatrix(t);let e=new yo(2,2);const n=this.get(0,0),r=t.get(0,0),i=this.get(0,1),o=t.get(0,1),a=this.get(1,0),s=t.get(1,0),l=this.get(1,1),u=t.get(1,1),c=(n+l)*(r+u),h=(a+l)*r,d=n*(o-u),f=l*(s-r),p=(n+i)*u,g=c+f-p+(i-l)*(s+u),v=d+p,m=h+f,y=c-h+d+(a-n)*(r+o);return e.set(0,0,g),e.set(0,1,v),e.set(1,0,m),e.set(1,1,y),e}strassen3x3(t){t=yo.checkMatrix(t);let e=new yo(3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),o=this.get(1,0),a=this.get(1,1),s=this.get(1,2),l=this.get(2,0),u=this.get(2,1),c=this.get(2,2),h=t.get(0,0),d=t.get(0,1),f=t.get(0,2),p=t.get(1,0),g=t.get(1,1),v=t.get(1,2),m=t.get(2,0),y=t.get(2,1),E=t.get(2,2),_=(n-o)*(-d+g),b=(-n+o+a)*(h-d+g),x=(o+a)*(-h+d),S=n*h,M=(-n+l+u)*(h-f+v),A=(-n+l)*(f-v),R=(l+u)*(-h+f),T=(-i+u+c)*(g+m-y),w=(i-c)*(g-y),P=i*m,N=(u+c)*(-m+y),C=(-i+a+s)*(v+m-E),O=(i-s)*(v-E),I=(a+s)*(-m+E),L=S+P+r*p,D=(n+r+i-o-a-u-c)*g+b+x+S+T+P+N,B=S+M+R+(n+r+i-a-s-l-u)*v+P+C+I,k=_+a*(-h+d+p-g-v-m+E)+b+S+P+C+O,F=_+b+x+S+s*y,U=P+C+O+I+o*f,G=S+M+A+u*(-h+f+p-g-v-m+y)+T+w+P,z=T+w+P+N+l*d,V=S+M+A+R+c*E;return e.set(0,0,L),e.set(0,1,D),e.set(0,2,B),e.set(1,0,k),e.set(1,1,F),e.set(1,2,U),e.set(2,0,G),e.set(2,1,z),e.set(2,2,V),e}mmulStrassen(t){t=yo.checkMatrix(t);let e=this.clone(),n=e.rows,r=e.columns,i=t.rows,o=t.columns;function a(t,e,n){let r=t.rows,i=t.columns;if(r===e&&i===n)return t;{let r=vo.zeros(e,n);return r=r.setSubMatrix(t,0,0),r}}r!==i&&console.warn(`Multiplying ${n} x ${r} and ${i} x ${o} matrix: dimensions do not match.`);let s=Math.max(n,i),l=Math.max(r,o);return e=a(e,s,l),function t(e,n,r,i){if(r<=512||i<=512)return e.mmul(n);r%2==1&&i%2==1?(e=a(e,r+1,i+1),n=a(n,r+1,i+1)):r%2==1?(e=a(e,r+1,i),n=a(n,r+1,i)):i%2==1&&(e=a(e,r,i+1),n=a(n,r,i+1));let o=parseInt(e.rows/2,10),s=parseInt(e.columns/2,10),l=e.subMatrix(0,o-1,0,s-1),u=n.subMatrix(0,o-1,0,s-1),c=e.subMatrix(0,o-1,s,e.columns-1),h=n.subMatrix(0,o-1,s,n.columns-1),d=e.subMatrix(o,e.rows-1,0,s-1),f=n.subMatrix(o,n.rows-1,0,s-1),p=e.subMatrix(o,e.rows-1,s,e.columns-1),g=n.subMatrix(o,n.rows-1,s,n.columns-1),v=t(vo.add(l,p),vo.add(u,g),o,s),m=t(vo.add(d,p),u,o,s),y=t(l,vo.sub(h,g),o,s),E=t(p,vo.sub(f,u),o,s),_=t(vo.add(l,c),g,o,s),b=t(vo.sub(d,l),vo.add(u,h),o,s),x=t(vo.sub(c,p),vo.add(f,g),o,s),S=vo.add(v,E);S.sub(_),S.add(x);let M=vo.add(y,_),A=vo.add(m,E),R=vo.sub(v,m);R.add(y),R.add(b);let T=vo.zeros(2*S.rows,2*S.columns);return T=T.setSubMatrix(S,0,0),T=T.setSubMatrix(M,S.rows,0),T=T.setSubMatrix(A,0,S.columns),T=T.setSubMatrix(R,S.rows,S.columns),T.subMatrix(0,r-1,0,i-1)}(e,t=a(t,s,l),s,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new yo(this.rows,this.columns);for(let t=0;t<this.rows;t++){const i=this.getRow(t);i.length>0&&Ji(i,{min:e,max:n,output:i}),r.setRow(t,i)}return r}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new yo(this.rows,this.columns);for(let t=0;t<this.columns;t++){const i=this.getColumn(t);i.length&&Ji(i,{min:e,max:n,output:i}),r.setColumn(t,i)}return r}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<t;n++){let t=this.get(e,n),r=this.get(e,this.columns-1-n);this.set(e,n,r),this.set(e,this.columns-1-n,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<t;n++){let t=this.get(n,e),r=this.get(this.rows-1-n,e);this.set(n,e,r),this.set(this.rows-1-n,e,t)}return this}kroneckerProduct(t){t=yo.checkMatrix(t);let e=this.rows,n=this.columns,r=t.rows,i=t.columns,o=new yo(e*r,n*i);for(let a=0;a<e;a++)for(let e=0;e<n;e++)for(let n=0;n<r;n++)for(let s=0;s<i;s++)o.set(r*a+n,i*e+s,this.get(a,e)*t.get(n,s));return o}kroneckerSum(t){if(t=yo.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=t.rows,r=this.kroneckerProduct(yo.eye(n,n)),i=yo.eye(e,e).kroneckerProduct(t);return r.add(i)}transpose(){let t=new yo(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(n,e,this.get(e,n));return t}sortRows(t=mo){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=mo){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,n,r){ho(this,t,e,n,r);let i=new yo(e-t+1,r-n+1);for(let o=t;o<=e;o++)for(let e=n;e<=r;e++)i.set(o-t,e-n,this.get(o,e));return i}subMatrixRow(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let r=new yo(t.length,n-e+1);for(let i=0;i<t.length;i++)for(let o=e;o<=n;o++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);r.set(i,o-e,this.get(t[i],o))}return r}subMatrixColumn(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let r=new yo(n-e+1,t.length);for(let i=0;i<t.length;i++)for(let o=e;o<=n;o++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);r.set(o-e,i,this.get(o,t[i]))}return r}setSubMatrix(t,e,n){if((t=yo.checkMatrix(t)).isEmpty())return this;ho(this,e,e+t.rows-1,n,n+t.columns-1);for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)this.set(e+r,n+i,t.get(r,i));return this}selection(t,e){uo(this,t),co(this,e);let n=new yo(t.length,e.length);for(let r=0;r<t.length;r++){let i=t[r];for(let t=0;t<e.length;t++){let o=e[t];n.set(r,t,this.get(i,o))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let n=0;n<t;n++)e+=this.get(n,n);return e}clone(){return this.constructor.copy(this,new yo(this.rows,this.columns))}static copy(t,e){for(const[n,r,i]of t.entries())e.set(n,r,i);return e}sum(t){switch(t){case"row":return function(t){let e=fo(t.rows);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]+=t.get(n,r);return e}(this);case"column":return function(t){let e=fo(t.columns);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]+=t.get(n,r);return e}(this);case void 0:return function(t){let e=0;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e+=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=fo(t.rows,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]*=t.get(n,r);return e}(this);case"column":return function(t){let e=fo(t.columns,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]*=t.get(n,r);return e}(this);case void 0:return function(t){let e=1;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e*=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:n=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof n)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Qi.isAnyArray(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,o=[];for(let a=0;a<r;a++){let r=0,s=0,l=0;for(let e=0;e<i;e++)l=t.get(a,e)-n[a],r+=l,s+=l*l;e?o.push((s-r*r/i)/(i-1)):o.push((s-r*r/i)/i)}return o}(this,n,r);case"column":if(!Qi.isAnyArray(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,o=[];for(let a=0;a<i;a++){let i=0,s=0,l=0;for(let e=0;e<r;e++)l=t.get(e,a)-n[a],i+=l,s+=l*l;e?o.push((s-i*i/r)/(r-1)):o.push((s-i*i/r)/r)}return o}(this,n,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,n){const r=t.rows,i=t.columns,o=r*i;let a=0,s=0,l=0;for(let e=0;e<r;e++)for(let r=0;r<i;r++)l=t.get(e,r)-n,a+=l,s+=l*l;return e?(s-a*a/o)/(o-1):(s-a*a/o)/o}(this,n,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const n=this.variance(t,e);if(void 0===t)return Math.sqrt(n);for(let t=0;t<n.length;t++)n[t]=Math.sqrt(n[t]);return n}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:n=this.mean(t)}=e;switch(t){case"row":if(!Qi.isAnyArray(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[n])}(this,n),this;case"column":if(!Qi.isAnyArray(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[r])}(this,n),this;case void 0:if("number"!=typeof n)throw new TypeError("center must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let n=e.scale;switch(t){case"row":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.rows;n++){let r=0;for(let e=0;e<t.columns;e++)r+=Math.pow(t.get(n,e),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}(this);else if(!Qi.isAnyArray(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[n])}(this,n),this;case"column":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.columns;n++){let r=0;for(let e=0;e<t.rows;e++)r+=Math.pow(t.get(e,n),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}(this);else if(!Qi.isAnyArray(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[r])}(this,n),this;case void 0:if(void 0===n)n=function(t){const e=t.size-1;let n=0;for(let r=0;r<t.columns;r++)for(let i=0;i<t.rows;i++)n+=Math.pow(t.get(i,r),2)/e;return Math.sqrt(n)}(this);else if("number"!=typeof n)throw new TypeError("scale must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return no(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}}function mo(t,e){return t-e}vo.prototype.klass="Matrix","undefined"!=typeof Symbol&&(vo.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return no(this)}),vo.random=vo.rand,vo.randomInt=vo.randInt,vo.diagonal=vo.diag,vo.prototype.diagonal=vo.prototype.diag,vo.identity=vo.eye,vo.prototype.negate=vo.prototype.neg,vo.prototype.tensorProduct=vo.prototype.kroneckerProduct;let yo=class t extends vo{data;#t(t,e){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let n=0;n<t;n++)this.data.push(new Float64Array(e));this.rows=t,this.columns=e}constructor(e,n){if(super(),t.isMatrix(e))this.#t(e.rows,e.columns),t.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#t(e,n);else{if(!Qi.isAnyArray(e))throw new TypeError("First argument must be a positive number or an array");{const t=e;if("number"!=typeof(n=(e=t.length)?t[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<e;r++){if(t[r].length!==n)throw new RangeError("Inconsistent array dimensions");if(!t[r].every((t=>"number"==typeof t)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[r]))}this.rows=e,this.columns=n}}}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}removeRow(t){return oo(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),oo(this,t,!0),e=Float64Array.from(so(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){ao(this,t);for(let e=0;e<this.rows;e++){const n=new Float64Array(this.columns-1);for(let r=0;r<t;r++)n[r]=this.data[e][r];for(let r=t+1;r<this.columns;r++)n[r-1]=this.data[e][r];this.data[e]=n}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),ao(this,t,!0),e=lo(this,e);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns+1);let i=0;for(;i<t;i++)r[i]=this.data[n][i];for(r[i++]=e[n];i<this.columns+1;i++)r[i]=this.data[n][i-1];this.data[n]=r}return this.columns+=1,this}};!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t.get(e,n));return this},t.add=function(t,n){return new e(t).add(n)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t.get(e,n));return this},t.sub=function(t,n){return new e(t).sub(n)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t.get(e,n));return this},t.mul=function(t,n){return new e(t).mul(n)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t.get(e,n));return this},t.div=function(t,n){return new e(t).div(n)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t.get(e,n));return this},t.mod=function(t,n){return new e(t).mod(n)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t.get(e,n));return this},t.and=function(t,n){return new e(t).and(n)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t.get(e,n));return this},t.or=function(t,n){return new e(t).or(n)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t.get(e,n));return this},t.xor=function(t,n){return new e(t).xor(n)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t.get(e,n));return this},t.leftShift=function(t,n){return new e(t).leftShift(n)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t.get(e,n));return this},t.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t.get(e,n));return this},t.rightShift=function(t,n){return new e(t).rightShift(n)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,n){return new e(t).pow(n)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t.get(e,n)));return this}}(vo,yo);class Eo extends vo{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return yo.isMatrix(t)&&"SymmetricMatrix"===t.klassType}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),yo.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");this.#e=yo.copy(t,new yo(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#e=new yo(t,t);else if(this.#e=new yo(t),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const t=new Eo(this.diagonalSize);for(const[e,n,r]of this.upperRightEntries())t.set(e,n,r);return t}toMatrix(){return new yo(this)}get(t,e){return this.#e.get(t,e)}set(t,e,n){return this.#e.set(t,e,n),this.#e.set(e,t,n),this}removeCross(t){return this.#e.removeRow(t),this.#e.removeColumn(t),this}addCross(t,e){void 0===e&&(e=t,t=this.diagonalSize);const n=e.slice();return n.splice(t,1),this.#e.addRow(t,n),this.#e.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[n,r]of t.entries())r||e.push(n);e.reverse();for(const t of e)this.removeCross(t);return this}toCompact(){const{diagonalSize:t}=this,e=new Array(t*(t+1)/2);for(let n=0,r=0,i=0;i<e.length;i++)e[i]=this.get(r,n),++n>=t&&(n=++r);return e}static fromCompact(t){const e=t.length,n=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const r=new Eo(n);for(let i=0,o=0,a=0;a<e;a++)r.set(i,o,t[a]),++i>=n&&(i=++o);return r}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;void 0){const n=this.get(t,e);yield[t,e,n],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;void 0){const n=this.get(t,e);yield n,++e>=this.diagonalSize&&(e=++t)}}}Eo.prototype.klassType="SymmetricMatrix";class _o extends Eo{static isDistanceMatrix(t){return Eo.isSymmetricMatrix(t)&&"DistanceMatrix"===t.klassSubType}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,n){return t===e&&(n=0),super.set(t,e,n)}addCross(t,e){return void 0===e&&(e=t,t=this.diagonalSize),(e=e.slice())[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new Eo(this)}clone(){const t=new _o(this.diagonalSize);for(const[e,n,r]of this.upperRightEntries())e!==n&&t.set(e,n,r);return t}toCompact(){const{diagonalSize:t}=this,e=new Array((t-1)*t/2);for(let n=1,r=0,i=0;i<e.length;i++)e[i]=this.get(r,n),++n>=t&&(n=1+ ++r);return e}static fromCompact(t){const e=t.length,n=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const r=new this(n);for(let i=1,o=0,a=0;a<e;a++)r.set(i,o,t[a]),++i>=n&&(i=1+ ++o);return r}}_o.prototype.klassSubType="DistanceMatrix";class bo extends vo{constructor(t,e,n){super(),this.matrix=t,this.rows=e,this.columns=n}}class xo extends bo{constructor(t,e,n){uo(t,e),co(t,n),super(t,e.length,n.length),this.rowIndices=e,this.columnIndices=n}set(t,e,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],n),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class So extends vo{constructor(t,e={}){const{rows:n=1}=e;if(t.length%n!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,e,n){let r=this._calculateIndex(t,e);return this.data[r]=n,this}get(t,e){let n=this._calculateIndex(t,e);return this.data[n]}_calculateIndex(t,e){return t*this.columns+e}}class Mo extends vo{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}}class Ao{constructor(t){let e,n,r,i,o,a,s,l,u,c=(t=Mo.checkMatrix(t)).clone(),h=c.rows,d=c.columns,f=new Float64Array(h),p=1;for(e=0;e<h;e++)f[e]=e;for(l=new Float64Array(h),n=0;n<d;n++){for(e=0;e<h;e++)l[e]=c.get(e,n);for(e=0;e<h;e++){for(u=Math.min(e,n),o=0,r=0;r<u;r++)o+=c.get(e,r)*l[r];l[e]-=o,c.set(e,n,l[e])}for(i=n,e=n+1;e<h;e++)Math.abs(l[e])>Math.abs(l[i])&&(i=e);if(i!==n){for(r=0;r<d;r++)a=c.get(i,r),c.set(i,r,c.get(n,r)),c.set(n,r,a);s=f[i],f[i]=f[n],f[n]=s,p=-p}if(n<h&&0!==c.get(n,n))for(e=n+1;e<h;e++)c.set(e,n,c.get(e,n)/c.get(n,n))}this.LU=c,this.pivotVector=f,this.pivotSign=p}isSingular(){let t=this.LU,e=t.columns;for(let n=0;n<e;n++)if(0===t.get(n,n))return!0;return!1}solve(t){t=yo.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n,r,i,o=t.columns,a=t.subMatrixRow(this.pivotVector,0,o-1),s=e.columns;for(i=0;i<s;i++)for(n=i+1;n<s;n++)for(r=0;r<o;r++)a.set(n,r,a.get(n,r)-a.get(i,r)*e.get(n,i));for(i=s-1;i>=0;i--){for(r=0;r<o;r++)a.set(i,r,a.get(i,r)/e.get(i,i));for(n=0;n<i;n++)for(r=0;r<o;r++)a.set(n,r,a.get(n,r)-a.get(i,r)*e.get(n,i))}return a}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,n=t.columns;for(let r=0;r<n;r++)e*=t.get(r,r);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new yo(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i>e?r.set(i,e,t.get(i,e)):i===e?r.set(i,e,1):r.set(i,e,0);return r}get upperTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new yo(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i<=e?r.set(i,e,t.get(i,e)):r.set(i,e,0);return r}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Ro(t,e){let n=0;return Math.abs(t)>Math.abs(e)?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0!==e?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0}class To{constructor(t){let e,n,r,i,o=(t=Mo.checkMatrix(t)).clone(),a=t.rows,s=t.columns,l=new Float64Array(s);for(r=0;r<s;r++){let t=0;for(e=r;e<a;e++)t=Ro(t,o.get(e,r));if(0!==t){for(o.get(r,r)<0&&(t=-t),e=r;e<a;e++)o.set(e,r,o.get(e,r)/t);for(o.set(r,r,o.get(r,r)+1),n=r+1;n<s;n++){for(i=0,e=r;e<a;e++)i+=o.get(e,r)*o.get(e,n);for(i=-i/o.get(r,r),e=r;e<a;e++)o.set(e,n,o.get(e,n)+i*o.get(e,r))}}l[r]=-t}this.QR=o,this.Rdiag=l}solve(t){t=yo.checkMatrix(t);let e=this.QR,n=e.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let r,i,o,a,s=t.columns,l=t.clone(),u=e.columns;for(o=0;o<u;o++)for(i=0;i<s;i++){for(a=0,r=o;r<n;r++)a+=e.get(r,o)*l.get(r,i);for(a=-a/e.get(o,o),r=o;r<n;r++)l.set(r,i,l.get(r,i)+a*e.get(r,o))}for(o=u-1;o>=0;o--){for(i=0;i<s;i++)l.set(o,i,l.get(o,i)/this.Rdiag[o]);for(r=0;r<o;r++)for(i=0;i<s;i++)l.set(r,i,l.get(r,i)-l.get(o,i)*e.get(r,o))}return l.subMatrix(0,u-1,0,s-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,n=this.QR,r=n.columns,i=new yo(r,r);for(t=0;t<r;t++)for(e=0;e<r;e++)t<e?i.set(t,e,n.get(t,e)):t===e?i.set(t,e,this.Rdiag[t]):i.set(t,e,0);return i}get orthogonalMatrix(){let t,e,n,r,i=this.QR,o=i.rows,a=i.columns,s=new yo(o,a);for(n=a-1;n>=0;n--){for(t=0;t<o;t++)s.set(t,n,0);for(s.set(n,n,1),e=n;e<a;e++)if(0!==i.get(n,n)){for(r=0,t=n;t<o;t++)r+=i.get(t,n)*s.get(t,e);for(r=-r/i.get(n,n),t=n;t<o;t++)s.set(t,e,s.get(t,e)+r*i.get(t,n))}}return s}}let wo=class{constructor(t,e={}){if((t=Mo.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,r=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:a=!1}=e;let s,l=Boolean(i),u=Boolean(o),c=!1;if(n<r)if(a){s=t.transpose(),n=s.rows,r=s.columns,c=!0;let e=l;l=u,u=e}else s=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else s=t.clone();let h=Math.min(n,r),d=Math.min(n+1,r),f=new Float64Array(d),p=new yo(n,h),g=new yo(r,r),v=new Float64Array(r),m=new Float64Array(n),y=new Float64Array(d);for(let t=0;t<d;t++)y[t]=t;let E=Math.min(n-1,r),_=Math.max(0,Math.min(r-2,n)),b=Math.max(E,_);for(let t=0;t<b;t++){if(t<E){f[t]=0;for(let e=t;e<n;e++)f[t]=Ro(f[t],s.get(e,t));if(0!==f[t]){s.get(t,t)<0&&(f[t]=-f[t]);for(let e=t;e<n;e++)s.set(e,t,s.get(e,t)/f[t]);s.set(t,t,s.get(t,t)+1)}f[t]=-f[t]}for(let e=t+1;e<r;e++){if(t<E&&0!==f[t]){let r=0;for(let i=t;i<n;i++)r+=s.get(i,t)*s.get(i,e);r=-r/s.get(t,t);for(let i=t;i<n;i++)s.set(i,e,s.get(i,e)+r*s.get(i,t))}v[e]=s.get(t,e)}if(l&&t<E)for(let e=t;e<n;e++)p.set(e,t,s.get(e,t));if(t<_){v[t]=0;for(let e=t+1;e<r;e++)v[t]=Ro(v[t],v[e]);if(0!==v[t]){v[t+1]<0&&(v[t]=0-v[t]);for(let e=t+1;e<r;e++)v[e]/=v[t];v[t+1]+=1}if(v[t]=-v[t],t+1<n&&0!==v[t]){for(let e=t+1;e<n;e++)m[e]=0;for(let e=t+1;e<n;e++)for(let n=t+1;n<r;n++)m[e]+=v[n]*s.get(e,n);for(let e=t+1;e<r;e++){let r=-v[e]/v[t+1];for(let i=t+1;i<n;i++)s.set(i,e,s.get(i,e)+r*m[i])}}if(u)for(let e=t+1;e<r;e++)g.set(e,t,v[e])}}let x=Math.min(r,n+1);if(E<r&&(f[E]=s.get(E,E)),n<x&&(f[x-1]=0),_+1<x&&(v[_]=s.get(_,x-1)),v[x-1]=0,l){for(let t=E;t<h;t++){for(let e=0;e<n;e++)p.set(e,t,0);p.set(t,t,1)}for(let t=E-1;t>=0;t--)if(0!==f[t]){for(let e=t+1;e<h;e++){let r=0;for(let i=t;i<n;i++)r+=p.get(i,t)*p.get(i,e);r=-r/p.get(t,t);for(let i=t;i<n;i++)p.set(i,e,p.get(i,e)+r*p.get(i,t))}for(let e=t;e<n;e++)p.set(e,t,-p.get(e,t));p.set(t,t,1+p.get(t,t));for(let e=0;e<t-1;e++)p.set(e,t,0)}else{for(let e=0;e<n;e++)p.set(e,t,0);p.set(t,t,1)}}if(u)for(let t=r-1;t>=0;t--){if(t<_&&0!==v[t])for(let e=t+1;e<r;e++){let n=0;for(let i=t+1;i<r;i++)n+=g.get(i,t)*g.get(i,e);n=-n/g.get(t+1,t);for(let i=t+1;i<r;i++)g.set(i,e,g.get(i,e)+n*g.get(i,t))}for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}let S=x-1,M=Number.EPSILON;for(;x>0;){let t,e;for(t=x-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+M*Math.abs(f[t]+Math.abs(f[t+1]));if(Math.abs(v[t])<=e||Number.isNaN(v[t])){v[t]=0;break}}if(t===x-2)e=4;else{let n;for(n=x-1;n>=t&&n!==t;n--){let e=(n!==x?Math.abs(v[n]):0)+(n!==t+1?Math.abs(v[n-1]):0);if(Math.abs(f[n])<=M*e){f[n]=0;break}}n===t?e=3:n===x-1?e=1:(e=2,t=n)}switch(t++,e){case 1:{let e=v[x-2];v[x-2]=0;for(let n=x-2;n>=t;n--){let i=Ro(f[n],e),o=f[n]/i,a=e/i;if(f[n]=i,n!==t&&(e=-a*v[n-1],v[n-1]=o*v[n-1]),u)for(let t=0;t<r;t++)i=o*g.get(t,n)+a*g.get(t,x-1),g.set(t,x-1,-a*g.get(t,n)+o*g.get(t,x-1)),g.set(t,n,i)}break}case 2:{let e=v[t-1];v[t-1]=0;for(let r=t;r<x;r++){let i=Ro(f[r],e),o=f[r]/i,a=e/i;if(f[r]=i,e=-a*v[r],v[r]=o*v[r],l)for(let e=0;e<n;e++)i=o*p.get(e,r)+a*p.get(e,t-1),p.set(e,t-1,-a*p.get(e,r)+o*p.get(e,t-1)),p.set(e,r,i)}break}case 3:{const e=Math.max(Math.abs(f[x-1]),Math.abs(f[x-2]),Math.abs(v[x-2]),Math.abs(f[t]),Math.abs(v[t])),i=f[x-1]/e,o=f[x-2]/e,a=v[x-2]/e,s=f[t]/e,c=v[t]/e,h=((o+i)*(o-i)+a*a)/2,d=i*a*(i*a);let m=0;0===h&&0===d||(m=h<0?0-Math.sqrt(h*h+d):Math.sqrt(h*h+d),m=d/(h+m));let y=(s+i)*(s-i)+m,E=s*c;for(let e=t;e<x-1;e++){let i=Ro(y,E);0===i&&(i=Number.MIN_VALUE);let o=y/i,a=E/i;if(e!==t&&(v[e-1]=i),y=o*f[e]+a*v[e],v[e]=o*v[e]-a*f[e],E=a*f[e+1],f[e+1]=o*f[e+1],u)for(let t=0;t<r;t++)i=o*g.get(t,e)+a*g.get(t,e+1),g.set(t,e+1,-a*g.get(t,e)+o*g.get(t,e+1)),g.set(t,e,i);if(i=Ro(y,E),0===i&&(i=Number.MIN_VALUE),o=y/i,a=E/i,f[e]=i,y=o*v[e]+a*f[e+1],f[e+1]=-a*v[e]+o*f[e+1],E=a*v[e+1],v[e+1]=o*v[e+1],l&&e<n-1)for(let t=0;t<n;t++)i=o*p.get(t,e)+a*p.get(t,e+1),p.set(t,e+1,-a*p.get(t,e)+o*p.get(t,e+1)),p.set(t,e,i)}v[x-2]=y;break}case 4:if(f[t]<=0&&(f[t]=f[t]<0?-f[t]:0,u))for(let e=0;e<=S;e++)g.set(e,t,-g.get(e,t));for(;t<S&&!(f[t]>=f[t+1]);){let e=f[t];if(f[t]=f[t+1],f[t+1]=e,u&&t<r-1)for(let n=0;n<r;n++)e=g.get(n,t+1),g.set(n,t+1,g.get(n,t)),g.set(n,t,e);if(l&&t<n-1)for(let r=0;r<n;r++)e=p.get(r,t+1),p.set(r,t+1,p.get(r,t)),p.set(r,t,e);t++}x--}}if(c){let t=g;g=p,p=t}this.m=n,this.n=r,this.s=f,this.U=p,this.V=g}solve(t){let e=t,n=this.threshold,r=this.s.length,i=yo.zeros(r,r);for(let t=0;t<r;t++)Math.abs(this.s[t])<=n?i.set(t,t,0):i.set(t,t,1/this.s[t]);let o=this.U,a=this.rightSingularVectors,s=a.mmul(i),l=a.rows,u=o.rows,c=yo.zeros(l,u);for(let t=0;t<l;t++)for(let e=0;e<u;e++){let n=0;for(let i=0;i<r;i++)n+=s.get(t,i)*o.get(e,i);c.set(t,e,n)}return c.mmul(e)}solveForDiagonal(t){return this.solve(yo.diag(t))}inverse(){let t=this.V,e=this.threshold,n=t.rows,r=t.columns,i=new yo(n,this.s.length);for(let o=0;o<n;o++)for(let n=0;n<r;n++)Math.abs(this.s[n])>e&&i.set(o,n,t.get(o,n)/this.s[n]);let o=this.U,a=o.rows,s=o.columns,l=new yo(n,a);for(let t=0;t<n;t++)for(let e=0;e<a;e++){let n=0;for(let r=0;r<s;r++)n+=i.get(t,r)*o.get(e,r);l.set(t,e,n)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let r=0,i=n.length;r<i;r++)n[r]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return yo.diag(this.s)}};function Po(t,e,n=!1){return t=Mo.checkMatrix(t),e=Mo.checkMatrix(e),n?new wo(t).solve(e):t.isSquare()?new Ao(t).solve(e):new To(t).solve(e)}function No(t,e){let n=[];for(let r=0;r<t;r++)r!==e&&n.push(r);return n}function Co(t,e,n,r=1e-9,i=1e-9){if(t>i)return new Array(e.rows+1).fill(0);{let t=e.addRow(n,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<r&&t.set(e,0,0);return t.to1DArray()}}class Oo{constructor(t,e={}){const{assumeSymmetric:n=!1}=e;if(!(t=Mo.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let r,i,o=t.columns,a=new yo(o,o),s=new Float64Array(o),l=new Float64Array(o),u=t,c=!1;if(c=!!n||t.isSymmetric(),c){for(r=0;r<o;r++)for(i=0;i<o;i++)a.set(r,i,u.get(r,i));!function(t,e,n,r){let i,o,a,s,l,u,c,h;for(l=0;l<t;l++)n[l]=r.get(t-1,l);for(s=t-1;s>0;s--){for(h=0,a=0,u=0;u<s;u++)h+=Math.abs(n[u]);if(0===h)for(e[s]=n[s-1],l=0;l<s;l++)n[l]=r.get(s-1,l),r.set(s,l,0),r.set(l,s,0);else{for(u=0;u<s;u++)n[u]/=h,a+=n[u]*n[u];for(i=n[s-1],o=Math.sqrt(a),i>0&&(o=-o),e[s]=h*o,a-=i*o,n[s-1]=i-o,l=0;l<s;l++)e[l]=0;for(l=0;l<s;l++){for(i=n[l],r.set(l,s,i),o=e[l]+r.get(l,l)*i,u=l+1;u<=s-1;u++)o+=r.get(u,l)*n[u],e[u]+=r.get(u,l)*i;e[l]=o}for(i=0,l=0;l<s;l++)e[l]/=a,i+=e[l]*n[l];for(c=i/(a+a),l=0;l<s;l++)e[l]-=c*n[l];for(l=0;l<s;l++){for(i=n[l],o=e[l],u=l;u<=s-1;u++)r.set(u,l,r.get(u,l)-(i*e[u]+o*n[u]));n[l]=r.get(s-1,l),r.set(s,l,0)}}n[s]=a}for(s=0;s<t-1;s++){if(r.set(t-1,s,r.get(s,s)),r.set(s,s,1),a=n[s+1],0!==a){for(u=0;u<=s;u++)n[u]=r.get(u,s+1)/a;for(l=0;l<=s;l++){for(o=0,u=0;u<=s;u++)o+=r.get(u,s+1)*r.get(u,l);for(u=0;u<=s;u++)r.set(u,l,r.get(u,l)-o*n[u])}}for(u=0;u<=s;u++)r.set(u,s+1,0)}for(l=0;l<t;l++)n[l]=r.get(t-1,l),r.set(t-1,l,0);r.set(t-1,t-1,1),e[0]=0}(o,l,s,a),function(t,e,n,r){let i,o,a,s,l,u,c,h,d,f,p,g,v,m,y,E;for(a=1;a<t;a++)e[a-1]=e[a];e[t-1]=0;let _=0,b=0,x=Number.EPSILON;for(u=0;u<t;u++){for(b=Math.max(b,Math.abs(n[u])+Math.abs(e[u])),c=u;c<t&&!(Math.abs(e[c])<=x*b);)c++;if(c>u)do{for(i=n[u],h=(n[u+1]-i)/(2*e[u]),d=Ro(h,1),h<0&&(d=-d),n[u]=e[u]/(h+d),n[u+1]=e[u]*(h+d),f=n[u+1],o=i-n[u],a=u+2;a<t;a++)n[a]-=o;for(_+=o,h=n[c],p=1,g=p,v=p,m=e[u+1],y=0,E=0,a=c-1;a>=u;a--)for(v=g,g=p,E=y,i=p*e[a],o=p*h,d=Ro(h,e[a]),e[a+1]=y*d,y=e[a]/d,p=h/d,h=p*n[a]-y*i,n[a+1]=o+y*(p*i+y*n[a]),l=0;l<t;l++)o=r.get(l,a+1),r.set(l,a+1,y*r.get(l,a)+p*o),r.set(l,a,p*r.get(l,a)-y*o);h=-y*E*v*m*e[u]/f,e[u]=y*h,n[u]=p*h}while(Math.abs(e[u])>x*b);n[u]=n[u]+_,e[u]=0}for(a=0;a<t-1;a++){for(l=a,h=n[a],s=a+1;s<t;s++)n[s]<h&&(l=s,h=n[s]);if(l!==a)for(n[l]=n[a],n[a]=h,s=0;s<t;s++)h=r.get(s,a),r.set(s,a,r.get(s,l)),r.set(s,l,h)}}(o,l,s,a)}else{let t=new yo(o,o),e=new Float64Array(o);for(i=0;i<o;i++)for(r=0;r<o;r++)t.set(r,i,u.get(r,i));!function(t,e,n,r){let i,o,a,s,l,u,c,h=0,d=t-1;for(u=h+1;u<=d-1;u++){for(c=0,s=u;s<=d;s++)c+=Math.abs(e.get(s,u-1));if(0!==c){for(a=0,s=d;s>=u;s--)n[s]=e.get(s,u-1)/c,a+=n[s]*n[s];for(o=Math.sqrt(a),n[u]>0&&(o=-o),a-=n[u]*o,n[u]=n[u]-o,l=u;l<t;l++){for(i=0,s=d;s>=u;s--)i+=n[s]*e.get(s,l);for(i/=a,s=u;s<=d;s++)e.set(s,l,e.get(s,l)-i*n[s])}for(s=0;s<=d;s++){for(i=0,l=d;l>=u;l--)i+=n[l]*e.get(s,l);for(i/=a,l=u;l<=d;l++)e.set(s,l,e.get(s,l)-i*n[l])}n[u]=c*n[u],e.set(u,u-1,c*o)}}for(s=0;s<t;s++)for(l=0;l<t;l++)r.set(s,l,s===l?1:0);for(u=d-1;u>=h+1;u--)if(0!==e.get(u,u-1)){for(s=u+1;s<=d;s++)n[s]=e.get(s,u-1);for(l=u;l<=d;l++){for(o=0,s=u;s<=d;s++)o+=n[s]*r.get(s,l);for(o=o/n[u]/e.get(u,u-1),s=u;s<=d;s++)r.set(s,l,r.get(s,l)+o*n[s])}}}(o,t,e,a),function(t,e,n,r,i){let o,a,s,l,u,c,h,d,f,p,g,v,m,y,E,_=t-1,b=0,x=t-1,S=Number.EPSILON,M=0,A=0,R=0,T=0,w=0,P=0,N=0,C=0;for(o=0;o<t;o++)for((o<b||o>x)&&(n[o]=i.get(o,o),e[o]=0),a=Math.max(o-1,0);a<t;a++)A+=Math.abs(i.get(o,a));for(;_>=b;){for(l=_;l>b&&(P=Math.abs(i.get(l-1,l-1))+Math.abs(i.get(l,l)),0===P&&(P=A),!(Math.abs(i.get(l,l-1))<S*P));)l--;if(l===_)i.set(_,_,i.get(_,_)+M),n[_]=i.get(_,_),e[_]=0,_--,C=0;else if(l===_-1){if(h=i.get(_,_-1)*i.get(_-1,_),R=(i.get(_-1,_-1)-i.get(_,_))/2,T=R*R+h,N=Math.sqrt(Math.abs(T)),i.set(_,_,i.get(_,_)+M),i.set(_-1,_-1,i.get(_-1,_-1)+M),d=i.get(_,_),T>=0){for(N=R>=0?R+N:R-N,n[_-1]=d+N,n[_]=n[_-1],0!==N&&(n[_]=d-h/N),e[_-1]=0,e[_]=0,d=i.get(_,_-1),P=Math.abs(d)+Math.abs(N),R=d/P,T=N/P,w=Math.sqrt(R*R+T*T),R/=w,T/=w,a=_-1;a<t;a++)N=i.get(_-1,a),i.set(_-1,a,T*N+R*i.get(_,a)),i.set(_,a,T*i.get(_,a)-R*N);for(o=0;o<=_;o++)N=i.get(o,_-1),i.set(o,_-1,T*N+R*i.get(o,_)),i.set(o,_,T*i.get(o,_)-R*N);for(o=b;o<=x;o++)N=r.get(o,_-1),r.set(o,_-1,T*N+R*r.get(o,_)),r.set(o,_,T*r.get(o,_)-R*N)}else n[_-1]=d+R,n[_]=d+R,e[_-1]=N,e[_]=-N;_-=2,C=0}else{if(d=i.get(_,_),f=0,h=0,l<_&&(f=i.get(_-1,_-1),h=i.get(_,_-1)*i.get(_-1,_)),10===C){for(M+=d,o=b;o<=_;o++)i.set(o,o,i.get(o,o)-d);P=Math.abs(i.get(_,_-1))+Math.abs(i.get(_-1,_-2)),d=f=.75*P,h=-.4375*P*P}if(30===C&&(P=(f-d)/2,P=P*P+h,P>0)){for(P=Math.sqrt(P),f<d&&(P=-P),P=d-h/((f-d)/2+P),o=b;o<=_;o++)i.set(o,o,i.get(o,o)-P);M+=P,d=f=h=.964}for(C+=1,u=_-2;u>=l&&(N=i.get(u,u),w=d-N,P=f-N,R=(w*P-h)/i.get(u+1,u)+i.get(u,u+1),T=i.get(u+1,u+1)-N-w-P,w=i.get(u+2,u+1),P=Math.abs(R)+Math.abs(T)+Math.abs(w),R/=P,T/=P,w/=P,u!==l)&&!(Math.abs(i.get(u,u-1))*(Math.abs(T)+Math.abs(w))<S*(Math.abs(R)*(Math.abs(i.get(u-1,u-1))+Math.abs(N)+Math.abs(i.get(u+1,u+1)))));)u--;for(o=u+2;o<=_;o++)i.set(o,o-2,0),o>u+2&&i.set(o,o-3,0);for(s=u;s<=_-1&&(y=s!==_-1,s!==u&&(R=i.get(s,s-1),T=i.get(s+1,s-1),w=y?i.get(s+2,s-1):0,d=Math.abs(R)+Math.abs(T)+Math.abs(w),0!==d&&(R/=d,T/=d,w/=d)),0!==d);s++)if(P=Math.sqrt(R*R+T*T+w*w),R<0&&(P=-P),0!==P){for(s!==u?i.set(s,s-1,-P*d):l!==u&&i.set(s,s-1,-i.get(s,s-1)),R+=P,d=R/P,f=T/P,N=w/P,T/=R,w/=R,a=s;a<t;a++)R=i.get(s,a)+T*i.get(s+1,a),y&&(R+=w*i.get(s+2,a),i.set(s+2,a,i.get(s+2,a)-R*N)),i.set(s,a,i.get(s,a)-R*d),i.set(s+1,a,i.get(s+1,a)-R*f);for(o=0;o<=Math.min(_,s+3);o++)R=d*i.get(o,s)+f*i.get(o,s+1),y&&(R+=N*i.get(o,s+2),i.set(o,s+2,i.get(o,s+2)-R*w)),i.set(o,s,i.get(o,s)-R),i.set(o,s+1,i.get(o,s+1)-R*T);for(o=b;o<=x;o++)R=d*r.get(o,s)+f*r.get(o,s+1),y&&(R+=N*r.get(o,s+2),r.set(o,s+2,r.get(o,s+2)-R*w)),r.set(o,s,r.get(o,s)-R),r.set(o,s+1,r.get(o,s+1)-R*T)}}}if(0===A)return;for(_=t-1;_>=0;_--)if(R=n[_],T=e[_],0===T)for(l=_,i.set(_,_,1),o=_-1;o>=0;o--){for(h=i.get(o,o)-R,w=0,a=l;a<=_;a++)w+=i.get(o,a)*i.get(a,_);if(e[o]<0)N=h,P=w;else if(l=o,0===e[o]?i.set(o,_,0!==h?-w/h:-w/(S*A)):(d=i.get(o,o+1),f=i.get(o+1,o),T=(n[o]-R)*(n[o]-R)+e[o]*e[o],c=(d*P-N*w)/T,i.set(o,_,c),i.set(o+1,_,Math.abs(d)>Math.abs(N)?(-w-h*c)/d:(-P-f*c)/N)),c=Math.abs(i.get(o,_)),S*c*c>1)for(a=o;a<=_;a++)i.set(a,_,i.get(a,_)/c)}else if(T<0)for(l=_-1,Math.abs(i.get(_,_-1))>Math.abs(i.get(_-1,_))?(i.set(_-1,_-1,T/i.get(_,_-1)),i.set(_-1,_,-(i.get(_,_)-R)/i.get(_,_-1))):(E=Io(0,-i.get(_-1,_),i.get(_-1,_-1)-R,T),i.set(_-1,_-1,E[0]),i.set(_-1,_,E[1])),i.set(_,_-1,0),i.set(_,_,1),o=_-2;o>=0;o--){for(p=0,g=0,a=l;a<=_;a++)p+=i.get(o,a)*i.get(a,_-1),g+=i.get(o,a)*i.get(a,_);if(h=i.get(o,o)-R,e[o]<0)N=h,w=p,P=g;else if(l=o,0===e[o]?(E=Io(-p,-g,h,T),i.set(o,_-1,E[0]),i.set(o,_,E[1])):(d=i.get(o,o+1),f=i.get(o+1,o),v=(n[o]-R)*(n[o]-R)+e[o]*e[o]-T*T,m=2*(n[o]-R)*T,0===v&&0===m&&(v=S*A*(Math.abs(h)+Math.abs(T)+Math.abs(d)+Math.abs(f)+Math.abs(N))),E=Io(d*w-N*p+T*g,d*P-N*g-T*p,v,m),i.set(o,_-1,E[0]),i.set(o,_,E[1]),Math.abs(d)>Math.abs(N)+Math.abs(T)?(i.set(o+1,_-1,(-p-h*i.get(o,_-1)+T*i.get(o,_))/d),i.set(o+1,_,(-g-h*i.get(o,_)-T*i.get(o,_-1))/d)):(E=Io(-w-f*i.get(o,_-1),-P-f*i.get(o,_),N,T),i.set(o+1,_-1,E[0]),i.set(o+1,_,E[1]))),c=Math.max(Math.abs(i.get(o,_-1)),Math.abs(i.get(o,_))),S*c*c>1)for(a=o;a<=_;a++)i.set(a,_-1,i.get(a,_-1)/c),i.set(a,_,i.get(a,_)/c)}for(o=0;o<t;o++)if(o<b||o>x)for(a=o;a<t;a++)r.set(o,a,i.get(o,a));for(a=t-1;a>=b;a--)for(o=b;o<=x;o++){for(N=0,s=b;s<=Math.min(a,x);s++)N+=r.get(o,s)*i.get(s,a);r.set(o,a,N)}}(o,l,s,a,t)}this.n=o,this.e=l,this.d=s,this.V=a}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,n=this.n,r=this.e,i=this.d,o=new yo(n,n);for(t=0;t<n;t++){for(e=0;e<n;e++)o.set(t,e,0);o.set(t,t,i[t]),r[t]>0?o.set(t,t+1,r[t]):r[t]<0&&o.set(t,t-1,r[t])}return o}}function Io(t,e,n,r){let i,o;return Math.abs(n)>Math.abs(r)?(i=r/n,o=n+i*r,[(t+i*e)/o,(e-i*t)/o]):(i=n/r,o=r+i*n,[(i*t+e)/o,(i*e-t)/o])}class Lo{constructor(t){if(!(t=Mo.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,n,r,i=t,o=i.rows,a=new yo(o,o),s=!0;for(n=0;n<o;n++){let t=0;for(r=0;r<n;r++){let o=0;for(e=0;e<r;e++)o+=a.get(r,e)*a.get(n,e);o=(i.get(n,r)-o)/a.get(r,r),a.set(n,r,o),t+=o*o}for(t=i.get(n,n)-t,s&=t>0,a.set(n,n,Math.sqrt(Math.max(t,0))),r=n+1;r<o;r++)a.set(n,r,0)}this.L=a,this.positiveDefinite=Boolean(s)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=Mo.checkMatrix(t);let e=this.L,n=e.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let r,i,o,a=t.columns,s=t.clone();for(o=0;o<n;o++)for(i=0;i<a;i++){for(r=0;r<o;r++)s.set(o,i,s.get(o,i)-s.get(r,i)*e.get(o,r));s.set(o,i,s.get(o,i)/e.get(o,o))}for(o=n-1;o>=0;o--)for(i=0;i<a;i++){for(r=o+1;r<n;r++)s.set(o,i,s.get(o,i)-s.get(r,i)*e.get(r,o));s.set(o,i,s.get(o,i)/e.get(o,o))}return s}get lowerTriangularMatrix(){return this.L}}class Do{constructor(t,e={}){t=Mo.checkMatrix(t);let{Y:n}=e;const{scaleScores:r=!1,maxIterations:i=1e3,terminationCriteria:o=1e-10}=e;let a;if(n){if(n=Qi.isAnyArray(n)&&"number"==typeof n[0]?yo.columnVector(n):Mo.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=n.getColumnVector(0)}else a=t.getColumnVector(0);let s,l,u,c,h=1;for(let e=0;e<i&&h>o;e++)u=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),u=u.div(u.norm()),s=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),e>0&&(h=s.clone().sub(c).pow(2).sum()),c=s.clone(),n?(l=n.transpose().mmul(s).div(s.transpose().mmul(s).get(0,0)),l=l.div(l.norm()),a=n.mmul(l).div(l.transpose().mmul(l).get(0,0))):a=s;if(n){let e=t.transpose().mmul(s).div(s.transpose().mmul(s).get(0,0));e=e.div(e.norm());let r=t.clone().sub(s.clone().mmul(e.transpose())),i=a.transpose().mmul(s).div(s.transpose().mmul(s).get(0,0)),o=n.clone().sub(s.clone().mulS(i.get(0,0)).mmul(l.transpose()));this.t=s,this.p=e.transpose(),this.w=u.transpose(),this.q=l,this.u=a,this.s=s.transpose().mmul(s),this.xResidual=r,this.yResidual=o,this.betas=i}else this.w=u.transpose(),this.s=s.transpose().mmul(s).sqrt(),this.t=r?s.clone().div(this.s.get(0,0)):s,this.xResidual=t.sub(s.mmul(u.transpose()))}}Xi.AbstractMatrix=vo,Xi.CHO=Lo,Xi.CholeskyDecomposition=Lo,Xi.DistanceMatrix=_o,Xi.EVD=Oo,Xi.EigenvalueDecomposition=Oo,Xi.LU=Ao,Xi.LuDecomposition=Ao;var Bo=Xi.Matrix=yo;Xi.MatrixColumnSelectionView=class extends bo{constructor(t,e){co(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,n){return this.matrix.set(t,this.columnIndices[e],n),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},Xi.MatrixColumnView=class extends bo{constructor(t,e){ao(t,e),super(t,t.rows,1),this.column=e}set(t,e,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}},Xi.MatrixFlipColumnView=class extends bo{constructor(t){super(t,t.rows,t.columns)}set(t,e,n){return this.matrix.set(t,this.columns-e-1,n),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},Xi.MatrixFlipRowView=class extends bo{constructor(t){super(t,t.rows,t.columns)}set(t,e,n){return this.matrix.set(this.rows-t-1,e,n),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},Xi.MatrixRowSelectionView=class extends bo{constructor(t,e){uo(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,n){return this.matrix.set(this.rowIndices[t],e,n),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},Xi.MatrixRowView=class extends bo{constructor(t,e){oo(t,e),super(t,1,t.columns),this.row=e}set(t,e,n){return this.matrix.set(this.row,e,n),this}get(t,e){return this.matrix.get(this.row,e)}},Xi.MatrixSelectionView=xo,Xi.MatrixSubView=class extends bo{constructor(t,e,n,r,i){ho(t,e,n,r,i),super(t,n-e+1,i-r+1),this.startRow=e,this.startColumn=r}set(t,e,n){return this.matrix.set(this.startRow+t,this.startColumn+e,n),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},Xi.MatrixTransposeView=class extends bo{constructor(t){super(t,t.columns,t.rows)}set(t,e,n){return this.matrix.set(e,t,n),this}get(t,e){return this.matrix.get(e,t)}},Xi.NIPALS=Do,Xi.Nipals=Do,Xi.QR=To,Xi.QrDecomposition=To,Xi.SVD=wo;var ko=Xi.SingularValueDecomposition=wo;Xi.SymmetricMatrix=Eo,Xi.WrapperMatrix1D=So,Xi.WrapperMatrix2D=Mo,Xi.correlation=function(t,e=t,n={}){t=new yo(t);let r=!1;if("object"!=typeof e||yo.isMatrix(e)||Qi.isAnyArray(e)?e=new yo(e):(n=e,e=t,r=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0,scale:o=!0}=n;i&&(t.center("column"),r||e.center("column")),o&&(t.scale("column"),r||e.scale("column"));const a=t.standardDeviation("column",{unbiased:!0}),s=r?a:e.standardDeviation("column",{unbiased:!0}),l=t.transpose().mmul(e);for(let e=0;e<l.rows;e++)for(let n=0;n<l.columns;n++)l.set(e,n,l.get(e,n)*(1/(a[e]*s[n]))*(1/(t.rows-1)));return l},Xi.covariance=function(t,e=t,n={}){t=new yo(t);let r=!1;if("object"!=typeof e||yo.isMatrix(e)||Qi.isAnyArray(e)?e=new yo(e):(n=e,e=t,r=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0}=n;i&&(t=t.center("column"),r||(e=e.center("column")));const o=t.transpose().mmul(e);for(let e=0;e<o.rows;e++)for(let n=0;n<o.columns;n++)o.set(e,n,o.get(e,n)*(1/(t.rows-1)));return o};var Fo=Xi.default=yo;Xi.determinant=function t(e){if((e=yo.checkMatrix(e)).isSquare()){if(0===e.columns)return 1;let n,r,i,o;if(2===e.columns)return n=e.get(0,0),r=e.get(0,1),i=e.get(1,0),o=e.get(1,1),n*o-r*i;if(3===e.columns){let o,a,s;return o=new xo(e,[1,2],[1,2]),a=new xo(e,[1,2],[0,2]),s=new xo(e,[1,2],[0,1]),n=e.get(0,0),r=e.get(0,1),i=e.get(0,2),n*t(o)-r*t(a)+i*t(s)}return new Ao(e).determinant}throw Error("determinant can only be calculated for a square matrix")},Xi.inverse=function(t,e=!1){return t=Mo.checkMatrix(t),e?new wo(t).inverse():Po(t,yo.eye(t.rows))},Xi.linearDependencies=function(t,e={}){const{thresholdValue:n=1e-9,thresholdError:r=1e-9}=e;let i=(t=yo.checkMatrix(t)).rows,o=new yo(i,i);for(let e=0;e<i;e++){let a=yo.columnVector(t.getRow(e)),s=t.subMatrixRow(No(i,e)).transpose(),l=new wo(s).solve(a),u=yo.sub(a,s.mmul(l)).abs().max();o.setRow(e,Co(u,l,e,n,r))}return o},Xi.pseudoInverse=function(t,e=Number.EPSILON){if((t=yo.checkMatrix(t)).isEmpty())return t.transpose();let n=new wo(t,{autoTranspose:!0}),r=n.leftSingularVectors,i=n.rightSingularVectors,o=n.diagonal;for(let t=0;t<o.length;t++)Math.abs(o[t])>e?o[t]=1/o[t]:o[t]=0;return i.mmul(yo.diag(o).mmul(r.transpose()))},Xi.solve=Po,Xi.wrap=function(t,e){if(Qi.isAnyArray(t))return t[0]&&Qi.isAnyArray(t[0])?new Mo(t):new So(t,e);throw new Error("the argument is not an array")};const Uo=Bo,Go=ko;Fo.Matrix&&Fo.Matrix;const zo={center:[0,0],linkDistance:50};class Vo{constructor(t={}){this.options=t,this.id="mds",this.options=Object.assign(Object.assign({},zo),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericMDSLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericMDSLayout(!0,t,e)}))}genericMDSLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{center:i=[0,0],linkDistance:o=50}=r,a=e.getAllNodes(),s=e.getAllEdges();if(!(null==a?void 0:a.length)||1===a.length)return ci(e,t,i);const l=ti({nodes:a,edges:s}),u=Jr(l);Wo(u);const c=((t,e)=>{const n=[];return t.forEach((t=>{const r=[];t.forEach((t=>{r.push(t*e)})),n.push(r)})),n})(u,o),h=jo(c),d=[];h.forEach(((t,e)=>{const n=ii(a[e]);n.data.x=t[0]+i[0],n.data.y=t[1]+i[1],d.push(n)})),t&&d.forEach((t=>e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})));return{nodes:d,edges:s}}))}}const Wo=t=>{let e=-999999;t.forEach((t=>{t.forEach((t=>{t!==1/0&&e<t&&(e=t)}))})),t.forEach(((n,r)=>{n.forEach(((n,i)=>{n===1/0&&(t[r][i]=e)}))}))},jo=t=>{const e=Uo.mul(Uo.pow(t,2),-.5),n=e.mean("row"),r=e.mean("column"),i=e.mean();e.add(i).subRowVector(n).subColumnVector(r);const o=new Go(e),a=Uo.sqrt(o.diagonalMatrix).diagonal();return o.leftSingularVectors.toJSON().map((t=>Uo.mul([t],[a]).toJSON()[0].splice(0,2)))},Ho={gForce:!0,force2:!0,d3force:!0,fruchterman:!0,forceAtlas2:!0,force:!0,"graphin-force":!0},Xo={center:[0,0],comboPadding:10,treeKey:"combo"};function Yo(t,e){var n,r=1;function i(){var i,o,a=n.length,s=0,l=0;for(i=0;i<a;++i)s+=(o=n[i]).x,l+=o.y;for(s=(s/a-t)*r,l=(l/a-e)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=l}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i}function Ko(t){return function(){return t}}function $o(t){return 1e-6*(t()-.5)}function qo(t){return t.x+t.vx}function Zo(t){return t.y+t.vy}function Qo(t){var e,n,r,i=1,o=1;function a(){for(var t,a,l,u,c,h,d,f=e.length,p=0;p<o;++p)for(a=_i(e,qo,Zo).visitAfter(s),t=0;t<f;++t)l=e[t],h=n[l.index],d=h*h,u=l.x+l.vx,c=l.y+l.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,f=t.r,p=h+f;if(!s)return e>u+p||o<u-p||n>c+p||a<c-p;if(s.index>l.index){var g=u-s.x-s.vx,v=c-s.y-s.vy,m=g*g+v*v;m<p*p&&(0===g&&(m+=(g=$o(r))*g),0===v&&(m+=(v=$o(r))*v),m=(p-(m=Math.sqrt(m)))/m*i,l.vx+=(g*=m)*(p=(f*=f)/(d+f)),l.vy+=(v*=m)*p,s.vx-=g*(p=1-p),s.vy-=v*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=Ko(null==t?1:+t)),a.initialize=function(t,n){e=t,r=n,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(i=+t,a):i},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:Ko(+e),l(),a):t},a}function Jo(t){return t.index}function ta(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function ea(t){var e,n,r,i,o,a,s=Jo,l=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},u=Ko(30),c=1;function h(r){for(var i=0,s=t.length;i<c;++i)for(var l,u,h,d,f,p,g,v=0;v<s;++v)u=(l=t[v]).source,d=(h=l.target).x+h.vx-u.x-u.vx||$o(a),f=h.y+h.vy-u.y-u.vy||$o(a),d*=p=((p=Math.sqrt(d*d+f*f))-n[v])/p*r*e[v],f*=p,h.vx-=d*(g=o[v]),h.vy-=f*g,u.vx+=d*(g=1-g),u.vy+=f*g}function d(){if(r){var a,l,u=r.length,c=t.length,h=new Map(r.map(((t,e)=>[s(t,e,r),t])));for(a=0,i=new Array(u);a<c;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=ta(h,l.source)),"object"!=typeof l.target&&(l.target=ta(h,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(a=0,o=new Array(c);a<c;++a)l=t[a],o[a]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);e=new Array(c),f(),n=new Array(c),p()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+l(t[n],n,t)}function p(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+u(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,a=e,d()},h.links=function(e){return arguments.length?(t=e,d(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(l="function"==typeof t?t:Ko(+t),f(),h):l},h.distance=function(t){return arguments.length?(u="function"==typeof t?t:Ko(+t),p(),h):u},h}var na={value:()=>{}};function ra(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new ia(r)}function ia(t){this._=t}function oa(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function aa(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=na,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}ia.prototype=ra.prototype={constructor:ia,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=aa(i[n],t.name,e);else if(null==e)for(n in i)i[n]=aa(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=oa(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ia(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var sa,la,ua=0,ca=0,ha=0,da=1e3,fa=0,pa=0,ga=0,va="object"==typeof performance&&performance.now?performance:Date,ma="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function ya(){return pa||(ma(Ea),pa=va.now()+ga)}function Ea(){pa=0}function _a(){this._call=this._time=this._next=null}function ba(t,e,n){var r=new _a;return r.restart(t,e,n),r}function xa(){pa=(fa=va.now())+ga,ua=ca=0;try{!function(){ya(),++ua;for(var t,e=sa;e;)(t=pa-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ua}()}finally{ua=0,function(){var t,e,n=sa,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:sa=e);la=t,Ma(r)}(),pa=0}}function Sa(){var t=va.now(),e=t-fa;e>da&&(ga-=e,fa=t)}function Ma(t){ua||(ca&&(ca=clearTimeout(ca)),t-pa>24?(t<1/0&&(ca=setTimeout(xa,t-va.now()-ga)),ha&&(ha=clearInterval(ha))):(ha||(fa=va.now(),ha=setInterval(Sa,da)),ua=1,ma(xa)))}_a.prototype=ba.prototype={constructor:_a,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?ya():+n)+(null==e?0:+e),this._next||la===this||(la?la._next=this:sa=this,la=this),this._call=t,this._time=n,Ma()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ma())}};const Aa=1664525,Ra=1013904223,Ta=4294967296;function wa(t){return t.x}function Pa(t){return t.y}var Na=Math.PI*(3-Math.sqrt(5));function Ca(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,l=ba(h),u=ra("tick","end"),c=function(){let t=1;return()=>(t=(Aa*t+Ra)%Ta)/Ta}();function h(){d(),u.call("tick",e),n<r&&(l.stop(),u.call("end",e))}function d(r){var l,u,c=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(o-n)*i,s.forEach((function(t){t(n)})),l=0;l<c;++l)null==(u=t[l]).fx?u.x+=u.vx*=a:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=a:(u.y=u.fy,u.vy=0);return e}function f(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(.5+n),o=n*Na;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),f(),e={tick:d,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,f(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(c=t,s.forEach(p),e):c},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,l,u=0,c=t.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(a=(i=e-(s=t[u]).x)*i+(o=n-s.y)*o)<r&&(l=s,r=a);return l},on:function(t,n){return arguments.length>1?(u.on(t,n),e):u.on(t)}}}function Oa(){var t,e,n,r,i,o=Ko(-30),a=1,s=1/0,l=.81;function u(n){var i,o=t.length,a=_i(t,wa,Pa).visitAfter(h);for(r=n,i=0;i<o;++i)e=t[i],a.visit(d)}function c(){if(t){var e,n,r=t.length;for(i=new Array(r),e=0;e<r;++e)n=t[e],i[n.index]=+o(n,e,t)}}function h(t){var e,n,r,o,a,s=0,l=0;if(t.length){for(r=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,r+=n*e.x,o+=n*e.y);t.x=r/l,t.y=o/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=i[e.data.index]}while(e=e.next)}t.value=s}function d(t,o,u,c){if(!t.value)return!0;var h=t.x-e.x,d=t.y-e.y,f=c-o,p=h*h+d*d;if(f*f/l<p)return p<s&&(0===h&&(p+=(h=$o(n))*h),0===d&&(p+=(d=$o(n))*d),p<a&&(p=Math.sqrt(a*p)),e.vx+=h*t.value*r/p,e.vy+=d*t.value*r/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===h&&(p+=(h=$o(n))*h),0===d&&(p+=(d=$o(n))*d),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(f=i[t.data.index]*r/p,e.vx+=h*f,e.vy+=d*f)}while(t=t.next)}}return u.initialize=function(e,r){t=e,n=r,c()},u.strength=function(t){return arguments.length?(o="function"==typeof t?t:Ko(+t),c(),u):o},u.distanceMin=function(t){return arguments.length?(a=t*t,u):Math.sqrt(a)},u.distanceMax=function(t){return arguments.length?(s=t*t,u):Math.sqrt(s)},u.theta=function(t){return arguments.length?(l=t*t,u):Math.sqrt(l)},u}function Ia(t,e,n){var r,i,o,a=Ko(.1);function s(t){for(var a=0,s=r.length;a<s;++a){var l=r[a],u=l.x-e||1e-6,c=l.y-n||1e-6,h=Math.sqrt(u*u+c*c),d=(o[a]-h)*i[a]*t/h;l.vx+=u*d,l.vy+=c*d}}function l(){if(r){var e,n=r.length;for(i=new Array(n),o=new Array(n),e=0;e<n;++e)o[e]=+t(r[e],e,r),i[e]=isNaN(o[e])?0:+a(r[e],e,r)}}return"function"!=typeof t&&(t=Ko(+t)),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t,l()},s.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ko(+t),l(),s):a},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:Ko(+e),l(),s):t},s.x=function(t){return arguments.length?(e=+t,s):e},s.y=function(t){return arguments.length?(n=+t,s):n},s}function La(t){var e,n,r,i=Ko(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Ko(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Ko(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:Ko(+e),a(),o):t},o}function Da(t){var e,n,r,i=Ko(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Ko(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Ko(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Ko(+e),a(),o):t},o}class Ba{constructor(t){this.id="d3-force",this.config={inputNodeAttrs:["x","y","vx","vy","fx","fy"],outputNodeAttrs:["x","y","vx","vy"],simulationAttrs:["alpha","alphaMin","alphaDecay","alphaTarget","velocityDecay","randomSource"]},this.forceMap={link:ea,manyBody:Oa,center:Yo,collide:Qo,radial:Ia,x:La,y:Da},this.options={link:{id:t=>t.id},manyBody:{},center:{x:0,y:0}},this.context={options:{},assign:!1,nodes:[],edges:[]},$(this.options,t),this.options.forceSimulation&&(this.simulation=this.options.forceSimulation)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){yield this.genericLayout(!0,t,e)}))}stop(){this.simulation.stop()}tick(t){return this.simulation.tick(t),this.getResult()}restart(){this.simulation.restart()}setFixedPosition(t,e){const n=this.context.nodes.find((e=>e.id===t));n&&e.forEach(((t,e)=>{if("number"==typeof t||null===t){n[["fx","fy","fz"][e]]=t}}))}getOptions(t){var e,n;const r=$({},this.options,t);return r.collide&&void 0===(null===(e=r.collide)||void 0===e?void 0:e.radius)&&(r.collide=r.collide||{},r.collide.radius=null!==(n=r.nodeSize)&&void 0!==n?n:10),void 0===r.iterations&&(r.link&&void 0===r.link.iterations&&(r.iterations=r.link.iterations),r.collide&&void 0===r.collide.iterations&&(r.iterations=r.collide.iterations)),this.context.options=r,r}genericLayout(t,e,n){var r;return o(this,void 0,void 0,(function*(){const i=this.getOptions(n),o=e.getAllNodes().map((({id:t,data:e})=>Object.assign({id:t,data:e},nt(e,this.config.inputNodeAttrs)))),a=e.getAllEdges().map((t=>Object.assign({},t)));Object.assign(this.context,{assign:t,nodes:o,edges:a,graph:e});const s=new Promise((t=>{this.resolver=t})),l=this.setSimulation(i);return l.nodes(o),null===(r=l.force("link"))||void 0===r||r.links(a),s}))}getResult(){const{assign:t,nodes:e,edges:n,graph:r}=this.context,i=e.map((t=>({id:t.id,data:Object.assign(Object.assign({},t.data),nt(t,this.config.outputNodeAttrs))}))),o=n.map((({id:t,source:e,target:n,data:r})=>({id:t,source:"object"==typeof e?e.id:e,target:"object"==typeof n?n.id:n,data:r})));return t&&i.forEach((t=>r.mergeNodeData(t.id,t.data))),{nodes:i,edges:o}}initSimulation(){return Ca()}setSimulation(t){const e=this.simulation||this.options.forceSimulation||this.initSimulation();return this.simulation||(this.simulation=e.on("tick",(()=>{var e;return null===(e=t.onTick)||void 0===e?void 0:e.call(t,this.getResult())})).on("end",(()=>{var t;return null===(t=this.resolver)||void 0===t?void 0:t.call(this,this.getResult())}))),ka(e,this.config.simulationAttrs.map((e=>[e,t[e]]))),Object.entries(this.forceMap).forEach((([n,r])=>{const i=n;if(t[n]){let n=e.force(i);n||(n=r(),e.force(i,n)),ka(n,Object.entries(t[i]))}else e.force(i,null)})),e}}const ka=(t,e)=>e.reduce(((e,[n,r])=>e[n]&&void 0!==r?e[n].call(t,r):e),t);function Fa(t,e,n){var r,i=1;function o(){var o,a,s=r.length,l=0,u=0,c=0;for(o=0;o<s;++o)l+=(a=r[o]).x||0,u+=a.y||0,c+=a.z||0;for(l=(l/s-t)*i,u=(u/s-e)*i,c=(c/s-n)*i,o=0;o<s;++o)a=r[o],l&&(a.x-=l),u&&(a.y-=u),c&&(a.z-=c)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),o.initialize=function(t){r=t},o.x=function(e){return arguments.length?(t=+e,o):t},o.y=function(t){return arguments.length?(e=+t,o):e},o.z=function(t){return arguments.length?(n=+t,o):n},o.strength=function(t){return arguments.length?(i=+t,o):i},o}function Ua(t,e,n){if(isNaN(e))return t;var r,i,o,a,s,l,u=t._root,c={data:n},h=t._x0,d=t._x1;if(!u)return t._root=c,t;for(;u.length;)if((a=e>=(i=(h+d)/2))?h=i:d=i,r=u,!(u=u[s=+a]))return r[s]=c,t;if(e===(o=+t._x.call(null,u.data)))return c.next=u,r?r[s]=c:t._root=c,t;do{r=r?r[s]=new Array(2):t._root=new Array(2),(a=e>=(i=(h+d)/2))?h=i:d=i}while((s=+a)==(l=+(o>=i)));return r[l]=u,r[s]=c,t}function Ga(t,e,n){this.node=t,this.x0=e,this.x1=n}function za(t){return t[0]}function Va(t,e){var n=new Wa(null==e?za:e,NaN,NaN);return null==t?n:n.addAll(t)}function Wa(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function ja(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ha=Va.prototype=Wa.prototype;function Xa(t){return function(){return t}}function Ya(t){return 1e-6*(t()-.5)}function Ka(t){return t.x+t.vx}function $a(t){return t.y+t.vy}function qa(t){return t.z+t.vz}function Za(t){var e,n,r,i,o=1,a=1;function s(){for(var t,s,u,c,h,d,f,p,g=e.length,v=0;v<a;++v)for(s=(1===n?Va(e,Ka):2===n?_i(e,Ka,$a):3===n?Pi(e,Ka,$a,qa):null).visitAfter(l),t=0;t<g;++t)u=e[t],f=r[u.index],p=f*f,c=u.x+u.vx,n>1&&(h=u.y+u.vy),n>2&&(d=u.z+u.vz),s.visit(m);function m(t,e,r,a,s,l,g){var v=[e,r,a,s,l,g],m=v[0],y=v[1],E=v[2],_=v[n],b=v[n+1],x=v[n+2],S=t.data,M=t.r,A=f+M;if(!S)return m>c+A||_<c-A||n>1&&(y>h+A||b<h-A)||n>2&&(E>d+A||x<d-A);if(S.index>u.index){var R=c-S.x-S.vx,T=n>1?h-S.y-S.vy:0,w=n>2?d-S.z-S.vz:0,P=R*R+T*T+w*w;P<A*A&&(0===R&&(P+=(R=Ya(i))*R),n>1&&0===T&&(P+=(T=Ya(i))*T),n>2&&0===w&&(P+=(w=Ya(i))*w),P=(A-(P=Math.sqrt(P)))/P*o,u.vx+=(R*=P)*(A=(M*=M)/(p+M)),n>1&&(u.vy+=(T*=P)*A),n>2&&(u.vz+=(w*=P)*A),S.vx-=R*(A=1-A),n>1&&(S.vy-=T*A),n>2&&(S.vz-=w*A))}}}function l(t){if(t.data)return t.r=r[t.data.index];for(var e=t.r=0;e<Math.pow(2,n);++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var n,i,o=e.length;for(r=new Array(o),n=0;n<o;++n)i=e[n],r[i.index]=+t(i,n,e)}}return"function"!=typeof t&&(t=Xa(null==t?1:+t)),s.initialize=function(t,...r){e=t,i=r.find((t=>"function"==typeof t))||Math.random,n=r.find((t=>[1,2,3].includes(t)))||2,u()},s.iterations=function(t){return arguments.length?(a=+t,s):a},s.strength=function(t){return arguments.length?(o=+t,s):o},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:Xa(+e),u(),s):t},s}function Qa(t){return t.index}function Ja(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function ts(t){var e,n,r,i,o,a,s,l=Qa,u=function(t){return 1/Math.min(o[t.source.index],o[t.target.index])},c=Xa(30),h=1;function d(r){for(var o=0,l=t.length;o<h;++o)for(var u,c,d,f,p,g=0,v=0,m=0,y=0;g<l;++g)c=(u=t[g]).source,v=(d=u.target).x+d.vx-c.x-c.vx||Ya(s),i>1&&(m=d.y+d.vy-c.y-c.vy||Ya(s)),i>2&&(y=d.z+d.vz-c.z-c.vz||Ya(s)),v*=f=((f=Math.sqrt(v*v+m*m+y*y))-n[g])/f*r*e[g],m*=f,y*=f,d.vx-=v*(p=a[g]),i>1&&(d.vy-=m*p),i>2&&(d.vz-=y*p),c.vx+=v*(p=1-p),i>1&&(c.vy+=m*p),i>2&&(c.vz+=y*p)}function f(){if(r){var i,s,u=r.length,c=t.length,h=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(i=0,o=new Array(u);i<c;++i)(s=t[i]).index=i,"object"!=typeof s.source&&(s.source=Ja(h,s.source)),"object"!=typeof s.target&&(s.target=Ja(h,s.target)),o[s.source.index]=(o[s.source.index]||0)+1,o[s.target.index]=(o[s.target.index]||0)+1;for(i=0,a=new Array(c);i<c;++i)s=t[i],a[i]=o[s.source.index]/(o[s.source.index]+o[s.target.index]);e=new Array(c),p(),n=new Array(c),g()}}function p(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function g(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,...e){r=t,s=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,f()},d.links=function(e){return arguments.length?(t=e,f(),d):t},d.id=function(t){return arguments.length?(l=t,d):l},d.iterations=function(t){return arguments.length?(h=+t,d):h},d.strength=function(t){return arguments.length?(u="function"==typeof t?t:Xa(+t),p(),d):u},d.distance=function(t){return arguments.length?(c="function"==typeof t?t:Xa(+t),g(),d):c},d}Ha.copy=function(){var t,e,n=new Wa(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=ja(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=ja(e));return n},Ha.add=function(t){const e=+this._x.call(null,t);return Ua(this.cover(e),e,t)},Ha.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let o,a=0;a<e;++a)isNaN(o=+this._x.call(null,t[a]))||(n[a]=o,o<r&&(r=o),o>i&&(i=o));if(r>i)return this;this.cover(r).cover(i);for(let r=0;r<e;++r)Ua(this,n[r],t[r]);return this},Ha.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,o=n-e||1,a=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=a,a=r,o*=2,i){case 0:n=e+o;break;case 1:e=n-o}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._x1=n,this},Ha.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Ha.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},Ha.find=function(t,e){var n,r,i,o,a,s=this._x0,l=this._x1,u=[],c=this._root;for(c&&u.push(new Ga(c,s,l)),null==e?e=1/0:(s=t-e,l=t+e);o=u.pop();)if(!(!(c=o.node)||(r=o.x0)>l||(i=o.x1)<s))if(c.length){var h=(r+i)/2;u.push(new Ga(c[1],h,i),new Ga(c[0],r,h)),(a=+(t>=h))&&(o=u[u.length-1],u[u.length-1]=u[u.length-1-a],u[u.length-1-a]=o)}else{var d=Math.abs(t-+this._x.call(null,c.data));d<e&&(e=d,s=t-d,l=t+d,n=c.data)}return n},Ha.remove=function(t){if(isNaN(o=+this._x.call(null,t)))return this;var e,n,r,i,o,a,s,l,u,c=this._root,h=this._x0,d=this._x1;if(!c)return this;if(c.length)for(;;){if((s=o>=(a=(h+d)/2))?h=a:d=a,e=c,!(c=c[l=+s]))return this;if(!c.length)break;e[l+1&1]&&(n=e,u=l)}for(;c.data!==t;)if(r=c,!(c=c.next))return this;return(i=c.next)&&delete c.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(c=e[0]||e[1])&&c===(e[1]||e[0])&&!c.length&&(n?n[u]=c:this._root=c),this):(this._root=i,this)},Ha.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Ha.root=function(){return this._root},Ha.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Ha.visit=function(t){var e,n,r,i,o=[],a=this._root;for(a&&o.push(new Ga(a,this._x0,this._x1));e=o.pop();)if(!t(a=e.node,r=e.x0,i=e.x1)&&a.length){var s=(r+i)/2;(n=a[1])&&o.push(new Ga(n,s,i)),(n=a[0])&&o.push(new Ga(n,r,s))}return this},Ha.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ga(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.x1,l=(a+s)/2;(o=i[0])&&n.push(new Ga(o,a,l)),(o=i[1])&&n.push(new Ga(o,l,s))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},Ha.x=function(t){return arguments.length?(this._x=t,this):this._x};const es=1664525,ns=1013904223,rs=4294967296;function is(t){return t.x}function os(t){return t.y}function as(t){return t.z}var ss,ls,us,cs,hs,ds,fs,ps,gs,vs,ms,ys,Es,_s,bs,xs,Ss,Ms,As,Rs,Ts,ws,Ps,Ns,Cs,Os,Is,Ls,Ds,Bs,ks,Fs,Us,Gs,zs,Vs,Ws,js,Hs,Xs,Ys,Ks,$s,qs,Zs,Qs,Js,tl,el,nl,rl,il,ol,al,sl,ll,ul,cl,hl,dl,fl,pl,gl,vl,ml,yl,El,_l,bl,xl,Sl,Ml,Al,Rl,Tl,wl,Pl,Nl,Cl,Ol,Il,Ll,Dl,Bl,kl,Fl,Ul,Gl,zl,Vl,Wl,jl,Hl,Xl,Yl,Kl,$l,ql,Zl,Ql,Jl,tu,eu,nu,ru,iu,ou,au,su=Math.PI*(3-Math.sqrt(5)),lu=20*Math.PI/(9+Math.sqrt(221));function uu(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,o=.001,a=1-Math.pow(o,1/300),s=0,l=.6,u=new Map,c=ba(f),h=ra("tick","end"),d=function(){let t=1;return()=>(t=(es*t+ns)%rs)/rs}();function f(){p(),h.call("tick",n),i<o&&(c.stop(),h.call("end",n))}function p(e){var o,c,h=t.length;void 0===e&&(e=1);for(var d=0;d<e;++d)for(i+=(s-i)*a,u.forEach((function(t){t(i)})),o=0;o<h;++o)null==(c=t[o]).fx?c.x+=c.vx*=l:(c.x=c.fx,c.vx=0),r>1&&(null==c.fy?c.y+=c.vy*=l:(c.y=c.fy,c.vy=0)),r>2&&(null==c.fz?c.z+=c.vz*=l:(c.z=c.fz,c.vz=0));return n}function g(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var o=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),a=n*su,s=n*lu;1===r?e.x=o:2===r?(e.x=o*Math.cos(a),e.y=o*Math.sin(a)):(e.x=o*Math.sin(a)*Math.cos(s),e.y=o*Math.cos(a),e.z=o*Math.sin(a)*Math.sin(s))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function v(e){return e.initialize&&e.initialize(t,d,r),e}return null==t&&(t=[]),g(),n={tick:p,restart:function(){return c.restart(f),n},stop:function(){return c.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),u.forEach(v),n):r},nodes:function(e){return arguments.length?(t=e,g(),u.forEach(v),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(o=+t,n):o},alphaDecay:function(t){return arguments.length?(a=+t,n):+a},alphaTarget:function(t){return arguments.length?(s=+t,n):s},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(d=t,u.forEach(v),n):d},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,v(e)),n):u.get(t)},find:function(){var e,n,i,o,a,s,l=Array.prototype.slice.call(arguments),u=l.shift()||0,c=(r>1?l.shift():null)||0,h=(r>2?l.shift():null)||0,d=l.shift()||1/0,f=0,p=t.length;for(d*=d,f=0;f<p;++f)(o=(e=u-(a=t[f]).x)*e+(n=c-(a.y||0))*n+(i=h-(a.z||0))*i)<d&&(s=a,d=o);return s},on:function(t,e){return arguments.length>1?(h.on(t,e),n):h.on(t)}}}function cu(){var t,e,n,r,i,o,a=Xa(-30),s=1,l=1/0,u=.81;function c(r){var o,a=t.length,s=(1===e?Va(t,is):2===e?_i(t,is,os):3===e?Pi(t,is,os,as):null).visitAfter(d);for(i=r,o=0;o<a;++o)n=t[o],s.visit(f)}function h(){if(t){var e,n,r=t.length;for(o=new Array(r),e=0;e<r;++e)n=t[e],o[n.index]=+a(n,e,t)}}function d(t){var n,r,i,a,s,l,u=0,c=0,h=t.length;if(h){for(i=a=s=l=0;l<h;++l)(n=t[l])&&(r=Math.abs(n.value))&&(u+=n.value,c+=r,i+=r*(n.x||0),a+=r*(n.y||0),s+=r*(n.z||0));u*=Math.sqrt(4/h),t.x=i/c,e>1&&(t.y=a/c),e>2&&(t.z=s/c)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{u+=o[n.data.index]}while(n=n.next)}t.value=u}function f(t,a,c,h,d){if(!t.value)return!0;var f=[c,h,d][e-1],p=t.x-n.x,g=e>1?t.y-n.y:0,v=e>2?t.z-n.z:0,m=f-a,y=p*p+g*g+v*v;if(m*m/u<y)return y<l&&(0===p&&(y+=(p=Ya(r))*p),e>1&&0===g&&(y+=(g=Ya(r))*g),e>2&&0===v&&(y+=(v=Ya(r))*v),y<s&&(y=Math.sqrt(s*y)),n.vx+=p*t.value*i/y,e>1&&(n.vy+=g*t.value*i/y),e>2&&(n.vz+=v*t.value*i/y)),!0;if(!(t.length||y>=l)){(t.data!==n||t.next)&&(0===p&&(y+=(p=Ya(r))*p),e>1&&0===g&&(y+=(g=Ya(r))*g),e>2&&0===v&&(y+=(v=Ya(r))*v),y<s&&(y=Math.sqrt(s*y)));do{t.data!==n&&(m=o[t.data.index]*i/y,n.vx+=p*m,e>1&&(n.vy+=g*m),e>2&&(n.vz+=v*m))}while(t=t.next)}}return c.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,h()},c.strength=function(t){return arguments.length?(a="function"==typeof t?t:Xa(+t),h(),c):a},c.distanceMin=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c.distanceMax=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c.theta=function(t){return arguments.length?(u=t*t,c):Math.sqrt(u)},c}function hu(t,e,n,r){var i,o,a,s,l=Xa(.1);function u(t){for(var l=0,u=i.length;l<u;++l){var c=i[l],h=c.x-e||1e-6,d=(c.y||0)-n||1e-6,f=(c.z||0)-r||1e-6,p=Math.sqrt(h*h+d*d+f*f),g=(s[l]-p)*a[l]*t/p;c.vx+=h*g,o>1&&(c.vy+=d*g),o>2&&(c.vz+=f*g)}}function c(){if(i){var e,n=i.length;for(a=new Array(n),s=new Array(n),e=0;e<n;++e)s[e]=+t(i[e],e,i),a[e]=isNaN(s[e])?0:+l(i[e],e,i)}}return"function"!=typeof t&&(t=Xa(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),u.initialize=function(t,...e){i=t,o=e.find((t=>[1,2,3].includes(t)))||2,c()},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:Xa(+t),c(),u):l},u.radius=function(e){return arguments.length?(t="function"==typeof e?e:Xa(+e),c(),u):t},u.x=function(t){return arguments.length?(e=+t,u):e},u.y=function(t){return arguments.length?(n=+t,u):n},u.z=function(t){return arguments.length?(r=+t,u):r},u}function du(t){var e,n,r,i=Xa(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Xa(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Xa(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:Xa(+e),a(),o):t},o}function fu(t){var e,n,r,i=Xa(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Xa(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Xa(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Xa(+e),a(),o):t},o}function pu(t){var e,n,r,i=Xa(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vz+=(r[o]-i.z)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Xa(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Xa(+t),a(),o):i},o.z=function(e){return arguments.length?(t="function"==typeof e?e:Xa(+e),a(),o):t},o}function gu(){if(cs)return us;return cs=1,us=function(t,e){return t===e||t!=t&&e!=e}}function vu(){if(ds)return hs;ds=1;var t=gu();return hs=function(e,n){for(var r=e.length;r--;)if(t(e[r][0],n))return r;return-1},hs}function mu(){if(xs)return bs;xs=1;var t=ls?ss:(ls=1,ss=function(){this.__data__=[],this.size=0}),e=function(){if(ps)return fs;ps=1;var t=vu(),e=Array.prototype.splice;return fs=function(n){var r=this.__data__,i=t(r,n);return!(i<0||(i==r.length-1?r.pop():e.call(r,i,1),--this.size,0))},fs}(),n=function(){if(vs)return gs;vs=1;var t=vu();return gs=function(e){var n=this.__data__,r=t(n,e);return r<0?void 0:n[r][1]},gs}(),r=function(){if(ys)return ms;ys=1;var t=vu();return ms=function(e){return t(this.__data__,e)>-1}}(),i=function(){if(_s)return Es;_s=1;var t=vu();return Es=function(e,n){var r=this.__data__,i=t(r,e);return i<0?(++this.size,r.push([e,n])):r[i][1]=n,this},Es}();function o(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,bs=o}function yu(){if(Os)return Cs;Os=1;var t="object"==typeof Wi&&Wi&&Wi.Object===Object&&Wi;return Cs=t}function Eu(){if(Ls)return Is;Ls=1;var t=yu(),e="object"==typeof self&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return Is=n}function _u(){if(Bs)return Ds;Bs=1;var t=Eu().Symbol;return Ds=t}function bu(){if(Vs)return zs;Vs=1;var t=_u(),e=function(){if(Fs)return ks;Fs=1;var t=_u(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;return ks=function(t){var e=n.call(t,i),o=t[i];try{t[i]=void 0;var a=!0}catch(t){}var s=r.call(t);return a&&(e?t[i]=o:delete t[i]),s}}(),n=function(){if(Gs)return Us;Gs=1;var t=Object.prototype.toString;return Us=function(e){return t.call(e)}}(),r=t?t.toStringTag:void 0;return zs=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":r&&r in Object(t)?e(t):n(t)}}function xu(){if(js)return Ws;return js=1,Ws=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}}function Su(){if(Xs)return Hs;Xs=1;var t=bu(),e=xu();return Hs=function(n){if(!e(n))return!1;var r=t(n);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r}}function Mu(){if(qs)return $s;qs=1;var t,e=function(){if(Ks)return Ys;Ks=1;var t=Eu()["__core-js_shared__"];return Ys=t}(),n=(t=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||""))?"Symbol(src)_1."+t:"";return $s=function(t){return!!n&&n in t}}function Au(){if(Qs)return Zs;Qs=1;var t=Function.prototype.toString;return Zs=function(e){if(null!=e){try{return t.call(e)}catch(t){}try{return e+""}catch(t){}}return""}}function Ru(){if(il)return rl;il=1;var t=function(){if(tl)return Js;tl=1;var t=Su(),e=Mu(),n=xu(),r=Au(),i=/^\[object .+?Constructor\]$/,o=Function.prototype,a=Object.prototype,s=o.toString,l=a.hasOwnProperty,u=RegExp("^"+s.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return Js=function(o){return!(!n(o)||e(o))&&(t(o)?u:i).test(r(o))}}(),e=nl?el:(nl=1,el=function(t,e){return null==t?void 0:t[e]});return rl=function(n,r){var i=e(n,r);return t(i)?i:void 0}}function Tu(){if(al)return ol;al=1;var t=Ru()(Eu(),"Map");return ol=t}function wu(){if(ll)return sl;ll=1;var t=Ru()(Object,"create");return sl=t}function Pu(){if(_l)return El;_l=1;var t=function(){if(cl)return ul;cl=1;var t=wu();return ul=function(){this.__data__=t?t(null):{},this.size=0}}(),e=dl?hl:(dl=1,hl=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}),n=function(){if(pl)return fl;pl=1;var t=wu(),e=Object.prototype.hasOwnProperty;return fl=function(n){var r=this.__data__;if(t){var i=r[n];return"__lodash_hash_undefined__"===i?void 0:i}return e.call(r,n)?r[n]:void 0},fl}(),r=function(){if(vl)return gl;vl=1;var t=wu(),e=Object.prototype.hasOwnProperty;return gl=function(n){var r=this.__data__;return t?void 0!==r[n]:e.call(r,n)},gl}(),i=function(){if(yl)return ml;yl=1;var t=wu();return ml=function(e,n){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=t&&void 0===n?"__lodash_hash_undefined__":n,this},ml}();function o(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,El=o}function Nu(){if(Rl)return Al;Rl=1;var t=Ml?Sl:(Ml=1,Sl=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t});return Al=function(e,n){var r=e.__data__;return t(n)?r["string"==typeof n?"string":"hash"]:r.map},Al}function Cu(){if(Bl)return Dl;Bl=1;var t=function(){if(xl)return bl;xl=1;var t=Pu(),e=mu(),n=Tu();return bl=function(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}}(),e=function(){if(wl)return Tl;wl=1;var t=Nu();return Tl=function(e){var n=t(this,e).delete(e);return this.size-=n?1:0,n}}(),n=function(){if(Nl)return Pl;Nl=1;var t=Nu();return Pl=function(e){return t(this,e).get(e)}}(),r=function(){if(Ol)return Cl;Ol=1;var t=Nu();return Cl=function(e){return t(this,e).has(e)}}(),i=function(){if(Ll)return Il;Ll=1;var t=Nu();return Il=function(e,n){var r=t(this,e),i=r.size;return r.set(e,n),this.size+=r.size==i?0:1,this},Il}();function o(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,Dl=o}function Ou(){if(Gl)return Ul;Gl=1;var t=mu(),e=function(){if(Ms)return Ss;Ms=1;var t=mu();return Ss=function(){this.__data__=new t,this.size=0}}(),n=(Rs||(Rs=1,As=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}),As),r=ws?Ts:(ws=1,Ts=function(t){return this.__data__.get(t)}),i=Ns?Ps:(Ns=1,Ps=function(t){return this.__data__.has(t)}),o=function(){if(Fl)return kl;Fl=1;var t=mu(),e=Tu(),n=Cu();return kl=function(r,i){var o=this.__data__;if(o instanceof t){var a=o.__data__;if(!e||a.length<199)return a.push([r,i]),this.size=++o.size,this;o=this.__data__=new n(a)}return o.set(r,i),this.size=o.size,this},kl}();function a(e){var n=this.__data__=new t(e);this.size=n.size}return a.prototype.clear=e,a.prototype.delete=n,a.prototype.get=r,a.prototype.has=i,a.prototype.set=o,Ul=a}function Iu(){if(Vl)return zl;return Vl=1,zl=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},zl}function Lu(){if(jl)return Wl;jl=1;var t=Ru(),e=function(){try{var e=t(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();return Wl=e}function Du(){if(Xl)return Hl;Xl=1;var t=Lu();return Hl=function(e,n,r){"__proto__"==n&&t?t(e,n,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[n]=r}}function Bu(){if(Kl)return Yl;Kl=1;var t=Du(),e=gu(),n=Object.prototype.hasOwnProperty;return Yl=function(r,i,o){var a=r[i];n.call(r,i)&&e(a,o)&&(void 0!==o||i in r)||t(r,i,o)}}function ku(){if(ql)return $l;ql=1;var t=Bu(),e=Du();return $l=function(n,r,i,o){var a=!i;i||(i={});for(var s=-1,l=r.length;++s<l;){var u=r[s],c=o?o(i[u],n[u],u,i,n):void 0;void 0===c&&(c=n[u]),a?e(i,u,c):t(i,u,c)}return i},$l}function Fu(){if(tu)return Jl;return tu=1,Jl=function(t){return null!=t&&"object"==typeof t}}function Uu(){if(iu)return ru;iu=1;var t=function(){if(nu)return eu;nu=1;var t=bu(),e=Fu();return eu=function(n){return e(n)&&"[object Arguments]"==t(n)}}(),e=Fu(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,o=t(function(){return arguments}())?t:function(t){return e(t)&&r.call(t,"callee")&&!i.call(t,"callee")};return ru=o}function Gu(){if(au)return ou;au=1;var t=Array.isArray;return ou=t}var zu,Vu,Wu,ju,Hu,Xu,Yu,Ku,$u,qu,Zu,Qu={exports:{}};function Ju(){return Wu||(Wu=1,function(t,e){var n=Eu(),r=Vu?zu:(Vu=1,zu=function(){return!1}),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?n.Buffer:void 0,s=(a?a.isBuffer:void 0)||r;t.exports=s}(Qu,Qu.exports)),Qu.exports}function tc(){if(Hu)return ju;Hu=1;var t=/^(?:0|[1-9]\d*)$/;return ju=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n},ju}function ec(){if(Yu)return Xu;Yu=1;return Xu=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}}function nc(){if(Zu)return qu;return Zu=1,qu=function(t){return function(e){return t(e)}}}Qu.exports;var rc,ic,oc,ac,sc,lc,uc,cc,hc,dc,fc,pc,gc,vc,mc,yc,Ec,_c,bc,xc,Sc,Mc,Ac,Rc,Tc,wc,Pc,Nc={exports:{}};function Cc(){return rc||(rc=1,function(t,e){var n=yu(),r=e&&!e.nodeType&&e,i=r&&t&&!t.nodeType&&t,o=i&&i.exports===r&&n.process,a=function(){try{var t=i&&i.require&&i.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}(Nc,Nc.exports)),Nc.exports}function Oc(){if(oc)return ic;oc=1;var t=function(){if($u)return Ku;$u=1;var t=bu(),e=ec(),n=Fu(),r={};return r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1,Ku=function(i){return n(i)&&e(i.length)&&!!r[t(i)]}}(),e=nc(),n=Cc(),r=n&&n.isTypedArray,i=r?e(r):t;return ic=i}function Ic(){if(sc)return ac;sc=1;var t=(Ql||(Ql=1,Zl=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}),Zl),e=Uu(),n=Gu(),r=Ju(),i=tc(),o=Oc(),a=Object.prototype.hasOwnProperty;return ac=function(s,l){var u=n(s),c=!u&&e(s),h=!u&&!c&&r(s),d=!u&&!c&&!h&&o(s),f=u||c||h||d,p=f?t(s.length,String):[],g=p.length;for(var v in s)!l&&!a.call(s,v)||f&&("length"==v||h&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||i(v,g))||p.push(v);return p},ac}function Lc(){if(uc)return lc;uc=1;var t=Object.prototype;return lc=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}}function Dc(){if(hc)return cc;return hc=1,cc=function(t,e){return function(n){return t(e(n))}}}function Bc(){if(gc)return pc;gc=1;var t=Lc(),e=function(){if(fc)return dc;fc=1;var t=Dc()(Object.keys,Object);return dc=t}(),n=Object.prototype.hasOwnProperty;return pc=function(r){if(!t(r))return e(r);var i=[];for(var o in Object(r))n.call(r,o)&&"constructor"!=o&&i.push(o);return i}}function kc(){if(mc)return vc;mc=1;var t=Su(),e=ec();return vc=function(n){return null!=n&&e(n.length)&&!t(n)}}function Fc(){if(Ec)return yc;Ec=1;var t=Ic(),e=Bc(),n=kc();return yc=function(r){return n(r)?t(r):e(r)}}function Uc(){if(Ac)return Mc;Ac=1;var t=xu(),e=Lc(),n=Sc?xc:(Sc=1,xc=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}),r=Object.prototype.hasOwnProperty;return Mc=function(i){if(!t(i))return n(i);var o=e(i),a=[];for(var s in i)("constructor"!=s||!o&&r.call(i,s))&&a.push(s);return a}}function Gc(){if(Tc)return Rc;Tc=1;var t=Ic(),e=Uc(),n=kc();return Rc=function(r){return n(r)?t(r,!0):e(r)}}Nc.exports;var zc,Vc,Wc,jc,Hc,Xc,Yc,Kc,$c,qc,Zc,Qc,Jc,th,eh,nh,rh,ih,oh,ah,sh,lh,uh,ch,hh,dh,fh,ph,gh,vh,mh,yh,Eh,_h,bh,xh,Sh,Mh,Ah,Rh,Th,wh,Ph,Nh,Ch,Oh,Ih,Lh,Dh,Bh,kh,Fh,Uh,Gh,zh,Vh,Wh,jh,Hh,Xh,Yh,Kh,$h,qh,Zh,Qh,Jh,td,ed,nd,rd,id,od,ad,sd,ld,ud,cd,hd,dd,fd,pd,gd,vd,md,yd,Ed,_d,bd,xd,Sd,Md,Ad,Rd,Td,wd,Pd,Nd,Cd,Od,Id,Ld,Dd,Bd,kd,Fd,Ud,Gd,zd,Vd,Wd,jd,Hd,Xd,Yd,Kd,$d,qd,Zd,Qd,Jd,tf,ef,nf,rf,of,af,sf,lf,uf,cf,hf,df,ff,pf,gf,vf,mf,yf,Ef,_f,bf,xf,Sf,Mf,Af,Rf,Tf,wf,Pf,Nf,Cf,Of,If,Lf,Df,Bf,kf,Ff,Uf,Gf,zf,Vf,Wf,jf,Hf,Xf,Yf,Kf,$f,qf,Zf,Qf,Jf,tp,ep,np,rp,ip,op,ap,sp,lp,up,cp,hp,dp,fp,pp,gp,vp,mp,yp,Ep,_p,bp,xp,Sp,Mp,Ap,Rp,Tp,wp,Pp,Np,Cp,Op,Ip,Lp,Dp,Bp,kp,Fp,Up,Gp,zp,Vp,Wp,jp,Hp,Xp,Yp,Kp,$p,qp,Zp,Qp,Jp,tg,eg,ng,rg,ig,og,ag,sg,lg,ug,cg,hg,dg,fg,pg,gg,vg,mg,yg,Eg,_g,bg,xg,Sg,Mg,Ag,Rg,Tg,wg,Pg,Ng,Cg,Og,Ig,Lg,Dg,Bg,kg,Fg,Ug,Gg,zg,Vg,Wg,jg,Hg,Xg,Yg,Kg,$g,qg,Zg,Qg={exports:{}};function Jg(){return zc||(zc=1,function(t,e){var n=Eu(),r=e&&!e.nodeType&&e,i=r&&t&&!t.nodeType&&t,o=i&&i.exports===r?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=a?a(n):new t.constructor(n);return t.copy(r),r}}(Qg,Qg.exports)),Qg.exports}function tv(){if(Wc)return Vc;return Wc=1,Vc=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Vc}function ev(){if(Hc)return jc;return Hc=1,jc=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o},jc}function nv(){if(Yc)return Xc;return Yc=1,Xc=function(){return[]}}function rv(){if($c)return Kc;$c=1;var t=ev(),e=nv(),n=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols;return Kc=r?function(e){return null==e?[]:(e=Object(e),t(r(e),(function(t){return n.call(e,t)})))}:e}function iv(){if(Jc)return Qc;return Jc=1,Qc=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},Qc}function ov(){if(eh)return th;eh=1;var t=Dc()(Object.getPrototypeOf,Object);return th=t}function av(){if(rh)return nh;rh=1;var t=iv(),e=ov(),n=rv(),r=nv(),i=Object.getOwnPropertySymbols;return nh=i?function(r){for(var i=[];r;)t(i,n(r)),r=e(r);return i}:r}function sv(){if(sh)return ah;sh=1;var t=iv(),e=Gu();return ah=function(n,r,i){var o=r(n);return e(n)?o:t(o,i(n))}}function lv(){if(uh)return lh;uh=1;var t=sv(),e=rv(),n=Fc();return lh=function(r){return t(r,n,e)}}function uv(){if(mh)return vh;mh=1;var t=Ru()(Eu(),"Set");return vh=t}function cv(){if(bh)return _h;bh=1;var t=function(){if(fh)return dh;fh=1;var t=Ru()(Eu(),"DataView");return dh=t}(),e=Tu(),n=function(){if(gh)return ph;gh=1;var t=Ru()(Eu(),"Promise");return ph=t}(),r=uv(),i=function(){if(Eh)return yh;Eh=1;var t=Ru()(Eu(),"WeakMap");return yh=t}(),o=bu(),a=Au(),s="[object Map]",l="[object Promise]",u="[object Set]",c="[object WeakMap]",h="[object DataView]",d=a(t),f=a(e),p=a(n),g=a(r),v=a(i),m=o;return(t&&m(new t(new ArrayBuffer(1)))!=h||e&&m(new e)!=s||n&&m(n.resolve())!=l||r&&m(new r)!=u||i&&m(new i)!=c)&&(m=function(t){var e=o(t),n="[object Object]"==e?t.constructor:void 0,r=n?a(n):"";if(r)switch(r){case d:return h;case f:return s;case p:return l;case g:return u;case v:return c}return e}),_h=m}function hv(){if(Ah)return Mh;Ah=1;var t=Eu().Uint8Array;return Mh=t}function dv(){if(Th)return Rh;Th=1;var t=hv();return Rh=function(e){var n=new e.constructor(e.byteLength);return new t(n).set(new t(e)),n}}function fv(){if(Dh)return Lh;Dh=1;var t=dv();return Lh=function(e,n){var r=n?t(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},Lh}function pv(){if(kh)return Bh;kh=1;var t=dv(),e=function(){if(Ph)return wh;Ph=1;var t=dv();return wh=function(e,n){var r=n?t(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},wh}(),n=function(){if(Ch)return Nh;Ch=1;var t=/\w*$/;return Nh=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}}(),r=function(){if(Ih)return Oh;Ih=1;var t=_u(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;return Oh=function(t){return n?Object(n.call(t)):{}}}(),i=fv();return Bh=function(o,a,s){var l=o.constructor;switch(a){case"[object ArrayBuffer]":return t(o);case"[object Boolean]":case"[object Date]":return new l(+o);case"[object DataView]":return e(o,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return i(o,s);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(o);case"[object RegExp]":return n(o);case"[object Symbol]":return r(o)}}}function gv(){if(Uh)return Fh;Uh=1;var t=xu(),e=Object.create,n=function(){function n(){}return function(r){if(!t(r))return{};if(e)return e(r);n.prototype=r;var i=new n;return n.prototype=void 0,i}}();return Fh=n}function vv(){if(zh)return Gh;zh=1;var t=gv(),e=ov(),n=Lc();return Gh=function(r){return"function"!=typeof r.constructor||n(r)?{}:t(e(r))}}function mv(){if(Hh)return jh;Hh=1;var t=function(){if(Wh)return Vh;Wh=1;var t=cv(),e=Fu();return Vh=function(n){return e(n)&&"[object Map]"==t(n)}}(),e=nc(),n=Cc(),r=n&&n.isMap,i=r?e(r):t;return jh=i}function yv(){if($h)return Kh;$h=1;var t=function(){if(Yh)return Xh;Yh=1;var t=cv(),e=Fu();return Xh=function(n){return e(n)&&"[object Set]"==t(n)}}(),e=nc(),n=Cc(),r=n&&n.isSet,i=r?e(r):t;return Kh=i}function Ev(){if(Zh)return qh;Zh=1;var t=Ou(),e=Iu(),n=Bu(),r=function(){if(bc)return _c;bc=1;var t=ku(),e=Fc();return _c=function(n,r){return n&&t(r,e(r),n)}}(),i=function(){if(Pc)return wc;Pc=1;var t=ku(),e=Gc();return wc=function(n,r){return n&&t(r,e(r),n)}}(),o=Jg(),a=tv(),s=function(){if(Zc)return qc;Zc=1;var t=ku(),e=rv();return qc=function(n,r){return t(n,e(n),r)}}(),l=function(){if(oh)return ih;oh=1;var t=ku(),e=av();return ih=function(n,r){return t(n,e(n),r)}}(),u=lv(),c=function(){if(hh)return ch;hh=1;var t=sv(),e=av(),n=Gc();return ch=function(r){return t(r,n,e)}}(),h=cv(),d=function(){if(Sh)return xh;Sh=1;var t=Object.prototype.hasOwnProperty;return xh=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r},xh}(),f=pv(),p=vv(),g=Gu(),v=Ju(),m=mv(),y=xu(),E=yv(),_=Fc(),b=Gc(),x="[object Arguments]",S="[object Function]",M="[object Object]",A={};return A[x]=A["[object Array]"]=A["[object ArrayBuffer]"]=A["[object DataView]"]=A["[object Boolean]"]=A["[object Date]"]=A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Map]"]=A["[object Number]"]=A[M]=A["[object RegExp]"]=A["[object Set]"]=A["[object String]"]=A["[object Symbol]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A["[object Error]"]=A[S]=A["[object WeakMap]"]=!1,qh=function R(T,w,P,N,C,O){var I,L=1&w,D=2&w,B=4&w;if(P&&(I=C?P(T,N,C,O):P(T)),void 0!==I)return I;if(!y(T))return T;var k=g(T);if(k){if(I=d(T),!L)return a(T,I)}else{var F=h(T),U=F==S||"[object GeneratorFunction]"==F;if(v(T))return o(T,L);if(F==M||F==x||U&&!C){if(I=D||U?{}:p(T),!L)return D?l(T,i(I,T)):s(T,r(I,T))}else{if(!A[F])return C?T:{};I=f(T,F,L)}}O||(O=new t);var G=O.get(T);if(G)return G;O.set(T,I),E(T)?T.forEach((function(t){I.add(R(t,w,P,t,T,O))})):m(T)&&T.forEach((function(t,e){I.set(e,R(t,w,P,e,T,O))}));var z=k?void 0:(B?D?c:u:D?b:_)(T);return e(z||T,(function(t,e){z&&(t=T[e=t]),n(I,e,R(t,w,P,e,T,O))})),I},qh}function _v(){if(Jh)return Qh;Jh=1;var t=Ev();return Qh=function(e){return t(e,4)}}function bv(){if(ed)return td;return ed=1,td=function(t){return function(){return t}}}function xv(){if(od)return id;od=1;var t=(rd||(rd=1,nd=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var l=a[t?s:++i];if(!1===n(o[l],l,o))break}return e}}),nd),e=t();return id=e}function Sv(){if(sd)return ad;sd=1;var t=xv(),e=Fc();return ad=function(n,r){return n&&t(n,r,e)}}function Mv(){if(hd)return cd;hd=1;var t=Sv(),e=function(){if(ud)return ld;ud=1;var t=kc();return ld=function(e,n){return function(r,i){if(null==r)return r;if(!t(r))return e(r,i);for(var o=r.length,a=n?o:-1,s=Object(r);(n?a--:++a<o)&&!1!==i(s[a],a,s););return r}},ld}(),n=e(t);return cd=n}function Av(){if(fd)return dd;return fd=1,dd=function(t){return t}}function Rv(){if(gd)return pd;gd=1;var t=Av();return pd=function(e){return"function"==typeof e?e:t}}function Tv(){if(md)return vd;md=1;var t=Iu(),e=Mv(),n=Rv(),r=Gu();return vd=function(i,o){return(r(i)?t:e)(i,n(o))}}function wv(){return Ed?yd:(Ed=1,yd=Tv())}function Pv(){if(Td)return Rd;Td=1;var t=Cu(),e=Sd?xd:(Sd=1,xd=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}),n=Ad?Md:(Ad=1,Md=function(t){return this.__data__.has(t)});function r(e){var n=-1,r=null==e?0:e.length;for(this.__data__=new t;++n<r;)this.add(e[n])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,Rd=r}function Nv(){if(Cd)return Nd;return Cd=1,Nd=function(t,e){return t.has(e)}}function Cv(){if(Id)return Od;Id=1;var t=Pv(),e=(Pd||(Pd=1,wd=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}),wd),n=Nv();return Od=function(r,i,o,a,s,l){var u=1&o,c=r.length,h=i.length;if(c!=h&&!(u&&h>c))return!1;var d=l.get(r),f=l.get(i);if(d&&f)return d==i&&f==r;var p=-1,g=!0,v=2&o?new t:void 0;for(l.set(r,i),l.set(i,r);++p<c;){var m=r[p],y=i[p];if(a)var E=u?a(y,m,p,i,r,l):a(m,y,p,r,i,l);if(void 0!==E){if(E)continue;g=!1;break}if(v){if(!e(i,(function(t,e){if(!n(v,e)&&(m===t||s(m,t,o,a,l)))return v.push(e)}))){g=!1;break}}else if(m!==y&&!s(m,y,o,a,l)){g=!1;break}}return l.delete(r),l.delete(i),g},Od}function Ov(){if(kd)return Bd;return kd=1,Bd=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Bd}function Iv(){if(Ud)return Fd;Ud=1;var t=_u(),e=hv(),n=gu(),r=Cv(),i=(Dd||(Dd=1,Ld=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}),Ld),o=Ov(),a=t?t.prototype:void 0,s=a?a.valueOf:void 0;return Fd=function(t,a,l,u,c,h,d){switch(l){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!h(new e(t),new e(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return n(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var f=i;case"[object Set]":var p=1&u;if(f||(f=o),t.size!=a.size&&!p)return!1;var g=d.get(t);if(g)return g==a;u|=2,d.set(t,a);var v=r(f(t),f(a),u,c,h,d);return d.delete(t),v;case"[object Symbol]":if(s)return s.call(t)==s.call(a)}return!1}}function Lv(){if(Wd)return Vd;Wd=1;var t=Ou(),e=Cv(),n=Iv(),r=function(){if(zd)return Gd;zd=1;var t=lv(),e=Object.prototype.hasOwnProperty;return Gd=function(n,r,i,o,a,s){var l=1&i,u=t(n),c=u.length;if(c!=t(r).length&&!l)return!1;for(var h=c;h--;){var d=u[h];if(!(l?d in r:e.call(r,d)))return!1}var f=s.get(n),p=s.get(r);if(f&&p)return f==r&&p==n;var g=!0;s.set(n,r),s.set(r,n);for(var v=l;++h<c;){var m=n[d=u[h]],y=r[d];if(o)var E=l?o(y,m,d,r,n,s):o(m,y,d,n,r,s);if(!(void 0===E?m===y||a(m,y,i,o,s):E)){g=!1;break}v||(v="constructor"==d)}if(g&&!v){var _=n.constructor,b=r.constructor;_==b||!("constructor"in n)||!("constructor"in r)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(g=!1)}return s.delete(n),s.delete(r),g},Gd}(),i=cv(),o=Gu(),a=Ju(),s=Oc(),l="[object Arguments]",u="[object Array]",c="[object Object]",h=Object.prototype.hasOwnProperty;return Vd=function(d,f,p,g,v,m){var y=o(d),E=o(f),_=y?u:i(d),b=E?u:i(f),x=(_=_==l?c:_)==c,S=(b=b==l?c:b)==c,M=_==b;if(M&&a(d)){if(!a(f))return!1;y=!0,x=!1}if(M&&!x)return m||(m=new t),y||s(d)?e(d,f,p,g,v,m):n(d,f,_,p,g,v,m);if(!(1&p)){var A=x&&h.call(d,"__wrapped__"),R=S&&h.call(f,"__wrapped__");if(A||R){var T=A?d.value():d,w=R?f.value():f;return m||(m=new t),v(T,w,p,g,m)}}return!!M&&(m||(m=new t),r(d,f,p,g,v,m))}}function Dv(){if(Hd)return jd;Hd=1;var t=Lv(),e=Fu();return jd=function n(r,i,o,a,s){return r===i||(null==r||null==i||!e(r)&&!e(i)?r!=r&&i!=i:t(r,i,o,a,n,s))},jd}function Bv(){if($d)return Kd;$d=1;var t=xu();return Kd=function(e){return e==e&&!t(e)}}function kv(){if(Jd)return Qd;return Jd=1,Qd=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}}function Fv(){if(ef)return tf;ef=1;var t=function(){if(Yd)return Xd;Yd=1;var t=Ou(),e=Dv();return Xd=function(n,r,i,o){var a=i.length,s=a,l=!o;if(null==n)return!s;for(n=Object(n);a--;){var u=i[a];if(l&&u[2]?u[1]!==n[u[0]]:!(u[0]in n))return!1}for(;++a<s;){var c=(u=i[a])[0],h=n[c],d=u[1];if(l&&u[2]){if(void 0===h&&!(c in n))return!1}else{var f=new t;if(o)var p=o(h,d,c,n,r,f);if(!(void 0===p?e(d,h,3,o,f):p))return!1}}return!0},Xd}(),e=function(){if(Zd)return qd;Zd=1;var t=Bv(),e=Fc();return qd=function(n){for(var r=e(n),i=r.length;i--;){var o=r[i],a=n[o];r[i]=[o,a,t(a)]}return r},qd}(),n=kv();return tf=function(r){var i=e(r);return 1==i.length&&i[0][2]?n(i[0][0],i[0][1]):function(e){return e===r||t(e,r,i)}}}function Uv(){if(rf)return nf;rf=1;var t=bu(),e=Fu();return nf=function(n){return"symbol"==typeof n||e(n)&&"[object Symbol]"==t(n)}}function Gv(){if(af)return of;af=1;var t=Gu(),e=Uv(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;return of=function(i,o){if(t(i))return!1;var a=typeof i;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=i&&!e(i))||(r.test(i)||!n.test(i)||null!=o&&i in Object(o))}}function zv(){if(cf)return uf;cf=1;var t=function(){if(lf)return sf;lf=1;var t=Cu();function e(n,r){if("function"!=typeof n||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var i=function(){var t=arguments,e=r?r.apply(this,t):t[0],o=i.cache;if(o.has(e))return o.get(e);var a=n.apply(this,t);return i.cache=o.set(e,a)||o,a};return i.cache=new(e.Cache||t),i}return e.Cache=t,sf=e}();return uf=function(e){var n=t(e,(function(t){return 500===r.size&&r.clear(),t})),r=n.cache;return n}}function Vv(){if(pf)return ff;return pf=1,ff=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},ff}function Wv(){if(yf)return mf;yf=1;var t=function(){if(vf)return gf;vf=1;var t=_u(),e=Vv(),n=Gu(),r=Uv(),i=t?t.prototype:void 0,o=i?i.toString:void 0;return gf=function t(i){if("string"==typeof i)return i;if(n(i))return e(i,t)+"";if(r(i))return o?o.call(i):"";var a=i+"";return"0"==a&&1/i==-1/0?"-0":a},gf}();return mf=function(e){return null==e?"":t(e)}}function jv(){if(_f)return Ef;_f=1;var t=Gu(),e=Gv(),n=function(){if(df)return hf;df=1;var t=zv(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(e,(function(t,e,i,o){r.push(i?o.replace(n,"$1"):e||t)})),r}));return hf=r}(),r=Wv();return Ef=function(i,o){return t(i)?i:e(i,o)?[i]:n(r(i))}}function Hv(){if(xf)return bf;xf=1;var t=Uv();return bf=function(e){if("string"==typeof e||t(e))return e;var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}}function Xv(){if(Mf)return Sf;Mf=1;var t=jv(),e=Hv();return Sf=function(n,r){for(var i=0,o=(r=t(r,n)).length;null!=n&&i<o;)n=n[e(r[i++])];return i&&i==o?n:void 0},Sf}function Yv(){if(Nf)return Pf;Nf=1;var t=jv(),e=Uu(),n=Gu(),r=tc(),i=ec(),o=Hv();return Pf=function(a,s,l){for(var u=-1,c=(s=t(s,a)).length,h=!1;++u<c;){var d=o(s[u]);if(!(h=null!=a&&l(a,d)))break;a=a[d]}return h||++u!=c?h:!!(c=null==a?0:a.length)&&i(c)&&r(d,c)&&(n(a)||e(a))},Pf}function Kv(){if(Of)return Cf;Of=1;var t=wf?Tf:(wf=1,Tf=function(t,e){return null!=t&&e in Object(t)}),e=Yv();return Cf=function(n,r){return null!=n&&e(n,r,t)}}function $v(){if(Lf)return If;Lf=1;var t=Dv(),e=function(){if(Rf)return Af;Rf=1;var t=Xv();return Af=function(e,n,r){var i=null==e?void 0:t(e,n);return void 0===i?r:i}}(),n=Kv(),r=Gv(),i=Bv(),o=kv(),a=Hv();return If=function(s,l){return r(s)&&i(l)?o(a(s),l):function(r){var i=e(r,s);return void 0===i&&i===l?n(r,s):t(l,i,3)}}}function qv(){if(Bf)return Df;return Bf=1,Df=function(t){return function(e){return null==e?void 0:e[t]}}}function Zv(){if(Gf)return Uf;Gf=1;var t=qv(),e=function(){if(Ff)return kf;Ff=1;var t=Xv();return kf=function(e){return function(n){return t(n,e)}}}(),n=Gv(),r=Hv();return Uf=function(i){return n(i)?t(r(i)):e(i)}}function Qv(){if(Vf)return zf;Vf=1;var t=Fv(),e=$v(),n=Av(),r=Gu(),i=Zv();return zf=function(o){return"function"==typeof o?o:null==o?n:"object"==typeof o?r(o)?e(o[0],o[1]):t(o):i(o)}}function Jv(){if(jf)return Wf;jf=1;var t=ev(),e=function(){if(bd)return _d;bd=1;var t=Mv();return _d=function(e,n){var r=[];return t(e,(function(t,e,i){n(t,e,i)&&r.push(t)})),r},_d}(),n=Qv(),r=Gu();return Wf=function(i,o){return(r(i)?t:e)(i,n(o,3))}}function tm(){if(Kf)return Yf;Kf=1;var t=function(){if(Xf)return Hf;Xf=1;var t=Object.prototype.hasOwnProperty;return Hf=function(e,n){return null!=e&&t.call(e,n)}}(),e=Yv();return Yf=function(n,r){return null!=n&&e(n,r,t)}}function em(){if(qf)return $f;qf=1;var t=Bc(),e=cv(),n=Uu(),r=Gu(),i=kc(),o=Ju(),a=Lc(),s=Oc(),l=Object.prototype.hasOwnProperty;return $f=function(u){if(null==u)return!0;if(i(u)&&(r(u)||"string"==typeof u||"function"==typeof u.splice||o(u)||s(u)||n(u)))return!u.length;var c=e(u);if("[object Map]"==c||"[object Set]"==c)return!u.size;if(a(u))return!t(u).length;for(var h in u)if(l.call(u,h))return!1;return!0}}function nm(){if(Qf)return Zf;return Qf=1,Zf=function(t){return void 0===t}}function rm(){if(tp)return Jf;tp=1;var t=Mv(),e=kc();return Jf=function(n,r){var i=-1,o=e(n)?Array(n.length):[];return t(n,(function(t,e,n){o[++i]=r(t,e,n)})),o},Jf}function im(){if(np)return ep;np=1;var t=Vv(),e=Qv(),n=rm(),r=Gu();return ep=function(i,o){return(r(i)?t:n)(i,e(o,3))}}function om(){if(lp)return sp;lp=1;var t=(ip||(ip=1,rp=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}),rp),e=Mv(),n=Qv(),r=(ap||(ap=1,op=function(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}),op),i=Gu();return sp=function(o,a,s){var l=i(o)?t:r,u=arguments.length<3;return l(o,n(a,4),s,u,e)},sp}function am(){if(yp)return mp;yp=1;var t=function(){if(dp)return hp;dp=1;var t=qv()("length");return hp=t}(),e=function(){if(pp)return fp;pp=1;var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");return fp=function(e){return t.test(e)}}(),n=function(){if(vp)return gp;vp=1;var t="\\ud800-\\udfff",e="["+t+"]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",i="[^"+t+"]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+n+"|"+r+")?",l="[\\ufe0e\\ufe0f]?",u=l+s+"(?:\\u200d(?:"+[i,o,a].join("|")+")"+l+s+")*",c="(?:"+[i+n+"?",n,o,a,e].join("|")+")",h=RegExp(r+"(?="+r+")|"+c+u,"g");return gp=function(t){for(var e=h.lastIndex=0;h.test(t);)++e;return e}}();return mp=function(r){return e(r)?n(r):t(r)}}function sm(){if(_p)return Ep;_p=1;var t=Bc(),e=cv(),n=kc(),r=function(){if(cp)return up;cp=1;var t=bu(),e=Gu(),n=Fu();return up=function(r){return"string"==typeof r||!e(r)&&n(r)&&"[object String]"==t(r)}}(),i=am();return Ep=function(o){if(null==o)return 0;if(n(o))return r(o)?i(o):o.length;var a=e(o);return"[object Map]"==a||"[object Set]"==a?o.size:t(o).length}}function lm(){if(xp)return bp;xp=1;var t=Iu(),e=gv(),n=Sv(),r=Qv(),i=ov(),o=Gu(),a=Ju(),s=Su(),l=xu(),u=Oc();return bp=function(c,h,d){var f=o(c),p=f||a(c)||u(c);if(h=r(h,4),null==d){var g=c&&c.constructor;d=p?f?new g:[]:l(c)&&s(g)?e(i(c)):{}}return(p?t:n)(c,(function(t,e,n){return h(d,t,e,n)})),d},bp}function um(){if(Rp)return Ap;Rp=1;var t=iv(),e=function(){if(Mp)return Sp;Mp=1;var t=_u(),e=Uu(),n=Gu(),r=t?t.isConcatSpreadable:void 0;return Sp=function(t){return n(t)||e(t)||!!(r&&t&&t[r])}}();return Ap=function n(r,i,o,a,s){var l=-1,u=r.length;for(o||(o=e),s||(s=[]);++l<u;){var c=r[l];i>0&&o(c)?i>1?n(c,i-1,o,a,s):t(s,c):a||(s[s.length]=c)}return s},Ap}function cm(){if(Np)return Pp;Np=1;var t=wp?Tp:(wp=1,Tp=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}),e=Math.max;return Pp=function(n,r,i){return r=e(void 0===r?n.length-1:r,0),function(){for(var o=arguments,a=-1,s=e(o.length-r,0),l=Array(s);++a<s;)l[a]=o[r+a];a=-1;for(var u=Array(r+1);++a<r;)u[a]=o[a];return u[r]=i(l),t(n,this,u)}},Pp}function hm(){if(Bp)return Dp;Bp=1;var t=function(){if(Op)return Cp;Op=1;var t=bv(),e=Lu(),n=Av();return Cp=e?function(n,r){return e(n,"toString",{configurable:!0,enumerable:!1,value:t(r),writable:!0})}:n}(),e=function(){if(Lp)return Ip;Lp=1;var t=Date.now;return Ip=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}},Ip}(),n=e(t);return Dp=n}function dm(){if(Fp)return kp;Fp=1;var t=Av(),e=cm(),n=hm();return kp=function(r,i){return n(e(r,i,t),r+"")}}function fm(){if(Gp)return Up;return Gp=1,Up=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1},Up}function pm(){if(Xp)return Hp;Xp=1;var t=fm(),e=Vp?zp:(Vp=1,zp=function(t){return t!=t}),n=(jp||(jp=1,Wp=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}),Wp);return Hp=function(r,i,o){return i==i?n(r,i,o):t(r,e,o)}}function gm(){if(tg)return Jp;tg=1;var t=uv(),e=Qp?Zp:(Qp=1,Zp=function(){}),n=Ov(),r=t&&1/n(new t([,-0]))[1]==1/0?function(e){return new t(e)}:e;return Jp=r}function vm(){if(ng)return eg;ng=1;var t=Pv(),e=function(){if(Kp)return Yp;Kp=1;var t=pm();return Yp=function(e,n){return!(null==e||!e.length)&&t(e,n,0)>-1}}(),n=(qp||(qp=1,$p=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}),$p),r=Nv(),i=gm(),o=Ov();return eg=function(a,s,l){var u=-1,c=e,h=a.length,d=!0,f=[],p=f;if(l)d=!1,c=n;else if(h>=200){var g=s?null:i(a);if(g)return o(g);d=!1,c=r,p=new t}else p=s?[]:f;t:for(;++u<h;){var v=a[u],m=s?s(v):v;if(v=l||0!==v?v:0,d&&m==m){for(var y=p.length;y--;)if(p[y]===m)continue t;s&&p.push(m),f.push(v)}else c(p,m,l)||(p!==f&&p.push(m),f.push(v))}return f},eg}function mm(){if(ig)return rg;ig=1;var t=kc(),e=Fu();return rg=function(n){return e(n)&&t(n)}}function ym(){if(ag)return og;ag=1;var t=um(),e=dm(),n=vm(),r=mm(),i=e((function(e){return n(t(e,1,r,!0))}));return og=i}function Em(){if(cg)return ug;cg=1;var t=function(){if(lg)return sg;lg=1;var t=Vv();return sg=function(e,n){return t(n,(function(t){return e[t]}))}}(),e=Fc();return ug=function(n){return null==n?[]:t(n,e(n))}}function _m(){if(dg)return hg;var t;dg=1;try{t={clone:_v(),constant:bv(),each:wv(),filter:Jv(),has:tm(),isArray:Gu(),isEmpty:em(),isFunction:Su(),isUndefined:nm(),keys:Fc(),map:im(),reduce:om(),size:sm(),transform:lm(),union:ym(),values:Em()}}catch(t){}return t||(t=window._),hg=t}function bm(){if(pg)return fg;pg=1;var t=_m();fg=i;var e="\0",n="\0",r="";function i(e){this._isDirected=!t.has(e,"directed")||e.directed,this._isMultigraph=!!t.has(e,"multigraph")&&e.multigraph,this._isCompound=!!t.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function o(t,e){t[e]?t[e]++:t[e]=1}function a(t,e){--t[e]||delete t[e]}function s(n,i,o,a){var s=""+i,l=""+o;if(!n&&s>l){var u=s;s=l,l=u}return s+r+l+r+(t.isUndefined(a)?e:a)}function l(t,e){return s(t,e.v,e.w,e.name)}return i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(t){return this._label=t,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(e){return t.isFunction(e)||(e=t.constant(e)),this._defaultNodeLabelFn=e,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var e=this;return t.filter(this.nodes(),(function(n){return t.isEmpty(e._in[n])}))},i.prototype.sinks=function(){var e=this;return t.filter(this.nodes(),(function(n){return t.isEmpty(e._out[n])}))},i.prototype.setNodes=function(e,n){var r=arguments,i=this;return t.each(e,(function(t){r.length>1?i.setNode(t,n):i.setNode(t)})),this},i.prototype.setNode=function(e,r){return t.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=r),this):(this._nodes[e]=arguments.length>1?r:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=n,this._children[e]={},this._children[n][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},i.prototype.node=function(t){return this._nodes[t]},i.prototype.hasNode=function(e){return t.has(this._nodes,e)},i.prototype.removeNode=function(e){var n=this;if(t.has(this._nodes,e)){var r=function(t){n.removeEdge(n._edgeObjs[t])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],t.each(this.children(e),(function(t){n.setParent(t)})),delete this._children[e]),t.each(t.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],t.each(t.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},i.prototype.setParent=function(e,r){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(r))r=n;else{for(var i=r+="";!t.isUndefined(i);i=this.parent(i))if(i===e)throw new Error("Setting "+r+" as parent of "+e+" would create a cycle");this.setNode(r)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=r,this._children[r][e]=!0,this},i.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]},i.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==n)return e}},i.prototype.children=function(e){if(t.isUndefined(e)&&(e=n),this._isCompound){var r=this._children[e];if(r)return t.keys(r)}else{if(e===n)return this.nodes();if(this.hasNode(e))return[]}},i.prototype.predecessors=function(e){var n=this._preds[e];if(n)return t.keys(n)},i.prototype.successors=function(e){var n=this._sucs[e];if(n)return t.keys(n)},i.prototype.neighbors=function(e){var n=this.predecessors(e);if(n)return t.union(n,this.successors(e))},i.prototype.isLeaf=function(t){return 0===(this.isDirected()?this.successors(t):this.neighbors(t)).length},i.prototype.filterNodes=function(e){var n=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});n.setGraph(this.graph());var r=this;t.each(this._nodes,(function(t,r){e(r)&&n.setNode(r,t)})),t.each(this._edgeObjs,(function(t){n.hasNode(t.v)&&n.hasNode(t.w)&&n.setEdge(t,r.edge(t))}));var i={};function o(t){var e=r.parent(t);return void 0===e||n.hasNode(e)?(i[t]=e,e):e in i?i[e]:o(e)}return this._isCompound&&t.each(n.nodes(),(function(t){n.setParent(t,o(t))})),n},i.prototype.setDefaultEdgeLabel=function(e){return t.isFunction(e)||(e=t.constant(e)),this._defaultEdgeLabelFn=e,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(e,n){var r=this,i=arguments;return t.reduce(e,(function(t,e){return i.length>1?r.setEdge(t,e,n):r.setEdge(t,e),e})),this},i.prototype.setEdge=function(){var e,n,r,i,a=!1,l=arguments[0];"object"==typeof l&&null!==l&&"v"in l?(e=l.v,n=l.w,r=l.name,2===arguments.length&&(i=arguments[1],a=!0)):(e=l,n=arguments[1],r=arguments[3],arguments.length>2&&(i=arguments[2],a=!0)),e=""+e,n=""+n,t.isUndefined(r)||(r=""+r);var u=s(this._isDirected,e,n,r);if(t.has(this._edgeLabels,u))return a&&(this._edgeLabels[u]=i),this;if(!t.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(n),this._edgeLabels[u]=a?i:this._defaultEdgeLabelFn(e,n,r);var c=function(t,e,n,r){var i=""+e,o=""+n;if(!t&&i>o){var a=i;i=o,o=a}var s={v:i,w:o};r&&(s.name=r);return s}(this._isDirected,e,n,r);return e=c.v,n=c.w,Object.freeze(c),this._edgeObjs[u]=c,o(this._preds[n],e),o(this._sucs[e],n),this._in[n][u]=c,this._out[e][u]=c,this._edgeCount++,this},i.prototype.edge=function(t,e,n){var r=1===arguments.length?l(this._isDirected,arguments[0]):s(this._isDirected,t,e,n);return this._edgeLabels[r]},i.prototype.hasEdge=function(e,n,r){var i=1===arguments.length?l(this._isDirected,arguments[0]):s(this._isDirected,e,n,r);return t.has(this._edgeLabels,i)},i.prototype.removeEdge=function(t,e,n){var r=1===arguments.length?l(this._isDirected,arguments[0]):s(this._isDirected,t,e,n),i=this._edgeObjs[r];return i&&(t=i.v,e=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],a(this._preds[e],t),a(this._sucs[t],e),delete this._in[e][r],delete this._out[t][r],this._edgeCount--),this},i.prototype.inEdges=function(e,n){var r=this._in[e];if(r){var i=t.values(r);return n?t.filter(i,(function(t){return t.v===n})):i}},i.prototype.outEdges=function(e,n){var r=this._out[e];if(r){var i=t.values(r);return n?t.filter(i,(function(t){return t.w===n})):i}},i.prototype.nodeEdges=function(t,e){var n=this.inEdges(t,e);if(n)return n.concat(this.outEdges(t,e))},fg}function xm(){if(_g)return Eg;_g=1;var t=_m(),e=bm();function n(e){return t.map(e.nodes(),(function(n){var r=e.node(n),i=e.parent(n),o={v:n};return t.isUndefined(r)||(o.value=r),t.isUndefined(i)||(o.parent=i),o}))}function r(e){return t.map(e.edges(),(function(n){var r=e.edge(n),i={v:n.v,w:n.w};return t.isUndefined(n.name)||(i.name=n.name),t.isUndefined(r)||(i.value=r),i}))}return Eg={write:function(e){var i={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:n(e),edges:r(e)};t.isUndefined(e.graph())||(i.value=t.clone(e.graph()));return i},read:function(n){var r=new e(n.options).setGraph(n.value);return t.each(n.nodes,(function(t){r.setNode(t.v,t.value),t.parent&&r.setParent(t.v,t.parent)})),t.each(n.edges,(function(t){r.setEdge({v:t.v,w:t.w,name:t.name},t.value)})),r}}}function Sm(){if(xg)return bg;xg=1;var t=_m();return bg=function(e){var n,r={},i=[];function o(i){t.has(r,i)||(r[i]=!0,n.push(i),t.each(e.successors(i),o),t.each(e.predecessors(i),o))}return t.each(e.nodes(),(function(t){n=[],o(t),n.length&&i.push(n)})),i},bg}function Mm(){if(Mg)return Sg;Mg=1;var t=_m();function e(){this._arr=[],this._keyIndices={}}return Sg=e,e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map((function(t){return t.key}))},e.prototype.has=function(e){return t.has(this._keyIndices,e)},e.prototype.priority=function(t){var e=this._keyIndices[t];if(void 0!==e)return this._arr[e].priority},e.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(e,n){var r=this._keyIndices;if(e=String(e),!t.has(r,e)){var i=this._arr,o=i.length;return r[e]=o,i.push({key:e,priority:n}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},e.prototype.decrease=function(t,e){var n=this._keyIndices[t];if(e>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[n].priority+" New: "+e);this._arr[n].priority=e,this._decrease(n)},e.prototype._heapify=function(t){var e=this._arr,n=2*t,r=n+1,i=t;n<e.length&&(i=e[n].priority<e[i].priority?n:i,r<e.length&&(i=e[r].priority<e[i].priority?r:i),i!==t&&(this._swap(t,i),this._heapify(i)))},e.prototype._decrease=function(t){for(var e,n=this._arr,r=n[t].priority;0!==t&&!(n[e=t>>1].priority<r);)this._swap(t,e),t=e},e.prototype._swap=function(t,e){var n=this._arr,r=this._keyIndices,i=n[t],o=n[e];n[t]=o,n[e]=i,r[o.key]=t,r[i.key]=e},Sg}function Am(){if(Rg)return Ag;Rg=1;var t=_m(),e=Mm();Ag=function(t,r,i,o){return function(t,n,r,i){var o,a,s={},l=new e,u=function(t){var e=t.v!==o?t.v:t.w,n=s[e],i=r(t),u=a.distance+i;if(i<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+t+" Weight: "+i);u<n.distance&&(n.distance=u,n.predecessor=o,l.decrease(e,u))};t.nodes().forEach((function(t){var e=t===n?0:Number.POSITIVE_INFINITY;s[t]={distance:e},l.add(t,e)}));for(;l.size()>0&&(o=l.removeMin(),(a=s[o]).distance!==Number.POSITIVE_INFINITY);)i(o).forEach(u);return s}(t,String(r),i||n,o||function(e){return t.outEdges(e)})};var n=t.constant(1);return Ag}function Rm(){if(wg)return Tg;wg=1;var t=Am(),e=_m();return Tg=function(n,r,i){return e.transform(n.nodes(),(function(e,o){e[o]=t(n,o,r,i)}),{})}}function Tm(){if(Ng)return Pg;Ng=1;var t=_m();return Pg=function(e){var n=0,r=[],i={},o=[];function a(s){var l=i[s]={onStack:!0,lowlink:n,index:n++};if(r.push(s),e.successors(s).forEach((function(e){t.has(i,e)?i[e].onStack&&(l.lowlink=Math.min(l.lowlink,i[e].index)):(a(e),l.lowlink=Math.min(l.lowlink,i[e].lowlink))})),l.lowlink===l.index){var u,c=[];do{u=r.pop(),i[u].onStack=!1,c.push(u)}while(s!==u);o.push(c)}}return e.nodes().forEach((function(e){t.has(i,e)||a(e)})),o},Pg}function wm(){if(Og)return Cg;Og=1;var t=_m(),e=Tm();return Cg=function(n){return t.filter(e(n),(function(t){return t.length>1||1===t.length&&n.hasEdge(t[0],t[0])}))}}function Pm(){if(Lg)return Ig;Lg=1;var t=_m();Ig=function(t,n,r){return function(t,e,n){var r={},i=t.nodes();return i.forEach((function(t){r[t]={},r[t][t]={distance:0},i.forEach((function(e){t!==e&&(r[t][e]={distance:Number.POSITIVE_INFINITY})})),n(t).forEach((function(n){var i=n.v===t?n.w:n.v,o=e(n);r[t][i]={distance:o,predecessor:t}}))})),i.forEach((function(t){var e=r[t];i.forEach((function(n){var o=r[n];i.forEach((function(n){var r=o[t],i=e[n],a=o[n],s=r.distance+i.distance;s<a.distance&&(a.distance=s,a.predecessor=i.predecessor)}))}))})),r}(t,n||e,r||function(e){return t.outEdges(e)})};var e=t.constant(1);return Ig}function Nm(){if(Bg)return Dg;Bg=1;var t=_m();function e(e){var r={},i={},o=[];if(t.each(e.sinks(),(function a(s){if(t.has(i,s))throw new n;t.has(r,s)||(i[s]=!0,r[s]=!0,t.each(e.predecessors(s),a),delete i[s],o.push(s))})),t.size(r)!==e.nodeCount())throw new n;return o}function n(){}return Dg=e,e.CycleException=n,n.prototype=new Error,Dg}function Cm(){if(Fg)return kg;Fg=1;var t=Nm();return kg=function(e){try{t(e)}catch(e){if(e instanceof t.CycleException)return!1;throw e}return!0}}function Om(){if(Gg)return Ug;Gg=1;var t=_m();function e(n,r,i,o,a,s){t.has(o,r)||(o[r]=!0,i||s.push(r),t.each(a(r),(function(t){e(n,t,i,o,a,s)})),i&&s.push(r))}return Ug=function(n,r,i){t.isArray(r)||(r=[r]);var o=(n.isDirected()?n.successors:n.neighbors).bind(n),a=[],s={};return t.each(r,(function(t){if(!n.hasNode(t))throw new Error("Graph does not have node: "+t);e(n,t,"post"===i,s,o,a)})),a},Ug}function Im(){if(Vg)return zg;Vg=1;var t=Om();return zg=function(e,n){return t(e,n,"post")}}function Lm(){if(jg)return Wg;jg=1;var t=Om();return Wg=function(e,n){return t(e,n,"pre")}}function Dm(){if(Xg)return Hg;Xg=1;var t=_m(),e=bm(),n=Mm();return Hg=function(r,i){var o,a=new e,s={},l=new n;function u(t){var e=t.v===o?t.w:t.v,n=l.priority(e);if(void 0!==n){var r=i(t);r<n&&(s[e]=o,l.decrease(e,r))}}if(0===r.nodeCount())return a;t.each(r.nodes(),(function(t){l.add(t,Number.POSITIVE_INFINITY),a.setNode(t)})),l.decrease(r.nodes()[0],0);var c=!1;for(;l.size()>0;){if(o=l.removeMin(),t.has(s,o))a.setEdge(o,s[o]);else{if(c)throw new Error("Input graph is not connected: "+r);c=!0}r.nodeEdges(o).forEach(u)}return a}}Qg.exports;try{Zg=function(){if(qg)return $g;qg=1;var t=yg?mg:(yg=1,mg={Graph:bm(),version:vg?gg:(vg=1,gg="2.1.8")});return $g={Graph:t.Graph,json:xm(),alg:Kg?Yg:(Kg=1,Yg={components:Sm(),dijkstra:Am(),dijkstraAll:Rm(),findCycles:wm(),floydWarshall:Pm(),isAcyclic:Cm(),postorder:Im(),preorder:Lm(),prim:Dm(),tarjan:Tm(),topsort:Nm()}),version:t.version}}()}catch(t){}Zg||(Zg=window.graphlib);var Bm,km,Fm,Um,Gm,zm,Vm,Wm,jm,Hm,Xm,Ym,Km,$m,qm,Zm,Qm,Jm,ty,ey,ny,ry,iy,oy,ay,sy,ly,uy,cy,hy,dy,fy,py,gy,vy,my,yy,Ey,_y,by,xy,Sy,My,Ay,Ry,Ty,wy,Py,Ny,Cy,Oy,Iy,Ly,Dy,By,ky,Fy,Uy,Gy,zy,Vy,Wy,jy,Hy,Xy,Yy,Ky,$y,qy,Zy,Qy,Jy,tE,eE,nE,rE,iE,oE,aE,sE,lE,uE,cE,hE,dE,fE,pE,gE,vE,mE,yE,EE,_E,bE=Zg;function xE(){if(Um)return Fm;Um=1;var t=gu(),e=kc(),n=tc(),r=xu();return Fm=function(i,o,a){if(!r(a))return!1;var s=typeof o;return!!("number"==s?e(a)&&n(o,a.length):"string"==s&&o in a)&&t(a[o],i)},Fm}function SE(){if(Ym)return Xm;Ym=1;var t=function(){if(Hm)return jm;Hm=1;var t=/\s/;return jm=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n},jm}(),e=/^\s+/;return Xm=function(n){return n?n.slice(0,t(n)+1).replace(e,""):n}}function ME(){if(Zm)return qm;Zm=1;var t=function(){if($m)return Km;$m=1;var t=SE(),e=xu(),n=Uv(),r=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt;return Km=function(s){if("number"==typeof s)return s;if(n(s))return NaN;if(e(s)){var l="function"==typeof s.valueOf?s.valueOf():s;s=e(l)?l+"":l}if("string"!=typeof s)return 0===s?s:+s;s=t(s);var u=i.test(s);return u||o.test(s)?a(s.slice(2),u?2:8):r.test(s)?NaN:+s}}(),e=1/0;return qm=function(n){return n?(n=t(n))===e||n===-1/0?17976931348623157e292*(n<0?-1:1):n==n?n:0:0===n?n:0}}function AE(){if(ey)return ty;ey=1;var t=fm(),e=Qv(),n=function(){if(Jm)return Qm;Jm=1;var t=ME();return Qm=function(e){var n=t(e),r=n%1;return n==n?r?n-r:n:0}}(),r=Math.max;return ty=function(i,o,a){var s=null==i?0:i.length;if(!s)return-1;var l=null==a?0:n(a);return l<0&&(l=r(s+l,0)),t(i,e(o,3),l)},ty}function RE(){if(oy)return iy;oy=1;var t=um();return iy=function(e){return(null==e?0:e.length)?t(e,1):[]}}function TE(){if(fy)return dy;fy=1;var t=Uv();return dy=function(e,n,r){for(var i=-1,o=e.length;++i<o;){var a=e[i],s=n(a);if(null!=s&&(void 0===l?s==s&&!t(s):r(s,l)))var l=s,u=a}return u},dy}function wE(){if(Ey)return yy;Ey=1;var t=Du(),e=gu();return yy=function(n,r,i){(void 0!==i&&!e(n[r],i)||void 0===i&&!(r in n))&&t(n,r,i)}}function PE(){if(Sy)return xy;return Sy=1,xy=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}}function NE(){if(Ty)return Ry;Ty=1;var t=wE(),e=Jg(),n=fv(),r=tv(),i=vv(),o=Uu(),a=Gu(),s=mm(),l=Ju(),u=Su(),c=xu(),h=function(){if(by)return _y;by=1;var t=bu(),e=ov(),n=Fu(),r=Function.prototype,i=Object.prototype,o=r.toString,a=i.hasOwnProperty,s=o.call(Object);return _y=function(r){if(!n(r)||"[object Object]"!=t(r))return!1;var i=e(r);if(null===i)return!0;var l=a.call(i,"constructor")&&i.constructor;return"function"==typeof l&&l instanceof l&&o.call(l)==s}}(),d=Oc(),f=PE(),p=function(){if(Ay)return My;Ay=1;var t=ku(),e=Gc();return My=function(n){return t(n,e(n))}}();return Ry=function(g,v,m,y,E,_,b){var x=f(g,m),S=f(v,m),M=b.get(S);if(M)t(g,m,M);else{var A=_?_(x,S,m+"",g,v,b):void 0,R=void 0===A;if(R){var T=a(S),w=!T&&l(S),P=!T&&!w&&d(S);A=S,T||w||P?a(x)?A=x:s(x)?A=r(x):w?(R=!1,A=e(S,!0)):P?(R=!1,A=n(S,!0)):A=[]:h(S)||o(S)?(A=x,o(x)?A=p(x):c(x)&&!u(x)||(A=i(S))):R=!1}R&&(b.set(S,A),E(A,S,y,_,b),b.delete(S)),t(g,m,A)}}}function CE(){if(Dy)return Ly;return Dy=1,Ly=function(t,e){return t<e}}function OE(){if(Hy)return jy;Hy=1;var t=Xv(),e=function(){if(Wy)return Vy;Wy=1;var t=Bu(),e=jv(),n=tc(),r=xu(),i=Hv();return Vy=function(o,a,s,l){if(!r(o))return o;for(var u=-1,c=(a=e(a,o)).length,h=c-1,d=o;null!=d&&++u<c;){var f=i(a[u]),p=s;if("__proto__"===f||"constructor"===f||"prototype"===f)return o;if(u!=h){var g=d[f];void 0===(p=l?l(g,f,d):void 0)&&(p=r(g)?g:n(a[u+1])?[]:{})}t(d,f,p),d=d[f]}return o},Vy}(),n=jv();return jy=function(r,i,o){for(var a=-1,s=i.length,l={};++a<s;){var u=i[a],c=t(r,u);o(c,u)&&e(l,n(u,r),c)}return l},jy}function IE(){if(eE)return tE;eE=1;var t=function(){if(Jy)return Qy;Jy=1;var t=Math.ceil,e=Math.max;return Qy=function(n,r,i,o){for(var a=-1,s=e(t((r-n)/(i||1)),0),l=Array(s);s--;)l[o?s:++a]=n,n+=i;return l},Qy}(),e=xE(),n=ME();return tE=function(r){return function(i,o,a){return a&&"number"!=typeof a&&e(i,o,a)&&(o=a=void 0),i=n(i),void 0===o?(o=i,i=0):o=n(o),a=void 0===a?i<o?1:-1:n(a),t(i,o,a,r)}},tE}function LE(){if(uE)return lE;uE=1;var t=function(){if(sE)return aE;sE=1;var t=Uv();return aE=function(e,n){if(e!==n){var r=void 0!==e,i=null===e,o=e==e,a=t(e),s=void 0!==n,l=null===n,u=n==n,c=t(n);if(!l&&!c&&!a&&e>n||a&&s&&u&&!l&&!c||i&&s&&u||!r&&u||!o)return 1;if(!i&&!a&&!c&&e<n||c&&r&&o&&!i&&!a||l&&r&&o||!s&&o||!u)return-1}return 0}}();return lE=function(e,n,r){for(var i=-1,o=e.criteria,a=n.criteria,s=o.length,l=r.length;++i<s;){var u=t(o[i],a[i]);if(u)return i>=l?u:u*("desc"==r[i]?-1:1)}return e.index-n.index},lE}function DE(){if(hE)return cE;hE=1;var t=Vv(),e=Xv(),n=Qv(),r=rm(),i=(oE||(oE=1,iE=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}),iE),o=nc(),a=LE(),s=Av(),l=Gu();return cE=function(u,c,h){c=c.length?t(c,(function(t){return l(t)?function(n){return e(n,1===t.length?t[0]:t)}:t})):[s];var d=-1;c=t(c,o(n));var f=r(u,(function(e,n,r){return{criteria:t(c,(function(t){return t(e)})),index:++d,value:e}}));return i(f,(function(t,e){return a(t,e,h)}))},cE}try{_E={cloneDeep:function(){if(km)return Bm;km=1;var t=Ev();return Bm=function(e){return t(e,5)}}(),constant:bv(),defaults:function(){if(zm)return Gm;zm=1;var t=dm(),e=gu(),n=xE(),r=Gc(),i=Object.prototype,o=i.hasOwnProperty,a=t((function(t,a){t=Object(t);var s=-1,l=a.length,u=l>2?a[2]:void 0;for(u&&n(a[0],a[1],u)&&(l=1);++s<l;)for(var c=a[s],h=r(c),d=-1,f=h.length;++d<f;){var p=h[d],g=t[p];(void 0===g||e(g,i[p])&&!o.call(t,p))&&(t[p]=c[p])}return t}));return Gm=a}(),each:wv(),filter:Jv(),find:function(){if(ry)return ny;ry=1;var t=function(){if(Wm)return Vm;Wm=1;var t=Qv(),e=kc(),n=Fc();return Vm=function(r){return function(i,o,a){var s=Object(i);if(!e(i)){var l=t(o,3);i=n(i),o=function(t){return l(s[t],t,s)}}var u=r(i,o,a);return u>-1?s[l?i[u]:u]:void 0}},Vm}(),e=t(AE());return ny=e}(),flatten:RE(),forEach:Tv(),forIn:function(){if(sy)return ay;sy=1;var t=xv(),e=Rv(),n=Gc();return ay=function(r,i){return null==r?r:t(r,e(i),n)}}(),has:tm(),isUndefined:nm(),last:(uy||(uy=1,ly=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}),ly),map:im(),mapValues:function(){if(hy)return cy;hy=1;var t=Du(),e=Sv(),n=Qv();return cy=function(r,i){var o={};return i=n(i,3),e(r,(function(e,n,r){t(o,n,i(e,n,r))})),o}}(),max:function(){if(my)return vy;my=1;var t=TE(),e=gy?py:(gy=1,py=function(t,e){return t>e}),n=Av();return vy=function(r){return r&&r.length?t(r,n,e):void 0}}(),merge:function(){if(Iy)return Oy;Iy=1;var t=function(){if(Py)return wy;Py=1;var t=Ou(),e=wE(),n=xv(),r=NE(),i=xu(),o=Gc(),a=PE();return wy=function s(l,u,c,h,d){l!==u&&n(u,(function(n,o){if(d||(d=new t),i(n))r(l,u,o,c,s,h,d);else{var f=h?h(a(l,o),n,o+"",l,u,d):void 0;void 0===f&&(f=n),e(l,o,f)}}),o)},wy}(),e=function(){if(Cy)return Ny;Cy=1;var t=dm(),e=xE();return Ny=function(n){return t((function(t,r){var i=-1,o=r.length,a=o>1?r[o-1]:void 0,s=o>2?r[2]:void 0;for(a=n.length>3&&"function"==typeof a?(o--,a):void 0,s&&e(r[0],r[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++i<o;){var l=r[i];l&&n(t,l,i,a)}return t}))},Ny}(),n=e((function(e,n,r){t(e,n,r)}));return Oy=n}(),min:function(){if(ky)return By;ky=1;var t=TE(),e=CE(),n=Av();return By=function(r){return r&&r.length?t(r,n,e):void 0}}(),minBy:function(){if(Uy)return Fy;Uy=1;var t=TE(),e=Qv(),n=CE();return Fy=function(r,i){return r&&r.length?t(r,e(i,2),n):void 0}}(),now:function(){if(zy)return Gy;zy=1;var t=Eu();return Gy=function(){return t.Date.now()}}(),pick:function(){if(Zy)return qy;Zy=1;var t=function(){if(Yy)return Xy;Yy=1;var t=OE(),e=Kv();return Xy=function(n,r){return t(n,r,(function(t,r){return e(n,r)}))}}(),e=function(){if($y)return Ky;$y=1;var t=RE(),e=cm(),n=hm();return Ky=function(r){return n(e(r,void 0,t),r+"")}}()((function(e,n){return null==e?{}:t(e,n)}));return qy=e}(),range:function(){if(rE)return nE;rE=1;var t=IE()();return nE=t}(),reduce:om(),sortBy:function(){if(fE)return dE;fE=1;var t=um(),e=DE(),n=dm(),r=xE(),i=n((function(n,i){if(null==n)return[];var o=i.length;return o>1&&r(n,i[0],i[1])?i=[]:o>2&&r(i[0],i[1],i[2])&&(i=[i[0]]),e(n,t(i,1),[])}));return dE=i}(),uniqueId:function(){if(gE)return pE;gE=1;var t=Wv(),e=0;return pE=function(n){var r=++e;return t(n)+r},pE}(),values:Em(),zipObject:function(){if(EE)return yE;EE=1;var t=Bu(),e=(mE||(mE=1,vE=function(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var s=r<o?e[r]:void 0;n(a,t[r],s)}return a}),vE);return yE=function(n,r){return e(n||[],r||[],t)}}()}}catch(t){}_E||(_E=window._);var BE=_E,kE=FE;function FE(){var t={};t._next=t._prev=t,this._sentinel=t}function UE(t){t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev}function GE(t,e){if("_next"!==t&&"_prev"!==t)return e}FE.prototype.dequeue=function(){var t=this._sentinel,e=t._prev;if(e!==t)return UE(e),e},FE.prototype.enqueue=function(t){var e=this._sentinel;t._prev&&t._next&&UE(t),t._next=e._next,e._next._prev=t,e._next=t,t._prev=e},FE.prototype.toString=function(){for(var t=[],e=this._sentinel,n=e._prev;n!==e;)t.push(JSON.stringify(n,GE)),n=n._prev;return"["+t.join(", ")+"]"};var zE=BE,VE=bE.Graph,WE=kE,jE=function(t,e){if(t.nodeCount()<=1)return[];var n=function(t,e){var n=new VE,r=0,i=0;zE.forEach(t.nodes(),(function(t){n.setNode(t,{v:t,in:0,out:0})})),zE.forEach(t.edges(),(function(t){var o=n.edge(t.v,t.w)||0,a=e(t),s=o+a;n.setEdge(t.v,t.w,s),i=Math.max(i,n.node(t.v).out+=a),r=Math.max(r,n.node(t.w).in+=a)}));var o=zE.range(i+r+3).map((function(){return new WE})),a=r+1;return zE.forEach(n.nodes(),(function(t){YE(o,a,n.node(t))})),{graph:n,buckets:o,zeroIdx:a}}(t,e||HE),r=function(t,e,n){var r,i=[],o=e[e.length-1],a=e[0];for(;t.nodeCount();){for(;r=a.dequeue();)XE(t,e,n,r);for(;r=o.dequeue();)XE(t,e,n,r);if(t.nodeCount())for(var s=e.length-2;s>0;--s)if(r=e[s].dequeue()){i=i.concat(XE(t,e,n,r,!0));break}}return i}(n.graph,n.buckets,n.zeroIdx);return zE.flatten(zE.map(r,(function(e){return t.outEdges(e.v,e.w)})),!0)},HE=zE.constant(1);function XE(t,e,n,r,i){var o=i?[]:void 0;return zE.forEach(t.inEdges(r.v),(function(r){var a=t.edge(r),s=t.node(r.v);i&&o.push({v:r.v,w:r.w}),s.out-=a,YE(e,n,s)})),zE.forEach(t.outEdges(r.v),(function(r){var i=t.edge(r),o=r.w,a=t.node(o);a.in-=i,YE(e,n,a)})),t.removeNode(r.v),o}function YE(t,e,n){n.out?n.in?t[n.out-n.in+e].enqueue(n):t[t.length-1].enqueue(n):t[0].enqueue(n)}var KE=BE,$E=jE,qE={run:function(t){var e="greedy"===t.graph().acyclicer?$E(t,function(t){return function(e){return t.edge(e).weight}}(t)):function(t){var e=[],n={},r={};function i(o){KE.has(r,o)||(r[o]=!0,n[o]=!0,KE.forEach(t.outEdges(o),(function(t){KE.has(n,t.w)?e.push(t):i(t.w)})),delete n[o])}return KE.forEach(t.nodes(),i),e}(t);KE.forEach(e,(function(e){var n=t.edge(e);t.removeEdge(e),n.forwardName=e.name,n.reversed=!0,t.setEdge(e.w,e.v,n,KE.uniqueId("rev"))}))},undo:function(t){KE.forEach(t.edges(),(function(e){var n=t.edge(e);if(n.reversed){t.removeEdge(e);var r=n.forwardName;delete n.reversed,delete n.forwardName,t.setEdge(e.w,e.v,n,r)}}))}};var ZE=BE,QE=bE.Graph,JE={addDummyNode:t_,simplify:function(t){var e=(new QE).setGraph(t.graph());return ZE.forEach(t.nodes(),(function(n){e.setNode(n,t.node(n))})),ZE.forEach(t.edges(),(function(n){var r=e.edge(n.v,n.w)||{weight:0,minlen:1},i=t.edge(n);e.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})})),e},asNonCompoundGraph:function(t){var e=new QE({multigraph:t.isMultigraph()}).setGraph(t.graph());return ZE.forEach(t.nodes(),(function(n){t.children(n).length||e.setNode(n,t.node(n))})),ZE.forEach(t.edges(),(function(n){e.setEdge(n,t.edge(n))})),e},successorWeights:function(t){var e=ZE.map(t.nodes(),(function(e){var n={};return ZE.forEach(t.outEdges(e),(function(e){n[e.w]=(n[e.w]||0)+t.edge(e).weight})),n}));return ZE.zipObject(t.nodes(),e)},predecessorWeights:function(t){var e=ZE.map(t.nodes(),(function(e){var n={};return ZE.forEach(t.inEdges(e),(function(e){n[e.v]=(n[e.v]||0)+t.edge(e).weight})),n}));return ZE.zipObject(t.nodes(),e)},intersectRect:function(t,e){var n,r,i=t.x,o=t.y,a=e.x-i,s=e.y-o,l=t.width/2,u=t.height/2;if(!a&&!s)throw new Error("Not possible to find intersection inside of the rectangle");Math.abs(s)*l>Math.abs(a)*u?(s<0&&(u=-u),n=u*a/s,r=u):(a<0&&(l=-l),n=l,r=l*s/a);return{x:i+n,y:o+r}},buildLayerMatrix:function(t){var e=ZE.map(ZE.range(e_(t)+1),(function(){return[]}));return ZE.forEach(t.nodes(),(function(n){var r=t.node(n),i=r.rank;ZE.isUndefined(i)||(e[i][r.order]=n)})),e},normalizeRanks:function(t){var e=ZE.min(ZE.map(t.nodes(),(function(e){return t.node(e).rank})));ZE.forEach(t.nodes(),(function(n){var r=t.node(n);ZE.has(r,"rank")&&(r.rank-=e)}))},removeEmptyRanks:function(t){var e=ZE.min(ZE.map(t.nodes(),(function(e){return t.node(e).rank}))),n=[];ZE.forEach(t.nodes(),(function(r){var i=t.node(r).rank-e;n[i]||(n[i]=[]),n[i].push(r)}));var r=0,i=t.graph().nodeRankFactor;ZE.forEach(n,(function(e,n){ZE.isUndefined(e)&&n%i!=0?--r:r&&ZE.forEach(e,(function(e){t.node(e).rank+=r}))}))},addBorderNode:function(t,e,n,r){var i={width:0,height:0};arguments.length>=4&&(i.rank=n,i.order=r);return t_(t,"border",i,e)},maxRank:e_,partition:function(t,e){var n={lhs:[],rhs:[]};return ZE.forEach(t,(function(t){e(t)?n.lhs.push(t):n.rhs.push(t)})),n},time:function(t,e){var n=ZE.now();try{return e()}finally{console.log(t+" time: "+(ZE.now()-n)+"ms")}},notime:function(t,e){return e()}};function t_(t,e,n,r){var i;do{i=ZE.uniqueId(r)}while(t.hasNode(i));return n.dummy=e,t.setNode(i,n),i}function e_(t){return ZE.max(ZE.map(t.nodes(),(function(e){var n=t.node(e).rank;if(!ZE.isUndefined(n))return n})))}var n_=BE,r_=JE,i_={run:function(t){t.graph().dummyChains=[],n_.forEach(t.edges(),(function(e){!function(t,e){var n,r,i,o=e.v,a=t.node(o).rank,s=e.w,l=t.node(s).rank,u=e.name,c=t.edge(e),h=c.labelRank;if(l===a+1)return;for(t.removeEdge(e),i=0,++a;a<l;++i,++a)c.points=[],r={width:0,height:0,edgeLabel:c,edgeObj:e,rank:a},n=r_.addDummyNode(t,"edge",r,"_d"),a===h&&(r.width=c.width,r.height=c.height,r.dummy="edge-label",r.labelpos=c.labelpos),t.setEdge(o,n,{weight:c.weight},u),0===i&&t.graph().dummyChains.push(n),o=n;t.setEdge(o,s,{weight:c.weight},u)}(t,e)}))},undo:function(t){n_.forEach(t.graph().dummyChains,(function(e){var n,r=t.node(e),i=r.edgeLabel;for(t.setEdge(r.edgeObj,i);r.dummy;)n=t.successors(e)[0],t.removeNode(e),i.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),e=n,r=t.node(e)}))}};var o_=BE,a_={longestPath:function(t){var e={};o_.forEach(t.sources(),(function n(r){var i=t.node(r);if(o_.has(e,r))return i.rank;e[r]=!0;var o=o_.min(o_.map(t.outEdges(r),(function(e){return n(e.w)-t.edge(e).minlen})));return o!==Number.POSITIVE_INFINITY&&null!=o||(o=0),i.rank=o}))},slack:function(t,e){return t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen}};var s_=BE,l_=bE.Graph,u_=a_.slack,c_=function(t){var e,n,r=new l_({directed:!1}),i=t.nodes()[0],o=t.nodeCount();r.setNode(i,{});for(;h_(r,t)<o;)e=d_(r,t),n=r.hasNode(e.v)?u_(t,e):-u_(t,e),f_(r,t,n);return r};function h_(t,e){return s_.forEach(t.nodes(),(function n(r){s_.forEach(e.nodeEdges(r),(function(i){var o=i.v,a=r===o?i.w:o;t.hasNode(a)||u_(e,i)||(t.setNode(a,{}),t.setEdge(r,a,{}),n(a))}))})),t.nodeCount()}function d_(t,e){return s_.minBy(e.edges(),(function(n){if(t.hasNode(n.v)!==t.hasNode(n.w))return u_(e,n)}))}function f_(t,e,n){s_.forEach(t.nodes(),(function(t){e.node(t).rank+=n}))}var p_=BE,g_=c_,v_=a_.slack,m_=a_.longestPath,y_=bE.alg.preorder,E_=bE.alg.postorder,__=JE.simplify,b_=x_;function x_(t){t=__(t),m_(t);var e,n=g_(t);for(A_(n),S_(n,t);e=T_(n);)P_(n,t,e,w_(n,t,e))}function S_(t,e){var n=E_(t,t.nodes());n=n.slice(0,n.length-1),p_.forEach(n,(function(n){!function(t,e,n){var r=t.node(n),i=r.parent;t.edge(n,i).cutvalue=M_(t,e,n)}(t,e,n)}))}function M_(t,e,n){var r=t.node(n).parent,i=!0,o=e.edge(n,r),a=0;return o||(i=!1,o=e.edge(r,n)),a=o.weight,p_.forEach(e.nodeEdges(n),(function(o){var s,l,u=o.v===n,c=u?o.w:o.v;if(c!==r){var h=u===i,d=e.edge(o).weight;if(a+=h?d:-d,s=n,l=c,t.hasEdge(s,l)){var f=t.edge(n,c).cutvalue;a+=h?-f:f}}})),a}function A_(t,e){arguments.length<2&&(e=t.nodes()[0]),R_(t,{},1,e)}function R_(t,e,n,r,i){var o=n,a=t.node(r);return e[r]=!0,p_.forEach(t.neighbors(r),(function(i){p_.has(e,i)||(n=R_(t,e,n,i,r))})),a.low=o,a.lim=n++,i?a.parent=i:delete a.parent,n}function T_(t){return p_.find(t.edges(),(function(e){return t.edge(e).cutvalue<0}))}function w_(t,e,n){var r=n.v,i=n.w;e.hasEdge(r,i)||(r=n.w,i=n.v);var o=t.node(r),a=t.node(i),s=o,l=!1;o.lim>a.lim&&(s=a,l=!0);var u=p_.filter(e.edges(),(function(e){return l===N_(t,t.node(e.v),s)&&l!==N_(t,t.node(e.w),s)}));return p_.minBy(u,(function(t){return v_(e,t)}))}function P_(t,e,n,r){var i=n.v,o=n.w;t.removeEdge(i,o),t.setEdge(r.v,r.w,{}),A_(t),S_(t,e),function(t,e){var n=p_.find(t.nodes(),(function(t){return!e.node(t).parent})),r=y_(t,n);r=r.slice(1),p_.forEach(r,(function(n){var r=t.node(n).parent,i=e.edge(n,r),o=!1;i||(i=e.edge(r,n),o=!0),e.node(n).rank=e.node(r).rank+(o?i.minlen:-i.minlen)}))}(t,e)}function N_(t,e,n){return n.low<=e.lim&&e.lim<=n.lim}x_.initLowLimValues=A_,x_.initCutValues=S_,x_.calcCutValue=M_,x_.leaveEdge=T_,x_.enterEdge=w_,x_.exchangeEdges=P_;var C_=a_.longestPath,O_=c_,I_=b_,L_=function(t){switch(t.graph().ranker){case"network-simplex":default:B_(t);break;case"tight-tree":!function(t){C_(t),O_(t)}(t);break;case"longest-path":D_(t)}};var D_=C_;function B_(t){I_(t)}var k_=BE,F_=function(t){var e=function(t){var e={},n=0;function r(i){var o=n;k_.forEach(t.children(i),r),e[i]={low:o,lim:n++}}return k_.forEach(t.children(),r),e}(t);k_.forEach(t.graph().dummyChains,(function(n){for(var r=t.node(n),i=r.edgeObj,o=function(t,e,n,r){var i,o,a=[],s=[],l=Math.min(e[n].low,e[r].low),u=Math.max(e[n].lim,e[r].lim);i=n;do{i=t.parent(i),a.push(i)}while(i&&(e[i].low>l||u>e[i].lim));o=i,i=r;for(;(i=t.parent(i))!==o;)s.push(i);return{path:a.concat(s.reverse()),lca:o}}(t,e,i.v,i.w),a=o.path,s=o.lca,l=0,u=a[l],c=!0;n!==i.w;){if(r=t.node(n),c){for(;(u=a[l])!==s&&t.node(u).maxRank<r.rank;)l++;u===s&&(c=!1)}if(!c){for(;l<a.length-1&&t.node(u=a[l+1]).minRank<=r.rank;)l++;u=a[l]}t.setParent(n,u),n=t.successors(n)[0]}}))};var U_=BE,G_=JE,z_={run:function(t){var e=G_.addDummyNode(t,"root",{},"_root"),n=function(t){var e={};function n(r,i){var o=t.children(r);o&&o.length&&U_.forEach(o,(function(t){n(t,i+1)})),e[r]=i}return U_.forEach(t.children(),(function(t){n(t,1)})),e}(t),r=U_.max(U_.values(n))-1,i=2*r+1;t.graph().nestingRoot=e,U_.forEach(t.edges(),(function(e){t.edge(e).minlen*=i}));var o=function(t){return U_.reduce(t.edges(),(function(e,n){return e+t.edge(n).weight}),0)}(t)+1;U_.forEach(t.children(),(function(a){V_(t,e,i,o,r,n,a)})),t.graph().nodeRankFactor=i},cleanup:function(t){var e=t.graph();t.removeNode(e.nestingRoot),delete e.nestingRoot,U_.forEach(t.edges(),(function(e){t.edge(e).nestingEdge&&t.removeEdge(e)}))}};function V_(t,e,n,r,i,o,a){var s=t.children(a);if(s.length){var l=G_.addBorderNode(t,"_bt"),u=G_.addBorderNode(t,"_bb"),c=t.node(a);t.setParent(l,a),c.borderTop=l,t.setParent(u,a),c.borderBottom=u,U_.forEach(s,(function(s){V_(t,e,n,r,i,o,s);var c=t.node(s),h=c.borderTop?c.borderTop:s,d=c.borderBottom?c.borderBottom:s,f=c.borderTop?r:2*r,p=h!==d?1:i-o[a]+1;t.setEdge(l,h,{weight:f,minlen:p,nestingEdge:!0}),t.setEdge(d,u,{weight:f,minlen:p,nestingEdge:!0})})),t.parent(a)||t.setEdge(e,l,{weight:0,minlen:i+o[a]})}else a!==e&&t.setEdge(e,a,{weight:0,minlen:n})}var W_=BE,j_=JE,H_=function(t){W_.forEach(t.children(),(function e(n){var r=t.children(n),i=t.node(n);if(r.length&&W_.forEach(r,e),W_.has(i,"minRank")){i.borderLeft=[],i.borderRight=[];for(var o=i.minRank,a=i.maxRank+1;o<a;++o)X_(t,"borderLeft","_bl",n,i,o),X_(t,"borderRight","_br",n,i,o)}}))};function X_(t,e,n,r,i,o){var a={width:0,height:0,rank:o,borderType:e},s=i[e][o-1],l=j_.addDummyNode(t,"border",a,n);i[e][o]=l,t.setParent(l,r),s&&t.setEdge(s,l,{weight:1})}var Y_=BE,K_={adjust:function(t){var e=t.graph().rankdir.toLowerCase();"lr"!==e&&"rl"!==e||$_(t)},undo:function(t){var e=t.graph().rankdir.toLowerCase();"bt"!==e&&"rl"!==e||function(t){Y_.forEach(t.nodes(),(function(e){Z_(t.node(e))})),Y_.forEach(t.edges(),(function(e){var n=t.edge(e);Y_.forEach(n.points,Z_),Y_.has(n,"y")&&Z_(n)}))}(t);"lr"!==e&&"rl"!==e||(!function(t){Y_.forEach(t.nodes(),(function(e){Q_(t.node(e))})),Y_.forEach(t.edges(),(function(e){var n=t.edge(e);Y_.forEach(n.points,Q_),Y_.has(n,"x")&&Q_(n)}))}(t),$_(t))}};function $_(t){Y_.forEach(t.nodes(),(function(e){q_(t.node(e))})),Y_.forEach(t.edges(),(function(e){q_(t.edge(e))}))}function q_(t){var e=t.width;t.width=t.height,t.height=e}function Z_(t){t.y=-t.y}function Q_(t){var e=t.x;t.x=t.y,t.y=e}var J_=BE,tb=function(t){var e={},n=J_.filter(t.nodes(),(function(e){return!t.children(e).length})),r=J_.max(J_.map(n,(function(e){return t.node(e).rank}))),i=J_.map(J_.range(r+1),(function(){return[]}));function o(n){if(!J_.has(e,n)){e[n]=!0;var r=t.node(n);i[r.rank].push(n),J_.forEach(t.successors(n),o)}}var a=J_.sortBy(n,(function(e){return t.node(e).rank}));return J_.forEach(a,o),i};var eb=BE,nb=function(t,e){for(var n=0,r=1;r<e.length;++r)n+=rb(t,e[r-1],e[r]);return n};function rb(t,e,n){for(var r=eb.zipObject(n,eb.map(n,(function(t,e){return e}))),i=eb.flatten(eb.map(e,(function(e){return eb.sortBy(eb.map(t.outEdges(e),(function(e){return{pos:r[e.w],weight:t.edge(e).weight}})),"pos")})),!0),o=1;o<n.length;)o<<=1;var a=2*o-1;o-=1;var s=eb.map(new Array(a),(function(){return 0})),l=0;return eb.forEach(i.forEach((function(t){var e=t.pos+o;s[e]+=t.weight;for(var n=0;e>0;)e%2&&(n+=s[e+1]),s[e=e-1>>1]+=t.weight;l+=t.weight*n}))),l}var ib=BE;var ob=BE,ab=function(t,e){var n={};return ob.forEach(t,(function(t,e){var r=n[t.v]={indegree:0,in:[],out:[],vs:[t.v],i:e};ob.isUndefined(t.barycenter)||(r.barycenter=t.barycenter,r.weight=t.weight)})),ob.forEach(e.edges(),(function(t){var e=n[t.v],r=n[t.w];ob.isUndefined(e)||ob.isUndefined(r)||(r.indegree++,e.out.push(n[t.w]))})),function(t){var e=[];function n(t){return function(e){e.merged||(ob.isUndefined(e.barycenter)||ob.isUndefined(t.barycenter)||e.barycenter>=t.barycenter)&&function(t,e){var n=0,r=0;t.weight&&(n+=t.barycenter*t.weight,r+=t.weight);e.weight&&(n+=e.barycenter*e.weight,r+=e.weight);t.vs=e.vs.concat(t.vs),t.barycenter=n/r,t.weight=r,t.i=Math.min(e.i,t.i),e.merged=!0}(t,e)}}function r(e){return function(n){n.in.push(e),0==--n.indegree&&t.push(n)}}for(;t.length;){var i=t.pop();e.push(i),ob.forEach(i.in.reverse(),n(i)),ob.forEach(i.out,r(i))}return ob.map(ob.filter(e,(function(t){return!t.merged})),(function(t){return ob.pick(t,["vs","i","barycenter","weight"])}))}(ob.filter(n,(function(t){return!t.indegree})))};var sb=BE,lb=JE;function ub(t,e,n){for(var r;e.length&&(r=sb.last(e)).i<=n;)e.pop(),t.push(r.vs),n++;return n}var cb=BE,hb=function(t,e){return ib.map(e,(function(e){var n=t.inEdges(e);if(n.length){var r=ib.reduce(n,(function(e,n){var r=t.edge(n),i=t.node(n.v);return{sum:e.sum+r.weight*i.order,weight:e.weight+r.weight}}),{sum:0,weight:0});return{v:e,barycenter:r.sum/r.weight,weight:r.weight}}return{v:e}}))},db=ab,fb=function(t,e){var n=lb.partition(t,(function(t){return sb.has(t,"barycenter")})),r=n.lhs,i=sb.sortBy(n.rhs,(function(t){return-t.i})),o=[],a=0,s=0,l=0;r.sort((u=!!e,function(t,e){return t.barycenter<e.barycenter?-1:t.barycenter>e.barycenter?1:u?e.i-t.i:t.i-e.i})),l=ub(o,i,l),sb.forEach(r,(function(t){l+=t.vs.length,o.push(t.vs),a+=t.barycenter*t.weight,s+=t.weight,l=ub(o,i,l)}));var u;var c={vs:sb.flatten(o,!0)};s&&(c.barycenter=a/s,c.weight=s);return c},pb=function t(e,n,r,i){var o=e.children(n),a=e.node(n),s=a?a.borderLeft:void 0,l=a?a.borderRight:void 0,u={};s&&(o=cb.filter(o,(function(t){return t!==s&&t!==l})));var c=hb(e,o);cb.forEach(c,(function(n){if(e.children(n.v).length){var o=t(e,n.v,r,i);u[n.v]=o,cb.has(o,"barycenter")&&(a=n,s=o,cb.isUndefined(a.barycenter)?(a.barycenter=s.barycenter,a.weight=s.weight):(a.barycenter=(a.barycenter*a.weight+s.barycenter*s.weight)/(a.weight+s.weight),a.weight+=s.weight))}var a,s}));var h=db(c,r);!function(t,e){cb.forEach(t,(function(t){t.vs=cb.flatten(t.vs.map((function(t){return e[t]?e[t].vs:t})),!0)}))}(h,u);var d=fb(h,i);if(s&&(d.vs=cb.flatten([s,d.vs,l],!0),e.predecessors(s).length)){var f=e.node(e.predecessors(s)[0]),p=e.node(e.predecessors(l)[0]);cb.has(d,"barycenter")||(d.barycenter=0,d.weight=0),d.barycenter=(d.barycenter*d.weight+f.order+p.order)/(d.weight+2),d.weight+=2}return d};var gb=BE,vb=bE.Graph,mb=function(t,e,n){var r=function(t){var e;for(;t.hasNode(e=gb.uniqueId("_root")););return e}(t),i=new vb({compound:!0}).setGraph({root:r}).setDefaultNodeLabel((function(e){return t.node(e)}));return gb.forEach(t.nodes(),(function(o){var a=t.node(o),s=t.parent(o);(a.rank===e||a.minRank<=e&&e<=a.maxRank)&&(i.setNode(o),i.setParent(o,s||r),gb.forEach(t[n](o),(function(e){var n=e.v===o?e.w:e.v,r=i.edge(n,o),a=gb.isUndefined(r)?0:r.weight;i.setEdge(n,o,{weight:t.edge(e).weight+a})})),gb.has(a,"minRank")&&i.setNode(o,{borderLeft:a.borderLeft[e],borderRight:a.borderRight[e]}))})),i};var yb=BE;var Eb=BE,_b=tb,bb=nb,xb=pb,Sb=mb,Mb=function(t,e,n){var r,i={};yb.forEach(n,(function(n){for(var o,a,s=t.parent(n);s;){if((o=t.parent(s))?(a=i[o],i[o]=s):(a=r,r=s),a&&a!==s)return void e.setEdge(a,s);s=o}}))},Ab=bE.Graph,Rb=JE,Tb=function(t){var e=Rb.maxRank(t),n=wb(t,Eb.range(1,e+1),"inEdges"),r=wb(t,Eb.range(e-1,-1,-1),"outEdges"),i=_b(t);Nb(t,i);for(var o,a=Number.POSITIVE_INFINITY,s=0,l=0;l<4;++s,++l){Pb(s%2?n:r,s%4>=2),i=Rb.buildLayerMatrix(t);var u=bb(t,i);u<a&&(l=0,o=Eb.cloneDeep(i),a=u)}Nb(t,o)};function wb(t,e,n){return Eb.map(e,(function(e){return Sb(t,e,n)}))}function Pb(t,e){var n=new Ab;Eb.forEach(t,(function(t){var r=t.graph().root,i=xb(t,r,n,e);Eb.forEach(i.vs,(function(e,n){t.node(e).order=n})),Mb(t,n,i.vs)}))}function Nb(t,e){Eb.forEach(e,(function(e){Eb.forEach(e,(function(e,n){t.node(e).order=n}))}))}var Cb=BE,Ob=bE.Graph,Ib=JE,Lb=function(t){var e,n=Ib.buildLayerMatrix(t),r=Cb.merge(Db(t,n),Bb(t,n)),i={};Cb.forEach(["u","d"],(function(o){e="u"===o?n:Cb.values(n).reverse(),Cb.forEach(["l","r"],(function(n){"r"===n&&(e=Cb.map(e,(function(t){return Cb.values(t).reverse()})));var a=("u"===o?t.predecessors:t.successors).bind(t),s=Ub(t,e,r,a),l=Gb(t,e,s.root,s.align,"r"===n);"r"===n&&(l=Cb.mapValues(l,(function(t){return-t}))),i[o+n]=l}))}));var o=zb(t,i);return Vb(i,o),Wb(i,t.graph().align)};function Db(t,e){var n={};return Cb.reduce(e,(function(e,r){var i=0,o=0,a=e.length,s=Cb.last(r);return Cb.forEach(r,(function(e,l){var u=function(t,e){if(t.node(e).dummy)return Cb.find(t.predecessors(e),(function(e){return t.node(e).dummy}))}(t,e),c=u?t.node(u).order:a;(u||e===s)&&(Cb.forEach(r.slice(o,l+1),(function(e){Cb.forEach(t.predecessors(e),(function(r){var o=t.node(r),a=o.order;!(a<i||c<a)||o.dummy&&t.node(e).dummy||kb(n,r,e)}))})),o=l+1,i=c)})),r})),n}function Bb(t,e){var n={};function r(e,r,i,o,a){var s;Cb.forEach(Cb.range(r,i),(function(r){s=e[r],t.node(s).dummy&&Cb.forEach(t.predecessors(s),(function(e){var r=t.node(e);r.dummy&&(r.order<o||r.order>a)&&kb(n,e,s)}))}))}return Cb.reduce(e,(function(e,n){var i,o=-1,a=0;return Cb.forEach(n,(function(s,l){if("border"===t.node(s).dummy){var u=t.predecessors(s);u.length&&(i=t.node(u[0]).order,r(n,a,l,o,i),a=l,o=i)}r(n,a,n.length,i,e.length)})),n})),n}function kb(t,e,n){if(e>n){var r=e;e=n,n=r}var i=t[e];i||(t[e]=i={}),i[n]=!0}function Fb(t,e,n){if(e>n){var r=e;e=n,n=r}return Cb.has(t[e],n)}function Ub(t,e,n,r){var i={},o={},a={};return Cb.forEach(e,(function(t){Cb.forEach(t,(function(t,e){i[t]=t,o[t]=t,a[t]=e}))})),Cb.forEach(e,(function(t){var e=-1;Cb.forEach(t,(function(t){var s=r(t);if(s.length){s=Cb.sortBy(s,(function(t){return a[t]}));for(var l=(s.length-1)/2,u=Math.floor(l),c=Math.ceil(l);u<=c;++u){var h=s[u];o[t]===t&&e<a[h]&&!Fb(n,t,h)&&(o[h]=t,o[t]=i[t]=i[h],e=a[h])}}}))})),{root:i,align:o}}function Gb(t,e,n,r,i){var o={},a=function(t,e,n,r){var i=new Ob,o=t.graph(),a=function(t,e,n){return function(r,i,o){var a,s=r.node(i),l=r.node(o),u=0;if(u+=s.width/2,Cb.has(s,"labelpos"))switch(s.labelpos.toLowerCase()){case"l":a=-s.width/2;break;case"r":a=s.width/2}if(a&&(u+=n?a:-a),a=0,u+=(s.dummy?e:t)/2,u+=(l.dummy?e:t)/2,u+=l.width/2,Cb.has(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":a=l.width/2;break;case"r":a=-l.width/2}return a&&(u+=n?a:-a),a=0,u}}(o.nodesep,o.edgesep,r);return Cb.forEach(e,(function(e){var r;Cb.forEach(e,(function(e){var o=n[e];if(i.setNode(o),r){var s=n[r],l=i.edge(s,o);i.setEdge(s,o,Math.max(a(t,e,r),l||0))}r=e}))})),i}(t,e,n,i),s=i?"borderLeft":"borderRight";function l(t,e){for(var n=a.nodes(),r=n.pop(),i={};r;)i[r]?t(r):(i[r]=!0,n.push(r),n=n.concat(e(r))),r=n.pop()}return l((function(t){o[t]=a.inEdges(t).reduce((function(t,e){return Math.max(t,o[e.v]+a.edge(e))}),0)}),a.predecessors.bind(a)),l((function(e){var n=a.outEdges(e).reduce((function(t,e){return Math.min(t,o[e.w]-a.edge(e))}),Number.POSITIVE_INFINITY),r=t.node(e);n!==Number.POSITIVE_INFINITY&&r.borderType!==s&&(o[e]=Math.max(o[e],n))}),a.successors.bind(a)),Cb.forEach(r,(function(t){o[t]=o[n[t]]})),o}function zb(t,e){return Cb.minBy(Cb.values(e),(function(e){var n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;return Cb.forIn(e,(function(e,i){var o=function(t,e){return t.node(e).width}(t,i)/2;n=Math.max(e+o,n),r=Math.min(e-o,r)})),n-r}))}function Vb(t,e){var n=Cb.values(e),r=Cb.min(n),i=Cb.max(n);Cb.forEach(["u","d"],(function(n){Cb.forEach(["l","r"],(function(o){var a,s=n+o,l=t[s];if(l!==e){var u=Cb.values(l);(a="l"===o?r-Cb.min(u):i-Cb.max(u))&&(t[s]=Cb.mapValues(l,(function(t){return t+a})))}}))}))}function Wb(t,e){return Cb.mapValues(t.ul,(function(n,r){if(e)return t[e.toLowerCase()][r];var i=Cb.sortBy(Cb.map(t,r));return(i[1]+i[2])/2}))}var jb=BE,Hb=JE,Xb=Lb,Yb=function(t){(function(t){var e=Hb.buildLayerMatrix(t),n=t.graph().ranksep,r=0;jb.forEach(e,(function(e){var i=jb.max(jb.map(e,(function(e){return t.node(e).height})));jb.forEach(e,(function(e){t.node(e).y=r+i/2})),r+=i+n}))})(t=Hb.asNonCompoundGraph(t)),jb.forEach(Xb(t),(function(e,n){t.node(n).x=e}))};var Kb=BE,$b=qE,qb=i_,Zb=L_,Qb=JE.normalizeRanks,Jb=F_,tx=JE.removeEmptyRanks,ex=z_,nx=H_,rx=K_,ix=Tb,ox=Yb,ax=JE,sx=bE.Graph,lx=function(t,e){var n=e&&e.debugTiming?ax.time:ax.notime;n("layout",(function(){var e=n("  buildLayoutGraph",(function(){return function(t){var e=new sx({multigraph:!0,compound:!0}),n=yx(t.graph());return e.setGraph(Kb.merge({},cx,mx(n,ux),Kb.pick(n,hx))),Kb.forEach(t.nodes(),(function(n){var r=yx(t.node(n));e.setNode(n,Kb.defaults(mx(r,dx),fx)),e.setParent(n,t.parent(n))})),Kb.forEach(t.edges(),(function(n){var r=yx(t.edge(n));e.setEdge(n,Kb.merge({},gx,mx(r,px),Kb.pick(r,vx)))})),e}(t)}));n("  runLayout",(function(){!function(t,e){e("    makeSpaceForEdgeLabels",(function(){!function(t){var e=t.graph();e.ranksep/=2,Kb.forEach(t.edges(),(function(n){var r=t.edge(n);r.minlen*=2,"c"!==r.labelpos.toLowerCase()&&("TB"===e.rankdir||"BT"===e.rankdir?r.width+=r.labeloffset:r.height+=r.labeloffset)}))}(t)})),e("    removeSelfEdges",(function(){!function(t){Kb.forEach(t.edges(),(function(e){if(e.v===e.w){var n=t.node(e.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:e,label:t.edge(e)}),t.removeEdge(e)}}))}(t)})),e("    acyclic",(function(){$b.run(t)})),e("    nestingGraph.run",(function(){ex.run(t)})),e("    rank",(function(){Zb(ax.asNonCompoundGraph(t))})),e("    injectEdgeLabelProxies",(function(){!function(t){Kb.forEach(t.edges(),(function(e){var n=t.edge(e);if(n.width&&n.height){var r=t.node(e.v),i={rank:(t.node(e.w).rank-r.rank)/2+r.rank,e:e};ax.addDummyNode(t,"edge-proxy",i,"_ep")}}))}(t)})),e("    removeEmptyRanks",(function(){tx(t)})),e("    nestingGraph.cleanup",(function(){ex.cleanup(t)})),e("    normalizeRanks",(function(){Qb(t)})),e("    assignRankMinMax",(function(){!function(t){var e=0;Kb.forEach(t.nodes(),(function(n){var r=t.node(n);r.borderTop&&(r.minRank=t.node(r.borderTop).rank,r.maxRank=t.node(r.borderBottom).rank,e=Kb.max(e,r.maxRank))})),t.graph().maxRank=e}(t)})),e("    removeEdgeLabelProxies",(function(){!function(t){Kb.forEach(t.nodes(),(function(e){var n=t.node(e);"edge-proxy"===n.dummy&&(t.edge(n.e).labelRank=n.rank,t.removeNode(e))}))}(t)})),e("    normalize.run",(function(){qb.run(t)})),e("    parentDummyChains",(function(){Jb(t)})),e("    addBorderSegments",(function(){nx(t)})),e("    order",(function(){ix(t)})),e("    insertSelfEdges",(function(){!function(t){var e=ax.buildLayerMatrix(t);Kb.forEach(e,(function(e){var n=0;Kb.forEach(e,(function(e,r){var i=t.node(e);i.order=r+n,Kb.forEach(i.selfEdges,(function(e){ax.addDummyNode(t,"selfedge",{width:e.label.width,height:e.label.height,rank:i.rank,order:r+ ++n,e:e.e,label:e.label},"_se")})),delete i.selfEdges}))}))}(t)})),e("    adjustCoordinateSystem",(function(){rx.adjust(t)})),e("    position",(function(){ox(t)})),e("    positionSelfEdges",(function(){!function(t){Kb.forEach(t.nodes(),(function(e){var n=t.node(e);if("selfedge"===n.dummy){var r=t.node(n.e.v),i=r.x+r.width/2,o=r.y,a=n.x-i,s=r.height/2;t.setEdge(n.e,n.label),t.removeNode(e),n.label.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{x:i+a,y:o},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],n.label.x=n.x,n.label.y=n.y}}))}(t)})),e("    removeBorderNodes",(function(){!function(t){Kb.forEach(t.nodes(),(function(e){if(t.children(e).length){var n=t.node(e),r=t.node(n.borderTop),i=t.node(n.borderBottom),o=t.node(Kb.last(n.borderLeft)),a=t.node(Kb.last(n.borderRight));n.width=Math.abs(a.x-o.x),n.height=Math.abs(i.y-r.y),n.x=o.x+n.width/2,n.y=r.y+n.height/2}})),Kb.forEach(t.nodes(),(function(e){"border"===t.node(e).dummy&&t.removeNode(e)}))}(t)})),e("    normalize.undo",(function(){qb.undo(t)})),e("    fixupEdgeLabelCoords",(function(){!function(t){Kb.forEach(t.edges(),(function(e){var n=t.edge(e);if(Kb.has(n,"x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))}(t)})),e("    undoCoordinateSystem",(function(){rx.undo(t)})),e("    translateGraph",(function(){!function(t){var e=Number.POSITIVE_INFINITY,n=0,r=Number.POSITIVE_INFINITY,i=0,o=t.graph(),a=o.marginx||0,s=o.marginy||0;function l(t){var o=t.x,a=t.y,s=t.width,l=t.height;e=Math.min(e,o-s/2),n=Math.max(n,o+s/2),r=Math.min(r,a-l/2),i=Math.max(i,a+l/2)}Kb.forEach(t.nodes(),(function(e){l(t.node(e))})),Kb.forEach(t.edges(),(function(e){var n=t.edge(e);Kb.has(n,"x")&&l(n)})),e-=a,r-=s,Kb.forEach(t.nodes(),(function(n){var i=t.node(n);i.x-=e,i.y-=r})),Kb.forEach(t.edges(),(function(n){var i=t.edge(n);Kb.forEach(i.points,(function(t){t.x-=e,t.y-=r})),Kb.has(i,"x")&&(i.x-=e),Kb.has(i,"y")&&(i.y-=r)})),o.width=n-e+a,o.height=i-r+s}(t)})),e("    assignNodeIntersects",(function(){!function(t){Kb.forEach(t.edges(),(function(e){var n,r,i=t.edge(e),o=t.node(e.v),a=t.node(e.w);i.points?(n=i.points[0],r=i.points[i.points.length-1]):(i.points=[],n=a,r=o),i.points.unshift(ax.intersectRect(o,n)),i.points.push(ax.intersectRect(a,r))}))}(t)})),e("    reversePoints",(function(){!function(t){Kb.forEach(t.edges(),(function(e){var n=t.edge(e);n.reversed&&n.points.reverse()}))}(t)})),e("    acyclic.undo",(function(){$b.undo(t)}))}(e,n)})),n("  updateInputGraph",(function(){!function(t,e){Kb.forEach(t.nodes(),(function(n){var r=t.node(n),i=e.node(n);r&&(r.x=i.x,r.y=i.y,e.children(n).length&&(r.width=i.width,r.height=i.height))})),Kb.forEach(t.edges(),(function(n){var r=t.edge(n),i=e.edge(n);r.points=i.points,Kb.has(i,"x")&&(r.x=i.x,r.y=i.y)})),t.graph().width=e.graph().width,t.graph().height=e.graph().height}(t,e)}))}))};var ux=["nodesep","edgesep","ranksep","marginx","marginy"],cx={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},hx=["acyclicer","ranker","rankdir","align"],dx=["width","height"],fx={width:0,height:0},px=["minlen","weight","width","height","labeloffset"],gx={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},vx=["labelpos"];function mx(t,e){return Kb.mapValues(Kb.pick(t,e),Number)}function yx(t){var e={};return Kb.forEach(t,(function(t,n){e[n.toLowerCase()]=t})),e}var Ex=BE,_x=JE,bx=bE.Graph,xx={debugOrdering:function(t){var e=_x.buildLayerMatrix(t),n=new bx({compound:!0,multigraph:!0}).setGraph({});return Ex.forEach(t.nodes(),(function(e){n.setNode(e,{label:e}),n.setParent(e,"layer"+t.node(e).rank)})),Ex.forEach(t.edges(),(function(t){n.setEdge(t.v,t.w,{},t.name)})),Ex.forEach(e,(function(t,e){var r="layer"+e;n.setNode(r,{rank:"same"}),Ex.reduce(t,(function(t,e){return n.setEdge(t,e,{style:"invis"}),e}))})),n}};var Sx={graphlib:bE,layout:lx,debug:xx,util:{time:JE.time,notime:JE.notime},version:"0.8.5"},Mx=ji(Sx);class Ax{constructor(t){this.id="dagre",this.options={},Object.assign(this.options,Ax.defaultOptions,t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericDagreLayout(!1,t,Object.assign(Object.assign({},this.options),e))}))}assign(t,e){return o(this,void 0,void 0,(function*(){yield this.genericDagreLayout(!0,t,Object.assign(Object.assign({},this.options),e))}))}genericDagreLayout(t,e,n){return o(this,void 0,void 0,(function*(){const{nodeSize:r}=n,o=new Sx.graphlib.Graph;o.setGraph(n),o.setDefaultEdgeLabel((()=>({})));[...e.getAllNodes(),...e.getAllEdges()].some((({id:t})=>I(t)))&&console.error("Dagre layout only support string id, it will convert number to string."),e.getAllNodes().forEach((t=>{const{id:e}=t,n=Object.assign({},t.data);if(void 0!==r){const[e,i]=function(t){if(!t)return[0,0,0];if(I(t))return[t,t,t];if(0===t.length)return[0,0,0];const[e,n=e,r=e]=t;return[e,n,r]}(E(r)?r(t):r);Object.assign(n,{width:e,height:i})}o.setNode(e.toString(),n)})),e.getAllEdges().forEach((({id:t,source:e,target:n})=>{o.setEdge(e.toString(),n.toString(),{id:t})})),Mx.layout(o);const a={nodes:[],edges:[]};return o.nodes().forEach((n=>{const r=o.node(n);a.nodes.push({id:n,data:r}),t&&e.mergeNodeData(n,r)})),o.edges().forEach((n=>{const r=o.edge(n),{id:s}=r,l=i(r,["id"]),{v:u,w:c}=n;a.edges.push({id:s,source:u,target:c,data:l}),t&&e.mergeEdgeData(s,l)})),a}))}}Ax.defaultOptions={};class Rx{constructor(t){this.id=t.id||0,this.rx=t.rx,this.ry=t.ry,this.fx=0,this.fy=0,this.mass=t.mass,this.degree=t.degree,this.g=t.g||0}distanceTo(t){const e=this.rx-t.rx,n=this.ry-t.ry;return Math.hypot(e,n)}setPos(t,e){this.rx=t,this.ry=e}resetForce(){this.fx=0,this.fy=0}addForce(t){const e=t.rx-this.rx,n=t.ry-this.ry;let r=Math.hypot(e,n);r=r<1e-4?1e-4:r;const i=this.g*(this.degree+1)*(t.degree+1)/r;this.fx+=i*e/r,this.fy+=i*n/r}in(t){return t.contains(this.rx,this.ry)}add(t){const e=this.mass+t.mass,n=(this.rx*this.mass+t.rx*t.mass)/e,r=(this.ry*this.mass+t.ry*t.mass)/e,i=this.degree+t.degree;return new Rx({rx:n,ry:r,mass:e,degree:i})}}let Tx=class t{constructor(t){this.xmid=t.xmid,this.ymid=t.ymid,this.length=t.length,this.massCenter=t.massCenter||[0,0],this.mass=t.mass||1}getLength(){return this.length}contains(t,e){const n=this.length/2;return t<=this.xmid+n&&t>=this.xmid-n&&e<=this.ymid+n&&e>=this.ymid-n}NW(){const e=this.xmid-this.length/4,n=this.ymid+this.length/4,r=this.length/2;return new t({xmid:e,ymid:n,length:r})}NE(){const e=this.xmid+this.length/4,n=this.ymid+this.length/4,r=this.length/2;return new t({xmid:e,ymid:n,length:r})}SW(){const e=this.xmid-this.length/4,n=this.ymid-this.length/4,r=this.length/2;return new t({xmid:e,ymid:n,length:r})}SE(){const e=this.xmid+this.length/4,n=this.ymid-this.length/4,r=this.length/2;return new t({xmid:e,ymid:n,length:r})}};class wx{constructor(t){this.body=null,this.quad=null,this.NW=null,this.NE=null,this.SW=null,this.SE=null,this.theta=.5,null!=t&&(this.quad=t)}insert(t){null!=this.body?this._isExternal()?(this.quad&&(this.NW=new wx(this.quad.NW()),this.NE=new wx(this.quad.NE()),this.SW=new wx(this.quad.SW()),this.SE=new wx(this.quad.SE())),this._putBody(this.body),this._putBody(t),this.body=this.body.add(t)):(this.body=this.body.add(t),this._putBody(t)):this.body=t}_putBody(t){this.quad&&(t.in(this.quad.NW())&&this.NW?this.NW.insert(t):t.in(this.quad.NE())&&this.NE?this.NE.insert(t):t.in(this.quad.SW())&&this.SW?this.SW.insert(t):t.in(this.quad.SE())&&this.SE&&this.SE.insert(t))}_isExternal(){return null==this.NW&&null==this.NE&&null==this.SW&&null==this.SE}updateForce(t){if(null!=this.body&&t!==this.body)if(this._isExternal())t.addForce(this.body);else{(this.quad?this.quad.getLength():0)/this.body.distanceTo(t)<this.theta?t.addForce(this.body):(this.NW&&this.NW.updateForce(t),this.NE&&this.NE.updateForce(t),this.SW&&this.SW.updateForce(t),this.SE&&this.SE.updateForce(t))}}}const Px={center:[0,0],width:300,height:300,kr:5,kg:1,mode:"normal",preventOverlap:!1,dissuadeHubs:!1,maxIteration:0,ks:.1,ksmax:10,tao:.1};const Nx={maxIteration:1e3,gravity:10,speed:5,clustering:!1,clusterGravity:10,width:300,height:300,nodeClusterBy:"cluster"};const Cx={begin:[0,0],preventOverlap:!0,preventOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:void 0,sortBy:"degree",nodeSize:30,width:300,height:300};const Ox=(t,e)=>{let n;const r=t.rows||5,i=t.cols||5;if(null==e)n=Math.min(r,i);else{Math.min(r,i)===t.rows?t.rows=e:t.cols=e}return n},Ix=(t,e)=>{let n;const r=t.rows||5,i=t.cols||5;if(null==e)n=Math.max(r,i);else{Math.max(r,i)===t.rows?t.rows=e:t.cols=e}return n},Lx=(t,e)=>t[`c-${e.row}-${e.col}`]||!1,Dx=(t,e)=>t[`c-${e.row}-${e.col}`]=!0,Bx=(t,e)=>{const n=t.cols||5;e.col++,e.col>=n&&(e.col=0,e.row++)},kx=(t,e,n,r,i,o,a,s)=>{let l,u;const c=i[t.id];if(c)l=c.col*n+n/2+e[0],u=c.row*r+r/2+e[1];else{for(;Lx(s,a);)Bx(o,a);l=a.col*n+n/2+e[0],u=a.row*r+r/2+e[1],Dx(s,a),Bx(o,a)}t.data.x=l,t.data.y=u},Fx={iterations:10,height:10,width:10,speed:100,gravity:10,k:5},Ux=(t,e,n,r,i,o)=>{e.forEach(((a,s)=>{n[s]={x:0,y:0},e.forEach(((e,l)=>{if(s===l)return;if(i[s]!==i[l])return;let u=a.x-e.x,c=a.y-e.y,h=Math.sqrt(u*u+c*c);if(0===h){h=1;const t=s>l?1:-1;u=.01*t,c=.01*t}if(h<o(t[s])/2+o(t[l])/2){const t=r*r/h;n[s].x+=u/h*t,n[s].y+=c/h*t}}))}))},Gx=(t,e,n,r,i,o,a,s)=>{const l=o||a/10;return r&&e.forEach(((e,n)=>{const r=t[n].x-t[i].x,o=t[n].y-t[i].y,a=Math.sqrt(r*r+o*o);let s=o/a,l=-r/a;const u=Math.sqrt(e.x*e.x+e.y*e.y);let c=Math.acos((s*e.x+l*e.y)/u);c>Math.PI/2&&(c-=Math.PI/2,s*=-1,l*=-1);const h=Math.cos(c)*u;e.x=s*h,e.y=l*h})),t.forEach(((o,a)=>{if(a===i)return;const u=Math.sqrt(e[a].x*e[a].x+e[a].y*e[a].y);if(u>0&&a!==i){const c=Math.min(l*(n/800),u);if(o.x+=e[a].x/u*c,o.y+=e[a].y/u*c,r){let e=o.x-t[i].x,n=o.y-t[i].y;const r=Math.sqrt(e*e+n*n);e=e/r*s[a],n=n/r*s[a],o.x=t[i].x+e,o.y=t[i].y+n}}})),t},zx={maxIteration:1e3,focusNode:null,unitRadius:null,linkDistance:50,preventOverlap:!1,strictRadial:!0,maxPreventOverlapIteration:200,sortStrength:10};const Vx=(t,e,n,r,i,o,a)=>{if(!t)return[];const s=[];if(e){const l={};e.forEach(((e,u)=>{const c=[];e.forEach(((e,s)=>{var h,d;if(u===s)c.push(0);else if(r[u]===r[s])if("data"===o)c.push(e*(Math.abs(u-s)*a)/(r[u]/i));else if(o){let n,f;if(l[t[u].id])n=l[t[u].id];else{const e=("id"===o?t[u].id:null===(h=t[u].data)||void 0===h?void 0:h[o])||0;n=N(e)?e.charCodeAt(0):e,l[t[u].id]=n}if(l[t[s].id])f=l[t[s].id];else{const e=("id"===o?t[s].id:null===(d=t[s].data)||void 0===d?void 0:d[o])||0;f=N(e)?e.charCodeAt(0):e,l[t[s].id]=f}c.push(e*(Math.abs(n-f)*a)/(r[u]/i))}else c.push(e*n/(r[u]/i));else{const t=(n+i)/2;c.push(e*t)}})),s.push(c)}))}return s},Wx=t=>{const e=t.length,n=t[0].length,r=[];for(let i=0;i<e;i++){const e=[];for(let r=0;r<n;r++)0!==t[i][r]?e.push(1/(t[i][r]*t[i][r])):e.push(0);r.push(e)}return r},jx=(t,e)=>{let n=-1;return t.forEach(((t,r)=>{t.id===e&&(n=r)})),Math.max(n,0)},Hx=(t,e,n)=>{const r=t.length;for(let i=0;i<r;i++)if(t[e][i]===1/0){t[e][i]=n,t[i][e]=n;for(let o=0;o<r;o++)t[i][o]!==1/0&&t[e][o]===1/0&&(t[e][o]=n+t[i][o],t[o][e]=n+t[i][o])}for(let n=0;n<r;n++)if(n!==e)for(let i=0;i<r;i++)if(t[n][i]===1/0){let r=Math.abs(t[e][n]-t[e][i]);r=0===r?1:r,t[n][i]=r}},Xx=(t,e)=>{let n=0;for(let r=0;r<t[e].length;r++)t[e][r]!==1/0&&(n=t[e][r]>n?t[e][r]:n);return n},Yx={center:[0,0],width:300,height:300};var Kx={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var l,u,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,r);break;case 4:c[u].fn.call(c[u].context,e,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==e||i&&!s[l].once||r&&s[l].context!==r)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(Kx);var $x=ji(Kx.exports);function qx(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Zx(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Qx(){}var Jx=.7,tS=1/Jx,eS="\\s*([+-]?\\d+)\\s*",nS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",rS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",iS=/^#([0-9a-f]{3,8})$/,oS=new RegExp(`^rgb\\(${eS},${eS},${eS}\\)$`),aS=new RegExp(`^rgb\\(${rS},${rS},${rS}\\)$`),sS=new RegExp(`^rgba\\(${eS},${eS},${eS},${nS}\\)$`),lS=new RegExp(`^rgba\\(${rS},${rS},${rS},${nS}\\)$`),uS=new RegExp(`^hsl\\(${nS},${rS},${rS}\\)$`),cS=new RegExp(`^hsla\\(${nS},${rS},${rS},${nS}\\)$`),hS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function dS(){return this.rgb().formatHex()}function fS(){return this.rgb().formatRgb()}function pS(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=iS.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?gS(e):3===n?new mS(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?vS(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?vS(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=oS.exec(t))?new mS(e[1],e[2],e[3],1):(e=aS.exec(t))?new mS(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=sS.exec(t))?vS(e[1],e[2],e[3],e[4]):(e=lS.exec(t))?vS(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=uS.exec(t))?SS(e[1],e[2]/100,e[3]/100,1):(e=cS.exec(t))?SS(e[1],e[2]/100,e[3]/100,e[4]):hS.hasOwnProperty(t)?gS(hS[t]):"transparent"===t?new mS(NaN,NaN,NaN,0):null}function gS(t){return new mS(t>>16&255,t>>8&255,255&t,1)}function vS(t,e,n,r){return r<=0&&(t=e=n=NaN),new mS(t,e,n,r)}function mS(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function yS(){return`#${xS(this.r)}${xS(this.g)}${xS(this.b)}`}function ES(){const t=_S(this.opacity);return`${1===t?"rgb(":"rgba("}${bS(this.r)}, ${bS(this.g)}, ${bS(this.b)}${1===t?")":`, ${t})`}`}function _S(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function bS(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xS(t){return((t=bS(t))<16?"0":"")+t.toString(16)}function SS(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new AS(t,e,n,r)}function MS(t){if(t instanceof AS)return new AS(t.h,t.s,t.l,t.opacity);if(t instanceof Qx||(t=pS(t)),!t)return new AS;if(t instanceof AS)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,l=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new AS(a,s,l,t.opacity)}function AS(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function RS(t){return(t=(t||0)%360)<0?t+360:t}function TS(t){return Math.max(0,Math.min(1,t||0))}function wS(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function PS(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function NS(t,e){var n=Math.min.apply(Math,u([],l(t),!1)),r=Math.min.apply(Math,u([],l(e),!1));return{x:n,y:r,width:Math.max.apply(Math,u([],l(t),!1))-n,height:Math.max.apply(Math,u([],l(e),!1))-r}}function CS(t,e,n,r,i,o){return n*Math.cos(i)*Math.cos(o)-r*Math.sin(i)*Math.sin(o)+t}function OS(t,e,n,r,i,o){return n*Math.sin(i)*Math.cos(o)+r*Math.cos(i)*Math.sin(o)+e}function IS(t,e,n,r,i,o,a){for(var s=function(t,e,n){return Math.atan(-e/t*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[o,a],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;o<a?o<d&&d<a&&c.push(d):a<d&&d<o&&c.push(d)}for(h=0;h<c.length;h++){var f=CS(t,0,n,r,i,c[h]);f<l&&(l=f),f>u&&(u=f)}var p=function(t,e,n){return Math.atan(e/(t*Math.tan(n)))}(n,r,i),g=1/0,v=-1/0,m=[o,a];for(h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var y=p+h;o<a?o<y&&y<a&&m.push(y):a<y&&y<o&&m.push(y)}for(h=0;h<m.length;h++){var E=OS(0,e,n,r,i,m[h]);E<g&&(g=E),E>v&&(v=E)}return{x:l,y:g,width:u-l,height:v-g}}qx(Qx,pS,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:dS,formatHex:dS,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return MS(this).formatHsl()},formatRgb:fS,toString:fS}),qx(mS,(function(t,e,n,r){return 1===arguments.length?((i=t)instanceof Qx||(i=pS(i)),i?new mS((i=i.rgb()).r,i.g,i.b,i.opacity):new mS):new mS(t,e,n,null==r?1:r);var i}),Zx(Qx,{brighter(t){return t=null==t?tS:Math.pow(tS,t),new mS(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Jx:Math.pow(Jx,t),new mS(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new mS(bS(this.r),bS(this.g),bS(this.b),_S(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yS,formatHex:yS,formatHex8:function(){return`#${xS(this.r)}${xS(this.g)}${xS(this.b)}${xS(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ES,toString:ES})),qx(AS,(function(t,e,n,r){return 1===arguments.length?MS(t):new AS(t,e,n,null==r?1:r)}),Zx(Qx,{brighter(t){return t=null==t?tS:Math.pow(tS,t),new AS(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Jx:Math.pow(Jx,t),new AS(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new mS(wS(t>=240?t-240:t+120,i,r),wS(t,i,r),wS(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new AS(RS(this.h),TS(this.s),TS(this.l),_S(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=_S(this.opacity);return`${1===t?"hsl(":"hsla("}${RS(this.h)}, ${100*TS(this.s)}%, ${100*TS(this.l)}%${1===t?")":`, ${t})`}`}}));var LS=1e-4;function DS(t,e,n,r,i,o){var a=-1,s=1/0,c=[n,r],h=20;o&&o>200&&(h=o/10);for(var d=1/h,f=d/10,p=0;p<=h;p++){var g=p*d,v=[i.apply(void 0,u([],l(t.concat([g])),!1)),i.apply(void 0,u([],l(e.concat([g])),!1))];(_=PS(c[0],c[1],v[0],v[1]))<s&&(a=g,s=_)}if(0===a)return{x:t[0],y:e[0]};if(1===a){var m=t.length;return{x:t[m-1],y:e[m-1]}}s=1/0;for(p=0;p<32&&!(f<LS);p++){var y=a-f,E=a+f,_=(v=[i.apply(void 0,u([],l(t.concat([y])),!1)),i.apply(void 0,u([],l(e.concat([y])),!1))],PS(c[0],c[1],v[0],v[1]));if(y>=0&&_<s)a=y,s=_;else{var b=[i.apply(void 0,u([],l(t.concat([E])),!1)),i.apply(void 0,u([],l(e.concat([E])),!1))],x=PS(c[0],c[1],b[0],b[1]);E<=1&&x<s?(a=E,s=x):f*=.5}}return{x:i.apply(void 0,u([],l(t.concat([a])),!1)),y:i.apply(void 0,u([],l(e.concat([a])),!1))}}function BS(t,e,n,r){return PS(t,e,n,r)}function kS(t,e,n,r,i){return{x:(1-i)*t+i*n,y:(1-i)*e+i*r}}function FS(t,e,n,r,i,o){var a=[n-t,r-e];if(function(t,e){return t[0]===e[0]&&t[1]===e[1]}(a,[0,0]))return Math.sqrt((i-t)*(i-t)+(o-e)*(o-e));var s=[-a[1],a[0]];!function(t,e){var n=e[0],r=e[1],i=n*n+r*r;i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i}(s,s);var l=[i-t,o-e];return Math.abs(function(t,e){return t[0]*e[0]+t[1]*e[1]}(l,s))}function US(t,e,n,r,i){var o=1-i;return o*o*o*t+3*e*i*o*o+3*n*i*i*o+r*i*i*i}function GS(t,e,n,r){var i,o,a,s=-3*t+9*e-9*n+3*r,l=6*t-12*e+6*n,u=3*e-3*t,c=[];if(D(s,0))D(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;D(h,0)?c.push(-l/(2*s)):h>0&&(o=(-l-(a=Math.sqrt(h)))/(2*s),(i=(-l+a)/(2*s))>=0&&i<=1&&c.push(i),o>=0&&o<=1&&c.push(o))}return c}function zS(t,e,n,r,i,o,a,s){for(var l=[t,a],u=[e,s],c=GS(t,n,i,a),h=GS(e,r,o,s),d=0;d<c.length;d++)l.push(US(t,n,i,a,c[d]));for(d=0;d<h.length;d++)u.push(US(e,r,o,s,h[d]));return NS(l,u)}function VS(t,e,n,r,i,o,a,s,l,u,c){var h=function(t,e,n,r,i,o,a,s,l,u,c){return DS([t,n,i,a],[e,r,o,s],l,u,US,c)}(t,e,n,r,i,o,a,s,l,u,c);return PS(h.x,h.y,l,u)}function WS(t){return function(t){if(t.length<2)return 0;for(var e=0,n=0;n<t.length-1;n++){var r=t[n],i=t[n+1];e+=PS(r[0],r[1],i[0],i[1])}return e}(t)}function jS(t,e,n,r){var i=1-r;return i*i*t+2*r*i*e+r*r*n}function HS(t,e,n){var r=t+n-2*e;if(D(r,0))return[.5];var i=(t-e)/r;return i<=1&&i>=0?[i]:[]}function XS(t,e,n,r,i,o){var a=HS(t,n,i)[0],s=HS(e,r,o)[0],l=[t,i],u=[e,o];return void 0!==a&&l.push(jS(t,n,i,a)),void 0!==s&&u.push(jS(e,r,o,s)),NS(l,u)}function YS(t,e,n,r,i,o,a,s){var l=function(t,e,n,r,i,o,a,s){return DS([t,n,i],[e,r,o],a,s,jS)}(t,e,n,r,i,o,a,s);return PS(l.x,l.y,a,s)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var KS={exports:{}};!function(t,e){t.exports=function(){function t(t,n,i,o,a){e(t,n,i||0,o||t.length-1,a||r)}function e(t,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=r-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);e(t,r,Math.max(i,Math.floor(r-l*c/s+h)),Math.min(o,Math.floor(r+(s-l)*c/s+h)),a)}var d=t[r],f=i,p=o;for(n(t,i,r),a(t[o],d)>0&&n(t,i,o);f<p;){for(n(t,f,p),f++,p--;a(t[f],d)<0;)f++;for(;a(t[p],d)>0;)p--}0===a(t[i],d)?n(t,i,p):n(t,++p,o),p<=r&&(i=p+1),r<=p&&(o=p-1)}}function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e){return t<e?-1:t>e?1:0}var i=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;o<n;o++){var a=t.children[o];l(i,t.leaf?r(a):a)}return i}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function p(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function g(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function v(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;t(e,s,n,r,o),a.push(n,s,s,r)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var e=this.data,n=[];if(!v(t,e))return n;for(var r=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?r(a):a;v(t,s)&&(e.leaf?n.push(a):g(t,s)?this._all(a,n):i.push(a))}e=i.pop()}return n},i.prototype.collides=function(t){var e=this.data;if(!v(t,e))return!1;for(var n=[];e;){for(var r=0;r<e.children.length;r++){var i=e.children[r],o=e.leaf?this.toBBox(i):i;if(v(t,o)){if(e.leaf||g(t,o))return!0;n.push(i)}}e=n.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=m([]),this},i.prototype.remove=function(t,e){if(!t)return this;for(var n,r,i,a=this.data,s=this.toBBox(t),l=[],u=[];a||l.length;){if(a||(a=l.pop(),r=l[l.length-1],n=u.pop(),i=!0),a.leaf){var c=o(t,a.children,e);if(-1!==c)return a.children.splice(c,1),l.push(a),this._condense(l),this}i||a.leaf||!g(a,s)?r?(n++,a=r.children[n],i=!1):a=null:(l.push(a),u.push(n),n=0,r=a,a=a.children[0])}return this},i.prototype.toBBox=function(t){return t},i.prototype.compareMinX=function(t,e){return t.minX-e.minX},i.prototype.compareMinY=function(t,e){return t.minY-e.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},i.prototype._build=function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return a(i=m(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var l=Math.ceil(o/s),u=l*Math.ceil(Math.sqrt(s));y(t,e,n,u,this.compareMinX);for(var c=e;c<=n;c+=u){var h=Math.min(c+u-1,n);y(t,c,h,l,this.compareMinY);for(var d=c;d<=h;d+=l){var f=Math.min(d+l-1,h);i.children.push(this._build(t,d,f,r-1))}}return a(i,this.toBBox),i},i.prototype._chooseSubtree=function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],u=h(l),c=f(t,l)-u;c<o?(o=c,i=u<i?u:i,a=l):c===o&&u<i&&(i=u,a=l)}e=a||e.children[0]}return e},i.prototype._insert=function(t,e,n){var r=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(r,this.data,e,i);for(o.children.push(t),l(o,r);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)},i.prototype._split=function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},i.prototype._splitRoot=function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(t,e,n){for(var r,i=1/0,o=1/0,a=e;a<=n-e;a++){var l=s(t,0,a,this.toBBox),u=s(t,a,n,this.toBBox),c=p(l,u),d=h(l)+h(u);c<i?(i=c,r=a,o=d<o?d:o):c===i&&d<o&&(o=d,r=a)}return r||n-e},i.prototype._chooseSplitAxis=function(t,e,n){var r=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},i.prototype._allDistMargin=function(t,e,n,r){t.children.sort(r);for(var i=this.toBBox,o=s(t,0,e,i),a=s(t,n-e,n,i),u=d(o)+d(a),c=e;c<n-e;c++){var h=t.children[c];l(o,t.leaf?i(h):h),u+=d(o)}for(var f=n-e-1;f>=e;f--){var p=t.children[f];l(a,t.leaf?i(p):p),u+=d(a)}return u},i.prototype._adjustParentBBoxes=function(t,e,n){for(var r=n;r>=0;r--)l(e[r],t)},i.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():a(t[e],this.toBBox)},i}()}(KS);var $S,qS,ZS=KS.exports;!function(t){t.GROUP="g",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.IMAGE="image",t.RECT="rect",t.LINE="line",t.POLYLINE="polyline",t.POLYGON="polygon",t.TEXT="text",t.PATH="path",t.HTML="html",t.MESH="mesh"}($S||($S={})),function(t){t[t.ZERO=0]="ZERO",t[t.NEGATIVE_ONE=1]="NEGATIVE_ONE"}(qS||(qS={}));var QS=function(){function t(){this.plugins=[]}return t.prototype.addRenderingPlugin=function(t){this.plugins.push(t),this.context.renderingPlugins.push(t)},t.prototype.removeAllRenderingPlugins=function(){var t=this;this.plugins.forEach((function(e){var n=t.context.renderingPlugins.indexOf(e);n>=0&&t.context.renderingPlugins.splice(n,1)}))},t}(),JS=function(){function t(t){this.clipSpaceNearZ=qS.NEGATIVE_ONE,this.plugins=[],this.config=r({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0},t)}return t.prototype.registerPlugin=function(t){-1===this.plugins.findIndex((function(e){return e===t}))&&this.plugins.push(t)},t.prototype.unregisterPlugin=function(t){var e=this.plugins.findIndex((function(e){return e===t}));e>-1&&this.plugins.splice(e,1)},t.prototype.getPlugins=function(){return this.plugins},t.prototype.getPlugin=function(t){return this.plugins.find((function(e){return e.name===t}))},t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){Object.assign(this.config,t)},t}();function tM(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function eM(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function nM(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function rM(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function iM(t){return void 0===t?0:t>360||t<-360?t%360:t}function oM(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),Array.isArray(t)&&3===t.length?Yt(t):I(t)?$t(t,e,n):$t(t[0],t[1]||e,t[2]||n)}function aM(t){return t*(Math.PI/180)}function sM(t){return t*(180/Math.PI)}function lM(t,e){return 16===e.length?function(t,e){var n,r,i=.5*Math.PI,o=l(Ot(Xt(),e),3),a=o[0],s=o[1],u=o[2],c=Math.asin(-e[2]/a);return c<i?c>-i?(n=Math.atan2(e[6]/s,e[10]/u),r=Math.atan2(e[1]/a,e[0]/a)):(r=0,n=-Math.atan2(e[4]/s,e[5]/s)):(r=0,n=Math.atan2(e[4]/s,e[5]/s)),t[0]=n,t[1]=c,t[2]=r,t}(t,e):function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=r*r,s=i*i,l=o*o,u=n*n+a+s+l,c=n*o-r*i;return c>.499995*u?(t[0]=Math.PI/2,t[1]=2*Math.atan2(r,n),t[2]=0):c<-.499995*u?(t[0]=-Math.PI/2,t[1]=2*Math.atan2(r,n),t[2]=0):(t[0]=Math.asin(2*(n*i-o*r)),t[1]=Math.atan2(2*(n*o+r*i),1-2*(s+l)),t[2]=Math.atan2(2*(n*r+i*o),1-2*(a+s))),t}(t,e)}function uM(t,e,n,r,i){var o,a,s,l,u,c,h,d,f,p,g=Math.cos(t),v=Math.sin(t);return o=r*g,a=i*v,s=0,l=-r*v,u=i*g,c=0,h=e,d=n,f=1,(p=new lt(9))[0]=o,p[1]=a,p[2]=s,p[3]=l,p[4]=u,p[5]=c,p[6]=h,p[7]=d,p[8]=f,p}function cM(t){var e=t[0],n=t[1],r=t[3],i=t[4],o=Math.sqrt(e*e+n*n),a=Math.sqrt(r*r+i*i);e*i-n*r<0&&(e<i?o=-o:a=-a),o&&(e*=1/o,n*=1/o),a&&(r*=1/a,i*=1/a);var s=sM(Math.atan2(n,e));return[t[6],t[7],o,a,s]}var hM=ct(),dM=ct(),fM=ce(),pM=[Xt(),Xt(),Xt()],gM=Xt();function vM(t,e,n,r,i){t[0]=e[0]*r+n[0]*i,t[1]=e[1]*r+n[1]*i,t[2]=e[2]*r+n[2]*i}var mM,yM=function(){function t(){this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return t.isEmpty=function(t){return!t||0===t.halfExtents[0]&&0===t.halfExtents[1]&&0===t.halfExtents[2]},t.prototype.update=function(t,e){tM(this.center,t),tM(this.halfExtents,e),eM(this.min,this.center,this.halfExtents),nM(this.max,this.center,this.halfExtents)},t.prototype.setMinMax=function(t,e){nM(this.center,e,t),rM(this.center,this.center,.5),eM(this.halfExtents,e,t),rM(this.halfExtents,this.halfExtents,.5),tM(this.min,t),tM(this.max,e)},t.prototype.getMin=function(){return this.min},t.prototype.getMax=function(){return this.max},t.prototype.add=function(e){if(!t.isEmpty(e))if(t.isEmpty(this))this.setMinMax(e.getMin(),e.getMax());else{var n=this.center,r=n[0],i=n[1],o=n[2],a=this.halfExtents,s=a[0],l=a[1],u=a[2],c=r-s,h=r+s,d=i-l,f=i+l,p=o-u,g=o+u,v=e.center,m=v[0],y=v[1],E=v[2],_=e.halfExtents,b=_[0],x=_[1],S=_[2],M=m-b,A=m+b,R=y-x,T=y+x,w=E-S,P=E+S;M<c&&(c=M),A>h&&(h=A),R<d&&(d=R),T>f&&(f=T),w<p&&(p=w),P>g&&(g=P),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(p+g),a[0]=.5*(h-c),a[1]=.5*(f-d),a[2]=.5*(g-p),this.min[0]=c,this.min[1]=d,this.min[2]=p,this.max[0]=h,this.max[1]=f,this.max[2]=g}},t.prototype.setFromTransformedAABB=function(t,e){var n=this.center,r=this.halfExtents,i=t.center,o=t.halfExtents,a=e[0],s=e[4],l=e[8],u=e[1],c=e[5],h=e[9],d=e[2],f=e[6],p=e[10],g=Math.abs(a),v=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),b=Math.abs(d),x=Math.abs(f),S=Math.abs(p);n[0]=e[12]+a*i[0]+s*i[1]+l*i[2],n[1]=e[13]+u*i[0]+c*i[1]+h*i[2],n[2]=e[14]+d*i[0]+f*i[1]+p*i[2],r[0]=g*o[0]+v*o[1]+m*o[2],r[1]=y*o[0]+E*o[1]+_*o[2],r[2]=b*o[0]+x*o[1]+S*o[2],eM(this.min,n,r),nM(this.max,n,r)},t.prototype.intersects=function(t){var e=this.getMax(),n=this.getMin(),r=t.getMax(),i=t.getMin();return n[0]<=r[0]&&e[0]>=i[0]&&n[1]<=r[1]&&e[1]>=i[1]&&n[2]<=r[2]&&e[2]>=i[2]},t.prototype.intersection=function(e){if(!this.intersects(e))return null;var n=new t,r=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}([0,0,0],this.getMin(),e.getMin()),i=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}([0,0,0],this.getMax(),e.getMax());return n.setMinMax(r,i),n},t.prototype.getNegativeFarPoint=function(t){return 273===t.pnVertexFlag?tM([0,0,0],this.min):272===t.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===t.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===t.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===t.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===t.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===t.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]},t.prototype.getPositiveFarPoint=function(t){return 273===t.pnVertexFlag?tM([0,0,0],this.max):272===t.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===t.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===t.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===t.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===t.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===t.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]},t}(),EM=function(){function t(t,e){this.distance=t||0,this.normal=e||$t(0,1,0),this.updatePNVertexFlag()}return t.prototype.updatePNVertexFlag=function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)},t.prototype.distanceToPoint=function(t){return ne(t,this.normal)-this.distance},t.prototype.normalize=function(){var t=1/ue(this.normal);te(this.normal,this.normal,t),this.distance*=t},t.prototype.intersectsLine=function(t,e,n){var r=this.distanceToPoint(t),i=r/(r-this.distanceToPoint(e)),o=i>=0&&i<=1;return o&&n&&ie(n,t,e,i),o},t}();!function(t){t[t.OUTSIDE=4294967295]="OUTSIDE",t[t.INSIDE=0]="INSIDE",t[t.INDETERMINATE=2147483647]="INDETERMINATE"}(mM||(mM={}));var _M,bM,xM,SM=function(){function t(t){if(this.planes=[],t)this.planes=t;else for(var e=0;e<6;e++)this.planes.push(new EM)}return t.prototype.extractFromVPMatrix=function(t){var e=l(t,16),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],v=e[13],m=e[14],y=e[15];Zt(this.planes[0].normal,o-n,c-a,p-h),this.planes[0].distance=y-g,Zt(this.planes[1].normal,o+n,c+a,p+h),this.planes[1].distance=y+g,Zt(this.planes[2].normal,o+r,c+s,p+d),this.planes[2].distance=y+v,Zt(this.planes[3].normal,o-r,c-s,p-d),this.planes[3].distance=y-v,Zt(this.planes[4].normal,o-i,c-u,p-f),this.planes[4].distance=y-m,Zt(this.planes[5].normal,o+i,c+u,p+f),this.planes[5].distance=y+m,this.planes.forEach((function(t){t.normalize(),t.updatePNVertexFlag()}))},t}(),MM=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t}(),AM=function(){function t(t,e,n,r){this.x=t,this.y=e,this.width=n,this.height=r,this.left=t,this.right=t+n,this.top=e,this.bottom=e+r}return t.prototype.toJSON=function(){},t}(),RM="Method not implemented.",TM="Use document.documentElement instead.";!function(t){t[t.ORBITING=0]="ORBITING",t[t.EXPLORING=1]="EXPLORING",t[t.TRACKING=2]="TRACKING"}(_M||(_M={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ROTATIONAL=1]="ROTATIONAL",t[t.TRANSLATIONAL=2]="TRANSLATIONAL",t[t.CINEMATIC=3]="CINEMATIC"}(bM||(bM={})),function(t){t[t.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(xM||(xM={}));var wM,PM,NM,CM,OM,IM="updated",LM=2e-4,DM=function(){function t(){this.clipSpaceNearZ=qS.NEGATIVE_ONE,this.eventEmitter=new $x,this.matrix=ct(),this.right=$t(1,0,0),this.up=$t(0,1,0),this.forward=$t(0,0,1),this.position=$t(0,0,1),this.focalPoint=$t(0,0,0),this.distanceVector=$t(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=ct(),this.projectionMatrixInverse=ct(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=_M.EXPLORING,this.trackingMode=bM.DEFAULT,this.projectionMode=xM.PERSPECTIVE,this.frustum=new SM,this.orthoMatrix=ct()}return t.prototype.isOrtho=function(){return this.projectionMode===xM.ORTHOGRAPHIC},t.prototype.getProjectionMode=function(){return this.projectionMode},t.prototype.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},t.prototype.getPerspectiveInverse=function(){return this.projectionMatrixInverse},t.prototype.getFrustum=function(){return this.frustum},t.prototype.getPosition=function(){return this.position},t.prototype.getFocalPoint=function(){return this.focalPoint},t.prototype.getDollyingStep=function(){return this.dollyingStep},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getZoom=function(){return this.zoom},t.prototype.getOrthoMatrix=function(){return this.orthoMatrix},t.prototype.getView=function(){return this.view},t.prototype.setEnableUpdate=function(t){this.enableUpdate=t},t.prototype.setType=function(t,e){return this.type=t,this.type===_M.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===_M.TRACKING&&void 0!==e&&this.setTrackingMode(e),this},t.prototype.setProjectionMode=function(t){return this.projectionMode=t,this},t.prototype.setTrackingMode=function(t){if(this.type!==_M.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this},t.prototype.setWorldRotation=function(t){return this.rotateWorld=t,this._getAngles(),this},t.prototype.getViewTransform=function(){return mt(ct(),this.matrix)},t.prototype.getWorldTransform=function(){return this.matrix},t.prototype.jitterProjectionMatrix=function(t,e){var n=Mt(ct(),[t,e,0]);this.jitteredProjectionMatrix=Et(ct(),n,this.projectionMatrix)},t.prototype.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},t.prototype.setMatrix=function(t){return this.matrix=t,this._update(),this},t.prototype.setProjectionMatrix=function(t){this.projectionMatrix=t},t.prototype.setFov=function(t){return this.setPerspective(this.near,this.far,t,this.aspect),this},t.prototype.setAspect=function(t){return this.setPerspective(this.near,this.far,this.fov,t),this},t.prototype.setNear=function(t){return this.projectionMode===xM.PERSPECTIVE?this.setPerspective(t,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,t,this.far),this},t.prototype.setFar=function(t){return this.projectionMode===xM.PERSPECTIVE?this.setPerspective(this.near,t,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,t),this},t.prototype.setViewOffset=function(t,e,n,r,i,o){return this.aspect=t/e,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.projectionMode===xM.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.clearViewOffset=function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===xM.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.setZoom=function(t){return this.zoom=t,this.projectionMode===xM.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===xM.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},t.prototype.setZoomByViewportPoint=function(t,e){var n=this.canvas.viewport2Canvas({x:e[0],y:e[1]}),r=n.x,i=n.y,o=this.roll;this.rotate(0,0,-o),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(t),this.rotate(0,0,o);var a=this.canvas.viewport2Canvas({x:e[0],y:e[1]}),s=$t(a.x-r,a.y-i,0),l=ne(s,this.right)/Kt(this.right),u=ne(s,this.up)/Kt(this.up);return this.pan(-l,-u),this},t.prototype.setPerspective=function(t,e,n,r){var i;this.projectionMode=xM.PERSPECTIVE,this.fov=n,this.near=t,this.far=e,this.aspect=r;var o=this.near*Math.tan(aM(.5*this.fov))/this.zoom,a=2*o,s=this.aspect*a,l=-.5*s;if(null===(i=this.view)||void 0===i?void 0:i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,o-=this.view.offsetY*a/c,s*=this.view.width/u,a*=this.view.height/c}return function(t,e,n,r,i,o,a,s){void 0===s&&(s=!1);var l,u,c=2*o/(n-e),h=2*o/(r-i),d=(n+e)/(n-e),f=(r+i)/(r-i);s?(l=-a/(a-o),u=-a*o/(a-o)):(l=-(a+o)/(a-o),u=-2*a*o/(a-o)),t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=d,t[9]=f,t[10]=l,t[11]=-1,t[12]=0,t[13]=0,t[14]=u,t[15]=0}(this.projectionMatrix,l,l+s,o,o-a,t,this.far,this.clipSpaceNearZ===qS.ZERO),bt(this.projectionMatrix,this.projectionMatrix,$t(1,-1,1)),mt(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this},t.prototype.setOrthographic=function(t,e,n,r,i,o){var a;this.projectionMode=xM.ORTHOGRAPHIC,this.rright=e,this.left=t,this.top=n,this.bottom=r,this.near=i,this.far=o;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,p=c-l;if(null===(a=this.view)||void 0===a?void 0:a.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,v=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,p=(f-=v*this.view.offsetY)-v*this.view.height}return this.clipSpaceNearZ===qS.NEGATIVE_ONE?Ut(this.projectionMatrix,h,d,p,f,i,o):Gt(this.projectionMatrix,h,d,p,f,i,o),bt(this.projectionMatrix,this.projectionMatrix,$t(1,-1,1)),mt(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this},t.prototype.setPosition=function(t,e,n){void 0===e&&(e=this.position[1]),void 0===n&&(n=this.position[2]);var r=oM(t,e,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this},t.prototype.setFocalPoint=function(t,e,n){void 0===e&&(e=this.focalPoint[1]),void 0===n&&(n=this.focalPoint[2]);var r=$t(0,1,0);if(this.focalPoint=oM(t,e,n),this.trackingMode===bM.CINEMATIC){var i=Jt(Xt(),this.focalPoint,this.position);t=i[0],e=i[1],n=i[2];var o=Kt(i),a=sM(Math.asin(e/o)),s=90+sM(Math.atan2(n,t)),l=ct();St(l,l,aM(s)),xt(l,l,aM(a)),r=oe(Xt(),[0,1,0],l)}return mt(this.matrix,zt(ct(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this},t.prototype.getDistance=function(){return this.distance},t.prototype.getDistanceVector=function(){return this.distanceVector},t.prototype.setDistance=function(t){if(this.distance===t||t<0)return this;this.distance=t,this.distance<LM&&(this.distance=LM),this.dollyingStep=this.distance/100;var e=Xt();t=this.distance;var n=this.forward,r=this.focalPoint;return e[0]=t*n[0]+r[0],e[1]=t*n[1]+r[1],e[2]=t*n[2]+r[2],this._setPosition(e),this.triggerUpdate(),this},t.prototype.setMaxDistance=function(t){return this.maxDistance=t,this},t.prototype.setMinDistance=function(t){return this.minDistance=t,this},t.prototype.setAzimuth=function(t){return this.azimuth=iM(t),this.computeMatrix(),this._getAxes(),this.type===_M.ORBITING||this.type===_M.EXPLORING?this._getPosition():this.type===_M.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getAzimuth=function(){return this.azimuth},t.prototype.setElevation=function(t){return this.elevation=iM(t),this.computeMatrix(),this._getAxes(),this.type===_M.ORBITING||this.type===_M.EXPLORING?this._getPosition():this.type===_M.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getElevation=function(){return this.elevation},t.prototype.setRoll=function(t){return this.roll=iM(t),this.computeMatrix(),this._getAxes(),this.type===_M.ORBITING||this.type===_M.EXPLORING?this._getPosition():this.type===_M.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getRoll=function(){return this.roll},t.prototype._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()},t.prototype.computeMatrix=function(){var t=fe(de(),[0,0,1],aM(this.roll));gt(this.matrix);var e=fe(de(),[1,0,0],aM((this.rotateWorld&&this.type!==_M.TRACKING||this.type===_M.TRACKING?1:-1)*this.elevation)),n=fe(de(),[0,1,0],aM((this.rotateWorld&&this.type!==_M.TRACKING||this.type===_M.TRACKING?1:-1)*this.azimuth)),r=pe(de(),n,e);r=pe(de(),r,t);var i=Dt(ct(),r);this.type===_M.ORBITING||this.type===_M.EXPLORING?(_t(this.matrix,this.matrix,this.focalPoint),Et(this.matrix,this.matrix,i),_t(this.matrix,this.matrix,[0,0,this.distance])):this.type===_M.TRACKING&&(_t(this.matrix,this.matrix,this.position),Et(this.matrix,this.matrix,i))},t.prototype._setPosition=function(t,e,n){this.position=oM(t,e,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()},t.prototype._getAxes=function(){qt(this.right,oM(he(ce(),[1,0,0,0],this.matrix))),qt(this.up,oM(he(ce(),[0,1,0,0],this.matrix))),qt(this.forward,oM(he(ce(),[0,0,1,0],this.matrix))),ee(this.right,this.right),ee(this.up,this.up),ee(this.forward,this.forward)},t.prototype._getAngles=function(){var t=this.distanceVector[0],e=this.distanceVector[1],n=this.distanceVector[2],r=Kt(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===_M.TRACKING||this.rotateWorld?(this.elevation=sM(Math.asin(e/r)),this.azimuth=sM(Math.atan2(-t,-n))):(this.elevation=-sM(Math.asin(e/r)),this.azimuth=-sM(Math.atan2(-t,-n)))},t.prototype._getPosition=function(){qt(this.position,oM(he(ce(),[0,0,0,1],this.matrix))),this._getDistance()},t.prototype._getFocalPoint=function(){!function(t,e,n){var r=e[0],i=e[1],o=e[2];t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8]}(this.distanceVector,[0,0,-this.distance],function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}(ut(),this.matrix)),Qt(this.focalPoint,this.position,this.distanceVector),this._getDistance()},t.prototype._getDistance=function(){this.distanceVector=Jt(Xt(),this.focalPoint,this.position),this.distance=Kt(this.distanceVector),this.dollyingStep=this.distance/100},t.prototype._getOrthoMatrix=function(){if(this.projectionMode===xM.ORTHOGRAPHIC){var t=this.position,e=fe(de(),[0,0,1],-this.roll*Math.PI/180);Lt(this.orthoMatrix,e,$t((this.rright-this.left)/2-t[0],(this.top-this.bottom)/2-t[1],0),$t(this.zoom,this.zoom,1),t)}},t.prototype.triggerUpdate=function(){if(this.enableUpdate){var t=this.getViewTransform(),e=Et(ct(),this.getPerspective(),t);this.getFrustum().extractFromVPMatrix(e),this.eventEmitter.emit(IM)}},t.prototype.rotate=function(t,e,n){throw new Error(RM)},t.prototype.pan=function(t,e){throw new Error(RM)},t.prototype.dolly=function(t){throw new Error(RM)},t.prototype.createLandmark=function(t,e){throw new Error(RM)},t.prototype.gotoLandmark=function(t,e){throw new Error(RM)},t.prototype.cancelLandmarkAnimation=function(){throw new Error(RM)},t}();function BM(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return n.cache=a.set(o,s)||a,s};return n.cache=new(BM.Cache||Map),n}BM.Cache=Map,function(t){t[t.kUnknown=0]="kUnknown",t[t.kNumber=1]="kNumber",t[t.kPercentage=2]="kPercentage",t[t.kEms=3]="kEms",t[t.kPixels=4]="kPixels",t[t.kRems=5]="kRems",t[t.kDegrees=6]="kDegrees",t[t.kRadians=7]="kRadians",t[t.kGradians=8]="kGradians",t[t.kTurns=9]="kTurns",t[t.kMilliseconds=10]="kMilliseconds",t[t.kSeconds=11]="kSeconds",t[t.kInteger=12]="kInteger"}(wM||(wM={})),function(t){t[t.kUNumber=0]="kUNumber",t[t.kUPercent=1]="kUPercent",t[t.kULength=2]="kULength",t[t.kUAngle=3]="kUAngle",t[t.kUTime=4]="kUTime",t[t.kUOther=5]="kUOther"}(PM||(PM={})),function(t){t[t.kAll=0]="kAll",t[t.kNonNegative=1]="kNonNegative",t[t.kInteger=2]="kInteger",t[t.kNonNegativeInteger=3]="kNonNegativeInteger",t[t.kPositiveInteger=4]="kPositiveInteger"}(NM||(NM={})),function(t){t[t.kYes=0]="kYes",t[t.kNo=1]="kNo"}(CM||(CM={})),function(t){t[t.kYes=0]="kYes",t[t.kNo=1]="kNo"}(OM||(OM={}));var kM,FM=[{name:"em",unit_type:wM.kEms},{name:"px",unit_type:wM.kPixels},{name:"deg",unit_type:wM.kDegrees},{name:"rad",unit_type:wM.kRadians},{name:"grad",unit_type:wM.kGradians},{name:"ms",unit_type:wM.kMilliseconds},{name:"s",unit_type:wM.kSeconds},{name:"rem",unit_type:wM.kRems},{name:"turn",unit_type:wM.kTurns}];!function(t){t[t.kUnknownType=0]="kUnknownType",t[t.kUnparsedType=1]="kUnparsedType",t[t.kKeywordType=2]="kKeywordType",t[t.kUnitType=3]="kUnitType",t[t.kSumType=4]="kSumType",t[t.kProductType=5]="kProductType",t[t.kNegateType=6]="kNegateType",t[t.kInvertType=7]="kInvertType",t[t.kMinType=8]="kMinType",t[t.kMaxType=9]="kMaxType",t[t.kClampType=10]="kClampType",t[t.kTransformType=11]="kTransformType",t[t.kPositionType=12]="kPositionType",t[t.kURLImageType=13]="kURLImageType",t[t.kColorType=14]="kColorType",t[t.kUnsupportedColorType=15]="kUnsupportedColorType"}(kM||(kM={}));var UM,GM=function(t){return t?"number"===t?wM.kNumber:"percent"===t||"%"===t?wM.kPercentage:function(t){return FM.find((function(e){return e.name===t})).unit_type}(t):wM.kUnknown},zM=function(t){var e=1;switch(t){case wM.kPixels:case wM.kDegrees:case wM.kSeconds:break;case wM.kMilliseconds:e=.001;break;case wM.kRadians:e=180/Math.PI;break;case wM.kGradians:e=.9;break;case wM.kTurns:e=360}return e},VM=function(t){switch(t){case wM.kNumber:case wM.kInteger:return"";case wM.kPercentage:return"%";case wM.kEms:return"em";case wM.kRems:return"rem";case wM.kPixels:return"px";case wM.kDegrees:return"deg";case wM.kRadians:return"rad";case wM.kGradians:return"grad";case wM.kMilliseconds:return"ms";case wM.kSeconds:return"s";case wM.kTurns:return"turn"}return""},WM=function(){function t(){}return t.isAngle=function(t){return t===wM.kDegrees||t===wM.kRadians||t===wM.kGradians||t===wM.kTurns},t.isLength=function(t){return t>=wM.kEms&&t<wM.kDegrees},t.isRelativeUnit=function(t){return t===wM.kPercentage||t===wM.kEms||t===wM.kRems},t.isTime=function(t){return t===wM.kSeconds||t===wM.kMilliseconds},t.prototype.toString=function(){return this.buildCSSText(CM.kNo,OM.kNo,"")},t.prototype.isNumericValue=function(){return this.getType()>=kM.kUnitType&&this.getType()<=kM.kClampType},t}(),jM=function(t){function e(e){var n=t.call(this)||this;return n.colorSpace=e,n}return n(e,t),e.prototype.getType=function(){return kM.kColorType},e.prototype.to=function(t){return this},e}(WM);!function(t){t[t.Constant=0]="Constant",t[t.LinearGradient=1]="LinearGradient",t[t.RadialGradient=2]="RadialGradient"}(UM||(UM={}));var HM=function(t){function e(e,n){var r=t.call(this)||this;return r.type=e,r.value=n,r}return n(e,t),e.prototype.clone=function(){return new e(this.type,this.value)},e.prototype.buildCSSText=function(t,e,n){return n},e.prototype.getType=function(){return kM.kColorType},e}(WM),XM=function(t){function e(e){var n=t.call(this)||this;return n.value=e,n}return n(e,t),e.prototype.clone=function(){return new e(this.value)},e.prototype.getType=function(){return kM.kKeywordType},e.prototype.buildCSSText=function(t,e,n){return n+this.value},e}(WM),YM=BM((function(t){return void 0===t&&(t=""),t.replace(/-([a-z])/g,(function(t){return t[1].toUpperCase()}))})),KM=function(t){return t.split("").map((function(t,e){return t.toUpperCase()===t?"".concat(0!==e?"-":"").concat(t.toLowerCase()):t})).join("")};function $M(t){return"function"==typeof t}var qM={d:{alias:"path"},strokeDasharray:{alias:"lineDash"},strokeWidth:{alias:"lineWidth"},textAnchor:{alias:"textAlign"},src:{alias:"img"}},ZM=BM((function(t){var e=YM(t),n=qM[e];return e=(null==n?void 0:n.alias)||e})),QM=function(t,e){void 0===e&&(e="");var n="";return Number.isFinite(t)?(!function(t){if(!t)throw new Error}(Number.isNaN(t)),n="NaN"):n=t>0?"infinity":"-infinity",n+e},JM=function(t){return function(t){switch(t){case PM.kUNumber:return wM.kNumber;case PM.kULength:return wM.kPixels;case PM.kUPercent:return wM.kPercentage;case PM.kUTime:return wM.kSeconds;case PM.kUAngle:return wM.kDegrees;default:return wM.kUnknown}}(function(t){switch(t){case wM.kNumber:case wM.kInteger:return PM.kUNumber;case wM.kPercentage:return PM.kUPercent;case wM.kPixels:return PM.kULength;case wM.kMilliseconds:case wM.kSeconds:return PM.kUTime;case wM.kDegrees:case wM.kRadians:case wM.kGradians:case wM.kTurns:return PM.kUAngle;default:return PM.kUOther}}(t))},tA=function(t){function e(e,n){void 0===n&&(n=wM.kNumber);var r,i=t.call(this)||this;return r="string"==typeof n?GM(n):n,i.unit=r,i.value=e,i}return n(e,t),e.prototype.clone=function(){return new e(this.value,this.unit)},e.prototype.equals=function(t){var e=t;return this.value===e.value&&this.unit===e.unit},e.prototype.getType=function(){return kM.kUnitType},e.prototype.convertTo=function(t){if(this.unit===t)return new e(this.value,this.unit);var n=JM(this.unit);if(n!==JM(t)||n===wM.kUnknown)return null;var r=zM(this.unit)/zM(t);return new e(this.value*r,t)},e.prototype.buildCSSText=function(t,e,n){var r;switch(this.unit){case wM.kUnknown:break;case wM.kInteger:r=Number(this.value).toFixed(0);break;case wM.kNumber:case wM.kPercentage:case wM.kEms:case wM.kRems:case wM.kPixels:case wM.kDegrees:case wM.kRadians:case wM.kGradians:case wM.kMilliseconds:case wM.kSeconds:case wM.kTurns:var i=this.value,o=VM(this.unit);if(i<-999999||i>999999){var a=VM(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?QM(i,a):i+(a||"")}else r="".concat(i).concat(o)}return n+=r},e}(WM),eA=new tA(0,"px");new tA(1,"px");var nA,rA,iA=new tA(0,"deg"),oA=function(t){function e(e,n,r,i,o){void 0===i&&(i=1),void 0===o&&(o=!1);var a=t.call(this,"rgb")||this;return a.r=e,a.g=n,a.b=r,a.alpha=i,a.isNone=o,a}return n(e,t),e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.alpha)},e.prototype.buildCSSText=function(t,e,n){return n+"rgba(".concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")},e}(jM),aA=new XM("unset"),sA=new XM("initial"),lA=new XM("inherit"),uA={"":aA,unset:aA,initial:sA,inherit:lA},cA=function(t){return uA[t]||(uA[t]=new XM(t)),uA[t]},hA=new oA(0,0,0,0,!0),dA=new oA(0,0,0,0),fA=BM((function(t,e,n,r){return new oA(t,e,n,r)}),(function(t,e,n,r){return"rgba(".concat(t,",").concat(e,",").concat(n,",").concat(r,")")})),pA=function(t,e){return void 0===e&&(e=wM.kNumber),new tA(t,e)};new tA(50,"%"),function(t){t[t.Standard=0]="Standard"}(nA||(nA={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED",t[t.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED"}(rA||(rA={}));var gA,vA={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new AM(0,0,0,0)};function mA(t){var e=t.type,n=t.value;return"hex"===e?"#".concat(n):"literal"===e?n:"rgb"===e?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}!function(t){t.COORDINATE="<coordinate>",t.COLOR="<color>",t.PAINT="<paint>",t.NUMBER="<number>",t.ANGLE="<angle>",t.OPACITY_VALUE="<opacity-value>",t.SHADOW_BLUR="<shadow-blur>",t.LENGTH="<length>",t.PERCENTAGE="<percentage>",t.LENGTH_PERCENTAGE="<length> | <percentage>",t.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",t.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",t.LIST_OF_POINTS="<list-of-points>",t.PATH="<path>",t.FILTER="<filter>",t.Z_INDEX="<z-index>",t.OFFSET_DISTANCE="<offset-distance>",t.DEFINED_PATH="<defined-path>",t.MARKER="<marker>",t.TRANSFORM="<transform>",t.TRANSFORM_ORIGIN="<transform-origin>",t.TEXT="<text>",t.TEXT_TRANSFORM="<text-transform>"}(gA||(gA={}));var yA=function(){var t={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function n(t){throw new Error(e+": "+t)}function r(){var t=f(i);return e.length>0&&n("Invalid input not EOF"),t}function i(){return o("linear-gradient",t.linearGradient,s)||o("repeating-linear-gradient",t.repeatingLinearGradient,s)||o("radial-gradient",t.radialGradient,l)||o("repeating-radial-gradient",t.repeatingRadialGradient,l)||o("conic-gradient",t.conicGradient,l)}function o(e,r,i){return a(r,(function(r){var o=i();return o&&(E(t.comma)||n("Missing comma before color stops")),{type:e,orientation:o,colorStops:f(p)}}))}function a(e,r){var i=E(e);if(i){E(t.startCall)||n("Missing (");var o=r(i);return E(t.endCall)||n("Missing )"),o}}function s(){return y("directional",t.sideOrCorner,1)||y("angular",t.angleValue,1)}function l(){var n,r,i=u();return i&&((n=[]).push(i),r=e,E(t.comma)&&((i=u())?n.push(i):e=r)),n}function u(){var t=function(){var t=y("shape",/^(circle)/i,0);t&&(t.style=m()||c());return t}()||function(){var t=y("shape",/^(ellipse)/i,0);t&&(t.style=v()||c());return t}();if(t)t.at=h();else{var e=c();if(e){t=e;var n=h();n&&(t.at=n)}else{var r=d();r&&(t={type:"default-radial",at:r})}}return t}function c(){return y("extent-keyword",t.extentKeywords,1)}function h(){if(y("position",/^at/,0)){var t=d();return t||n("Missing positioning value"),t}}function d(){var t={x:v(),y:v()};if(t.x||t.y)return{type:"position",value:t}}function f(e){var r=e(),i=[];if(r)for(i.push(r);E(t.comma);)(r=e())?i.push(r):n("One extra comma");return i}function p(){var e=y("hex",t.hexColor,1)||a(t.rgbaColor,(function(){return{type:"rgba",value:f(g)}}))||a(t.rgbColor,(function(){return{type:"rgb",value:f(g)}}))||y("literal",t.literalColor,0);return e||n("Expected color definition"),e.length=v(),e}function g(){return E(t.number)[1]}function v(){return y("%",t.percentageValue,1)||y("position-keyword",t.positionKeywords,1)||m()}function m(){return y("px",t.pixelValue,1)||y("em",t.emValue,1)}function y(t,e,n){var r=E(e);if(r)return{type:t,value:r[n]}}function E(t){var n=/^[\n\r\t\s]+/.exec(e);n&&_(n[0].length);var r=t.exec(e);return r&&_(r[0].length),r}function _(t){e=e.substring(t)}return function(t){return e=t,r()}}();var EA=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,_A=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,bA=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,xA=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var SA={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},MA=BM((function(t){var e;return e="angular"===t.type?Number(t.value):SA[t.value]||0,pA(e,"deg")})),AA=BM((function(t){var e=50,n=50,r="%",i="%";if("position"===(null==t?void 0:t.type)){var o=t.value,a=o.x,s=o.y;"position-keyword"===(null==a?void 0:a.type)&&("left"===a.value?e=0:"center"===a.value?e=50:"right"===a.value?e=100:"top"===a.value?n=0:"bottom"===a.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?e=0:"center"===s.value?n=50:"right"===s.value?e=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==a?void 0:a.type)&&"%"!==(null==a?void 0:a.type)&&"em"!==(null==a?void 0:a.type)||(r=null==a?void 0:a.type,e=Number(a.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:pA(e,r),cy:pA(n,i)}})),RA=BM((function(t){var e;if(t.indexOf("linear")>-1||t.indexOf("radial")>-1)return yA(t).map((function(t){var e=t.type,n=t.orientation,r=t.colorStops;!function(t){var e,n,r,i=t.length;t[i-1].length=null!==(e=t[i-1].length)&&void 0!==e?e:{type:"%",value:"100"},i>1&&(t[0].length=null!==(n=t[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var o=0,a=Number(t[0].length.value),s=1;s<i;s++){var l=null===(r=t[s].length)||void 0===r?void 0:r.value;if(!_(l)&&!_(a)){for(var u=1;u<s-o;u++)t[o+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(s-o))};o=s,a=Number(l)}}}(r);var i=r.map((function(t){return{offset:pA(Number(t.length.value),"%"),color:mA(t)}}));if("linear-gradient"===e)return new HM(UM.LinearGradient,{angle:n?MA(n):iA,steps:i});if("radial-gradient"===e&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o=AA(n[0].at),a=o.cx,s=o.cy,l=void 0;if(n[0].style){var u=n[0].style,c=u.type,h=u.value;l="extent-keyword"===c?cA(h):pA(h,c)}return new HM(UM.RadialGradient,{cx:a,cy:s,size:l,steps:i})}}));var n=t[0];if("("===t[1]||"("===t[2])if("l"===n){var r=EA.exec(t);if(r){var i=(null===(e=r[2].match(xA))||void 0===e?void 0:e.map((function(t){return t.split(":")})))||[];return[new HM(UM.LinearGradient,{angle:pA(parseFloat(r[1]),"deg"),steps:i.map((function(t){var e=l(t,2),n=e[0],r=e[1];return{offset:pA(100*Number(n),"%"),color:r}}))})]}}else if("r"===n){var o=function(t){var e,n=_A.exec(t);if(n){var r=(null===(e=n[4].match(xA))||void 0===e?void 0:e.map((function(t){return t.split(":")})))||[];return{cx:pA(50,"%"),cy:pA(50,"%"),steps:r.map((function(t){var e=l(t,2),n=e[0],r=e[1];return{offset:pA(100*Number(n),"%"),color:r}}))}}return null}(t);if(o){if(!N(o))return[new HM(UM.RadialGradient,o)];t=o}}else if("p"===n)return function(t){var e=bA.exec(t);if(e){var n=e[1],r=e[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(t)}));function TA(t){return t&&!!t.image}function wA(t){return t&&!_(t.r)&&!_(t.g)&&!_(t.b)}var PA=BM((function(t){if(TA(t))return r({repetition:"repeat"},t);if(_(t)&&(t=""),"transparent"===t)return dA;if("currentColor"===t)t="black";else if("none"===t)return hA;var e=RA(t);if(e)return e;var n=pS(t),i=[0,0,0,0];return null!==n&&(i[0]=n.r||0,i[1]=n.g||0,i[2]=n.b||0,i[3]=n.opacity),fA.apply(void 0,u([],l(i),!1))}));function NA(t,e){if(wA(t)&&wA(e))return[[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],function(t){var e=t.slice();if(e[3])for(var n=0;n<3;n++)e[n]=Math.round(O(e[n],0,255));return e[3]=O(e[3],0,1),"rgba(".concat(e.join(","),")")}]}function CA(t,e){if(_(e))return pA(0,"px");if(e="".concat(e).trim().toLowerCase(),isFinite(Number(e))){if("px".search(t)>=0)return pA(Number(e),"px");if("deg".search(t)>=0)return pA(Number(e),"deg")}var n=[];e=e.replace(t,(function(t){return n.push(t),"U"+t}));var r="U("+t.source+")";return n.map((function(t){return pA(Number(e.replace(new RegExp("U"+t,"g"),"").replace(new RegExp(r,"g"),"*0")),t)}))[0]}var OA=function(t){return CA(new RegExp("px","g"),t)},IA=BM(OA);BM((function(t){return CA(new RegExp("%","g"),t)}));var LA=function(t){return I(t)||isFinite(Number(t))?pA(Number(t)||0,"px"):CA(new RegExp("px|%|em|rem","g"),t)},DA=BM(LA),BA=function(t){return CA(new RegExp("deg|rad|grad|turn","g"),t)},kA=BM(BA);function FA(t,e,n,r,i){void 0===i&&(i=0);var o="",a=t.value||0,s=e.value||0,l=JM(t.unit),u=t.convertTo(l),c=e.convertTo(l);return u&&c?(a=u.value,s=c.value,o=VM(t.unit)):(tA.isLength(t.unit)||tA.isLength(e.unit))&&(a=VA(t,i,n),s=VA(e,i,n),o="px"),[a,s,function(t){return t+o}]}function UA(t){var e=0;return t.unit===wM.kDegrees?e=t.value:t.unit===wM.kRadians?e=sM(Number(t.value)):t.unit===wM.kTurns&&(e=360*Number(t.value)),e}function GA(t,e){var n;return Array.isArray(t)?n=t.map((function(t){return Number(t)})):N(t)?n=t.split(" ").map((function(t){return Number(t)})):I(t)&&(n=[t]),2===e?1===n.length?[n[0],n[0]]:[n[0],n[1]]:1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]}function zA(t){return N(t)?t.split(" ").map((function(t){return DA(t)})):t.map((function(t){return DA(t.toString())}))}function VA(t,e,n,r){if(void 0===r&&(r=!1),t.unit===wM.kPixels)return Number(t.value);if(t.unit===wM.kPercentage&&n){var i=n.nodeName===$S.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[e]:0)+t.value/100*i.halfExtents[e]*2}return 0}var WA=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function jA(t){if(void 0===t&&(t=""),"none"===(t=t.toLowerCase().trim()))return[];for(var e,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;e=n.exec(t);){if(e.index!==i)return[];if(i=e.index+e[0].length,WA.indexOf(e[1])>-1&&r.push({name:e[1],params:e[2].split(" ").map((function(t){return CA(/deg|rad|grad|turn|px|%/g,t)||PA(t)}))}),n.lastIndex===t.length)return r}return[]}function HA(t){return t.toString()}var XA=function(t){return"number"==typeof t?pA(t):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(t)?pA(Number(t)):pA(0)},YA=BM(XA);function KA(t,e){return[t,e,HA]}function $A(t,e){return function(n,r){return[n,r,function(n){return HA(O(n,t,e))}]}}function qA(t,e){if(t.length===e.length)return[t,e,function(t){return t}]}function ZA(t){var e;return 0===t.parsedStyle.d.totalLength&&(t.parsedStyle.d.totalLength=Je(t.parsedStyle.d.absolutePath,void 0,r(r({},e),{bbox:!1,length:!0})).length),t.parsedStyle.d.totalLength}function QA(t,e){return t[0]===e[0]&&t[1]===e[1]}function JA(t,e){var n=t.prePoint,r=t.currentPoint,i=t.nextPoint,o=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),a=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((o+a-s)/(2*Math.sqrt(o)*Math.sqrt(a)));if(!l||0===Math.sin(l)||D(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(e/2*(1/Math.sin(l/2)))-e/2||0,yExtra:Math.cos(c-l/2)*(e/2*(1/Math.sin(l/2)))-e/2||0}}function tR(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}BM((function(t){return N(t)?t.split(" ").map(YA):t.map(YA)}));var eR=function(t,e){var n=t.x*e.x+t.y*e.y,r=Math.sqrt((Math.pow(t.x,2)+Math.pow(t.y,2))*(Math.pow(e.x,2)+Math.pow(e.y,2)));return(t.x*e.y-t.y*e.x<0?-1:1)*Math.acos(n/r)},nR=function(t,e,n,r,i,o,a,s){e=Math.abs(e),n=Math.abs(n);var l=aM(r=F(r,360));if(t.x===a.x&&t.y===a.y)return{x:t.x,y:t.y,ellipticalArcAngle:0};if(0===e||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(t.x-a.x)/2,c=(t.y-a.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(e,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(e=Math.sqrt(d)*e,n=Math.sqrt(d)*n);var f=(Math.pow(e,2)*Math.pow(n,2)-Math.pow(e,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(e,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var p=(i!==o?1:-1)*Math.sqrt(f),g=p*(e*h.y/n),v=p*(-n*h.x/e),m={x:Math.cos(l)*g-Math.sin(l)*v+(t.x+a.x)/2,y:Math.sin(l)*g+Math.cos(l)*v+(t.y+a.y)/2},y={x:(h.x-g)/e,y:(h.y-v)/n},E=eR({x:1,y:0},y),_=eR(y,{x:(-h.x-g)/e,y:(-h.y-v)/n});!o&&_>0?_-=2*Math.PI:o&&_<0&&(_+=2*Math.PI);var b=E+(_%=2*Math.PI)*s,x=e*Math.cos(b),S=n*Math.sin(b);return{x:Math.cos(l)*x-Math.sin(l)*S+m.x,y:Math.sin(l)*x+Math.cos(l)*S+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:b,ellipticalArcCenter:m,resultantRx:e,resultantRy:n}};function rR(t,e,n){void 0===n&&(n=!0);var r=t.arcParams,i=r.rx,o=void 0===i?0:i,a=r.ry,s=void 0===a?0:a,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=nR({x:t.prePoint[0],y:t.prePoint[1]},o,s,l,!!u,!!c,{x:t.currentPoint[0],y:t.currentPoint[1]},e),d=nR({x:t.prePoint[0],y:t.prePoint[1]},o,s,l,!!u,!!c,{x:t.currentPoint[0],y:t.currentPoint[1]},n?e+.005:e-.005),f=d.x-h.x,p=d.y-h.y,g=Math.sqrt(f*f+p*p);return{x:-f/g,y:-p/g}}function iR(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function oR(t,e){return iR(t)*iR(e)?(t[0]*e[0]+t[1]*e[1])/(iR(t)*iR(e)):1}function aR(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(oR(t,e))}function sR(t,e){var n=e[1],r=e[2],i=F(aM(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],l=t[1],u=e[6],c=e[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var p=n*n*(d*d)+r*r*(h*h),g=p?Math.sqrt((n*n*(r*r)-p)/p):1;o===a&&(g*=-1),isNaN(g)&&(g=0);var v=r?g*n*d/r:0,m=n?g*-r*h/n:0,y=(s+u)/2+Math.cos(i)*v-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*v+Math.cos(i)*m,_=[(h-v)/n,(d-m)/r],b=[(-1*h-v)/n,(-1*d-m)/r],x=aR([1,0],_),S=aR(_,b);return oR(_,b)<=-1&&(S=Math.PI),oR(_,b)>=1&&(S=0),0===a&&S>0&&(S-=2*Math.PI),1===a&&S<0&&(S+=2*Math.PI),{cx:y,cy:E,rx:QA(t,[u,c])?0:n,ry:QA(t,[u,c])?0:r,startAngle:x,endAngle:x+S,xRotation:i,arcFlag:o,sweepFlag:a}}function lR(t,e,n,r){var i=(-1+Math.sqrt(2))/3*4,o=t*i,a=e*i,s=n-t,l=n+t,u=r-e,c=r+e;return[["M",s,r],["C",s,r-a,n-o,u,n,u],["C",n+o,u,l,r-a,l,r],["C",l,r+a,n+o,c,n,c],["C",n-o,c,s,r+a,s,r],["Z"]]}function uR(t,e){void 0===e&&(e=t.getLocalTransform());var n=[];switch(t.nodeName){case $S.LINE:var r=t.parsedStyle,i=r.x1,o=void 0===i?0:i,a=r.y1,s=void 0===a?0:a,c=r.x2,h=void 0===c?0:c,d=r.y2;n=function(t,e,n,r){return[["M",t,e],["L",n,r]]}(o,s,h,void 0===d?0:d);break;case $S.CIRCLE:var f=t.parsedStyle,p=f.r,g=void 0===p?0:p,v=f.cx,m=void 0===v?0:v,y=f.cy;n=lR(g,g,m,void 0===y?0:y);break;case $S.ELLIPSE:var E=t.parsedStyle,_=E.rx,b=void 0===_?0:_,x=E.ry,S=void 0===x?0:x,M=E.cx,A=(m=void 0===M?0:M,E.cy);n=lR(b,S,m,void 0===A?0:A);break;case $S.POLYLINE:case $S.POLYGON:n=function(t,e){var n=t.map((function(t,e){return[0===e?"M":"L",t[0],t[1]]}));return e&&n.push(["Z"]),n}(t.parsedStyle.points.points,t.nodeName===$S.POLYGON);break;case $S.RECT:var R=t.parsedStyle,T=R.width,w=void 0===T?0:T,P=R.height,N=void 0===P?0:P,C=R.x,I=void 0===C?0:C,L=R.y,D=void 0===L?0:L,B=R.radius,k=B&&B.some((function(t){return 0!==t}));n=function(t,e,n,r,i){if(i){var o=l(i,4),a=o[0],s=o[1],u=o[2],c=o[3],h=t>0?1:-1,d=e>0?1:-1,f=h+d!==0?1:0;return[["M",h*a+n,r],["L",t-h*s+n,r],s?["A",s,s,0,0,f,t+n,d*s+r]:null,["L",t+n,e-d*u+r],u?["A",u,u,0,0,f,t+n-h*u,e+r]:null,["L",n+h*c,e+r],c?["A",c,c,0,0,f,n,e+r-d*c]:null,["L",n,d*a+r],a?["A",a,a,0,0,f,h*a+n,r]:null,["Z"]].filter((function(t){return t}))}return[["M",n,r],["L",n+t,r],["L",n+t,r+e],["L",n,r+e],["Z"]]}(w,N,I,D,k&&B.map((function(t){return O(t,0,Math.min(Math.abs(w)/2,Math.abs(N)/2))})));break;case $S.PATH:n=u([],l(t.parsedStyle.d.absolutePath),!1)}if(n.length)return function(t,e,n){return t.reduce((function(t,e){var r="";if("M"===e[0]||"L"===e[0]){var i=$t(e[1],e[2],0);n&&oe(i,i,n),r="".concat(e[0]).concat(i[0],",").concat(i[1])}else if("Z"===e[0])r=e[0];else if("C"===e[0]){var o=$t(e[1],e[2],0),a=$t(e[3],e[4],0),s=$t(e[5],e[6],0);n&&(oe(o,o,n),oe(a,a,n),oe(s,s,n)),r="".concat(e[0]).concat(o[0],",").concat(o[1],",").concat(a[0],",").concat(a[1],",").concat(s[0],",").concat(s[1])}else if("A"===e[0]){var l=$t(e[6],e[7],0);n&&oe(l,l,n),r="".concat(e[0]).concat(e[1],",").concat(e[2],",").concat(e[3],",").concat(e[4],",").concat(e[5],",").concat(l[0],",").concat(l[1])}else"Q"===e[0]&&(o=$t(e[1],e[2],0),a=$t(e[3],e[4],0),n&&(oe(o,o,n),oe(a,a,n)),r="".concat(e[0]).concat(e[1],",").concat(e[2],",").concat(e[3],",").concat(e[4],"}"));return t+r}),"")}(n,0,e)}var cR=function(t){if(""===t||Array.isArray(t)&&0===t.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var e;try{e=ke(t)}catch(n){e=ke(""),console.error("[g]: Invalid SVG Path definition: ".concat(t))}!function(t){for(var e=0;e<t.length;e++){var n=t[e-1],r=t[e];if("M"===r[0]&&n){var i=n[0],o=[r[1],r[2]],a=void 0;"L"===i||"M"===i?a=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(a=[n[n.length-2],n[n.length-1]]),a&&QA(o,a)&&(t.splice(e,1),e--)}}}(e);var n=function(t){for(var e=!1,n=t.length,r=0;r<n;r++){var i=t[r][0];if("C"===i||"A"===i||"Q"===i){e=!0;break}}return e}(e),r=function(t){for(var e=[],n=[],r=[],i=0;i<t.length;i++){var o=t[i],a=o[0];"M"===a?(r.length&&(n.push(r),r=[]),r.push([o[1],o[2]])):"Z"===a?r.length&&(e.push(r),r=[]):r.push([o[1],o[2]])}return r.length>0&&n.push(r),{polygons:e,polylines:n}}(e),i=r.polygons,o=r.polylines,a=function(t){for(var e=[],n=null,r=null,i=null,o=0,a=t.length,s=0;s<a;s++){var l=t[s];r=t[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],o=s;break;case"A":var h=sR(n,l);c.arcParams=h}if("Z"===u)n=i,r=t[o+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=t[o],e[o]&&(e[o].prePoint=n)),c.currentPoint=n,e[o]&&QA(n,e[o].currentPoint)&&(e[o].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var p=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]];else if("Q"===u){var g=[l[1],l[2]];c.startTangent=[p[0]-g[0],p[1]-g[1]],c.endTangent=[n[0]-g[0],n[1]-g[1]]}else if("T"===u)g=tR((y=e[s-1]).currentPoint,p),"Q"===y.command?(c.command="Q",c.startTangent=[p[0]-g[0],p[1]-g[1]],c.endTangent=[n[0]-g[0],n[1]-g[1]]):(c.command="TL",c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]]);else if("C"===u){var v=[l[1],l[2]],m=[l[3],l[4]];c.startTangent=[p[0]-v[0],p[1]-v[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[v[0]-m[0],v[1]-m[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[m[0]-v[0],m[1]-v[1]])}else if("S"===u){var y;v=tR((y=e[s-1]).currentPoint,p),m=[l[1],l[2]],"C"===y.command?(c.command="C",c.startTangent=[p[0]-v[0],p[1]-v[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="SQ",c.startTangent=[p[0]-m[0],p[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]])}else if("A"===u){var E=rR(c,0),_=E.x,b=E.y,x=rR(c,1,!1),S=x.x,M=x.y;c.startTangent=[_,b],c.endTangent=[S,M]}e.push(c)}return e}(e),s=function(t,e){for(var n=[],r=[],i=[],o=0;o<t.length;o++){var a=(g=t[o]).currentPoint,s=g.params,l=g.prePoint,u=void 0;switch(g.command){case"Q":u=XS(l[0],l[1],s[1],s[2],s[3],s[4]);break;case"C":u=zS(l[0],l[1],s[1],s[2],s[3],s[4],s[5],s[6]);break;case"A":var c=g.arcParams;u=IS(c.cx,c.cy,c.rx,c.ry,c.xRotation,c.startAngle,c.endAngle);break;default:n.push(a[0]),r.push(a[1])}u&&(g.box=u,n.push(u.x,u.x+u.width),r.push(u.y,u.y+u.height))}n=n.filter((function(t){return!Number.isNaN(t)&&t!==1/0&&t!==-1/0})),r=r.filter((function(t){return!Number.isNaN(t)&&t!==1/0&&t!==-1/0}));var h=P(n),d=P(r),f=w(n),p=w(r);if(0===i.length)return{x:h,y:d,width:f-h,height:p-d};for(o=0;o<i.length;o++){var g;(a=(g=i[o]).currentPoint)[0]===h?h-=JA(g,e).xExtra:a[0]===f&&(f+=JA(g,e).xExtra),a[1]===d?d-=JA(g,e).yExtra:a[1]===p&&(p+=JA(g,e).yExtra)}return{x:h,y:d,width:f-h,height:p-d}}(a,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:e,hasArc:n,segments:a,polygons:i,polylines:o,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},hR=BM(cR);function dR(t){return N(t)?hR(t):cR(t)}function fR(t,e,n){var r=t.curve,i=e.curve;r&&0!==r.length||(r=We(t.absolutePath,!1),t.curve=r),i&&0!==i.length||(i=We(e.absolutePath,!1),e.curve=i);var o=[r,i];r.length!==i.length&&(o=rn(r,i));var a,s,l=en(o[0])!==en(o[1])?(a=o[0],s=a.slice(1).map((function(t,e,n){return e?n[e-1].slice(-2).concat(t.slice(1)):a[0].slice(1).concat(t.slice(1))})).map((function(t){return t.map((function(e,n){return t[t.length-n-2*(1-n%2)]}))})).reverse(),[["M"].concat(s[0].slice(0,2))].concat(s.map((function(t){return["C"].concat(t.slice(2))})))):o[0].map((function(t){return Array.isArray(t)?[].concat(t):t}));return[l,tn(o[1],l),function(t){return t}]}function pR(t,e){var n;return n=N(t)?t.split(" ").map((function(t){var e=l(t.split(","),2),n=e[0],r=e[1];return[Number(n),Number(r)]})):t,{points:n,totalLength:0,segments:[]}}function gR(t,e){return[t.points,e.points,function(t){return t}]}var vR=null;function mR(t){return function(e){var n=0;return t.map((function(t){return t===vR?e[n++]:t}))}}function yR(t){return t}var ER={matrix:["NNNNNN",[vR,vR,0,0,vR,vR,0,0,0,0,1,0,vR,vR,0,1],yR],matrix3d:["NNNNNNNNNNNNNNNN",yR],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",mR([vR,vR,new tA(1)]),yR],scalex:["N",mR([vR,new tA(1),new tA(1)]),mR([vR,new tA(1)])],scaley:["N",mR([new tA(1),vR,new tA(1)]),mR([new tA(1),vR])],scalez:["N",mR([new tA(1),new tA(1),vR])],scale3d:["NNN",yR],skew:["Aa",null,yR],skewx:["A",null,mR([vR,iA])],skewy:["A",null,mR([iA,vR])],translate:["Tt",mR([vR,vR,eA]),yR],translatex:["T",mR([vR,eA,eA]),mR([vR,eA])],translatey:["T",mR([eA,vR,eA]),mR([eA,vR])],translatez:["L",mR([eA,eA,vR])],translate3d:["TTL",yR]};function _R(t){if("none"===(t=(t||"none").toLowerCase().trim()))return[];for(var e,n=/\s*(\w+)\(([^)]*)\)/g,r=[],i=0;e=n.exec(t);){if(e.index!==i)return[];i=e.index+e[0].length;var o=e[1],a=ER[o];if(!a)return[];var s=e[2].split(","),l=a[0];if(l.length<s.length)return[];for(var u=[],c=0;c<l.length;c++){var h=s[c],d=l[c],f=void 0;if(void 0===(f=h?{A:function(t){return"0"===t.trim()?iA:kA(t)},N:YA,T:DA,L:IA}[d.toUpperCase()](h):{a:iA,n:u[0],t:eA}[d]))return[];u.push(f)}if(r.push({t:o,d:u}),n.lastIndex===t.length)return r}return[]}function bR(t){if("none"===(t=(t||"none").toLowerCase().trim()))return[];for(var e,n=/\s*(\w+)\(([^)]*)\)/g,r=[],i=0;e=n.exec(t);){if(e.index!==i)return[];i=e.index+e[0].length;var o=e[1],a=ER[o];if(!a)return[];var s=e[2].split(","),l=a[0];if(l.length<s.length)return[];for(var u=[],c=0;c<l.length;c++){var h=s[c],d=l[c],f=void 0;if(void 0===(f=h?{A:function(t){return"0"===t.trim()?iA:BA(t)},N:XA,T:LA,L:OA}[d.toUpperCase()](h):{a:iA,n:u[0],t:eA}[d]))return[];u.push(f)}if(r.push({t:o,d:u}),n.lastIndex===t.length)return r}return[]}function xR(t){var e,n,r,i;switch(t.t){case"rotatex":return i=aM(UA(t.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotatey":return i=aM(UA(t.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotatez":return i=aM(UA(t.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":e=t.d[0].value,n=t.d[1].value,r=t.d[2].value,i=aM(UA(t.d[3]));var o=e*e+n*n+r*r;if(0===o)e=1,n=0,r=0;else if(1!==o){var a=Math.sqrt(o);e/=a,n/=a,r/=a}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(e*n*u+r*l),2*(e*r*u-n*l),0,2*(e*n*u-r*l),1-2*(e*e+r*r)*u,2*(n*r*u+e*l),0,2*(e*r*u+n*l),2*(n*r*u-e*l),1-2*(e*e+n*n)*u,0,0,0,0,1];case"scale":return[t.d[0].value,0,0,0,0,t.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scalex":return[t.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,t.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,t.d[0].value,0,0,0,0,1];case"scale3d":return[t.d[0].value,0,0,0,0,t.d[1].value,0,0,0,0,t.d[2].value,0,0,0,0,1];case"skew":var c=aM(UA(t.d[0])),h=aM(UA(t.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewx":return i=aM(UA(t.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewy":return i=aM(UA(t.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,e=VA(t.d[0],0,null)||0,n=VA(t.d[1],0,null)||0,0,1];case"translatex":return[1,0,0,0,0,1,0,0,0,0,1,0,e=VA(t.d[0],0,null)||0,0,0,1];case"translatey":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=VA(t.d[0],0,null)||0,0,1];case"translatez":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=VA(t.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,e=VA(t.d[0],0,null)||0,n=VA(t.d[1],0,null)||0,r=VA(t.d[2],0,null)||0,1];case"perspective":var d=VA(t.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[t.d[0].value,t.d[1].value,0,0,t.d[2].value,t.d[3].value,0,0,0,0,1,0,t.d[4].value,t.d[5].value,0,1];case"matrix3d":return t.d.map((function(t){return t.value}))}}function SR(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15]]}function MR(t){var e=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],o=[0,0,0,1];return function(t,e,n,r,i,o){if(!function(t,e){var n=e[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)t[i]=e[i]*r;return!0}(hM,t))return!1;if(dt(dM,hM),dM[3]=0,dM[7]=0,dM[11]=0,dM[15]=1,Math.abs(yt(dM))<1e-8)return!1;var a,s,l=hM[3],u=hM[7],c=hM[11],h=hM[12],d=hM[13],f=hM[14],p=hM[15];if(0!==l||0!==u||0!==c){if(fM[0]=l,fM[1]=u,fM[2]=c,fM[3]=p,!mt(dM,dM))return!1;vt(dM,dM),he(i,fM,dM)}else i[0]=i[1]=i[2]=0,i[3]=1;if(e[0]=h,e[1]=d,e[2]=f,s=hM,(a=pM)[0][0]=s[0],a[0][1]=s[1],a[0][2]=s[2],a[1][0]=s[4],a[1][1]=s[5],a[1][2]=s[6],a[2][0]=s[8],a[2][1]=s[9],a[2][2]=s[10],n[0]=Kt(pM[0]),ee(pM[0],pM[0]),r[0]=ne(pM[0],pM[1]),vM(pM[1],pM[1],pM[0],1,-r[0]),n[1]=Kt(pM[1]),ee(pM[1],pM[1]),r[0]/=n[1],r[1]=ne(pM[0],pM[2]),vM(pM[2],pM[2],pM[0],1,-r[1]),r[2]=ne(pM[1],pM[2]),vM(pM[2],pM[2],pM[1],1,-r[2]),n[2]=Kt(pM[2]),ee(pM[2],pM[2]),r[1]/=n[2],r[2]/=n[2],re(gM,pM[1],pM[2]),ne(pM[0],gM)<0)for(var g=0;g<3;g++)n[g]*=-1,pM[g][0]*=-1,pM[g][1]*=-1,pM[g][2]*=-1;o[0]=.5*Math.sqrt(Math.max(1+pM[0][0]-pM[1][1]-pM[2][2],0)),o[1]=.5*Math.sqrt(Math.max(1-pM[0][0]+pM[1][1]-pM[2][2],0)),o[2]=.5*Math.sqrt(Math.max(1-pM[0][0]-pM[1][1]+pM[2][2],0)),o[3]=.5*Math.sqrt(Math.max(1+pM[0][0]+pM[1][1]+pM[2][2],0)),pM[2][1]>pM[1][2]&&(o[0]=-o[0]),pM[0][2]>pM[2][0]&&(o[1]=-o[1]),pM[1][0]>pM[0][1]&&(o[2]=-o[2])}(function(t){return 0===t.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:t.map(xR).reduce(SR)}(t),e,n,r,i,o),[[e,n,r,o,i]]}var AR=function(){function t(t,e){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var o=0;o<4;o++)n[r][i]+=e[r][o]*t[o][i];return n}return function(e,n,r,i,o){for(var a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)a[s][3]=o[s];for(s=0;s<3;s++)for(var l=0;l<3;l++)a[3][s]+=e[l]*a[l][s];var u=i[0],c=i[1],h=i[2],d=i[3],f=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];f[0][0]=1-2*(c*c+h*h),f[0][1]=2*(u*c-h*d),f[0][2]=2*(u*h+c*d),f[1][0]=2*(u*c+h*d),f[1][1]=1-2*(u*u+h*h),f[1][2]=2*(c*h-u*d),f[2][0]=2*(u*h-c*d),f[2][1]=2*(c*h+u*d),f[2][2]=1-2*(u*u+c*c),a=t(a,f);var p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(r[2]&&(p[2][1]=r[2],a=t(a,p)),r[1]&&(p[2][1]=0,p[2][0]=r[0],a=t(a,p)),r[0]&&(p[2][0]=0,p[1][0]=r[0],a=t(a,p)),s=0;s<3;s++)for(l=0;l<3;l++)a[s][l]*=n[s];return function(t){return 0==t[0][2]&&0==t[0][3]&&0==t[1][2]&&0==t[1][3]&&0==t[2][0]&&0==t[2][1]&&1==t[2][2]&&0==t[2][3]&&0==t[3][2]&&1==t[3][3]}(a)?[a[0][0],a[0][1],a[1][0],a[1][1],a[3][0],a[3][1]]:a[0].concat(a[1],a[2],a[3])}}();function RR(t){return t.toFixed(6).replace(".000000","")}function TR(t,e){var n,r;return t.decompositionPair!==e&&(t.decompositionPair=e,n=MR(t)),e.decompositionPair!==t&&(e.decompositionPair=t,r=MR(e)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?e[0].d:t[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(t){var e=function(t,e,n){var r=function(t,e){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[r];return n}(t,e);r=O(r,-1,1);var i=[];if(1===r)i=t;else for(var o=Math.acos(r),a=1*Math.sin(n*o)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(t[s]*(Math.cos(n*o)-r*a)+e[s]*a);return i}(n[0][3],r[0][3],t[5]);return AR(t[0],t[1],t[2],e,t[4]).map(RR).join(",")}])}function wR(t){return t.replace(/[xy]/,"")}function PR(t){return t.replace(/(x|y|z|3d)?$/,"3d")}function NR(t,e,n){var r=!1;if(!t.length||!e.length){t.length||(r=!0,t=e,e=[]);for(var i=function(n){var r=t[n],i=r.t,o=r.d,a="scale"===i.substring(0,5)?1:0;e.push({t:i,d:o.map((function(t){return"number"==typeof t?pA(a):pA(a,t.unit)}))})},o=0;o<t.length;o++)i(o)}var a,s,l=[],u=[],c=[];if(t.length!==e.length)l=[(y=TR(t,e))[0]],u=[y[1]],c=[["matrix",[y[2]]]];else for(o=0;o<t.length;o++){var h=t[o].t,d=e[o].t,f=t[o].d,p=e[o].d,g=ER[h],v=ER[d],m=void 0;if(s=d,"perspective"===(a=h)&&"perspective"===s||!("matrix"!==a&&"matrix3d"!==a||"matrix"!==s&&"matrix3d"!==s)){var y=TR([t[o]],[e[o]]);l.push(y[0]),u.push(y[1]),c.push(["matrix",[y[2]]])}else{if(h===d)m=h;else if(g[2]&&v[2]&&wR(h)===wR(d))m=wR(h),f=g[2](f),p=v[2](p);else{if(!g[1]||!v[1]||PR(h)!==PR(d)){l=[(y=TR(t,e))[0]],u=[y[1]],c=[["matrix",[y[2]]]];break}m=PR(h),f=g[1](f),p=v[1](p)}for(var E=[],_=[],b=[],x=0;x<f.length;x++){y=FA(f[x],p[x],n,0,x);E[x]=y[0],_[x]=y[1],b.push(y[2])}l.push(E),u.push(_),c.push([m,b])}}if(r){var S=l;l=u,u=S}return[l,u,function(t){return t.map((function(t,e){var n=t.map((function(t,n){return c[e][1][n](t)})).join(",");return"matrix"===c[e][0]&&16===n.split(",").length&&(c[e][0]="matrix3d"),"matrix3d"===c[e][0]&&6===n.split(",").length&&(c[e][0]="matrix"),c[e][0]+"("+n+")"})).join(" ")}]}var CR=BM((function(t){if(N(t)){if("text-anchor"===t)return[pA(0,"px"),pA(0,"px")];var e=t.split(" ");return 1===e.length&&("top"===e[0]||"bottom"===e[0]?(e[1]=e[0],e[0]="center"):e[1]="center"),2!==e.length?null:[DA(IR(e[0])),DA(IR(e[1]))]}return[pA(t[0]||0,"px"),pA(t[1]||0,"px")]})),OR=function(t){if(N(t)){if("text-anchor"===t)return[pA(0,"px"),pA(0,"px")];var e=t.split(" ");return 1===e.length&&("top"===e[0]||"bottom"===e[0]?(e[1]=e[0],e[0]="center"):e[1]="center"),2!==e.length?null:[LA(IR(e[0])),LA(IR(e[1]))]}return[pA(t[0]||0,"px"),pA(t[1]||0,"px")]};function IR(t){return"center"===t?"50%":"left"===t||"top"===t?"0%":"right"===t||"bottom"===t?"100%":t}var LR=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:gA.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:gA.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:gA.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:gA.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:gA.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:gA.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:gA.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:gA.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:gA.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:gA.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:gA.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:gA.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:gA.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:gA.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:gA.FILTER},{n:"clipPath",syntax:gA.DEFINED_PATH},{n:"textPath",syntax:gA.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:gA.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:gA.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:gA.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:gA.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:gA.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:gA.COORDINATE},{n:"y1",int:!0,l:!0,syntax:gA.COORDINATE},{n:"z1",int:!0,l:!0,syntax:gA.COORDINATE},{n:"x2",int:!0,l:!0,syntax:gA.COORDINATE},{n:"y2",int:!0,l:!0,syntax:gA.COORDINATE},{n:"z2",int:!0,l:!0,syntax:gA.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:gA.PATH,p:50},{n:"points",int:!0,l:!0,syntax:gA.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:gA.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:gA.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:gA.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:gA.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:gA.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:gA.NUMBER,d:function(t){return t===$S.PATH||t===$S.POLYGON||t===$S.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:gA.MARKER},{n:"markerEnd",syntax:gA.MARKER},{n:"markerMid",syntax:gA.MARKER},{n:"markerStartOffset",syntax:gA.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:gA.LENGTH,l:!0,int:!0,d:"0"}],DR=LR.filter((function(t){return!!t.l})).map((function(t){return t.n})),BR={},kR=new WeakMap,FR=function(){function t(t){var e=this;this.runtime=t,LR.forEach((function(t){e.registerMetadata(t)}))}return t.prototype.registerMetadata=function(t){u([t.n],l(t.a||[]),!1).forEach((function(e){BR[e]=t}))},t.prototype.unregisterMetadata=function(t){delete BR[t]},t.prototype.getPropertySyntax=function(t){return this.runtime.CSSPropertySyntaxFactory[t]},t.prototype.processProperties=function(t,e,n){var i=this;if(void 0===n&&(n={skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0}),this.runtime.enableCSSParsing){var o=n.skipUpdateAttribute,a=n.skipParse,s=n.forceUpdateGeometry,l=n.usedAttributes,u=n.memoize,c=s,h=Object.keys(e);h.forEach((function(n){var r;o||(t.attributes[n]=e[n]),!c&&(null===(r=BR[n])||void 0===r?void 0:r.l)&&(c=!0)})),a||h.forEach((function(e){t.computedStyle[e]=i.parseProperty(e,t.attributes[e],t,u)})),(null==l?void 0:l.length)&&(h=Array.from(new Set(h.concat(l)))),h.forEach((function(e){e in t.computedStyle&&(t.parsedStyle[e]=i.computeProperty(e,t.computedStyle[e],t,u))})),c&&(t.geometry.dirty=!0,t.renderable.boundsDirty=!0,t.renderable.renderBoundsDirty=!0,n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtifyToRoot(t)),h.forEach((function(e){e in t.parsedStyle&&i.postProcessProperty(e,t,h)})),this.runtime.enableCSSParsing&&t.children.length&&h.forEach((function(e){e in t.parsedStyle&&i.isPropertyInheritable(e)&&t.children.forEach((function(t){t.internalSetAttribute(e,null,{skipUpdateAttribute:!0,skipParse:!0})}))}))}else{Object.assign(t.attributes,e);var d=Object.keys(e),f=t.parsedStyle.clipPath,p=t.parsedStyle.offsetPath;t.parsedStyle=Object.assign(t.parsedStyle,e);var g=!!n.forceUpdateGeometry;if(!g)for(var v=0;v<DR.length;v++)if(DR[v]in e){g=!0;break}e.fill&&(t.parsedStyle.fill=PA(e.fill)),e.stroke&&(t.parsedStyle.stroke=PA(e.stroke)),e.shadowColor&&(t.parsedStyle.shadowColor=PA(e.shadowColor)),e.filter&&(t.parsedStyle.filter=jA(e.filter)),_(e.radius)||(t.parsedStyle.radius=GA(e.radius,4)),_(e.lineDash)||(t.parsedStyle.lineDash=GA(e.lineDash,2)),e.points&&(t.parsedStyle.points=pR(e.points)),""===e.d&&(t.parsedStyle.d=r({},vA)),e.d&&(t.parsedStyle.d=dR(e.d)),e.textTransform&&this.runtime.CSSPropertySyntaxFactory["<text-transform>"].calculator(null,null,{value:e.textTransform},t,null),H(e.clipPath)||this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("clipPath",f,e.clipPath,t,this.runtime),e.offsetPath&&this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("offsetPath",p,e.offsetPath,t,this.runtime),e.transform&&(t.parsedStyle.transform=_R(e.transform)),e.transformOrigin&&(t.parsedStyle.transformOrigin=CR(e.transformOrigin)),e.markerStart&&(t.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,e.markerStart,e.markerStart,null,null)),e.markerEnd&&(t.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,e.markerEnd,e.markerEnd,null,null)),e.markerMid&&(t.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator("",e.markerMid,e.markerMid,null,null)),_(e.zIndex)||this.runtime.CSSPropertySyntaxFactory["<z-index>"].postProcessor(t,d),_(e.offsetDistance)||this.runtime.CSSPropertySyntaxFactory["<offset-distance>"].postProcessor(t,d),e.transform&&this.runtime.CSSPropertySyntaxFactory["<transform>"].postProcessor(t,d),e.transformOrigin&&this.runtime.CSSPropertySyntaxFactory["<transform-origin>"].postProcessor(t,d),g&&(t.geometry.dirty=!0,t.renderable.boundsDirty=!0,t.renderable.renderBoundsDirty=!0,n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtifyToRoot(t))}},t.prototype.parseProperty=function(t,e,n,r){var i=BR[t],o=e;if((""===e||_(e))&&(e="unset"),"unset"===e||"initial"===e||"inherit"===e)o=cA(e);else if(i){var a=i.k,s=i.syntax,l=s&&this.getPropertySyntax(s);a&&a.indexOf(e)>-1?o=cA(e):l&&(!r&&l.parserUnmemoize?o=l.parserUnmemoize(e,n):l.parser&&(o=l.parser(e,n)))}return o},t.prototype.computeProperty=function(t,e,n,r){var i=BR[t],o="g-root"===n.id,a=e;if(i){var s=i.syntax,l=i.inh,u=i.d;if(e instanceof XM){var c=e.value;if("unset"===c&&(c=l&&!o?"inherit":"initial"),"initial"===c)_(u)||(e=this.parseProperty(t,$M(u)?u(n.nodeName):u,n,r));else if("inherit"===c){var h=this.tryToResolveProperty(n,t,{inherited:!0});return _(h)?void this.addUnresolveProperty(n,t):h}}var d=s&&this.getPropertySyntax(s);if(d&&d.calculator){var f=n.parsedStyle[t];a=d.calculator(t,f,e,n,this.runtime)}else a=e instanceof XM?e.value:e}return a},t.prototype.postProcessProperty=function(t,e,n){var r=BR[t];if(r&&r.syntax){var i=r.syntax&&this.getPropertySyntax(r.syntax);i&&i.postProcessor&&i.postProcessor(e,n)}},t.prototype.addUnresolveProperty=function(t,e){var n=kR.get(t);n||(kR.set(t,[]),n=kR.get(t)),-1===n.indexOf(e)&&n.push(e)},t.prototype.tryToResolveProperty=function(t,e,n){if(void 0===n&&(n={}),n.inherited&&t.parentElement&&function(t,e){var n=kR.get(t);return!n||0===n.length||n.includes(e)}(t.parentElement,e)){var r=t.parentElement.parsedStyle[e];if("unset"===r||"initial"===r||"inherit"===r)return;return r}},t.prototype.recalc=function(t){var e=kR.get(t);if(e&&e.length){var n={};e.forEach((function(e){n[e]=t.attributes[e]})),this.processProperties(t,n),kR.delete(t)}},t.prototype.updateGeometry=function(t){var e=t.nodeName,n=this.runtime.geometryUpdaterFactory[e];if(n){var r=t.geometry;r.contentBounds||(r.contentBounds=new yM),r.renderBounds||(r.renderBounds=new yM);var i=t.parsedStyle,o=n.update(i,t),a=o.cx,s=void 0===a?0:a,l=o.cy,u=void 0===l?0:l,c=o.cz,h=void 0===c?0:c,d=o.hwidth,f=void 0===d?0:d,p=o.hheight,g=void 0===p?0:p,v=o.hdepth,m=void 0===v?0:v,y=[Math.abs(f),Math.abs(g),m],E=i,_=E.stroke,b=E.lineWidth,x=void 0===b?1:b,S=E.increasedLineWidthForHitTesting,M=void 0===S?0:S,A=E.shadowType,R=void 0===A?"outer":A,T=E.shadowColor,w=E.filter,P=void 0===w?[]:w,N=E.transformOrigin,C=[s,u,h];r.contentBounds.update(C,y);var O=e===$S.POLYLINE||e===$S.POLYGON||e===$S.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((x||0)+(M||0))*O;y[0]+=I,y[1]+=I}if(r.renderBounds.update(C,y),T&&R&&"inner"!==R){var L=r.renderBounds,D=L.min,B=L.max,k=i,F=k.shadowBlur||0,U=k.shadowOffsetX||0,G=k.shadowOffsetY||0,z=D[0]-F+U,V=B[0]+F+U,W=D[1]-F+G,j=B[1]+F+G;D[0]=Math.min(D[0],z),B[0]=Math.max(B[0],V),D[1]=Math.min(D[1],W),B[1]=Math.max(B[1],j),r.renderBounds.setMinMax(D,B)}P.forEach((function(t){var e=t.name,n=t.params;if("blur"===e){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,nM(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===e){var o=n[0].value,a=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+o,d=c[0]+s+o,f=u[1]-s+a,p=c[1]+s+a;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],f),c[1]=Math.max(c[1],p),r.renderBounds.setMinMax(u,c)}})),t.geometry.dirty=!1;var H=g<0,X=(f<0?-1:1)*(N?VA(N[0],0,t,!0):0),Y=(H?-1:1)*(N?VA(N[1],1,t,!0):0);(X||Y)&&t.setOrigin(X,Y)}},t.prototype.updateSizeAttenuation=function(t,e){t.style.isSizeAttenuation?(t.style.rawLineWidth||(t.style.rawLineWidth=t.style.lineWidth),t.style.lineWidth=(t.style.rawLineWidth||1)/e,t.nodeName===$S.CIRCLE&&(t.style.rawR||(t.style.rawR=t.style.r),t.style.r=(t.style.rawR||1)/e)):(t.style.rawLineWidth&&(t.style.lineWidth=t.style.rawLineWidth,delete t.style.rawLineWidth),t.nodeName===$S.CIRCLE&&t.style.rawR&&(t.style.r=t.style.rawR,delete t.style.rawR))},t.prototype.isPropertyInheritable=function(t){var e=BR[t];return!!e&&e.inh},t}(),UR=function(){function t(){this.parser=kA,this.parserUnmemoize=BA,this.parserWithCSSDisabled=null,this.mixer=KA}return t.prototype.calculator=function(t,e,n,r){return UA(n)},t}(),GR=function(){function t(){}return t.prototype.calculator=function(t,e,n,r,i){return n instanceof XM&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(t,e,n,r),"clipPath"===t&&r.forEach((function(t){0===t.childNodes.length&&i.sceneGraphService.dirtifyToRoot(t)})),n},t}(),zR=function(){function t(){this.parser=PA,this.parserWithCSSDisabled=PA,this.mixer=NA}return t.prototype.calculator=function(t,e,n,r){return n instanceof XM?"none"===n.value?hA:dA:n},t}(),VR=function(){function t(){this.parser=jA}return t.prototype.calculator=function(t,e,n){return n instanceof XM?[]:n},t}();function WR(t){var e=t.parsedStyle.fontSize;return _(e)?null:e}var jR=function(){function t(){this.parser=DA,this.parserUnmemoize=LA,this.parserWithCSSDisabled=null,this.mixer=KA}return t.prototype.calculator=function(t,e,n,r,i){var o;if(I(n))return n;if(!tA.isRelativeUnit(n.unit))return n.value;var a=i.styleValueRegistry;if(n.unit===wM.kPercentage)return 0;if(n.unit===wM.kEms){if(r.parentNode){if(s=WR(r.parentNode))return s*=n.value;a.addUnresolveProperty(r,t)}else a.addUnresolveProperty(r,t);return 0}if(n.unit===wM.kRems){if(null===(o=null==r?void 0:r.ownerDocument)||void 0===o?void 0:o.documentElement){var s;if(s=WR(r.ownerDocument.documentElement))return s*=n.value;a.addUnresolveProperty(r,t)}else a.addUnresolveProperty(r,t);return 0}},t}(),HR=function(){function t(){this.mixer=qA}return t.prototype.parser=function(t){var e=zA(I(t)?[t]:t);return 1===e.length?[e[0],e[0]]:[e[0],e[1]]},t.prototype.calculator=function(t,e,n){return n.map((function(t){return t.value}))},t}(),XR=function(){function t(){this.mixer=qA}return t.prototype.parser=function(t){var e=zA(I(t)?[t]:t);return 1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:[e[0],e[1],e[2],e[3]]},t.prototype.calculator=function(t,e,n){return n.map((function(t){return t.value}))},t}(),YR=function(){function t(){}return t.prototype.calculator=function(t,e,n,r){n instanceof XM&&(n=null);var i=null==n?void 0:n.cloneNode(!0);return i&&(i.style.isMarker=!0),i},t}(),KR=function(){function t(){this.mixer=KA,this.parser=YA,this.parserUnmemoize=XA,this.parserWithCSSDisabled=null}return t.prototype.calculator=function(t,e,n){return n.value},t}(),$R=function(){function t(){this.parser=YA,this.parserUnmemoize=XA,this.parserWithCSSDisabled=null,this.mixer=$A(0,1)}return t.prototype.calculator=function(t,e,n){return n.value},t.prototype.postProcessor=function(t){var e=t.parsedStyle,n=e.offsetPath,r=e.offsetDistance;if(n){var i=n.nodeName;if(i===$S.LINE||i===$S.PATH||i===$S.POLYLINE){var o=n.getPoint(r);o&&t.setLocalPosition(o.x,o.y)}}},t}(),qR=function(){function t(){this.parser=YA,this.parserUnmemoize=XA,this.parserWithCSSDisabled=null,this.mixer=$A(0,1)}return t.prototype.calculator=function(t,e,n){return n.value},t}(),ZR=function(){function t(){this.parser=dR,this.parserWithCSSDisabled=dR,this.mixer=fR}return t.prototype.calculator=function(t,e,n){return n instanceof XM&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new AM(0,0,0,0)}:n},t}(),QR=function(){this.parser=pR,this.mixer=gR},JR=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.mixer=$A(0,1/0),e}return n(e,t),e}(jR),tT=function(){function t(){}return t.prototype.calculator=function(t,e,n,r){return n instanceof XM?"unset"===n.value?"":n.value:"".concat(n)},t.prototype.postProcessor=function(t){t.nodeValue="".concat(t.parsedStyle.text)||""},t}(),eT=function(){function t(){}return t.prototype.calculator=function(t,e,n,r){var i=r.getAttribute("text");if(i){var o=i;"capitalize"===n.value?o=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?o=i.toLowerCase():"uppercase"===n.value&&(o=i.toUpperCase()),r.parsedStyle.text=o}return n.value},t}(),nT={},rT=0;var iT="undefined"!=typeof window&&void 0!==window.document;function oT(t){return!!t.getAttribute}function aT(t,e){var n=Number(t.parsedStyle.zIndex||0),r=Number(e.parsedStyle.zIndex||0);if(n===r){var i=t.parentNode;if(i){var o=i.childNodes||[];return o.indexOf(t)-o.indexOf(e)}}return n-r}function sT(t){var e,n=t;do{if(null===(e=n.parsedStyle)||void 0===e?void 0:e.clipPath)return n;n=n.parentElement}while(null!==n);return null}function lT(t,e,n){iT&&t.style&&(t.style.width=e+"px",t.style.height=n+"px")}function uT(t,e){if(iT)return document.defaultView.getComputedStyle(t,null).getPropertyValue(e)}var cT={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},hT="object"==typeof performance&&performance.now?performance:Date;function dT(t,e,n){void 0===t&&(t="auto");var r=!1,i=!1,o=!!e&&!e.isNone,a=!!n&&!n.isNone;return"visiblepainted"===t||"painted"===t||"auto"===t?(r=o,i=a):"visiblefill"===t||"fill"===t?r=!0:"visiblestroke"===t||"stroke"===t?i=!0:"visible"!==t&&"all"!==t||(r=!0,i=!0),[r,i]}var fT=1,pT="object"==typeof self&&self.self==self?self:"object"==typeof global&&global.global==global?global:{},gT=Date.now(),vT={},mT=Date.now(),yT=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");var e=Date.now(),n=e-mT,r=n>16?0:16-n,i=fT++;return vT[i]=t,Object.keys(vT).length>1||setTimeout((function(){mT=e;var t=vT;vT={},Object.keys(t).forEach((function(e){return t[e](pT.performance&&"function"==typeof pT.performance.now?pT.performance.now():Date.now()-gT)}))}),r),i},ET=function(t){delete vT[t]},_T=function(t){return"string"!=typeof t?yT:""===t?pT.requestAnimationFrame:pT[t+"RequestAnimationFrame"]},bT=function(t,e){for(var n=0;void 0!==t[n];){if(e(t[n]))return t[n];n+=1}}(["","webkit","moz","ms","o"],(function(t){return!!_T(t)})),xT=_T(bT),ST=function(t){return"string"!=typeof t?ET:""===t?pT.cancelAnimationFrame:pT[t+"CancelAnimationFrame"]||pT[t+"CancelRequestAnimationFrame"]}(bT);pT.requestAnimationFrame=xT,pT.cancelAnimationFrame=ST;var MT=function(){function t(){this.callbacks=[]}return t.prototype.getCallbacksNum=function(){return this.callbacks.length},t.prototype.tapPromise=function(t,e){this.callbacks.push(e)},t.prototype.promise=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.all(this.callbacks.map((function(e){return e.apply(void 0,u([],l(t),!1))})))},t}(),AT=function(){function t(){this.callbacks=[]}return t.prototype.tapPromise=function(t,e){this.callbacks.push(e)},t.prototype.promise=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(this,void 0,void 0,(function(){var e,n,r;return a(this,(function(i){switch(i.label){case 0:return this.callbacks.length?[4,(r=this.callbacks)[0].apply(r,u([],l(t),!1))]:[3,6];case 1:e=i.sent(),n=0,i.label=2;case 2:return n<this.callbacks.length-1?[4,(0,this.callbacks[n])(e)]:[3,5];case 3:e=i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,e];case 6:return[2,null]}}))}))},t}(),RT=function(){function t(){this.callbacks=[]}return t.prototype.tap=function(t,e){this.callbacks.push(e)},t.prototype.call=function(){var t=arguments;this.callbacks.forEach((function(e){e.apply(void 0,t)}))},t}(),TT=function(){function t(){this.callbacks=[]}return t.prototype.tap=function(t,e){this.callbacks.push(e)},t.prototype.call=function(){if(this.callbacks.length){for(var t=arguments,e=this.callbacks[0].apply(void 0,t),n=0;n<this.callbacks.length-1;n++){e=(0,this.callbacks[n])(e)}return e}return null},t}(),wT=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],PT=/([\"\'])[^\'\"]+\1/;function NT(t,e,n){return gt(t),t[4]=Math.tan(e),t[1]=Math.tan(n),t}var CT=1e-5,OT=ct(),IT=ct();function LT(t,e){if(t.length){var n=gt(OT);t.forEach((function(t){var e=t.t,r=t.d;if("scale"===e){var i=(null==r?void 0:r.map((function(t){return Math.max(t.value,CT)})))||[1,1];At(IT,[i[0],i[1],1])}else if("scalex"===e){i=(null==r?void 0:r.map((function(t){return Math.max(t.value,CT)})))||[1];At(IT,[i[0],1,1])}else if("scaley"===e){i=(null==r?void 0:r.map((function(t){return Math.max(t.value,CT)})))||[1];At(IT,[1,i[0],1])}else if("scalez"===e){i=(null==r?void 0:r.map((function(t){return Math.max(t.value,CT)})))||[1];At(IT,[1,1,i[0]])}else if("scale3d"===e){i=(null==r?void 0:r.map((function(t){return Math.max(t.value,CT)})))||[1,1,1];At(IT,[i[0],i[1],i[2]])}else if("translate"===e){Mt(IT,[(o=r||[eA,eA])[0].value,o[1].value,0])}else if("translatex"===e){Mt(IT,[(o=r||[eA])[0].value,0,0])}else if("translatey"===e){Mt(IT,[0,(o=r||[eA])[0].value,0])}else if("translatez"===e){Mt(IT,[0,0,(o=r||[eA])[0].value])}else if("translate3d"===e){var o;Mt(IT,[(o=r||[eA,eA,eA])[0].value,o[1].value,o[2].value])}else if("rotate"===e){Pt(IT,aM(UA((a=r||[iA])[0])))}else if("rotatex"===e){Tt(IT,aM(UA((a=r||[iA])[0])))}else if("rotatey"===e){wt(IT,aM(UA((a=r||[iA])[0])))}else if("rotatez"===e){Pt(IT,aM(UA((a=r||[iA])[0])))}else if("rotate3d"===e){var a;Rt(IT,aM(UA((a=r||[eA,eA,eA,iA])[3])),[a[0].value,a[1].value,a[2].value])}else if("skew"===e){var s=(null==r?void 0:r.map((function(t){return t.value})))||[0,0];NT(IT,aM(s[0]),aM(s[1]))}else if("skewx"===e){s=(null==r?void 0:r.map((function(t){return t.value})))||[0];NT(IT,aM(s[0]),0)}else if("skewy"===e){s=(null==r?void 0:r.map((function(t){return t.value})))||[0];NT(IT,0,aM(s[0]))}else if("matrix"===e){var c=l(r.map((function(t){return t.value})),6),h=c[0],d=c[1],f=c[2],p=c[3],g=c[4],v=c[5];pt(IT,h,d,0,0,f,p,0,0,0,0,1,0,g,v,0,1)}else"matrix3d"===e&&pt.apply(Ht,u([IT],l(r.map((function(t){return t.value}))),!1));Wt(n,n,IT)})),e.setLocalTransform(n)}else e.resetLocalTransform();return e.getLocalTransform()}var DT=function(){function t(){this.parser=_R,this.parserUnmemoize=bR,this.parserWithCSSDisabled=bR,this.mixer=NR}return t.prototype.calculator=function(t,e,n,r){return n instanceof XM?[]:n},t.prototype.postProcessor=function(t){LT(t.parsedStyle.transform,t)},t}(),BT=function(){function t(){this.parser=CR,this.parserUnmemoize=OR}return t.prototype.postProcessor=function(t){var e=t.parsedStyle.transformOrigin;e[0].unit===wM.kPixels&&e[1].unit===wM.kPixels?t.setOrigin(e[0].value,e[1].value):t.getGeometryBounds()},t}(),kT=function(){function t(){this.parser=YA,this.parserUnmemoize=XA}return t.prototype.calculator=function(t,e,n,r){return n.value},t.prototype.postProcessor=function(t){if(t.parentNode){var e=t.parentNode,n=e.renderable,r=e.sortable;n&&(n.dirty=!0),r&&(r.dirty=!0,r.dirtyReason=rA.Z_INDEX_CHANGED)}},t}(),FT=function(){function t(){}return t.prototype.update=function(t,e){var n=t.cx,r=void 0===n?0:n,i=t.cy,o=void 0===i?0:i,a=t.r,s=void 0===a?0:a;return{cx:r,cy:o,hwidth:s,hheight:s}},t}(),UT=function(){function t(){}return t.prototype.update=function(t,e){var n=t.cx,r=void 0===n?0:n,i=t.cy,o=void 0===i?0:i,a=t.rx,s=void 0===a?0:a,l=t.ry;return{cx:r,cy:o,hwidth:s,hheight:void 0===l?0:l}},t}(),GT=function(){function t(){}return t.prototype.update=function(t){var e=t.x1,n=t.y1,r=t.x2,i=t.y2,o=Math.min(e,r),a=Math.max(e,r),s=Math.min(n,i),l=(a-o)/2,u=(Math.max(n,i)-s)/2;return{cx:o+l,cy:s+u,hwidth:l,hheight:u}},t}(),zT=function(){function t(){}return t.prototype.update=function(t){var e=t.d.rect,n=e.x,r=e.y,i=e.width/2,o=e.height/2;return{cx:n+i,cy:r+o,hwidth:i,hheight:o}},t}(),VT=function(){function t(){}return t.prototype.update=function(t){if(t.points&&S(t.points.points)){var e=t.points.points,n=Math.min.apply(Math,u([],l(e.map((function(t){return t[0]}))),!1)),r=Math.max.apply(Math,u([],l(e.map((function(t){return t[0]}))),!1)),i=Math.min.apply(Math,u([],l(e.map((function(t){return t[1]}))),!1)),o=Math.max.apply(Math,u([],l(e.map((function(t){return t[1]}))),!1)),a=(r-n)/2,s=(o-i)/2;return{cx:n+a,cy:i+s,hwidth:a,hheight:s}}return{cx:0,cy:0,hwidth:0,hheight:0}},t}(),WT=function(){function t(){}return t.prototype.update=function(t,e){var n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,a=t.src,s=t.width,l=void 0===s?0:s,u=t.height,c=l,h=void 0===u?0:u;return a&&!N(a)&&(c||(c=a.width,t.width=c),h||(h=a.height,t.height=h)),{cx:r+c/2,cy:o+h/2,hwidth:c/2,hheight:h/2}},t}(),jT=function(){function t(t){this.globalRuntime=t}return t.prototype.isReadyToMeasure=function(t,e){var n=t.text,r=t.textAlign,i=t.textBaseline,o=t.fontSize,a=t.fontStyle,s=t.fontWeight,l=t.fontVariant,u=t.lineWidth;return gw.enableCSSParsing?n&&o&&a&&s&&l&&r&&i&&!_(u):n},t.prototype.update=function(t,e){var n,r,i=t.text,o=t.textAlign,a=void 0===o?"start":o,s=t.lineWidth,l=void 0===s?1:s,u=t.textBaseline,c=void 0===u?"alphabetic":u,h=t.dx,d=void 0===h?0:h,f=t.dy,p=void 0===f?0:f,g=t.x,v=void 0===g?0:g,m=t.y,y=void 0===m?0:m;if(!this.isReadyToMeasure(t,e))return t.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var E=((null===(r=null===(n=null==e?void 0:e.ownerDocument)||void 0===n?void 0:n.defaultView)||void 0===r?void 0:r.getConfig())||{}).offscreenCanvas,_=this.globalRuntime.textService.measureText(i,t,E);t.metrics=_;var b=_.width,x=_.height,S=_.lineHeight,M=_.fontProperties,A=b/2,R=x/2,T=v+A;"center"===a||"middle"===a?T+=l/2-A:"right"!==a&&"end"!==a||(T+=l-2*A);var w=y-R;return"middle"===c?w+=R:"top"===c||"hanging"===c?w+=2*R:"alphabetic"===c?w+=this.globalRuntime.enableCSSParsing?S-M.ascent:0:"bottom"!==c&&"ideographic"!==c||(w+=0),d&&(T+=d),p&&(w+=p),{cx:T,cy:w,hwidth:A,hheight:R}},t}(),HT=function(){function t(){}return t.prototype.update=function(t,e){return{cx:0,cy:0,hwidth:0,hheight:0}},t}();var XT,YT=function(){function t(e){this.eventPhase=t.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new MM,this.page=new MM,this.canvas=new MM,this.viewport=new MM,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerX",{get:function(){return this.layer.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerY",{get:function(){return this.layer.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageX",{get:function(){return this.page.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageY",{get:function(){return this.page.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasX",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasY",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportX",{get:function(){return this.viewport.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportY",{get:function(){return this.viewport.y},enumerable:!1,configurable:!0}),t.prototype.composedPath=function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},Object.defineProperty(t.prototype,"propagationPath",{get:function(){return this.composedPath()},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},t.prototype.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.initEvent=function(){},t.prototype.initUIEvent=function(){},t.prototype.clone=function(){throw new Error(RM)},t}(),KT=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.client=new MM,e.movement=new MM,e.offset=new MM,e.global=new MM,e.screen=new MM,e}return n(e,t),Object.defineProperty(e.prototype,"clientX",{get:function(){return this.client.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientY",{get:function(){return this.client.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementX",{get:function(){return this.movement.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementY",{get:function(){return this.movement.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalX",{get:function(){return this.global.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalY",{get:function(){return this.global.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenX",{get:function(){return this.screen.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenY",{get:function(){return this.screen.y},enumerable:!1,configurable:!0}),e.prototype.getModifierState=function(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)},e.prototype.initMouseEvent=function(){throw new Error(RM)},e}(YT),$T=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.width=0,e.height=0,e.isPrimary=!1,e}return n(e,t),e.prototype.getCoalescedEvents=function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]},e.prototype.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},e.prototype.clone=function(){return this.manager.clonePointerEvent(this)},e}(KT),qT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.clone=function(){return this.manager.cloneWheelEvent(this)},e}(KT),ZT=function(t){function e(e,n){var r=t.call(this,null)||this;return r.type=e,r.detail=n,Object.assign(r,n),r}return n(e,t),e}(YT),QT=function(){function t(){this.emitter=new $x}return t.prototype.on=function(t,e,n){return this.addEventListener(t,e,n),this},t.prototype.addEventListener=function(t,e,n){var r=W(n)&&n||M(n)&&n.capture,i=M(n)&&n.once,o=$M(e)?void 0:e,a=!1,s="";if(t.indexOf(":")>-1){var c=l(t.split(":"),2),h=c[0];t=c[1],s=h,a=!0}if(t=r?"".concat(t,"capture"):t,e=$M(e)?e:e.handleEvent,a){var d=e;e=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(null===(t=e[0].target)||void 0===t?void 0:t.name)===s&&d.apply(void 0,u([],l(e),!1))}}return i?this.emitter.once(t,e,o):this.emitter.on(t,e,o),this},t.prototype.off=function(t,e,n){return t?this.removeEventListener(t,e,n):this.removeAllEventListeners(),this},t.prototype.removeAllEventListeners=function(){this.emitter.removeAllListeners()},t.prototype.removeEventListener=function(t,e,n){var r=W(n)&&n||M(n)&&n.capture,i=$M(e)?void 0:e;return t=r?"".concat(t,"capture"):t,e=$M(e)?e:null==e?void 0:e.handleEvent,this.emitter.off(t,e,i),this},t.prototype.emit=function(t,e){this.dispatchEvent(new ZT(t,e))},t.prototype.dispatchEvent=function(t,e){var n,r,i;if(void 0===e&&(e=!1),!t.type)throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");if(i=this.document?this:this.defaultView?this.defaultView:null===(n=this.ownerDocument)||void 0===n?void 0:n.defaultView){if(t.manager=i.getEventService()||null,!t.manager)return!1;t.defaultPrevented=!1,t.path=[],e||(t.target=this),null===(r=t.manager)||void 0===r||r.dispatchEvent(t,t.type,e)}return!t.defaultPrevented},t}(),JT=function(t){function e(){var e=t.call(this)||this;return e.shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.parentNode=null,e}return n(e,t),e.isNode=function(t){return!!t.childNodes},Object.defineProperty(e.prototype,"textContent",{get:function(){var t,e,n="";this.nodeName===$S.TEXT&&(n+=this.style.text);try{for(var r=s(this.childNodes),i=r.next();!i.done;i=r.next()){var o=i.value;o.nodeName===$S.TEXT?n+=o.nodeValue:n+=o.textContent}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},set:function(t){var e=this;this.childNodes.slice().forEach((function(t){e.removeChild(t)})),this.nodeName===$S.TEXT&&(this.style.text="".concat(t))},enumerable:!1,configurable:!0}),e.prototype.getRootNode=function(t){return void 0===t&&(t={}),this.parentNode?this.parentNode.getRootNode(t):t.composed&&this.host?this.host.getRootNode(t):this},e.prototype.hasChildNodes=function(){return this.childNodes.length>0},e.prototype.isDefaultNamespace=function(t){throw new Error(RM)},e.prototype.lookupNamespaceURI=function(t){throw new Error(RM)},e.prototype.lookupPrefix=function(t){throw new Error(RM)},e.prototype.normalize=function(){throw new Error(RM)},e.prototype.isEqualNode=function(t){return this===t},e.prototype.isSameNode=function(t){return this.isEqualNode(t)},Object.defineProperty(e.prototype,"parent",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.childNodes.length>0?this.childNodes[0]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null},enumerable:!1,configurable:!0}),e.prototype.compareDocumentPosition=function(t){var n;if(t===this)return 0;for(var r=t,i=this,o=[r],a=[i];null!==(n=r.parentNode)&&void 0!==n?n:i.parentNode;)r=r.parentNode?(o.push(r.parentNode),r.parentNode):r,i=i.parentNode?(a.push(i.parentNode),i.parentNode):i;if(r!==i)return e.DOCUMENT_POSITION_DISCONNECTED|e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|e.DOCUMENT_POSITION_PRECEDING;var s=o.length>a.length?o:a,l=s===o?a:o;if(s[s.length-l.length]===l[0])return s===o?e.DOCUMENT_POSITION_CONTAINED_BY|e.DOCUMENT_POSITION_FOLLOWING:e.DOCUMENT_POSITION_CONTAINS|e.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===o?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING:s===o?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING}}return e.DOCUMENT_POSITION_FOLLOWING},e.prototype.contain=function(t){return this.contains(t)},e.prototype.contains=function(t){for(var e=t;e&&this!==e;)e=e.parentNode;return!!e},e.prototype.getAncestor=function(t){for(var e=this;t>0&&e;)e=e.parentNode,t--;return e},e.prototype.forEach=function(t,e){void 0===e&&(e=!1),t(this)||(e?this.childNodes.slice():this.childNodes).forEach((function(e){e.forEach(t)}))},e.DOCUMENT_POSITION_DISCONNECTED=1,e.DOCUMENT_POSITION_PRECEDING=2,e.DOCUMENT_POSITION_FOLLOWING=4,e.DOCUMENT_POSITION_CONTAINS=8,e.DOCUMENT_POSITION_CONTAINED_BY=16,e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,e}(QT),tw=function(){function t(t,e){var n=this;this.globalRuntime=t,this.context=e,this.emitter=new $x,this.nativeHTMLMap=new WeakMap,this.cursor="default",this.mappingTable={},this.mappingState={trackingData:{}},this.eventPool=new Map,this.tmpMatrix=ct(),this.tmpVec3=Xt(),this.onPointerDown=function(t){var e=n.createPointerEvent(t);if(n.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)n.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){var r=2===e.button;n.dispatchEvent(e,r?"rightdown":"mousedown")}n.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),n.freeEvent(e)},this.onPointerUp=function(t){var e,r=hT.now(),i=n.createPointerEvent(t,void 0,void 0,n.context.config.alwaysTriggerPointerEventOnCanvas?n.rootTarget:void 0);if(n.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)n.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){var o=2===i.button;n.dispatchEvent(i,o?"rightup":"mouseup")}var a=n.trackingData(t.pointerId),s=n.findMountedTarget(a.pressTargetsByButton[t.button]),l=s;if(s&&!i.composedPath().includes(s)){for(var u=s;u&&!i.composedPath().includes(u);){if(i.currentTarget=u,n.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)n.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){o=2===i.button;n.notifyTarget(i,o?"rightupoutside":"mouseupoutside")}JT.isNode(u)&&(u=u.parentNode)}delete a.pressTargetsByButton[t.button],l=u}if(l){var c=n.clonePointerEvent(i,"click");c.target=l,c.path=[],a.clicksByButton[t.button]||(a.clicksByButton[t.button]={clickCount:0,target:c.target,timeStamp:r});var h=a.clicksByButton[t.button];h.target===c.target&&r-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=c.target,h.timeStamp=r,c.detail=h.clickCount,(null===(e=i.detail)||void 0===e?void 0:e.preventClick)||(n.context.config.useNativeClickEvent||"mouse"!==c.pointerType&&"touch"!==c.pointerType||n.dispatchEvent(c,"click"),n.dispatchEvent(c,"pointertap")),n.freeEvent(c)}n.freeEvent(i)},this.onPointerMove=function(t){var e=n.createPointerEvent(t,void 0,void 0,n.context.config.alwaysTriggerPointerEventOnCanvas?n.rootTarget:void 0),r="mouse"===e.pointerType||"pen"===e.pointerType,i=n.trackingData(t.pointerId),o=n.findMountedTarget(i.overTargets);if(i.overTargets&&o!==e.target){var a="mousemove"===t.type?"mouseout":"pointerout",s=n.createPointerEvent(t,a,o||void 0);if(n.dispatchEvent(s,"pointerout"),r&&n.dispatchEvent(s,"mouseout"),!e.composedPath().includes(o)){var l=n.createPointerEvent(t,"pointerleave",o||void 0);for(l.eventPhase=l.AT_TARGET;l.target&&!e.composedPath().includes(l.target);)l.currentTarget=l.target,n.notifyTarget(l),r&&n.notifyTarget(l,"mouseleave"),JT.isNode(l.target)&&(l.target=l.target.parentNode);n.freeEvent(l)}n.freeEvent(s)}if(o!==e.target){var u="mousemove"===t.type?"mouseover":"pointerover",c=n.clonePointerEvent(e,u);n.dispatchEvent(c,"pointerover"),r&&n.dispatchEvent(c,"mouseover");for(var h=o&&JT.isNode(o)&&o.parentNode;h&&h!==(JT.isNode(n.rootTarget)&&n.rootTarget.parentNode)&&h!==e.target;)h=h.parentNode;if(!h||h===(JT.isNode(n.rootTarget)&&n.rootTarget.parentNode)){var d=n.clonePointerEvent(e,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==o&&d.target!==(JT.isNode(n.rootTarget)&&n.rootTarget.parentNode);)d.currentTarget=d.target,n.notifyTarget(d),r&&n.notifyTarget(d,"mouseenter"),JT.isNode(d.target)&&(d.target=d.target.parentNode);n.freeEvent(d)}n.freeEvent(c)}n.dispatchEvent(e,"pointermove"),"touch"===e.pointerType&&n.dispatchEvent(e,"touchmove"),r&&(n.dispatchEvent(e,"mousemove"),n.cursor=n.getCursor(e.target)),i.overTargets=e.composedPath(),n.freeEvent(e)},this.onPointerOut=function(t){var e=n.trackingData(t.pointerId);if(e.overTargets){var r="mouse"===t.pointerType||"pen"===t.pointerType,i=n.findMountedTarget(e.overTargets),o=n.createPointerEvent(t,"pointerout",i||void 0);n.dispatchEvent(o),r&&n.dispatchEvent(o,"mouseout");var a=n.createPointerEvent(t,"pointerleave",i||void 0);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==(JT.isNode(n.rootTarget)&&n.rootTarget.parentNode);)a.currentTarget=a.target,n.notifyTarget(a),r&&n.notifyTarget(a,"mouseleave"),JT.isNode(a.target)&&(a.target=a.target.parentNode);e.overTargets=null,n.freeEvent(o),n.freeEvent(a)}n.cursor=null},this.onPointerOver=function(t){var e=n.trackingData(t.pointerId),r=n.createPointerEvent(t),i="mouse"===r.pointerType||"pen"===r.pointerType;n.dispatchEvent(r,"pointerover"),i&&n.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(n.cursor=n.getCursor(r.target));var o=n.clonePointerEvent(r,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==(JT.isNode(n.rootTarget)&&n.rootTarget.parentNode);)o.currentTarget=o.target,n.notifyTarget(o),i&&n.notifyTarget(o,"mouseenter"),JT.isNode(o.target)&&(o.target=o.target.parentNode);e.overTargets=r.composedPath(),n.freeEvent(r),n.freeEvent(o)},this.onPointerUpOutside=function(t){var e=n.trackingData(t.pointerId),r=n.findMountedTarget(e.pressTargetsByButton[t.button]),i=n.createPointerEvent(t);if(r){for(var o=r;o;)i.currentTarget=o,n.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType||"mouse"!==i.pointerType&&"pen"!==i.pointerType||n.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),JT.isNode(o)&&(o=o.parentNode);delete e.pressTargetsByButton[t.button]}n.freeEvent(i)},this.onWheel=function(t){var e=n.createWheelEvent(t);n.dispatchEvent(e),n.freeEvent(e)},this.onClick=function(t){if(n.context.config.useNativeClickEvent){var e=n.createPointerEvent(t);n.dispatchEvent(e),n.freeEvent(e)}},this.onPointerCancel=function(t){var e=n.createPointerEvent(t,void 0,void 0,n.context.config.alwaysTriggerPointerEventOnCanvas?n.rootTarget:void 0);n.dispatchEvent(e),n.freeEvent(e)}}return t.prototype.init=function(){this.rootTarget=this.context.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointercancel",this.onPointerCancel),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel),this.addEventMapping("click",this.onClick)},t.prototype.destroy=function(){this.emitter.removeAllListeners(),this.mappingTable={},this.mappingState={},this.eventPool.clear()},t.prototype.getScale=function(){var t=this.context.contextService.getBoundingClientRect(),e=1,n=1,r=this.context.contextService.getDomElement();if(r&&t){var i=r.offsetWidth,o=r.offsetHeight;i&&o&&(e=t.width/i,n=t.height/o)}return{scaleX:e,scaleY:n,bbox:t}},t.prototype.client2Viewport=function(t){var e=this.getScale(),n=e.scaleX,r=e.scaleY,i=e.bbox;return new MM((t.x-((null==i?void 0:i.left)||0))/n,(t.y-((null==i?void 0:i.top)||0))/r)},t.prototype.viewport2Client=function(t){var e=this.getScale(),n=e.scaleX,r=e.scaleY,i=e.bbox;return new MM((t.x+((null==i?void 0:i.left)||0))*n,(t.y+((null==i?void 0:i.top)||0))*r)},t.prototype.viewport2Canvas=function(t){var e=t.x,n=t.y,r=this.rootTarget.defaultView.getCamera(),i=this.context.config,o=i.width,a=i.height,s=r.getPerspectiveInverse(),l=r.getWorldTransform(),u=Et(this.tmpMatrix,l,s),c=Zt(this.tmpVec3,e/o*2-1,2*(1-n/a)-1,0);return oe(c,c,u),new MM(c[0],c[1])},t.prototype.canvas2Viewport=function(t){var e=this.rootTarget.defaultView.getCamera(),n=e.getPerspective(),r=e.getViewTransform(),i=Et(this.tmpMatrix,n,r),o=Zt(this.tmpVec3,t.x,t.y,0);oe(this.tmpVec3,this.tmpVec3,i);var a=this.context.config,s=a.width,l=a.height;return new MM((o[0]+1)/2*s,(1-(o[1]+1)/2)*l)},t.prototype.setPickHandler=function(t){this.pickHandler=t},t.prototype.addEventMapping=function(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((function(t,e){return t.priority-e.priority}))},t.prototype.mapEvent=function(t){if(this.rootTarget){var e=this.mappingTable[t.type];if(e)for(var n=0,r=e.length;n<r;n++)e[n].fn(t);else console.warn("[EventService]: Event mapping not defined for ".concat(t.type))}},t.prototype.dispatchEvent=function(t,e,n){if(n){t.eventPhase=t.AT_TARGET;var r=this.rootTarget.defaultView||null;t.currentTarget=r,this.notifyListeners(t,e)}else t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e);this.emitter.emit(e||t.type,t)},t.prototype.propagate=function(t,e){if(t.target){var n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(var r=n.length-1;r>=1;r--)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){var i=n.indexOf(t.currentTarget);t.eventPhase=t.BUBBLING_PHASE;for(r=i+1;r<n.length;r++)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}},t.prototype.propagationPath=function(t){var e=[t],n=this.rootTarget.defaultView||null;if(n&&n===t)return e.unshift(n.document),e;for(var r=0;r<2048&&t!==this.rootTarget;r++)JT.isNode(t)&&t.parentNode&&(e.push(t.parentNode),t=t.parentNode);return n&&e.push(n),e},t.prototype.hitTest=function(t){var e=t.viewportX,n=t.viewportY,r=this.context.config,i=r.width,o=r.height,a=r.disableHitTesting;return e<0||n<0||e>i||n>o?null:!a&&this.pickHandler(t)||this.rootTarget||null},t.prototype.isNativeEventFromCanvas=function(t,e){var n=null==e?void 0:e.target;if((null==n?void 0:n.shadowRoot)&&(n=e.composedPath()[0]),n){if(n===t)return!0;if(t&&t.contains)return t.contains(n)}return!!(null==e?void 0:e.composedPath)&&e.composedPath().indexOf(t)>-1},t.prototype.getExistedHTML=function(t){var e,n;if(t.nativeEvent.composedPath)try{for(var r=s(t.nativeEvent.composedPath()),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.nativeHTMLMap.get(o);if(a)return a}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null},t.prototype.pickTarget=function(t){return this.hitTest({clientX:t.clientX,clientY:t.clientY,viewportX:t.viewportX,viewportY:t.viewportY,x:t.canvasX,y:t.canvasY})},t.prototype.createPointerEvent=function(t,e,n,r){var i=this.allocateEvent($T);this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t;var o=this.getExistedHTML(i),a=this.context.contextService.getDomElement();return i.target=null!=n?n:o||this.isNativeEventFromCanvas(a,i.nativeEvent)&&this.pickTarget(i)||r,"string"==typeof e&&(i.type=e),i},t.prototype.createWheelEvent=function(t){var e=this.allocateEvent(qT);this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t;var n=this.getExistedHTML(e),r=this.context.contextService.getDomElement();return e.target=n||this.isNativeEventFromCanvas(r,e.nativeEvent)&&this.pickTarget(e),e},t.prototype.trackingData=function(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]},t.prototype.cloneWheelEvent=function(t){var e=this.allocateEvent(qT);return e.nativeEvent=t.nativeEvent,e.originalEvent=t.originalEvent,this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.target=t.target,e.path=t.composedPath().slice(),e.type=t.type,e},t.prototype.clonePointerEvent=function(t,e){var n=this.allocateEvent($T);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=null!=e?e:n.type,n},t.prototype.copyPointerData=function(t,e){e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist},t.prototype.copyMouseData=function(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.client.copyFrom(t.client),e.movement.copyFrom(t.movement),e.canvas.copyFrom(t.canvas),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global),e.offset.copyFrom(t.offset)},t.prototype.copyWheelData=function(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ},t.prototype.copyData=function(t,e){e.isTrusted=t.isTrusted,e.timeStamp=hT.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.page.copyFrom(t.page),e.viewport.copyFrom(t.viewport)},t.prototype.allocateEvent=function(t){this.eventPool.has(t)||this.eventPool.set(t,[]);var e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=[],e.target=null,e},t.prototype.freeEvent=function(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)},t.prototype.notifyTarget=function(t,e){e=null!=e?e:t.type;var n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?"".concat(e,"capture"):e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)},t.prototype.notifyListeners=function(t,e){var n=t.currentTarget.emitter,r=n._events[e];if(r)if("fn"in r)r.once&&n.removeListener(e,r.fn,void 0,!0),r.fn.call(t.currentTarget||r.context,t);else for(var i=0;i<r.length&&!t.propagationImmediatelyStopped;i++)r[i].once&&n.removeListener(e,r[i].fn,void 0,!0),r[i].fn.call(t.currentTarget||r[i].context,t)},t.prototype.findMountedTarget=function(t){if(!t)return null;for(var e=t[t.length-1],n=t.length-2;n>=0;n--){var r=t[n];if(!(r===this.rootTarget||JT.isNode(r)&&r.parentNode===e))break;e=t[n]}return e},t.prototype.getCursor=function(t){for(var e=t;e;){var n=oT(e)&&e.getAttribute("cursor");if(n)return n;e=JT.isNode(e)&&e.parentNode}},t}(),ew=function(){function t(){}return t.prototype.getOrCreateCanvas=function(t,e){if(this.canvas)return this.canvas;if(t||gw.offscreenCanvas)this.canvas=t||gw.offscreenCanvas,this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e))}return this.canvas.width=10,this.canvas.height=10,this.canvas},t.prototype.getOrCreateContext=function(t,e){return this.context||this.getOrCreateCanvas(t,e),this.context},t}();!function(t){t[t.CAMERA_CHANGED=0]="CAMERA_CHANGED",t[t.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",t[t.NONE=2]="NONE"}(XT||(XT={}));var nw,rw=function(){function t(t,e){this.globalRuntime=t,this.context=e,this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.hooks={init:new RT,initAsync:new MT,dirtycheck:new TT,cull:new TT,beginFrame:new RT,beforeRender:new RT,render:new RT,afterRender:new RT,endFrame:new RT,destroy:new RT,pick:new AT,pickSync:new TT,pointerDown:new RT,pointerUp:new RT,pointerMove:new RT,pointerOut:new RT,pointerOver:new RT,pointerWheel:new RT,pointerCancel:new RT,click:new RT}}return t.prototype.init=function(t){var e=this,n=r(r({},this.globalRuntime),this.context);this.context.renderingPlugins.forEach((function(t){t.apply(n,e.globalRuntime)})),this.hooks.init.call(),0===this.hooks.initAsync.getCallbacksNum()?(this.inited=!0,t()):this.hooks.initAsync.promise().then((function(){e.inited=!0,t()}))},t.prototype.getStats=function(){return this.stats},t.prototype.disableDirtyRectangleRendering=function(){return!this.context.config.renderer.getConfig().enableDirtyRectangleRendering||this.context.renderingContext.renderReasons.has(XT.CAMERA_CHANGED)},t.prototype.render=function(t,e,n){var r=this;this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0;var i=this.context.renderingContext;if(this.globalRuntime.sceneGraphService.syncHierarchy(i.root),this.globalRuntime.sceneGraphService.triggerPendingEvents(),i.renderReasons.size&&this.inited){i.dirtyRectangleRenderingDisabled=this.disableDirtyRectangleRendering();var o=1===i.renderReasons.size&&i.renderReasons.has(XT.CAMERA_CHANGED),a=!t.disableRenderHooks||!(t.disableRenderHooks&&o);a&&this.renderDisplayObject(i.root,t,i),this.hooks.beginFrame.call(e),a&&i.renderListCurrentFrame.forEach((function(t){r.hooks.beforeRender.call(t),r.hooks.render.call(t),r.hooks.afterRender.call(t)})),this.hooks.endFrame.call(e),i.renderListCurrentFrame=[],i.renderReasons.clear(),n()}},t.prototype.renderDisplayObject=function(t,e,n){var r=this,i=e.renderer.getConfig(),o=i.enableDirtyCheck,a=i.enableCulling;this.globalRuntime.enableCSSParsing&&this.globalRuntime.styleValueRegistry.recalc(t);var s=t.renderable,l=o?s.dirty||n.dirtyRectangleRenderingDisabled?t:null:t;if(l){var u=a?this.hooks.cull.call(l,this.context.camera):l;u&&(this.stats.rendered++,n.renderListCurrentFrame.push(u))}t.renderable.dirty=!1,t.sortable.renderOrder=this.zIndexCounter++,this.stats.total++;var c=t.sortable;c.dirty&&(this.sort(t,c),c.dirty=!1,c.dirtyChildren=[],c.dirtyReason=void 0),(c.sorted||t.childNodes).forEach((function(t){r.renderDisplayObject(t,e,n)}))},t.prototype.sort=function(t,e){e.sorted&&e.dirtyReason!==rA.Z_INDEX_CHANGED?e.dirtyChildren.forEach((function(n){if(-1===t.childNodes.indexOf(n)){var r=e.sorted.indexOf(n);r>=0&&e.sorted.splice(r,1)}else if(0===e.sorted.length)e.sorted.push(n);else{var i=function(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>>1;aT(t[i],e)<0?n=i+1:r=i}return n}(e.sorted,n);e.sorted.splice(i,0,n)}})):e.sorted=t.childNodes.slice().sort(aT)},t.prototype.destroy=function(){this.inited=!1,this.hooks.destroy.call(),this.globalRuntime.sceneGraphService.clearPendingEvents()},t.prototype.dirtify=function(){this.context.renderingContext.renderReasons.add(XT.DISPLAY_OBJECT_CHANGED)},t}(),iw=/\[\s*(.*)=(.*)\s*\]/,ow=function(){function t(){}return t.prototype.selectOne=function(t,e){var n=this;if(t.startsWith("."))return e.find((function(e){return((null==e?void 0:e.classList)||[]).indexOf(n.getIdOrClassname(t))>-1}));if(t.startsWith("#"))return e.find((function(e){return e.id===n.getIdOrClassname(t)}));if(t.startsWith("[")){var r=this.getAttribute(t),i=r.name,o=r.value;return i?e.find((function(t){return e!==t&&("name"===i?t.name===o:n.attributeToString(t,i)===o)})):null}return e.find((function(n){return e!==n&&n.nodeName===t}))},t.prototype.selectAll=function(t,e){var n=this;if(t.startsWith("."))return e.findAll((function(r){return e!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(t))>-1}));if(t.startsWith("#"))return e.findAll((function(r){return e!==r&&r.id===n.getIdOrClassname(t)}));if(t.startsWith("[")){var r=this.getAttribute(t),i=r.name,o=r.value;return i?e.findAll((function(t){return e!==t&&("name"===i?t.name===o:n.attributeToString(t,i)===o)})):[]}return e.findAll((function(n){return e!==n&&n.nodeName===t}))},t.prototype.is=function(t,e){if(t.startsWith("."))return e.className===this.getIdOrClassname(t);if(t.startsWith("#"))return e.id===this.getIdOrClassname(t);if(t.startsWith("[")){var n=this.getAttribute(t),r=n.name,i=n.value;return"name"===r?e.name===i:this.attributeToString(e,r)===i}return e.nodeName===t},t.prototype.getIdOrClassname=function(t){return t.substring(1)},t.prototype.getAttribute=function(t){var e=t.match(iw),n="",r="";return e&&e.length>2&&(n=e[1].replace(/"/g,""),r=e[2].replace(/"/g,"")),{name:n,value:r}},t.prototype.attributeToString=function(t,e){if(!t.getAttribute)return"";var n=t.getAttribute(e);return _(n)?"":n.toString?n.toString():""},t}(),aw=function(t){function e(e,n,r,i,o,a,s,l){var u=t.call(this,null)||this;return u.relatedNode=n,u.prevValue=r,u.newValue=i,u.attrName=o,u.attrChange=a,u.prevParsedValue=s,u.newParsedValue=l,u.type=e,u}return n(e,t),e.ADDITION=2,e.MODIFICATION=1,e.REMOVAL=3,e}(YT);function sw(t){var e=t.renderable;e&&(e.renderBoundsDirty=!0,e.boundsDirty=!0)}!function(t){t.REPARENT="reparent",t.DESTROY="destroy",t.ATTR_MODIFIED="DOMAttrModified",t.INSERTED="DOMNodeInserted",t.REMOVED="removed",t.MOUNTED="DOMNodeInsertedIntoDocument",t.UNMOUNTED="DOMNodeRemovedFromDocument",t.BOUNDS_CHANGED="bounds-changed",t.CULLED="culled"}(nw||(nw={}));var lw=new aw(nw.REPARENT,null,"","","",0,"",""),uw=function(){function t(t){var e,n,r,i,o,a,s,l,u=this;this.runtime=t,this.pendingEvents=[],this.boundsChangedEvent=new ZT(nw.BOUNDS_CHANGED),this.rotate=(e=de(),function(t,n,r,i,o){void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=!0),"number"==typeof n&&(n=$t(n,r,i));var a=t.transformable;if(null!==t.parentNode&&t.parentNode.transformable){var s=de();ve(s,n[0],n[1],n[2]);var l=u.getRotation(t),c=u.getRotation(t.parentNode);ye(e,c),ge(e,e),pe(s,e,s),pe(a.localRotation,s,l),_e(a.localRotation,a.localRotation),o&&u.dirtifyLocal(t,a)}else u.rotateLocal(t,n)}),this.rotateLocal=(n=de(),function(t,e,r,i,o){void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=!0),"number"==typeof e&&(e=$t(e,r,i));var a=t.transformable;ve(n,e[0],e[1],e[2]),Ee(a.localRotation,a.localRotation,n),o&&u.dirtifyLocal(t,a)}),this.setEulerAngles=(r=de(),function(t,e,n,i,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=!0),"number"==typeof e&&(e=$t(e,n,i));var a=t.transformable;if(null!==t.parentNode&&t.parentNode.transformable){ve(a.localRotation,e[0],e[1],e[2]);var s=u.getRotation(t.parentNode);ye(r,ge(de(),s)),Ee(a.localRotation,a.localRotation,r),o&&u.dirtifyLocal(t,a)}else u.setLocalEulerAngles(t,e)}),this.translateLocal=function(t,e,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=!0),"number"==typeof e&&(e=$t(e,n,r));var o=t.transformable;ae(e,Xt())||(function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],l=e[1],u=e[2],c=i*u-o*l,h=o*s-r*u,d=r*l-i*s,f=i*d-o*h,p=o*c-r*d,g=r*h-i*c,v=2*a;c*=v,h*=v,d*=v,f*=2,p*=2,g*=2,t[0]=s+c+f,t[1]=l+h+p,t[2]=u+d+g}(e,e,o.localRotation),Qt(o.localPosition,o.localPosition,e),i&&u.dirtifyLocal(t,o))},this.setPosition=(i=ct(),o=Xt(),function(t,e,n){void 0===n&&(n=!0);var r=t.transformable;if(o[0]=e[0],o[1]=e[1],o[2]=e[2]||0,!ae(u.getPosition(t),o)){if(qt(r.position,o),null!==t.parentNode&&t.parentNode.transformable){var a=t.parentNode.transformable;dt(i,a.worldTransform),mt(i,i),oe(r.localPosition,o,i)}else qt(r.localPosition,o);n&&u.dirtifyLocal(t,r)}}),this.setLocalPosition=function(){var t=Xt();return function(e,n,r){void 0===r&&(r=!0);var i=e.transformable;t[0]=n[0],t[1]=n[1],t[2]=n[2]||0,ae(i.localPosition,t)||(qt(i.localPosition,t),r&&u.dirtifyLocal(e,i))}}(),this.translate=(a=Xt(),s=Xt(),l=Xt(),function(t,e,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=!0),"number"==typeof e&&(e=Zt(s,e,n,r)),ae(e,a)||(Qt(l,u.getPosition(t),e),u.setPosition(t,l,i))}),this.setRotation=function(){var t=de();return function(e,n,r,i,o,a){void 0===a&&(a=!0);var s=e.transformable;if("number"==typeof n&&(n=me(n,r,i,o)),null!==e.parentNode&&e.parentNode.transformable){var l=u.getRotation(e.parentNode);ye(t,l),ge(t,t),pe(s.localRotation,t,n),_e(s.localRotation,s.localRotation),a&&u.dirtifyLocal(e,s)}else u.setLocalRotation(e,n)}},this.displayObjectDependencyMap=new WeakMap,this.calcLocalTransform=function(){var t=ct(),e=Xt(),n=me(0,0,0,1);return function(r){if(0!==r.localSkew[0]||0!==r.localSkew[1]){if(Lt(r.localTransform,r.localRotation,r.localPosition,$t(1,1,1),r.origin),0!==r.localSkew[0]||0!==r.localSkew[1]){var i=gt(t);i[4]=Math.tan(r.localSkew[0]),i[1]=Math.tan(r.localSkew[1]),Et(r.localTransform,r.localTransform,i)}var o=Lt(t,n,e,r.localScale,r.origin);Et(r.localTransform,r.localTransform,o)}else Lt(r.localTransform,r.localRotation,r.localPosition,r.localScale,r.origin)}}()}return t.prototype.matches=function(t,e){return this.runtime.sceneGraphSelector.is(t,e)},t.prototype.querySelector=function(t,e){return this.runtime.sceneGraphSelector.selectOne(t,e)},t.prototype.querySelectorAll=function(t,e){return this.runtime.sceneGraphSelector.selectAll(t,e)},t.prototype.attach=function(t,e,n){var r,i=!1;t.parentNode&&(i=t.parentNode!==e,this.detach(t)),t.parentNode=e,_(n)?t.parentNode.childNodes.push(t):t.parentNode.childNodes.splice(n,0,t);var o=e.sortable;((null===(r=null==o?void 0:o.sorted)||void 0===r?void 0:r.length)||t.parsedStyle.zIndex)&&(-1===o.dirtyChildren.indexOf(t)&&o.dirtyChildren.push(t),o.dirty=!0,o.dirtyReason=rA.ADDED);var a=t.transformable;a&&this.dirtifyWorld(t,a),a.frozen&&this.unfreezeParentToRoot(t),i&&t.dispatchEvent(lw)},t.prototype.detach=function(t){var e,n;if(t.parentNode){var r=t.transformable,i=t.parentNode.sortable;((null===(e=null==i?void 0:i.sorted)||void 0===e?void 0:e.length)||(null===(n=t.style)||void 0===n?void 0:n.zIndex))&&(-1===i.dirtyChildren.indexOf(t)&&i.dirtyChildren.push(t),i.dirty=!0,i.dirtyReason=rA.REMOVED);var o=t.parentNode.childNodes.indexOf(t);o>-1&&t.parentNode.childNodes.splice(o,1),r&&this.dirtifyWorld(t,r),t.parentNode=null}},t.prototype.getOrigin=function(t){return t.getGeometryBounds(),t.transformable.origin},t.prototype.setOrigin=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),"number"==typeof e&&(e=[e,n,r]);var i=t.transformable;if(e[0]!==i.origin[0]||e[1]!==i.origin[1]||e[2]!==i.origin[2]){var o=i.origin;o[0]=e[0],o[1]=e[1],o[2]=e[2]||0,this.dirtifyLocal(t,i)}},t.prototype.setLocalEulerAngles=function(t,e,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=!0),"number"==typeof e&&(e=$t(e,n,r));var o=t.transformable;ve(o.localRotation,e[0],e[1],e[2]),i&&this.dirtifyLocal(t,o)},t.prototype.scaleLocal=function(t,e,n){void 0===n&&(n=!0);var r=t.transformable;!function(t,e,n){t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2]}(r.localScale,r.localScale,$t(e[0],e[1],e[2]||1)),n&&this.dirtifyLocal(t,r)},t.prototype.setLocalScale=function(t,e,n){void 0===n&&(n=!0);var r=t.transformable,i=$t(e[0],e[1],e[2]||r.localScale[2]);ae(i,r.localScale)||(qt(r.localScale,i),n&&this.dirtifyLocal(t,r))},t.prototype.setLocalRotation=function(t,e,n,r,i,o){void 0===o&&(o=!0),"number"==typeof e&&(e=me(e,n,r,i));var a=t.transformable;ye(a.localRotation,e),o&&this.dirtifyLocal(t,a)},t.prototype.setLocalSkew=function(t,e,n){"number"==typeof e&&(e=function(t,e){var n=new lt(2);return n[0]=t,n[1]=e,n}(e,n));var r=t.transformable;!function(t,e){t[0]=e[0],t[1]=e[1]}(r.localSkew,e),this.dirtifyLocal(t,r)},t.prototype.dirtifyLocal=function(t,e){e.localDirtyFlag||(e.localDirtyFlag=!0,e.dirtyFlag||this.dirtifyWorld(t,e))},t.prototype.dirtifyWorld=function(t,e){e.dirtyFlag||this.unfreezeParentToRoot(t),this.dirtifyWorldInternal(t,e),this.dirtifyToRoot(t,!0)},t.prototype.triggerPendingEvents=function(){var t=this,e=new Set,n=function(n,r){n.isConnected&&!e.has(n.entity)&&(t.boundsChangedEvent.detail=r,t.boundsChangedEvent.target=n,n.isMutationObserved?n.dispatchEvent(t.boundsChangedEvent):n.ownerDocument.defaultView.dispatchEvent(t.boundsChangedEvent,!0),e.add(n.entity))};this.pendingEvents.forEach((function(t){var e=l(t,2),r=e[0],i=e[1];i.affectChildren?r.forEach((function(t){n(t,i)})):n(r,i)})),this.clearPendingEvents(),e.clear()},t.prototype.clearPendingEvents=function(){this.pendingEvents=[]},t.prototype.dirtifyToRoot=function(t,e){void 0===e&&(e=!1);var n=t;for(n.renderable&&(n.renderable.dirty=!0);n;)sw(n),n=n.parentNode;e&&t.forEach((function(t){sw(t)})),this.informDependentDisplayObjects(t),this.pendingEvents.push([t,{affectChildren:e}])},t.prototype.updateDisplayObjectDependency=function(t,e,n,r){if(e&&e!==n){var i=this.displayObjectDependencyMap.get(e);if(i&&i[t]){var o=i[t].indexOf(r);i[t].splice(o,1)}}if(n){var a=this.displayObjectDependencyMap.get(n);a||(this.displayObjectDependencyMap.set(n,{}),a=this.displayObjectDependencyMap.get(n)),a[t]||(a[t]=[]),a[t].push(r)}},t.prototype.informDependentDisplayObjects=function(t){var e=this,n=this.displayObjectDependencyMap.get(t);n&&Object.keys(n).forEach((function(t){n[t].forEach((function(n){e.dirtifyToRoot(n,!0),n.dispatchEvent(new aw(nw.ATTR_MODIFIED,n,e,e,t,aw.MODIFICATION,e,e)),n.isCustomElement&&n.isConnected&&n.attributeChangedCallback&&n.attributeChangedCallback(t,e,e)}))}))},t.prototype.getPosition=function(t){var e=t.transformable;return Ct(e.position,this.getWorldTransform(t,e))},t.prototype.getRotation=function(t){var e=t.transformable;return It(e.rotation,this.getWorldTransform(t,e))},t.prototype.getScale=function(t){var e=t.transformable;return Ot(e.scaling,this.getWorldTransform(t,e))},t.prototype.getWorldTransform=function(t,e){return void 0===e&&(e=t.transformable),e.localDirtyFlag||e.dirtyFlag?(t.parentNode&&t.parentNode.transformable&&this.getWorldTransform(t.parentNode),this.sync(t,e),e.worldTransform):e.worldTransform},t.prototype.getLocalPosition=function(t){return t.transformable.localPosition},t.prototype.getLocalRotation=function(t){return t.transformable.localRotation},t.prototype.getLocalScale=function(t){return t.transformable.localScale},t.prototype.getLocalSkew=function(t){return t.transformable.localSkew},t.prototype.getLocalTransform=function(t){var e=t.transformable;return e.localDirtyFlag&&(this.calcLocalTransform(e),e.localDirtyFlag=!1),e.localTransform},t.prototype.setLocalTransform=function(t,e){var n=Ct(Xt(),e),r=It(de(),e),i=Ot(Xt(),e);this.setLocalScale(t,i,!1),this.setLocalPosition(t,n,!1),this.setLocalRotation(t,r,void 0,void 0,void 0,!1),this.dirtifyLocal(t,t.transformable)},t.prototype.resetLocalTransform=function(t){this.setLocalScale(t,[1,1,1]),this.setLocalPosition(t,[0,0,0]),this.setLocalEulerAngles(t,[0,0,0]),this.setLocalSkew(t,[0,0])},t.prototype.getTransformedGeometryBounds=function(t,e,n){void 0===e&&(e=!1);var r=this.getGeometryBounds(t,e);if(yM.isEmpty(r))return null;var i=n||new yM;return i.setFromTransformedAABB(r,this.getWorldTransform(t)),i},t.prototype.getGeometryBounds=function(t,e){void 0===e&&(e=!1);var n=t.geometry;return n.dirty&&gw.styleValueRegistry.updateGeometry(t),(e?n.renderBounds:n.contentBounds||null)||new yM},t.prototype.getBounds=function(t,e){var n=this;void 0===e&&(e=!1);var r=t.renderable;if(!r.boundsDirty&&!e&&r.bounds)return r.bounds;if(!r.renderBoundsDirty&&e&&r.renderBounds)return r.renderBounds;var i=e?r.renderBounds:r.bounds,o=this.getTransformedGeometryBounds(t,e,i);if(t.childNodes.forEach((function(t){var r=n.getBounds(t,e);r&&(o?o.add(r):(o=i||new yM).update(r.center,r.halfExtents))})),o||(o=new yM),e){var a=sT(t);if(a){var s=a.parsedStyle.clipPath.getBounds(e);o?s&&(o=s.intersection(o)):o.update(s.center,s.halfExtents)}}return e?(r.renderBounds=o,r.renderBoundsDirty=!1):(r.bounds=o,r.boundsDirty=!1),o},t.prototype.getLocalBounds=function(t){if(t.parentNode){var e=ct();t.parentNode.transformable&&(e=mt(ct(),this.getWorldTransform(t.parentNode)));var n=this.getBounds(t);if(!yM.isEmpty(n)){var r=new yM;return r.setFromTransformedAABB(n,e),r}}return this.getBounds(t)},t.prototype.getBoundingClientRect=function(t){var e,n,r,i=this.getGeometryBounds(t);yM.isEmpty(i)||(r=new yM).setFromTransformedAABB(i,this.getWorldTransform(t));var o=null===(n=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===n?void 0:n.getContextService().getBoundingClientRect();if(r){var a=l(r.getMin(),2),s=a[0],u=a[1],c=l(r.getMax(),2),h=c[0],d=c[1];return new AM(s+((null==o?void 0:o.left)||0),u+((null==o?void 0:o.top)||0),h-s,d-u)}return new AM((null==o?void 0:o.left)||0,(null==o?void 0:o.top)||0,0,0)},t.prototype.dirtifyWorldInternal=function(t,e){var n=this;if(!e.dirtyFlag){e.dirtyFlag=!0,e.frozen=!1,t.childNodes.forEach((function(t){var e=t.transformable;e.dirtyFlag||n.dirtifyWorldInternal(t,e)}));var r=t.renderable;r&&(r.renderBoundsDirty=!0,r.boundsDirty=!0,r.dirty=!0)}},t.prototype.syncHierarchy=function(t){var e=t.transformable;if(!e.frozen){e.frozen=!0,(e.localDirtyFlag||e.dirtyFlag)&&this.sync(t,e);for(var n=t.childNodes,r=0;r<n.length;r++)this.syncHierarchy(n[r])}},t.prototype.sync=function(t,e){if(e.localDirtyFlag&&(this.calcLocalTransform(e),e.localDirtyFlag=!1),e.dirtyFlag){var n=t.parentNode,r=n&&n.transformable;null!==n&&r?Et(e.worldTransform,r.worldTransform,e.localTransform):dt(e.worldTransform,e.localTransform),e.dirtyFlag=!1}},t.prototype.unfreezeParentToRoot=function(t){for(var e=t.parentNode;e;){var n=e.transformable;n&&(n.frozen=!1),e=e.parentNode}},t}(),cw={MetricsString:"|ÉqÅ",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},hw=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,dw=new RegExp("".concat(/[!%),.:;?\]}¢°·'""†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/.source,"|").concat(/[!),.:;?\]}¢·–—'"•"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/.source,"|").concat(/[)\]｝〕〉》」』】〙〗〟'"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/.source,"|").concat(/[!%),.:;?\]}¢°'"†‡℃〆〈《「『〕！％），．：；？］｝]/.source)),fw=new RegExp("".concat(/[$(£¥·'"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/.source,"|").concat(/[([{£¥'"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/.source,"|").concat(/[([｛〔〈《「『【〘〖〝'"｟«—...‥〳〴〵]/.source,"|").concat(/[$([{£¥'"々〇〉》」〔＄（［｛｠￥￦#]/.source)),pw=function(){function t(t){var e=this;this.runtime=t,this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(t,n){return!e.isBreakingSpace(n)&&!(!t||!fw.exec(n)&&!dw.exec(t))},this.trimByKinsokuShorui=function(t){var e=u([],l(t),!1),n=e[e.length-2];if(!n)return t;var r=n[n.length-1];return e[e.length-2]=n.slice(0,-1),e[e.length-1]=r+e[e.length-1],e}}return t.prototype.measureFont=function(t,e){if(this.fontMetricsCache[t])return this.fontMetricsCache[t];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(e),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(e,{willReadFrequently:!0});i.font=t;var o=cw.MetricsString+cw.BaselineSymbol,a=Math.ceil(i.measureText(o).width),s=Math.ceil(i.measureText(cw.BaselineSymbol).width),l=cw.HeightMultiplier*s;s=s*cw.BaselineMultiplier|0,r.width=a,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,a,l),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(o,0,s);var u=i.getImageData(0,0,a||1,l||1).data,c=u.length,h=4*a,d=0,f=0,p=!1;for(d=0;d<s;++d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){p=!0;break}if(p)break;f+=h}for(n.ascent=s-d,f=c-h,p=!1,d=l;d>s;--d){for(g=0;g<h;g+=4)if(255!==u[f+g]){p=!0;break}if(p)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[t]=n,n},t.prototype.measureText=function(t,e,n){var r=e.fontSize,i=void 0===r?16:r,o=e.wordWrap,a=void 0!==o&&o,s=e.lineHeight,l=e.lineWidth,u=void 0===l?1:l,c=e.textBaseline,h=void 0===c?"alphabetic":c,d=e.textAlign,f=void 0===d?"start":d,p=e.letterSpacing,g=void 0===p?0:p,v=e.textPath;e.textPathSide,e.textPathStartOffset;var m=e.leading,y=void 0===m?0:m,E=function(t){for(var e=t.fontSize,n=void 0===e?16:e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=t.fontStyle,a=void 0===o?"normal":o,s=t.fontVariant,l=void 0===s?"normal":s,u=t.fontWeight,c=void 0===u?"normal":u,h=I(n)&&"".concat(n,"px")||"16px",d=i.split(","),f=d.length-1;f>=0;f--){var p=d[f].trim();!PT.test(p)&&wT.indexOf(p)<0&&(p='"'.concat(p,'"')),d[f]=p}return"".concat(a," ").concat(l," ").concat(c," ").concat(h," ").concat(d.join(","))}(e),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var b=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);b.font=E,e.isOverflowing=!1;var x=(a?this.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),S=new Array(x.length),M=0;if(!v){for(P=0;P<x.length;P++){var A=b.measureText(x[P]).width+(x[P].length-1)*g;S[P]=A,M=Math.max(M,A)}N=M+u;var R=s||_.fontSize+u,T=Math.max(R,_.fontSize+u)+(x.length-1)*(R+y),w=0;return"middle"===h?w=-T/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?w=-T:"top"!==h&&"hanging"!==h||(w=0),{font:E,width:N,height:T,lines:x,lineWidths:S,lineHeight:R+=y,maxLineWidth:M,fontProperties:_,lineMetrics:S.map((function(t,e){var n=0;return"center"===f||"middle"===f?n-=t/2:"right"!==f&&"end"!==f||(n-=t),new AM(n-u/2,w+e*R,t+u,R)}))}}v.getTotalLength();for(var P=0;P<x.length;P++)var N=b.measureText(x[P]).width+(x[P].length-1)*g},t.prototype.setGraphemeOnPath=function(){},t.prototype.wordWrap=function(t,e,n){var r=this,i=e.wordWrapWidth,o=void 0===i?0:i,a=e.letterSpacing,s=void 0===a?0:a,l=e.maxLines,u=void 0===l?1/0:l,c=e.textOverflow,h=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),d=o+s,f="";"ellipsis"===c?f="...":c&&"clip"!==c&&(f=c);for(var p=[],g=0,v=0,m={},y=function(t){return r.getFromCache(t,s,m,h)},E=Array.from(f).reduce((function(t,e){return t+y(e)}),0),_=Array.from(t),b=0;b<_.length;b++){var x=_[b],S=t[b-1],M=t[b+1],A=y(x);if(this.isNewline(x)){if(++g>=u){e.isOverflowing=!0;break}v=0,p[g]=""}else{if(v>0&&v+A>d){if(g+1>=u){if(e.isOverflowing=!0,E>0&&E<=d){for(var R=p[g].length,T=0,w=R,P=0;P<R;P++){var N=y(p[g][P]);if(T+N+E>d){w=P;break}T+=N}p[g]=(p[g]||"").slice(0,w)+f}break}if(v=0,p[++g]="",this.isBreakingSpace(x))continue;this.canBreakInLastChar(x)||(p=this.trimToBreakable(p),v=this.sumTextWidthByCache(p[g]||"",m)),this.shouldBreakByKinsokuShorui(x,M)&&(p=this.trimByKinsokuShorui(p),v+=y(S||""))}v+=A,p[g]=(p[g]||"")+x}}return p.join("\n")},t.prototype.isBreakingSpace=function(t){return"string"==typeof t&&cw.BreakingSpaces.indexOf(t.charCodeAt(0))>=0},t.prototype.isNewline=function(t){return"string"==typeof t&&cw.Newlines.indexOf(t.charCodeAt(0))>=0},t.prototype.trimToBreakable=function(t){var e=u([],l(t),!1),n=e[e.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return e;var i=n.slice(r,r+1),o=r+1,a=r+(this.isBreakingSpace(i)?0:1);return e[e.length-1]+=n.slice(o,n.length),e[e.length-2]=n.slice(0,a),e},t.prototype.canBreakInLastChar=function(t){return!t||!hw.test(t)},t.prototype.sumTextWidthByCache=function(t,e){return t.split("").reduce((function(t,n){if(!e[n])throw Error("cannot count the word without cache");return t+e[n]}),0)},t.prototype.findBreakableIndex=function(t){for(var e=t.length-1;e>=0;e--)if(!hw.test(t[e]))return e;return-1},t.prototype.getFromCache=function(t,e,n,r){var i=n[t];if("number"!=typeof i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},t}(),gw={},vw=function(){var t,e=new WT,n=new VT;return(t={})[$S.CIRCLE]=new FT,t[$S.ELLIPSE]=new UT,t[$S.RECT]=e,t[$S.IMAGE]=e,t[$S.GROUP]=new HT,t[$S.LINE]=new GT,t[$S.TEXT]=new jT(gw),t[$S.POLYLINE]=n,t[$S.POLYGON]=n,t[$S.PATH]=new zT,t[$S.HTML]=null,t[$S.MESH]=null,t}(),mw=function(){var t,e=new zR,n=new jR;return(t={})[gA.PERCENTAGE]=null,t[gA.NUMBER]=new KR,t[gA.ANGLE]=new UR,t[gA.DEFINED_PATH]=new GR,t[gA.PAINT]=e,t[gA.COLOR]=e,t[gA.FILTER]=new VR,t[gA.LENGTH]=n,t[gA.LENGTH_PERCENTAGE]=n,t[gA.LENGTH_PERCENTAGE_12]=new HR,t[gA.LENGTH_PERCENTAGE_14]=new XR,t[gA.COORDINATE]=new jR,t[gA.OFFSET_DISTANCE]=new $R,t[gA.OPACITY_VALUE]=new qR,t[gA.PATH]=new ZR,t[gA.LIST_OF_POINTS]=new QR,t[gA.SHADOW_BLUR]=new JR,t[gA.TEXT]=new tT,t[gA.TEXT_TRANSFORM]=new eT,t[gA.TRANSFORM]=new DT,t[gA.TRANSFORM_ORIGIN]=new BT,t[gA.Z_INDEX]=new kT,t[gA.MARKER]=new YR,t}();gw.CameraContribution=DM,gw.AnimationTimeline=null,gw.EasingFunction=null,gw.offscreenCanvasCreator=new ew,gw.sceneGraphSelector=new ow,gw.sceneGraphService=new uw(gw),gw.textService=new pw(gw),gw.geometryUpdaterFactory=vw,gw.CSSPropertySyntaxFactory=mw,gw.styleValueRegistry=new FR(gw),gw.layoutRegistry=null,gw.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},gw.enableCSSParsing=!1,gw.enableDataset=!1,gw.enableStyleSyntax=!0,gw.enableAttributeDashCased=!1,gw.enableSizeAttenuation=!1;var yw=0,Ew=new aw(nw.INSERTED,null,"","","",0,"",""),_w=new aw(nw.REMOVED,null,"","","",0,"",""),bw=new ZT(nw.DESTROY),xw=function(t){function e(){var e=t.call(this)||this;return e.entity=yw++,e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.cullable={strategy:nA.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.transformable={dirtyFlag:!1,localDirtyFlag:!1,frozen:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.rBushNode={aabb:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.destroyed=!1,e.style={},e.computedStyle=gw.enableCSSParsing?{opacity:aA,fillOpacity:aA,strokeOpacity:aA,fill:aA,stroke:aA,transform:aA,transformOrigin:aA,visibility:aA,pointerEvents:aA,lineWidth:aA,lineCap:aA,lineJoin:aA,increasedLineWidthForHitTesting:aA,fontSize:aA,fontFamily:aA,fontStyle:aA,fontWeight:aA,fontVariant:aA,textAlign:aA,textBaseline:aA,textTransform:aA,zIndex:aA,filter:aA,shadowType:aA}:null,e.parsedStyle={},e.attributes={},e}return n(e,t),Object.defineProperty(e.prototype,"className",{get:function(){return this.getAttribute("class")||""},set:function(t){this.setAttribute("class",t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classList",{get:function(){return this.className.split(" ").filter((function(t){return""!==t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.nodeName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t+1]||null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t-1]||null}return null},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(t){throw new Error(RM)},e.prototype.appendChild=function(t,e){var n;if(t.destroyed)throw new Error("Cannot append a destroyed element.");return gw.sceneGraphService.attach(t,this,e),(null===(n=this.ownerDocument)||void 0===n?void 0:n.defaultView)&&this.ownerDocument.defaultView.mountChildren(t),this.isMutationObserved&&(Ew.relatedNode=this,t.dispatchEvent(Ew)),t},e.prototype.insertBefore=function(t,e){if(e){t.parentElement&&t.parentElement.removeChild(t);var n=this.childNodes.indexOf(e);-1===n?this.appendChild(t):this.appendChild(t,n)}else this.appendChild(t);return t},e.prototype.replaceChild=function(t,e){var n=this.childNodes.indexOf(e);return this.removeChild(e),this.appendChild(t,n),e},e.prototype.removeChild=function(t){var e;return _w.relatedNode=this,t.dispatchEvent(_w),(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)&&t.ownerDocument.defaultView.unmountChildren(t),gw.sceneGraphService.detach(t),t},e.prototype.removeChildren=function(){for(var t=this.childNodes.length-1;t>=0;t--){var e=this.childNodes[t];this.removeChild(e)}},e.prototype.destroyChildren=function(){for(var t=this.childNodes.length-1;t>=0;t--){var e=this.childNodes[t];e.childNodes.length&&e.destroyChildren(),e.destroy()}},e.prototype.matches=function(t){return gw.sceneGraphService.matches(t,this)},e.prototype.getElementById=function(t){return gw.sceneGraphService.querySelector("#".concat(t),this)},e.prototype.getElementsByName=function(t){return gw.sceneGraphService.querySelectorAll('[name="'.concat(t,'"]'),this)},e.prototype.getElementsByClassName=function(t){return gw.sceneGraphService.querySelectorAll(".".concat(t),this)},e.prototype.getElementsByTagName=function(t){return gw.sceneGraphService.querySelectorAll(t,this)},e.prototype.querySelector=function(t){return gw.sceneGraphService.querySelector(t,this)},e.prototype.querySelectorAll=function(t){return gw.sceneGraphService.querySelectorAll(t,this)},e.prototype.closest=function(t){var e=this;do{if(gw.sceneGraphService.matches(t,e))return e;e=e.parentElement}while(null!==e);return null},e.prototype.find=function(t){var e=this,n=null;return this.forEach((function(r){return!(r===e||!t(r))&&(n=r,!0)})),n},e.prototype.findAll=function(t){var e=this,n=[];return this.forEach((function(r){r!==e&&t(r)&&n.push(r)})),n},e.prototype.after=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this);e.forEach((function(e,n){var i;return null===(i=t.parentNode)||void 0===i?void 0:i.appendChild(e,r+n+1)}))}},e.prototype.before=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this),i=l(e),o=i[0],a=i.slice(1);this.parentNode.appendChild(o,r),(t=o).after.apply(t,u([],l(a),!1))}},e.prototype.replaceWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.after.apply(this,u([],l(t),!1)),this.remove()},e.prototype.append=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){return t.appendChild(e)}))},e.prototype.prepend=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e,n){return t.appendChild(e,n)}))},e.prototype.replaceChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,u([],l(t),!1))},e.prototype.remove=function(){return this.parentNode?this.parentNode.removeChild(this):this},e.prototype.destroy=function(){this.dispatchEvent(bw),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0},e.prototype.getGeometryBounds=function(){return gw.sceneGraphService.getGeometryBounds(this)},e.prototype.getRenderBounds=function(){return gw.sceneGraphService.getBounds(this,!0)},e.prototype.getBounds=function(){return gw.sceneGraphService.getBounds(this)},e.prototype.getLocalBounds=function(){return gw.sceneGraphService.getLocalBounds(this)},e.prototype.getBoundingClientRect=function(){return gw.sceneGraphService.getBoundingClientRect(this)},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.computedStyleMap=function(){return new Map(Object.entries(this.computedStyle))},e.prototype.getAttributeNames=function(){return Object.keys(this.attributes)},e.prototype.getAttribute=function(t){if(function(t){return"symbol"==typeof t}(t))return gw.enableCSSParsing?null:void 0;var e=this.attributes[t];if(void 0===e){if(gw.enableAttributeDashCased){var n=ZM(t);e=this.attributes[n]}return gw.enableCSSParsing&&_(e)?null:e}return e},e.prototype.hasAttribute=function(t){return this.getAttributeNames().includes(t)},e.prototype.hasAttributes=function(){return!!this.getAttributeNames().length},e.prototype.removeAttribute=function(t){this.setAttribute(t,null),delete this.attributes[t]},e.prototype.setAttribute=function(t,e,n,r){this.attributes[t]=e},e.prototype.getAttributeNS=function(t,e){throw new Error(RM)},e.prototype.getAttributeNode=function(t){throw new Error(RM)},e.prototype.getAttributeNodeNS=function(t,e){throw new Error(RM)},e.prototype.hasAttributeNS=function(t,e){throw new Error(RM)},e.prototype.removeAttributeNS=function(t,e){throw new Error(RM)},e.prototype.removeAttributeNode=function(t){throw new Error(RM)},e.prototype.setAttributeNS=function(t,e,n){throw new Error(RM)},e.prototype.setAttributeNode=function(t){throw new Error(RM)},e.prototype.setAttributeNodeNS=function(t){throw new Error(RM)},e.prototype.toggleAttribute=function(t,e){throw new Error(RM)},e}(JT);function Sw(t){return!!(null==t?void 0:t.nodeName)}var Mw,Aw=gw.globalThis.Proxy?gw.globalThis.Proxy:function(){},Rw=new aw(nw.ATTR_MODIFIED,null,null,null,null,aw.MODIFICATION,null,null),Tw={opacity:"",fillOpacity:"",strokeOpacity:"",fill:"",stroke:"",transform:"",transformOrigin:"",visibility:"",pointerEvents:"",lineWidth:"",lineCap:"",lineJoin:"",increasedLineWidthForHitTesting:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",zIndex:"",filter:"",shadowType:""},ww={fill:hA,stroke:hA,transform:[],zIndex:0,filter:[],shadowType:"outer",miterLimit:10},Pw=u(u([],l(["opacity","fillOpacity","strokeOpacity","transformOrigin","visibility","pointerEvents","lineWidth","lineCap","lineJoin","increasedLineWidthForHitTesting"]),!1),["fontSize","fontFamily","fontStyle","fontWeight","fontVariant","textAlign","textBaseline","textTransform"],!1),Nw="data-",Cw=function(t){function e(e){var n=t.call(this)||this;return n.isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=n.config.id||"",n.name=n.config.name||"",(n.config.className||n.config.class)&&(n.className=n.config.className||n.config.class),n.nodeName=n.config.type||$S.GROUP,gw.enableCSSParsing?(Object.assign(n.attributes,Tw),Object.assign(n.parsedStyle,ww,n.config.initialParsedStyle)):n.config.initialParsedStyle&&Object.assign(n.parsedStyle,n.config.initialParsedStyle),n.initAttributes(n.config.style),gw.enableDataset&&(n.dataset=new Aw({},{get:function(t,e){var r="".concat(Nw).concat(KM(e));return void 0!==t[r]?t[r]:n.getAttribute(r)},set:function(t,e,r){return n.setAttribute("".concat(Nw).concat(KM(e)),r),!0}})),gw.enableStyleSyntax&&(n.style=new Aw({setProperty:function(t,e){n.setAttribute(t,e)},getPropertyValue:function(t){return n.getAttribute(t)},removeProperty:function(t){n.removeAttribute(t)},item:function(){return""}},{get:function(t,e){return void 0!==t[e]?t[e]:n.getAttribute(e)},set:function(t,e,r){return n.setAttribute(e,r),!0}})),n}return n(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.getAnimations().forEach((function(t){t.cancel()}))},e.prototype.cloneNode=function(t,e){var n=r({},this.attributes);for(var i in n){var o=n[i];Sw(o)&&"clipPath"!==i&&"offsetPath"!==i&&"textPath"!==i&&(n[i]=o.cloneNode(t)),e&&(n[i]=e(i,o))}var a=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:n});return a.setLocalTransform(this.getLocalTransform()),t&&this.children.forEach((function(e){if(!e.style.isMarker){var n=e.cloneNode(t);a.appendChild(n)}})),a},e.prototype.initAttributes=function(t){void 0===t&&(t={});var e=this.renderable,n={forceUpdateGeometry:!0};gw.enableCSSParsing&&(n.usedAttributes=Pw);var r=t;if(gw.enableAttributeDashCased)for(var i in r={},t){r[ZM(i)]=t[i]}gw.styleValueRegistry.processProperties(this,r,n),e.dirty=!0},e.prototype.setAttribute=function(e,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0),gw.enableAttributeDashCased&&(e=ZM(e)),H(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),t.prototype.setAttribute.call(this,e,n))},e.prototype.internalSetAttribute=function(t,e,n){var r;void 0===n&&(n={});var i=this.renderable,o=this.attributes[t],a=this.parsedStyle[t];gw.styleValueRegistry.processProperties(this,((r={})[t]=e,r),n),i.dirty=!0;var s=this.parsedStyle[t];this.isConnected&&(Rw.relatedNode=this,Rw.prevValue=o,Rw.newValue=e,Rw.attrName=t,Rw.prevParsedValue=a,Rw.newParsedValue=s,this.isMutationObserved?this.dispatchEvent(Rw):(Rw.target=this,this.ownerDocument.defaultView.dispatchEvent(Rw,!0))),(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&this.attributeChangedCallback&&this.attributeChangedCallback(t,o,e,a,s)},e.prototype.getBBox=function(){var t=this.getBounds(),e=l(t.getMin(),2),n=e[0],r=e[1],i=l(t.getMax(),2),o=i[0],a=i[1];return new AM(n,r,o-n,a-r)},e.prototype.setOrigin=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),gw.sceneGraphService.setOrigin(this,oM(t,e,n)),this},e.prototype.getOrigin=function(){return gw.sceneGraphService.getOrigin(this)},e.prototype.setPosition=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),gw.sceneGraphService.setPosition(this,oM(t,e,n)),this},e.prototype.setLocalPosition=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),gw.sceneGraphService.setLocalPosition(this,oM(t,e,n)),this},e.prototype.translate=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),gw.sceneGraphService.translate(this,oM(t,e,n)),this},e.prototype.translateLocal=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),gw.sceneGraphService.translateLocal(this,oM(t,e,n)),this},e.prototype.getPosition=function(){return gw.sceneGraphService.getPosition(this)},e.prototype.getLocalPosition=function(){return gw.sceneGraphService.getLocalPosition(this)},e.prototype.scale=function(t,e,n){return this.scaleLocal(t,e,n)},e.prototype.scaleLocal=function(t,e,n){return"number"==typeof t&&(t=oM(t,e=e||t,n=n||t)),gw.sceneGraphService.scaleLocal(this,t),this},e.prototype.setLocalScale=function(t,e,n){return"number"==typeof t&&(t=oM(t,e=e||t,n=n||t)),gw.sceneGraphService.setLocalScale(this,t),this},e.prototype.getLocalScale=function(){return gw.sceneGraphService.getLocalScale(this)},e.prototype.getScale=function(){return gw.sceneGraphService.getScale(this)},e.prototype.getEulerAngles=function(){return sM(l(lM(Xt(),gw.sceneGraphService.getWorldTransform(this)),3)[2])},e.prototype.getLocalEulerAngles=function(){return sM(l(lM(Xt(),gw.sceneGraphService.getLocalRotation(this)),3)[2])},e.prototype.setEulerAngles=function(t){return gw.sceneGraphService.setEulerAngles(this,0,0,t),this},e.prototype.setLocalEulerAngles=function(t){return gw.sceneGraphService.setLocalEulerAngles(this,0,0,t),this},e.prototype.rotateLocal=function(t,e,n){return _(e)&&_(n)?gw.sceneGraphService.rotateLocal(this,0,0,t):gw.sceneGraphService.rotateLocal(this,t,e,n),this},e.prototype.rotate=function(t,e,n){return _(e)&&_(n)?gw.sceneGraphService.rotate(this,0,0,t):gw.sceneGraphService.rotate(this,t,e,n),this},e.prototype.setRotation=function(t,e,n,r){return gw.sceneGraphService.setRotation(this,t,e,n,r),this},e.prototype.setLocalRotation=function(t,e,n,r){return gw.sceneGraphService.setLocalRotation(this,t,e,n,r),this},e.prototype.setLocalSkew=function(t,e){return gw.sceneGraphService.setLocalSkew(this,t,e),this},e.prototype.getRotation=function(){return gw.sceneGraphService.getRotation(this)},e.prototype.getLocalRotation=function(){return gw.sceneGraphService.getLocalRotation(this)},e.prototype.getLocalSkew=function(){return gw.sceneGraphService.getLocalSkew(this)},e.prototype.getLocalTransform=function(){return gw.sceneGraphService.getLocalTransform(this)},e.prototype.getWorldTransform=function(){return gw.sceneGraphService.getWorldTransform(this)},e.prototype.setLocalTransform=function(t){return gw.sceneGraphService.setLocalTransform(this,t),this},e.prototype.resetLocalTransform=function(){gw.sceneGraphService.resetLocalTransform(this)},e.prototype.getAnimations=function(){return this.activeAnimations},e.prototype.animate=function(t,e){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,t,e):null},e.prototype.isVisible=function(){var t,e;return gw.enableCSSParsing?"visible"===(null===(t=this.parsedStyle)||void 0===t?void 0:t.visibility):"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)},Object.defineProperty(e.prototype,"interactive",{get:function(){return this.isInteractive()},set:function(t){this.style.pointerEvents=t?"auto":"none"},enumerable:!1,configurable:!0}),e.prototype.isInteractive=function(){var t;return"none"!==(null===(t=this.parsedStyle)||void 0===t?void 0:t.pointerEvents)},e.prototype.isCulled=function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)},e.prototype.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,u([],l(this.parentNode.children.map((function(t){return Number(t.style.zIndex)}))),!1))+1),this},e.prototype.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,u([],l(this.parentNode.children.map((function(t){return Number(t.style.zIndex)}))),!1))-1),this},e.prototype.getConfig=function(){return this.config},e.prototype.attr=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=l(e,2),i=r[0],o=r[1];return i?M(i)?(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),this):2===e.length?(this.setAttribute(i,o),this):this.attributes[i]:this.attributes},e.prototype.getMatrix=function(t){var e=t||this.getWorldTransform(),n=l(Ct(Xt(),e),2),r=n[0],i=n[1],o=l(Ot(Xt(),e),2),a=o[0],s=o[1],u=It(de(),e),c=l(lM(Xt(),u),3),h=c[0],d=c[2];return uM(h||d,r,i,a,s)},e.prototype.getLocalMatrix=function(){return this.getMatrix(this.getLocalTransform())},e.prototype.setMatrix=function(t){var e=l(cM(t),5),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4];this.setEulerAngles(a).setPosition(n,r).setLocalScale(i,o)},e.prototype.setLocalMatrix=function(t){var e=l(cM(t),5),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4];this.setLocalEulerAngles(a).setLocalPosition(n,r).setLocalScale(i,o)},e.prototype.show=function(){gw.enableCSSParsing?this.style.visibility="visible":this.forEach((function(t){t.style.visibility="visible"}))},e.prototype.hide=function(){gw.enableCSSParsing?this.style.visibility="hidden":this.forEach((function(t){t.style.visibility="hidden"}))},e.prototype.getCount=function(){return this.childElementCount},e.prototype.getParent=function(){return this.parentElement},e.prototype.getChildren=function(){return this.children},e.prototype.getFirst=function(){return this.firstElementChild},e.prototype.getLast=function(){return this.lastElementChild},e.prototype.getChildByIndex=function(t){return this.children[t]||null},e.prototype.add=function(t,e){return this.appendChild(t,e)},e.prototype.set=function(t,e){this.config[t]=e},e.prototype.get=function(t){return this.config[t]},e.prototype.moveTo=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.setPosition(t,e,n),this},e.prototype.move=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.setPosition(t,e,n),this},e.prototype.setZIndex=function(t){return this.style.zIndex=t,this},e}(xw),Ow=function(t){function e(e){return void 0===e&&(e={}),t.call(this,r({type:$S.CIRCLE},e))||this}return n(e,t),e}(Cw),Iw=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,r({style:(gw.enableCSSParsing,r({},o))},a))||this).isCustomElement=!0,n}return n(e,t),e}(Cw),Lw=function(t){function e(e){return void 0===e&&(e={}),t.call(this,r({type:$S.ELLIPSE},e))||this}return n(e,t),e}(Cw),Dw=function(t){function e(e){return void 0===e&&(e={}),t.call(this,r({type:$S.GROUP},e))||this}return n(e,t),e}(Cw),Bw=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,r({type:$S.HTML,style:gw.enableCSSParsing?r({x:"",y:"",width:"auto",height:"auto",innerHTML:""},o):r({},o)},a))||this).cullable.enable=!1,n}return n(e,t),e.prototype.getDomElement=function(){return this.parsedStyle.$el},e.prototype.getBoundingClientRect=function(){if(this.parsedStyle.$el)return this.parsedStyle.$el.getBoundingClientRect();var t=this.parsedStyle,e=t.x,n=t.y,r=t.width,i=t.height;return new AM(e,n,r,i)},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.getBounds=function(){var t,e,n=this.getBoundingClientRect(),r=null===(e=null===(t=this.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===e?void 0:e.getContextService().getBoundingClientRect(),i=new yM,o=n.left-((null==r?void 0:r.left)||0),a=n.top-((null==r?void 0:r.top)||0);return i.setMinMax([o,a,0],[o+n.width,a+n.height,0]),i},e.prototype.getLocalBounds=function(){if(this.parentNode){var t=mt(ct(),this.parentNode.getWorldTransform()),e=this.getBounds();if(!yM.isEmpty(e)){var n=new yM;return n.setFromTransformedAABB(e,t),n}}return this.getBounds()},e}(Cw),kw=function(t){function e(e){return void 0===e&&(e={}),t.call(this,r({type:$S.IMAGE},e))||this}return n(e,t),e}(Cw),Fw=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);(n=t.call(this,r({type:$S.LINE,style:r({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},o)},a))||this).markerStartAngle=0,n.markerEndAngle=0;var s=n.parsedStyle,l=s.markerStart,u=s.markerEnd;return l&&Sw(l)&&(n.markerStartAngle=l.getLocalEulerAngles(),n.appendChild(l)),u&&Sw(u)&&(n.markerEndAngle=u.getLocalEulerAngles(),n.appendChild(u)),n.transformMarker(!0),n.transformMarker(!1),n}return n(e,t),e.prototype.attributeChangedCallback=function(t,e,n,r,i){"x1"===t||"y1"===t||"x2"===t||"y2"===t||"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(r&&Sw(r)&&(this.markerStartAngle=0,r.remove()),i&&Sw(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===t&&(r&&Sw(r)&&(this.markerEndAngle=0,r.remove()),i&&Sw(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))},e.prototype.transformMarker=function(t){var e=this.parsedStyle,n=e.markerStart,r=e.markerEnd,i=e.markerStartOffset,o=e.markerEndOffset,a=e.x1,s=e.x2,l=e.y1,u=e.y2,c=t?n:r;if(c&&Sw(c)){var h,d,f,p,g,v,m;t?(p=a,g=l,d=s-a,f=u-l,v=i||0,m=this.markerStartAngle):(p=s,g=u,d=a-s,f=l-u,v=o||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(p+Math.cos(h)*v,g+Math.sin(h)*v)}},e.prototype.getPoint=function(t,e){void 0===e&&(e=!1);var n=this.parsedStyle,r=kS(n.x1,n.y1,n.x2,n.y2,t),i=r.x,o=r.y,a=oe(Xt(),$t(i,o,0),e?this.getWorldTransform():this.getLocalTransform());return new MM(a[0],a[1])},e.prototype.getPointAtLength=function(t,e){return void 0===e&&(e=!1),this.getPoint(t/this.getTotalLength(),e)},e.prototype.getTotalLength=function(){var t=this.parsedStyle;return BS(t.x1,t.y1,t.x2,t.y2)},e}(Cw),Uw=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);(n=t.call(this,r({type:$S.PATH,style:gw.enableCSSParsing?r({d:"",miterLimit:""},o):r({},o),initialParsedStyle:gw.enableCSSParsing?null:{miterLimit:4,d:r({},vA)}},a))||this).markerStartAngle=0,n.markerEndAngle=0,n.markerMidList=[];var s=n.parsedStyle,l=s.markerStart,u=s.markerEnd,c=s.markerMid;return l&&Sw(l)&&(n.markerStartAngle=l.getLocalEulerAngles(),n.appendChild(l)),c&&Sw(c)&&n.placeMarkerMid(c),u&&Sw(u)&&(n.markerEndAngle=u.getLocalEulerAngles(),n.appendChild(u)),n.transformMarker(!0),n.transformMarker(!1),n}return n(e,t),e.prototype.attributeChangedCallback=function(t,e,n,r,i){"d"===t?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(r&&Sw(r)&&(this.markerStartAngle=0,r.remove()),i&&Sw(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===t?(r&&Sw(r)&&(this.markerEndAngle=0,r.remove()),i&&Sw(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===t&&this.placeMarkerMid(i)},e.prototype.transformMarker=function(t){var e=this.parsedStyle,n=e.markerStart,r=e.markerEnd,i=e.markerStartOffset,o=e.markerEndOffset,a=t?n:r;if(a&&Sw(a)){var s,u,c,h,d,f,p;if(t){var g=l(this.getStartTangent(),2),v=g[0];h=(m=g[1])[0],d=m[1],u=v[0]-m[0],c=v[1]-m[1],f=i||0,p=this.markerStartAngle}else{var m,y=l(this.getEndTangent(),2);v=y[0];h=(m=y[1])[0],d=m[1],u=v[0]-m[0],c=v[1]-m[1],f=o||0,p=this.markerEndAngle}s=Math.atan2(c,u),a.setLocalEulerAngles(180*s/Math.PI+p),a.setLocalPosition(h+Math.cos(s)*f,d+Math.sin(s)*f)}},e.prototype.placeMarkerMid=function(t){var e=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(t){t.remove()})),t&&Sw(t))for(var n=1;n<e.length-1;n++){var r=l(e[n].currentPoint,2),i=r[0],o=r[1],a=1===n?t:t.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(i,o)}},e.prototype.getTotalLength=function(){return ZA(this)},e.prototype.getPointAtLength=function(t,e){void 0===e&&(e=!1);var n=function(t,e,n){return Je(t,e,r(r({},n),{bbox:!1,length:!0})).point}(this.parsedStyle.d.absolutePath,t),i=n.x,o=n.y,a=oe(Xt(),$t(i,o,0),e?this.getWorldTransform():this.getLocalTransform());return new MM(a[0],a[1])},e.prototype.getPoint=function(t,e){return void 0===e&&(e=!1),this.getPointAtLength(t*ZA(this),e)},e.prototype.getStartTangent=function(){var t=this.parsedStyle.d.segments,e=[];if(t.length>1){var n=t[0].currentPoint,r=t[1].currentPoint,i=t[1].startTangent;e=[],i?(e.push([n[0]-i[0],n[1]-i[1]]),e.push([n[0],n[1]])):(e.push([r[0],r[1]]),e.push([n[0],n[1]]))}return e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.d.segments,e=t.length,n=[];if(e>1){var r=t[e-2].currentPoint,i=t[e-1].currentPoint,o=t[e-1].endTangent;n=[],o?(n.push([i[0]-o[0],i[1]-o[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n},e}(Cw),Gw=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);(n=t.call(this,r({type:$S.POLYGON,style:gw.enableCSSParsing?r({points:"",miterLimit:"",isClosed:!0},o):r({},o),initialParsedStyle:gw.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},a))||this).markerStartAngle=0,n.markerEndAngle=0,n.markerMidList=[];var s=n.parsedStyle,l=s.markerStart,u=s.markerEnd,c=s.markerMid;return l&&Sw(l)&&(n.markerStartAngle=l.getLocalEulerAngles(),n.appendChild(l)),c&&Sw(c)&&n.placeMarkerMid(c),u&&Sw(u)&&(n.markerEndAngle=u.getLocalEulerAngles(),n.appendChild(u)),n.transformMarker(!0),n.transformMarker(!1),n}return n(e,t),e.prototype.attributeChangedCallback=function(t,e,n,r,i){"points"===t?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(r&&Sw(r)&&(this.markerStartAngle=0,r.remove()),i&&Sw(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===t?(r&&Sw(r)&&(this.markerEndAngle=0,r.remove()),i&&Sw(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===t&&this.placeMarkerMid(i)},e.prototype.transformMarker=function(t){var e=this.parsedStyle,n=e.markerStart,r=e.markerEnd,i=e.markerStartOffset,o=e.markerEndOffset,a=(e.points||{}).points,s=t?n:r;if(s&&Sw(s)&&a){var l,u,c,h,d,f,p;if(h=a[0][0],d=a[0][1],t)u=a[1][0]-a[0][0],c=a[1][1]-a[0][1],f=i||0,p=this.markerStartAngle;else{var g=a.length;this.parsedStyle.isClosed?(u=a[g-1][0]-a[0][0],c=a[g-1][1]-a[0][1]):(h=a[g-1][0],d=a[g-1][1],u=a[g-2][0]-a[g-1][0],c=a[g-2][1]-a[g-1][1]),f=o||0,p=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+p),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}},e.prototype.placeMarkerMid=function(t){var e=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(t){t.remove()})),this.markerMidList=[],t&&Sw(t)&&e)for(var n=1;n<(this.parsedStyle.isClosed?e.length:e.length-1);n++){var r=e[n][0],i=e[n][1],o=1===n?t:t.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(r,i)}},e}(Cw),zw=function(t){function e(e){void 0===e&&(e={});var n=e.style,o=i(e,["style"]);return t.call(this,r({type:$S.POLYLINE,style:gw.enableCSSParsing?r({points:"",miterLimit:"",isClosed:!1},n):r({},n),initialParsedStyle:gw.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},o))||this}return n(e,t),e.prototype.getTotalLength=function(){return 0===(t=this).parsedStyle.points.totalLength&&(t.parsedStyle.points.totalLength=WS(t.parsedStyle.points.points)),t.parsedStyle.points.totalLength;var t},e.prototype.getPointAtLength=function(t,e){return void 0===e&&(e=!1),this.getPoint(t/this.getTotalLength(),e)},e.prototype.getPoint=function(t,e){void 0===e&&(e=!1);var n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,o=[],a=0,s=this.getTotalLength();n.forEach((function(t,e){n[e+1]&&((r=[0,0])[0]=a/s,i=BS(t[0],t[1],n[e+1][0],n[e+1][1]),a+=i,r[1]=a/s,o.push(r))})),this.parsedStyle.points.segments=o}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(e,n){t>=e[0]&&t<=e[1]&&(l=(t-e[0])/(e[1]-e[0]),u=n)}));var c=kS(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,f=oe(Xt(),$t(h,d,0),e?this.getWorldTransform():this.getLocalTransform());return new MM(f[0],f[1])},e.prototype.getStartTangent=function(){var t=this.parsedStyle.points.points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.points.points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},e}(Gw),Vw=function(t){function e(e){return void 0===e&&(e={}),t.call(this,r({type:$S.RECT},e))||this}return n(e,t),e}(Cw),Ww=function(t){function e(e){void 0===e&&(e={});var n=e.style,o=i(e,["style"]);return t.call(this,r({type:$S.TEXT,style:gw.enableCSSParsing?r({x:"",y:"",text:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",fill:"black",letterSpacing:"",lineHeight:"",miterLimit:"",wordWrap:!1,wordWrapWidth:0,leading:0,dx:"",dy:""},n):r({fill:"black"},n)},o))||this}return n(e,t),e.prototype.getComputedTextLength=function(){var t;return this.getGeometryBounds(),(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.maxLineWidth)||0},e.prototype.getLineBoundingRects=function(){var t;return this.getGeometryBounds(),(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.lineMetrics)||[]},e.prototype.isOverflowing=function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing},e}(Cw),jw=function(){function t(){this.registry={},this.define($S.CIRCLE,Ow),this.define($S.ELLIPSE,Lw),this.define($S.RECT,Vw),this.define($S.IMAGE,kw),this.define($S.LINE,Fw),this.define($S.GROUP,Dw),this.define($S.PATH,Uw),this.define($S.POLYGON,Gw),this.define($S.POLYLINE,zw),this.define($S.TEXT,Ww),this.define($S.HTML,Bw)}return t.prototype.define=function(t,e){this.registry[t]=e},t.prototype.get=function(t){return this.registry[t]},t}(),Hw=function(t){function e(){var e=t.call(this)||this;e.defaultView=null,e.ownerDocument=null,e.nodeName="document";try{e.timeline=new gw.AnimationTimeline(e)}catch(t){}var n={};return LR.forEach((function(t){var e=t.n,r=t.inh,i=t.d;r&&i&&(n[e]=$M(i)?i($S.GROUP):i)})),e.documentElement=new Dw({id:"g-root",style:n}),e.documentElement.ownerDocument=e,e.documentElement.parentNode=e,e.childNodes=[e.documentElement],e}return n(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),e.prototype.createElement=function(t,e){if("svg"===t)return this.documentElement;var n=this.defaultView.customElements.get(t);n||(console.warn("Unsupported tagName: ",t),n="tspan"===t?Ww:Dw);var r=new n(e);return r.ownerDocument=this,r},e.prototype.createElementNS=function(t,e,n){return this.createElement(e,n)},e.prototype.cloneNode=function(t){throw new Error(RM)},e.prototype.destroy=function(){try{this.documentElement.destroyChildren(),this.timeline.destroy()}catch(t){}},e.prototype.elementsFromBBox=function(t,e,n,r){var i=this.defaultView.context.rBushRoot.search({minX:t,minY:e,maxX:n,maxY:r}),o=[];return i.forEach((function(t){var e=t.displayObject,n=e.parsedStyle.pointerEvents,r=["auto","visiblepainted","visiblefill","visiblestroke","visible"].includes(void 0===n?"auto":n);(!r||r&&e.isVisible())&&!e.isCulled()&&e.isInteractive()&&o.push(e)})),o.sort((function(t,e){return e.sortable.renderOrder-t.sortable.renderOrder})),o},e.prototype.elementFromPointSync=function(t,e){var n=this.defaultView.canvas2Viewport({x:t,y:e}),r=n.x,i=n.y,o=this.defaultView.getConfig(),a=o.width,s=o.height;if(r<0||i<0||r>a||i>s)return null;var l=this.defaultView.viewport2Client({x:r,y:i}),u=l.x,c=l.y,h=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!0,position:{x:t,y:e,viewportX:r,viewportY:i,clientX:u,clientY:c},picked:[]}).picked;return h&&h[0]||this.documentElement},e.prototype.elementFromPoint=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,s,l,u,c,h,d;return a(this,(function(a){switch(a.label){case 0:return n=this.defaultView.canvas2Viewport({x:t,y:e}),r=n.x,i=n.y,o=this.defaultView.getConfig(),s=o.width,l=o.height,r<0||i<0||r>s||i>l?[2,null]:(u=this.defaultView.viewport2Client({x:r,y:i}),c=u.x,h=u.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!0,position:{x:t,y:e,viewportX:r,viewportY:i,clientX:c,clientY:h},picked:[]})]);case 1:return[2,(d=a.sent().picked)&&d[0]||this.documentElement]}}))}))},e.prototype.elementsFromPointSync=function(t,e){var n=this.defaultView.canvas2Viewport({x:t,y:e}),r=n.x,i=n.y,o=this.defaultView.getConfig(),a=o.width,s=o.height;if(r<0||i<0||r>a||i>s)return[];var l=this.defaultView.viewport2Client({x:r,y:i}),u=l.x,c=l.y,h=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!1,position:{x:t,y:e,viewportX:r,viewportY:i,clientX:u,clientY:c},picked:[]}).picked;return h[h.length-1]!==this.documentElement&&h.push(this.documentElement),h},e.prototype.elementsFromPoint=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,s,l,u,c,h,d;return a(this,(function(a){switch(a.label){case 0:return n=this.defaultView.canvas2Viewport({x:t,y:e}),r=n.x,i=n.y,o=this.defaultView.getConfig(),s=o.width,l=o.height,r<0||i<0||r>s||i>l?[2,[]]:(u=this.defaultView.viewport2Client({x:r,y:i}),c=u.x,h=u.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!1,position:{x:t,y:e,viewportX:r,viewportY:i,clientX:c,clientY:h},picked:[]})]);case 1:return(d=a.sent().picked)[d.length-1]!==this.documentElement&&d.push(this.documentElement),[2,d]}}))}))},e.prototype.appendChild=function(t,e){throw new Error(TM)},e.prototype.insertBefore=function(t,e){throw new Error(TM)},e.prototype.removeChild=function(t,e){throw new Error(TM)},e.prototype.replaceChild=function(t,e,n){throw new Error(TM)},e.prototype.append=function(){throw new Error(TM)},e.prototype.prepend=function(){throw new Error(TM)},e.prototype.getElementById=function(t){return this.documentElement.getElementById(t)},e.prototype.getElementsByName=function(t){return this.documentElement.getElementsByName(t)},e.prototype.getElementsByTagName=function(t){return this.documentElement.getElementsByTagName(t)},e.prototype.getElementsByClassName=function(t){return this.documentElement.getElementsByClassName(t)},e.prototype.querySelector=function(t){return this.documentElement.querySelector(t)},e.prototype.querySelectorAll=function(t){return this.documentElement.querySelectorAll(t)},e.prototype.find=function(t){return this.documentElement.find(t)},e.prototype.findAll=function(t){return this.documentElement.findAll(t)},e}(JT),Xw=function(){function t(t){this.strategies=t}return t.prototype.apply=function(e){var n=e.camera,r=e.renderingService,i=e.renderingContext,o=this.strategies;r.hooks.cull.tap(t.tag,(function(t){if(t){var e=t.cullable;return 0===o.length?e.visible=i.unculledEntities.indexOf(t.entity)>-1:e.visible=o.every((function(e){return e.isVisible(n,t)})),!t.isCulled()&&t.isVisible()?t:(t.dispatchEvent(new ZT(nw.CULLED)),null)}return t})),r.hooks.afterRender.tap(t.tag,(function(t){t.cullable.visibilityPlaneMask=-1}))},t.tag="Culling",t}(),Yw=function(){function t(){var t=this;this.autoPreventDefault=!1,this.rootPointerEvent=new $T(null),this.rootWheelEvent=new qT(null),this.onPointerMove=function(e){var n,r,i,o,a=null===(o=null===(i=t.context.renderingContext.root)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.defaultView;if(!a.supportsTouchEvents||"touch"!==e.pointerType){var l=t.normalizeToPointerEvent(e,a);try{for(var u=s(l),c=u.next();!c.done;c=u.next()){var h=c.value,d=t.bootstrapEvent(t.rootPointerEvent,h,a,e);t.context.eventService.mapEvent(d)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i,o,a=null===(o=null===(i=t.context.renderingContext.root)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.defaultView,l=t.normalizeToPointerEvent(e,a);try{for(var u=s(l),c=u.next();!c.done;c=u.next()){var h=c.value,d=t.bootstrapEvent(t.rootPointerEvent,h,a,e);t.context.eventService.mapEvent(d)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}t.setCursor(t.context.eventService.cursor)}}return t.prototype.apply=function(e){var n=this;this.context=e;var r=e.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(t){return n.context.renderingService.hooks.pickSync.call({position:t,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(t.tag,(function(t){var e=n.normalizeWheelEvent(t);n.context.eventService.mapEvent(e)})),r.hooks.pointerDown.tap(t.tag,(function(t){var e,r;if(!i.supportsTouchEvents||"touch"!==t.pointerType){var o=n.normalizeToPointerEvent(t,i);if(n.autoPreventDefault&&o[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();try{for(var a=s(o),l=a.next();!l.done;l=a.next()){var u=l.value,c=n.bootstrapEvent(n.rootPointerEvent,u,i,t);n.context.eventService.mapEvent(c)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(t.tag,(function(t){var e,r;if(!i.supportsTouchEvents||"touch"!==t.pointerType){var o=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(o,t)?"":"outside",l=n.normalizeToPointerEvent(t,i);try{for(var u=s(l),c=u.next();!c.done;c=u.next()){var h=c.value,d=n.bootstrapEvent(n.rootPointerEvent,h,i,t);d.type+=a,n.context.eventService.mapEvent(d)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(t.tag,this.onPointerMove),r.hooks.pointerOver.tap(t.tag,this.onPointerMove),r.hooks.pointerOut.tap(t.tag,this.onPointerMove),r.hooks.click.tap(t.tag,this.onClick),r.hooks.pointerCancel.tap(t.tag,(function(t){var e,r,o=n.normalizeToPointerEvent(t,i);try{for(var a=s(o),l=a.next();!l.done;l=a.next()){var u=l.value,c=n.bootstrapEvent(n.rootPointerEvent,u,i,t);n.context.eventService.mapEvent(c)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}n.setCursor(n.context.eventService.cursor)}))},t.prototype.bootstrapEvent=function(t,e,n,r){t.view=n,t.originalEvent=null,t.nativeEvent=r,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);var i=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),o=i.x,a=i.y;t.viewport.x=o,t.viewport.y=a;var s=this.context.eventService.viewport2Canvas(t.viewport),l=s.x,u=s.y;return t.canvas.x=l,t.canvas.y=u,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=r.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=cT[t.type]||t.type),t},t.prototype.normalizeWheelEvent=function(t){var e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;var n=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),r=n.x,i=n.y;e.viewport.x=r,e.viewport.y=i;var o=this.context.eventService.viewport2Canvas(e.viewport),a=o.x,s=o.y;return e.canvas.x=a,e.canvas.y=s,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.nativeEvent=t,e.type=t.type,e},t.prototype.transferMouseData=function(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=hT.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null},t.prototype.setCursor=function(t){this.context.contextService.applyCursorStyle(t||this.context.config.cursor||"default")},t.prototype.normalizeToPointerEvent=function(t,e){var n=[];if(e.isTouchEvent(t))for(var r=0;r<t.changedTouches.length;r++){var i=t.changedTouches[r];H(i.button)&&(i.button=0),H(i.buttons)&&(i.buttons=1),H(i.isPrimary)&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),H(i.width)&&(i.width=i.radiusX||1),H(i.height)&&(i.height=i.radiusY||1),H(i.tiltX)&&(i.tiltX=0),H(i.tiltY)&&(i.tiltY=0),H(i.pointerType)&&(i.pointerType="touch"),H(i.pointerId)&&(i.pointerId=i.identifier||0),H(i.pressure)&&(i.pressure=i.force||.5),H(i.twist)&&(i.twist=0),H(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=t.type,n.push(i)}else if(e.isMouseEvent(t)){var o=t;H(o.isPrimary)&&(o.isPrimary=!0),H(o.width)&&(o.width=1),H(o.height)&&(o.height=1),H(o.tiltX)&&(o.tiltX=0),H(o.tiltY)&&(o.tiltY=0),H(o.pointerType)&&(o.pointerType="mouse"),H(o.pointerId)&&(o.pointerId=1),H(o.pressure)&&(o.pressure=.5),H(o.twist)&&(o.twist=0),H(o.tangentialPressure)&&(o.tangentialPressure=0),o.isNormalized=!0,n.push(o)}else n.push(t);return n},t.tag="Event",t}(),Kw=[$S.CIRCLE,$S.ELLIPSE,$S.IMAGE,$S.RECT,$S.LINE,$S.POLYLINE,$S.POLYGON,$S.TEXT,$S.PATH,$S.HTML],$w=function(){function t(){}return t.prototype.isVisible=function(t,e){var n,r,i=e.cullable;if(!i.enable)return!0;var o=e.getRenderBounds();if(yM.isEmpty(o))return!1;var a=t.getFrustum(),s=null===(r=null===(n=e.parentNode)||void 0===n?void 0:n.cullable)||void 0===r?void 0:r.visibilityPlaneMask;return i.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(e,o,s||mM.INDETERMINATE,a.planes),i.visible=i.visibilityPlaneMask!==mM.OUTSIDE,i.visible},t.prototype.computeVisibilityWithPlaneMask=function(t,e,n,r){if(n===mM.OUTSIDE||n===mM.INSIDE)return n;for(var i=mM.INSIDE,o=Kw.indexOf(t.nodeName)>-1,a=0,s=r.length;a<s;++a){var l=1<<a;if(n&l&&(!o||4!==a&&5!==a)){var u=r[a],c=u.normal,h=u.distance;if(ne(c,e.getPositiveFarPoint(r[a]))+h<0)return mM.OUTSIDE;ne(c,e.getNegativeFarPoint(r[a]))+h<0&&(i|=l)}}return i},t}(),qw=function(){function t(){this.toSync=new Set,this.isFirstTimeRendering=!0,this.syncing=!1,this.isFirstTimeRenderingFinished=!1}return t.prototype.apply=function(e){var n,r=this,i=e.renderingService,o=e.renderingContext,a=e.rBushRoot,s=o.root.ownerDocument.defaultView;this.rBush=a;var l=function(t){t.target.renderable.dirty=!0,i.dirtify()},u=function(t){var e=t.detail.affectChildren,n=t.target;e&&n.forEach((function(t){r.toSync.add(t)}));for(var o=n;o;)o.renderable&&r.toSync.add(o),o=o.parentElement;i.dirtify()},c=function(t){var e=t.target;gw.enableSizeAttenuation&&gw.styleValueRegistry.updateSizeAttenuation(e,s.getCamera().getZoom()),gw.enableCSSParsing&&gw.styleValueRegistry.recalc(e),gw.sceneGraphService.dirtifyToRoot(e),i.dirtify()},h=function(t){var e=t.target,n=e.rBushNode;n.aabb&&r.rBush.remove(n.aabb),r.toSync.delete(e),gw.sceneGraphService.dirtifyToRoot(e),i.dirtify()};i.hooks.init.tap(t.tag,(function(){s.addEventListener(nw.MOUNTED,c),s.addEventListener(nw.UNMOUNTED,h),s.addEventListener(nw.ATTR_MODIFIED,l),s.addEventListener(nw.BOUNDS_CHANGED,u)})),i.hooks.destroy.tap(t.tag,(function(){s.removeEventListener(nw.MOUNTED,c),s.removeEventListener(nw.UNMOUNTED,h),s.removeEventListener(nw.ATTR_MODIFIED,l),s.removeEventListener(nw.BOUNDS_CHANGED,u),r.toSync.clear()}));var d=null!==(n=gw.globalThis.requestIdleCallback)&&void 0!==n?n:xT.bind(gw.globalThis);i.hooks.endFrame.tap(t.tag,(function(){r.isFirstTimeRendering?(r.isFirstTimeRendering=!1,r.syncing=!0,d((function(){r.syncRTree(!0),r.isFirstTimeRenderingFinished=!0}))):r.syncRTree()}))},t.prototype.syncRTree=function(t){var e=this;if(void 0===t&&(t=!1),t||!this.syncing&&0!==this.toSync.size){this.syncing=!0;var n=[];Array.from(this.toSync).filter((function(t){return t.isConnected})).forEach((function(r){var i=r.rBushNode;i&&i.aabb&&e.rBush.remove(i.aabb);var o=r.getRenderBounds();if(o){var a=r.renderable;t&&(a.dirtyRenderBounds||(a.dirtyRenderBounds=new yM),a.dirtyRenderBounds.update(o.center,o.halfExtents));var s=l(o.getMin(),2),u=s[0],c=s[1],h=l(o.getMax(),2),d=h[0],f=h[1];i.aabb||(i.aabb={}),i.aabb.displayObject=r,i.aabb.minX=u,i.aabb.minY=c,i.aabb.maxX=d,i.aabb.maxY=f}i.aabb&&(isNaN(i.aabb.maxX)||isNaN(i.aabb.maxX)||isNaN(i.aabb.minX)||isNaN(i.aabb.minY)||n.push(i.aabb))})),this.rBush.load(n),n.length=0,this.toSync.clear(),this.syncing=!1}},t.tag="Prepare",t}();!function(t){t.READY="ready",t.BEFORE_RENDER="beforerender",t.RERENDER="rerender",t.AFTER_RENDER="afterrender",t.BEFORE_DESTROY="beforedestroy",t.AFTER_DESTROY="afterdestroy",t.RESIZE="resize",t.DIRTY_RECTANGLE="dirtyrectangle",t.RENDERER_CHANGED="rendererchanged"}(Mw||(Mw={}));var Zw=new ZT(nw.MOUNTED),Qw=new ZT(nw.UNMOUNTED),Jw=new ZT(Mw.BEFORE_RENDER),tP=new ZT(Mw.RERENDER),eP=new ZT(Mw.AFTER_RENDER),nP=function(t){function e(e){var n=t.call(this)||this;n.Element=Cw,n.inited=!1,n.context={},n.document=new Hw,n.document.defaultView=n,n.customElements=new jw;var r=e.container,i=e.canvas,o=e.offscreenCanvas,a=e.width,s=e.height,l=e.devicePixelRatio,u=e.renderer,c=e.background,h=e.cursor,d=e.document,f=e.requestAnimationFrame,p=e.cancelAnimationFrame,g=e.createImage,v=e.supportsPointerEvents,m=e.supportsTouchEvents,y=e.supportsCSSTransform,E=e.supportsMutipleCanvasesInOneContainer,_=e.useNativeClickEvent,b=e.alwaysTriggerPointerEventOnCanvas,x=e.isTouchEvent,S=e.isMouseEvent;E||function(t,e){if(t){var n="string"==typeof t?t:t.id||rT++;nT[n]&&nT[n].destroy(),nT[n]=e}}(r,n);var M=a,A=s,R=l;return i&&(R=(R=l||iT&&window.devicePixelRatio||1)>=1?Math.ceil(R):1,M=a||function(t){var e=uT(t,"width");return"auto"===e?t.offsetWidth:parseFloat(e)}(i)||i.width/R,A=s||function(t){var e=uT(t,"height");return"auto"===e?t.offsetHeight:parseFloat(e)}(i)||i.height/R),o&&(gw.offscreenCanvas=o),n.devicePixelRatio=R,n.requestAnimationFrame=null!=f?f:xT.bind(gw.globalThis),n.cancelAnimationFrame=null!=p?p:ST.bind(gw.globalThis),n.supportsTouchEvents=null!=m?m:"ontouchstart"in gw.globalThis,n.supportsPointerEvents=null!=v?v:!!gw.globalThis.PointerEvent,n.isTouchEvent=null!=x?x:function(t){return n.supportsTouchEvents&&t instanceof gw.globalThis.TouchEvent},n.isMouseEvent=null!=S?S:function(t){return!gw.globalThis.MouseEvent||t instanceof gw.globalThis.MouseEvent&&(!n.supportsPointerEvents||!(t instanceof gw.globalThis.PointerEvent))},n.initRenderingContext({container:r,canvas:i,width:M,height:A,renderer:u,offscreenCanvas:o,devicePixelRatio:R,cursor:h||"default",background:c||"transparent",createImage:g,document:d,supportsCSSTransform:y,useNativeClickEvent:_,alwaysTriggerPointerEventOnCanvas:b}),n.initDefaultCamera(M,A,u.clipSpaceNearZ),n.initRenderer(u,!0),n}return n(e,t),e.prototype.initRenderingContext=function(t){this.context.config=t,this.context.renderingContext={root:this.document.documentElement,renderListCurrentFrame:[],unculledEntities:[],renderReasons:new Set,force:!1,dirty:!1}},e.prototype.initDefaultCamera=function(t,e,n){var r=this,i=new gw.CameraContribution;i.clipSpaceNearZ=n,i.setType(_M.EXPLORING,bM.DEFAULT).setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0).setOrthographic(t/-2,t/2,e/2,e/-2,.1,1e3),i.canvas=this,i.eventEmitter.on(IM,(function(){r.context.renderingContext.renderReasons.add(XT.CAMERA_CHANGED),gw.enableSizeAttenuation&&r.getConfig().renderer.getConfig().enableSizeAttenuation&&r.updateSizeAttenuation()})),this.context.camera=i},e.prototype.updateSizeAttenuation=function(){var t=this.getCamera().getZoom();this.document.documentElement.forEach((function(e){gw.styleValueRegistry.updateSizeAttenuation(e,t)}))},e.prototype.getConfig=function(){return this.context.config},e.prototype.getRoot=function(){return this.document.documentElement},e.prototype.getCamera=function(){return this.context.camera},e.prototype.getContextService=function(){return this.context.contextService},e.prototype.getEventService=function(){return this.context.eventService},e.prototype.getRenderingService=function(){return this.context.renderingService},e.prototype.getRenderingContext=function(){return this.context.renderingContext},e.prototype.getStats=function(){return this.getRenderingService().getStats()},Object.defineProperty(e.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(this.readyPromise=new Promise((function(e){t.resolveReadyPromise=function(){e(t)}})),this.inited&&this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),e.prototype.destroy=function(t,e){(void 0===t&&(t=!0),void 0===e&&(e=!1),e||this.dispatchEvent(new ZT(Mw.BEFORE_DESTROY)),this.frameId)&&(this.getConfig().cancelAnimationFrame||cancelAnimationFrame)(this.frameId);var n=this.getRoot();this.unmountChildren(n),t&&(this.document.destroy(),this.getEventService().destroy()),this.getRenderingService().destroy(),this.getContextService().destroy(),t&&this.context.rBushRoot&&(this.context.rBushRoot.clear(),this.context.rBushRoot=null,this.context.renderingContext.root=null),e||this.dispatchEvent(new ZT(Mw.AFTER_DESTROY))},e.prototype.changeSize=function(t,e){this.resize(t,e)},e.prototype.resize=function(t,e){var n=this.context.config;n.width=t,n.height=e,this.getContextService().resize(t,e);var r=this.context.camera,i=r.getProjectionMode();r.setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0),i===xM.ORTHOGRAPHIC?r.setOrthographic(t/-2,t/2,e/2,e/-2,r.getNear(),r.getFar()):r.setAspect(t/e),this.dispatchEvent(new ZT(Mw.RESIZE,{width:t,height:e}))},e.prototype.appendChild=function(t,e){return this.document.documentElement.appendChild(t,e)},e.prototype.insertBefore=function(t,e){return this.document.documentElement.insertBefore(t,e)},e.prototype.removeChild=function(t){return this.document.documentElement.removeChild(t)},e.prototype.removeChildren=function(){this.document.documentElement.removeChildren()},e.prototype.destroyChildren=function(){this.document.documentElement.destroyChildren()},e.prototype.render=function(t){var e=this;this.dispatchEvent(Jw),this.getRenderingService().render(this.getConfig(),t,(function(){e.dispatchEvent(tP)})),this.dispatchEvent(eP)},e.prototype.run=function(){var t=this,e=function(n,r){t.render(r),t.frameId=t.requestAnimationFrame(e)};e()},e.prototype.initRenderer=function(t,e){var n=this;if(void 0===e&&(e=!1),!t)throw new Error("Renderer is required.");this.inited=!1,this.readyPromise=void 0,this.context.rBushRoot=new ZS,this.context.renderingPlugins=[],this.context.renderingPlugins.push(new Yw,new qw,new Xw([new $w])),this.loadRendererContainerModule(t),this.context.contextService=new this.context.ContextService(r(r({},gw),this.context)),this.context.renderingService=new rw(gw,this.context),this.context.eventService=new tw(gw,this.context),this.context.eventService.init(),this.context.contextService.init?(this.context.contextService.init(),this.initRenderingService(t,e,!0)):this.context.contextService.initAsync().then((function(){n.initRenderingService(t,e)}))},e.prototype.initRenderingService=function(t,e,n){var r=this;void 0===e&&(e=!1),void 0===n&&(n=!1),this.context.renderingService.init((function(){r.inited=!0,e?(n?r.requestAnimationFrame((function(){r.dispatchEvent(new ZT(Mw.READY))})):r.dispatchEvent(new ZT(Mw.READY)),r.readyPromise&&r.resolveReadyPromise()):r.dispatchEvent(new ZT(Mw.RENDERER_CHANGED)),e||r.getRoot().forEach((function(t){var e=t.renderable;e&&(e.renderBoundsDirty=!0,e.boundsDirty=!0,e.dirty=!0)})),r.mountChildren(r.getRoot()),t.getConfig().enableAutoRendering&&r.run()}))},e.prototype.loadRendererContainerModule=function(t){var e=this;t.getPlugins().forEach((function(t){t.context=e.context,t.init(gw)}))},e.prototype.setRenderer=function(t){var e=this.getConfig();if(e.renderer!==t){var n=e.renderer;e.renderer=t,this.destroy(!1,!0),u([],l(null==n?void 0:n.getPlugins()),!1).reverse().forEach((function(t){t.destroy(gw)})),this.initRenderer(t)}},e.prototype.setCursor=function(t){this.getConfig().cursor=t,this.getContextService().applyCursorStyle(t)},e.prototype.unmountChildren=function(t){var e=this;t.childNodes.forEach((function(t){e.unmountChildren(t)})),this.inited&&(t.isMutationObserved?t.dispatchEvent(Qw):(Qw.target=t,this.dispatchEvent(Qw,!0)),t!==this.document.documentElement&&(t.ownerDocument=null),t.isConnected=!1),t.isCustomElement&&t.disconnectedCallback&&t.disconnectedCallback()},e.prototype.mountChildren=function(t){var e=this;this.inited?t.isConnected||(t.ownerDocument=this.document,t.isConnected=!0,t.isMutationObserved?t.dispatchEvent(Zw):(Zw.target=t,this.dispatchEvent(Zw,!0))):console.warn("[g]: You are trying to call `canvas.appendChild` before canvas' initialization finished. You can either await `canvas.ready` or listen to `CanvasEvent.READY` manually.","appended child: ",t.nodeName),t.childNodes.forEach((function(t){e.mountChildren(t)})),t.isCustomElement&&t.connectedCallback&&t.connectedCallback()},e.prototype.client2Viewport=function(t){return this.getEventService().client2Viewport(t)},e.prototype.viewport2Client=function(t){return this.getEventService().viewport2Client(t)},e.prototype.viewport2Canvas=function(t){return this.getEventService().viewport2Canvas(t)},e.prototype.canvas2Viewport=function(t){return this.getEventService().canvas2Viewport(t)},e.prototype.getPointByClient=function(t,e){return this.client2Viewport({x:t,y:e})},e.prototype.getClientByPoint=function(t,e){return this.viewport2Client({x:t,y:e})},e}(QT),rP=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.landmarks=[],e}return n(e,t),e.prototype.rotate=function(t,e,n){if(this.relElevation=iM(e),this.relAzimuth=iM(t),this.relRoll=iM(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===_M.EXPLORING){var r=fe(de(),[1,0,0],aM((this.rotateWorld?1:-1)*this.relElevation)),i=fe(de(),[0,1,0],aM((this.rotateWorld?1:-1)*this.relAzimuth)),o=fe(de(),[0,0,1],aM(this.relRoll)),a=pe(de(),i,r);a=pe(de(),a,o);var s=Dt(ct(),a);_t(this.matrix,this.matrix,[0,0,-this.distance]),Et(this.matrix,this.matrix,s),_t(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===_M.ORBITING||this.type===_M.EXPLORING?this._getPosition():this.type===_M.TRACKING&&this._getFocalPoint(),this._update(),this},e.prototype.pan=function(t,e){var n=oM(t,e,0),r=Yt(this.position);return Qt(r,r,te(Xt(),this.right,n[0])),Qt(r,r,te(Xt(),this.up,n[1])),this._setPosition(r),this.triggerUpdate(),this},e.prototype.dolly=function(t){var e=this.forward,n=Yt(this.position),r=this.dollyingStep,i=this.distance+t*this.dollyingStep;return r=Math.max(Math.min(i,this.maxDistance),this.minDistance)-this.distance,n[0]+=r*e[0],n[1]+=r*e[1],n[2]+=r*e[2],this._setPosition(n),this.type===_M.ORBITING||this.type===_M.EXPLORING?this._getDistance():this.type===_M.TRACKING&&Qt(this.focalPoint,n,this.distanceVector),this.triggerUpdate(),this},e.prototype.cancelLandmarkAnimation=function(){void 0!==this.landmarkAnimationID&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},e.prototype.createLandmark=function(t,e){var n,r,i,o;void 0===e&&(e={});var a=e.position,s=void 0===a?this.position:a,l=e.focalPoint,u=void 0===l?this.focalPoint:l,c=e.roll,h=e.zoom,d=new gw.CameraContribution;d.setType(this.type,void 0),d.setPosition(s[0],null!==(n=s[1])&&void 0!==n?n:this.position[1],null!==(r=s[2])&&void 0!==r?r:this.position[2]),d.setFocalPoint(u[0],null!==(i=u[1])&&void 0!==i?i:this.focalPoint[1],null!==(o=u[2])&&void 0!==o?o:this.focalPoint[2]),d.setRoll(null!=c?c:this.roll),d.setZoom(null!=h?h:this.zoom);var f={name:t,matrix:ht(d.getWorldTransform()),right:Yt(d.right),up:Yt(d.up),forward:Yt(d.forward),position:Yt(d.getPosition()),focalPoint:Yt(d.getFocalPoint()),distanceVector:Yt(d.getDistanceVector()),distance:d.getDistance(),dollyingStep:d.getDollyingStep(),azimuth:d.getAzimuth(),elevation:d.getElevation(),roll:d.getRoll(),relAzimuth:d.relAzimuth,relElevation:d.relElevation,relRoll:d.relRoll,zoom:d.getZoom()};return this.landmarks.push(f),f},e.prototype.gotoLandmark=function(t,e){var n=this;void 0===e&&(e={});var r=N(t)?this.landmarks.find((function(e){return e.name===t})):t;if(r){var i=I(e)?{duration:e}:e,o=i.easing,a=void 0===o?"linear":o,s=i.duration,l=void 0===s?100:s,u=i.easingFunction,c=void 0===u?void 0:u,h=i.onfinish,d=void 0===h?void 0:h,f=i.onframe,p=void 0===f?void 0:f;if(0===l)return this.syncFromLandmark(r),void(d&&d());this.cancelLandmarkAnimation();var g,v=r.position,m=r.focalPoint,y=r.zoom,E=r.roll,_=c||gw.EasingFunction(a),b=function(){n.setFocalPoint(m),n.setPosition(v),n.setRoll(E),n.setZoom(y),n.computeMatrix(),n.triggerUpdate(),d&&d()},x=function(t){void 0===g&&(g=t);var e=t-g;if(e>l)b();else{var r,i,o=_(e/l),a=Xt(),s=Xt();ie(a,n.focalPoint,m,o),ie(s,n.position,v,o),i=n.roll*(1-o)+E*o,r=n.zoom*(1-o)+y*o,n.setFocalPoint(a),n.setPosition(s),n.setRoll(i),n.setZoom(r),le(a,m)+le(s,v)<=.01&&null==y&&null==E?b():(n.computeMatrix(),n.triggerUpdate(),e<l&&(p&&p(o),n.landmarkAnimationID=n.canvas.requestAnimationFrame(x)))}};this.canvas.requestAnimationFrame(x)}},e.prototype.syncFromLandmark=function(t){this.matrix=dt(this.matrix,t.matrix),this.right=qt(this.right,t.right),this.up=qt(this.up,t.up),this.forward=qt(this.forward,t.forward),this.position=qt(this.position,t.position),this.focalPoint=qt(this.focalPoint,t.focalPoint),this.distanceVector=qt(this.distanceVector,t.distanceVector),this.azimuth=t.azimuth,this.elevation=t.elevation,this.roll=t.roll,this.relAzimuth=t.relAzimuth,this.relElevation=t.relElevation,this.relRoll=t.relRoll,this.dollyingStep=t.dollyingStep,this.distance=t.distance,this.zoom=t.zoom},e}(DM);gw.CameraContribution=rP;var iP=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.currentTime=r,o.timelineTime=i,o.target=n,o.type="finish",o.bubbles=!1,o.currentTarget=n,o.defaultPrevented=!1,o.eventPhase=o.AT_TARGET,o.timeStamp=Date.now(),o.currentTime=r,o.timelineTime=i,o}return n(e,t),e}(YT),oP=0,aP=function(){function t(t,e){var n;this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._playbackRate=1,this._inTimeline=!0,this.effect=t,t.animation=this,this.timeline=e,this.id="".concat(oP++),this._inEffect=!!this.effect.update(0),this._totalDuration=Number(null===(n=this.effect)||void 0===n?void 0:n.getComputedTiming().endTime),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}return Object.defineProperty(t.prototype,"pending",{get:function(){return null===this._startTime&&!this._paused&&0!==this.playbackRate||this.currentTimePending},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playState",{get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise((function(e,n){t.resolveReadyPromise=function(){e(t)},t.rejectReadyPromise=function(){n(new Error)}})),this.pending||this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"finished",{get:function(){var t=this;return this.finishedPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise((function(e,n){t.resolveFinishedPromise=function(){e(t)},t.rejectFinishedPromise=function(){n(new Error)}})),"finished"===this.playState&&this.resolveFinishedPromise()),this.finishedPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(t){var e;t=Number(t),isNaN(t)||(this.timeline.restart(),this._paused||null===this._startTime||(this._startTime=Number(null===(e=this.timeline)||void 0===e?void 0:e.currentTime)-t/this.playbackRate),this.currentTimePending=!1,this._currentTime!==t&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(t,!0),this.timeline.applyDirtiedAnimation(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){if(null!==t){if(this.updatePromises(),t=Number(t),isNaN(t))return;if(this._paused||this._idle)return;this._startTime=t,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){if(t!==this._playbackRate){this.updatePromises();var e=this.currentTime;this._playbackRate=t,this.startTime=null,"paused"!==this.playState&&"idle"!==this.playState&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),null!==e&&(this.currentTime=e),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isFinished",{get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this._totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){return this._totalDuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_needsTick",{get:function(){return this.pending||"running"===this.playState||!this._finishedFlag},enumerable:!1,configurable:!0}),t.prototype.updatePromises=function(){var t=this.oldPlayState,e=this.pending?"pending":this.playState;return this.readyPromise&&e!==t&&("idle"===e?(this.rejectReadyPromise(),this.readyPromise=void 0):"pending"===t?this.resolveReadyPromise():"pending"===e&&(this.readyPromise=void 0)),this.finishedPromise&&e!==t&&("idle"===e?(this.rejectFinishedPromise(),this.finishedPromise=void 0):"finished"===e?this.resolveFinishedPromise():"finished"===t&&(this.finishedPromise=void 0)),this.oldPlayState=e,this.readyPromise||this.finishedPromise},t.prototype.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),-1===this.timeline.animations.indexOf(this)&&this.timeline.animations.push(this),this.updatePromises()},t.prototype.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._isFinished||this._paused||this._idle?this._idle&&(this.rewind(),this._idle=!1):this.currentTimePending=!0,this._startTime=null,this._paused=!0,this.updatePromises()},t.prototype.finish=function(){this.updatePromises(),this._idle||(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},t.prototype.cancel=function(){var t=this;if(this.updatePromises(),this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises(),this.oncancel)){var e=new iP(null,this,this.currentTime,null);setTimeout((function(){t.oncancel(e)}))}},t.prototype.reverse=function(){this.updatePromises();var t=this.currentTime;this.playbackRate*=-1,this.play(),null!==t&&(this.currentTime=t),this.updatePromises()},t.prototype.updatePlaybackRate=function(t){this.playbackRate=t},t.prototype.targetAnimations=function(){var t;return(null===(t=this.effect)||void 0===t?void 0:t.target).getAnimations()},t.prototype.markTarget=function(){var t=this.targetAnimations();-1===t.indexOf(this)&&t.push(this)},t.prototype.unmarkTarget=function(){var t=this.targetAnimations(),e=t.indexOf(this);-1!==e&&t.splice(e,1)},t.prototype.tick=function(t,e){this._idle||this._paused||(null===this._startTime?e&&(this.startTime=t-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((t-this._startTime)*this.playbackRate)),e&&(this.currentTimePending=!1,this.fireEvents(t))},t.prototype.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else{if(!(this._totalDuration<1/0))throw new Error("Unable to rewind negative playback rate animation with infinite duration");this.currentTime=this._totalDuration}},t.prototype.persist=function(){throw new Error(RM)},t.prototype.addEventListener=function(t,e,n){throw new Error(RM)},t.prototype.removeEventListener=function(t,e,n){throw new Error(RM)},t.prototype.dispatchEvent=function(t){throw new Error(RM)},t.prototype.commitStyles=function(){throw new Error(RM)},t.prototype.ensureAlive=function(){var t,e;this.playbackRate<0&&0===this.currentTime?this._inEffect=!!(null===(t=this.effect)||void 0===t?void 0:t.update(-1)):this._inEffect=!!(null===(e=this.effect)||void 0===e?void 0:e.update(this.currentTime)),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,this.timeline.animations.push(this))},t.prototype.tickCurrentTime=function(t,e){t!==this._currentTime&&(this._currentTime=t,this._isFinished&&!e&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this.ensureAlive())},t.prototype.fireEvents=function(t){var e=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var n=new iP(null,this,this.currentTime,t);setTimeout((function(){e.onfinish&&e.onfinish(n)}))}this._finishedFlag=!0}}else{if(this.onframe&&"running"===this.playState){var r=new iP(null,this,this.currentTime,t);this.onframe(r)}this._finishedFlag=!1}},t}(),sP=.1,lP="function"==typeof Float32Array,uP=function(t,e){return 1-3*e+3*t},cP=function(t,e){return 3*e-6*t},hP=function(t){return 3*t},dP=function(t,e,n){return((uP(e,n)*t+cP(e,n))*t+hP(e))*t},fP=function(t,e,n){return 3*uP(e,n)*t*t+2*cP(e,n)*t+hP(e)},pP=function(t,e,n,r){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===r)return function(t){return t};for(var i=lP?new Float32Array(11):new Array(11),o=0;o<11;++o)i[o]=dP(o*sP,t,n);var a=function(e){for(var r=0,o=1;10!==o&&i[o]<=e;++o)r+=sP;--o;var a=r+(e-i[o])/(i[o+1]-i[o])*sP,s=fP(a,t,n);return s>=.001?function(t,e,n,r){for(var i=0;i<4;++i){var o=fP(e,n,r);if(0===o)return e;e-=(dP(e,n,r)-t)/o}return e}(e,a,t,n):0===s?a:function(t,e,n,r,i){var o,a,s=0;do{(o=dP(a=e+(n-e)/2,r,i)-t)>0?n=a:e=a}while(Math.abs(o)>1e-7&&++s<10);return a}(e,r,r+sP,t,n)};return function(t){return 0===t||1===t?t:dP(a(t),e,r)}},gP=function(t){return Math.pow(t,2)},vP=function(t){return Math.pow(t,3)},mP=function(t){return Math.pow(t,4)},yP=function(t){return Math.pow(t,5)},EP=function(t){return Math.pow(t,6)},_P=function(t){return 1-Math.cos(t*Math.PI/2)},bP=function(t){return 1-Math.sqrt(1-t*t)},xP=function(t){return t*t*(3*t-2)},SP=function(t){for(var e,n=4;t<((e=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*e-2)/22-t,2)},MP=function(t,e){void 0===e&&(e=[]);var n=l(e,2),r=n[0],i=void 0===r?1:r,o=n[1],a=void 0===o?.5:o,s=O(Number(i),1,10),u=O(Number(a),.1,2);return 0===t||1===t?t:-s*Math.pow(2,10*(t-1))*Math.sin((t-1-u/(2*Math.PI)*Math.asin(1/s))*(2*Math.PI)/u)},AP=function(t,e,n){void 0===e&&(e=[]);var r=l(e,4),i=r[0],o=void 0===i?1:i,a=r[1],s=void 0===a?100:a,u=r[2],c=void 0===u?10:u,h=r[3],d=void 0===h?0:h;o=O(o,.1,1e3),s=O(s,.1,1e3),c=O(c,.1,1e3),d=O(d,.1,1e3);var f=Math.sqrt(s/o),p=c/(2*Math.sqrt(s*o)),g=p<1?f*Math.sqrt(1-p*p):0,v=p<1?(p*f-d)/g:-d+f,m=n?n*t/1e3:t;return m=p<1?Math.exp(-m*p*f)*(1*Math.cos(g*m)+v*Math.sin(g*m)):(1+v*m)*Math.exp(-m*f),0===t||1===t?t:1-m},RP=function(t,e){void 0===e&&(e=[]);var n=l(e,2),r=n[0],i=void 0===r?10:r;return("start"==n[1]?Math.ceil:Math.floor)(O(t,0,1)*i)/i},TP=function(t,e){void 0===e&&(e=[]);var n=l(e,4),r=n[0],i=n[1],o=n[2],a=n[3];return pP(r,i,o,a)(t)},wP=pP(.42,0,1,1),PP=function(t){return function(e,n,r){return void 0===n&&(n=[]),1-t(1-e,n,r)}},NP=function(t){return function(e,n,r){return void 0===n&&(n=[]),e<.5?t(2*e,n,r)/2:1-t(-2*e+2,n,r)/2}},CP=function(t){return function(e,n,r){return void 0===n&&(n=[]),e<.5?(1-t(1-2*e,n,r))/2:(t(2*e-1,n,r)+1)/2}},OP={steps:RP,"step-start":function(t){return RP(t,[1,"start"])},"step-end":function(t){return RP(t,[1,"end"])},linear:function(t){return t},"cubic-bezier":TP,ease:function(t){return TP(t,[.25,.1,.25,1])},in:wP,out:PP(wP),"in-out":NP(wP),"out-in":CP(wP),"in-quad":gP,"out-quad":PP(gP),"in-out-quad":NP(gP),"out-in-quad":CP(gP),"in-cubic":vP,"out-cubic":PP(vP),"in-out-cubic":NP(vP),"out-in-cubic":CP(vP),"in-quart":mP,"out-quart":PP(mP),"in-out-quart":NP(mP),"out-in-quart":CP(mP),"in-quint":yP,"out-quint":PP(yP),"in-out-quint":NP(yP),"out-in-quint":CP(yP),"in-expo":EP,"out-expo":PP(EP),"in-out-expo":NP(EP),"out-in-expo":CP(EP),"in-sine":_P,"out-sine":PP(_P),"in-out-sine":NP(_P),"out-in-sine":CP(_P),"in-circ":bP,"out-circ":PP(bP),"in-out-circ":NP(bP),"out-in-circ":CP(bP),"in-back":xP,"out-back":PP(xP),"in-out-back":NP(xP),"out-in-back":CP(xP),"in-bounce":SP,"out-bounce":PP(SP),"in-out-bounce":NP(SP),"out-in-bounce":CP(SP),"in-elastic":MP,"out-elastic":PP(MP),"in-out-elastic":NP(MP),"out-in-elastic":CP(MP),spring:AP,"spring-in":AP,"spring-out":PP(AP),"spring-in-out":NP(AP),"spring-out-in":CP(AP)},IP=function(t){return OP[function(t){return function(t){return"-"===(t=t.replace(/([A-Z])/g,(function(t){return"-".concat(t.toLowerCase())}))).charAt(0)?t.substring(1):t}(t).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim()}(t)]||OP.linear},LP=function(t){return t},DP=1,BP=.5,kP=0;function FP(t,e){return function(n){if(n>=1)return 1;var r=1/t;return(n+=e*r)-n%r}}var UP="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",GP=new RegExp("cubic-bezier\\("+UP+","+UP+","+UP+","+UP+"\\)"),zP=/steps\(\s*(\d+)\s*\)/,VP=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function WP(t){var e=GP.exec(t);if(e)return pP.apply(void 0,u([],l(e.slice(1).map(Number)),!1));var n=zP.exec(t);if(n)return FP(Number(n[1]),kP);var r=VP.exec(t);return r?FP(Number(r[1]),{start:DP,middle:BP,end:kP}[r[2]]):IP(t)}function jP(t){return Math.abs(function(t){var e;if(0===t.duration||0===t.iterations)return 0;return("auto"===t.duration?0:Number(t.duration))*(null!==(e=t.iterations)&&void 0!==e?e:1)}(t)/(t.playbackRate||1))}var HP=0,XP=1,YP=2,KP=3;function $P(t,e,n){var r=function(t,e,n){if(null===e)return HP;var r=n.endTime;return e<Math.min(n.delay,r)?XP:e>=Math.min(n.delay+t+n.endDelay,r)?YP:KP}(t,e,n),i=function(t,e,n,r,i){switch(r){case XP:return"backwards"===e||"both"===e?0:null;case KP:return n-i;case YP:return"forwards"===e||"both"===e?t:null;case HP:return null}}(t,n.fill,e,r,n.delay);if(null===i)return null;var o="auto"===n.duration?0:n.duration,a=function(t,e,n,r,i){var o=i;return 0===t?e!==XP&&(o+=n):o+=r/t,o}(o,r,n.iterations,i,n.iterationStart),s=function(t,e,n,r,i,o){var a=t===1/0?e%1:t%1;return 0!==a||n!==YP||0===r||0===i&&0!==o||(a=1),a}(a,n.iterationStart,r,n.iterations,i,o),l=function(t,e,n,r){return t===YP&&e===1/0?1/0:1===n?Math.floor(r)-1:Math.floor(r)}(r,n.iterations,s,a),u=function(t,e,n){var r=t;if("normal"!==t&&"reverse"!==t){var i=e;"alternate-reverse"===t&&(i+=1),r="normal",i!==1/0&&i%2!=0&&(r="reverse")}return"normal"===r?n:1-n}(n.direction,l,s);return n.currentIteration=l,n.progress=u,n.easingFunction(u)}function qP(t,e,n){var r=function(t,e){for(var n={},r=0;r<t.length;r++)for(var i in t[r])if(ZP(i)){var o={offset:t[r].offset,computedOffset:t[r].computedOffset,easing:t[r].easing,easingFunction:WP(t[r].easing)||e.easingFunction,value:t[r][i]};n[i]=n[i]||[],n[i].push(o)}return n}(t,e),i=function(t,e){var n=[];for(var r in t)for(var i=t[r],o=0;o<i.length-1;o++){var a=o,s=o+1,l=i[a].computedOffset,u=i[s].computedOffset,c=l,h=u;0===o&&(c=-1/0,0===u&&(s=a)),o===i.length-2&&(h=1/0,1===l&&(a=s)),n.push({applyFrom:c,applyTo:h,startOffset:i[a].computedOffset,endOffset:i[s].computedOffset,easingFunction:i[a].easingFunction,property:r,interpolation:JP(r,i[a].value,i[s].value,e)})}return n.sort((function(t,e){return t.startOffset-e.startOffset})),n}(r,n);return function(t,e){if(null!==e)i.filter((function(t){return e>=t.applyFrom&&e<t.applyTo})).forEach((function(n){var r=e-n.startOffset,i=n.endOffset-n.startOffset,o=0===i?0:r/i;t.setAttribute(n.property,n.interpolation(o),!1,!1)}));else for(var n in r)ZP(n)&&t.setAttribute(n,null)}}function ZP(t){return"offset"!==t&&"easing"!==t&&"composite"!==t&&"computedOffset"!==t}var QP=function(t,e,n){return function(r){var i=tN(t,e,r);return!gw.enableCSSParsing&&I(i)?i:n(i)}};function JP(t,e,n,r){var i=BR[t];if(i&&i.syntax&&i.int){var o=gw.styleValueRegistry.getPropertySyntax(i.syntax);if(o){var a=void 0,s=void 0;if(gw.enableCSSParsing){var c=gw.styleValueRegistry.parseProperty(t,e,r,!1),h=gw.styleValueRegistry.parseProperty(t,n,r,!1);a=gw.styleValueRegistry.computeProperty(t,c,r,!1),s=gw.styleValueRegistry.computeProperty(t,h,r,!1)}else{var d=o.parserWithCSSDisabled;a=d?d(e,r):e,s=d?d(n,r):n}var f=o.mixer(a,s,r);if(f){var p=QP.apply(void 0,u([],l(f),!1));return function(t){return 0===t?e:1===t?n:p(t)}}}}return QP(!1,!0,(function(t){return t?n:e}))}function tN(t,e,n){if("number"==typeof t&&"number"==typeof e)return t*(1-n)+e*n;if("boolean"==typeof t&&"boolean"==typeof e||"string"==typeof t&&"string"==typeof e)return n<.5?t:e;if(Array.isArray(t)&&Array.isArray(e)){for(var r=t.length,i=e.length,o=Math.max(r,i),a=[],s=0;s<o;s++)a.push(tN(t[s<r?s:r-1],e[s<i?s:i-1],n));return a}throw new Error("Mismatched interpolation arguments "+t+":"+e)}var eN=function(){function t(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=LP,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.currentIteration=null,this.progress=null}return Object.defineProperty(t.prototype,"easing",{get:function(){return this._easing},set:function(t){this.easingFunction=WP(t),this._easing=t},enumerable:!1,configurable:!0}),t}();function nN(t,e){if(null===t)return[];Array.isArray(t)||(t=function(t){var e=[];for(var n in t)if(!(n in["easing","offset","composite"])){var r=t[n];Array.isArray(r)||(r=[r]);for(var i=r.length,o=0;o<i;o++){if(!e[o]){var a={};"offset"in t&&(a.offset=Number(t.offset)),"easing"in t&&(a.easing=t.easing),"composite"in t&&(a.composite=t.composite),e[o]=a}void 0!==r[o]&&null!==r[o]&&(e[o][n]=r[o])}}return e.sort((function(t,e){return(t.computedOffset||0)-(e.computedOffset||0)})),e}(t));for(var n=t.map((function(t){var n={};for(var r in(null==e?void 0:e.composite)&&(n.composite="auto"),t){var i=t[r];if("offset"===r){if(null!==i){if(i=Number(i),!isFinite(i))throw new Error("Keyframe offsets must be numbers.");if(i<0||i>1)throw new Error("Keyframe offsets must be between 0 and 1.");n.computedOffset=i}}else if("composite"===r&&-1===["replace","add","accumulate","auto"].indexOf(i))throw new Error("".concat(i," compositing is not supported"));n[r]=i}return void 0===n.offset&&(n.offset=null),void 0===n.easing&&(n.easing=(null==e?void 0:e.easing)||"linear"),void 0===n.composite&&(n.composite="auto"),n})),r=!0,i=-1/0,o=0;o<n.length;o++){var a=n[o].offset;if(_(a))r=!1;else{if(a<i)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");i=a}}return n=n.filter((function(t){return Number(t.offset)>=0&&Number(t.offset)<=1})),r||function(){var t,e,r=n.length;n[r-1].computedOffset=Number(null!==(t=n[r-1].offset)&&void 0!==t?t:1),r>1&&(n[0].computedOffset=Number(null!==(e=n[0].offset)&&void 0!==e?e:0));for(var i=0,o=Number(n[0].computedOffset),a=1;a<r;a++){var s=n[a].computedOffset;if(!_(s)&&!_(o)){for(var l=1;l<a-i;l++)n[i+l].computedOffset=o+(Number(s)-o)*l/(a-i);i=a,o=Number(s)}}}(),n}var rN="backwards|forwards|both|none".split("|"),iN="reverse|alternate|alternate-reverse".split("|");function oN(t,e){return function(t,e){var n=new eN;return"number"!=typeof t||isNaN(t)?void 0!==t&&Object.keys(t).forEach((function(e){if(void 0!==t[e]&&null!==t[e]&&"auto"!==t[e]){if(("number"==typeof n[e]||"duration"===e)&&("number"!=typeof t[e]||isNaN(t[e])))return;if("fill"===e&&-1===rN.indexOf(t[e]))return;if("direction"===e&&-1===iN.indexOf(t[e]))return;n[e]=t[e]}})):n.duration=t,n}(t=function(t){"number"==typeof t&&(t=isNaN(t)?{duration:"auto"}:{duration:t});return t}(null!=t?t:{duration:"auto"}))}var aN=function(){function t(t,e,n){var r=this;this.composite="replace",this.iterationComposite="replace",this.target=t,this.timing=oN(n),this.timing.effect=this,this.timing.activeDuration=jP(this.timing),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=nN(e,this.timing),this.interpolations=qP(this.normalizedKeyframes,this.timing,this.target);var i=gw.globalThis.Proxy;this.computedTiming=i?new i(this.timing,{get:function(t,e){return"duration"===e?"auto"===t.duration?0:t.duration:"fill"===e?"auto"===t.fill?"none":t.fill:"localTime"===e?r.animation&&r.animation.currentTime||null:"currentIteration"===e?r.animation&&"running"===r.animation.playState?t.currentIteration||0:null:"progress"===e?r.animation&&"running"===r.animation.playState?t.progress||0:null:t[e]},set:function(){return!0}}):this.timing}return t.prototype.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},t.prototype.update=function(t){return null!==t&&(this.timeFraction=$P(this.timing.activeDuration,t,this.timing),null!==this.timeFraction)},t.prototype.getKeyframes=function(){return this.normalizedKeyframes},t.prototype.setKeyframes=function(t){this.normalizedKeyframes=nN(t)},t.prototype.getComputedTiming=function(){return this.computedTiming},t.prototype.getTiming=function(){return this.timing},t.prototype.updateTiming=function(t){var e=this;Object.keys(t||{}).forEach((function(n){e.timing[n]=t[n]}))},t}();function sN(t,e){return Number(t.id)-Number(e.id)}var lN,uN,cN,hN,dN,fN,pN,gN,vN,mN=function(){function t(t){var e=this;this.document=t,this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.webAnimationsNextTick=function(t){e.currentTime=t,e.discardAnimations(),0===e.animations.length?e.timelineTicking=!1:e.requestAnimationFrame(e.webAnimationsNextTick)},this.processRafCallbacks=function(t){var n=e.rafCallbacks;e.rafCallbacks=[],t<Number(e.currentTime)&&(t=Number(e.currentTime)),e.animations.sort(sN),e.animations=e.tick(t,!0,e.animations)[0],n.forEach((function(e){e[1](t)})),e.applyPendingEffects()}}return t.prototype.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},t.prototype.isTicking=function(){return this.inTick},t.prototype.play=function(t,e,n){var r=new aN(t,e,n),i=new aP(r,this);return this.animations.push(i),this.restartWebAnimationsNextTick(),i.updatePromises(),i.play(),i.updatePromises(),i},t.prototype.applyDirtiedAnimation=function(t){var e=this;if(!this.inTick){t.markTarget();var n=t.targetAnimations();n.sort(sN),this.tick(Number(this.currentTime),!1,n.slice())[1].forEach((function(t){var n=e.animations.indexOf(t);-1!==n&&e.animations.splice(n,1)})),this.applyPendingEffects()}},t.prototype.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame((function(){})),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},t.prototype.destroy=function(){this.document.defaultView.cancelAnimationFrame(this.frameId)},t.prototype.applyPendingEffects=function(){this.pendingEffects.forEach((function(t){null==t||t.applyInterpolations()})),this.pendingEffects=[]},t.prototype.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter((function(t){return t.updatePromises()}))},t.prototype.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter((function(t){return"finished"!==t.playState&&"idle"!==t.playState}))},t.prototype.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},t.prototype.rAF=function(t){var e=this.rafId++;return 0===this.rafCallbacks.length&&(this.frameId=this.document.defaultView.requestAnimationFrame(this.processRafCallbacks)),this.rafCallbacks.push([e,t]),e},t.prototype.requestAnimationFrame=function(t){var e=this;return this.rAF((function(n){e.updateAnimationsPromises(),t(n),e.updateAnimationsPromises()}))},t.prototype.tick=function(t,e,n){var r,i,o=this;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=t,this.ticking=!1;var a=[],s=[],c=[],h=[];return n.forEach((function(n){n.tick(t,e),n._inEffect?(s.push(n.effect),n.markTarget()):(a.push(n.effect),n.unmarkTarget()),n._needsTick&&(o.ticking=!0);var r=n._inEffect||n._needsTick;n._inTimeline=r,r?c.push(n):h.push(n)})),(r=this.pendingEffects).push.apply(r,u([],l(a),!1)),(i=this.pendingEffects).push.apply(i,u([],l(s),!1)),this.ticking&&this.requestAnimationFrame((function(){})),this.inTick=!1,[c,h]},t}();gw.EasingFunction=WP,gw.AnimationTimeline=mN,function(t){t.NodeAdded="NodeAdded",t.NodeUpdated="NodeUpdated",t.NodeRemoved="NodeRemoved",t.EdgeAdded="EdgeAdded",t.EdgeUpdated="EdgeUpdated",t.EdgeRemoved="EdgeRemoved",t.ComboAdded="ComboAdded",t.ComboUpdated="ComboUpdated",t.ComboRemoved="ComboRemoved"}(lN||(lN={})),function(t){t.DRAW="draw",t.COLLAPSE="collapse",t.EXPAND="expand",t.TRANSFORM="transform"}(uN||(uN={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.POINTER_OVER="pointerover",t.POINTER_LEAVE="pointerleave",t.POINTER_ENTER="pointerenter",t.POINTER_MOVE="pointermove",t.POINTER_OUT="pointerout",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.CONTEXT_MENU="contextmenu",t.DRAG_START="dragstart",t.DRAG="drag",t.DRAG_END="dragend",t.DRAG_ENTER="dragenter",t.DRAG_OVER="dragover",t.DRAG_LEAVE="dragleave",t.DROP="drop",t.WHEEL="wheel"}(cN||(cN={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.POINTER_OVER="pointerover",t.POINTER_LEAVE="pointerleave",t.POINTER_ENTER="pointerenter",t.POINTER_MOVE="pointermove",t.POINTER_OUT="pointerout",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.CONTEXT_MENU="contextmenu",t.DRAG_START="dragstart",t.DRAG="drag",t.DRAG_END="dragend",t.DRAG_ENTER="dragenter",t.DRAG_OVER="dragover",t.DRAG_LEAVE="dragleave",t.DROP="drop"}(hN||(hN={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.POINTER_OVER="pointerover",t.POINTER_LEAVE="pointerleave",t.POINTER_ENTER="pointerenter",t.POINTER_MOVE="pointermove",t.POINTER_OUT="pointerout",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.CONTEXT_MENU="contextmenu",t.DRAG_START="dragstart",t.DRAG="drag",t.DRAG_END="dragend",t.DRAG_ENTER="dragenter",t.DRAG_OVER="dragover",t.DRAG_LEAVE="dragleave",t.DROP="drop",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.WHEEL="wheel"}(dN||(dN={})),function(t){t.KEY_DOWN="keydown",t.KEY_UP="keyup"}(fN||(fN={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.POINTER_OVER="pointerover",t.POINTER_LEAVE="pointerleave",t.POINTER_ENTER="pointerenter",t.POINTER_MOVE="pointermove",t.POINTER_OUT="pointerout",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.CONTEXT_MENU="contextmenu",t.DRAG_ENTER="dragenter",t.DRAG_OVER="dragover",t.DRAG_LEAVE="dragleave",t.DROP="drop"}(pN||(pN={})),function(t){t.BEFORE_CANVAS_INIT="beforecanvasinit",t.AFTER_CANVAS_INIT="aftercanvasinit",t.BEFORE_SIZE_CHANGE="beforesizechange",t.AFTER_SIZE_CHANGE="aftersizechange",t.BEFORE_ELEMENT_CREATE="beforeelementcreate",t.AFTER_ELEMENT_CREATE="afterelementcreate",t.BEFORE_ELEMENT_UPDATE="beforeelementupdate",t.AFTER_ELEMENT_UPDATE="afterelementupdate",t.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",t.AFTER_ELEMENT_DESTROY="afterelementdestroy",t.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",t.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",t.BEFORE_DRAW="beforedraw",t.AFTER_DRAW="afterdraw",t.BEFORE_RENDER="beforerender",t.AFTER_RENDER="afterrender",t.BEFORE_ANIMATE="beforeanimate",t.AFTER_ANIMATE="afteranimate",t.BEFORE_LAYOUT="beforelayout",t.AFTER_LAYOUT="afterlayout",t.BEFORE_TRANSFORM="beforetransform",t.AFTER_TRANSFORM="aftertransform",t.BATCH_START="batchstart",t.BATCH_END="batchend",t.BEFORE_DESTROY="beforedestroy",t.AFTER_DESTROY="afterdestroy"}(gN||(gN={})),function(t){t.UNDO="undo",t.REDO="redo",t.CANCEL="cancel",t.ADD="add",t.CLEAR="clear",t.CHANGE="change"}(vN||(vN={}));const yN="combo";var EN;function _N(t){const e=t.reduce(((t,e)=>(Object.entries(e).forEach((([e,n])=>{void 0===t[e]?t[e]=[n]:t[e].push(n)})),t)),{});return Object.entries(e).forEach((([n,r])=>{(r.length!==t.length||r.some((t=>_(t)))||r.every((t=>!["sourceNode","targetNode","childrenNode"].includes(n)&&Q(t,r[0]))))&&delete e[n]})),Object.entries(e).reduce(((t,[e,n])=>(n.forEach(((n,r)=>{t[r]?t[r][e]=n:t[r]={[e]:n}})),t)),[])}function bN(t){switch(t){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function xN(t){if(void 0!==t.id)return t.id;if(void 0!==t.source&&void 0!==t.target)return`${t.source}-${t.target}`;throw new Error("The data does not have available id.")}function SN(t,e){const n={nodes:(t.nodes||[]).map(xN),edges:(t.edges||[]).map(xN),combos:(t.combos||[]).map(xN)};return e?Object.values(n).flat():n}!function(t){t.NODE="node",t.EDGE="edge",t.COMBO="combo",t.THEME="theme",t.PALETTE="palette",t.LAYOUT="layout",t.BEHAVIOR="behavior",t.PLUGIN="plugin",t.ANIMATION="animation",t.TRANSFORM="transform"}(EN||(EN={}));const MN=(t,e,n,r,i=!1)=>{const o=xN(r),a=`${n}s`,s=t.add[a].get(o)||t.update[a].get(o)||t.remove[a].get(o)||r;Object.entries(t).forEach((([t,n])=>{e===t?n[a].set(o,i?$(s,r):s):n[a].delete(o)}))},AN=[{fields:["x","y"]}],RN=AN,TN=[{fields:["sourceNode","targetNode"]}],wN=TN,PN=[{fields:["childrenNode","x","y"]}],NN=PN;function CN(t,e,n){const r=new Map(t.map((t=>[n(t),t]))),i=new Map(e.map((t=>[n(t),t]))),o=new Set(r.keys()),a=new Set(i.keys()),s=[],l=[],u=[],c=[];return a.forEach((t=>{o.has(t)?Q(r.get(t),i.get(t))?c.push(i.get(t)):l.push(i.get(t)):s.push(i.get(t))})),o.forEach((t=>{a.has(t)||u.push(r.get(t))})),{enter:s,exit:u,keep:c,update:l}}class ON{context;options;events=[];destroyed=!1;constructor(t,e){this.context=t,this.options=e}update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}}class IN extends ON{}function LN(t){return t instanceof Float32Array||!(!Array.isArray(t)||2!==t.length&&3!==t.length)&&t.every((t=>"number"==typeof t))}function DN(t,e,n){return t>=e&&t<=n}function BN(t=0){if(Array.isArray(t)){const[e=0,n=e,r=e,i=n]=t;return[e,n,r,i]}return[t,t,t,t]}function kN(t){return t.max[0]-t.min[0]}function FN(t){return t.max[1]-t.min[1]}function UN(t){return[kN(t),FN(t)]}function GN(t,e){const n=LN(t)?function(t){const[e,n,r=0]=t,i=new yM;return i.setMinMax([e,n,r],[e,n,r]),i}(t):t.getKey().getBounds();return e?zN(n,e):n}function zN(t,e){const[n,r,i,o]=BN(e),[a,s,l]=t.min,[u,c,h]=t.max,d=new yM;return d.setMinMax([a-o,s-n,l],[u+r,c+i,h]),d}function VN(t){if(0===t.length)return new yM;if(1===t.length)return t[0];const e=new yM;e.setMinMax(t[0].min,t[0].max);for(let n=1;n<t.length;n++){const r=t[n];e.setMinMax([Math.min(e.min[0],r.min[0]),Math.min(e.min[1],r.min[1]),Math.min(e.min[2],r.min[2])],[Math.max(e.max[0],r.max[0]),Math.max(e.max[1],r.max[1]),Math.max(e.max[2],r.max[2])])}return e}function WN(t,e){return DN(t[0],e.min[0],e.max[0])&&DN(t[1],e.min[1],e.max[1])}function jN(t,e){const[n,r]=e,[i,o]=t.min,[a,s]=t.max,l=n-i,u=a-n,c=r-o,h=s-r,d=Math.min(l,u,c,h);return d===l?"left":d===u?"right":d===c?"top":d===h?"bottom":"left"}function HN(t,e){const n=X(e);if(WN(e,t)){switch(jN(t,e)){case"left":n[0]=t.min[0];break;case"right":n[0]=t.max[0];break;case"top":n[1]=t.min[1];break;case"bottom":n[1]=t.max[1]}}else{const[r,i]=e,[o,a]=t.min,[s,l]=t.max;n[0]=DN(r,o,s)?r:r<o?o:s,n[1]=DN(i,a,l)?i:i<a?a:l}return n}const XN=[0,0,0];function YN(t,e){return t.map(((t,n)=>t+e[n]))}function KN(t,e){return t.map(((t,n)=>t-e[n]))}function $N(t,e){return"number"==typeof e?t.map((t=>t*e)):t.map(((t,n)=>t*e[n]))}function qN(t,e){return"number"==typeof e?t.map((t=>t/e)):t.map(((t,n)=>t/e[n]))}function ZN(t,e){return t.map((t=>t*e))}function QN(t,e){return Math.sqrt(t.reduce(((t,n,r)=>t+(n-e[r]||0)**2),0))}function JN(t,e){return t.reduce(((t,n,r)=>t+Math.abs(n-e[r])),0)}function tC(t){const e=t.reduce(((t,e)=>t+e**2),0);return t.map((t=>t/Math.sqrt(e)))}function eC(t,e,n=!1){const r=t[0]*e[1]-t[1]*e[0];let i=Math.acos($N(t,e).reduce(((t,e)=>t+e),0)/(QN(t,XN)*QN(e,XN)));return n&&r<0&&(i=2*Math.PI-i),i}function nC(t,e=!0){return e?[-t[1],t[0]]:[t[1],-t[0]]}function rC(t){return[t[0],t[1]]}function iC(t){return 2===t.length?[t[0],t[1],0]:t}function oC(t,e){const[n,r]=t,[i,o]=e;return function(t,e){const n=iC(t),r=iC(e);return[n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0]]}(KN(n,r),KN(i,o)).every((t=>0===t))}function aC(t,e,n=!1){if(oC(t,e))return;const[r,i]=t,[o,a]=e,s=((r[0]-o[0])*(o[1]-a[1])-(r[1]-o[1])*(o[0]-a[0]))/((r[0]-i[0])*(o[1]-a[1])-(r[1]-i[1])*(o[0]-a[0])),l=a[0]-o[0]?(r[0]-o[0]+s*(i[0]-r[0]))/(a[0]-o[0]):(r[1]-o[1]+s*(i[1]-r[1]))/(a[1]-o[1]);return n||DN(s,0,1)&&DN(l,0,1)?[r[0]+s*(i[0]-r[0]),r[1]+s*(i[1]-r[1])]:void 0}function sC(t){const{x:e=0,y:n=0,z:r=0}=t.style||{};return[+e,+n,+r]}function lC(t,e="center"){const n=function(t){if(Array.isArray(t))return DN(t[0],0,1)&&DN(t[1],0,1)?t:[.5,.5];const e=t.split("-");return[e.includes("left")?0:e.includes("right")?1:.5,e.includes("top")?0:e.includes("bottom")?1:.5]}(e);return function(t,e){const[n,r]=e,{min:i,max:o}=t;return[i[0]+n*(o[0]-i[0]),i[1]+r*(o[1]-i[1])]}(t,n)}function uC(t){return[t.x,t.y]}function cC(t,e=0){return t.map((t=>parseFloat(t.toFixed(e))))}function hC(t,e,n,r=!1){const i=tC(r?KN(t,e):KN(e,t)),o=[i[0]*n,i[1]*n];return YN(rC(t),o)}function dC(t,e){return t[1]===e[1]}function fC(t,e,n,r=!0){for(let i=0;i<n.length;i++){let o=n[i],a=n[(i+1)%n.length];r&&(o=YN(e,o),a=YN(e,a));const s=aC([e,t],[o,a]);if(s)return{point:s,line:[o,a]}}return{point:e,line:void 0}}function pC(t,e){const n=e.center,r=KN(t,e.center),i=Math.atan2(r[1],r[0]);if(isNaN(i))return n;const o=kN(e)/2,a=FN(e)/2;return[n[0]+o*Math.cos(i),n[1]+a*Math.sin(i)]}function gC(t,e){let n=1/0,r=[[0,0],[0,0]];return e.forEach((e=>{const i=function(t,e){const n=vC(t,e);return QN(t,n)}(t,e);i<n&&(n=i,r=e)})),r}function vC(t,e){const[n,r]=e[0],[i,o]=e[1],[a,s]=t,l=i-n,u=o-r;if(0===l&&0===u)return[n,r];let c=((a-n)*l+(s-r)*u)/(l*l+u*u);c>1?c=1:c<0&&(c=0);return[n+c*l,r+c*u]}function mC(t,e=!0){const n=function(t){return qN(t.reduce(((t,e)=>YN(t,e)),[0,0]),t.length)}(t);return t.sort((([t,r],[i,o])=>{const a=Math.atan2(r-n[1],t-n[0]),s=Math.atan2(o-n[1],i-n[0]);return e?s-a:a-s}))}function yC(t,e){return[t,[t[0],e[1]],e,[e[0],t[1]]]}const EC=t=>t.map((t=>N(t)?t.toLocaleLowerCase():t));class _C{map=new Map;emitter;recordKey=new Set;constructor(t){this.emitter=t,this.bindEvents()}bind(t,e){0!==t.length&&this.map.set(t,e)}unbind(t,e){this.map.forEach(((n,r)=>{Q(r,t)&&(e&&e!==n||this.map.delete(r))}))}unbindAll(){this.map.clear()}match(t){const e=EC(Array.from(this.recordKey)).sort(),n=EC(t).sort();return Q(e,n)}bindEvents(){const{emitter:t}=this;t.on(dN.KEY_DOWN,this.onKeyDown),t.on(dN.KEY_UP,this.onKeyUp),t.on(dN.WHEEL,this.onWheel),t.on(dN.DRAG,this.onDrag)}onKeyDown=t=>{t?.key&&(this.recordKey.add(t.key),this.trigger(t))};onKeyUp=t=>{t?.key&&this.recordKey.delete(t.key)};trigger(t){this.map.forEach(((e,n)=>{this.match(n)&&e(t)}))}triggerExtendKey(t,e){this.map.forEach(((n,r)=>{r.includes(t)&&Q(Array.from(this.recordKey),r.filter((e=>e!==t)))&&n(e)}))}onWheel=t=>{this.triggerExtendKey(dN.WHEEL,t)};onDrag=t=>{this.triggerExtendKey(dN.DRAG,t)};destroy(){this.unbindAll(),this.emitter.off(dN.KEY_DOWN,this.onKeyDown),this.emitter.off(dN.KEY_UP,this.onKeyUp),this.emitter.off(dN.WHEEL,this.onWheel),this.emitter.off(dN.DRAG,this.onDrag)}}class bC extends IN{static defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#EEF6FF",stroke:"#DDEEFE",fillOpacity:.4,zIndex:2,pointerEvents:"none"}};startPoint;endPoint;rectShape;shortcut;constructor(t,e){super(t,$({},bC.defaultOptions,e)),this.shortcut=new _C(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;const{canvas:e}=this.context;this.rectShape=new Vw({id:"g6-brush-select",style:this.options.style}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){if(!this.startPoint)return;const{immediately:e,mode:n}=this.options;this.endPoint=xC(t),this.rectShape?.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),e&&"default"===n&&this.updateElementsStates(yC(this.startPoint,this.endPoint))}onPointerUp(t){this.startPoint&&(this.endPoint?(this.endPoint=xC(t),this.updateElementsStates(yC(this.startPoint,this.endPoint)),this.clearBrush()):this.clearBrush())}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){const{graph:t}=this.context,e=Object.values(t.getData()).reduce(((t,e)=>Object.assign({},t,e.reduce(((t,e)=>(t[xN(e)]=[],t)),{}))),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){const{graph:e}=this.context,{enableElements:n,state:r,mode:i,onSelect:o}=this.options,a=this.selector(e,t,n);let s={};switch(i){case"union":a.forEach((t=>{s[t]=[...e.getElementState(t),r]}));break;case"diff":a.forEach((t=>{const n=e.getElementState(t);s[t]=n.includes(r)?n.filter((t=>t!==r)):[...n,r]}));break;case"intersect":a.forEach((t=>{const n=e.getElementState(t);s[t]=n.includes(r)?[r]:[]}));break;default:a.forEach((t=>{s[t]=[r]}))}E(o)&&(s=o(s)),e.setElementState(s,this.options.animation)}selector(t,e,n){if(!n||0===n.length)return[];const r=[],i=t.getData();if(n.forEach((n=>{const o=i[`${n}s`];o?.forEach((n=>{const i=xN(n);"hidden"!==t.getElementVisibility(i)&&function(t,e,n,r){const i=t[0],o=t[1];let a=!1;void 0===n&&(n=0),void 0===r&&(r=e.length);const s=r-n;for(let t=0,r=s-1;t<s;r=t++){const s=e[t+n][0],l=e[t+n][1],u=e[r+n][0],c=e[r+n][1];l>o!=c>o&&i<(u-s)*(o-l)/(c-l)+s&&(a=!a)}return a}(t.getElementPosition(i),e)&&r.push(i)}))})),n.includes("edge")){const t=i.edges;t?.forEach((t=>{const{source:e,target:n}=t;r.includes(e)&&r.includes(n)&&r.push(xN(t))}))}return r}clearBrush(){this.rectShape?.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){const{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return!(t&&!e.includes("drag"))||this.shortcut.match(e)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),t.on(dN.POINTER_DOWN,this.onPointerDown),t.on(dN.POINTER_MOVE,this.onPointerMove),t.on(dN.POINTER_UP,this.onPointerUp),t.on(`canvas:${dN.CLICK}`,this.clearStates)}unbindEvents(){const{graph:t}=this.context;t.off(dN.POINTER_DOWN,this.onPointerDown),t.off(dN.POINTER_MOVE,this.onPointerMove),t.off(dN.POINTER_UP,this.onPointerUp),t.off(`canvas:${dN.CLICK}`,this.clearStates)}update(t){this.options=$(this.options,t)}destroy(){this.unbindEvents(),super.destroy()}}const xC=t=>[t.canvas.x,t.canvas.y],SC=.8,MC=["node","edge","combo"];function AC(t,e,n,r){if("combo"===e||"node"===e)return RC(t,n,r);const i=t.getEdgeData(n);if(!i)return[];const o=RC(t,i.source,r-1),a=RC(t,i.target,r-1);return Array.from(new Set([...o,...a,n]))}function RC(t,e,n){const r=new Set,i=new Set,o=new Set;return function(t,e,n){const r=[[t,0]];for(;r.length;){const[t,i]=r.shift();e(t,i);const o=n(t);if(o)for(const t of o)r.push([t,i+1])}}(e,((e,r)=>{r>n||(o.add(e),t.getRelatedEdgesData(e).forEach((t=>{const e=xN(t);!i.has(e)&&r<n&&(o.add(e),i.add(e))})))}),(e=>t.getRelatedEdgesData(e).map((t=>t.source===e?t.target:t.source)).filter((t=>!r.has(t)&&(r.add(t),!0))))),Array.from(o)}class TC extends IN{selectedElementIds=new Set;neighborSelectedElementIds=new Set;shortcut;static defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};constructor(t,e){super(t,Object.assign({},TC.defaultOptions,e)),this.shortcut=new _C(t.graph),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),MC.forEach((e=>{t.on(`${e}:${dN.CLICK}`,this.onClickSelect)})),t.on(`canvas:${dN.CLICK}`,this.onClickCanvas)}onClickSelect=t=>{this.validate(t)&&(this.updateElementsState(t,!1),this.updateElementsState(t,!0),this.options.onClick?.(t))};onClickCanvas=t=>{this.validate(t)&&(this.updateElementsState(t,!1),this.selectedElementIds.clear(),this.neighborSelectedElementIds.clear(),this.options.onClick?.(t))};updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.unselectedState)return;const{graph:n}=this.context,{target:r}=t;if(e)if(this.selectedElementIds.has(r.id))this.selectedElementIds.delete(r.id);else{this.options.multiple&&this.shortcut.match(this.options.trigger)||this.selectedElementIds.clear(),this.selectedElementIds.add(r.id),this.updateNeighborSelectedElementIds(t)}if(!this.selectedElementIds.size)return;const i={};if(this.options.state&&Object.assign(i,this.getElementsState(Array.from(this.selectedElementIds),this.options.state,e)),this.options.neighborState&&this.neighborSelectedElementIds.size>0&&Object.assign(i,this.getElementsState(Array.from(this.neighborSelectedElementIds),this.options.neighborState,e)),this.options.unselectedState){const t=SN(n.getData(),!0).filter((t=>!this.selectedElementIds.has(t)&&!this.neighborSelectedElementIds.has(t)));Object.assign(i,this.getElementsState(t,this.options.unselectedState,e))}n.setElementState(i,this.options.animation)};updateNeighborSelectedElementIds=t=>{this.neighborSelectedElementIds.clear();const e=E(this.options.degree)?this.options.degree(t):this.options.degree;if(e){const{targetType:n}=t;this.selectedElementIds.forEach((t=>{const r=AC(this.context.graph,n,t,e);this.neighborSelectedElementIds=new Set([...this.neighborSelectedElementIds,...r].filter((t=>!this.selectedElementIds.has(t))))}))}};getElementsState=(t,e,n)=>{const{graph:r}=this.context,i={};return t.forEach((t=>{const o=r.getElementState(t),a=n?[...o,e]:o.filter((t=>t!==e));i[t]=a})),i};validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;MC.forEach((e=>{t.off(`${e}:${dN.CLICK}`,this.onClickSelect)})),t.off(`canvas:${dN.CLICK}`,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}}function wC(t){return!!t.style?.collapsed}function PC(t,e){if(!t.startsWith(e))return!1;const n=t[e.length];return n>="A"&&n<="Z"}function NC(t,e,n=!0){if(!e)return t;if(!PC(t,e))return t;const r=t.slice(e.length);return n?G(r):r}function CC(t,e){const n=Object.entries(t).reduce(((t,[n,r])=>("className"===n||"class"===n||PC(n,e)&&Object.assign(t,{[NC(n,e)]:r}),t)),{});if("opacity"in t){const r=function(t,e){return`${e}${z(t)}`}("opacity",e),i=t.opacity;if(r in t){const e=t[r];Object.assign(n,{opacity:i*e})}else Object.assign(n,{opacity:i})}return n}function OC(t,e){const n=e.length;return Object.keys(t).reduce(((r,i)=>{if(i.startsWith(e)){r[i.slice(n)]=t[i]}return r}),{})}function IC(t,e){const n="string"==typeof e?[e]:e,r={};return Object.keys(t).forEach((e=>{n.find((t=>e.startsWith(t)))||(r[e]=t[e])})),r}function LC(t=0){if("number"==typeof t)return[t,t,t];const[e,n=e,r=e]=t;return[e,n,r]}function DC(t,e){const n=t?.style||{},r=e?.style||{};return Object.assign({},t,e,{style:Object.assign({},n,r)})}function BC(t){const e="string"==typeof t?function(t,e){const n=Fz[t]?.[e];if(n)return n;return}("palette",t):t;if("function"!=typeof e)return e}function kC(t,e){let n=2*t;return"string"==typeof e?n=t*Number(e.replace("%",""))/100:"number"==typeof e&&(n=e),isNaN(n)&&(n=2*t),n}function FC(t,e,n=1,r=!1){const i=r?n:1;return kC((t.max[0]-t.min[0])*i,e)}const UC="cachedStyle",GC=t=>`__${t}__`;function zC(t){const e=[],n=t=>{t?.children.length&&t.children.forEach((t=>{e.push(t),n(t)}))};return n(t),e}const VC="visibility";function WC(t,e){[t,...zC(t)].forEach((n=>{(function(t,e){return GC(e)in(J(t,UC)||{})})(n,VC)||function(t,e){const n=Array.isArray(e)?e:[e];J(t,UC)||tt(t,UC,{}),n.forEach((e=>{tt(J(t,UC),GC(e),t.attributes[e])}))}(n,VC);const r=function(t,e){return J(t,[UC,GC(e)])}(n,VC);t!==n&&"hidden"===r||(n.style.visibility=e)}))}class jC extends Iw{constructor(t){super(t),this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}get parsedAttributes(){return this.attributes}shapeMap={};animateMap={};upsert(t,e,n,r){const i=this.shapeMap[t];if(!1!==n){if(!i){const i=new e({style:n});return i.id=t,r.appendChild(i),this.shapeMap[t]=i,i}return function(t,e){"update"in t?t.update(e):t.attr(e)}(i,n),i}i&&(r.removeChild(i),delete this.shapeMap[t])}update(t={}){this.attr(Object.assign({},this.attributes,t)),this.render(this.attributes,this),this.setVisibility()}bindEvents(){}getGraphicStyle(t){const{x:e,y:n,z:r,className:i,transform:o,transformOrigin:a,context:s,zIndex:l,...u}=t;return u}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}hostingAnimation=!0;animate(t,e){if(0===t.length)return null;const n=[],r=super.animate(t,e);if(!this.hostingAnimation)return r;if(r&&n.push(r),Array.isArray(t)&&t.length>0){const r=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some((t=>!r.includes(t)))){Object.entries(this.shapeMap).forEach((([r,i])=>{const o=this[`get${z(r)}Style`];if(E(o)){const r=t.map((t=>o.call(this,{...this.attributes,...t}))),a=i.animate(_N(r),e);a&&n.push(a)}}));const r=(r,i)=>{if(!Z(r)){const o=this[`get${z(i)}Style`];if(E(o)){const i=t.map((t=>o.call(this,{...this.attributes,...t})));Object.entries(i[0]).map((([t])=>{const o=i.map((e=>e[t])),a=r[t];if(a){const t=a.animate(_N(o),e);t&&n.push(t)}}))}}};this.compositeShapes.forEach((([t,e])=>{const n=OC(this.shapeMap,e);r(n,t)}))}}return function(t,e){if(Array.isArray(t)&&0===t.length)return null;const n=Array.isArray(t)?t[0]:t,r=Array.isArray(t)?t.slice(1):[];return new Proxy(n,{get:(t,e)=>"function"!=typeof t[e]||["onframe","onfinish"].includes(e)?"finished"===e?Promise.all([n.finished,...r.map((t=>t.finished))]):Reflect.get(t,e):(...n)=>{t[e](...n),r.forEach((t=>t[e]?.(...n)))},set:(t,e,n)=>(["onframe","onfinish"].includes(e)||r.forEach((t=>{t[e]=n})),Reflect.set(t,e,n))})}(n)}getShape(t){return this.shapeMap[t]}setVisibility(){const{visibility:t}=this.attributes;WC(this,t)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}}class HC extends jC{static defaultStyleProps={padding:0,fontSize:12,wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};constructor(t){super(DC({style:HC.defaultStyleProps},t))}isTextStyle(t){return PC(t,"label")}isBackgroundStyle(t){return PC(t,"background")}getTextStyle(t){const{padding:e,...n}=this.getGraphicStyle(t);return IC(n,"background")}getBackgroundStyle(t){if(!1===t.background)return!1;const e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:r,padding:i}=e,o=CC(e,"background"),{min:[a,s],halfExtents:[l,u]}=this.shapeMap.text.getGeometryBounds(),[c,h,d,f]=BN(i),p=2*l+f+h;Object.assign(o,{x:a-f,y:s-c,width:n?Math.min(p,r):p,height:2*u+c+d});const{radius:g}=o;if("string"==typeof g&&g.endsWith("%")){const t=Number(g.replace("%",""))/100;o.radius=Math.min(+o.width,+o.height)*t}return o}render(t=this.parsedAttributes,e=this){this.upsert("text",Ww,this.getTextStyle(t),e),this.upsert("background",Vw,this.getBackgroundStyle(t),e)}}class XC extends jC{static defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};constructor(t){super(DC({style:XC.defaultStyleProps},t))}getBadgeStyle(t){return this.getGraphicStyle(t)}render(t=this.parsedAttributes,e=this){this.upsert("label",HC,this.getBadgeStyle(t),e)}connectedCallback(){this.upsert("label",HC,this.getBadgeStyle(this.parsedAttributes),this)}}const YC={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]};function KC(t){const e=[],n="string"==typeof t?function(t){const e=t.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),n=[];let r="",i={};for(;e.length>0;){let t=e.shift();t in YC?r=t:e.unshift(t),i={type:r},YC[r].forEach((n=>{t=e.shift(),i[n]=t})),"M"===r?r="L":"m"===r&&(r="l");const[o,...a]=Object.values(i);n.push([o,...a.map(Number)])}return n}(t):t;return n.forEach((t=>{const n=t[0];if("Z"!==n)if("A"!==n)for(let n=1;n<t.length;n+=2)e.push([t[n],t[n+1],0]);else{const n=t.length;e.push([t[n-2],t[n-1],0])}else e.push(e[0])})),e}const $C=t=>{if(t.length<2)return[["M",0,0],["L",0,0]];const e=t[0],n=t[1],r=t[t.length-1],i=t[t.length-2];t.unshift(i,r),t.push(e,n);const o=[["M",r[0],r[1]]];for(let e=1;e<t.length-2;e+=1){const[n,r]=t[e-1],[i,a]=t[e],[s,l]=t[e+1],[u,c]=e!==t.length-2?t[e+2]:[s,l],h=i+(s-n)/6,d=a+(l-r)/6,f=s-(u-i)/6,p=l-(c-a)/6;o.push(["C",h,d,f,p,s,l])}return o};class qC extends jC{static defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};constructor(t){super(DC({style:qC.defaultStyleProps},t))}getLabelStyle(t){if(!t.label||!t.d||0===t.d.length)return!1;const{maxWidth:e,offsetX:n,offsetY:r,autoRotate:i,placement:o,closeToPath:a,...s}=CC(this.getGraphicStyle(t),"label"),l=this.shapeMap.key,u=l?.getRenderBounds();return Object.assign(function(t,e,n,r,i,o,a){const[s,l]=lC(t,e),u={textAlign:"left"===e?"right":"right"===e?"left":"center",textBaseline:"top"===e?"bottom":"bottom"===e?"top":"middle",transform:`translate(${s+n}, ${l+r})`};if("center"===e||!i)return u;const c=KC(o);if(!c||c.length<=3)return u;const h=c.map(((t,e)=>{const n=t,r=c[(e+1)%c.length];return Q(n,r)?null:[n,r]})).filter(Boolean),d=gC([s,l],h),f=vC([s,l],d);if(f&&d&&(u.transform=`translate(${f[0]+n}, ${f[1]+r})`,a)){const t=Math.atan((d[0][1]-d[1][1])/(d[0][0]-d[1][0]));u.transform+=`rotate(${t/Math.PI*180}deg)`,u.textAlign="center","right"!==e&&"left"!==e||(u.textBaseline=t>0?"right"===e?"bottom":"top":"right"===e?"top":"bottom")}return u}(u,o,n,r,a,t.d,i),{wordWrapWidth:FC(u,e)},s)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",Uw,this.getKeyStyle(t),e),this.upsert("label",HC,this.getLabelStyle(t),e)}}class ZC extends jC{constructor(t){super(t)}isGImage(){return!!this.getAttribute("src")}getIconStyle(t=this.attributes){const{x:e=0,y:n=0}=t,r=this.getGraphicStyle(t),{width:i,height:o}=r;return this.isGImage()?{x:e-i/2,y:n-o/2,...r}:{textBaseline:"middle",textAlign:"center",...r}}render(t=this.attributes,e=this){this.upsert("icon",this.isGImage()?kw:Ww,this.getIconStyle(t),e)}connectedCallback(){this.upsert("icon",this.isGImage()?kw:Ww,this.getIconStyle(this.attributes),this)}}class QC extends jC{get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){const n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then((()=>this.onframe()))),n}onCreate(){}onUpdate(){}onDestroy(){}}class JC extends QC{type="node";static defaultStyleProps={x:0,y:0,size:24,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0};constructor(t){super(DC({style:JC.defaultStyleProps},t))}getSize(t=this.attributes){const{size:e}=t;return LC(e)}getKeyStyle(t){const e=this.getGraphicStyle(t);return Object.assign(IC(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;const{placement:e,maxWidth:n,offsetX:r,offsetY:i,...o}=CC(this.getGraphicStyle(t),"label"),a=this.getKey().getLocalBounds();return Object.assign(ZO(a,e,r,i),{wordWrapWidth:FC(a,n)},o)}getHaloStyle(t){if(!1===t.halo)return!1;const{fill:e,...n}=this.getKeyStyle(t);return{...n,stroke:e,...CC(this.getGraphicStyle(t),"halo")}}getIconStyle(t){if(!1===t.icon||!t.iconText&&!t.iconSrc)return!1;const e=CC(this.getGraphicStyle(t),"icon"),n=this.getKey(),[r,i]=lC(n.getLocalBounds(),"center");return{x:r,y:i,...e}}getBadgesStyle(t){const e=OC(this.shapeMap,"badge-"),n={};if(Object.keys(e).forEach((t=>{n[t]=!1})),!1===t.badge||!t.badges?.length)return n;const{badges:r=[],badgePalette:i,opacity:o=1,...a}=t,s=BC(i),l=CC(this.getGraphicStyle(a),"badge");return r.forEach(((t,e)=>{n[e]={backgroundFill:s?s[e%s?.length]:void 0,opacity:o,...l,...this.getBadgeStyle(t)}})),n}getBadgeStyle(t){const e=this.getKey(),{placement:n="top",offsetX:r,offsetY:i,...o}=t;return{...ZO(e.getLocalBounds(),n,r,i,!0),...o}}getPortsStyle(t){const e=this.getPorts(),n={};if(Object.keys(e).forEach((t=>{n[t]=!1})),!1===t.port||!t.ports?.length)return n;const r=CC(this.getGraphicStyle(t),"port"),{ports:i=[]}=t;return i.forEach(((e,i)=>{const o=e.key||i,a={...r,...e};if(jO(a))n[o]=!1;else{const[r,i]=this.getPortXY(t,e);n[o]={transform:`translate(${r}, ${i})`,...a}}})),n}getPortXY(t,e){const{placement:n="left"}=e;return VO(this.getKey().getLocalBounds(),n)}getKey(){return this.shapeMap.key}getPorts(){return OC(this.shapeMap,"port-")}getCenter(){return this.getKey().getBounds().center}getIntersectPoint(t){const e=this.getKey().getBounds();return fC(t,lC(n=e,"center"),[lC(n,"left-top"),lC(n,"right-top"),lC(n,"right-bottom"),lC(n,"left-bottom")],!1).point;var n}drawHaloShape(t,e){const n=this.getKey();this.upsert("halo",n.constructor,this.getHaloStyle(t),e)}drawIconShape(t,e){this.upsert("icon",ZC,this.getIconStyle(t),e)}drawBadgeShapes(t,e){const n=this.getBadgesStyle(t);Object.keys(n).forEach((t=>{this.upsert(`badge-${t}`,XC,n[t],e)}))}drawPortShapes(t,e){const n=this.getPortsStyle(t);Object.keys(n).forEach((t=>{this.upsert(`port-${t}`,Ow,n[t],e)}))}drawLabelShape(t,e){this.upsert("label",HC,this.getLabelStyle(t),e)}render(t=this.parsedAttributes,e=this){const{x:n=0,y:r=0,z:i=0,transform:o}=t;0===n&&0===r&&0===i||(this.style.transform=function(t,e,n,r){const i=r?r.replace(/translate(3d)?\([^)]*\)/g,""):"";return 0===n?`translate(${t}, ${e})${i}`:`translate3d(${t}, ${e}, ${n})${i}`}(n,r,i,o));this.drawKeyShape(t,e)&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}}let tO=class t extends JC{static defaultStyleProps={size:24};constructor(e){super(DC({style:t.defaultStyleProps},e))}drawKeyShape(t,e){return this.upsert("key",Ow,this.getKeyStyle(t),e)}getKeyStyle(t){return{...super.getKeyStyle(t),r:Math.min(...this.getSize(t))/2}}getIconStyle(t){const e=super.getIconStyle(t),{r:n}=this.getKeyStyle(t),r=2*n*SC;return!!e&&{width:r,height:r,...e}}getIntersectPoint(t){return pC(t,this.getKey().getBounds())}};class eO extends JC{constructor(t){super(t)}get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",Gw,this.getKeyStyle(t),e)}getKeyStyle(t){return{...super.getKeyStyle(t),points:this.getPoints(t)}}getIntersectPoint(t){const{points:e}=this.getKeyStyle(this.parsedAttributes);return fC(t,[+(this.attributes?.x||0),+(this.attributes?.y||0)],e).point}}class nO extends tO{static defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};constructor(t){super(DC({style:nO.defaultStyleProps},t))}parseOuterR(){const{size:t}=this.parsedAttributes;return Math.min(...LC(t))/2}parseInnerR(){const{innerR:t}=this.parsedAttributes;return N(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){const{donuts:n}=t;if(!n?.length)return;const r=n.map((t=>I(t)?{value:t}:t)),i=CC(this.getGraphicStyle(t),"donut"),o=BC(t.donutPalette);if(!o)return;const a=r.reduce(((t,e)=>t+(e.value??0)),0),s=this.parseOuterR(),l=this.parseInnerR();let u=0;r.forEach(((t,n)=>{const{value:c=0,color:h=o[n%o.length],...d}=t,f=360*(0===a?1/r.length:c/a);this.upsert(`round${n}`,Uw,{...i,d:iO(s,l,u,u+f),fill:h,...d},e),u+=f}))}render(t,e=this){super.render(t,e),this.drawDonutShape(t,e)}}const rO=(t,e,n,r)=>[t+Math.sin(r)*n,e-Math.cos(r)*n],iO=(t=0,e=0,n,r)=>{const[i,o]=[0,0];return Math.abs(n-r)%360<1e-6?((t,e,n,r)=>r<=0||n<=r?[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"]]:[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"],["M",t+r,e],["A",r,r,0,1,0,t-r,e],["A",r,r,0,1,0,t+r,e],["Z"]])(i,o,t,e):((t,e,n,r,i,o)=>{const[a,s]=[i/360*2*Math.PI,o/360*2*Math.PI],l=[rO(t,e,r,a),rO(t,e,n,a),rO(t,e,n,s),rO(t,e,r,s)],u=s-a>Math.PI?1:0;return[["M",l[0][0],l[0][1]],["L",l[1][0],l[1][1]],["A",n,n,0,u,1,l[2][0],l[2][1]],["L",l[3][0],l[3][1]],["A",r,r,0,u,0,l[0][0],l[0][1]],["Z"]]})(i,o,t,e,n,r)};class oO extends JC{static defaultStyleProps={size:[80,40]};constructor(t){super(DC({style:oO.defaultStyleProps},t))}drawKeyShape(t,e){return this.upsert("key",Lw,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,r]=this.getSize(t);return{...e,rx:n/2,ry:r/2}}getIconStyle(t){const e=super.getIconStyle(t),{rx:n,ry:r}=this.getKeyStyle(t),i=2*Math.min(+n,+r)*SC;return!!e&&{width:i,height:i,...e}}getIntersectPoint(t){return pC(t,this.getKey().getBounds())}}class aO extends JC{static defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};constructor(t){super({...t,style:Object.assign({},aO.defaultStyleProps,t.style)})}rootPointerEvent=new $T(null);get eventService(){return this.attributes.context.canvas.context.eventService}get events(){return[hN.CLICK,hN.POINTER_DOWN,hN.POINTER_MOVE,hN.POINTER_UP,hN.POINTER_OVER,hN.POINTER_LEAVE]}getDomElement(){return this.getKey().getDomElement()}getKeyStyle(t){const e=nt(t,["innerHTML","pointerEvents","cursor"]),[n,r]=this.getSize(t);return{...e,width:n,height:r}}drawKeyShape(t,e){const n=this.getKeyStyle(t),{width:r,height:i}=n,o=this.upsert("key-container",Vw,{width:r,height:i,opacity:0},e);return this.upsert("key",Bw,n,o)}connectedCallback(){const t=this.getDomElement();this.events.forEach((e=>{t.addEventListener(e,this.forwardEvents)}))}attributeChangedCallback(t,e,n){"zIndex"===t&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){const t=this.getDomElement();this.events.forEach((e=>{t.removeEventListener(e,this.forwardEvents)})),super.destroy()}forwardEvents=t=>{const e=this.attributes.context.canvas.main,n=e.context.renderingContext.root.ownerDocument.defaultView;this.normalizeToPointerEvent(t,n).forEach((r=>{const i=this.bootstrapEvent(this.rootPointerEvent,r,n,t);e.context.eventService.mapEvent(i)}))};normalizeToPointerEvent(t,e){const n=[];if(e.isTouchEvent(t))for(let e=0;e<t.changedTouches.length;e++){const r=t.changedTouches[e];H(r.button)&&(r.button=0),H(r.buttons)&&(r.buttons=1),H(r.isPrimary)&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),H(r.width)&&(r.width=r.radiusX||1),H(r.height)&&(r.height=r.radiusY||1),H(r.tiltX)&&(r.tiltX=0),H(r.tiltY)&&(r.tiltY=0),H(r.pointerType)&&(r.pointerType="touch"),H(r.pointerId)&&(r.pointerId=r.identifier||0),H(r.pressure)&&(r.pressure=r.force||.5),H(r.twist)&&(r.twist=0),H(r.tangentialPressure)&&(r.tangentialPressure=0),r.isNormalized=!0,r.type=t.type,n.push(r)}else if(e.isMouseEvent(t)){const e=t;H(e.isPrimary)&&(e.isPrimary=!0),H(e.width)&&(e.width=1),H(e.height)&&(e.height=1),H(e.tiltX)&&(e.tiltX=0),H(e.tiltY)&&(e.tiltY=0),H(e.pointerType)&&(e.pointerType="mouse"),H(e.pointerId)&&(e.pointerId=1),H(e.pressure)&&(e.pressure=.5),H(e.twist)&&(e.twist=0),H(e.tangentialPressure)&&(e.tangentialPressure=0),e.isNormalized=!0,n.push(e)}else n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,r){t.view=n,t.originalEvent=null,t.nativeEvent=r,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:o}=this.getViewportXY(e);t.viewport.x=i,t.viewport.y=o;const{x:a,y:s}=this.attributes.context.canvas.viewport2Canvas(t.viewport);return t.canvas.x=a,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=r.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t}getViewportXY(t){let e,n;const{offsetX:r,offsetY:i,clientX:o,clientY:a}=t;if(!this.attributes.context?.canvas.main.context.config.supportsCSSTransform||_(r)||_(i)){const t=this.eventService.client2Viewport({x:o,y:a});e=t.x,n=t.y}else e=r,n=i;return{x:e,y:n}}onframe(){super.onframe();const{opacity:t}=this.attributes;this.getDomElement().style.opacity=`${t}`}}class sO extends JC{static defaultStyleProps={size:[48,24]};constructor(t){super(DC({style:sO.defaultStyleProps},t))}getKeyStyle(t){const[e,n]=this.getSize(t);return{...super.getKeyStyle(t),width:e,height:n,x:-e/2,y:-n/2}}getIconStyle(t){const e=super.getIconStyle(t),{width:n,height:r}=this.getKeyStyle(t);return!!e&&{width:n*SC,height:r*SC,...e}}drawKeyShape(t,e){return this.upsert("key",Vw,this.getKeyStyle(t),e)}}class lO extends eO{static defaultStyleProps={size:40,direction:"up"};constructor(t){super(DC({style:lO.defaultStyleProps},t))}getPoints(t){const{direction:e}=t,[n,r]=this.getSize(t);return function(t,e,n){const r=e/2,i=t/2,o={up:[[-i,r],[i,r],[0,-r]],left:[[-i,0],[i,r],[i,-r]],right:[[-i,r],[-i,-r],[i,0]],down:[[-i,-r],[i,-r],[0,r]]};return o[n]||o.up}(n,r,e)}getPortXY(t,e){const{direction:n}=t,{placement:r="top"}=e,i=this.getKey().getLocalBounds(),[o,a]=this.getSize(t),s=function(t,e,n){const r=e/2,i=t/2,o={};"down"===n?(o.bottom=o.default=[0,r],o.right=[i,-r],o.left=[-i,-r]):"left"===n?(o.top=[i,-r],o.bottom=[i,r],o.left=o.default=[-i,0]):"right"===n?(o.top=[-i,-r],o.bottom=[-i,r],o.right=o.default=[i,0]):(o.left=[-i,r],o.top=o.default=[0,-r],o.right=[i,r]);return o}(o,a,n);return VO(i,r,s,!1)}getIconStyle(t){const{icon:e,iconText:n,iconSrc:r,direction:i}=t;if(!1===e||Z(n||r))return!1;const o=CC(this.getGraphicStyle(t),"icon"),a=this.getKey().getLocalBounds(),[s,l]=function(t,e){const{center:n}=t,[r,i]=UN(t);return["up"===e||"down"===e?n[0]:"right"===e?n[0]-r/6:n[0]+r/6,"left"===e||"right"===e?n[1]:"down"===e?n[1]-i/6:n[1]+i/6]}(a,i),u=2*function(t,e){let[n,r]=UN(t);return[n,r]="up"===e||"down"===e?[n,r]:[r,n],(r**2-(Math.sqrt((n/2)**2+r**2)-n/2)**2)/(2*r)}(a,i)*SC;return{x:s,y:l,width:u,height:u,...o}}}class uO extends JC{type="combo";static defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"};constructor(t){super(DC({style:uO.defaultStyleProps},t))}getKeySize(t){const{collapsed:e,childrenNode:n=[]}=t;return 0===n.length?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){const{padding:e,collapsedSize:n}=t,[r,i,o,a]=BN(e);return YN(LC(n),[a+i,r+o,0])}getCollapsedKeySize(t){return LC(t.collapsedSize)}getExpandedKeySize(t){const e=this.getContentBBox(t);return[kN(e),FN(e),0]}getContentBBox(t){const{context:e,childrenNode:n=[],padding:r}=t,i=VN(n.map((t=>e.element.getElement(t))).map((t=>t.getBounds())));return r?zN(i,r):i}drawCollapsedMarkerShape(t,e){this.upsert("collapsed-marker",ZC,this.getCollapsedMarkerStyle(t),e)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;const{type:e,...n}=CC(this.getGraphicStyle(t),"collapsedMarker"),r=this.getKey(),[i,o]=lC(r.getLocalBounds(),"center"),a={...n,x:i,y:o};if(e){const n=this.getCollapsedMarkerText(e,t);Object.assign(a,{text:n})}return a}getCollapsedMarkerText(t,e){const{context:n,childrenData:r=[]}=e,{model:i}=n;return"descendant-count"===t?i.getDescendantsData(this.id).length.toString():"child-count"===t?r.length.toString():"node-count"===t?i.getDescendantsData(this.id).filter((t=>"node"===i.getElementType(xN(t)))).length.toString():E(t)?t(r):""}getComboZIndex(t){return(t.context.model.getAncestorsData(this.id,yN)||[]).length}getComboPosition(t){const{x:e=0,y:n=0,collapsed:r,context:i,childrenData:o=[]}=t;if(0===o.length)return[+e,+n,0];if(r){const{model:t}=i,r=t.getDescendantsData(this.id).filter((e=>!t.isCombo(xN(e))));if(r.length>0){return qN(r.reduce(((t,e)=>YN(t,sC(e))),[0,0,0]),r.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){const{zIndex:e=this.getComboZIndex(t)}=t,[n,r]=this.getComboPosition(t);return{x:n,y:r,transform:`translate(${n}, ${r})`,zIndex:e}}updateComboPosition(t){const e=this.getComboStyle(t);Object.assign(this.style,e),t.context.model.syncComboDatum({id:this.id,style:e})}render(t,e=this){super.render(t,e),this.updateComboPosition(t),this.drawCollapsedMarkerShape(t,e)}hostingAnimation=!1;onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(this.attributes.collapsed?t:t.map((({x:t,y:e,z:n,transform:r,...i})=>i)),e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then((()=>this.onframe())),Reflect.set(t,e,n))}):n}}const cO={N:"S",S:"N",W:"E",E:"W"},hO={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function dO(t,e){const[n,r]=t,[i,o]=e;return n===i?r>o?"N":"S":r===o?n>i?"W":"E":null}function fO(t,e){return"N"===e||"S"===e?FN(t):kN(t)}function pO(t,e,n){const r=[t[0],e[1]],i=[e[0],t[1]],o=dO(t,r),a=dO(t,i),s=n?cO[n]:null,l=o===n||o!==s&&a!==n?r:i;return{points:[l],direction:dO(l,e)}}function gO(t,e,n){const r=EO(t,e,n);return{points:[r],direction:dO(r,e)}}function vO(t,e,n,r){const i=[[e[0],t[1]],[t[0],e[1]]],o=i.filter((t=>function(t,e){return!WN(t,e)}(t,n))),a=o.filter((e=>dO(e,t)!==r));if(a.length>0){const n=a.find((e=>dO(t,e)===r))||a[0];return{points:[n],direction:dO(n,e)}}{const a=hC(e,y(i,o)[0],fO(n,r)/2);return{points:[EO(a,t,n),a],direction:dO(a,e)}}}function mO(t,e,n,r){let i=gO(t,e,n);const o=iC(i.points[0]);if(WN(o,r)){i=gO(e,t,r);const a=iC(i.points[0]);if(WN(a,n)){const s=hC(t,a,fO(n,dO(t,a))/2),l=hC(e,o,fO(r,dO(e,o))/2),u=[(s[0]+l[0])/2,(s[1]+l[1])/2],c=gO(t,u,n),h=vO(u,e,r,c.direction);i.points=[c.points[0],h.points[0]],i.direction=h.direction}}return i}function yO(t,e,n,r,i){const o=.01,a=VN([n,r]),s=QN(e,a.center)>QN(t,a.center),[l,u]=s?[e,t]:[t,e],c=FN(a)+kN(a);let h;if(i){const t=[l[0]+c*Math.cos(hO[i]),l[1]+c*Math.sin(hO[i])];h=hC(HN(a,t),t,o)}else h=hC(HN(a,l),l,-.01);let d=EO(h,u,a),f=[cC(h,2),cC(d,2)];if(Q(cC(h),cC(d))){const t=eC(KN(h,l),[1,0,0])+Math.PI/2;d=[u[0]+c*Math.cos(t),u[1]+c*Math.sin(t),0],d=cC(hC(HN(a,d),u,-.01),2);f=[h,EO(h,d,a),d]}return{points:s?f.reverse():f,direction:dO(s?h:d,e)}}function EO(t,e,n){let r=[t[0],e[1]];return WN(r,n)&&(r=[e[0],t[1]]),r}function _O(t,e,n,r,i){const[o,a]=uC(t.getPoint(e));let s=n,l=r;return i&&(s=n*Math.cos(i)-r*Math.sin(i),l=n*Math.sin(i)+r*Math.cos(i)),[o+s,a+l]}function bO(t,e,n,r){if(Q(t,e))return t;const i=KN(e,t),o=[t[0]+n*i[0],t[1]+n*i[1]],a=tC(nC(i,!1));return o[0]+=r*a[0],o[1]+=r*a[1],o}function xO(t,e,n){return[["M",t[0],t[1]],["C",n[0][0],n[0][1],n[1][0],n[1][1],e[0],e[1]]]}function SO(t,e=0,n=!1){const r=t[0],i=t[t.length-1],o=t.slice(1,t.length-1),a=[["M",r[0],r[1]]];return o.forEach(((t,n)=>{const s=o[n-1]||r,l=o[n+1]||i;if(!oC([s,u=t],[u,l])&&e){const[n,r]=function(t,e,n,r){const i=JN(t,e),o=JN(n,e),a=Math.min(r,Math.min(i,o)/2),s=[e[0]-a/i*(e[0]-t[0]),e[1]-a/i*(e[1]-t[1])],l=[e[0]-a/o*(e[0]-n[0]),e[1]-a/o*(e[1]-n[1])];return[s,l]}(s,t,l,e);a.push(["L",n[0],n[1]],["Q",t[0],t[1],r[0],r[1]],["L",r[0],r[1]])}else a.push(["L",t[0],t[1]]);var u})),a.push(["L",i[0],i[1]]),n&&a.push(["Z"]),a}const MO=t=>{const e=Math.PI/2,n=FN(t)/2,r=kN(t)/2,i=Math.atan2(n,r)/2,o=Math.atan2(r,n)/2;return{top:[-e-o,-e+o],"top-right":[-e+o,-i],"right-top":[-e+o,-i],right:[-i,i],"bottom-right":[i,e-o],"right-bottom":[i,e-o],bottom:[e-o,e+o],"bottom-left":[e+o,Math.PI-i],"left-bottom":[e+o,Math.PI-i],left:[Math.PI-i,Math.PI+i],"top-left":[Math.PI+i,-e-o],"left-top":[Math.PI+i,-e-o]}};function AO(t,e,n,r,i){const o=GN(t),a=t.getCenter();let s=r&&HO(r),l=i&&HO(i);if(!s||!l){const r=MO(o),i=r[e][0],u=r[e][1],[c,h]=UN(o),d=Math.max(c,h),f=YN(a,[d*Math.cos(i),d*Math.sin(i),0]),p=YN(a,[d*Math.cos(u),d*Math.sin(u),0]);s=qO(t,f),l=qO(t,p),n||([s,l]=[l,s])}return[s,l]}function RO(t,e,n,r,i,o){const a=t.getPorts()[i||o],s=t.getPorts()[o||i];let[l,u]=AO(t,e,n,a,s);const c=function(t,e,n,r){const i=t.getCenter();if(Q(e,n)){const t=KN(e,i),o=[r*Math.sign(t[0])||r/2,r*Math.sign(t[1])||-r/2,0];return[YN(e,o),YN(n,$N(o,[1,-1,1]))]}return[hC(i,e,QN(i,e)+r),hC(i,n,QN(i,n)+r)]}(t,l,u,r);return a&&(l=$O(a,c[0])),s&&(u=$O(s,c[c.length-1])),xO(l,u,c)}function TO(t,e,n,r,i,o,a){const s=WO(t),l=s[o||a],u=s[a||o];let[c,h]=AO(t,n,r,l,u);const d=function(t,e,n,r){const i=[],o=GN(t);if(Q(e,n)){switch(jN(o,e)){case"left":i.push([e[0]-r,e[1]]),i.push([e[0]-r,e[1]+r]),i.push([e[0],e[1]+r]);break;case"right":i.push([e[0]+r,e[1]]),i.push([e[0]+r,e[1]+r]),i.push([e[0],e[1]+r]);break;case"top":i.push([e[0],e[1]-r]),i.push([e[0]+r,e[1]-r]),i.push([e[0]+r,e[1]]);break;case"bottom":i.push([e[0],e[1]+r]),i.push([e[0]+r,e[1]+r]),i.push([e[0]+r,e[1]])}}else{const t=jN(o,e),a=jN(o,n);if(t===a){let o,a;switch(t){case"left":o=Math.min(e[0],n[0])-r,i.push([o,e[1]]),i.push([o,n[1]]);break;case"right":o=Math.max(e[0],n[0])+r,i.push([o,e[1]]),i.push([o,n[1]]);break;case"top":a=Math.min(e[1],n[1])-r,i.push([e[0],a]),i.push([n[0],a]);break;case"bottom":a=Math.max(e[1],n[1])+r,i.push([e[0],a]),i.push([n[0],a])}}else{const s=(t,e)=>({left:[e[0]-r,e[1]],right:[e[0]+r,e[1]],top:[e[0],e[1]-r],bottom:[e[0],e[1]+r]}[t]),l=s(t,e),u=s(a,n),c=EO(l,u,o);i.push(l,c,u)}}return i}(t,c,h,i);return l&&(c=$O(l,d[0])),u&&(h=$O(u,d[d.length-1])),SO([c,...d,h],e)}function wO(t,e){const n=new Set,r=new Set,i=new Set;return t.forEach((o=>{e(o).forEach((e=>{n.add(e),t.includes(e.source)&&t.includes(e.target)?r.add(e):i.add(e)}))})),{edges:Array.from(n),internal:Array.from(r),external:Array.from(i)}}function PO(t,e){const n=[];let r=t;for(;r;){n.push(r);const t=e(xN(r));if(!t)break;r=t}if(n.some((t=>t.style?.collapsed))){const t=n.reverse().findIndex(wC);return n[t]||n.at(-1)}return t}const NO=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",t/2,e/2],["Z"]];var CO=Object.freeze({__proto__:null,circle:(t,e)=>{const n=Math.max(t,e)/2;return[["M",-t/2,0],["A",n,n,0,1,0,2*n-t/2,0],["A",n,n,0,1,0,-t/2,0],["Z"]]},diamond:(t,e)=>[["M",-t/2,0],["L",0,-e/2],["L",t/2,0],["L",0,e/2],["Z"]],rect:(t,e)=>[["M",-t/2,-e/2],["L",t/2,-e/2],["L",t/2,e/2],["L",-t/2,e/2],["Z"]],simple:(t,e)=>[["M",t/2,-e/2],["L",-t/2,0],["L",t/2,e/2]],triangle:NO,triangleRect:(t,e)=>{const n=t/2,r=t/7,i=t-r;return[["M",-n,0],["L",0,-e/2],["L",0,e/2],["Z"],["M",i-n,-e/2],["L",i+r-n,-e/2],["L",i+r-n,e/2],["L",i-n,e/2],["Z"]]},vee:(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",2*t/3-t/2,0],["L",t/2,e/2],["Z"]]});class OO extends QC{type="edge";static defaultStyleProps={isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowSize:8,startArrowLineDash:0,startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"triangle",endArrow:!1,endArrowSize:8,endArrowLineDash:0,endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"triangle",loopPlacement:"top",loopClockwise:!0};constructor(t){super(DC({style:OO.defaultStyleProps},t))}get sourceNode(){const{context:t,sourceNode:e}=this.parsedAttributes;return t.element.getElement(e)}get targetNode(){const{context:t,targetNode:e}=this.parsedAttributes;return t.element.getElement(e)}getKeyStyle(t){const{loop:e,...n}=this.getGraphicStyle(t),{sourceNode:r,targetNode:i}=this;var o,a;return{d:e&&(a=i,(o=r)&&a&&o===a)?this.getLoopPath(t):this.getKeyPath(t),...IC(n,["halo","label","startArrow","endArrow"])}}getLoopPath(t){const{sourcePort:e,targetPort:n}=t,r=this.sourceNode,i=GN(r),o=Math.max(kN(i),FN(i)),{placement:a,clockwise:s,dist:l=o}=CC(this.getGraphicStyle(t),"loop");return RO(r,a,s,l,e,n)}getEndpoints(t){const{sourcePort:e,targetPort:n}=t,{sourceNode:r,targetNode:i}=this,[o,a]=XO(r,i,e,n);return[KO(o||r,a||i),KO(a||i,o||r)]}getHaloStyle(t){if(!1===t.halo)return!1;return{...this.getKeyStyle(t),...CC(this.getGraphicStyle(t),"halo")}}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;const e=CC(this.getGraphicStyle(t),"label"),{placement:n,offsetX:r,offsetY:i,autoRotate:o,maxWidth:a,...s}=e,l=function(t,e,n,r,i){let o="number"==typeof e?e:.5;"start"===e&&(o=0),"end"===e&&(o=.99);const a=uC(t.getPoint(o)),s=uC(t.getPoint(o+.01));let l="start"===e?"left":"end"===e?"right":"center";if(dC(a,s)||!n){const[e,n]=_O(t,o,r,i);return{transform:`translate(${e}, ${n})`,textAlign:l}}let u=Math.atan2(s[1]-a[1],s[0]-a[0]);s[0]<a[0]&&(l="center"===l?l:"left"===l?"right":"left",r*=-1,u+=Math.PI);const[c,h]=_O(t,o,r,i,u);return{textAlign:l,transform:`translate(${c}, ${h}) rotate(${u/Math.PI*180}deg)`}}(this.shapeMap.key,n,o,r,i),u=this.shapeMap.key.getLocalBounds(),c=function(t,e,n=1){return kC(QN(t[0],t[1])*n,e)}([u.min,u.max],a);return Object.assign({wordWrapWidth:c},l,s)}drawArrow(t,e){const n="start"===e,r=t["start"===e?"startArrow":"endArrow"],i=this.shapeMap.key;if(r){const e=this.getArrowStyle(t,n),r=e.src?kw:Uw,[o,a,s]=n?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],l=i.parsedStyle[o];l?l.attr(e):i.style[o]=new r({style:e}),i.style[a]=t[s]||e.width/2+ +e.lineWidth}else{const t=n?"markerStart":"markerEnd";i.style[t]?.destroy(),i.style[t]=null}}getArrowStyle(t,e){const n=this.getKeyStyle(t),r=e?"startArrow":"endArrow",{size:i,type:o,...a}=CC(this.getGraphicStyle(t),r),[s,l]=LC(i),u=(E(o)?o:CO[o]||NO)(s,l);return{...n,width:s,height:l,...u&&{d:u,fill:"simple"===o?"":n.stroke},...a}}drawLabelShape(t,e){this.upsert("label",HC,this.getLabelStyle(t),e)}drawHaloShape(t,e){this.upsert("halo",Uw,this.getHaloStyle(t),e)}drawKeyShape(t,e){return this.upsert("key",Uw,this.getKeyStyle(t),e)}render(t=this.parsedAttributes,e=this){this.drawKeyShape(t,e)&&(this.drawArrow(t,"start"),this.drawArrow(t,"end"),this.drawLabelShape(t,e),this.drawHaloShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(t,e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then((()=>this.onframe())),Reflect.set(t,e,n))}):n}}class IO extends OO{static defaultStyleProps={curvePosition:.5,curveOffset:20};constructor(t){super(DC({style:IO.defaultStyleProps},t))}getKeyPath(t){const[e,n]=this.getEndpoints(t),{controlPoints:r,curvePosition:i,curveOffset:o}=t,a=this.getControlPoints(e,n,function(t){return I(t)?[t,1-t]:t}(i),function(t){return I(t)?[t,-t]:t}(o),r);return xO(e,n,a)}getControlPoints(t,e,n,r,i){return 2===i?.length?i:[bO(t,e,n[0],r[0]),bO(t,e,n[1],r[1])]}}class LO extends IO{static defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};constructor(t){super(DC({style:LO.defaultStyleProps},t))}getControlPoints(t,e,n,r){const i=e[0]-t[0];return[[t[0]+i*n[0]+r[0],t[1]],[e[0]-i*n[1]+r[1],e[1]]]}}class DO extends IO{static defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};constructor(t){super(DC({style:DO.defaultStyleProps},t))}getControlPoints(t,e,n,r){const i=e[1]-t[1];return[[t[0],t[1]+i*n[0]+r[0]],[e[0],e[1]-i*n[1]+r[1]]]}}class BO extends OO{static defaultStyleProps={radius:0,controlPoints:[],router:!1,routerName:"orth",routerPadding:10};constructor(t){super(DC({style:BO.defaultStyleProps},t))}getKeyPath(t){const{radius:e}=t,{sourceNode:n,targetNode:r}=this,{sourcePoint:i,targetPoint:o,sourcePort:a,targetPort:s}=this.getEndpointsAndPorts(t),l=this.getControlPoints(t,i,o),u=KO(a||n,l[0]||s||r),c=KO(s||r,l[l.length-1]||a||n);return SO([u,...l,c],e)}getEndpointsAndPorts(t){const{sourcePort:e,targetPort:n}=t,{sourceNode:r,targetNode:i}=this,[o,a]=XO(r,i,e,n);return{sourcePoint:o?HO(o):r.getCenter(),targetPoint:a?HO(a):i.getCenter(),sourcePort:o,targetPort:a}}getControlPoints(t,e,n){const{controlPoints:r,router:i,routerPadding:o}=t,{sourceNode:a,targetNode:s}=this;if(!i)return[...r];return function(t,e,n,r,i,o){const a=[t,...i,e];let s=null;const l=[];for(let t=0,e=a.length;t<e-1;t++){const i=t+1,h=a[t],d=a[i],f=dC(u=h,c=d)||function(t,e){return t[0]===e[0]}(u,c);let p=null;0===t?i===e-1?n.intersects(r)?p=yO(h,d,n,r):f||(p=mO(h,d,n,r)):WN(d,n)?p=yO(h,d,n,GN(d,o),s):f||(p=gO(h,d,n)):i===e-1?WN(h,r)?p=yO(h,d,GN(h,o),r,s):f||(p=vO(h,d,r,s)):f||(p=pO(h,d,s)),p?(l.push(...p.points),s=p.direction):s=dO(h,d),i<e-1&&l.push(d)}var u,c;return l}(e,n,GN(a,o),GN(s,o),r,o)}getLoopPath(t){const{sourcePort:e,targetPort:n,radius:r}=t,i=this.sourceNode,o=GN(i),a=Math.max(kN(o),FN(o))/4,{placement:s,clockwise:l,dist:u=a}=CC(this.getGraphicStyle(t),"loop");return TO(i,r,s,l,u,e,n)}}class kO extends OO{static defaultStyleProps={curvePosition:.5,curveOffset:30};constructor(t){super(DC({style:kO.defaultStyleProps},t))}getKeyPath(t){const{curvePosition:e,curveOffset:n}=t,[r,i]=this.getEndpoints(t);return function(t,e,n){return[["M",t[0],t[1]],["Q",n[0],n[1],e[0],e[1]]]}(r,i,t.controlPoint||bO(r,i,e,n))}}function FO(t){return t instanceof JC&&"node"===t.type}function UO(t){return t instanceof uO}function GO(t){return FO(t)||function(t){return t instanceof OO}(t)||UO(t)}const zO={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],default:[.5,.5]};function VO(t,e,n=zO,r=!0){const i=[.5,.5],o=N(e)?J(n,e.toLocaleLowerCase(),i):e;if(!r&&N(e))return o;const[a,s]=o||i;return[t.min[0]+kN(t)*a,t.min[1]+FN(t)*s]}function WO(t){const e=t.getPorts();return(t.attributes.ports||[]).forEach(((n,r)=>{const{key:i,placement:o}=n;jO(n)&&(e[i||r]||=lC(t.getKey().getBounds(),o))})),e}function jO(t){const{r:e}=t;return!e||0===Number(e)}function HO(t){return LN(t)?t:t.getPosition()}function XO(t,e,n,r){return[YO(t,e,n,r),YO(e,t,r,n)]}function YO(t,e,n,r){const i=WO(t);if(n)return i[n];const o=Object.values(i);if(0===o.length)return;const a=o.map((t=>HO(t))),s=function(t,e){const n=WO(t);if(e)return[HO(n[e])];const r=Object.values(n);return r.length>0?r.map((t=>HO(t))):[t.getCenter()]}(e,r),[l]=function(t,e){let n=1/0,r=[t[0],e[0]];return t.forEach((t=>{e.forEach((e=>{const i=QN(t,e);i<n&&(n=i,r=[t,e])}))})),r}(a,s);return o.find((t=>HO(t)===l))}function KO(t,e){return UO(t)||FO(t)?qO(t,e):$O(t,e)}function $O(t,e){if(LN(t))return t;if(t.attributes.linkToCenter)return t.getPosition();return pC(LN(e)?e:FO(e)?e.getCenter():e.getPosition(),t.getBounds())}function qO(t,e){const n=LN(e)?e:FO(e)?e.getCenter():e.getPosition();return t.getIntersectPoint(n)||t.getCenter()}function ZO(t,e="bottom",n=0,r=0,i=!1){const o=e.split("-"),[a,s]=lC(t,e),l=o.includes("left")?"right":o.includes("right")?"left":"center";let u=o.includes("top")?"bottom":o.includes("bottom")?"top":"middle";return i&&(u="top"===u?"bottom":"bottom"===u?"top":u),{transform:`translate(${a+n}, ${s+r})`,textBaseline:u,textAlign:l}}class QO extends IN{static defaultOptions={enable:!0,animation:!0,trigger:dN.DBLCLICK};constructor(t,e){super(t,Object.assign({},QO.defaultOptions,e)),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`node:${e}`,this.onCollapseExpand),t.on(`combo:${e}`,this.onCollapseExpand)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`node:${e}`,this.onCollapseExpand),t.off(`combo:${e}`,this.onCollapseExpand)}onCollapseExpand=async t=>{if(!this.validate(t))return;const{target:e}=t;if(!GO(e))return;const n=e.id,{model:r,graph:i}=this.context,o=r.getElementDataById(n);if(!o)return!1;const{onCollapse:a,onExpand:s,animation:l}=this.options;wC(o)?(await i.expandElement(n,l),s?.(n)):(await i.collapseElement(n,l),a?.(n))};validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}const JO="g6-create-edge-assist-node-id";class tI extends IN{static defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:t=>t,onFinish:()=>{}};source;constructor(t,e){super(t,Object.assign({},tI.defaultOptions,e)),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),"click"===e?(t.on(`node:${dN.CLICK}`,this.handleCreateEdge),t.on(`combo:${dN.CLICK}`,this.handleCreateEdge),t.on(`canvas:${dN.CLICK}`,this.cancelEdge),t.on(`edge:${dN.CLICK}`,this.cancelEdge)):(t.on(`node:${dN.DRAG_START}`,this.handleCreateEdge),t.on(`combo:${dN.DRAG_START}`,this.handleCreateEdge),t.on(dN.POINTER_UP,this.drop)),t.on(dN.POINTER_MOVE,this.updateAssistEdge)}drop=async t=>{const{targetType:e}=t;["combo","node"].includes(e)&&this.source?await this.handleCreateEdge(t):await this.cancelEdge()};handleCreateEdge=async t=>{if(!this.validate(t))return;const{graph:e,canvas:n}=this.context,{style:r}=this.options;if(this.source)return this.createEdge(t),void await this.cancelEdge();n.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([t.target.id])[0],e.addNodeData([{id:JO,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}]}}]),e.addEdgeData([{id:"g6-create-edge-assist-edge-id",source:this.source,target:JO,style:{pointerEvents:"none",...r}}])};updateAssistEdge=async t=>{if(!this.source)return;const{model:e,element:n}=this.context;e.translateNodeTo(JO,[t.canvas.x,t.canvas.y]),await(n.draw({animation:!1,silence:!0})?.finished)};createEdge=t=>{const{graph:e}=this.context,{style:n,onFinish:r,onCreate:i}=this.options,o=t.target?.id;if(void 0===o||void 0===this.source)return;const a=this.getSelectedNodeIDs([t.target.id])?.[0];var s;const l=i({id:`${this.source}-${a}-${it[s=s||"g"]?it[s]+=1:it[s]=1,s+it[s]}`,source:this.source,target:a,style:n});e.addEdgeData([l]),r(l)};cancelEdge=async()=>{if(!this.source)return;const{graph:t,element:e,canvas:n}=this.context;n.setCursor("default"),t.removeNodeData([JO]),this.source=void 0,await(e.draw({animation:!1,silence:!0})?.finished)};getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map((t=>t.id)).concat(t)))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;t.off(`node:${dN.CLICK}`,this.handleCreateEdge),t.off(`combo:${dN.CLICK}`,this.handleCreateEdge),t.off(`canvas:${dN.CLICK}`,this.cancelEdge),t.off(`edge:${dN.CLICK}`,this.cancelEdge),t.off(`node:${dN.DRAG_START}`,this.handleCreateEdge),t.off(`combo:${dN.DRAG_START}`,this.handleCreateEdge),t.off(dN.POINTER_UP,this.drop),t.off(dN.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}}class eI extends IN{static defaultOptions={enable:!0,sensitivity:10};shortcut;defaultCursor;constructor(t,e){super(t,Object.assign({},eI.defaultOptions,e)),this.shortcut=new _C(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default",t.canvas.setCursor("grab")}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options,{graph:e}=this.context;if(M(t)){e.off(cN.DRAG,this.onDrag);const{up:n=[],down:r=[],left:i=[],right:o=[]}=t;this.shortcut.bind(n,(t=>this.onTranslate([0,1],t))),this.shortcut.bind(r,(t=>this.onTranslate([0,-1],t))),this.shortcut.bind(i,(t=>this.onTranslate([1,0],t))),this.shortcut.bind(o,(t=>this.onTranslate([-1,0],t)))}else e.on(cN.DRAG,this.onDrag)}onDrag=t=>{this.validate(t)&&"canvas"===t.targetType&&(this.translate([t.movement.x,t.movement.y],!1),this.options.onFinish?.())};async onTranslate(t,e){if(!this.validate(e))return;const{sensitivity:n}=this.options,r=-1*n;await this.translate($N(t,r),this.options.animation),this.options.onFinish?.()}async translate(t,e){await this.context.graph.translateBy(t,e)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}unbindEvents(){this.shortcut.unbindAll(),this.context.graph.off(cN.DRAG,this.onDrag)}destroy(){this.shortcut.destroy(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}}class nI extends IN{static defaultOptions={animation:!0,enable:t=>["node","combo"].includes(t.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5]};enable=!1;enableElements=["node","combo"];target=[];shadow;shadowOrigin=[0,0];hiddenEdges=[];get animation(){return!!this.options.shadow&&this.options.animation}constructor(t,e){super(t,Object.assign({},nI.defaultOptions,e)),this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),this.enableElements.forEach((e=>{t.on(`${e}:${dN.DRAG_START}`,this.onDragStart),t.on(`${e}:${dN.DRAG}`,this.onDrag),t.on(`${e}:${dN.DRAG_END}`,this.onDragEnd)})),["link"].includes(this.options.dropEffect)&&(t.on(`combo:${dN.DROP}`,this.onDrop),t.on(`canvas:${dN.DROP}`,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map((t=>t.id)).concat(t)))}getDelta(t){const e=this.context.graph.getZoom();return qN([t.dx,t.dy],e)}onDragStart(t){this.enable=this.validate(t),this.enable&&(this.context.batch?.startBatch(),this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target))}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";const{x:t=0,y:e=0}=this.shadow.attributes,[n,r]=KN([+t,+e],this.shadowOrigin);this.moveElement(this.target,[n,r])}this.showEdges(),this.options.onFinish?.(this.target),this.context.batch?.endBatch(),this.target=[]}onDrop=async t=>{if("link"!==this.options.dropEffect)return;const{model:e,element:n}=this.context,r=t.target.id;this.target.forEach((t=>{const n=e.getParentData(t,yN);n&&xN(n)===r&&e.refreshComboData(r),e.setParent(t,r,yN)})),await(n?.draw({animation:!0})?.finished)};validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}async moveElement(t,e){const{model:n,element:r}=this.context,{dropEffect:i}=this.options;t.forEach((t=>{const r=n.getElementType(t);"node"===r?n.translateNodeBy(t,e):"combo"===r&&n.translateComboBy(t,e)})),"move"===i&&t.forEach((t=>n.refreshComboData(t))),await(r.draw({animation:this.animation})?.finished)}moveShadow(t){if(!this.shadow)return;const{x:e=0,y:n=0}=this.shadow.attributes,[r,i]=t;this.shadow.attr({x:+e+r,y:+n+i})}createShadow(t){const e=CC(this.options,"shadow"),n=VN(t.map((t=>this.context.element.getElement(t).getBounds()))),[r,i]=n.min;this.shadowOrigin=[r,i];const[o,a]=UN(n),s={width:o,height:a,x:r,y:i};this.shadow?this.shadow.attr({...e,...s,visibility:"visible"}):(this.shadow=new Vw({style:{...e,...s,pointerEvents:"none",$layer:"transient"}}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||0===this.hiddenEdges.length||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){const{hideEdge:t,shadow:e}=this.options;if("none"===t||e)return;const{graph:n}=this.context;this.hiddenEdges="all"===t?n.getEdgeData().map(xN):Array.from(new Set(this.target.map((e=>n.getRelatedEdgesData(e,t).map(xN))).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){const{graph:t}=this.context;this.enableElements.forEach((e=>{t.off(`${e}:${dN.DRAG_START}`,this.onDragStart),t.off(`${e}:${dN.DRAG}`,this.onDrag),t.off(`${e}:${dN.DRAG_END}`,this.onDragEnd)})),t.off(`combo:${dN.DROP}`,this.onDrop),t.off(`canvas:${dN.DROP}`,this.onDrop)}destroy(){this.unbindEvents(),this.shadow?.destroy(),super.destroy()}}function rI(t,e,...n){if(e in t)return t[e](...n);if("instance"in t){const r=t.instance;if(e in r)return r[e](...n)}return null}function iI(t,e){if(e in t)return t[e];if("instance"in t){const n=t.instance;if(e in n)return n[e]}return null}class oI extends IN{static defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};constructor(t,e){super(t,Object.assign({},oI.defaultOptions,e)),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),MC.forEach((e=>{t.on(`${e}:${dN.CLICK}`,this.focus)}))}focus=async t=>{if(!this.validate(t))return;const{graph:e}=this.context;await e.focusElement(t.target.id,this.options.animation)};validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;MC.forEach((e=>{t.off(`${e}:${dN.CLICK}`,this.focus)}))}destroy(){this.unbindEvents(),super.destroy()}}class aI extends IN{static defaultOptions={animation:!1,enable:!0,degree:0,state:"active",inactiveState:void 0};isFrozen=!1;constructor(t,e){super(t,Object.assign({},aI.defaultOptions,e)),this.bindEvents()}toggleFrozen=t=>{this.isFrozen="dragstart"===t.type};bindEvents(){const{graph:t}=this.context;this.unbindEvents(),MC.forEach((e=>{t.on(`${e}:${dN.POINTER_OVER}`,this.hoverElement),t.on(`${e}:${dN.POINTER_OUT}`,this.hoverEndElement)}));const e=this.context.canvas.document;e.addEventListener(`${dN.DRAG_START}`,this.toggleFrozen),e.addEventListener(`${dN.DRAG_END}`,this.toggleFrozen)}hoverElement=t=>{this.validate(t)&&(this.updateElementsState(t,!0),this.options.onHover?.(t))};hoverEndElement=t=>{this.validate(t)&&(this.updateElementsState(t,!1),this.options.onHoverEnd?.(t))};updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.inactiveState)return;const{graph:n}=this.context,{targetType:r,target:i}=t,o=AC(n,r,i.id,this.options.degree),a={};if(this.options.state&&Object.assign(a,this.getElementsState(o,this.options.state,e)),this.options.inactiveState){const t=SN(n.getData(),!0).filter((t=>!o.includes(t)));Object.assign(a,this.getElementsState(t,this.options.inactiveState,e))}n.setElementState(a,this.options.animation)};getElementsState=(t,e,n)=>{const{graph:r}=this.context,i={};return t.forEach((t=>{const o=r.getElementState(t),a=n?[...o,e]:o.filter((t=>t!==e));i[t]=a})),i};validate(t){if(this.destroyed||this.isFrozen)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;MC.forEach((e=>{t.off(`${e}:${dN.POINTER_OVER}`,this.hoverElement),t.off(`${e}:${dN.POINTER_OUT}`,this.hoverEndElement)}));const e=this.context.canvas.document;e.removeEventListener(`${dN.DRAG_START}`,this.toggleFrozen),e.removeEventListener(`${dN.DRAG_END}`,this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}}class sI extends IN{static defaultOptions={enable:!0,sensitivity:1};shortcut;constructor(t,e){super(t,Object.assign({},sI.defaultOptions,e)),this.shortcut=new _C(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;this.shortcut.unbindAll();const{graph:e}=this.context;if(M(t)){e.off(cN.WHEEL,this.onWheel);const{up:n=[],down:r=[],left:i=[],right:o=[]}=t;this.shortcut.bind(n,(t=>this.scroll([0,-10],t))),this.shortcut.bind(r,(t=>this.scroll([0,10],t))),this.shortcut.bind(i,(t=>this.scroll([-10,0],t))),this.shortcut.bind(o,(t=>this.scroll([10,0],t)))}else this.graphDom?.addEventListener(cN.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}onWheel=async t=>{t.preventDefault();const e=t.deltaX,n=t.deltaY;await this.scroll([-e,-n],t)};formatDisplacement([t,e]){const{direction:n,sensitivity:r}=this.options;return t*=r,e*=r,"x"===n?e=0:"y"===n&&(t=0),[t,e]}async scroll(t,e){if(!this.validate(e))return;const{onFinish:n}=this.options,r=this.context.graph,i=this.formatDisplacement(t);await r.translateBy(i,!1),n?.()}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}destroy(){this.shortcut.destroy(),this.graphDom?.removeEventListener(cN.WHEEL,this.onWheel),super.destroy()}}class lI extends IN{static defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[]};shortcut;constructor(t,e){super(t,Object.assign({},lI.defaultOptions,e)),this.shortcut=new _C(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;if(this.shortcut.unbindAll(),S(t)&&(this.preventDefault(cN.WHEEL),this.shortcut.bind([...t,cN.WHEEL],(t=>{const{deltaX:e,deltaY:n}=t;this.zoom(-(n??e),t,!1)}))),M(t)){const{zoomIn:e=[],zoomOut:n=[],reset:r=[]}=t;this.shortcut.bind(e,(t=>this.zoom(10,t,this.options.animation))),this.shortcut.bind(n,(t=>this.zoom(-10,t,this.options.animation))),this.shortcut.bind(r,this.onReset)}}zoom=async(t,e,n)=>{if(!this.validate(e))return;const{graph:r}=this.context;let i;"viewport"in e&&(i=uC(e.viewport));const{sensitivity:o,onFinish:a}=this.options,s=1+O(t,-50,50)*o/100,l=r.getZoom();await r.zoomTo(l*s,n,i),a?.()};onReset=async()=>{await this.context.graph.zoomTo(1,this.options.animation)};validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return E(e)?e(t):!!e}preventDefault(t){const e=this.context.canvas.getContainer();e&&e.addEventListener(t,(t=>t.preventDefault()))}destroy(){this.shortcut.destroy(),super.destroy()}}var uI={assign:Object.assign,getHeight:function(t,e,n,r){return void 0===r&&(r="height"),"center"===n?(t[r]+e[r])/2:t.height}},cI=uI,hI={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function dI(t,e){var n=this;if(n.vgap=n.hgap=0,t instanceof dI)return t;n.data=t;var r=e.getHGap(t),i=e.getVGap(t);return n.preH=e.getPreH(t),n.preV=e.getPreV(t),n.width=e.getWidth(t),n.height=e.getHeight(t),n.width+=n.preH,n.height+=n.preV,n.id=e.getId(t),n.x=n.y=0,n.depth=0,n.children||(n.children=[]),n.addGap(r,i),n}cI.assign(dI.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){var n=this;n.hgap+=t,n.vgap+=e,n.width+=2*t,n.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode((function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)})),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode((function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV}))},right2left:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.x=t.x-2*(t.x-e.left)-t.width})),t.translate(e.width,0)},bottom2top:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.y=t.y-2*(t.y-e.top)-t.height})),t.translate(0,e.height)}});var fI=function(t,e,n){void 0===e&&(e={});var r,i=new dI(t,e=cI.assign({},hI,e)),o=[i];if(!n&&!t.collapsed)for(;r=o.shift();)if(!r.data.collapsed){var a=e.getChildren(r.data),s=a?a.length:0;if(r.children=new Array(s),a&&s)for(var l=0;l<s;l++){var u=new dI(a[l],e);r.children[l]=u,o.push(u),u.parent=r,u.depth=r.depth+1}}return i},pI=fI,gI=function(){function t(t,e){void 0===e&&(e={});this.options=e,this.rootNode=pI(t,e)}return t.prototype.execute=function(){throw new Error("please override this method")},t}(),vI=gI;function mI(t,e,n,r){void 0===r&&(r=[]);var i=this;i.w=t||0,i.h=e||0,i.y=n||0,i.x=0,i.c=r||[],i.cs=r.length,i.prelim=0,i.mod=0,i.shift=0,i.change=0,i.tl=null,i.tr=null,i.el=null,i.er=null,i.msel=0,i.mser=0}function yI(t,e,n){n?t.y+=e:t.x+=e,t.children.forEach((function(t){yI(t,e,n)}))}function EI(t,e){var n=e?t.y:t.x;return t.children.forEach((function(t){n=Math.min(EI(t,e),n)})),n}function _I(t,e){yI(t,-EI(t,e),e)}function bI(t,e,n){n?e.y=t.x:e.x=t.x,t.c.forEach((function(t,r){bI(t,e.children[r],n)}))}function xI(t,e,n){void 0===n&&(n=0),e?(t.x=n,n+=t.width):(t.y=n,n+=t.height),t.children.forEach((function(t){xI(t,e,n)}))}mI.fromNode=function(t,e){if(!t)return null;var n=[];return t.children.forEach((function(t){n.push(mI.fromNode(t,e))})),e?new mI(t.height,t.width,t.x,n):new mI(t.width,t.height,t.y,n)};var SI=fI,MI=function(t,e){for(var n=SI(t.data,e,!0),r=SI(t.data,e,!0),i=t.children.length,o=Math.round(i/2),a=e.getSide||function(t,e){return e<o?"right":"left"},s=0;s<i;s++){var l=t.children[s];"right"===a(l,s)?r.children.push(l):n.children.push(l)}return n.eachNode((function(t){t.isRoot()||(t.side="left")})),r.eachNode((function(t){t.isRoot()||(t.side="right")})),{left:n,right:r}},AI=MI,RI=["LR","RL","TB","BT","H","V"],TI=["LR","RL","H"],wI=RI[0],PI=function(t,e,n){var r=e.direction||wI;if(e.isHorizontal=function(t){return TI.indexOf(t)>-1}(r),r&&-1===RI.indexOf(r))throw new TypeError("Invalid direction: "+r);if(r===RI[0])n(t,e);else if(r===RI[1])n(t,e),t.right2left();else if(r===RI[2])n(t,e);else if(r===RI[3])n(t,e),t.bottom2top();else if(r===RI[4]||r===RI[5]){var i=AI(t,e),o=i.left,a=i.right;n(o,e),n(a,e),e.isHorizontal?o.right2left():o.bottom2top(),a.translate(o.x-a.x,o.y-a.y),t.x=o.x,t.y=a.y;var s=t.getBoundingBox();e.isHorizontal?s.top<0&&t.translate(0,-s.top):s.left<0&&t.translate(-s.left,0)}var l=e.fixedRoot;return void 0===l&&(l=!0),l&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t};function NI(t,e){return NI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},NI(t,e)}var CI=function(t,e){void 0===e&&(e={});var n=e.isHorizontal;function r(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function i(t,e,n){for(var r=t.c[e-1],i=r.mod,u=t.c[e],c=u.mod;null!==r&&null!==u;){l(r)>n.low&&(n=n.nxt);var h=i+r.prelim+r.w-(c+u.prelim);h>0&&(c+=h,o(t,e,n.index,h));var d=l(r),f=l(u);d<=f&&null!==(r=s(r))&&(i+=r.mod),d>=f&&null!==(u=a(u))&&(c+=u.mod)}!r&&u?function(t,e,n,r){var i=t.c[0].el;i.tl=n;var o=r-n.mod-t.c[0].msel;i.mod+=o,i.prelim-=o,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,u,c):r&&!u&&function(t,e,n,r){var i=t.c[e].er;i.tr=n;var o=r-n.mod-t.c[e].mser;i.mod+=o,i.prelim-=o,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,r,i)}function o(t,e,n,r){t.c[e].mod+=r,t.c[e].msel+=r,t.c[e].mser+=r,function(t,e,n,r){if(n!==e-1){var i=e-n;t.c[n+1].shift+=r/i,t.c[e].shift-=r/i,t.c[e].change-=r-r/i}}(t,e,n,r)}function a(t){return 0===t.cs?t.tl:t.c[0]}function s(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function l(t){return t.y+t.h}function u(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}xI(t,n);var c=mI.fromNode(t,n);return function t(e){if(0!==e.cs){t(e.c[0]);for(var n=u(l(e.c[0].el),0,null),o=1;o<e.cs;++o){t(e.c[o]);var a=l(e.c[o].er);i(e,o,n),n=u(a,o,n)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(e),r(e)}else r(e)}(c),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,r=0;r<t.cs;r++)n+=(e+=t.c[r].shift)+t.c[r].change,t.c[r].mod+=n}(e);for(var r=0;r<e.cs;r++)t(e.c[r],n)}(c,0),bI(c,t,n),_I(t,n),t},OI=PI,II=uI,LI=function(t){function e(){return t.apply(this,arguments)||this}var n,r;return r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,NI(n,r),e.prototype.execute=function(){return OI(this.rootNode,this.options,CI)},e}(vI),DI={};var BI=function(t,e){return e=II.assign({},DI,e),new LI(t,e).execute()},kI=uI;function FI(t,e){void 0===e&&(e=[]);var n=this;n.x=n.y=0,n.leftChild=n.rightChild=null,n.height=0,n.children=e}var UI={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};function GI(t,e,n){n?(e.x=t.x,e.y=t.y):(e.x=t.y,e.y=t.x),t.children.forEach((function(t,r){GI(t,e.children[r],n)}))}function zI(t,e){return zI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zI(t,e)}var VI=function(t,e){void 0===e&&(e={}),e=kI.assign({},UI,e);var n,r=0;var i=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>r&&(r=e.depth);var n=e.children,i=n.length,o=new FI(e.height,[]);return n.forEach((function(e,n){var r=t(e);o.children.push(r),0===n&&(o.leftChild=r),n===i-1&&(o.rightChild=r)})),o.originNode=e,o.isLeaf=e.isLeaf(),o}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=r;else{var n=e.children.map((function(e){return t(e)})),i=Math.min.apply(null,n);e.drawingDepth=i-1}return e.drawingDepth}(i),function t(r){r.x=r.drawingDepth*e.rankSep,r.isLeaf?(r.y=0,n&&(r.y=n.y+n.height+e.nodeSep,r.originNode.parent!==n.originNode.parent&&(r.y+=e.subTreeSep)),n=r):(r.children.forEach((function(e){t(e)})),r.y=(r.leftChild.y+r.rightChild.y)/2)}(i),GI(i,t,e.isHorizontal),t},WI=PI,jI=uI,HI=function(t){function e(){return t.apply(this,arguments)||this}var n,r;return r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,zI(n,r),e.prototype.execute=function(){var t=this;return t.rootNode.width=0,WI(t.rootNode,t.options,VI)},e}(vI),XI={};var YI=function(t,e){return e=jI.assign({},XI,e),new HI(t,e).execute()},KI=uI;function $I(t,e){return $I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$I(t,e)}var qI=vI,ZI=function(t,e,n,r){var i=null;t.eachNode((function(t){!function(t,e,n,r,i){var o="function"==typeof n?n(t):n*t.depth;if(!r)try{if(t.id===t.parent.children[0].id)return t.x+=o,void(t.y=e?e.y:0)}catch(t){}if(t.x+=o,e){if(t.y=e.y+KI.getHeight(e,t,i),e.parent&&t.parent.id!==e.parent.id){var a=e.parent,s=a.y+KI.getHeight(a,t,i);t.y=s>t.y?s:t.y}}else t.y=0}(t,i,e,n,r),i=t}))},QI=MI,JI=uI,tL=["LR","RL","H"],eL=tL[0],nL=function(t){function e(){return t.apply(this,arguments)||this}var n,r;return r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,$I(n,r),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,r=void 0===n?20:n,i=t.dropCap,o=void 0===i||i,a=t.direction,s=void 0===a?eL:a,l=t.align;if(s&&-1===tL.indexOf(s))throw new TypeError("Invalid direction: "+s);if(s===tL[0])ZI(e,r,o,l);else if(s===tL[1])ZI(e,r,o,l),e.right2left();else if(s===tL[2]){var u=QI(e,t),c=u.left,h=u.right;ZI(c,r,o,l),c.right2left(),ZI(h,r,o,l);var d=c.getBoundingBox();h.translate(d.width,0),e.x=h.x-e.width/2}return e},e}(qI),rL={};var iL=function(t,e){return e=JI.assign({},rL,e),new nL(t,e).execute()},oL=uI;function aL(t,e){var n=0;return t.children.length?t.children.forEach((function(t){n+=aL(t,e)})):n=t.height,t._subTreeSep=e.getSubTreeSep(t.data),t.totalHeight=Math.max(t.height,n)+2*t._subTreeSep,t.totalHeight}function sL(t){var e=t.children,n=e.length;if(n){e.forEach((function(t){sL(t)}));var r=e[0],i=e[n-1],o=i.y-r.y+i.height,a=0;if(e.forEach((function(t){a+=t.totalHeight})),o>t.height)t.y=r.y+o/2-t.height/2;else if(1!==e.length||t.height>a){var s=t.y+(t.height-o)/2-r.y;e.forEach((function(t){t.translate(0,s)}))}else t.y=(r.y+r.height/2+i.y+i.height/2)/2-t.height/2}}var lL={getSubTreeSep:function(){return 0}};function uL(t,e){return uL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},uL(t,e)}var cL=function(t,e){void 0===e&&(e={}),e=oL.assign({},lL,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse((function(t){t.x=t.parent.x+t.parent.width})),t.parent=null,aL(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode((function(t){var e=t.children,n=e.length;if(n){var r=e[0];if(r.startY=t.startY+t._subTreeSep,1===n)r.y=t.y+t.height/2-r.height/2;else{r.y=r.startY+r.totalHeight/2-r.height/2;for(var i=1;i<n;i++){var o=e[i];o.startY=e[i-1].startY+e[i-1].totalHeight,o.y=o.startY+o.totalHeight/2-o.height/2}}}})),sL(t)},hL=PI,dL=uI,fL=function(t){function e(){return t.apply(this,arguments)||this}var n,r;return r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,uL(n,r),e.prototype.execute=function(){return hL(this.rootNode,this.options,cL)},e}(vI),pL={};var gL=function(t,e){return e=dL.assign({},pL,e),new fL(t,e).execute()},vL={compactBox:BI,dendrogram:YI,indented:iL,mindmap:gL};function mL(t,e=!0){const n=document.createElement("div");return n.setAttribute("class",`g6-${t}`),n.style.position="absolute",n.style.display="block",e&&(n.style.inset="0px",n.style.height="100%",n.style.width="100%",n.style.overflow="hidden",n.style.pointerEvents="none"),n}function yL(t,e="div",n={},r="",i=document.body){const o=document.getElementById(t);o&&o.remove();const a=document.createElement(e);return a.innerHTML=r,a.id=t,Object.assign(a.style,n),i.appendChild(a),a}class EL extends ON{}class _L extends EL{static defaultOptions={transition:"background 0.5s",backgroundSize:"cover"};$element=mL("background");constructor(t,e){super(t,Object.assign({},_L.defaultOptions,e));this.context.canvas.getContainer().prepend(this.$element),this.update(e)}async update(t){super.update(t),Object.assign(this.$element.style,rt(this.options,["key","type"]))}destroy(){super.destroy(),this.$element.remove()}}function bL(t,e,n,r,i,o){const a=n-t,s=r-e;let l=i-t,u=o-e,c=l*a+u*s,h=0;c<=0?h=0:(l=a-l,u=s-u,c=l*a+u*s,h=c<=0?0:c*c/(a*a+s*s));const d=l*l+u*u-h;return d<0?0:d}function xL(t,e,n,r){return(t-n)*(t-n)+(e-r)*(e-r)}function SL(t,e,n,r,i){return xL(t,e,n,r)<i*i}function ML(t){const e=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),r=Math.min(t.y1,t.y2),i=Math.max(t.y1,t.y2);return{x:e,y:r,x2:n,y2:i,width:n-e,height:i-r}}class AL{constructor(t,e,n,r){this.x1=t,this.y1=e,this.x2=n,this.y2=r}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new AL(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2)return!1;if(e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2)return!1;if(t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;return t<=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1)}distSquare(t,e){return bL(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,n){if(this.x1<this.x2){if(t<this.x1-n||t>this.x2+n)return!1}else if(t<this.x2-n||t>this.x1+n)return!1;if(this.y1<this.y2){if(e<this.y1-n||e>this.y2+n)return!1}else if(e<this.y2-n||e>this.y1+n)return!1;return!0}}var RL,TL;!function(t){t[t.POINT=1]="POINT",t[t.PARALLEL=2]="PARALLEL",t[t.COINCIDENT=3]="COINCIDENT",t[t.NONE=4]="NONE"}(RL||(RL={}));class wL{constructor(t,e=0,n=0){this.state=t,this.x=e,this.y=n}}function PL(t,e){const n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),r=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),i=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(i){const e=n/i,o=r/i;return 0<=e&&e<=1&&0<=o&&o<=1?new wL(RL.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new wL(RL.NONE)}return new wL(0===n||0===r?RL.COINCIDENT:RL.PARALLEL)}function NL(t,e){const n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),r=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),i=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(i){const t=n/i,e=r/i;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function CL(t,e,n){const r=new Set;return t.width<=0?(r.add(TL.LEFT),r.add(TL.RIGHT)):e<t.x?r.add(TL.LEFT):e>t.x+t.width&&r.add(TL.RIGHT),t.height<=0?(r.add(TL.TOP),r.add(TL.BOTTOM)):n<t.y?r.add(TL.TOP):n>t.y+t.height&&r.add(TL.BOTTOM),r}function OL(t,e){let n=e.x1,r=e.y1;const i=e.x2,o=e.y2,a=Array.from(CL(t,i,o));if(0===a.length)return!0;let s=CL(t,n,r);for(;0!==s.size;){for(const t of a)if(s.has(t))return!1;if(s.has(TL.RIGHT)||s.has(TL.LEFT)){let e=t.x;s.has(TL.RIGHT)&&(e+=t.width),r+=(e-n)*(o-r)/(i-n),n=e}else{let e=t.y;s.has(TL.BOTTOM)&&(e+=t.height),n+=(e-r)*(i-n)/(o-r),r=e}s=CL(t,n,r)}return!0}function IL(t,e){let n=Number.POSITIVE_INFINITY,r=0;function i(t,i,o,a){let s=NL(e,new AL(t,i,o,a));s=Math.abs(s-.5),s>=0&&s<=1&&(r++,s<n&&(n=s))}return i(t.x,t.y,t.x2,t.y),i(t.x,t.y,t.x,t.y2),r>1?n:(i(t.x,t.y2,t.x2,t.y2),r>1?n:(i(t.x2,t.y,t.x2,t.y2),0===r?-1:n))}function LL(t,e){let n=0;const r=PL(t,new AL(e.x,e.y,e.x2,e.y));n+=r.state===RL.POINT?1:0;const i=PL(t,new AL(e.x,e.y,e.x,e.y2));n+=i.state===RL.POINT?1:0;const o=PL(t,new AL(e.x,e.y2,e.x2,e.y2));n+=o.state===RL.POINT?1:0;const a=PL(t,new AL(e.x2,e.y,e.x2,e.y2));return n+=a.state===RL.POINT?1:0,{top:r,left:i,bottom:o,right:a,count:n}}!function(t){t[t.LEFT=0]="LEFT",t[t.TOP=1]="TOP",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM=3]="BOTTOM"}(TL||(TL={}));class DL{constructor(t,e,n,r){this.x=t,this.y=e,this.width=n,this.height=r}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new DL(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new DL(this.x,this.y,this.width,this.height)}add(t){const e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),r=Math.max(this.x2,t.x+t.width),i=Math.max(this.y2,t.y+t.height);this.x=e,this.y=n,this.width=r-e,this.height=i-n}addPoint(t){const e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),r=Math.max(this.x2,t.x),i=Math.max(this.y2,t.y);this.x=e,this.y=n,this.width=r-e,this.height=i-n}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0||t.width<=0||t.height<=0)&&(t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2)}distSquare(t,e){if(this.containsPt(t,e))return 0;const n=CL(this,t,e);return n.has(TL.TOP)?n.has(TL.LEFT)?xL(t,e,this.x,this.y):n.has(TL.RIGHT)?xL(t,e,this.x2,this.y):(this.y-e)*(this.y-e):n.has(TL.BOTTOM)?n.has(TL.LEFT)?xL(t,e,this.x,this.y2):n.has(TL.RIGHT)?xL(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):n.has(TL.LEFT)?(this.x-t)*(this.x-t):n.has(TL.RIGHT)?(t-this.x2)*(t-this.x2):0}}class BL{constructor(t,e,n){this.cx=t,this.cy=e,this.radius=n}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new BL(t.cx,t.cy,t.radius)}containsPt(t,e){return xL(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){const n=xL(this.cx,this.cy,t,e);if(n<this.radius*this.radius)return 0;const r=Math.sqrt(n)-this.radius;return r*r}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class kL{constructor(t,e=0,n=0,r=0,i=0,o=10,a=10,s=new Float32Array(Math.max(0,o*a)).fill(0)){this.pixelGroup=t,this.i=e,this.j=n,this.pixelX=r,this.pixelY=i,this.width=o,this.height=a,this.area=s}createSub(t,e){return new kL(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new kL(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new kL(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){const e=this.scaleX(t.x),n=this.scaleY(t.y),r=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),i=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup));return new DL(e,n,r-e,i-n)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){const n=Math.ceil(e/this.pixelGroup),r=this.boundX(t.x-n),i=this.boundY(t.y-n),o=this.boundX(t.x2+n),a=this.boundY(t.y2+n);return new DL(r,i,o-r,a-i)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=n)}set(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=n)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;const n=this.width,r=t.width,i=Math.max(0,t.i),o=Math.max(0,t.j),a=Math.min(t.i+t.width,n),s=Math.min(t.j+t.height,this.height);if(!(s<=0||a<=0||i>=n||s>=this.height))for(let l=o;l<s;l++){const o=(l-t.j)*r,s=l*n;for(let n=i;n<a;n++){const r=t.area[n-t.i+o];0!==r&&(this.area[n+s]+=e*r)}}}fill(t){this.area.fill(t)}fillArea(t,e){const n=t.x+t.y*this.width;for(let r=0;r<t.height;r++){const i=n+r*this.width;this.area.fill(e,i,i+t.width)}}fillHorizontalLine(t,e,n,r){const i=t+e*this.width;this.area.fill(r,i,i+n)}fillVerticalLine(t,e,n,r){const i=t+e*this.width;for(let t=0;t<n;t++)this.area[i+t*this.width]=r}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){const n=e*this.width;for(let e=0;e<this.width;e++){t+=this.area[n+e].toFixed(1).padStart(6),t+=" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);const n=this.area.reduce(((t,e)=>Math.min(t,e)),Number.POSITIVE_INFINITY),r=this.area.reduce(((t,e)=>Math.max(t,e)),Number.NEGATIVE_INFINITY),i=t=>(t-n)/(r-n);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const r=this.area[e+n*this.width];t.fillStyle=`rgba(0, 0, 0, ${i(r)})`,t.fillRect(e,n,1,1)}t.restore()}drawThreshold(t,e,n=!0){if(!(this.width<=0||this.height<=0)){t.save(),n&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++){const i=this.area[n+r*this.width];t.fillStyle=i>e?"black":"white",t.fillRect(n,r,1,1)}t.restore()}}}function FL(t,e){const n=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(n):n(t)}function UL(t,e,n){return GL(Object.assign(ML(t),{distSquare:(e,n)=>bL(t.x1,t.y1,t.x2,t.y2,e,n)}),e,n)}function GL(t,e,n){const r=FL(t,n),i=e.scale(r),o=e.createSub(i,r);return function(t,e,n,r){const i=n*n;for(let o=0;o<t.height;o++)for(let a=0;a<t.width;a++){const s=r(e.invertScaleX(t.i+a),e.invertScaleY(t.j+o));if(0!==s){if(s<i){const e=n-Math.sqrt(s);t.set(a,o,e*e)}}else t.set(a,o,i)}}(o,e,n,((e,n)=>t.distSquare(e,n))),o}function zL(t,e){return{x:t,y:e}}function VL(t,e,n,r){if(0===t.length)return[];const i=function(t){if(t.length<2)return t;let e=0,n=0;return t.forEach((t=>{e+=t.cx,n+=t.cy})),e/=t.length,n/=t.length,t.map((t=>{const r=e-t.cx,i=n-t.cy;return[t,r*r+i*i]})).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}(t);return i.map(((t,o)=>{const a=i.slice(0,o);return function(t,e,n,r,i){const o=zL(e.cx,e.cy),a=function(t,e,n){let r=Number.POSITIVE_INFINITY;return e.reduce(((e,i)=>{const o=xL(t.x,t.y,i.cx,i.cy);if(o>r)return e;const a=new AL(t.x,t.y,i.cx,i.cy),s=function(t,e){return t.reduce(((t,n)=>OL(n,e)&&function(t,e){function n(t,n,r,i){let o=NL(e,new AL(t,n,r,i));return o=Math.abs(o-.5),o>=0&&o<=1?1:0}let r=n(t.x,t.y,t.x2,t.y);return r+=n(t.x,t.y,t.x,t.y2),r>1||(r+=n(t.x,t.y2,t.x2,t.y2),r>1||(r+=n(t.x2,t.y,t.x2,t.y2),r>0))}(n,e)?t+1:t),0)}(n,a);return o*(s+1)*(s+1)<r&&(e=i,r=o*(s+1)*(s+1)),e}),null)}(o,n,t);if(null==a)return[];const s=function(t,e,n,r){const i=[],o=[];o.push(t);let a=!0;for(let t=0;t<n&&a;t++)for(a=!1;!a&&o.length>0;){const t=o.pop(),n=HL(e,t),s=n?LL(t,n):null;if(!n||!s||2!==s.count){a||i.push(t);continue}let l=r,u=XL(n,l,s,!0),c=jL(u,o)||jL(u,i),h=WL(u,e);for(;!c&&h&&l>=1;)l/=1.5,u=XL(n,l,s,!0),c=jL(u,o)||jL(u,i),h=WL(u,e);if(!u||c||h||(o.push(new AL(t.x1,t.y1,u.x,u.y)),o.push(new AL(u.x,u.y,t.x2,t.y2)),a=!0),a)continue;l=r,u=XL(n,l,s,!1);let d=jL(u,o)||jL(u,i);for(h=WL(u,e);!d&&h&&l>=1;)l/=1.5,u=XL(n,l,s,!1),d=jL(u,o)||jL(u,i),h=WL(u,e);u&&!d&&(o.push(new AL(t.x1,t.y1,u.x,u.y)),o.push(new AL(u.x,u.y,t.x2,t.y2)),a=!0),a||i.push(t)}for(;o.length>0;)i.push(o.pop());return i}(new AL(o.x,o.y,a.cx,a.cy),t,r,i);return function(t,e){const n=[];for(;t.length>0;){const r=t.pop();if(0===t.length){n.push(r);break}const i=t.pop(),o=new AL(r.x1,r.y1,i.x2,i.y2);HL(e,o)?(n.push(r),t.push(i)):t.push(o)}return n}(s,t)}(e,t,a,n,r)})).flat()}function WL(t,e){return e.some((e=>e.containsPt(t.x,t.y)))}function jL(t,e){return e.some((e=>!!SL(e.x1,e.y1,t.x,t.y,.001)||!!SL(e.x2,e.y2,t.x,t.y,.001)))}function HL(t,e){let n=Number.POSITIVE_INFINITY,r=null;for(const i of t){if(!OL(i,e))continue;const t=IL(i,e);t>=0&&t<n&&(r=i,n=t)}return r}function XL(t,e,n,r){const i=n.top,o=n.left,a=n.bottom,s=n.right;if(r){if(o.state===RL.POINT){if(i.state===RL.POINT)return zL(t.x-e,t.y-e);if(a.state===RL.POINT)return zL(t.x-e,t.y2+e);const n=t.width*t.height;return t.width*(.5*(o.y-t.y+(s.y-t.y)))<.5*n?o.y>s.y?zL(t.x-e,t.y-e):zL(t.x2+e,t.y-e):o.y<s.y?zL(t.x-e,t.y2+e):zL(t.x2+e,t.y2+e)}if(s.state===RL.POINT){if(i.state===RL.POINT)return zL(t.x2+e,t.y-e);if(a.state===RL.POINT)return zL(t.x2+e,t.y2+e)}const n=t.height*t.width;return t.height*(.5*(i.x-t.x+(s.x-t.x)))<.5*n?i.x>a.x?zL(t.x-e,t.y-e):zL(t.x-e,t.y2+e):i.x<a.x?zL(t.x2+e,t.y-e):zL(t.x2+e,t.y2+e)}if(o.state===RL.POINT){if(i.state===RL.POINT)return zL(t.x2+e,t.y2+e);if(a.state===RL.POINT)return zL(t.x2+e,t.y-e);const n=t.height*t.width;return t.width*(.5*(o.y-t.y+(s.y-t.y)))<.5*n?o.y>s.y?zL(t.x2+e,t.y2+e):zL(t.x-e,t.y2+e):o.y<s.y?zL(t.x2+e,t.y-e):zL(t.x-e,t.y-e)}if(s.state===RL.POINT){if(i.state===RL.POINT)return zL(t.x-e,t.y2+e);if(a.state===RL.POINT)return zL(t.x-e,t.y-e)}const l=t.height*t.width;return t.height*(.5*(i.x-t.x+(s.x-t.x)))<.5*l?i.x>a.x?zL(t.x2+e,t.y2+e):zL(t.x2+e,t.y-e):i.x<a.x?zL(t.x-e,t.y2+e):zL(t.x-e,t.y-e)}function YL(t,e,n,r){if(!(t.closed?n<t.length:n<t.length-1))return!1;const i=t.get(e),o=t.get(n+1);for(let a=e+1;a<=n;a++){const e=t.get(a);if(bL(i.x,i.y,o.x,o.y,e.x,e.y)>r)return!1}return!0}function KL(t,e){switch(t){case-2:return(((3-e)*e-3)*e+1)/6;case-1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw new Error("unknown error")}}class $L{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){const e=t,n=this.points.length;return t<0?this.closed?this.get(t+n):this.points[0]:t>=n?this.closed?this.get(t-n):this.points[n-1]:this.points[e]}get length(){return this.points.length}toString(t=1/0){const e=this.points;if(0===e.length)return"";const n="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;const e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t);let r="M";for(const t of e)r+=`${n(t.x)},${n(t.y)} L`;return r=r.slice(0,-1),this.closed&&(r+=" Z"),r}draw(t){const e=this.points;if(0!==e.length){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(const n of e)t.lineTo(n.x,n.y);this.closed&&t.closePath()}}sample(t){return function(t=8){return e=>{let n=t,r=e.length;if(n>1)for(r=Math.floor(e.length/n);r<3&&n>1;)n-=1,r=Math.floor(e.length/n);const i=[];for(let t=0,o=0;o<r;o++,t+=n)i.push(e.get(t));return new $L(i)}}(t)(this)}simplify(t){return function(t=0){return e=>{if(t<0||e.length<3)return e;const n=[];let r=0;const i=t*t;for(;r<e.length;){let t=r+1;for(;YL(e,r,t,i);)t++;n.push(e.get(r)),r=t}return new $L(n)}}(t)(this)}bSplines(t){return function(t=6){function e(t,e,n){let r=0,i=0;for(let o=-2;o<=1;o++){const a=t.get(e+o),s=KL(o,n);r+=s*a.x,i+=s*a.y}return{x:r,y:i}}return n=>{if(n.length<3)return n;const r=[],i=n.closed,o=n.length+3-1+(i?0:2);r.push(e(n,2-(i?0:2),0));for(let a=2-(i?0:2);a<o;a++)for(let i=1;i<=t;i++)r.push(e(n,a,i/t));return new $L(r)}}(t)(this)}apply(t){return t(this)}containsElements(t){const e=function(t){if(0===t.length)return null;const e=t[0],n=new DL(e.x,e.y,0,0);for(const e of t)n.addPoint(e);return n}(this.points);return!!e&&t.every((t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy)))}withinArea(t,e){if(0===this.length)return!1;let n=0;const r=this.points[0],i=new AL(r.x,r.y,r.x,r.y);for(let r=1;r<this.points.length;r++){const o=this.points[r];i.x1=i.x2,i.y1=i.y2,i.x2=o.x,i.y2=o.y,i.cuts(t,e)&&n++}return i.x1=i.x2,i.y1=i.y2,i.x2=r.x,i.y2=r.y,i.cuts(t,e)&&n++,n%2==1}}class qL{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;const e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new $L(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}const ZL=0,QL=1,JL=2,tD=3;function eD(t,e){const n=2*(Math.floor(t.width)+Math.floor(t.height)),r=new qL(n);function i(n,r,i,o){const a=t.get(n,r);return Number.isNaN(a)?Number.NaN:a>e?i+o:i}function o(t,e){let n=ZL;return n=i(t,e,n,1),n=i(t+1,e,n,2),n=i(t,e+1,n,4),n=i(t+1,e+1,n,8),Number.isNaN(n)?-1:n}let a=QL;function s(e,n){let i=e,s=n,l=t.invertScaleX(i),u=t.invertScaleY(s);for(let e=0;e<t.width*t.height;e++){const e={x:l,y:u};if(r.contains(e)){if(r.isFirst(e))return!0}else r.add(e);const n=o(i,s);switch(n){case-1:return!0;case 0:case 3:case 2:case 7:a=JL;break;case 12:case 14:case 4:a=tD;break;case 6:a=a===ZL?tD:JL;break;case 1:case 13:case 5:a=ZL;break;case 9:a=a===JL?ZL:QL;break;case 10:case 8:case 11:a=QL;break;default:return console.warn("Marching squares invalid state: "+n),!0}switch(a){case ZL:s--,u-=t.pixelGroup;break;case QL:s++,u+=t.pixelGroup;break;case tD:i--,l-=t.pixelGroup;break;case JL:i++,l+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+n),!0}}return!0}for(let n=0;n<t.width;n++)for(let i=0;i<t.height;i++){if(t.get(n,i)<=e)continue;const a=o(n,i);if(!(a<0||15===a)&&s(n,i))return r.path()}return null}const nD={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};function rD(t){return null!=t&&"number"==typeof t.radius}function iD(t,e){if(rD(t)!==rD(e))return!1;if(rD(t)){const n=e;return t.cx===n.cx&&t.cy===n.cy&&t.radius===n.radius}const n=e;return t.x===n.x&&t.y===n.y&&t.width===n.width&&t.height===n.height}var oD;!function(t){t[t.MEMBERS=0]="MEMBERS",t[t.NON_MEMBERS=1]="NON_MEMBERS",t[t.EDGES=2]="EDGES"}(oD||(oD={}));let aD=class{constructor(t={}){this.dirty=new Set,this.members=[],this.nonMembers=[],this.virtualEdges=[],this.edges=[],this.activeRegion=new DL(0,0,0,0),this.potentialArea=new kL(1,0,0,0,0,0,0),this.o=Object.assign({},nD,t)}pushMember(...t){if(0!==t.length){this.dirty.add(oD.MEMBERS);for(const e of t)this.members.push({raw:e,obj:rD(e)?BL.from(e):DL.from(e),area:null})}}removeMember(t){const e=this.members.findIndex((e=>iD(e.raw,t)));return!(e<0)&&(this.members.splice(e,1),this.dirty.add(oD.MEMBERS),!0)}removeNonMember(t){const e=this.nonMembers.findIndex((e=>iD(e.raw,t)));return!(e<0)&&(this.nonMembers.splice(e,1),this.dirty.add(oD.NON_MEMBERS),!0)}removeEdge(t){const e=this.edges.findIndex((e=>e.obj.equals(t)));return!(e<0)&&(this.edges.splice(e,1),this.dirty.add(oD.NON_MEMBERS),!0)}pushNonMember(...t){if(0!==t.length){this.dirty.add(oD.NON_MEMBERS);for(const e of t)this.nonMembers.push({raw:e,obj:rD(e)?BL.from(e):DL.from(e),area:null})}}pushEdge(...t){if(0!==t.length){this.dirty.add(oD.EDGES);for(const e of t)this.edges.push({raw:e,obj:AL.from(e),area:null})}}update(){const t=this.dirty.has(oD.MEMBERS),e=this.dirty.has(oD.NON_MEMBERS);let n=this.dirty.has(oD.EDGES);this.dirty.clear();const r=this.members.map((t=>t.obj));if(this.o.virtualEdges&&(t||e)){const t=VL(r,this.nonMembers.map((t=>t.obj)),this.o.maxRoutingIterations,this.o.morphBuffer),e=new Map(this.virtualEdges.map((t=>[t.obj.toString(),t.area])));this.virtualEdges=t.map((t=>{var n;return{raw:t,obj:t,area:null!==(n=e.get(t.toString()))&&void 0!==n?n:null}})),n=!0}let i=!1;if(t||n){const t=function(t,e){if(0===t.length)return new DL(0,0,0,0);const n=DL.from(t[0]);for(const e of t)n.add(e);for(const t of e)n.add(ML(t));return n}(r,this.virtualEdges.concat(this.edges).map((t=>t.obj))),e=Math.max(this.o.edgeR1,this.o.nodeR1)+this.o.morphBuffer,n=DL.from(FL(t,e));n.equals(this.activeRegion)||(i=!0,this.activeRegion=n)}if(i){const t=Math.ceil(this.activeRegion.width/this.o.pixelGroup),e=Math.ceil(this.activeRegion.height/this.o.pixelGroup);this.activeRegion.x!==this.potentialArea.pixelX||this.activeRegion.y!==this.potentialArea.pixelY?(this.potentialArea=kL.fromPixelRegion(this.activeRegion,this.o.pixelGroup),this.members.forEach((t=>t.area=null)),this.nonMembers.forEach((t=>t.area=null)),this.edges.forEach((t=>t.area=null)),this.virtualEdges.forEach((t=>t.area=null))):t===this.potentialArea.width&&e===this.potentialArea.height||(this.potentialArea=kL.fromPixelRegion(this.activeRegion,this.o.pixelGroup))}const o=new Map,a=t=>{if(t.area){const e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof DL?"R":"C"}`;o.set(e,t.area)}},s=t=>{if(t.area)return;const e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof DL?"R":"C"}`;if(o.has(e)){const n=o.get(e);return void(t.area=this.potentialArea.copy(n,{x:t.obj.x-this.o.nodeR1,y:t.obj.y-this.o.nodeR1}))}const n=t.obj instanceof DL?function(t,e,n){const r=e.scale(t),i=e.addPadding(r,n),o=e.createSub(i,{x:t.x-n,y:t.y-n}),a=r.x-i.x,s=r.y-i.y,l=i.x2-r.x2,u=i.y2-r.y2,c=i.width-a-l,h=i.height-s-u,d=n*n;o.fillArea({x:a,y:s,width:c+1,height:h+1},d);const f=[0],p=Math.max(s,a,l,u);{const i=e.invertScaleX(r.x+r.width/2);for(let o=1;o<p;o++){const a=e.invertScaleY(r.y-o),s=t.distSquare(i,a);if(!(s<d))break;{const t=n-Math.sqrt(s);f.push(t*t)}}}const g=[],v=Math.max(a,l),m=Math.max(s,l);for(let i=1;i<v;i++){const o=e.invertScaleX(r.x-i),a=[];for(let i=1;i<m;i++){const s=e.invertScaleY(r.y-i),l=t.distSquare(o,s);if(l<d){const t=n-Math.sqrt(l);a.push(t*t)}else a.push(0)}g.push(a)}for(let t=1;t<Math.min(s,f.length);t++){const e=f[t];o.fillHorizontalLine(a,s-t,c+1,e)}for(let t=1;t<Math.min(u,f.length);t++){const e=f[t];o.fillHorizontalLine(a,s+h+t,c+1,e)}for(let t=1;t<Math.min(a,f.length);t++){const e=f[t];o.fillVerticalLine(a-t,s,h+1,e)}for(let t=1;t<Math.min(u,f.length);t++){const e=f[t];o.fillVerticalLine(a+c+t,s,h+1,e)}for(let t=1;t<a;t++){const e=g[t-1],n=a-t;for(let t=1;t<s;t++)o.set(n,s-t,e[t-1]);for(let t=1;t<u;t++)o.set(n,s+h+t,e[t-1])}for(let t=1;t<l;t++){const e=g[t-1],n=a+c+t;for(let t=1;t<s;t++)o.set(n,s-t,e[t-1]);for(let t=1;t<u;t++)o.set(n,s+h+t,e[t-1])}return o}(t.obj,this.potentialArea,this.o.nodeR1):GL(t.obj,this.potentialArea,this.o.nodeR1);t.area=n,o.set(e,n)};this.members.forEach(a),this.nonMembers.forEach(a),this.members.forEach(s),this.nonMembers.forEach((t=>{this.activeRegion.intersects(t.obj)?s(t):t.area=null})),this.edges.forEach((t=>{t.area||(t.area=UL(t.obj,this.potentialArea,this.o.edgeR1))})),this.virtualEdges.forEach((t=>{t.area||(t.area=UL(t.obj,this.potentialArea,this.o.edgeR1))}))}drawMembers(t){for(const e of this.members)e.obj.draw(t)}drawNonMembers(t){for(const e of this.nonMembers)e.obj.draw(t)}drawEdges(t){for(const e of this.edges)e.obj.draw(t)}drawPotentialArea(t,e=!0){this.potentialArea.draw(t,e)}compute(){if(0===this.members.length)return new $L([]);this.dirty.size>0&&this.update();const{o:t,potentialArea:e}=this,n=this.members.map((t=>t.area)),r=this.virtualEdges.concat(this.edges).map((t=>t.area)),i=this.nonMembers.filter((t=>null!=t.area)).map((t=>t.area)),o=this.members.map((t=>t.obj));return function(t,e,n,r,i,o={}){const a=Object.assign({},nD,o);let s=a.threshold,l=a.memberInfluenceFactor,u=a.edgeInfluenceFactor,c=a.nonMemberInfluenceFactor;const h=(a.nodeR0-a.nodeR1)*(a.nodeR0-a.nodeR1),d=(a.edgeR0-a.edgeR1)*(a.edgeR0-a.edgeR1);for(let o=0;o<a.maxMarchingIterations;o++){if(t.clear(),0!==l){const n=l/h;for(const r of e)t.incArea(r,n)}if(0!==u){const e=u/d;for(const r of n)t.incArea(r,e)}if(0!==c){const e=c/h;for(const n of r)t.incArea(n,e)}const f=eD(t,s);if(f&&i(f))return f;if(s*=.95,o<=.5*a.maxMarchingIterations)l*=1.2,u*=1.2;else{if(!(0!==c&&r.length>0))break;c*=.8}}return new $L([])}(e,n,r,i,(t=>t.containsElements(o)),t)}};class sD extends EL{shape;bubbleSets;path;members=new Map;avoidMembers=new Map;bubbleSetOptions={};static defaultOptions={members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2,...nD};constructor(t,e){super(t,$({},sD.defaultOptions,e)),this.bindEvents(),this.bubbleSets=new aD(this.options)}bindEvents(){this.context.graph.on(gN.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(gN.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new aD(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){const{type:t,key:e,members:n,avoidMembers:r,...i}=this.options,o=Object.keys(i).reduce(((t,e)=>(e in nD?t.bubbleSetOptions[e]=i[e]:t.style[e]=i[e],t)),{style:{},bubbleSetOptions:{}});return{type:t,key:e,members:n,avoidMembers:r,...o}}drawBubbleSets=()=>{const{style:t,bubbleSetOptions:e}=this.parseOptions();Q(this.bubbleSetOptions,e)||this.init(),this.bubbleSetOptions={...e};const n={...t,d:this.getPath()};this.shape?this.shape.update(n):(this.shape=new qC({style:n}),this.context.canvas.appendChild(this.shape))};updateBubbleSetsPath=t=>{if(!this.shape)return;const e=xN(t.data);[...this.options.members,...this.options.avoidMembers].includes(e)&&this.shape.update({...this.parseOptions().style,d:this.getPath(e)})};getPath=t=>{const{graph:e}=this.context,n=this.options.members,r=[...this.members.keys()],i=this.options.avoidMembers,o=[...this.avoidMembers.keys()];if(!t&&Q(n,r)&&Q(i,o))return this.path;const{enter:a=[],exit:s=[]}=CN(r,n,(t=>t)),{enter:l=[],exit:u=[]}=CN(o,i,(t=>t));t&&(s.push(t),a.push(t));const c=(t,n,r)=>{t.forEach((t=>{const i=r?this.members:this.avoidMembers,o=r?"pushMember":"pushNonMember",a=r?"removeMember":"removeNonMember";if(n){let n;"edge"===e.getElementType(t)?([n]=uD(e,t),this.bubbleSets.pushEdge(n)):([n]=lD(e,t),this.bubbleSets[o](n)),i.set(t,n)}else{const n=i.get(t);n&&("edge"===e.getElementType(t)?this.bubbleSets.removeEdge(n):this.bubbleSets[a](n),i.delete(t))}}))};c(s,!1,!0),c(a,!0,!0),c(u,!1,!1),c(l,!0,!1);const h=this.bubbleSets.compute().sample(8).simplify(0).bSplines().simplify(0);return this.path=$C(h.points.map(uC)),this.path};addMember(t){const e=Array.isArray(t)?t:[t];e.some((t=>this.options.avoidMembers.includes(t)))&&(this.options.avoidMembers=this.options.avoidMembers.filter((t=>!e.includes(t)))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter((t=>!e.includes(t))),this.drawBubbleSets()}updateMember(t){this.options.members=E(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){const e=Array.isArray(t)?t:[t];e.some((t=>this.options.members.includes(t)))&&(this.options.members=this.options.members.filter((t=>!e.includes(t)))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){const e=Array.isArray(t)?t:[t];this.options.avoidMembers.some((t=>e.includes(t)))&&(this.options.avoidMembers=this.options.avoidMembers.filter((t=>!e.includes(t))),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(gN.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(gN.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}}const lD=(t,e)=>(Array.isArray(e)?e:[e]).map((e=>{const n=t.getElementRenderBounds(e);return new DL(n.min[0],n.min[1],kN(n),FN(n))})),uD=(t,e)=>(Array.isArray(e)?e:[e]).map((e=>{const n=t.getEdgeData(e),r=t.getElementPosition(n.source),i=t.getElementPosition(n.target);return AL.from({x1:r[0],y1:r[1],x2:i[0],y2:i[1]})}));class cD extends EL{static defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};$element=mL("contextmenu",!1);constructor(t,e){super(t,Object.assign({},cD.defaultOptions,e));this.context.canvas.getContainer().appendChild(this.$element),yL("g6-contextmenu-css","style",{},"\n  .g6-contextmenu {\n    font-size: 12px;\n    background-color: rgba(255, 255, 255, 0.96);\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;\n    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;\n  }\n\n  .g6-contextmenu-ul {\n    max-width: 256px;\n    min-width: 96px;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n\n  .g6-contextmenu-li {\n    padding: 8px 12px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .g6-contextmenu-li:hover {\n    background-color: #f5f5f5;\n    cursor: pointer;\n  }\n",document.head),this.update(e)}async show(t){const{enable:e,offset:n}=this.options;if("function"==typeof e&&!e(t)||!e)return void this.hide();const r=await this.getDOMContent(t);r instanceof HTMLElement?this.$element.appendChild(r):this.$element.innerHTML=r;const i=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left=`${t.client.x-i.left+n[0]}px`,this.$element.style.top=`${t.client.y-i.top+n[1]}px`,this.$element.style.display="block"}hide(){this.$element.style.display="none"}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}async getDOMContent(t){const{getContent:e,getItems:n}=this.options;return n?`\n    <ul class="g6-contextmenu-ul">\n      ${(await n(t)).map((t=>`<li  class="g6-contextmenu-li" value="${t.value}">${t.name}</li>`)).join("")}\n    </ul>\n  `:await e(t)}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`canvas:${e}`,this.onTriggerEvent),t.on(`node:${e}`,this.onTriggerEvent),t.on(`edge:${e}`,this.onTriggerEvent),t.on(`combo:${e}`,this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`canvas:${e}`,this.onTriggerEvent),t.off(`node:${e}`,this.onTriggerEvent),t.off(`edge:${e}`,this.onTriggerEvent),t.off(`combo:${e}`,this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}onTriggerEvent=t=>{t.preventDefault?.(),this.show(t)};onMenuItemClick=t=>{const{onClick:e}=this.options;if(t.target instanceof HTMLElement){if(t.target.className.includes("g6-contextmenu-li")){const n=t.target.getAttribute("value");e&&e(n,t.target),this.hide()}this.context.graph.getCanvas().getContainer().contains(t.target)||this.hide()}}}class hD extends EL{static defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};$element=mL("grid-line");offset=[0,0];constructor(t,e){super(t,Object.assign({},hD.defaultOptions,e));!function(t,e){const n=t.firstChild;n?t.insertBefore(e,n):t.appendChild(e)}(this.context.canvas.getContainer(),this.$element),this.updateStyle(),this.bindEvents()}update(t){super.update(t),this.updateStyle()}bindEvents(){const{graph:t}=this.context;t.on(gN.AFTER_TRANSFORM,this.onTransform)}updateStyle(){const{size:t,stroke:e,lineWidth:n,border:r,borderLineWidth:i,borderStroke:o,borderStyle:a}=this.options;Object.assign(this.$element.style,{border:r?`${i}px ${a} ${o}`:"none",backgroundImage:`linear-gradient(${e} ${n}px, transparent ${n}px), linear-gradient(90deg, ${e} ${n}px, transparent ${n}px)`,backgroundSize:`${t}px ${t}px`})}updateOffset(t){this.offset=function(t,e){return t.map((t=>t%e))}(YN(this.offset,t),this.options.size),this.$element.style.backgroundPosition=`${this.offset[0]}px ${this.offset[1]}px`}onTransform=t=>{if(!this.options.follow)return;const{data:{translate:e}}=t;e&&this.updateOffset(e)};destroy(){this.context.graph.off(gN.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}}function dD(t){const e={Added:new Map,Updated:new Map,Removed:new Map};return t.forEach((t=>{const{type:n,value:r}=t,i=xN(r);if("NodeAdded"===n||"EdgeAdded"===n||"ComboAdded"===n)e.Added.set(i,t);else if("NodeUpdated"===n||"EdgeUpdated"===n||"ComboUpdated"===n)if(e.Added.has(i))e.Added.set(i,{type:n.replace("Updated","Added"),value:r});else if(e.Updated.has(i)){const{original:t}=e.Updated.get(i);e.Updated.set(i,{type:n,value:r,original:t})}else e.Removed.has(i)||e.Updated.set(i,t);else"NodeRemoved"!==n&&"EdgeRemoved"!==n&&"ComboRemoved"!==n||(e.Added.has(i)?e.Added.delete(i):e.Updated.has(i)?(e.Updated.delete(i),e.Removed.set(i,t)):e.Removed.set(i,t))})),[...Array.from(e.Added.values()),...Array.from(e.Updated.values()),...Array.from(e.Removed.values())]}function fD(t){const{NodeAdded:e=[],NodeUpdated:n=[],NodeRemoved:r=[],EdgeAdded:i=[],EdgeUpdated:o=[],EdgeRemoved:a=[],ComboAdded:s=[],ComboUpdated:l=[],ComboRemoved:u=[]}=function(t,e){if(!e||!S(t))return{};for(var n,r={},i=E(e)?e:function(t){return t[e]},o=0;o<t.length;o++){var a=t[o];n=i(a),C.call(r,n)?r[n].push(a):r[n]=[a]}return r}(t,(t=>t.type));return{add:{nodes:e,edges:i,combos:s},update:{nodes:n,edges:o,combos:l},remove:{nodes:r,edges:a,combos:u}}}function pD(t,e){for(const n in t)M(t[n])&&!Array.isArray(t[n])&&null!==t[n]?(e[n]||(e[n]={}),pD(t[n],e[n])):e[n]||(e[n]=bN(n))}function gD(t,e=!1,n){const r={animation:e,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:i,update:o,remove:a}=fD(dD(t));return["nodes","edges","combos"].forEach((t=>{o[t]&&o[t].forEach((e=>{const i={...e.value};let o={...e.original};if(n){const t=n.graph.getElementType(xN(e.original)),r="edge"===t?"stroke":"fill",i=n.element.getElementComputedStyle(t,e.original);o={...e.original,style:{[r]:i[r],...e.original.style}}}pD(i,o),r.current.update[t]||=[],r.current.update[t].push(i),r.original.update[t]||=[],r.original.update[t].push(o)})),i[t]&&i[t].forEach((e=>{const n={...e.value};r.current.add[t]||=[],r.current.add[t].push(n),r.original.remove[t]||=[],r.original.remove[t].push(n)})),a[t]&&a[t].forEach((e=>{const n={...e.value};r.current.remove[t]||=[],r.current.remove[t].push(n),r.original.add[t]||=[],r.original.add[t].push(n)}))})),r}class vD extends EL{static defaultOptions={stackSize:0};emitter;batchChanges=null;batchAnimation=!1;undoStack=[];redoStack=[];isFirstDraw=!0;freezed=!1;constructor(t,e){super(t,Object.assign({},vD.defaultOptions,e)),this.emitter=new h;const{graph:n}=this.context;n.on(gN.AFTER_DRAW,this.addCommand),n.on(gN.BATCH_START,this.initBatchCommand),n.on(gN.BATCH_END,this.addCommand)}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){const t=this.undoStack.pop();return t&&(this.executeCommand(t),this.options.beforeAddCommand?.(t,!1),this.redoStack.push(t),this.options.afterAddCommand?.(t,!1),this.notify(vN.UNDO,t)),this}redo(){const t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(vN.REDO,t)),this}undoAndCancel(){const t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(vN.CANCEL,t)),this}executeCommand=(t,e=!0)=>{this.freezed=!0,this.options.executeCommand?.(t);const n=e?t.original:t.current;this.context.graph.addData(n.add),this.context.graph.updateData(n.update),this.context.graph.removeData(SN(n.remove,!1)),this.context.element?.draw({silence:!0,animation:t.animation}),this.freezed=!1};addCommand=t=>{if(this.isFirstDraw)this.isFirstDraw=!1;else if(!this.freezed){if(t.type===gN.AFTER_DRAW){const{dataChanges:e=[],animation:n=!0}=t.data;if(this.context.batch?.isBatching){if(!this.batchChanges)return;return this.batchChanges.push(e),void(this.batchAnimation&&=n)}this.batchChanges=[e],this.batchAnimation=n}this.undoStackPush(gD(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(vN.ADD,this.undoStack[this.undoStack.length-1])}};initBatchCommand=t=>{const{initiate:e}=t.data;if(this.batchAnimation=!1,e)this.batchChanges=[];else{this.undoStack.pop()||(this.batchChanges=null)}};undoStackPush(t){const{stackSize:e}=this.options;0!==e&&this.undoStack.length>=e&&this.undoStack.shift(),this.options.beforeAddCommand?.(t,!0),this.undoStack.push(t),this.options.afterAddCommand?.(t,!0)}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(vN.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(vN.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){const{graph:t}=this.context;t.off(gN.AFTER_DRAW,this.addCommand),t.off(gN.BATCH_START,this.initBatchCommand),t.off(gN.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}}function mD(t,e,n,r,i,o){const a=(o-e)*(n-t)-(r-e)*(i-t);return a>0||!(a<0)}var yD=function(t,e){const n=t[0][0],r=t[0][1],i=t[1][0],o=t[1][1],a=e[0][0],s=e[0][1],l=e[1][0],u=e[1][1];return mD(n,r,a,s,l,u)!==mD(i,o,a,s,l,u)&&mD(n,r,i,o,a,s)!==mD(n,r,i,o,l,u)};function ED(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(let e=0;e<t.length;e++){const n=t[e],r=this.coordToCellNum(n[0]),i=this.coordToCellNum(n[1]);if(this._cells[r])this._cells[r][i]?this._cells[r][i].push(n):this._cells[r][i]=[n];else{const t=[];t[i]=[n],this._cells[r]=t}}}function _D(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}ED.prototype={cellPoints:function(t,e){return void 0!==this._cells[t]&&void 0!==this._cells[t][e]?this._cells[t][e]:[]},rangePoints:function(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),r=this.coordToCellNum(t[2]),i=this.coordToCellNum(t[3]),o=[];for(let t=e;t<=r;t++)for(let e=n;e<=i;e++)for(let n=0;n<this.cellPoints(t,e).length;n++)o.push(this.cellPoints(t,e)[n]);return o},removePoint:function(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),r=this._cells[e][n];let i;for(let e=0;e<r.length;e++)if(r[e][0]===t[0]&&r[e][1]===t[1]){i=e;break}return r.splice(i,1),r},trunc:Math.trunc||function(t){return t-t%1},coordToCellNum:function(t){return this.trunc(t*this._reverseCellSize)},extendBbox:function(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}};var bD=function(t){const e=function(t){const e=[];for(let n=0;n<t.length;n++){for(;e.length>=2&&_D(e[e.length-2],e[e.length-1],t[n])<=0;)e.pop();e.push(t[n])}return e.pop(),e}(t),n=function(t){const e=t.reverse(),n=[];for(let t=0;t<e.length;t++){for(;n.length>=2&&_D(n[n.length-2],n[n.length-1],e[t])<=0;)n.pop();n.push(e[t])}return n.pop(),n}(t).concat(e);return n.push(t[0]),n};const xD=yD,SD=function(t,e){return new ED(t,e)},MD={toXy:function(t,e){return void 0===e?t.slice():t.map((function(t){return new Function("pt","return [pt"+e[0]+",pt"+e[1]+"];")(t)}))},fromXy:function(t,e){return void 0===e?t.slice():t.map((function(t){return new Function("pt","const o = {}; o"+e[0]+"= pt[0]; o"+e[1]+"= pt[1]; return o;")(t)}))}},AD=bD;function RD(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function TD(t,e,n){const r=[e[0]-t[0],e[1]-t[1]],i=[n[0]-t[0],n[1]-t[1]],o=RD(t,e),a=RD(t,n);return(r[0]*i[0]+r[1]*i[1])/Math.sqrt(o*a)}function wD(t,e){for(let n=0;n<e.length-1;n++){const r=[e[n],e[n+1]];if(!(t[0][0]===r[0][0]&&t[0][1]===r[0][1]||t[0][0]===r[1][0]&&t[0][1]===r[1][1])&&xD(t,r))return!0}return!1}function PD(t){return[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}function ND(t,e,n){let r,i,o=null,a=OD,s=OD;for(let l=0;l<e.length;l++)r=TD(t[0],t[1],e[l]),i=TD(t[1],t[0],e[l]),r>a&&i>s&&!wD([t[0],e[l]],n)&&!wD([t[1],e[l]],n)&&(a=r,s=i,o=e[l]);return o}function CD(t,e,n,r,i){let o=!1;for(let a=0;a<t.length-1;a++){const s=[t[a],t[a+1]],l=s[0][0]+","+s[0][1]+","+s[1][0]+","+s[1][1];if(RD(s[0],s[1])<e||i.has(l))continue;let u,c,h,d=0,f=PD(s);do{f=r.extendBbox(f,d),u=f[2]-f[0],c=f[3]-f[1],h=ND(s,r.rangePoints(f),t),d++}while(null===h&&(n[0]>u||n[1]>c));u>=n[0]&&c>=n[1]&&i.add(l),null!==h&&(t.splice(a+1,0,h),r.removePoint(h),o=!0)}return o?CD(t,e,n,r,i):t}const OD=Math.cos(90/(180/Math.PI)),ID=.6;var LD=function(t,e,n){let r=e||20;const i=function(t){const e=[t[0]];let n=t[0];for(let r=1;r<t.length;r++){const i=t[r];n[0]===i[0]&&n[1]===i[1]||e.push(i),n=i}return e}(function(t){return t.sort((function(t,e){return t[0]-e[0]||t[1]-e[1]}))}(MD.toXy(t,n)));if(i.length<4){const t=i.concat([i[0]]);return n?MD.fromXy(t,n):t}const o=function(t){let e=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=t.length-1;o>=0;o--)t[o][0]<e&&(e=t[o][0]),t[o][1]<n&&(n=t[o][1]),t[o][0]>r&&(r=t[o][0]),t[o][1]>i&&(i=t[o][1]);return[r-e,i-n]}(i),a=[o[0]*ID,o[1]*ID],s=AD(i),l=i.filter((function(t){return s.indexOf(t)<0})),u=Math.ceil(1/(i.length/(o[0]*o[1]))),c=CD(s,Math.pow(r,2),a,SD(l,u),new Set);return n?MD.fromXy(c,n):c},DD=ji(LD);const BD=(t,e,n)=>{if("sharp"===n)return[["M",t[0]-e,t[1]-e],["L",t[0]+e,t[1]-e],["L",t[0]+e,t[1]+e],["L",t[0]-e,t[1]+e],["Z"]];const r=[e,e,0,0,0];return[["M",t[0],t[1]-e],["A",...r,t[0],t[1]+e],["A",...r,t[0],t[1]-e]]},kD=(t,e,n)=>{const r=[e,e,0,0,0],i="sharp"===n?YN(t[0],ZN(tC(KN(t[0],t[1])),e)):t[0],o="sharp"===n?YN(t[1],ZN(tC(KN(t[1],t[0])),e)):t[1],a=ZN(tC(nC(KN(i,o),!1)),e),s=ZN(a,-1),l=YN(i,a),u=YN(o,a),c=YN(o,s),h=YN(i,s);return"sharp"===n?[["M",l[0],l[1]],["L",u[0],u[1]],["L",c[0],c[1]],["L",h[0],h[1]],["Z"]]:[["M",l[0],l[1]],["L",u[0],u[1]],["A",...r,c[0],c[1]],["L",h[0],h[1]],["A",...r,l[0],l[1]]]},FD=(t,e)=>{const n=mC(t).map(((n,r)=>{const i=(r-2+t.length)%t.length,o=(r-1+t.length)%t.length,a=(r+1)%t.length,s=t[i],l=t[o],u=t[a],c=KN(s,l),h=KN(l,n),d=KN(n,u),f=(t,e)=>eC(t,e,!0)<Math.PI,p=f(c,h),g=f(h,d),v=t=>ZN(tC(nC(t,!1)),e),m=v(h);return[{p:rC(YN(l,p?v(c):m)),concave:p&&l},{p:rC(YN(n,g?v(d):m)),concave:g&&n}]})),r=[e,e,0,0,0],i=n.findIndex(((t,e)=>!(n[(e-1+n.length)%n.length][0].concave||n[(e-1+n.length)%n.length][1].concave||t[0].concave||t[0].concave||t[1].concave))),o=n.slice(i).concat(n.slice(0,i));let a=[];return o.flatMap(((t,e)=>{const i=[],s=o[n.length-1];return 0===e&&i.push(["M",...s[1].p]),t[0].concave?a.push(t[0].p,t[1].p):i.push(["A",...r,...t[0].p]),t[1].concave?a.unshift(t[1].p):i.push(["L",...t[1].p]),3===a.length&&(i.pop(),i.push(["C",...a.flat()]),a=[]),i}))},UD=(t,e)=>{const n=mC(t).map(((e,n)=>({p:e,v:tC(KN(t[(n+1)%t.length],e))})));return n.forEach(((r,i)=>{const o=i>0?i-1:t.length-1,a=n[o].v,s=tC(YN(a,ZN(r.v,eC(a,r.v,!0)<Math.PI?1:-1)));r.p=YN(r.p,ZN(s,e))})),$C(n.map((t=>t.p)))},GD=(t,e)=>{const n=t.map(((n,r)=>{const i=t[0===r?t.length-1:r-1],o=iC(ZN(tC(nC(KN(i,n),!1)),e));return[YN(i,o),YN(n,o)]})).flat();return n.map(((t,e)=>{if(e%2==0)return null;return aC([n[(e-1)%n.length],n[e%n.length]],[n[(e+1)%n.length],n[(e+2)%n.length]],!0)})).filter(Boolean).map(((t,e)=>[0===e?"M":"L",t[0],t[1]])).concat([["Z"]])};class zD extends EL{shape;hullMemberIds=[];path;optionsCache;static defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};constructor(t,e){super(t,Object.assign({},zD.defaultOptions,e)),this.bindEvents()}bindEvents(){this.context.graph.on(gN.AFTER_RENDER,this.drawHull),this.context.graph.on(gN.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){const{members:e,padding:n,corner:r,...i}=this.options;return{...i,d:this.getHullPath(t)}}drawHull=()=>{if(this.shape){const t=!Q(this.optionsCache,this.options);this.shape.update(this.getHullStyle(t))}else this.shape=new qC({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);this.optionsCache={...this.options}};updateHullPath=t=>{this.shape&&this.options.members.includes(xN(t.data))&&this.shape.update({d:this.getHullPath(!0)})};getHullPath=(t=!1)=>{const{graph:e}=this.context,n=this.options.members.map((t=>e.getNodeData(t))),r=DD(n.map(sC),this.options.concavity).slice(1).reverse(),i=r.flatMap((t=>n.filter((e=>Q(sC(e),t))).map(xN)));return Q(i,this.hullMemberIds)&&!t||(this.hullMemberIds=i,this.path=function(t,e,n){if(1===t.length)return BD(t[0],e,n);if(2===t.length)return kD(t,e,n);switch(n){case"smooth":return UD(t,e);case"sharp":return GD(t,e);default:return FD(t,e)}}(r,this.getPadding(),this.options.corner)),this.path};getPadding(){const{graph:t}=this.context,e=this.hullMemberIds.reduce(((e,n)=>{const{halfExtents:r}=t.getElementRenderBounds(n),i=Math.max(r[0],r[1]);return Math.max(e,i)}),0);return e+this.options.padding}addMember(t){const e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter((t=>!e.includes(t))),e.some((t=>this.hullMemberIds.includes(t)))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=E(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(gN.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}}function VD(t,e){e(t),t.children&&t.children.forEach((function(t){t&&VD(t,e)}))}function WD(t){HD(t,!0)}function jD(t){HD(t,!1)}function HD(t,e){var n=e?"visible":"hidden";VD(t,(function(t){t.attr("visibility",n)}))}var XD=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.apply(this,u([],l(e),!1))||this;return r.isMutationObserved=!0,r.addEventListener(nw.INSERTED,(function(){jD(r)})),r}return n(e,t),e}(Dw);function YD(t){var e=t.appendChild(new XD({class:"offscreen"}));return jD(e),e}var KD=function(t){function e(e){void 0===e&&(e={});var n=e.style,o=i(e,["style"]);return t.call(this,r({style:r({text:"",fill:"black",fontFamily:"sans-serif",fontSize:16,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineWidth:1,textAlign:"start",textBaseline:"middle"},n)},o))||this}return n(e,t),Object.defineProperty(e.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=YD(this)),this._offscreen},enumerable:!1,configurable:!0}),e.prototype.disconnectedCallback=function(){var t;null===(t=this._offscreen)||void 0===t||t.destroy()},e}(Ww);function $D(t){return t*Math.PI/180}function qD(t){return Number((180*t/Math.PI).toPrecision(5))}var ZD=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=n,this.height=r}return Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t.prototype.toJSON=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,top:this.top,right:this.right,bottom:this.bottom,left:this.left}},t.prototype.isPointIn=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},t}();function QD(t,e){return E(t)?t.apply(void 0,u([],l(e),!1)):t}var JD,tB=function(t,e){var n=function(t){return"".concat(e,"-").concat(t)},r=Object.fromEntries(Object.entries(t).map((function(t){var e=l(t,2),r=e[0],i=e[1],o=n(i);return[r,{name:o,class:".".concat(o),id:"#".concat(o),toString:function(){return o}}]})));return Object.assign(r,{prefix:n}),r},eB=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=5),Object.entries(e).forEach((function(i){var o=l(i,2),a=o[0],s=o[1],u=t;Object.prototype.hasOwnProperty.call(e,a)&&(s?T(s)?(T(t[a])||(u[a]={}),n<r?eB(t[a],s,n+1,r):u[a]=e[a]):S(s)?(u[a]=[],u[a]=u[a].concat(s)):u[a]=s:u[a]=s)}))},nB=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)eB(t,e[r]);return t},rB=function(t){return void 0!==t&&null!=t&&!Number.isNaN(t)},iB=function(t,e,n){if(!E(t))throw new TypeError("Expected a function");var r=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var s=t.apply(this,n);return a.set(o,s),s};return r.cache=function(t){var e,n,r,i=t;function o(t,o){++e>i&&(r=n,a(1),++e),n[t]=o}function a(t){e=0,n=Object.create(null),t||(r=Object.create(null))}return a(),{clear:a,has:function(t){return void 0!==n[t]||void 0!==r[t]},get:function(t){var e=n[t];return void 0!==e?e:void 0!==(e=r[t])?(o(t,e),e):void 0},set:function(t,e){void 0!==n[t]?n[t]=e:o(t,e)}}}(n),r}((function(t,e){var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return JD||(JD=gw.offscreenCanvasCreator.getOrCreateContext(void 0)),JD.font=[o,a,i,"".concat(n,"px"),r].join(" "),JD.measureText(t).width}),(function(t,e){return[t,Object.values(e||oB(t)).join()].join("")}),4096),oB=function(t){var e=t.style.fontFamily||"sans-serif",n=t.style.fontWeight||"normal",r=t.style.fontStyle||"normal",i=t.style.fontVariant,o=t.style.fontSize;return{fontSize:o="object"==typeof o?o.value:o,fontFamily:e,fontWeight:n,fontStyle:r,fontVariant:i}};function aB(t){return"text"===t.nodeName?t:"g"===t.nodeName&&1===t.children.length&&"text"===t.children[0].nodeName?t.children[0]:null}function sB(t,e){var n=aB(t);n&&n.attr(e)}function lB(t,e,n){void 0===n&&(n="..."),sB(t,{wordWrap:!0,wordWrapWidth:e,maxLines:1,textOverflow:n})}function uB(t){var e=t.canvas,n=t.touches,r=t.offsetX,i=t.offsetY;if(e)return[e.x,e.y];if(n){var o=n[0];return[o.clientX,o.clientY]}return r&&i?[r,i]:[0,0]}function cB(t){return"function"==typeof t?t():N(t)||I(t)?new KD({style:{text:String(t)}}):t}function hB(t,e,n,r,i){return void 0===r&&(r=!0),void 0===i&&(i=function(t){t.node().removeChildren()}),t?n(e):(r&&i(e),null)}function dB(t,e,n,r,i){return void 0===r&&(r=!0),void 0===i&&(i=!1),!!(r&&t===e||i&&t===n)||t>e&&t<n}var fB=function(t,e){return function(n){return t*(1-n)+e*n}};function pB(t,e){return"number"==typeof t&&"number"==typeof e?fB(t,e):Array.isArray(t)&&Array.isArray(e)?function(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0;return function(i){var o=new Array(r),a=new Array(n),s=0;for(s=0;s<r;++s)o[s]=pB(t[s],e[s]);for(;s<n;++s)a[s]=e[s];for(s=0;s<r;++s)a[s]=o[s](i);return a}}(t,e):"object"==typeof t&&"object"==typeof e?function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var n={},r={};return Object.entries(e).forEach((function(e){var i=l(e,2),o=i[0],a=i[1];o in t?n[o]=pB(t[o],a):r[o]=a})),function(t){return Object.entries(n).forEach((function(e){var n=l(e,2),i=n[0],o=n[1];return r[i]=o(t)})),r}}(t,e):function(e){return t}}function gB(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0;o<t.length;o++){var a=t[o],s=a.x,u=a.y,c=l([s+a.width,u+a.height],2),h=c[0],d=c[1];s<e&&(e=s),u<n&&(n=u),h>r&&(r=h),d>i&&(i=d)}return new ZD(e,n,r-e,i-n)}var vB=function(t,e,n){var r=t.width,i=t.height,o=n.flexDirection,a=void 0===o?"row":o;n.flexWrap;var s=n.justifyContent,u=void 0===s?"flex-start":s;n.alignContent;var c=n.alignItems,h=void 0===c?"flex-start":c,d="row"===a,f="row"===a||"column"===a,p=d?f?[1,0]:[-1,0]:f?[0,1]:[0,-1],g=l([0,0],2),v=g[0],m=g[1],y=e.map((function(t){var e,n=t.width,r=t.height,i=l([v,m],2),o=i[0],a=i[1];return e=l([v+n*p[0],m+r*p[1]],2),v=e[0],m=e[1],new ZD(o,a,n,r)})),E=gB(y),_={"flex-start":0,"flex-end":d?r-E.width:i-E.height,center:d?(r-E.width)/2:(i-E.height)/2},b=y.map((function(t){var e=t.x,n=t.y,r=ZD.fromRect(t);return r.x=d?e+_[u]:e,r.y=d?n:n+_[u],r}));gB(b);var x=function(t){var e=l(d?["height",i]:["width",r],2),n=e[0],o=e[1];switch(h){case"flex-start":default:return 0;case"flex-end":return o-t[n];case"center":return o/2-t[n]/2}},S=b.map((function(t){var e=t.x,n=t.y,r=ZD.fromRect(t);return r.x=d?e:e+x(r),r.y=d?n+x(r):n,r})),M=S.map((function(e){var n,r,i=ZD.fromRect(e);return i.x+=null!==(n=t.x)&&void 0!==n?n:0,i.y+=null!==(r=t.y)&&void 0!==r?r:0,i}));return M},mB=function(t,e,n){return[]};function yB(t,e){return[t[0]*e,t[1]*e]}function EB(t,e){return[t[0]+e[0],t[1]+e[1]]}function _B(t,e){return[t[0]-e[0],t[1]-e[1]]}function bB(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1])]}function xB(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}function SB(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function MB(t){if(0===t[0]&&0===t[1])return[0,0];var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}function AB(t,e){return+t.toPrecision(e)}function RB(t,e){var n={},r=Array.isArray(e)?e:[e];for(var i in t)r.includes(i)||(n[i]=t[i]);return n}function TB(t,e,n){void 0===n&&(n=[[0,0],[1,1]]);for(var r=!!e,i=[],o=0,a=t.length;o<a;o+=2)i.push([t[o],t[o+1]]);var s,u,c,h=function(t,e,n,r){var i,o,a,s,u,c,h=[],d=!!r,f=[1/0,1/0],p=[-1/0,-1/0];if(d){f=(i=l(r,2))[0],p=i[1];for(var g=0,v=t.length;g<v;g+=1)f=bB(f,y=t[g]),p=xB(p,y)}g=0;for(var m=t.length;g<m;g+=1){var y=t[g];if(0!==g||n)if(g!==m-1||n){o=t[g-1];var E=[0,0];E=yB(E=_B(a=t[g+1],o),e);var _=SB(y,o),b=SB(y,a),x=_+b;0!==x&&(_/=x,b/=x);var S=yB(E,-_),M=yB(E,b);u=EB(y,S),s=bB(s=EB(y,M),xB(a,y)),s=xB(s,bB(a,y)),u=bB(u=EB(y,S=yB(S=_B(s,y),-_/b)),xB(o,y)),s=EB(y,M=yB(M=_B(y,u=xB(u,bB(o,y))),b/_)),d&&(u=bB(u=xB(u,f),p),s=bB(s=xB(s,f),p)),h.push(c),h.push(u),c=s}else u=y,h.push(c),h.push(u);else c=y}return h}(i,.4,r,n),d=i.length,f=[];for(o=0;o<d-1;o+=1)s=h[2*o],u=h[2*o+1],c=i[o+1],f.push(["C",s[0],s[1],u[0],u[1],c[0],c[1]]);return f}var wB=["$el","cx","cy","d","dx","dy","fill","fillOpacity","filter","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","img","increasedLineWidthForHitTesting","innerHTML","isBillboard","billboardRotation","isSizeAttenuation","isClosed","isOverflowing","leading","letterSpacing","lineDash","lineHeight","lineWidth","markerEnd","markerEndOffset","markerMid","markerStart","markerStartOffset","maxLines","metrics","miterLimit","offsetX","offsetY","opacity","path","points","r","radius","rx","ry","shadowColor","src","stroke","strokeOpacity","text","textAlign","textBaseline","textDecorationColor","textDecorationLine","textDecorationStyle","textOverflow","textPath","textPathSide","textPathStartOffset","transform","transformOrigin","visibility","width","wordWrap","wordWrapWidth","x","x1","x2","y","y1","y2","z1","z2","zIndex"];function PB(t){return wB.includes(t)}function NB(t){var e={};for(var n in t)PB(n)&&(e[n]=t[n]);return e}function CB(t,e,n){var r=t.getBBox(),i=r.width,o=r.height,a=e/Math.max(i,o);return t.style.transform="scale(".concat(a,")"),a}var OB=function(){function t(t,n,r,i,o,a,s){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=[null,null,null,null,null]),void 0===a&&(a=[]),void 0===s&&(s=[]),e.add(this),this._elements=Array.from(t),this._data=n,this._parent=r,this._document=i,this._enter=o[0],this._update=o[1],this._exit=o[2],this._merge=o[3],this._split=o[4],this._transitions=a,this._facetElements=s}var e,n,r;return t.prototype.selectAll=function(t){var e="string"==typeof t?this._parent.querySelectorAll(t):t;return new n(e,null,this._elements[0],this._document)},t.prototype.selectFacetAll=function(t){var e="string"==typeof t?this._parent.querySelectorAll(t):t;return new n(this._elements,null,this._parent,this._document,void 0,void 0,e)},t.prototype.select=function(t){var e="string"==typeof t?this._parent.querySelectorAll(t)[0]||null:t;return new n([e],null,e,this._document)},t.prototype.append=function(t){var e=this,r="function"==typeof t?t:function(){return e.createElement(t)},i=[];if(null!==this._data){for(var o=0;o<this._data.length;o++){var a=this._data[o],s=l(Array.isArray(a)?a:[a,null],2),u=s[0],c=s[1];(d=r(u,o)).__data__=u,null!==c&&(d.__fromElements__=c),this._parent.appendChild(d),i.push(d)}return new n(i,null,this._parent,this._document)}for(o=0;o<this._elements.length;o++){var h=this._elements[o],d=r(u=h.__data__,o);h.appendChild(d),i.push(d)}return new n(i,null,i[0],this._document)},t.prototype.maybeAppend=function(t,n){var i=c(this,e,"m",r).call(this,"#"===t[0]?t:"#".concat(t),n);return i.attr("id",t),i},t.prototype.maybeAppendByClassName=function(t,n){var i=t.toString(),o=c(this,e,"m",r).call(this,"."===i[0]?i:".".concat(i),n);return o.attr("className",i),o},t.prototype.maybeAppendByName=function(t,n){var i=c(this,e,"m",r).call(this,'[name="'.concat(t,'"]'),n);return i.attr("name",t),i},t.prototype.data=function(t,e,r){var i,o;void 0===e&&(e=function(t){return t}),void 0===r&&(r=function(){return null});for(var a,l,u,c=[],h=[],d=new Set(this._elements),f=[],p=new Set,g=new Map(this._elements.map((function(t,n){return[e(t.__data__,n),t]}))),v=new Map(this._facetElements.map((function(t,n){return[e(t.__data__,n),t]}))),m=(a=this._elements,l=function(t){return r(t.__data__)},u=new Map,a.forEach((function(t){var e=l(t);u.has(e)||u.set(e,[]),u.get(e).push(t)})),u),y=0;y<t.length;y++){var E=t[y],_=e(E,y),b=r(E,y);if(g.has(_))(A=g.get(_)).__data__=E,A.__facet__=!1,h.push(A),d.delete(A),g.delete(_);else if(v.has(_)){(A=v.get(_)).__data__=E,A.__facet__=!0,h.push(A),v.delete(_)}else if(m.has(_)){var x=m.get(_);f.push([E,x]);try{for(var S=(i=void 0,s(x)),M=S.next();!M.done;M=S.next()){var A=M.value;d.delete(A)}}catch(t){i={error:t}}finally{try{M&&!M.done&&(o=S.return)&&o.call(S)}finally{if(i)throw i.error}}m.delete(_)}else if(g.has(b)){(A=g.get(b)).__toData__?A.__toData__.push(E):A.__toData__=[E],p.add(A),d.delete(A)}else c.push(E)}var R=[new n([],c,this._parent,this._document),new n(h,null,this._parent,this._document),new n(d,null,this._parent,this._document),new n([],f,this._parent,this._document),new n(p,null,this._parent,this._document)];return new n(this._elements,null,this._parent,this._document,R)},t.prototype.merge=function(t){var e=u(u([],l(this._elements),!1),l(t._elements),!1),r=u(u([],l(this._transitions),!1),l(t._transitions),!1);return new n(e,null,this._parent,this._document,void 0,r)},t.prototype.createElement=function(t){if(this._document)return this._document.createElement(t,{});var e=n.registry[t];return e?new e:function(t){throw new Error(t)}("Unknown node type: ".concat(t))},t.prototype.join=function(t,e,n,r,i){void 0===t&&(t=function(t){return t}),void 0===e&&(e=function(t){return t}),void 0===n&&(n=function(t){return t.remove()}),void 0===r&&(r=function(t){return t}),void 0===i&&(i=function(t){return t.remove()});var o=t(this._enter),a=e(this._update),s=n(this._exit),l=r(this._merge),u=i(this._split);return a.merge(o).merge(s).merge(l).merge(u)},t.prototype.remove=function(){for(var t=function(t){var n=e._elements[t],r=e._transitions[t];r?r.then((function(){return n.remove()})):n.remove()},e=this,r=0;r<this._elements.length;r++)t(r);return new n([],null,this._parent,this._document,void 0,this._transitions)},t.prototype.each=function(t){for(var e=0;e<this._elements.length;e++){var n=this._elements[e],r=n.__data__;t.call(n,r,e)}return this},t.prototype.attr=function(t,e){var n="function"!=typeof e?function(){return e}:e;return this.each((function(r,i){void 0!==e&&(this[t]=n.call(this,r,i))}))},t.prototype.style=function(t,e,n){void 0===n&&(n=!0);var r="function"==typeof e&&n?e:function(){return e};return this.each((function(n,i){void 0!==e&&(this.style[t]=r.call(this,n,i))}))},t.prototype.styles=function(t,e){return void 0===t&&(t={}),void 0===e&&(e=!0),this.each((function(n,r){var i=this;Object.entries(t).forEach((function(t){var o=l(t,2),a=o[0],s=o[1],u="function"==typeof s&&e?s:function(){return s};void 0!==s&&i.attr(a,u.call(i,n,r))}))}))},t.prototype.update=function(t,e){void 0===e&&(e=!0);var n="function"==typeof t&&e?t:function(){return t};return this.each((function(e,r){t&&this.update&&this.update(n.call(this,e,r))}))},t.prototype.maybeUpdate=function(t,e){void 0===e&&(e=!0);var n="function"==typeof t&&e?t:function(){return t};return this.each((function(e,r){t&&this.update&&this.update(n.call(this,e,r))}))},t.prototype.transition=function(t){var e=this._transitions;return this.each((function(n,r){e[r]=t.call(this,n,r)}))},t.prototype.on=function(t,e){return this.each((function(){this.addEventListener(t,e)})),this},t.prototype.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.call.apply(t,u([this._parent,this],l(e),!1)),this},t.prototype.node=function(){return this._elements[0]},t.prototype.nodes=function(){return this._elements},t.prototype.transitions=function(){return this._transitions.filter((function(t){return!!t}))},t.prototype.parent=function(){return this._parent},n=t,e=new WeakSet,r=function(t,e){var r=this._elements[0],i=r.querySelector(t);if(i)return new n([i],null,this._parent,this._document);var o="string"==typeof e?this.createElement(e):e();return r.appendChild(o),new n([o],null,this._parent,this._document)},t.registry={g:Dw,rect:Vw,circle:Ow,path:Uw,text:KD,ellipse:Lw,image:kw,line:Fw,polygon:Gw,polyline:zw,html:Bw},t}();function IB(t){return new OB([t],null,t,t.ownerDocument)}function LB(t){if(I(t))return[t,t,t,t];if(S(t)){var e=t.length;if(1===e)return[t[0],t[0],t[0],t[0]];if(2===e)return[t[0],t[1],t[0],t[1]];if(3===e)return[t[0],t[1],t[2],t[1]];if(4===e)return t}return[0,0,0,0]}function DB(t){var e=t.getLocalBounds(),n=l([e.min,e.max],2),r=l(n[0],2),i=r[0],o=r[1],a=l(n[1],2),s=a[0],u=a[1];return{x:i,y:o,width:s-i,height:u-o,left:i,bottom:u,top:o,right:s}}function BB(t,e){var n=l(t,2),r=n[0],i=n[1],o=l(e,2),a=o[0],s=o[1];return r!==a&&i===s}function kB(t){return t.toString().charAt(0).toUpperCase()+t.toString().slice(1)}function FB(t,e,n){var r;void 0===n&&(n=!0);var i=e||(null===(r=t.match(/^([a-z][a-z0-9]+)/))||void 0===r?void 0:r[0])||"",o=t.replace(new RegExp("^(".concat(i,")")),"");return n?function(t){return t.toString().charAt(0).toLowerCase()+t.toString().slice(1)}(o):o}var UB=function(t,e){if(!(null==t?void 0:t.startsWith(e)))return!1;var n=t[e.length];return n>="A"&&n<="Z"};function GB(t,e,n){void 0===n&&(n=!1);var r={};return Object.entries(t).forEach((function(t){var i=l(t,2),o=i[0],a=i[1];if("className"===o||"class"===o);else if(UB(o,"show")&&UB(FB(o,"show"),e)!==n)o===function(t,e){return"".concat(e).concat(kB(t))}(e,"show")?r[o]=a:r[o.replace(new RegExp(kB(e)),"")]=a;else if(!UB(o,"show")&&UB(o,e)!==n){var s=FB(o,e);"filter"===s&&"function"==typeof a||(r[s]=a)}})),r}function zB(t,e){return Object.entries(t).reduce((function(t,n){var r=l(n,2),i=r[0],o=r[1];return i.startsWith("show")?t["show".concat(e).concat(i.slice(4))]=o:t["".concat(e).concat(kB(i))]=o,t}),{})}function VB(t,e){void 0===e&&(e=["x","y","class","className"]);var n=["transform","transformOrigin","anchor","visibility","pointerEvents","zIndex","cursor","clipPath","clipPathTargets","offsetPath","offsetPathTargets","offsetDistance","draggable","droppable"],r={},i={};return Object.entries(t).forEach((function(t){var o=l(t,2),a=o[0],s=o[1];e.includes(a)||(-1!==n.indexOf(a)?i[a]=s:r[a]=s)})),[r,i]}function WB(t,e){var n={YYYY:t.getFullYear(),MM:t.getMonth()+1,DD:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds()},r=e;return Object.keys(n).forEach((function(t){var e=n[t];r=r.replace(t,"YYYY"===t?"".concat(e):"".concat(e).padStart(2,"0"))})),r}function jB(t,e){if(e)try{var n=e.replace(/translate\(([+-]*[\d]+[%]*),[ ]*([+-]*[\d]+[%]*)\)/g,(function(e,n,r){return"translate(".concat(function(t,e,n){var r=t.getBBox(),i=r.width,o=r.height,a=l([e,n].map((function(t,e){var n;return t.includes("%")?parseFloat((null===(n=t.match(/[+-]?([0-9]*[.])?[0-9]+/))||void 0===n?void 0:n[0])||"0")/100*(0===e?i:o):t})),2);return[a[0],a[1]]}(t,n,r),")")}));t.attr("transform",n)}catch(t){}}function HB(){HD(this,"hidden"!==this.attributes.visibility)}var XB=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,nB({},{style:n},e))||this;return r.initialized=!1,r._defaultOptions=n,r}return n(e,t),Object.defineProperty(e.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=YD(this)),this._offscreen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultOptions",{get:function(){return this._defaultOptions},enumerable:!1,configurable:!0}),e.prototype.connectedCallback=function(){this.render(this.attributes,this),this.bindEvents(this.attributes,this),this.initialized=!0},e.prototype.disconnectedCallback=function(){var t;null===(t=this._offscreen)||void 0===t||t.destroy()},e.prototype.attributeChangedCallback=function(t){"visibility"===t&&HB.call(this)},e.prototype.update=function(t,e){var n;return this.attr(nB({},this.attributes,t||{})),null===(n=this.render)||void 0===n?void 0:n.call(this,this.attributes,this,e)},e.prototype.clear=function(){this.removeChildren()},e.prototype.bindEvents=function(t,e){},e.prototype.getSubShapeStyle=function(t){return t.x,t.y,t.transform,t.transformOrigin,t.class,t.className,t.zIndex,i(t,["x","y","transform","transformOrigin","class","className","zIndex"])},e}(Iw),YB=function(t,e,n){return[["M",t-n,e],["A",n,n,0,1,0,t+n,e],["A",n,n,0,1,0,t-n,e],["Z"]]},KB=YB,$B=function(t,e,n){return[["M",t,e+n],["L",t,e-n]]},qB=function(t,e,n){return[["M",t-n,e],["L",t+n,e]]},ZB=qB;var QB=function(t,e,n){return[["M",t-n,e-n],["L",t+n,e],["L",t-n,e+n],["Z"]]};function JB(t){var e=function(t){var e="default";if(M(t)&&t instanceof Image)e="image";else if(E(t))e="symbol";else if(N(t)){var n=new RegExp("data:(image|text)");e=t.match(n)?"base64":/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(t)?"url":"symbol"}return e}(t);return["base64","url","image"].includes(e)?"image":t&&"symbol"===e?"path":null}var tk=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(t,n){var o=t.x,a=void 0===o?0:o,s=t.y,l=void 0===s?0:s,u=this.getSubShapeStyle(t),c=u.symbol,h=u.size,d=void 0===h?16:h,f=i(u,["symbol","size"]),p=JB(c);hB(!!p,IB(n),(function(t){t.maybeAppendByClassName("marker",p).attr("className","marker ".concat(p,"-marker")).call((function(t){if("image"===p){var n=2*d;t.styles({img:c,width:n,height:n,x:a-d,y:l-d})}else{n=d/2;var i=E(c)?c:e.getSymbol(c);t.styles(r({d:null==i?void 0:i(a,l,n)},f))}}))}))},e.MARKER_SYMBOL_MAP=new Map,e.registerSymbol=function(t,n){e.MARKER_SYMBOL_MAP.set(t,n)},e.getSymbol=function(t){return e.MARKER_SYMBOL_MAP.get(t)},e.getSymbols=function(){return Array.from(e.MARKER_SYMBOL_MAP.keys())},e}(XB);function ek(t,...e){return e.reduce(((t,e)=>n=>t(e(n))),t)}function nk(t,e){return e-t?n=>(n-t)/(e-t):t=>.5}tk.registerSymbol("cross",(function(t,e,n){return[["M",t-n,e-n],["L",t+n,e+n],["M",t+n,e-n],["L",t-n,e+n]]})),tk.registerSymbol("hyphen",(function(t,e,n){return[["M",t-n,e],["L",t+n,e]]})),tk.registerSymbol("line",$B),tk.registerSymbol("plus",(function(t,e,n){return[["M",t-n,e],["L",t+n,e],["M",t,e-n],["L",t,e+n]]})),tk.registerSymbol("tick",(function(t,e,n){return[["M",t-n/2,e-n],["L",t+n/2,e-n],["M",t,e-n],["L",t,e+n],["M",t-n/2,e+n],["L",t+n/2,e+n]]})),tk.registerSymbol("circle",YB),tk.registerSymbol("point",KB),tk.registerSymbol("bowtie",(function(t,e,n){var r=n-1.5;return[["M",t-n,e-r],["L",t+n,e+r],["L",t+n,e-r],["L",t-n,e+r],["Z"]]})),tk.registerSymbol("hexagon",(function(t,e,n){var r=n/2*Math.sqrt(3);return[["M",t,e-n],["L",t+r,e-n/2],["L",t+r,e+n/2],["L",t,e+n],["L",t-r,e+n/2],["L",t-r,e-n/2],["Z"]]})),tk.registerSymbol("square",(function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]})),tk.registerSymbol("diamond",(function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]})),tk.registerSymbol("triangle",(function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+r],["L",t,e-r],["L",t+n,e+r],["Z"]]})),tk.registerSymbol("triangle-down",(function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-r],["L",t+n,e-r],["L",t,e+r],["Z"]]})),tk.registerSymbol("line",$B),tk.registerSymbol("dot",qB),tk.registerSymbol("dash",ZB),tk.registerSymbol("smooth",(function(t,e,n){return[["M",t-n,e],["A",n/2,n/2,0,1,1,t,e],["A",n/2,n/2,0,1,0,t+n,e]]})),tk.registerSymbol("hv",(function(t,e,n){return[["M",t-n-1,e-2.5],["L",t,e-2.5],["L",t,e+2.5],["L",t+n+1,e+2.5]]})),tk.registerSymbol("vh",(function(t,e,n){return[["M",t-n-1,e+2.5],["L",t,e+2.5],["L",t,e-2.5],["L",t+n+1,e-2.5]]})),tk.registerSymbol("hvh",(function(t,e,n){return[["M",t-(n+1),e+2.5],["L",t-n/2,e+2.5],["L",t-n/2,e-2.5],["L",t+n/2,e-2.5],["L",t+n/2,e+2.5],["L",t+n+1,e+2.5]]})),tk.registerSymbol("vhv",(function(t,e){return[["M",t-5,e+2.5],["L",t-5,e],["L",t,e],["L",t,e-3],["L",t,e+3],["L",t+6.5,e+3]]}));const rk=Math.sqrt(50),ik=Math.sqrt(10),ok=Math.sqrt(2);function ak(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/10**i;return i>=0?(o>=rk?10:o>=ik?5:o>=ok?2:1)*10**i:-(10**-i)/(o>=rk?10:o>=ik?5:o>=ok?2:1)}const sk=(t,e,n=5)=>{const r=[t,e];let i,o=0,a=r.length-1,s=r[o],l=r[a];return l<s&&([s,l]=[l,s],[o,a]=[a,o]),i=ak(s,l,n),i>0?(s=Math.floor(s/i)*i,l=Math.ceil(l/i)*i,i=ak(s,l,n)):i<0&&(s=Math.ceil(s*i)/i,l=Math.floor(l*i)/i,i=ak(s,l,n)),i>0?(r[o]=Math.floor(s/i)*i,r[a]=Math.ceil(l/i)*i):i<0&&(r[o]=Math.ceil(s*i)/i,r[a]=Math.floor(l*i)/i),r};function lk(t){return!(H(t)||(e=t,null===e)||Number.isNaN(t));var e}var uk={exports:{}},ck={exports:{}},hk=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},dk=Array.prototype.concat,fk=Array.prototype.slice,pk=ck.exports=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];hk(i)?e=dk.call(e,fk.call(i)):e.push(i)}return e};pk.wrap=function(t){return function(){return t(pk(arguments))}};var gk=ck.exports,vk={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},mk=gk,yk=Object.hasOwnProperty,Ek=Object.create(null);for(var _k in vk)yk.call(vk,_k)&&(Ek[vk[_k]]=_k);var bk=uk.exports={to:{},get:{}};function xk(t,e,n){return Math.min(Math.max(e,t),n)}function Sk(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}bk.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=bk.get.hsl(t),n="hsl";break;case"hwb":e=bk.get.hwb(t),n="hwb";break;default:e=bk.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},bk.get.rgb=function(t){if(!t)return null;var e,n,r,i=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=e[2],e=e[1],n=0;n<3;n++){var o=2*n;i[n]=parseInt(e.slice(o,o+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(e=e[1])[3],n=0;n<3;n++)i[n]=parseInt(e[n]+e[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)i[n]=parseInt(e[n+1],0);e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:yk.call(vk,e[1])?((i=vk[e[1]])[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}for(n=0;n<3;n++)i[n]=xk(i[n],0,255);return i[3]=xk(i[3],0,1),i},bk.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,xk(parseFloat(e[2]),0,100),xk(parseFloat(e[3]),0,100),xk(isNaN(n)?1:n,0,1)]}return null},bk.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,xk(parseFloat(e[2]),0,100),xk(parseFloat(e[3]),0,100),xk(isNaN(n)?1:n,0,1)]}return null},bk.to.hex=function(){var t=mk(arguments);return"#"+Sk(t[0])+Sk(t[1])+Sk(t[2])+(t[3]<1?Sk(Math.round(255*t[3])):"")},bk.to.rgb=function(){var t=mk(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},bk.to.rgb.percent=function(){var t=mk(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},bk.to.hsl=function(){var t=mk(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},bk.to.hwb=function(){var t=mk(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},bk.to.keyword=function(t){return Ek[t.slice(0,3)]};var Mk=ji(uk.exports);function Ak(t,e,n){let r=n;return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function Rk(t){const e=Mk.get(t);if(!e)return null;const{model:n,value:r}=e;return"rgb"===n?r:"hsl"===n?function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100,i=t[3];if(0===n)return[255*r,255*r,255*r,i];const o=r<.5?r*(1+n):r+n-r*n,a=2*r-o;return[255*Ak(a,o,e+1/3),255*Ak(a,o,e),255*Ak(a,o,e-1/3),i]}(r):null}const Tk=(t,e)=>n=>t*(1-n)+e*n,wk=(t,e)=>"number"==typeof t&&"number"==typeof e?Tk(t,e):"string"==typeof t&&"string"==typeof e?((t,e)=>{const n=Rk(t),r=Rk(e);return null===n||null===r?n?()=>t:()=>e:t=>{const e=new Array(4);for(let i=0;i<4;i+=1){const o=n[i],a=r[i];e[i]=o*(1-t)+a*t}const[i,o,a,s]=e;return`rgba(${Math.round(i)}, ${Math.round(o)}, ${Math.round(a)}, ${s})`}})(t,e):()=>t,Pk=(t,e)=>{const n=Tk(t,e);return t=>Math.round(n(t))};function Nk({map:t,initKey:e},n){const r=e(n);return t.has(r)?t.get(r):n}function Ck(t){return"object"==typeof t?t.valueOf():t}class Ok extends Map{constructor(t){if(super(),this.map=new Map,this.initKey=Ck,null!==t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(Nk({map:this.map,initKey:this.initKey},t))}has(t){return super.has(Nk({map:this.map,initKey:this.initKey},t))}set(t,e){return super.set(function({map:t,initKey:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}({map:this.map,initKey:this.initKey},t),e)}delete(t){return super.delete(function({map:t,initKey:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}({map:this.map,initKey:this.initKey},t))}}class Ik{constructor(t){this.options=$({},this.getDefaultOptions()),this.update(t)}getOptions(){return this.options}update(t={}){this.options=$({},this.options,t),this.rescale(t)}rescale(t){}}const Lk=Symbol("defaultUnknown");function Dk(t,e,n){for(let r=0;r<e.length;r+=1)t.has(e[r])||t.set(n(e[r]),r)}function Bk(t){const{value:e,from:n,to:r,mapper:i,notFoundReturn:o}=t;let a=i.get(e);if(void 0===a){if(o!==Lk)return o;a=n.push(e)-1,i.set(e,a)}return r[a%r.length]}function kk(t){return t instanceof Date?t=>`${t}`:"object"==typeof t?t=>JSON.stringify(t):t=>t}class Fk extends Ik{getDefaultOptions(){return{domain:[],range:[],unknown:Lk}}constructor(t){super(t)}map(t){return 0===this.domainIndexMap.size&&Dk(this.domainIndexMap,this.getDomain(),this.domainKey),Bk({value:this.domainKey(t),mapper:this.domainIndexMap,from:this.getDomain(),to:this.getRange(),notFoundReturn:this.options.unknown})}invert(t){return 0===this.rangeIndexMap.size&&Dk(this.rangeIndexMap,this.getRange(),this.rangeKey),Bk({value:this.rangeKey(t),mapper:this.rangeIndexMap,from:this.getRange(),to:this.getDomain(),notFoundReturn:this.options.unknown})}rescale(t){const[e]=this.options.domain,[n]=this.options.range;if(this.domainKey=kk(e),this.rangeKey=kk(n),!this.rangeIndexMap)return this.rangeIndexMap=new Map,void(this.domainIndexMap=new Map);t&&!t.range||this.rangeIndexMap.clear(),(!t||t.domain||t.compare)&&(this.domainIndexMap.clear(),this.sortedDomain=void 0)}clone(){return new Fk(this.options)}getRange(){return this.options.range}getDomain(){if(this.sortedDomain)return this.sortedDomain;const{domain:t,compare:e}=this.options;return this.sortedDomain=e?[...t].sort(e):t,this.sortedDomain}}function Uk(t){return Math.round(1e12*t)/1e12}function Gk(t){const{domain:e,range:n,paddingOuter:r,paddingInner:i,flex:o,round:a,align:s}=t,l=e.length,u=function(t,e){const n=e-t.length;return n>0?[...t,...new Array(n).fill(1)]:n<0?t.slice(0,e):t}(o,l),[c,h]=n,d=h-c,f=d/(2/l*r+1-1/l*i),p=f*i/l,g=f-l*p,v=function(t){const e=Math.min(...t);return t.map((t=>t/e))}(u),m=g/v.reduce(((t,e)=>t+e)),y=new Ok(e.map(((t,e)=>{const n=v[e]*m;return[t,a?Math.floor(n):n]}))),E=new Ok(e.map(((t,e)=>{const n=v[e]*m+p;return[t,a?Math.floor(n):n]}))),_=Array.from(E.values()).reduce(((t,e)=>t+e)),b=c+(d-(_-_/l*i))*s;let x=a?Math.round(b):b;const S=new Array(l);for(let t=0;t<l;t+=1){S[t]=Uk(x);const n=e[t];x+=E.get(n)}return{valueBandWidth:y,valueStep:E,adjustedRange:S}}class zk extends Fk{getDefaultOptions(){return{domain:[],range:[0,1],align:.5,round:!1,paddingInner:0,paddingOuter:0,padding:0,unknown:Lk,flex:[]}}constructor(t){super(t)}clone(){return new zk(this.options)}getStep(t){return void 0===this.valueStep?1:"number"==typeof this.valueStep?this.valueStep:void 0===t?Array.from(this.valueStep.values())[0]:this.valueStep.get(t)}getBandWidth(t){return void 0===this.valueBandWidth?1:"number"==typeof this.valueBandWidth?this.valueBandWidth:void 0===t?Array.from(this.valueBandWidth.values())[0]:this.valueBandWidth.get(t)}getRange(){return this.adjustedRange}getPaddingInner(){const{padding:t,paddingInner:e}=this.options;return t>0?t:e}getPaddingOuter(){const{padding:t,paddingOuter:e}=this.options;return t>0?t:e}rescale(){super.rescale();const{align:t,domain:e,range:n,round:r,flex:i}=this.options,{adjustedRange:o,valueBandWidth:a,valueStep:s}=function(t){var e;const{domain:n}=t,r=n.length;if(0===r)return{valueBandWidth:void 0,valueStep:void 0,adjustedRange:[]};if(null===(e=t.flex)||void 0===e?void 0:e.length)return Gk(t);const{range:i,paddingOuter:o,paddingInner:a,round:s,align:l}=t;let u,c,h=i[0];const d=i[1]-h,f=2*o,p=r-a;u=d/Math.max(1,f+p),s&&(u=Math.floor(u)),h+=(d-u*(r-a))*l,c=u*(1-a),s&&(h=Math.round(h),c=Math.round(c));const g=new Array(r).fill(0).map(((t,e)=>h+e*u));return{valueStep:u,valueBandWidth:c,adjustedRange:g}}({align:t,range:n,round:r,flex:i,paddingInner:this.getPaddingInner(),paddingOuter:this.getPaddingOuter(),domain:e});this.valueStep=s,this.valueBandWidth=a,this.adjustedRange=o}}const Vk=(t,e,n)=>{let r,i,o=t,a=e;if(o===a&&n>0)return[o];let s=ak(o,a,n);if(0===s||!Number.isFinite(s))return[];if(s>0){o=Math.ceil(o/s),a=Math.floor(a/s),i=new Array(r=Math.ceil(a-o+1));for(let t=0;t<r;t+=1)i[t]=(o+t)*s}else{s=-s,o=Math.ceil(o*s),a=Math.floor(a*s),i=new Array(r=Math.ceil(a-o+1));for(let t=0;t<r;t+=1)i[t]=(o+t)/s}return i},Wk=(t,e,n)=>{const[r,i]=t,[o,a]=e;let s,l;return r<i?(s=nk(r,i),l=n(o,a)):(s=nk(i,r),l=n(a,o)),ek(l,s)},jk=(t,e,n)=>{const r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=t[0]>t[r],s=a?[...t].reverse():t,l=a?[...e].reverse():e;for(let t=0;t<r;t+=1)i[t]=nk(s[t],s[t+1]),o[t]=n(l[t],l[t+1]);return e=>{const n=function(t,e,n,r,i){let o=n||0,a=r||t.length;for(;o<a;){const n=Math.floor((o+a)/2);t[n]>e?a=n:o=n+1}return o}(t,e,1,r)-1,a=i[n];return ek(o[n],a)(e)}},Hk=(t,e,n,r)=>(Math.min(t.length,e.length)>2?jk:Wk)(t,e,r?Pk:n);class Xk extends Ik{getDefaultOptions(){return{domain:[0,1],range:[0,1],nice:!1,clamp:!1,round:!1,interpolate:Tk,tickCount:5}}map(t){return lk(t)?this.output(t):this.options.unknown}invert(t){return lk(t)?this.input(t):this.options.unknown}nice(){if(!this.options.nice)return;const[t,e,n,...r]=this.getTickMethodOptions();this.options.domain=this.chooseNice()(t,e,n,...r)}getTicks(){const{tickMethod:t}=this.options,[e,n,r,...i]=this.getTickMethodOptions();return t(e,n,r,...i)}getTickMethodOptions(){const{domain:t,tickCount:e}=this.options;return[t[0],t[t.length-1],e]}chooseNice(){return sk}rescale(){this.nice();const[t,e]=this.chooseTransforms();this.composeOutput(t,this.chooseClamp(t)),this.composeInput(t,e,this.chooseClamp(e))}chooseClamp(t){const{clamp:e,range:n}=this.options,r=this.options.domain.map(t),i=Math.min(r.length,n.length);return e?function(t,e){const n=e<t?e:t,r=t>e?t:e;return t=>Math.min(Math.max(n,t),r)}(r[0],r[i-1]):at}composeOutput(t,e){const{domain:n,range:r,round:i,interpolate:o}=this.options,a=Hk(n.map(t),r,o,i);this.output=ek(a,e,t)}composeInput(t,e,n){const{domain:r,range:i}=this.options,o=Hk(i,r.map(t),Tk);this.input=ek(e,n,o)}}class Yk extends Xk{getDefaultOptions(){return{domain:[0,1],range:[0,1],unknown:void 0,nice:!1,clamp:!1,round:!1,interpolate:wk,tickMethod:Vk,tickCount:5}}chooseTransforms(){return[at,at]}clone(){return new Yk(this.options)}}var Kk=function(t){function e(e){var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,$({},{type:"column"},r({style:o},a)))||this).columnsGroup=new Dw({name:"columns"}),n.appendChild(n.columnsGroup),n.render(),n}return n(e,t),e.prototype.render=function(){var t=this.attributes,e=t.columns,n=t.x,r=t.y;this.columnsGroup.style.transform="translate(".concat(n,", ").concat(r,")"),IB(this.columnsGroup).selectAll(".column").data(e.flat()).join((function(t){return t.append("rect").attr("className","column").each((function(t){this.attr(t)}))}),(function(t){return t.each((function(t){this.attr(t)}))}),(function(t){return t.remove()}))},e.prototype.update=function(t){this.attr(nB({},this.attributes,t)),this.render()},e.prototype.clear=function(){this.removeChildren()},e}(Cw),$k=function(t){function e(e){var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,$({},{type:"lines"},r({style:o},a)))||this).linesGroup=n.appendChild(new Dw),n.areasGroup=n.appendChild(new Dw),n.render(),n}return n(e,t),e.prototype.render=function(){var t=this.attributes,e=t.lines,n=t.areas,r=t.x,i=t.y;this.style.transform="translate(".concat(r,", ").concat(i,")"),e&&this.renderLines(e),n&&this.renderAreas(n)},e.prototype.clear=function(){this.linesGroup.removeChildren(),this.areasGroup.removeChildren()},e.prototype.update=function(t){this.attr(nB({},this.attributes,t)),this.render()},e.prototype.renderLines=function(t){IB(this.linesGroup).selectAll(".line").data(t).join((function(t){return t.append("path").attr("className","line").each((function(t){this.attr(t)}))}),(function(t){return t.each((function(t){this.attr(t)}))}),(function(t){return t.remove()}))},e.prototype.renderAreas=function(t){IB(this.linesGroup).selectAll(".area").data(t).join((function(t){return t.append("path").attr("className","area").each((function(t){this.attr(t)}))}),(function(t){return t.each((function(t){this.style(t)}))}),(function(t){return t.remove()}))},e}(Cw);function qk(t,e){void 0===e&&(e=!1);var n=e?t.length-1:0,r=t.map((function(t,e){return u([e===n?"M":"L"],l(t),!1)}));return e?r.reverse():r}function Zk(t,e){if(void 0===e&&(e=!1),t.length<=2)return qk(t);for(var n=[],r=t.length,i=0;i<r;i+=1){var o=e?t[r-i-1]:t[i];Q(o,n.slice(-2))||n.push.apply(n,u([],l(o),!1))}var a=TB(n,!1);return e?a.unshift(u(["M"],l(t[r-1]),!1)):a.unshift(u(["M"],l(t[0]),!1)),a}function Qk(t,e,n){var r=X(t);return r.push(["L",e,n],["L",0,n],["Z"]),r}function Jk(t){return 0===t.length?[0,0]:[P(k(t,(function(t){return P(t)||0}))),w(B(t,(function(t){return w(t)||0})))]}function tF(t){for(var e=X(t),n=e[0].length,r=l([Array(n).fill(0),Array(n).fill(0)],2),i=r[0],o=r[1],a=0;a<e.length;a+=1)for(var s=e[a],u=0;u<n;u+=1)s[u]>=0?(s[u]+=i[u],i[u]=s[u]):(s[u]+=o[u],o[u]=s[u]);return e}var eF=function(t){function e(e){return t.call(this,e,{type:"line",x:0,y:0,width:200,height:20,isStack:!1,color:["#83daad","#edbf45","#d2cef9","#e290b3","#6f63f4"],smooth:!0,lineLineWidth:1,areaOpacity:0,isGroup:!1,columnLineWidth:1,columnStroke:"#fff",scale:1,spacing:0})||this}return n(e,t),Object.defineProperty(e.prototype,"rawData",{get:function(){var t=this.attributes.data;if(!t||0===(null==t?void 0:t.length))return[[]];var e=X(t);return I(e[0])?[e]:e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.isStack?tF(this.rawData):this.rawData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scales",{get:function(){return this.createScales(this.data)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseline",{get:function(){var t=this.scales.y,e=l(t.getOptions().domain||[0,0],2),n=e[0],r=e[1];return r<0?t.map(r):t.map(n<0?0:n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"containerShape",{get:function(){var t=this.attributes;return{width:t.width,height:t.height}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linesStyle",{get:function(){var t=this,e=this.attributes,n=e.type,i=e.isStack,o=e.smooth;if("line"!==n)throw new Error("linesStyle can only be used in line type");var a=GB(this.attributes,"area"),s=GB(this.attributes,"line"),c=this.containerShape.width,h=this.data;if(0===h[0].length)return{lines:[],areas:[]};var d=this.scales,f=function(t,e){var n,r=e.x,i=e.y,o=l(i.getOptions().range||[0,0],2),a=o[0],s=o[1];return s>a&&(n=l([a,s],2),s=n[0],a=n[1]),t.map((function(t){return t.map((function(t,e){return[r.map(e),O(i.map(t),s,a)]}))}))}(h,{type:"line",x:d.x,y:d.y}),p=[];if(a){var g=this.baseline;p=i?o?function(t,e,n){for(var r=[],i=t.length-1;i>=0;i-=1){var o=t[i],a=Zk(o),s=void 0;if(0===i)s=Qk(a,e,n);else{var c=Zk(t[i-1],!0),h=o[0];c[0][0]="L",s=u(u(u([],l(a),!1),l(c),!1),[u(["M"],l(h),!1),["Z"]],!1)}r.push(s)}return r}(f,c,g):function(t,e,n){for(var r=[],i=t.length-1;i>=0;i-=1){var o=qk(t[i]),a=void 0;if(0===i)a=Qk(o,e,n);else{var s=qk(t[i-1],!0);s[0][0]="L",a=u(u(u([],l(o),!1),l(s),!1),[["Z"]],!1)}r.push(a)}return r}(f,c,g):function(t,e,n,r){return t.map((function(t){return Qk(e?Zk(t):qk(t),n,r)}))}(f,o,c,g)}return{lines:f.map((function(e,n){return r({stroke:t.getColor(n),d:o?Zk(e):qk(e)},s)})),areas:p.map((function(e,n){return r({d:e,fill:t.getColor(n)},a)}))}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columnsStyle",{get:function(){var t=this,e=GB(this.attributes,"column"),n=this.attributes,i=n.isStack,o=n.type,a=n.scale;if("column"!==o)throw new Error("columnsStyle can only be used in column type");var s=this.containerShape.height,u=this.rawData;if(!u)return{columns:[]};i&&(u=tF(u));var c=this.createScales(u),h=c.x,d=c.y,f=l(Jk(u),2),p=f[0],g=f[1],v=new Yk({domain:[0,g-(p>0?0:p)],range:[0,s*a]}),m=h.getBandWidth(),y=this.rawData;return{columns:u.map((function(n,o){return n.map((function(n,a){var s=m/u.length;return r(r({fill:t.getColor(o)},e),i?{x:h.map(a),y:d.map(n),width:m,height:v.map(y[o][a])}:{x:h.map(a)+s*o,y:n>=0?d.map(n):d.map(0),width:s,height:v.map(Math.abs(n))})}))}))}},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){var n,i,o;(n=e,i=".container",o="rect",n.querySelector(i)?IB(n).select(i):IB(n).append(o)).attr("className","container").node();var a=t.type,s=t.x,l=t.y,u="spark".concat(a),c=r({x:s,y:l},"line"===a?this.linesStyle:this.columnsStyle);IB(e).selectAll(".spark").data([a]).join((function(t){return t.append((function(t){return"line"===t?new $k({className:u,style:c}):new Kk({className:u,style:c})})).attr("className","spark ".concat(u))}),(function(t){return t.update(c)}),(function(t){return t.remove()}))},e.prototype.getColor=function(t){var e=this.attributes.color;return S(e)?e[t%e.length]:E(e)?e.call(null,t):e},e.prototype.createScales=function(t){var e,n,r=this.attributes,i=r.type,o=r.scale,a=r.range,s=void 0===a?[]:a,u=r.spacing,c=this.containerShape,h=c.width,d=c.height,f=l(Jk(t),2),p=f[0],g=f[1],v=new Yk({domain:[null!==(e=s[0])&&void 0!==e?e:p,null!==(n=s[1])&&void 0!==n?n:g],range:[d,d*(1-o)]});return"line"===i?{type:i,x:new Yk({domain:[0,t[0].length-1],range:[0,h]}),y:v}:{type:i,x:new zk({domain:t[0].map((function(t,e){return e})),range:[0,h],paddingInner:u,paddingOuter:u/2,align:.5}),y:v}},e.tag="sparkline",e}(XB);function nF(t){if(!t)return{enter:!1,update:!1,exit:!1};var e=["enter","update","exit"],n=Object.fromEntries(Object.entries(t).filter((function(t){var n=l(t,1)[0];return!e.includes(n)})));return Object.fromEntries(e.map((function(e){return function(t){return"boolean"!=typeof t&&"enter"in t&&"update"in t&&"exit"in t}(t)?!1===t[e]?[e,!1]:[e,r(r({},t[e]),n)]:[e,n]})))}function rF(t,e){t?t.finished.then(e):e()}function iF(t,e){"update"in t?t.update(e):t.attr(e)}function oF(t,e,n){return 0===e.length?null:n?t.animate(e,n):(iF(t,{style:e.slice(-1)[0]}),null)}function aF(t,e,n){var i={},o={};return Object.entries(e).forEach((function(e){var n=l(e,2),r=n[0],a=n[1];if(!_(a)){var s=t.style[r]||t.parsedStyle[r]||0;s!==a&&(i[r]=s,o[r]=a)}})),n?oF(t,[i,o],r({fill:"both"},n)):(iF(t,o),null)}function sF(t,e){return t.style.opacity||(t.style.opacity=1),aF(t,{opacity:0},e)}var lF={fill:"#fff",lineWidth:1,radius:2,size:10,stroke:"#bfbfbf",strokeOpacity:1,zIndex:0},uF={fill:"#000",fillOpacity:.45,fontSize:12,textAlign:"center",textBaseline:"middle",zIndex:1},cF={x:0,y:0,orientation:"horizontal",showLabel:!0,type:"start"},hF=tB({foreground:"foreground",handle:"handle",selection:"selection",sparkline:"sparkline",sparklineGroup:"sparkline-group",track:"track",brushArea:"brush-area"},"slider"),dF=tB({labelGroup:"label-group",label:"label",iconGroup:"icon-group",icon:"icon",iconRect:"icon-rect",iconLine:"icon-line"},"handle"),fF=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(t,e){var n=t.x,o=t.y,a=t.size,s=void 0===a?10:a,l=t.radius,u=void 0===l?s/4:l,c=t.orientation,h=i(t,["x","y","size","radius","orientation"]),d=s,f=2.4*d,p=IB(e).maybeAppendByClassName(dF.iconRect,"rect").styles(r(r({},h),{width:d,height:f,radius:u,x:n-d/2,y:o-f/2,transformOrigin:"center"})),g=n+1/3*d-d/2,v=n+2/3*d-d/2,m=o+1/4*f-f/2,y=o+3/4*f-f/2;p.maybeAppendByClassName("".concat(dF.iconLine,"-1"),"line").styles(r({x1:g,x2:g,y1:m,y2:y},h)),p.maybeAppendByClassName("".concat(dF.iconLine,"-2"),"line").styles(r({x1:v,x2:v,y1:m,y2:y},h)),"vertical"===c&&(p.node().style.transform="rotate(90)")},e}(XB),pF=function(t){function e(e){return t.call(this,e,cF)||this}return n(e,t),e.prototype.renderLabel=function(t){var e=this,n=this.attributes,o=n.x,a=n.y,s=n.showLabel,u=GB(this.attributes,"label"),c=u.x,h=void 0===c?0:c,d=u.y,f=void 0===d?0:d,p=u.transform,g=u.transformOrigin,v=l(VB(i(u,["x","y","transform","transformOrigin"]),[]),2),m=v[0],y=v[1],E=IB(t).maybeAppendByClassName(dF.labelGroup,"g").styles(y),_=r(r({},uF),m),b=_.text,x=i(_,["text"]);hB(!!s,E,(function(t){e.label=t.maybeAppendByClassName(dF.label,"text").styles(r(r({},x),{x:o+h,y:a+f,transform:p,transformOrigin:g,text:"".concat(b)})),e.label.on("mousedown",(function(t){t.stopPropagation()})),e.label.on("touchstart",(function(t){t.stopPropagation()}))}))},e.prototype.renderIcon=function(t){var e=this.attributes,n=e.x,i=e.y,o=e.orientation,a=e.type,s=r(r({x:n,y:i,orientation:o},lF),GB(this.attributes,"icon")),l=this.attributes.iconShape,u=void 0===l?function(){return new fF({style:s})}:l;IB(t).maybeAppendByClassName(dF.iconGroup,"g").selectAll(dF.icon.class).data([u]).join((function(t){return t.append("string"==typeof u?u:function(){return u(a)}).attr("className",dF.icon.name)}),(function(t){return t.update(s)}),(function(t){return t.remove()}))},e.prototype.render=function(t,e){this.renderIcon(e),this.renderLabel(e)},e}(XB),gF=function(t){function e(e){var n=t.call(this,e,r(r(r({x:0,y:0,animate:{duration:100,fill:"both"},brushable:!0,formatter:function(t){return t.toString()},handleSpacing:2,orientation:"horizontal",padding:0,autoFitLabel:!0,scrollable:!0,selectionFill:"#5B8FF9",selectionFillOpacity:.45,selectionZIndex:2,showHandle:!0,showLabel:!0,slidable:!0,trackFill:"#416180",trackLength:200,trackOpacity:.05,trackSize:20,trackZIndex:-1,values:[0,1],type:"range",selectionType:"select",handleIconOffset:0},zB(cF,"handle")),zB(lF,"handleIcon")),zB(uF,"handleLabel")))||this;return n.range=[0,1],n.onDragStart=function(t){return function(e){e.stopPropagation(),n.target=t,n.prevPos=n.getOrientVal(uB(e));var r=n.availableSpace,i=r.x,o=r.y,a=n.getBBox(),s=a.x,l=a.y;n.selectionStartPos=n.getRatio(n.prevPos-n.getOrientVal([i,o])-n.getOrientVal([+s,+l])),n.selectionWidth=0,document.addEventListener("pointermove",n.onDragging),document.addEventListener("pointerup",n.onDragEnd)}},n.onDragging=function(t){var e=n.attributes,r=e.slidable,i=e.brushable,o=e.type;t.stopPropagation();var a=n.getOrientVal(uB(t)),s=a-n.prevPos;if(s){var l=n.getRatio(s);switch(n.target){case"start":r&&n.setValuesOffset(l);break;case"end":r&&n.setValuesOffset(0,l);break;case"selection":r&&n.setValuesOffset(l,l);break;case"track":if(!i)return;n.selectionWidth+=l,"range"===o?n.innerSetValues([n.selectionStartPos,n.selectionStartPos+n.selectionWidth].sort(),!0):n.innerSetValues([0,n.selectionStartPos+n.selectionWidth],!0)}n.prevPos=a}},n.onDragEnd=function(){document.removeEventListener("pointermove",n.onDragging),document.removeEventListener("pointermove",n.onDragging),document.removeEventListener("pointerup",n.onDragEnd),n.target="",n.updateHandlesPosition(!1)},n.onValueChange=function(t){var e=n.attributes,r=e.onChange,i=e.type,o="range"===i?t:t[1],a="range"===i?n.getValues():n.getValues()[1],s=new ZT("valuechange",{detail:{oldValue:o,value:a}});n.dispatchEvent(s),null==r||r(a)},n.selectionStartPos=0,n.selectionWidth=0,n.prevPos=0,n.target="",n}return n(e,t),Object.defineProperty(e.prototype,"values",{get:function(){return this.attributes.values},set:function(t){this.attributes.values=this.clampValues(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sparklineStyle",{get:function(){if("horizontal"!==this.attributes.orientation)return null;var t=GB(this.attributes,"sparkline");return r(r({zIndex:0},this.availableSpace),t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shape",{get:function(){var t=this.attributes,e=t.trackLength,n=t.trackSize,r=l(this.getOrientVal([[e,n],[n,e]]),2);return{width:r[0],height:r[1]}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"availableSpace",{get:function(){var t=this.attributes;t.x,t.y;var e=l(LB(t.padding),4),n=e[0],r=e[1],i=e[2],o=e[3],a=this.shape;return{x:o,y:n,width:a.width-(o+r),height:a.height-(n+i)}},enumerable:!1,configurable:!0}),e.prototype.getValues=function(){return this.values},e.prototype.setValues=function(t,e){void 0===t&&(t=[0,0]),void 0===e&&(e=!1),this.attributes.values=t;var n=!1!==e&&this.attributes.animate;this.updateSelectionArea(n),this.updateHandlesPosition(n)},e.prototype.updateSelectionArea=function(t){var e=this.calcSelectionArea();this.foregroundGroup.selectAll(hF.selection.class).each((function(n,r){aF(this,e[r],t)}))},e.prototype.updateHandlesPosition=function(t){this.attributes.showHandle&&(this.startHandle&&aF(this.startHandle,this.getHandleStyle("start"),t),this.endHandle&&aF(this.endHandle,this.getHandleStyle("end"),t))},e.prototype.innerSetValues=function(t,e){void 0===t&&(t=[0,0]),void 0===e&&(e=!1);var n=this.values,r=this.clampValues(t);this.attributes.values=r,this.setValues(r),e&&this.onValueChange(n)},e.prototype.renderTrack=function(t){var e=this.attributes,n=e.x,i=e.y,o=GB(this.attributes,"track");this.trackShape=IB(t).maybeAppendByClassName(hF.track,"rect").styles(r(r({x:n,y:i},this.shape),o))},e.prototype.renderBrushArea=function(t){var e=this.attributes,n=e.x,i=e.y,o=e.brushable;this.brushArea=IB(t).maybeAppendByClassName(hF.brushArea,"rect").styles(r({x:n,y:i,fill:"transparent",cursor:o?"crosshair":"default"},this.shape))},e.prototype.renderSparkline=function(t){var e=this,n=this.attributes,i=n.x,o=n.y;hB("horizontal"===n.orientation,IB(t).maybeAppendByClassName(hF.sparklineGroup,"g"),(function(t){var n=r(r({},e.sparklineStyle),{x:i,y:o});t.maybeAppendByClassName(hF.sparkline,(function(){return new eF({style:n})})).update(n)}))},e.prototype.renderHandles=function(){var t,e=this,n=this.attributes,r=n.showHandle,i=n.type,o=r?"range"===i?["start","end"]:["end"]:[],a=this;null===(t=this.foregroundGroup)||void 0===t||t.selectAll(hF.handle.class).data(o.map((function(t){return{type:t}})),(function(t){return t.type})).join((function(t){return t.append((function(t){var n=t.type;return new pF({style:e.getHandleStyle(n)})})).each((function(t){var e=t.type;this.attr("class","".concat(hF.handle.name," ").concat(e,"-handle"));var n="".concat(e,"Handle");a[n]=this,this.addEventListener("pointerdown",a.onDragStart(e))}))}),(function(t){return t.each((function(t){var e=t.type;this.update(a.getHandleStyle(e))}))}),(function(t){return t.each((function(t){var e=t.type,n="".concat(e,"Handle");a[n]=void 0})).remove()}))},e.prototype.renderSelection=function(t){var e=this.attributes,n=e.x,i=e.y,o=e.type,a=e.selectionType;this.foregroundGroup=IB(t).maybeAppendByClassName(hF.foreground,"g");var s=GB(this.attributes,"selection"),l=function(t){return t.style("visibility",(function(t){return t.show?"visible":"hidden"})).style("cursor",(function(t){return"select"===a?"grab":"invert"===a?"crosshair":"default"})).styles(r(r({},s),{transform:"translate(".concat(n,", ").concat(i,")")}))},u=this;this.foregroundGroup.selectAll(hF.selection.class).data("value"===o?[]:this.calcSelectionArea().map((function(t,e){return{style:r({},t),index:e,show:"select"===a?1===e:1!==e}})),(function(t){return t.index})).join((function(t){return t.append("rect").attr("className",hF.selection.name).call(l).each((function(t,e){var n=this;1===e?(u.selectionShape=IB(this),this.on("pointerdown",(function(t){n.attr("cursor","grabbing"),u.onDragStart("selection")(t)})),u.dispatchCustomEvent(this,"pointerenter","selectionMouseenter"),u.dispatchCustomEvent(this,"pointerleave","selectionMouseleave"),u.dispatchCustomEvent(this,"click","selectionClick"),this.addEventListener("pointerdown",(function(){n.attr("cursor","grabbing")})),this.addEventListener("pointerup",(function(){n.attr("cursor","pointer")})),this.addEventListener("pointerover",(function(){n.attr("cursor","pointer")}))):this.on("pointerdown",u.onDragStart("track"))}))}),(function(t){return t.call(l)}),(function(t){return t.remove()})),this.updateSelectionArea(!1),this.renderHandles()},e.prototype.render=function(t,e){this.renderTrack(e),this.renderSparkline(e),this.renderBrushArea(e),this.renderSelection(e)},e.prototype.clampValues=function(t,e){var n;void 0===e&&(e=4);var r=l(this.range,2),i=r[0],o=r[1],a=l(this.getValues().map((function(t){return AB(t,e)})),2),s=a[0],u=a[1],c=l(((Array.isArray(t)?t:[s,null!=t?t:u])||[s,u]).map((function(t){return AB(t,e)})),2),h=c[0],d=c[1];if("value"===this.attributes.type)return[0,O(d,i,o)];h>d&&(h=(n=l([d,h],2))[0],d=n[1]);var f=d-h;return f>o-i?[i,o]:h<i?s===i&&u===d?[i,d]:[i,f+i]:d>o?u===o&&s===h?[h,o]:[o-f,o]:[h,d]},e.prototype.calcSelectionArea=function(t){var e=l(this.clampValues(t),2),n=e[0],r=e[1],i=this.availableSpace,o=i.x,a=i.y,s=i.width,u=i.height;return this.getOrientVal([[{y:a,height:u,x:o,width:n*s},{y:a,height:u,x:n*s+o,width:(r-n)*s},{y:a,height:u,x:r*s,width:(1-r)*s}],[{x:o,width:s,y:a,height:n*u},{x:o,width:s,y:n*u+a,height:(r-n)*u},{x:o,width:s,y:r*u,height:(1-r)*u}]])},e.prototype.calcHandlePosition=function(t){var e=this.attributes.handleIconOffset,n=this.availableSpace,r=n.x,i=n.y,o=n.width,a=n.height,s=l(this.clampValues(),2),u=s[0],c=s[1],h="start"===t?-e:e,d=("start"===t?u:c)*this.getOrientVal([o,a])+h;return{x:r+this.getOrientVal([d,o/2]),y:i+this.getOrientVal([a/2,d])}},e.prototype.inferTextStyle=function(t){return"horizontal"===this.attributes.orientation?{}:"start"===t?{transformOrigin:"left center",transform:"rotate(90)",textAlign:"start"}:"end"===t?{transformOrigin:"right center",transform:"rotate(90)",textAlign:"end"}:{}},e.prototype.calcHandleText=function(t){var e,n=this.attributes,i=n.type,o=n.orientation,a=n.formatter,s=n.autoFitLabel,l=GB(this.attributes,"handle"),u=GB(l,"label"),c=l.spacing,h=this.getHandleSize(),d=this.clampValues(),f=a("start"===t?d[0]:d[1]),p=new KD({style:r(r(r({},u),this.inferTextStyle(t)),{text:f})}),g=p.getBBox(),v=g.width,m=g.height;if(p.destroy(),!s){if("value"===i)return{text:f,x:0,y:-m-c};var y=c+h+("horizontal"===o?v/2:0);return(e={text:f})["horizontal"===o?"x":"y"]="start"===t?-y:y,e}var E=0,_=0,b=this.availableSpace,x=b.width,S=b.height,M=this.calcSelectionArea()[1],A=M.x,R=M.y,T=M.width,w=M.height,P=c+h;if("horizontal"===o){var N=P+v/2;if("start"===t)E=A-P-v>0?-N:N;else E=x-A-T-P>v?N:-N}else{var C=m+P;_="start"===t?R-h>m?-C:P:S-(R+w)-h>m?C:-P}return{x:E,y:_,text:f}},e.prototype.getHandleLabelStyle=function(t){var e=GB(this.attributes,"handleLabel");return r(r(r({},e),this.calcHandleText(t)),this.inferTextStyle(t))},e.prototype.getHandleIconStyle=function(){var t=this.attributes.handleIconShape,e=GB(this.attributes,"handleIcon"),n=this.getOrientVal(["ew-resize","ns-resize"]),i=this.getHandleSize();return r({cursor:n,shape:t,size:i},e)},e.prototype.getHandleStyle=function(t){var e=this.attributes,n=e.x,i=e.y,o=e.showLabel,a=e.showLabelOnInteraction,s=e.orientation,l=this.calcHandlePosition(t),u=l.x,c=l.y,h=this.calcHandleText(t),d=o;return!o&&a&&(d=!!this.target),r(r(r({},zB(this.getHandleIconStyle(),"icon")),zB(r(r({},this.getHandleLabelStyle(t)),h),"label")),{transform:"translate(".concat(u+n,", ").concat(c+i,")"),orientation:s,showLabel:d,type:t,zIndex:3})},e.prototype.getHandleSize=function(){var t=this.attributes,e=t.handleIconSize,n=t.width,r=t.height;return e||Math.floor((this.getOrientVal([+r,+n])+4)/2.4)},e.prototype.getOrientVal=function(t){var e=l(t,2),n=e[0],r=e[1];return"horizontal"===this.attributes.orientation?n:r},e.prototype.setValuesOffset=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=!1);var r=this.attributes.type,i=l(this.getValues(),2),o=[i[0]+("range"===r?t:0),i[1]+e].sort();n?this.setValues(o):this.innerSetValues(o,!0)},e.prototype.getRatio=function(t){var e=this.availableSpace,n=e.width,r=e.height;return t/this.getOrientVal([n,r])},e.prototype.dispatchCustomEvent=function(t,e,n){var r=this;t.on(e,(function(t){t.stopPropagation(),r.dispatchEvent(new ZT(n,{detail:t}))}))},e.prototype.bindEvents=function(){this.addEventListener("wheel",this.onScroll);var t=this.brushArea;this.dispatchCustomEvent(t,"click","trackClick"),this.dispatchCustomEvent(t,"pointerenter","trackMouseenter"),this.dispatchCustomEvent(t,"pointerleave","trackMouseleave"),t.on("pointerdown",this.onDragStart("track"))},e.prototype.onScroll=function(t){if(this.attributes.scrollable){var e=t.deltaX,n=t.deltaY||e,r=this.getRatio(n);this.setValuesOffset(r,r,!0)}},e.tag="slider",e}(XB),vF={data:[],animate:{enter:!1,update:{duration:100,easing:"ease-in-out-sine",fill:"both"},exit:{duration:100,fill:"both"}},showArrow:!0,showGrid:!0,showLabel:!0,showLine:!0,showTick:!0,showTitle:!0,showTrunc:!1,dataThreshold:100,lineLineWidth:1,lineStroke:"black",crossPadding:10,titleFill:"black",titleFontSize:12,titlePosition:"lb",titleSpacing:0,titleTextAlign:"center",titleTextBaseline:"middle",lineArrow:function(){return new Uw({style:{d:[["M",10,10],["L",-10,0],["L",10,-10],["L",0,0],["L",10,10],["Z"]],fill:"black",transformOrigin:"center"}})},labelAlign:"parallel",labelDirection:"positive",labelFontSize:12,labelSpacing:0,gridConnect:"line",gridControlAngles:[],gridDirection:"positive",gridLength:0,gridType:"segment",lineArrowOffset:15,lineArrowSize:10,tickDirection:"positive",tickLength:5,tickLineWidth:1,tickStroke:"black",labelOverlap:[]};$({},vF,{style:{type:"arc"}}),$({},vF,{style:{}});var mF=tB({mainGroup:"main-group",gridGroup:"grid-group",grid:"grid",lineGroup:"line-group",line:"line",tickGroup:"tick-group",tick:"tick",tickItem:"tick-item",labelGroup:"label-group",label:"label",labelItem:"label-item",titleGroup:"title-group",title:"title",lineFirst:"line-first",lineSecond:"line-second"},"axis"),yF=tB({lineGroup:"line-group",line:"line",regionGroup:"region-group",region:"region"},"grid");function EF(t){return t.reduce((function(t,e,n){return t.push(u([0===n?"M":"L"],l(e),!1)),t}),[])}function _F(t,e,n){return"surround"===e.type?function(t,e,n){var r=e.connect,i=void 0===r?"line":r,o=e.center;if("line"===i)return EF(t);if(!o)return[];var a=SB(t[0],o),s=n?0:1;return t.reduce((function(t,e,n){return 0===n?t.push(u(["M"],l(e),!1)):t.push(u(["A",a,a,0,0,s],l(e),!1)),t}),[])}(t,e,n):EF(t)}function bF(t,e,n){var r=n.type,i=n.connect,o=n.center,a=n.closed?[["Z"]]:[],s=l([_F(t,n),_F(e.slice().reverse(),n,!0)],2),c=s[0],h=s[1],d=l([t[0],e.slice(-1)[0]],2),f=d[0],p=d[1],g=function(t,e){return[c,t,h,e,a].flat()};if("line"===i||"surround"===r)return g([u(["L"],l(p),!1)],[u(["L"],l(f),!1)]);if(!o)throw new Error("Arc grid need to specified center");var v=l([SB(p,o),SB(f,o)],2),m=v[0],y=v[1];return g([u(["A",m,m,0,0,1],l(p),!1),u(["L"],l(p),!1)],[u(["A",y,y,0,0,0],l(f),!1),u(["L"],l(f),!1)])}var xF=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(t,e){t.type,t.center,t.areaFill,t.closed;var n=i(t,["type","center","areaFill","closed"]),o=function(t){var e=t.data,n=void 0===e?[]:e;return t.closed?n.map((function(t){var e=t.points,n=l(e,1)[0];return r(r({},t),{points:u(u([],l(e),!1),[n],!1)})})):n}(t),a=IB(e).maybeAppendByClassName(yF.lineGroup,"g"),s=IB(e).maybeAppendByClassName(yF.regionGroup,"g"),c=function(t,e,n,i){var o=n.animate,a=n.isBillboard,s=e.map((function(t,e){return{id:t.id||"grid-line-".concat(e),d:_F(t.points,n)}}));return t.selectAll(yF.line.class).data(s,(function(t){return t.id})).join((function(t){return t.append("path").each((function(t,e){var n=QD(NB(r({d:t.d},i)),[t,e,s]);this.attr(r({class:yF.line.name,stroke:"#D9D9D9",lineWidth:1,lineDash:[4,4],isBillboard:a},n))}))}),(function(t){return t.transition((function(t,e){return aF(this,QD(NB(r({d:t.d},i)),[t,e,s]),o.update)}))}),(function(t){return t.transition((function(){var t=this,e=sF(this,o.exit);return rF(e,(function(){return t.remove()})),e}))})).transitions()}(a,o,t,n),h=function(t,e,n){var r=n.animate,i=n.connect,o=n.areaFill;if(e.length<2||!o||!i)return[];for(var a=Array.isArray(o)?o:[o,"transparent"],s=function(t){return a[t%a.length]},u=[],c=0;c<e.length-1;c++){var h=l([e[c].points,e[c+1].points],2),d=bF(h[0],h[1],n);u.push({d:d,fill:s(c)})}return t.selectAll(yF.region.class).data(u,(function(t,e){return e})).join((function(t){return t.append("path").each((function(t,e){var n=QD(t,[t,e,u]);this.attr(n)})).attr("className",yF.region.name)}),(function(t){return t.transition((function(t,e){return aF(this,QD(t,[t,e,u]),r.update)}))}),(function(t){return t.transition((function(){var t=this,e=sF(this,r.exit);return rF(e,(function(){return t.remove()})),e}))})).transitions()}(s,o,t);return u(u([],l(c),!1),l(h),!1)},e}(XB);function SF(t,e){return Object.fromEntries(Object.entries(t).map((function(t){var n=l(t,2);return[n[0],QD(n[1],e)]})))}function MF(t,e){return e&&E(e)?t.filter(e):t}function AF(t,e){var n=e.startAngle;return(e.endAngle-n)*t+n}function RF(t,e){if("linear"===e.type){var n=l(e.startPos,2),r=n[0],i=n[1],o=l(e.endPos,2),a=l([o[0]-r,o[1]-i],2);return MB([a[0],a[1]])}var s=$D(AF(t,e));return[-Math.sin(s),Math.cos(s)]}function TF(t,e,n){return function(t,e){return e?[t[1],-t[0]]:[-t[1],t[0]]}(RF(t,n),"positive"!==e)}function wF(t,e){return TF(t,e.labelDirection,e)}function PF(t,e){return"linear"===e.type?function(t,e){var n=l(e.startPos,2),r=n[0],i=n[1],o=l(e.endPos,2),a=l([o[0]-r,o[1]-i],2);return[r+a[0]*t,i+a[1]*t]}(t,e):function(t,e){var n=e.radius,r=l(e.center,2),i=r[0],o=r[1],a=$D(AF(t,e));return[i+n*Math.cos(a),o+n*Math.sin(a)]}(t,e)}function NF(t){return 0===RF(0,t)[1]}function CF(t){return 0===RF(0,t)[0]}function OF(t,e){return e-t==360}function IF(t,e,n,r,i){var o=e-t,a=l([i,i],2),s=a[0],u=a[1],c=l([$D(t),$D(e)],2),h=c[0],d=c[1],f=function(t){return[n+i*Math.cos(t),r+i*Math.sin(t)]},p=l(f(h),2),g=p[0],v=p[1],m=l(f(d),2),y=m[0],E=m[1];if(OF(t,e)){var _=l(f((d+h)/2),2);return[["M",g,v],["A",s,u,0,1,0,_[0],_[1]],["A",s,u,0,1,0,y,E]]}var b=o>180?1:0,x=t>e?0:1;return"M".concat(g,",").concat(v,",A").concat(s,",").concat(u,",0,").concat(b,",").concat(x,",").concat(y,",").concat(E)}function LF(t,e,n,i){var o=e.startAngle,a=e.endAngle,s=e.center,c=e.radius;return t.selectAll(mF.line.class).data([{d:IF.apply(void 0,u(u([o,a],l(s),!1),[c],!1))}],(function(t,e){return e})).join((function(t){return t.append("path").attr("className",mF.line.name).styles(e).styles({d:function(t){return t.d}})}),(function(t){return t.transition((function(){var t=this,e=function(t,e,n,i){if(!i)return t.attr("__keyframe_data__",n),null;var o=i.duration,a=void 0===o?0:o,s=pB(e,n),l=Math.ceil(+a/16),u=new Array(l).fill(0).map((function(t,e,n){return{__keyframe_data__:s(e/(n.length-1))}}));return t.animate(u,r({fill:"both"},i))}(this,function(t){var e=t.attributes,n=e.startAngle,r=e.endAngle,i=e.center,o=e.radius;return u(u([n,r],l(i),!1),[o],!1)}(this),u(u([o,a],l(s),!1),[c],!1),i.update);if(e){var n=function(){var e=J(t.attributes,"__keyframe_data__");t.style.d=IF.apply(void 0,u([],l(e),!1))};e.onframe=n,e.onfinish=n}return e})).styles(e)}),(function(t){return t.remove()})).styles(n).transitions()}function DF(t){var e=l(t,2),n=l(e[0],2),r=n[0],i=n[1],o=l(e[1],2);return{x1:r,y1:i,x2:o[0],y2:o[1]}}function BF(t,e,n,r){var i=e.showTrunc,o=e.startPos,a=e.endPos,s=e.truncRange,u=e.lineExtension,c=l([o,a],2),h=l(c[0],2),d=h[0],f=h[1],p=l(c[1],2),g=p[0],v=p[1],m=l(u?function(t,e,n){void 0===n&&(n=[0,0]);var r=l([t,e,n],3),i=l(r[0],2),o=i[0],a=i[1],s=l(r[1],2),u=s[0],c=s[1],h=l(r[2],2),d=h[0],f=h[1],p=l([u-o,c-a],2),g=p[0],v=p[1],m=Math.sqrt(Math.pow(g,2)+Math.pow(v,2)),y=l([-d/m,f/m],2),E=y[0],_=y[1];return[E*g,E*v,_*g,_*v]}(o,a,u):new Array(4).fill(0),4),y=m[0],E=m[1],_=m[2],b=m[3],x=function(e){return t.selectAll(mF.line.class).data(e,(function(t,e){return e})).join((function(t){return t.append("line").attr("className",(function(t){return"".concat(mF.line.name," ").concat(t.className)})).styles(n).transition((function(t){return aF(this,DF(t.line),!1)}))}),(function(t){return t.styles(n).transition((function(t){return aF(this,DF(t.line),r.update)}))}),(function(t){return t.remove()})).transitions()};if(!i||!s)return x([{line:[[d+y,f+E],[g+_,v+b]],className:mF.line.name}]);var S=l(s,2),M=S[0],A=S[1],R=g-d,T=v-f,w=l([d+R*M,f+T*M],2),P=w[0],N=w[1],C=l([d+R*A,f+T*A],2),O=C[0],I=C[1],L=x([{line:[[d+y,f+E],[P,N]],className:mF.lineFirst.name},{line:[[O,I],[g+_,v+b]],className:mF.lineSecond.name}]);return function(t,e){e.truncRange,e.truncShape,e.lineExtension}(0,e),L}function kF(t,e,n){var r,i=e.type,o=GB(e,"line");return r="linear"===i?BF(t,e,RB(o,"arrow"),n):LF(t,e,RB(o,"arrow"),n),function(t,e,n,r){var i,o=n.showArrow,a=n.showTrunc,s=n.lineArrow,l=n.lineArrowOffset,u=n.lineArrowSize;if(i="arc"===e?t.select(mF.line.class):a?t.select(mF.lineSecond.class):t.select(mF.line.class),!o||!s||"arc"===n.type&&OF(n.startAngle,n.endAngle)){var c=i.node();c&&(c.style.markerEnd=void 0)}else{var h=cB(s);h.attr(r),CB(h,u),i.style("markerEnd",h).style("markerEndOffset",-l)}}(t,i,e,o),r}function FF(t){var e=t.type,n=t.gridCenter;return"linear"===e?n:n||t.center}function UF(t,e){var n=e.gridLength;return t.map((function(t,r){var i=t.value,o=l(PF(i,e),2),a=o[0],s=o[1],u=l(yB(function(t,e){return TF(t,e.gridDirection,e)}(i,e),n),2);return{id:r,points:[[a,s],[a+u[0],s+u[1]]]}}))}function GF(t,e,n,i){var o=GB(n,"grid"),a=o.type,s=o.areaFill,u=FF(n),c=MF(e,n.gridFilter),h="segment"===a?UF(c,n):function(t,e){var n=e.gridControlAngles,r=FF(e);if(!r)throw new Error("grid center is not provide");if(t.length<2)throw new Error("Invalid grid data");if(!n||0===n.length)throw new Error("Invalid gridControlAngles");var i=l(r,2),o=i[0],a=i[1];return t.map((function(t,r){var i=l(PF(t.value,e),2),s=i[0],u=i[1],c=l([s-o,u-a],2),h=c[0],d=c[1],f=[];return n.forEach((function(t){var e=$D(t),n=l([Math.cos(e),Math.sin(e)],2),r=n[0],i=n[1],s=h*r-d*i+o,u=h*i+d*r+a;f.push([s,u])})),{points:f,id:r}}))}(c,n),d=r(r({},o),{center:u,areaFill:E(s)?c.map((function(t,e){return QD(s,[t,e,c])})):s,animate:i,data:h});return t.selectAll(mF.grid.class).data([1]).join((function(t){return t.append((function(){return new xF({style:d})})).attr("className",mF.grid.name)}),(function(t){return t.transition((function(){return this.update(d)}))}),(function(t){return t.remove()})).transitions()}var zF=function(){function t(t,e,n,r){this.set(t,e,n,r)}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.defined("x2")&&this.defined("x1")?this.x2-this.x1:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.defined("y2")&&this.defined("y1")?this.y2-this.y1:void 0},enumerable:!1,configurable:!0}),t.prototype.rotatedPoints=function(t,e,n){var r=this,i=r.x1,o=r.y1,a=r.x2,s=r.y2,l=Math.cos(t),u=Math.sin(t),c=e-e*l+n*u,h=n-e*u-n*l;return[[l*i-u*s+c,u*i+l*s+h],[l*a-u*s+c,u*a+l*s+h],[l*i-u*o+c,u*i+l*o+h],[l*a-u*o+c,u*a+l*o+h]]},t.prototype.set=function(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},t.prototype.defined=function(t){return this[t]!==Number.MAX_VALUE&&this[t]!==-Number.MAX_VALUE},t}();function VF(t,e){var n=t.getEulerAngles()||0;t.setEulerAngles(0);var r=t.getBounds(),i=l(r.min,2),o=i[0],a=i[1],s=l(r.max,2),u=s[0],c=s[1],h=t.getBBox(),d=h.width,f=h.height,p=0,g=0,v=o,m=a,y=aB(t);if(y){f-=1.5;var E=y.style.textAlign,_=y.style.textBaseline;"center"===E?v=(o+u)/2:"right"!==E&&"end"!==E||(v=u),"middle"===_?m=(a+c)/2:"bottom"===_&&(m=c)}var b=l(LB(e),4),x=b[0],S=void 0===x?0:x,M=b[1],A=void 0===M?0:M,R=b[2],T=void 0===R?S:R,w=b[3],P=new zF((p+=o)-(void 0===w?A:w),(g+=a)-S,p+d+A,g+f+T);return t.setEulerAngles(n),P.rotatedPoints($D(n),v,m)}function WF(t,e){return e[0]<=Math.max(t[0][0],t[1][0])&&e[0]<=Math.min(t[0][0],t[1][0])&&e[1]<=Math.max(t[0][1],t[1][1])&&e[1]<=Math.min(t[0][1],t[1][1])}function jF(t,e,n){var r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return 0===r?0:r<0?2:1}function HF(t,e){return e.every((function(e){return function(t,e){var n=t.length;if(n<3)return!1;var r,i,o,a,s,l,u=[e,[9999,e[1]]],c=0,h=0;do{var d=[t[h],t[(h+1)%n]];if(i=u,o=void 0,a=void 0,s=void 0,l=void 0,o=jF((r=d)[0],r[1],i[0]),a=jF(r[0],r[1],i[1]),s=jF(i[0],i[1],r[0]),l=jF(i[0],i[1],r[1]),o!==a&&s!==l||0===o&&WF(r,i[0])||0===a&&WF(r,i[1])||0===s&&WF(i,r[0])||0===l&&WF(i,r[1])){if(0===jF(d[0],e,d[1]))return WF(d,e);c++}h=(h+1)%n}while(0!==h);return!!(1&c)}(t,e)}))}function XF(t,e){return[[t[0],t[1],t[2],t[3]],[t[2],t[3],t[4],t[5]],[t[4],t[5],t[6],t[7]],[t[6],t[7],t[0],t[1]]].some((function(t){return function(t,e){var n=l(t,4),r=n[0],i=n[1],o=n[2],a=n[3],s=l(e,4),u=s[0],c=s[1],h=o-r,d=a-i,f=s[2]-u,p=s[3]-c,g=h*p-f*d;if(0===g)return!1;var v=g>0,m=r-u,y=i-c,E=h*y-d*m;if(E<0===v)return!1;var _=f*y-p*m;return _<0!==v&&E>g!==v&&_>g!==v}(e,t)}))}function YF(t,e,n){var r,i,o=e.crossPadding,a=new Set,u=null,c=function(t,e){var n=t.type,r=t.labelDirection,i=t.crossSize;if(!i)return!1;if("arc"===n){var o=t.center,a=t.radius,s=l(o,2),u=s[0],c=s[1],h="negative"===r?0:i,d=-a-h,f=a+h,p=l(LB(e),4),g=p[0],v=p[1],m=p[2],y=p[3];return new zF(u+d-y,c+d-g,u+f+v,c+f+m)}var E=l(t.startPos,2),_=E[0],b=E[1],x=l(t.endPos,2),S=x[0],M=x[1],A=l(CF(t)?[-e,0,e,0]:[0,e,0,-e],4),R=A[0],T=A[1],w=A[2],P=A[3],N=yB(wF(0,t),i),C=new zF(_,b,S,M);return C.x1+=P,C.y1+=R,C.x2+=T+N[0],C.y2+=w+N[1],C}(e,o),h=function(t){return!c||function(t,e,n){var r=t.x1,i=t.x2,o=t.y1,a=t.y2;return HF([[r,o],[i,o],[i,a],[r,a]],VF(e,n))}(c,t)},d=function(t,e){return!t||!t.firstChild||!function(t,e,n){var r,i,o=VF(t,n).flat(1),a=VF(e,n).flat(1),l=[[o[0],o[1],o[2],o[3]],[o[0],o[1],o[4],o[5]],[o[4],o[5],o[6],o[7]],[o[2],o[3],o[6],o[7]]];try{for(var u=s(l),c=u.next();!c.done;c=u.next())if(XF(a,c.value))return!0}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return!1}(t.firstChild,e.firstChild,LB(n))};try{for(var f=s(t),p=f.next();!p.done;p=f.next()){var g=p.value;h(g)?!u||d(u,g)?u=g:(a.add(u),a.add(g)):a.add(g)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}return Array.from(a)}function KF(t,e){return void 0===e&&(e={}),_(t)?0:"number"==typeof t?t:Math.floor(iB(t,e))}var $F=function(t,e){var n=e.seq,r=void 0===n?2:n;return t.filter((function(t,e){return!(e%r)||(jD(t),!1)}))};var qF=new Map([["hide",function(t,e,n,r){var i=t.length,o=e.keepHeader,a=e.keepTail;if(!(i<=1||2===i&&o&&a)){var s,c,h,d=$F,f=function(t){return t.forEach(r.show),t},p=2,g=t.slice(),v=t.slice(),m=Math.min.apply(Math,u([1],l(t.map((function(t){return t.getBBox().width}))),!1));if("linear"===n.type&&(NF(n)||CF(n))){var y=DB(t[0]).left,E=DB(t[i-1]).right,_=Math.abs(E-y)||1;p=Math.max(Math.floor(i*m/_),p)}for(o&&(s=g.splice(0,1)[0]),a&&(c=g.splice(-1,1)[0],g.reverse()),f(g);p<t.length&&YF((h=c?u(u([c],l(v),!1),[s],!1):u([s],l(v),!1),h.filter(rB)),n,null==e?void 0:e.margin).length;){if(c&&!s&&p%2==0)g.splice(0,1).forEach(r.hide);else if(c&&s){g.splice(0,1).forEach(r.hide)}v=d(f(g),{seq:p}),p++}}}],["rotate",function(t,e,n,r){var i,o,a=e.optionalAngles,l=void 0===a?[0,45,90]:a,u=e.margin,c=e.recoverWhenFailed,h=void 0===c||c,d=t.map((function(t){return t.getLocalEulerAngles()})),f=function(e){return t.forEach((function(t,n){var i=Array.isArray(e)?e[n]:e;r.rotate(t,+i)}))};try{for(var p=s(l),g=p.next();!g.done;g=p.next()){if(f(g.value),YF(t,n,u).length<1)return}}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}h&&f(d)}],["ellipsis",function(t,e,n,r){if(!(t.length<=1)){var i=e.suffix,o=void 0===i?"...":i,a=e.minLength,s=e.maxLength,u=void 0===s?1/0:s,c=e.step,h=void 0===c?" ":c,d=e.margin,f=void 0===d?[0,0,0,0]:d,p=oB(r.getTextShape(t[0])),g=KF(h,p),v=a?KF(a,p):g,m=KF(u,p);(_(m)||m===1/0)&&(m=Math.max.apply(null,t.map((function(t){return t.getBBox().width}))));var y=t.slice(),E=l(f,4);E[0],E[1],E[2],E[3];for(var b=function(e){if(y.forEach((function(t){r.ellipsis(r.getTextShape(t),e,o)})),(y=YF(t,n,f)).length<1)return{value:void 0}},x=m;x>v+g;x-=g){var S=b(x);if("object"==typeof S)return S.value}}}],["wrap",function(t,e,n,r){var i=e.wordWrapWidth,o=void 0===i?50:i,a=e.maxLines,s=void 0===a?3:a,c=e.recoverWhenFailed,h=void 0===c||c,d=e.margin,f=void 0===d?[0,0,0,0]:d,p=t.map((function(t){return t.attr("maxLines")||1})),g=Math.min.apply(Math,u([],l(p),!1)),v=function(t){var e=t.type,n=t.labelDirection;return"linear"===e&&NF(t)?"negative"===n?"bottom":"top":"middle"}(n),m=function(e){return t.forEach((function(t,n){var i=Array.isArray(e)?e[n]:e;r.wrap(t,o,i,v)}))};if(!(g>s)){for(var y=g;y<=s;y++)if(m(y),YF(t,n,f).length<1)return;h&&m(p)}}]]);function ZF(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce((function(t,e){return t*function(t){return"positive"===t?-1:1}(e)}),1)}function QF(t){for(var e=t;e<0;)e+=360;return Math.round(e%360)}function JF(t,e){var n=l(t,2),r=n[0],i=n[1],o=l(e,2),a=o[0],s=o[1],u=l([r*a+i*s,r*s-i*a],2),c=u[0],h=u[1];return Math.atan2(h,c)}function tU(t,e,n){var r,i=n.labelAlign;if(null===(r=e.style.transform)||void 0===r?void 0:r.includes("rotate"))return e.getLocalEulerAngles();var o=wF(t.value,n),a=RF(t.value,n);return"horizontal"===i?0:function(t){var e=(t+360)%180;return dB(e,-90,90)||(e+=180),e}(qD("perpendicular"===i?JF([1,0],o):JF([a[0]<0?-1:1,0],a)))}function eU(t,e,n){var r=n.type,i=n.labelAlign,o=wF(t,n),a=QF(e),s=QF(qD(JF([1,0],o))),l="center",u="middle";return"linear"===r?[90,270].includes(s)&&0===a?(l="center",u=1===o[1]?"top":"bottom"):s%180||![90,270].includes(a)?0===s?(dB(a,0,90,!1,!0)||dB(a,0,90)||dB(a,270,360))&&(l="start"):90===s?dB(a,0,90,!1,!0)?l="start":(dB(a,90,180)||dB(a,270,360))&&(l="end"):270===s?dB(a,0,90,!1,!0)?l="end":(dB(a,90,180)||dB(a,270,360))&&(l="start"):180===s&&(90===a?l="start":(dB(a,0,90)||dB(a,270,360))&&(l="end")):l="center":"parallel"===i?u=dB(s,0,180,!0)?"top":"bottom":"horizontal"===i?dB(s,90,270,!1)?l="end":(dB(s,270,360,!1)||dB(s,0,90))&&(l="start"):"perpendicular"===i&&(l=dB(s,90,270)?"end":"start"),{textAlign:l,textBaseline:u}}function nU(t,e,n){var r=n.showTick,i=n.tickLength,o=n.tickDirection,a=n.labelDirection,s=n.labelSpacing,u=e.indexOf(t),c=QD(s,[t,u,e]),h=l([wF(t.value,n),ZF(a,o)],2),d=l(EB(yB(h[0],c+(1===h[1]?QD(r?i:0,[t,u,e]):0)),PF(t.value,n)),2);return{x:d[0],y:d[1]}}function rU(t,e){"text"===t.nodeName&&t.attr(e)}function iU(t){!function(t,e,n){var r=e.labelOverlap,i=void 0===r?[]:r;i.length&&i.forEach((function(r){var i=r.type,o=qF.get(i);(function(t,e,n){return!(e.labelOverlap.length<1)&&("hide"===n?!function(t){for(var e=t;e;){if("offscreen"===e.className)return!0;e=e.parent}return!1}(t[0]):"rotate"===n?!t.some((function(t){var e;return!!(null===(e=t.attr("transform"))||void 0===e?void 0:e.includes("rotate"))})):"ellipsis"!==n&&"wrap"!==n||t.filter((function(t){return t.querySelector("text")})).length>1)})(t,e,i)&&(null==o||o(t,r,e,n))}))}(this.node().childNodes,t,{hide:jD,show:WD,rotate:function(e,n){!function(t,e,n){e.setLocalEulerAngles(t);var r=eU(e.__data__.value,t,n),i=e.querySelector(mF.labelItem.class);i&&rU(i,r)}(+n,e,t)},ellipsis:function(t,e,n){t&&lB(t,e||1/0,n)},wrap:function(t,e,n){var r,i;t&&(void 0===(r=n)&&(r=2),void 0===i&&(i="top"),sB(t,{wordWrap:!0,wordWrapWidth:e,maxLines:r,textBaseline:i}))},getTextShape:function(t){return t.querySelector("text")}})}function oU(t,e,n,o,a){var s=n.indexOf(e),u=IB(t).append(function(t,e,n,r){var i=r.labelFormatter;return E(i)?function(){return cB(QD(i,[t,e,n,wF(t.value,r)]))}:function(){return cB(t.label||"")}}(e,s,n,a)).attr("className",mF.labelItem.name).node(),c=l(VB(SF(o,[e,s,n])),2),h=c[0],d=c[1],f=d.transform,p=i(d,["transform"]);jB(u,f);var g=tU(e,u,a);return u.getLocalEulerAngles()||u.setLocalEulerAngles(g),rU(u,r(r({},eU(e.value,g,a)),h)),t.attr(p),u}function aU(t,e,n,i){var o=MF(e,n.labelFilter),a=GB(n,"label");return t.selectAll(mF.label.class).data(o,(function(t,e){return e})).join((function(r){return r.append("g").attr("className",mF.label.name).transition((function(t){oU(this,t,e,a,n);var r=nU(t,e,n),i=r.x,o=r.y;return this.style.transform="translate(".concat(i,", ").concat(o,")"),null})).call((function(){iU.call(t,n)}))}),(function(o){return o.transition((function(t){var o=function(t,e,n,i){if(void 0===i&&(i="destroy"),function(t,e){return"text"===t.nodeName&&"text"===e.nodeName&&t.attributes.text===e.attributes.text}(t,e))return t.remove(),[null];var o=function(){"destroy"===i?t.destroy():"hide"===i&&jD(t),e.isVisible()&&WD(e)};if(!n)return o(),[null];var a=n.duration,s=void 0===a?0:a,u=n.delay,c=void 0===u?0:u,h=Math.ceil(+s/2),d=+s/4,f=l(t.getGeometryBounds().center,2),p=f[0],g=f[1],v=l(e.getGeometryBounds().center,2),m=l([(p+v[0])/2-p,(g+v[1])/2-g],2),y=m[0],E=m[1],_=t.style.opacity,b=void 0===_?1:_,x=e.style.opacity,S=void 0===x?1:x,M=t.style.transform||"",A=e.style.transform||"",R=t.animate([{opacity:b,transform:"translate(0, 0) ".concat(M)},{opacity:0,transform:"translate(".concat(y,", ").concat(E,") ").concat(M)}],r(r({fill:"both"},n),{duration:c+h+d})),T=e.animate([{opacity:0,transform:"translate(".concat(-y,", ").concat(-E,") ").concat(A),offset:.01},{opacity:S,transform:"translate(0, 0) ".concat(A)}],r(r({fill:"both"},n),{duration:h+d,delay:c+h-d}));return rF(T,o),[R,T]}(this.querySelector(mF.labelItem.class),oU(this,t,e,a,n),i.update),s=nU(t,e,n),c=s.x,h=s.y,d=aF(this,{transform:"translate(".concat(c,", ").concat(h,")")},i.update);return u(u([],l(o),!1),[d],!1)})).call((function(e){var r,i,o=J(e,"_transitions").flat().filter(rB);i=function(){iU.call(t,n)},0===(r=o).length?i():Promise.all(r.map((function(t){return null==t?void 0:t.finished}))).then(i)}))}),(function(t){return t.transition((function(){var t=this,e=sF(this.childNodes[0],i.exit);return rF(e,(function(){return IB(t).remove()})),e}))})).transitions()}function sU(t,e){return TF(t,e.tickDirection,e)}function lU(t,e,n,r,i){var o=l(function(t,e){var n=l(t,2);return[[0,0],[n[0]*e,n[1]*e]]}(r,QD(i.tickLength,[t,e,n])),2),a=l(o[0],2),s=a[0],u=a[1],c=l(o[1],2);return{x1:s,x2:c[0],y1:u,y2:c[1]}}function uU(t,e,n,i,o,a){var s=function(t,e,n,r,i){var o=i.tickFormatter,a=sU(e.value,i),s="line";return E(o)&&(s=function(){return QD(o,[e,n,r,a])}),t.append(s).attr("className",mF.tickItem.name)}(IB(this),t,e,n,i);!function(t,e,n,i,o,a,s){var u=sU(t.value,a),c=lU(t,e,n,u,a),h=c.x1,d=c.x2,f=c.y1,p=c.y2,g=l(VB(SF(s,[t,e,n,u])),2),v=g[0],m=g[1];"line"===i.node().nodeName&&i.styles(r({x1:h,x2:d,y1:f,y2:p},v)),o.attr(m),i.styles(v)}(t,e,n,s,this,i,o);var u=l(PF(t.value,i),2),c=u[0],h=u[1];return aF(this,{transform:"translate(".concat(c,", ").concat(h,")")},a)}var cU=tB({text:"text"},"title");function hU(t){return/\S+-\S+/g.test(t)?t.split("-").map((function(t){return t[0]})):t.length>2?[t[0]]:t.split("")}function dU(t,e){var n=Object.entries(e).reduce((function(e,n){var r=l(n,2),i=r[0],o=r[1];return t.node().attr(i)||(e[i]=o),e}),{});t.styles(n)}var fU=function(t){function e(e){return t.call(this,e,{text:"",width:0,height:0,fill:"#4a505a",fontWeight:"bold",fontSize:12,fontFamily:"sans-serif",inset:0,spacing:0,position:"top-left"})||this}return n(e,t),e.prototype.getAvailableSpace=function(){var t=this.attributes,e=t.width,n=t.height,r=t.position,i=t.spacing,o=t.inset,a=this.querySelector(cU.text.class);if(!a)return new ZD(0,0,+e,+n);var s=a.getBBox(),u=s.width,c=s.height,h=l(LB(i),4),d=h[0],f=h[1],p=h[2],g=h[3],v=l([0,0,+e,+n],4),m=v[0],y=v[1],E=v[2],_=v[3],b=hU(r);if(b.includes("i"))return new ZD(m,y,E,_);b.forEach((function(t,r){var i,o,a,s;"t"===t&&(i=l(0===r?[c+p,+n-c-p]:[0,+n],2),y=i[0],_=i[1]),"r"===t&&(o=l([+e-u-g],1),E=o[0]),"b"===t&&(a=l([+n-c-d],1),_=a[0]),"l"===t&&(s=l(0===r?[u+f,+e-u-f]:[0,+e],2),m=s[0],E=s[1])}));var x=l(LB(o),4),S=x[0],M=x[1],A=x[2],R=x[3],T=l([R+M,S+A],2),w=T[0],P=T[1];return new ZD(m+R,y+S,E-w,_-P)},e.prototype.getBBox=function(){return this.title?this.title.getBBox():new ZD(0,0,0,0)},e.prototype.render=function(t,e){var n=this;t.width,t.height,t.position,t.spacing;var r=i(t,["width","height","position","spacing"]),o=l(VB(r),1)[0],a=function(t){var e,n,r,i,o=t,a=o.width,s=o.height,u=o.position,c=l([+a/2,+s/2],2),h=l([+c[0],+c[1],"center","middle"],4),d=h[0],f=h[1],p=h[2],g=h[3],v=hU(u);return v.includes("l")&&(d=(e=l([0,"start"],2))[0],p=e[1]),v.includes("r")&&(d=(n=l([+a,"end"],2))[0],p=n[1]),v.includes("t")&&(f=(r=l([0,"top"],2))[0],g=r[1]),v.includes("b")&&(f=(i=l([+s,"bottom"],2))[0],g=i[1]),{x:d,y:f,textAlign:p,textBaseline:g}}(t),s=a.x,u=a.y,c=a.textAlign,h=a.textBaseline;hB(!!r.text,IB(e),(function(t){n.title=t.maybeAppendByClassName(cU.text,"text").styles(o).call(dU,{x:s,y:u,textAlign:c,textBaseline:h}).node()}))},e}(XB);function pU(t,e,n,o,a){var s=l(VB(GB(o,"title")),2),u=s[0],c=s[1],h=c.transform,d=c.transformOrigin,f=i(c,["transform","transformOrigin"]);e.styles(f);var p=h||function(t,e,n){var r=2*t.getGeometryBounds().halfExtents[1];if("vertical"===e){if("left"===n)return"rotate(-90) translate(0, ".concat(r/2,")");if("right"===n)return"rotate(-90) translate(0, -".concat(r/2,")")}return""}(t.node(),u.direction,u.position);t.styles(r(r({},u),{transformOrigin:d})),jB(t.node(),p);var g=function(t,e,n){var r=n.titlePosition,i=void 0===r?"lb":r,o=n.titleSpacing,a=hU(i),s=t.node().getLocalBounds(),u=l(s.min,2),c=u[0],h=u[1],d=l(s.halfExtents,2),f=d[0],p=d[1],g=l(e.node().getLocalBounds().halfExtents,2),v=g[0],m=g[1],y=l([c+f,h+p],2),E=y[0],_=y[1],b=l(LB(o),4),x=b[0],S=b[1],M=b[2],A=b[3];if(["start","end"].includes(i)&&"linear"===n.type){var R=n.startPos,T=n.endPos,w=l("start"===i?[R,T]:[T,R],2),P=w[0],N=w[1],C=l(yB(MB([-N[0]+P[0],-N[1]+P[1]]),x),2),O=C[0],I=C[1];return{x:P[0]+O,y:P[1]+I}}return a.includes("t")&&(_-=p+m+x),a.includes("r")&&(E+=f+v+S),a.includes("l")&&(E-=f+v+A),a.includes("b")&&(_+=p+m+M),{x:E,y:_}}(IB(n._offscreen||n.querySelector(mF.mainGroup.class)),e,o),v=g.x,m=g.y;return aF(e.node(),{transform:"translate(".concat(v,", ").concat(m,")")},a)}function gU(t,e,n,r){var i=t.showLine,o=t.showTick,a=t.showLabel,s=hB(i,e.maybeAppendByClassName(mF.lineGroup,"g"),(function(e){return kF(e,t,r)}))||[],c=hB(o,e.maybeAppendByClassName(mF.tickGroup,"g"),(function(e){return function(t,e,n,r){var i=MF(e,n.tickFilter),o=GB(n,"tick");return t.selectAll(mF.tick.class).data(i,(function(t){return t.id||t.label})).join((function(t){return t.append("g").attr("className",mF.tick.name).transition((function(t,e){return uU.call(this,t,e,i,n,o,!1)}))}),(function(t){return t.transition((function(t,e){return this.removeChildren(),uU.call(this,t,e,i,n,o,r.update)}))}),(function(t){return t.transition((function(){var t=this,e=sF(this.childNodes[0],r.exit);return rF(e,(function(){return t.remove()})),e}))})).transitions()}(e,n,t,r)}))||[],h=hB(a,e.maybeAppendByClassName(mF.labelGroup,"g"),(function(e){return aU(e,n,t,r)}))||[];return u(u(u([],l(s),!1),l(c),!1),l(h),!1).filter((function(t){return!!t}))}var vU=function(t){function e(e){return t.call(this,e,vF)||this}return n(e,t),e.prototype.render=function(t,e,n){var r=this,i=t.titleText,o=t.data,a=t.animate,s=t.showTitle,c=t.showGrid,h=t.dataThreshold,d=t.truncRange,f=function(t,e){if(t.length<=e)return t;for(var n=Math.floor(t.length/e),r=[],i=0;i<t.length;i+=n)r.push(t[i]);return r}(o,h).filter((function(t){var e=t.value;return!(d&&e>d[0]&&e<d[1])})),p=nF(void 0===n?a:n),g=hB(c,IB(e).maybeAppendByClassName(mF.gridGroup,"g"),(function(e){return GF(e,f,t,p)}))||[],v=IB(e).maybeAppendByClassName(mF.mainGroup,"g");i&&(!this.initialized&&p.enter||this.initialized&&p.update)&&gU(t,IB(this.offscreenGroup),f,nF(!1));var m=gU(t,IB(v.node()),f,p),y=hB(s,IB(e).maybeAppendByClassName(mF.titleGroup,"g"),(function(e){return function(t,e,n,r){var i=n.titleText;return t.selectAll(mF.title.class).data([{title:i}].filter((function(t){return!!t.title})),(function(t,e){return t.title})).join((function(o){return o.append((function(){return cB(i)})).attr("className",mF.title.name).transition((function(){return pU(IB(this),t,e,n,r.enter)}))}),(function(i){return i.transition((function(){return pU(IB(this),t,e,n,r.update)}))}),(function(t){return t.remove()})).transitions()}(e,r,t,p)}))||[];return u(u(u([],l(g),!1),l(m),!1),l(y),!1).flat().filter((function(t){return!!t}))},e}(XB),mU=tB({prevBtnGroup:"prev-btn-group",prevBtn:"prev-btn",nextBtnGroup:"next-btn-group",nextBtn:"next-btn",pageInfoGroup:"page-info-group",pageInfo:"page-info",playWindow:"play-window",contentGroup:"content-group",controller:"controller",clipPath:"clip-path"},"navigator"),yU=function(t){function e(e){var n=t.call(this,e,{x:0,y:0,animate:{easing:"linear",duration:200,fill:"both"},buttonCursor:"pointer",buttonFill:"black",buttonD:QB(0,0,6),buttonSize:12,controllerPadding:5,controllerSpacing:5,formatter:function(t,e){return"".concat(t,"/").concat(e)},defaultPage:0,loop:!1,orientation:"horizontal",pageNumFill:"black",pageNumFontSize:12,pageNumTextAlign:"start",pageNumTextBaseline:"middle"})||this;return n.playState="idle",n.contentGroup=n.appendChild(new Dw({class:mU.contentGroup.name})),n.playWindow=n.contentGroup.appendChild(new Dw({class:mU.playWindow.name})),n.innerCurrPage=n.defaultPage,n}return n(e,t),Object.defineProperty(e.prototype,"defaultPage",{get:function(){var t=this.attributes.defaultPage;return O(t,0,Math.max(this.pageViews.length-1,0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageViews",{get:function(){return this.playWindow.children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"controllerShape",{get:function(){return this.totalPages>1?{width:55,height:0}:{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageShape",{get:function(){var t=l(function(t){var e;return(null===(e=t[0])||void 0===e?void 0:e.map((function(e,n){return t.map((function(t){return t[n]}))})))||[]}(this.pageViews.map((function(t){var e=t.getBBox();return[e.width,e.height]}))).map((function(t){return Math.max.apply(Math,u([],l(t),!1))})),2),e=t[0],n=t[1],r=this.attributes,i=r.pageWidth,o=void 0===i?e:i,a=r.pageHeight;return{pageWidth:o,pageHeight:void 0===a?n:a}},enumerable:!1,configurable:!0}),e.prototype.getContainer=function(){return this.playWindow},Object.defineProperty(e.prototype,"totalPages",{get:function(){return this.pageViews.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currPage",{get:function(){return this.innerCurrPage},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var e=t.prototype.getBBox.call(this),n=e.x,r=e.y,i=this.controllerShape,o=this.pageShape,a=o.pageWidth,s=o.pageHeight;return new ZD(n,r,a+i.width,s)},e.prototype.goTo=function(t){var e=this,n=this.attributes.animate,r=this,i=r.currPage,o=r.playState,a=r.playWindow,s=r.pageViews;if("idle"!==o||t<0||s.length<=0||t>=s.length)return null;s[i].setLocalPosition(0,0),this.prepareFollowingPage(t);var u=l(this.getFollowingPageDiff(t),2),c=u[0],h=u[1];this.playState="running";var d=oF(a,[{transform:"translate(0, 0)"},{transform:"translate(".concat(-c,", ").concat(-h,")")}],n);return rF(d,(function(){e.innerCurrPage=t,e.playState="idle",e.setVisiblePages([t]),e.updatePageInfo()})),d},e.prototype.prev=function(){var t=this.attributes.loop,e=this.pageViews.length,n=this.currPage;if(!t&&n<=0)return null;var r=t?(n-1+e)%e:O(n-1,0,e);return this.goTo(r)},e.prototype.next=function(){var t=this.attributes.loop,e=this.pageViews.length,n=this.currPage;if(!t&&n>=e-1)return null;var r=t?(n+1)%e:O(n+1,0,e);return this.goTo(r)},e.prototype.renderClipPath=function(t){var e=this.pageShape,n=e.pageWidth,r=e.pageHeight;n&&r?(this.clipPath=t.maybeAppendByClassName(mU.clipPath,"rect").styles({width:n,height:r}),this.contentGroup.attr("clipPath",this.clipPath.node())):this.contentGroup.style.clipPath=void 0},e.prototype.setVisiblePages=function(t){this.playWindow.children.forEach((function(e,n){t.includes(n)?WD(e):jD(e)}))},e.prototype.adjustControllerLayout=function(){var t=this,e=t.prevBtnGroup,n=t.nextBtnGroup,r=t.pageInfoGroup,i=this.attributes,o=i.orientation,a=i.controllerPadding,s=r.getBBox(),u=s.width;s.height;var c=l("horizontal"===o?[-180,0]:[-90,90],2),h=c[0],d=c[1];e.setLocalEulerAngles(h),n.setLocalEulerAngles(d);var f=e.getBBox(),p=f.width,g=f.height,v=n.getBBox(),m=v.width,y=v.height,E=Math.max(p,u,m),_="horizontal"===o?{offset:[[0,0],[p/2+a,0],[p+u+2*a,0]],textAlign:"start"}:{offset:[[E/2,-g-a],[E/2,0],[E/2,y+a]],textAlign:"center"},b=l(_.offset,3),x=l(b[0],2),S=x[0],M=x[1],A=l(b[1],2),R=A[0],T=A[1],w=l(b[2],2),P=w[0],N=w[1],C=_.textAlign,O=r.querySelector("text");O&&(O.style.textAlign=C),e.setLocalPosition(S,M),r.setLocalPosition(R,T),n.setLocalPosition(P,N)},e.prototype.updatePageInfo=function(){var t,e=this,n=e.currPage,r=e.pageViews,i=e.attributes.formatter;r.length<2||(null===(t=this.pageInfoGroup.querySelector(mU.pageInfo.class))||void 0===t||t.attr("text",i(n+1,r.length)),this.adjustControllerLayout())},e.prototype.getFollowingPageDiff=function(t){var e=this.currPage;if(e===t)return[0,0];var n=this.attributes.orientation,r=this.pageShape,i=r.pageWidth,o=r.pageHeight,a=t<e?-1:1;return"horizontal"===n?[a*i,0]:[0,a*o]},e.prototype.prepareFollowingPage=function(t){var e=this.currPage,n=this.pageViews;if(this.setVisiblePages([t,e]),t!==e){var r=l(this.getFollowingPageDiff(t),2),i=r[0],o=r[1];n[t].setLocalPosition(i,o)}},e.prototype.renderController=function(t){var e=this,n=this.attributes.controllerSpacing,o=this.pageShape,a=o.pageWidth,s=o.pageHeight,u=this.pageViews.length>=2,c=t.maybeAppendByClassName(mU.controller,"g");if(HD(c.node(),u),u){var h=GB(this.attributes,"button"),d=GB(this.attributes,"pageNum"),f=l(VB(h),2),p=f[0],g=f[1],v=p.size,m=i(p,["size"]),y=!c.select(mU.prevBtnGroup.class).node(),E=c.maybeAppendByClassName(mU.prevBtnGroup,"g").styles(g);this.prevBtnGroup=E.node();var _=E.maybeAppendByClassName(mU.prevBtn,"path"),b=c.maybeAppendByClassName(mU.nextBtnGroup,"g").styles(g);this.nextBtnGroup=b.node(),[_,b.maybeAppendByClassName(mU.nextBtn,"path")].forEach((function(t){t.styles(r(r({},m),{transformOrigin:"center"})),CB(t.node(),v)}));var x=c.maybeAppendByClassName(mU.pageInfoGroup,"g");this.pageInfoGroup=x.node(),x.maybeAppendByClassName(mU.pageInfo,"text").styles(d),this.updatePageInfo(),c.node().setLocalPosition(a+n,s/2),y&&(this.prevBtnGroup.addEventListener("click",(function(){e.prev()})),this.nextBtnGroup.addEventListener("click",(function(){e.next()})))}},e.prototype.render=function(t,e){var n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i;this.attr("transform","translate(".concat(r,", ").concat(o,")"));var a=IB(e);this.renderClipPath(a),this.renderController(a),this.setVisiblePages([this.defaultPage]),this.goTo(this.defaultPage)},e.prototype.bindEvents=function(){var t=this,e=function(t,e,n){var r;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout((function(){r=null,t.apply(n,i)}),e)}}((function(){return t.render(t.attributes,t)}),50);this.playWindow.addEventListener(nw.INSERTED,e),this.playWindow.addEventListener(nw.REMOVED,e)},e}(XB);function EU(t,e,n){return void 0===t&&(t="horizontal"),"horizontal"===t?e:n}tk.registerSymbol("hiddenHandle",(function(t,e,n){var r=1.4*n;return[["M",t-n,e-r],["L",t+n,e-r],["L",t+n,e+r],["L",t-n,e+r],["Z"]]})),tk.registerSymbol("verticalHandle",(function(t,e,n){var r=1.4*n,i=n/2,o=n/6,a=t+.4*r;return[["M",t,e],["L",a,e+i],["L",t+r,e+i],["L",t+r,e-i],["L",a,e-i],["Z"],["M",a,e+o],["L",t+r-2,e+o],["M",a,e-o],["L",t+r-2,e-o]]})),tk.registerSymbol("horizontalHandle",(function(t,e,n){var r=1.4*n,i=n/2,o=n/6,a=e+.4*r;return[["M",t,e],["L",t-i,a],["L",t-i,e+r],["L",t+i,e+r],["L",t+i,a],["Z"],["M",t-o,a],["L",t-o,e+r-2],["M",t+o,a],["L",t+o,e+r-2]]}));var _U=tB({layout:"flex",markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label",valueGroup:"value-group",value:"value",backgroundGroup:"background-group",background:"background"},"legend-category-item");var bU=function(t){function e(e){return t.call(this,e,{span:[1,1],marker:function(){return new Ow({style:{r:6}})},markerSize:10,labelFill:"#646464",valueFill:"#646464",labelFontSize:12,valueFontSize:12,labelTextBaseline:"middle",valueTextBaseline:"middle"})||this}return n(e,t),Object.defineProperty(e.prototype,"showValue",{get:function(){var t=this.attributes.valueText;return!!t&&("string"==typeof t||"number"==typeof t?""!==t:"function"==typeof t||""!==t.attr("text"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actualSpace",{get:function(){var t=this.labelGroup,e=this.valueGroup,n=this.attributes.markerSize,r=t.node().getBBox(),i=r.width,o=r.height,a=e.node().getBBox(),s=a.width,l=a.height;return{markerWidth:n,labelWidth:i,valueWidth:s,height:Math.max(n,o,l)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"span",{get:function(){var t=this.attributes.span;if(!t)return[1,1];var e=l(LB(t),2),n=e[0],r=e[1],i=this.showValue?r:0,o=n+i;return[n/o,i/o]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shape",{get:function(){var t,e=this.attributes,n=e.markerSize,r=e.width,i=this.actualSpace,o=i.markerWidth,a=i.height,s=this.actualSpace,u=s.labelWidth,c=s.valueWidth,h=l(this.spacing,2),d=h[0],f=h[1];if(r){var p=r-n-d-f,g=l(this.span,2);u=(t=l([g[0]*p,g[1]*p],2))[0],c=t[1]}return{width:o+u+c+d+f,height:a,markerWidth:o,labelWidth:u,valueWidth:c}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacing",{get:function(){var t=this.attributes.spacing;if(!t)return[0,0];var e=l(LB(t),2),n=e[0],r=e[1];return this.showValue?[n,r]:[n,0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){var t=this.shape,e=t.markerWidth,n=t.labelWidth,r=t.valueWidth,i=t.width,o=t.height,a=l(this.spacing,2),s=a[0];return{height:o,width:i,markerWidth:e,labelWidth:n,valueWidth:r,position:[e/2,e+s,e+n+s+a[1]]}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleSize",{get:function(){var t=function(t){var e=t.querySelector(_U.marker.class);return e?e.style:{}}(this.markerGroup.node()),e=this.attributes,n=e.markerSize,r=e.markerStrokeWidth,i=void 0===r?t.strokeWidth:r,o=e.markerLineWidth,a=void 0===o?t.lineWidth:o,s=e.markerStroke,l=void 0===s?t.stroke:s,u=+(i||a||(l?1:0))*Math.sqrt(2),c=this.markerGroup.node().getBBox(),h=c.width,d=c.height;return(1-u/Math.max(h,d))*n},enumerable:!1,configurable:!0}),e.prototype.renderMarker=function(t){var e=this,n=this.attributes.marker,i=GB(this.attributes,"marker");this.markerGroup=t.maybeAppendByClassName(_U.markerGroup,"g").style("zIndex",0),hB(!!n,this.markerGroup,(function(){var t,o=e.markerGroup.node(),a=null===(t=o.childNodes)||void 0===t?void 0:t[0],u="string"==typeof n?new tk({style:{symbol:n},className:_U.marker.name}):n();a?u.nodeName===a.nodeName?a instanceof tk?a.update(r(r({},i),{symbol:n})):(!function(t,e){var n,r,i=e.attributes;try{for(var o=s(Object.entries(i)),a=o.next();!a.done;a=o.next()){var u=l(a.value,2),c=u[0],h=u[1];"id"!==c&&"className"!==c&&t.attr(c,h)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}(a,u),IB(a).styles(i)):(a.remove(),IB(u).attr("className",_U.marker.name).styles(i),o.appendChild(u)):(u instanceof tk||IB(u).attr("className",_U.marker.name).styles(i),o.appendChild(u)),e.markerGroup.node().scale(1/e.markerGroup.node().getScale()[0]);var c=CB(e.markerGroup.node(),e.scaleSize);e.markerGroup.node().style._transform="scale(".concat(c,")")}))},e.prototype.renderLabel=function(t){var e=GB(this.attributes,"label"),n=e.text,r=i(e,["text"]);this.labelGroup=t.maybeAppendByClassName(_U.labelGroup,"g").style("zIndex",0),this.labelGroup.maybeAppendByClassName(_U.label,(function(){return cB(n)})).styles(r)},e.prototype.renderValue=function(t){var e=this,n=GB(this.attributes,"value"),r=n.text,o=i(n,["text"]);this.valueGroup=t.maybeAppendByClassName(_U.valueGroup,"g").style("zIndex",0),hB(this.showValue,this.valueGroup,(function(){e.valueGroup.maybeAppendByClassName(_U.value,(function(){return cB(r)})).styles(o)}))},e.prototype.renderBackground=function(t){var e=this.shape,n=e.width,i=e.height,o=GB(this.attributes,"background");this.background=t.maybeAppendByClassName(_U.backgroundGroup,"g").style("zIndex",-1),this.background.maybeAppendByClassName(_U.background,"rect").styles(r({width:n,height:i},o))},e.prototype.adjustLayout=function(){var t=this.layout,e=t.labelWidth,n=t.valueWidth,r=t.height,i=l(t.position,3),o=i[0],a=i[1],s=i[2],u=r/2;this.markerGroup.styles({transform:"translate(".concat(o,", ").concat(u,")").concat(this.markerGroup.node().style._transform)}),this.labelGroup.styles({transform:"translate(".concat(a,", ").concat(u,")")}),lB(this.labelGroup.select(_U.label.class).node(),Math.ceil(e)),this.showValue&&(this.valueGroup.styles({transform:"translate(".concat(s,", ").concat(u,")")}),lB(this.valueGroup.select(_U.value.class).node(),Math.ceil(n)))},e.prototype.render=function(t,e){var n=IB(e),r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;n.styles({transform:"translate(".concat(i,", ").concat(a,")")}),this.renderMarker(n),this.renderLabel(n),this.renderValue(n),this.renderBackground(n),this.adjustLayout()},e}(XB),xU=tB({page:"item-page",navigator:"navigator",item:"item"},"items"),SU=function(t,e,n){return void 0===n&&(n=!0),t?e(t):n},MU=function(t){function e(e){var n=t.call(this,e,{data:[],gridRow:1/0,gridCol:void 0,padding:0,width:1e3,height:100,rowPadding:0,colPadding:0,layout:"flex",orientation:"horizontal",click:ot,mouseenter:ot,mouseleave:ot})||this;return n.navigatorShape=[0,0],n}return n(e,t),Object.defineProperty(e.prototype,"pageViews",{get:function(){return this.navigator.getContainer()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){var t=this.attributes,e=t.gridRow,n=t.gridCol,r=t.data;if(!e&&!n)throw new Error("gridRow and gridCol can not be set null at the same time");return e&&n?[e,n]:e?[e,r.length]:[r.length,n]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderData",{get:function(){var t=this.attributes,e=t.data,n=t.layout,i=GB(this.attributes,"item"),o=e.map((function(t,o){var a=t.id,s=void 0===a?o:a,u=t.label,c=t.value;return{id:"".concat(s),index:o,style:r({layout:n,labelText:u,valueText:c},Object.fromEntries(Object.entries(i).map((function(n){var r=l(n,2);return[r[0],QD(r[1],[t,o,e])]}))))}}));return o},enumerable:!1,configurable:!0}),e.prototype.getGridLayout=function(){var t=this,e=this.attributes,n=e.orientation,r=e.width,i=e.rowPadding,o=e.colPadding,a=l(this.navigatorShape,1)[0],s=l(this.grid,2),u=s[0],c=s[1],h=c*u,d=0;return this.pageViews.children.map((function(e,s){var f,p,g=Math.floor(s/h),v=s%h,m=t.ifHorizontal(c,u),y=[Math.floor(v/m),v%m];"vertical"===n&&y.reverse();var E=l(y,2),_=E[0],b=E[1],x=(r-a-(c-1)*o)/c,S=e.getBBox().height,M=l([0,0],2),A=M[0],R=M[1];return"horizontal"===n?(A=(f=l([d,_*(S+i)],2))[0],R=f[1],d=b===c-1?0:d+x+o):(A=(p=l([b*(x+o),d],2))[0],R=p[1],d=_===u-1?0:d+S+i),{page:g,index:s,row:_,col:b,pageIndex:v,width:x,height:S,x:A,y:R}}))},e.prototype.getFlexLayout=function(){var t=this.attributes,e=t.width,n=t.height,r=t.rowPadding,i=t.colPadding,o=l(this.navigatorShape,1)[0],a=l(this.grid,2),s=a[0],u=a[1],c=l([e-o,n],2),h=c[0],d=c[1],f=l([0,0,0,0,0,0,0,0],8),p=f[0],g=f[1],v=f[2],m=f[3],y=f[4],E=f[5],_=f[6],b=f[7];return this.pageViews.children.map((function(t,e){var n,o,a,c,f=t.getBBox(),x=f.width,S=f.height,M=0===_?0:i,A=_+M+x;return A<=h&&SU(y,(function(t){return t<u}))?(n=l([_+M,b,A],3),p=n[0],g=n[1],_=n[2],{width:x,height:S,x:p,y:g,page:v,index:e,pageIndex:m++,row:E,col:y++}):(o=l([E+1,0,0,b+S+r],4),E=o[0],y=o[1],_=o[2],(b=o[3])+S<=d&&SU(E,(function(t){return t<s}))?(a=l([_,b,x],3),p=a[0],g=a[1],_=a[2],{width:x,height:S,x:p,y:g,page:v,index:e,pageIndex:m++,row:E,col:y++}):(c=l([0,0,x,0,v+1,0,0,0],8),p=c[0],g=c[1],_=c[2],b=c[3],v=c[4],m=c[5],E=c[6],y=c[7],{width:x,height:S,x:p,y:g,page:v,index:e,pageIndex:m++,row:E,col:y++}))}))},Object.defineProperty(e.prototype,"itemsLayout",{get:function(){this.navigatorShape=[0,0];var t="grid"===this.attributes.layout?this.getGridLayout:this.getFlexLayout,e=t.call(this);return e.slice(-1)[0].page>0?(this.navigatorShape=[55,0],t.call(this)):e},enumerable:!1,configurable:!0}),e.prototype.ifHorizontal=function(t,e){return EU(this.attributes.orientation,t,e)},e.prototype.flattenPage=function(t){t.querySelectorAll(xU.item.class).forEach((function(e){t.appendChild(e)})),t.querySelectorAll(xU.page.class).forEach((function(e){t.removeChild(e).destroy()}))},e.prototype.renderItems=function(t){var e=this.attributes,n=e.click,r=e.mouseenter,i=e.mouseleave;this.flattenPage(t);var o=this.dispatchCustomEvent.bind(this);IB(t).selectAll(xU.item.class).data(this.renderData,(function(t){return t.id})).join((function(t){return t.append((function(t){var e=t.style;return new bU({style:e})})).attr("className",xU.item.name).on("click",(function(){null==n||n(this),o("itemClick",{item:this})})).on("pointerenter",(function(){null==r||r(this),o("itemMouseenter",{item:this})})).on("pointerleave",(function(){null==i||i(this),o("itemMouseleave",{item:this})}))}),(function(t){return t.each((function(t){var e=t.style;this.update(e)}))}),(function(t){return t.remove()}))},e.prototype.relayoutNavigator=function(){var t,e=this.attributes,n=e.layout,r=e.width,i=(null===(t=this.pageViews.children[0])||void 0===t?void 0:t.getBBox().height)||0,o=l(this.navigatorShape,2),a=o[0],s=o[1];this.navigator.update("grid"===n?{pageWidth:r-a,pageHeight:i-s}:{})},e.prototype.adjustLayout=function(){var t,e,n=this,r=Object.entries((t=this.itemsLayout,e="page",t.reduce((function(t,n){return(t[n[e]]=t[n[e]]||[]).push(n),t}),{}))).map((function(t){var e=l(t,2);return{page:e[0],layouts:e[1]}})),i=u([],l(this.navigator.getContainer().children),!1);r.forEach((function(t){var e=t.layouts,r=n.pageViews.appendChild(new Dw({className:xU.page.name}));e.forEach((function(t){var e=t.x,n=t.y,o=t.index,a=t.width,s=t.height,l=i[o];r.appendChild(l),tt(l,"__layout__",t),l.update({x:e,y:n,width:a,height:s})}))})),this.relayoutNavigator()},e.prototype.renderNavigator=function(t){var e=this.attributes.orientation,n=GB(this.attributes,"nav"),r=nB({orientation:e},n),i=this;return t.selectAll(xU.navigator.class).data(["nav"]).join((function(t){return t.append((function(){return new yU({style:r})})).attr("className",xU.navigator.name).each((function(){i.navigator=this}))}),(function(t){return t.each((function(){this.update(r)}))}),(function(t){return t.remove()})),this.navigator},e.prototype.getBBox=function(){return this.navigator.getBBox()},e.prototype.render=function(t,e){var n=this.attributes.data;if(n&&0!==n.length){var r=this.renderNavigator(IB(e));this.renderItems(r.getContainer()),this.adjustLayout()}},e.prototype.dispatchCustomEvent=function(t,e){var n=new ZT(t,{detail:e});this.dispatchEvent(n)},e}(XB),AU=tB({markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label"},"handle"),RU={showLabel:!0,formatter:function(t){return t.toString()},markerSize:25,markerStroke:"#c5c5c5",markerFill:"#fff",markerLineWidth:1,labelFontSize:12,labelFill:"#c5c5c5",labelText:"",orientation:"vertical",spacing:0};!function(t){function e(e){return t.call(this,e,RU)||this}n(e,t),e.prototype.render=function(t,e){var n=IB(e).maybeAppendByClassName(AU.markerGroup,"g");this.renderMarker(n);var r=IB(e).maybeAppendByClassName(AU.labelGroup,"g");this.renderLabel(r)},e.prototype.renderMarker=function(t){var e=this,n=this.attributes,i=n.orientation,o=n.markerSymbol,a=void 0===o?EU(i,"horizontalHandle","verticalHandle"):o;hB(!!a,t,(function(t){var n=GB(e.attributes,"marker"),i=r({symbol:a},n);e.marker=t.maybeAppendByClassName(AU.marker,(function(){return new tk({style:i})})).update(i)}))},e.prototype.renderLabel=function(t){var e=this,n=this.attributes,o=n.showLabel,a=n.orientation,s=n.spacing,u=void 0===s?0:s,c=n.formatter;hB(o,t,(function(t){var n,o=GB(e.attributes,"label"),s=o.text,h=i(o,["text"]),d=(null===(n=t.select(AU.marker.class))||void 0===n?void 0:n.node().getBBox())||{},f=d.width,p=void 0===f?0:f,g=d.height,v=l(EU(a,[0,(void 0===g?0:g)+u,"center","top"],[p+u,0,"start","middle"]),4),m=v[0],y=v[1],E=v[2],_=v[3];t.maybeAppendByClassName(AU.label,"text").styles(r(r({},h),{x:m,y:y,text:c(s).toString(),textAlign:E,textBaseline:_}))}))}}(XB);var TU={showTitle:!0,padding:0,orientation:"horizontal",backgroundFill:"transparent",titleText:"",titleSpacing:4,titlePosition:"top-left",titleFill:"#2C3542",titleFontWeight:"bold",titleFontFamily:"sans-serif",titleFontSize:12},wU=nB({},TU,{});nB({},TU,zB(RU,"handle"),{color:["#d0e3fa","#acc7f6","#8daaf2","#6d8eea","#4d73cd","#325bb1","#5a3e75","#8c3c79","#e23455","#e7655b"],indicatorBackgroundFill:"#262626",indicatorLabelFill:"white",indicatorLabelFontSize:12,indicatorVisibility:"hidden",labelAlign:"value",labelDirection:"positive",labelSpacing:5,showHandle:!0,showIndicator:!0,showLabel:!0,slidable:!0,titleText:"",type:"continuous"});var PU=tB({title:"title",titleGroup:"title-group",items:"items",itemsGroup:"items-group",contentGroup:"content-group",ribbonGroup:"ribbon-group",ribbon:"ribbon",handlesGroup:"handles-group",handle:"handle",startHandle:"start-handle",endHandle:"end-handle",labelGroup:"label-group",label:"label",indicator:"indicator"},"legend"),NU=function(t){function e(e){return t.call(this,e,wU)||this}return n(e,t),e.prototype.renderTitle=function(t,e,n){var i=this.attributes,o=i.showTitle,a=i.titleText,s=l(VB(GB(this.attributes,"title")),2),u=s[0],c=s[1];this.titleGroup=t.maybeAppendByClassName(PU.titleGroup,"g").styles(c);var h=r(r({width:e,height:n},u),{text:o?a:""});this.title=this.titleGroup.maybeAppendByClassName(PU.title,(function(){return new fU({style:h})})).update(h)},e.prototype.renderItems=function(t,e){var n=e.x,i=e.y,o=e.width,a=e.height,s=l(VB(GB(this.attributes,"title",!0)),2),u=s[0],c=s[1],h=r(r({},u),{width:o,height:a,x:0,y:0});this.itemsGroup=t.maybeAppendByClassName(PU.itemsGroup,"g").styles(r(r({},c),{transform:"translate(".concat(n,", ").concat(i,")")}));var d=this;this.itemsGroup.selectAll(PU.items.class).data(["items"]).join((function(t){return t.append((function(){return new MU({style:h})})).attr("className",PU.items.name).each((function(){d.items=IB(this)}))}),(function(t){return t.update(h)}),(function(t){return t.remove()}))},e.prototype.adjustLayout=function(){if(this.attributes.showTitle){var t=this.title.node().getAvailableSpace(),e=t.x,n=t.y;this.itemsGroup.node().style.transform="translate(".concat(e,", ").concat(n,")")}},Object.defineProperty(e.prototype,"availableSpace",{get:function(){var t=this.attributes,e=t.showTitle,n=t.width,r=t.height;return e?this.title.node().getAvailableSpace():new ZD(0,0,n,r)},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var e,n,r=null===(e=this.title)||void 0===e?void 0:e.node(),i=null===(n=this.items)||void 0===n?void 0:n.node();return r&&i?function(t,e){var n=t.attributes,r=n.position,i=n.spacing,o=n.inset,a=n.text,s=t.getBBox(),u=e.getBBox(),c=hU(r),h=l(LB(a?i:0),4),d=h[0],f=h[1],p=h[2],g=h[3],v=l(LB(o),4),m=v[0],y=v[1],E=v[2],_=v[3],b=l([g+f,d+p],2),x=b[0],S=b[1],M=l([_+y,m+E],2),A=M[0],R=M[1];if("l"===c[0])return new ZD(s.x,s.y,u.width+s.width+x+A,Math.max(u.height+R,s.height));if("t"===c[0])return new ZD(s.x,s.y,Math.max(u.width+A,s.width),u.height+s.height+S+R);var T=l([e.attributes.width||u.width,e.attributes.height||u.height],2),w=T[0],P=T[1];return new ZD(u.x,u.y,w+s.width+x+A,P+s.height+S+R)}(r,i):t.prototype.getBBox.call(this)},e.prototype.render=function(t,e){var n=this.attributes,r=n.width,i=n.height,o=n.x,a=void 0===o?0:o,s=n.y,l=void 0===s?0:s,u=IB(e);e.style.transform="translate(".concat(a,", ").concat(l,")"),this.renderTitle(u,r,i),this.renderItems(u,this.availableSpace),this.adjustLayout()},e}(XB),CU={backgroundFill:"#262626",backgroundLineCap:"round",backgroundLineWidth:1,backgroundStroke:"#333",backgroundZIndex:-1,formatter:function(t){return t.toString()},labelFill:"#fff",labelFontSize:12,labelTextBaseline:"middle",padding:[2,4],position:"right",radius:0,zIndex:999},OU=tB({background:"background",labelGroup:"label-group",label:"label"},"indicator"),IU=function(t){function e(e){var n=t.call(this,e,CU)||this;return n.point=[0,0],n.group=n.appendChild(new Dw({})),n.isMutationObserved=!0,n}return n(e,t),e.prototype.renderBackground=function(){if(this.label){var t=this.attributes,e=t.position,n=l(LB(t.padding),4),i=n[0],o=n[1],a=n[2],s=n[3],u=this.label.node().getLocalBounds(),c=u.min,h=u.max,d=new ZD(c[0]-s,c[1]-i,h[0]+o-c[0]+s,h[1]+a-c[1]+i),f=this.getPath(e,d),p=GB(this.attributes,"background");this.background=IB(this.group).maybeAppendByClassName(OU.background,"path").styles(r(r({},p),{d:f})),this.group.appendChild(this.label.node())}},e.prototype.renderLabel=function(){var t=this.attributes,e=t.formatter,n=t.labelText,r=l(VB(GB(this.attributes,"label")),2),o=r[0],a=r[1];o.text;var s=i(o,["text"]);(this.label=IB(this.group).maybeAppendByClassName(OU.labelGroup,"g").styles(a),n)&&this.label.maybeAppendByClassName(OU.label,(function(){return cB(e(n))})).style("text",e(n).toString()).selectAll("text").styles(s)},e.prototype.adjustLayout=function(){var t=l(this.point,2),e=t[0],n=t[1],r=this.attributes,i=r.x,o=r.y;this.group.attr("transform","translate(".concat(i-e,", ").concat(o-n,")"))},e.prototype.getPath=function(t,e){var n=this.attributes.radius,r=e.x,i=e.y,o=e.width,a=e.height,s=[["M",r+n,i],["L",r+o-n,i],["A",n,n,0,0,1,r+o,i+n],["L",r+o,i+a-n],["A",n,n,0,0,1,r+o-n,i+a],["L",r+n,i+a],["A",n,n,0,0,1,r,i+a-n],["L",r,i+n],["A",n,n,0,0,1,r+n,i],["Z"]],c={top:4,right:6,bottom:0,left:2}[t],h=this.createCorner([s[c].slice(-2),s[c+1].slice(-2)]);return s.splice.apply(s,u([c+1,1],l(h),!1)),s[0][0]="M",s},e.prototype.createCorner=function(t,e){void 0===e&&(e=10);var n=BB.apply(void 0,u([],l(t),!1)),r=l(t,2),i=l(r[0],2),o=i[0],a=i[1],s=l(r[1],2),c=s[0],h=s[1],d=l(n?[c-o,[o,c]]:[h-a,[a,h]],2),f=d[0],p=l(d[1],2),g=p[0],v=p[1],m=f/2,y=e*(f/Math.abs(f)),E=y/2,_=y*Math.sqrt(3)/2*.8,b=l([g,g+m-E,g+m,g+m+E,v],5),x=b[0],S=b[1],M=b[2],A=b[3],R=b[4];return n?(this.point=[M,a-_],[["L",x,a],["L",S,a],["L",M,a-_],["L",A,a],["L",R,a]]):(this.point=[o+_,M],[["L",o,x],["L",o,S],["L",o+_,M],["L",o,A],["L",o,R]])},e.prototype.applyVisibility=function(){"hidden"===this.attributes.visibility?jD(this):WD(this)},e.prototype.bindEvents=function(){this.label.on(nw.BOUNDS_CHANGED,this.renderBackground)},e.prototype.render=function(){this.renderLabel(),this.renderBackground(),this.adjustLayout(),this.applyVisibility()},e}(XB);function LU(t){return void 0===t&&(t=""),{CONTAINER:"".concat(t,"tooltip"),TITLE:"".concat(t,"tooltip-title"),LIST:"".concat(t,"tooltip-list"),LIST_ITEM:"".concat(t,"tooltip-list-item"),NAME:"".concat(t,"tooltip-list-item-name"),MARKER:"".concat(t,"tooltip-list-item-marker"),NAME_LABEL:"".concat(t,"tooltip-list-item-name-label"),VALUE:"".concat(t,"tooltip-list-item-value"),CROSSHAIR_X:"".concat(t,"tooltip-crosshair-x"),CROSSHAIR_Y:"".concat(t,"tooltip-crosshair-y")}}var DU={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"};function BU(t){var e;void 0===t&&(t="");var n=LU(t);return(e={})[".".concat(n.CONTAINER)]={position:"absolute",visibility:"visible","z-index":8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)","background-color":"rgba(255, 255, 255, 0.96)","box-shadow":"0 6px 12px 0 rgba(0, 0, 0, 0.12)","border-radius":"4px",color:"rgba(0, 0, 0, 0.65)","font-size":"12px","line-height":"20px",padding:"12px","min-width":"120px","max-width":"360px","font-family":"Roboto-Regular"},e[".".concat(n.TITLE)]={color:"rgba(0, 0, 0, 0.45)"},e[".".concat(n.LIST)]={margin:"0px","list-style-type":"none",padding:"0px"},e[".".concat(n.LIST_ITEM)]={"list-style-type":"none",display:"flex","line-height":"2em","align-items":"center","justify-content":"space-between","white-space":"nowrap"},e[".".concat(n.MARKER)]={width:"8px",height:"8px","border-radius":"50%",display:"inline-block","margin-right":"4px"},e[".".concat(n.NAME)]={display:"flex","align-items":"center","max-width":"216px"},e[".".concat(n.NAME_LABEL)]=r({flex:1},DU),e[".".concat(n.VALUE)]=r({display:"inline-block",float:"right",flex:1,"text-align":"right","min-width":"28px","margin-left":"30px",color:"rgba(0, 0, 0, 0.85)"},DU),e[".".concat(n.CROSSHAIR_X)]={position:"absolute",width:"1px","background-color":"rgba(0, 0, 0, 0.25)"},e[".".concat(n.CROSSHAIR_Y)]={position:"absolute",height:"1px","background-color":"rgba(0, 0, 0, 0.25)"},e}var kU=function(t){function e(e){var n,r,i=this,o=null===(r=null===(n=e.style)||void 0===n?void 0:n.template)||void 0===r?void 0:r.prefixCls,a=LU(o);return(i=t.call(this,e,{data:[],x:0,y:0,visibility:"visible",title:"",position:"bottom-right",offset:[5,5],enterable:!1,container:{x:0,y:0},bounding:null,template:{prefixCls:"",container:'<div class="'.concat(a.CONTAINER,'"></div>'),title:'<div class="'.concat(a.TITLE,'"></div>'),item:'<li class="'.concat(a.LIST_ITEM,'" data-index={index}>\n        <span class="').concat(a.NAME,'">\n          <span class="').concat(a.MARKER,'" style="background:{color}"></span>\n          <span class="').concat(a.NAME_LABEL,'" title="{name}">{name}</span>\n        </span>\n        <span class="').concat(a.VALUE,'" title="{value}">{value}</span>\n      </li>')},style:BU(o)})||this).timestamp=-1,i.prevCustomContentKey=i.attributes.contentKey,i.initShape(),i.render(i.attributes,i),i}return n(e,t),Object.defineProperty(e.prototype,"HTMLTooltipElement",{get:function(){return this.element},enumerable:!1,configurable:!0}),e.prototype.getContainer=function(){return this.element},Object.defineProperty(e.prototype,"elementSize",{get:function(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"HTMLTooltipItemsElements",{get:function(){var t=this.attributes,e=t.data,n=t.template;return e.map((function(t,e){var o=t.name,a=void 0===o?"":o,s=t.color,l=void 0===s?"black":s,u=t.index,c=i(t,["name","color","index"]),h=r({name:a,color:l,index:null!=u?u:e},c);return on(function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t}(n.item,h))}))},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){this.renderHTMLTooltipElement(),this.updatePosition()},e.prototype.destroy=function(){var e;null===(e=this.element)||void 0===e||e.remove(),t.prototype.destroy.call(this)},e.prototype.show=function(t,e){var n=this;if(void 0!==t&&void 0!==e){var r=function(){n.attributes.x=null!=t?t:n.attributes.x,n.attributes.y=null!=e?e:n.attributes.y,n.updatePosition()};"hidden"===this.element.style.visibility?this.closeTransition(r):r()}this.element.style.visibility="visible"},e.prototype.hide=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.attributes.enterable&&this.isCursorEntered(t,e)||(this.element.style.visibility="hidden")},e.prototype.initShape=function(){var t=this.attributes.template;this.element=on(t.container),this.id&&this.element.setAttribute("id",this.id)},e.prototype.renderCustomContent=function(){if(void 0===this.prevCustomContentKey||this.prevCustomContentKey!==this.attributes.contentKey){this.prevCustomContentKey=this.attributes.contentKey;var t=this.attributes.content;t&&("string"==typeof t?this.element.innerHTML=t:this.element.replaceChildren(t))}},e.prototype.renderHTMLTooltipElement=function(){var t,e,n=this.attributes,r=n.template,i=n.title,o=n.enterable,a=n.style,s=n.content,c=LU(r.prefixCls),h=this.element;if(this.element.style.pointerEvents=o?"auto":"none",s)this.renderCustomContent();else{i?(h.innerHTML=r.title,h.getElementsByClassName(c.TITLE)[0].innerHTML=i):null===(e=null===(t=h.getElementsByClassName(c.TITLE))||void 0===t?void 0:t[0])||void 0===e||e.remove();var d=this.HTMLTooltipItemsElements,f=document.createElement("ul");f.className=c.LIST,f.replaceChildren.apply(f,u([],l(d),!1));var p=this.element.querySelector(".".concat(c.LIST));p?p.replaceWith(f):h.appendChild(f)}!function(t,e){Object.entries(e).forEach((function(e){var n=l(e,2),r=n[0],i=n[1];u([t],l(t.querySelectorAll(r)),!1).filter((function(t){return t.matches(r)})).forEach((function(t){t&&(t.style.cssText+=Object.entries(i).reduce((function(t,e){return"".concat(t).concat(e.join(":"),";")}),""))}))}))}(h,a)},e.prototype.getRelativeOffsetFromCursor=function(t){var e=this.attributes,n=e.position,r=e.offset,i=(t||n).split("-"),o={left:[-1,0],right:[1,0],top:[0,-1],bottom:[0,1]},a=this.elementSize,s=a.width,u=a.height,c=[-s/2,-u/2];return i.forEach((function(t){var e=l(c,2),n=e[0],i=e[1],a=l(o[t],2),h=a[0],d=a[1];c=[n+(s/2+r[0])*h,i+(u/2+r[1])*d]})),c},e.prototype.setOffsetPosition=function(t){var e=l(t,2),n=e[0],r=e[1],i=this.attributes,o=i.x,a=void 0===o?0:o,s=i.y,u=void 0===s?0:s,c=i.container,h=c.x,d=c.y;this.element.style.left="".concat(+a+h+n,"px"),this.element.style.top="".concat(+u+d+r,"px")},e.prototype.updatePosition=function(){var t=this.attributes.showDelay,e=void 0===t?60:t,n=Date.now();this.timestamp>0&&n-this.timestamp<e||(this.timestamp=n,this.setOffsetPosition(this.autoPosition(this.getRelativeOffsetFromCursor())))},e.prototype.autoPosition=function(t){var e=l(t,2),n=e[0],r=e[1],i=this.attributes,o=i.x,a=i.y,s=i.bounding,u=i.position;if(!s)return[n,r];var c=this.element,h=c.offsetWidth,d=c.offsetHeight,f=l([+o+n,+a+r],2),p=f[0],g=f[1],v={left:"right",right:"left",top:"bottom",bottom:"top"},m=s.x,y=s.y,E={left:p<m,right:p+h>m+s.width,top:g<y,bottom:g+d>y+s.height},_=[];u.split("-").forEach((function(t){E[t]?_.push(v[t]):_.push(t)}));var b=_.join("-");return this.getRelativeOffsetFromCursor(b)},e.prototype.isCursorEntered=function(t,e){if(this.element){var n=this.element.getBoundingClientRect(),r=n.x,i=n.y,o=n.width,a=n.height;return new ZD(r,i,o,a).isPointIn(t,e)}return!1},e.prototype.closeTransition=function(t){var e=this,n=this.element.style.transition;this.element.style.transition="none",t(),setTimeout((function(){e.element.style.transition=n}),10)},e.tag="tooltip",e}(XB),FU=function(t){function e(e){var n=t.call(this,e)||this;n.layoutEvents=[nw.BOUNDS_CHANGED,nw.INSERTED,nw.REMOVED],n.$margin=LB(0),n.$padding=LB(0);var r=e.style||{},i=r.margin,o=void 0===i?0:i,a=r.padding,s=void 0===a?0:a;return n.margin=o,n.padding=s,n.isMutationObserved=!0,n.bindEvents(),n}return n(e,t),Object.defineProperty(e.prototype,"margin",{get:function(){return this.$margin},set:function(t){this.$margin=LB(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this.$padding},set:function(t){this.$padding=LB(t)},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var t=this.attributes,e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.width,a=t.height,s=l(this.$margin,4),u=s[0],c=s[1],h=s[2],d=s[3];return new ZD(n-d,i-u,o+d+c,a+u+h)},e.prototype.appendChild=function(e,n){return e.isMutationObserved=!0,t.prototype.appendChild.call(this,e,n),e},e.prototype.getAvailableSpace=function(){var t=this.attributes,e=t.width,n=t.height,r=l(this.$padding,4),i=r[0],o=r[1],a=r[2],s=r[3],u=l(this.$margin,4),c=u[0],h=u[3];return new ZD(s+h,i+c,e-s-o,n-i-a)},e.prototype.layout=function(){if(this.attributes.display&&this.isConnected&&!this.children.some((function(t){return!t.isConnected})))try{var t=this.attributes,e=t.x,n=t.y;this.style.transform="translate(".concat(e,", ").concat(n,")");var r=function(t,e,n){if(0===e.length)return[];var r={flex:vB,grid:mB},i=n.display in r?r[n.display]:null;return(null==i?void 0:i.call(null,t,e,n))||[]}(this.getAvailableSpace(),this.children.map((function(t){return t.getBBox()})),this.attributes);this.children.forEach((function(t,e){var n=r[e],i=n.x,o=n.y;t.style.transform="translate(".concat(i,", ").concat(o,")")}))}catch(t){}},e.prototype.bindEvents=function(){var t=this;this.layoutEvents.forEach((function(e){t.addEventListener(e,(function(e){e.target.isMutationObserved=!0,t.layout()}))}))},e.prototype.attributeChangedCallback=function(t,e,n){"margin"===t?this.margin=n:"padding"===t&&(this.padding=n),this.layout()},e}(Dw),UU=function(t){function e(n){var r=t.call(this,nB({},e.defaultOptions,n))||this;return r.hoverColor="#f5f5f5",r.selectedColor="#e6f7ff",r.background=r.appendChild(new Vw({})),r.label=r.background.appendChild(new Dw({})),r}return n(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return LB(this.style.padding)},enumerable:!1,configurable:!0}),e.prototype.renderLabel=function(){var t=this.style,e=t.label,n=t.value,r=GB(this.attributes,"label");IB(this.label).maybeAppend(".label",(function(){return cB(e)})).attr("className","label").styles(r),this.label.attr("__data__",n)},e.prototype.renderBackground=function(){var t=this.label.getBBox(),e=l(this.padding,4),n=e[0],i=e[1],o=e[2],a=e[3],s=t.width,u=t.height,c=s+a+i,h=u+n+o,d=GB(this.attributes,"background"),f=this.style,p=f.width,g=void 0===p?0:p,v=f.height,m=void 0===v?0:v,y=f.selected;this.background.attr(r(r({},d),{width:Math.max(c,g),height:Math.max(h,m),fill:y?this.selectedColor:"#fff"})),this.label.attr({transform:"translate(".concat(a,", ").concat((h-u)/2,")")})},e.prototype.render=function(){this.renderLabel(),this.renderBackground()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("pointerenter",(function(){t.style.selected||t.background.attr("fill",t.hoverColor)})),this.addEventListener("pointerleave",(function(){t.style.selected||t.background.attr("fill",t.style.backgroundFill)}));var e=this;this.addEventListener("click",(function(){var n=t.style,r=n.label,i=n.value,o=n.onClick;null==o||o(i,{label:r,value:i},e)}))},e.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},e}(XB),GU=function(t){function e(n){var r,i,o=t.call(this,nB({},e.defaultOptions,n))||this;o.currentValue=null===(r=e.defaultOptions.style)||void 0===r?void 0:r.defaultValue,o.isPointerInSelect=!1,o.select=o.appendChild(new Vw({className:"select",style:{cursor:"pointer",width:0,height:0}})),o.dropdown=o.appendChild(new Vw({className:"dropdown"}));var a=o.style.defaultValue;return a&&(null===(i=o.style.options)||void 0===i?void 0:i.some((function(t){return t.value===a})))&&(o.currentValue=a),o}return n(e,t),e.prototype.setValue=function(t){this.currentValue=t,this.render()},e.prototype.getValue=function(){return this.currentValue},Object.defineProperty(e.prototype,"dropdownPadding",{get:function(){return LB(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),e.prototype.renderSelect=function(){var t,e=this,n=this.style,i=n.x,o=n.y,a=n.width,s=n.height,l=n.bordered,u=n.showDropdownIcon,c=GB(this.attributes,"select"),h=GB(this.attributes,"placeholder");this.select.attr(r(r({x:i,y:o,width:a,height:s},c),{fill:"#fff",strokeWidth:l?1:0}));var d=this.dropdownPadding;u&&IB(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(i+a-10-d[1]-d[3],", ").concat(o+s/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var f=null===(t=this.style.options)||void 0===t?void 0:t.find((function(t){return t.value===e.currentValue})),p=r({x:i+d[3]},h);IB(this.select).selectAll(".placeholder").data(f?[]:[1]).join((function(t){return t.append("text").attr("className","placeholder").styles(p).style("y",(function(){var t=this.getBBox();return o+(s-t.height)/2}))}),(function(t){return t.styles(p)}),(function(t){return t.remove()}));var g=GB(this.attributes,"optionLabel"),v=r({x:i+d[3]},g);IB(this.select).selectAll(".value").data(f?[f]:[]).join((function(t){return t.append((function(t){return cB(t.label)})).attr("className","value").styles(v).style("y",(function(){var t=this.getBBox();return o+(s-t.height)/2}))}),(function(t){return t.styles(v)}),(function(t){return t.remove()}))},e.prototype.renderDropdown=function(){var t,e,n=this,i=this.style,o=i.x,a=i.y,s=i.width,l=i.height,u=i.options,c=i.onSelect,h=i.open,d=GB(this.attributes,"dropdown"),f=GB(this.attributes,"option"),p=this.dropdownPadding;IB(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(u,(function(t){return t.value})).join((function(t){return t.append((function(t){return new UU({className:"dropdown-item",style:r(r(r({},t),f),{width:s-p[1]-p[3],selected:t.value===n.currentValue,onClick:function(t,e,r){n.setValue(t),null==c||c(t,e,r),n.dispatchEvent(new ZT("change",{detail:{value:t,option:e,item:r}})),jD(n.dropdown)}})})})).each((function(t,e){var n,r=(null===(n=this.parentNode)||void 0===n?void 0:n.children).reduce((function(t,n,r){return r<e&&(t+=n.getBBox().height),t}),0);this.attr("transform","translate(".concat(p[3],", ").concat(p[0]+r,")"))}))}),(function(t){return t.update((function(t){return{selected:t.value===n.currentValue}}))}),(function(t){return t.remove()}));var g=null===(e=null===(t=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===t?void 0:t[0])||void 0===e?void 0:e.getBBox(),v=d.spacing;this.dropdown.attr(r({transform:"translate(".concat(o,", ").concat(a+l+v,")"),width:g.width+p[1]+p[3],height:g.height+p[0]+p[2]},d)),!h&&jD(this.dropdown)},e.prototype.render=function(){this.renderSelect(),this.renderDropdown()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("click",(function(t){t.stopPropagation()})),this.select.addEventListener("click",(function(){"visible"===t.dropdown.style.visibility?jD(t.dropdown):WD(t.dropdown)})),this.addEventListener("pointerenter",(function(){t.isPointerInSelect=!0})),this.addEventListener("pointerleave",(function(){t.isPointerInSelect=!1})),null===document||void 0===document||document.addEventListener("click",(function(){t.isPointerInSelect||jD(t.dropdown)}))},e.defaultOptions={style:{x:0,y:0,width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"请选择",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},e}(XB),zU=function(t){function e(n){var r=t.call(this,nB({},{style:{backgroundOpacity:e.backgroundOpacities.default}},e.defaultOptions,n))||this;return r.showBackground=!0,r.background=r.appendChild(new Vw({})),r.icon=r.appendChild(new Dw({})),r}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return LB(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconSize",{get:function(){var t=this.attributes.size,e=l(this.padding,4),n=e[0],r=e[1],i=e[2],o=e[3];return Math.max(t-Math.max(o+r,n+i),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.size,o=i/2,a=GB(this.attributes,"background");this.background.attr(r({x:e-o,y:n-o,width:i,height:i},a))},e.prototype.showIndicator=function(){if(this.label){var t=this.attributes.size,e=this.background.getBBox(),n=e.x,r=e.y;this.indicator.update({x:n+t/2,y:r-5,labelText:this.label,visibility:"visible"})}},e.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},e.prototype.connectedCallback=function(){var e;t.prototype.connectedCallback.call(this);var n=this.attributes.size,r=this.background.getBBox(),i=r.x,o=r.y,a=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView;a&&(this.indicator=a.appendChild(new IU({style:{x:i+n/2,y:o-n/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},e.prototype.disconnectedCallback=function(){this.indicator.destroy()},e.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},e.prototype.bindEvents=function(){var t=this,n=this.attributes.onClick;if(this.addEventListener("click",(function(){null==n||n(t)})),this.showBackground){var r=function(){return t.background.attr({opacity:e.backgroundOpacities.default})};this.addEventListener("pointerenter",(function(){t.background.attr({opacity:e.backgroundOpacities.hover}),t.showIndicator()})),this.addEventListener("pointerleave",(function(){r(),t.hideIndicator()})),this.addEventListener("pointerdown",(function(){t.background.attr({opacity:e.backgroundOpacities.active})})),this.addEventListener("pointerup",(function(){r()}))}},e.tag="IconBase",e.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},e.backgroundOpacities={default:0,hover:.8,active:1},e}(XB),VU=function(t,e){return void 0===e&&(e="#565758"),new Uw({style:{fill:e,d:"M ".concat(t,",").concat(t," L -").concat(t,",0 L ").concat(t,",-").concat(t," Z"),transformOrigin:"center"}})},WU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.arcPath=function(t,e,n){var r=l([n,n],2),i=r[0],o=r[1],a=function(r){return[t+n*Math.cos(r),e+n*Math.sin(r)]},s=l(a(-5/4*Math.PI),2),u=s[0],c=s[1],h=l(a(1/4*Math.PI),2),d=h[0],f=h[1];return"M".concat(u,",").concat(c,",A").concat(i,",").concat(o,",0,1,1,").concat(d,",").concat(f)},Object.defineProperty(e.prototype,"label",{get:function(){return"重置"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=this.lineWidth,a=o+.5;IB(this.icon).maybeAppend(".reset","path").styles({stroke:r,lineWidth:o,d:this.arcPath(e,n,i/2-o),markerStart:VU(a,r)})},e}(zU),jU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"快退"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=i/2,a=i/2/Math.pow(3,.5),s=[[e,n],[e,n-a],[e-o,n],[e,n+a],[e,n],[e+o,n-a],[e+o,n+a],[e,n]];IB(this.icon).maybeAppend(".backward","polygon").styles({points:s,fill:r})},e}(zU),HU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"快进"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=i/2,a=i/2/Math.pow(3,.5),s=[[e,n],[e,n-a],[e+o,n],[e,n+a],[e,n],[e-o,n-a],[e-o,n+a],[e,n]];IB(this.icon).maybeAppend(".forward","polygon").styles({points:s,fill:r})},e}(zU),XU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"播放"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=i/3*Math.pow(3,.5)*.8,a=[[e+o,n],[e-o/2,n-i/2*.8],[e-o/2,n+i/2*.8],[e+o,n]];IB(this.icon).maybeAppend(".play","polygon").styles({points:a,fill:r})},e}(zU),YU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"暂停"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=i/3,a=[[e-o,n-i/2],[e-o,n+i/2],[e-o/2,n+i/2],[e-o/2,n-i/2],[e-o,n-i/2],[e+o/2,n-i/2],[e+o/2,n+i/2],[e+o,n+i/2],[e+o,n-i/2]];IB(this.icon).maybeAppend(".pause","polygon").styles({points:a,fill:r})},e}(zU),KU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"范围时间"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=this.lineWidth,a=o;IB(this.icon).maybeAppend(".left-line","line").styles({x1:e-i/2,y1:n-i/2,x2:e-i/2,y2:n+i/2,stroke:r,lineWidth:o}),IB(this.icon).maybeAppend(".right-line","line").styles({x1:e+i/2,y1:n-i/2,x2:e+i/2,y2:n+i/2,stroke:r,lineWidth:o}),IB(this.icon).maybeAppend(".left-arrow","line").styles({x1:e,y1:n,x2:e-i/2+2*a,y2:n,stroke:r,lineWidth:o,markerEnd:VU(2*o,r)}),IB(this.icon).maybeAppend(".right-arrow","line").styles({x1:e,y1:n,x2:e+i/2-2*a,y2:n,stroke:r,lineWidth:o,markerEnd:VU(2*o,r)})},e}(zU),$U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"单一时间"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=this.lineWidth;IB(this.icon).maybeAppend(".line","line").styles({x1:e,y1:n-i/2,x2:e,y2:n+i/2,stroke:r,lineWidth:o});var a=o;IB(this.icon).maybeAppend(".left-arrow","line").styles({x1:e-i/2-2*a,y1:n,x2:e-2*a,y2:n,stroke:r,lineWidth:o,markerEnd:VU(2*o,r)}),IB(this.icon).maybeAppend(".right-arrow","line").styles({x1:e+i/2+2*a,y1:n,x2:e+2*a,y2:n,stroke:r,lineWidth:o,markerEnd:VU(2*o,r)})},e}(zU),qU=function(t){return[[-t/2,-t/2],[-t/2,t/2],[t/2,t/2]]},ZU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"折线图"},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=this.lineWidth,a=(i-2*o-o)/4,s=(i-2*o-o)/2,u=l([e-i/2+o,n+i/2-2*o],2),c=u[0],h=u[1];IB(this.icon).maybeAppend(".coordinate","polyline").styles({points:qU(i).map((function(t){var r=l(t,2),i=r[0],o=r[1];return[i+e,o+n]})),stroke:r,lineWidth:o}),IB(this.icon).maybeAppend(".line","polyline").styles({points:[[c,h],[c+a,h-s],[c+2*a,h],[c+4*a,h-2*s]],stroke:r,lineWidth:o})},e}(zU),QU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"条形图"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.data,e=this.attributes,n=e.x,r=e.y,i=e.color,o=this.iconSize,a=this.lineWidth,s=a,u=(o-s)/t.length,c=(o-2*s)/4,h=l([n-o/2+2*s,r+o/2-s],2),d=h[0],f=h[1];IB(this.icon).maybeAppend(".coordinate","polyline").styles({points:qU(o).map((function(t){var e=l(t,2),i=e[0],o=e[1];return[i+n,o+r]})),stroke:i,lineWidth:a}),IB(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map((function(t,e){return{value:t,index:e}}))).join((function(t){return t.append("line").attr("className","column").style("x1",(function(t){var e=t.index;return d+u*e})).style("y1",f).style("x2",(function(t){var e=t.index;return d+u*e})).style("y2",(function(t){var e=t.value;return f-c*e})).styles({y1:f,stroke:i,lineWidth:a})}))},e}(zU),JU=function(t){function e(e){var n=t.call(this,nB({},{style:{color:"#d8d9d9"}},e))||this;return n.showBackground=!1,n}return n(e,t),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,r=t.color,i=this.iconSize,o=this.lineWidth;IB(this.icon).maybeAppend(".split","line").styles({x1:e,y1:n-i/2,x2:e,y2:n+i/2,stroke:r,lineWidth:o})},e}(zU),tG=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.showBackground=!1,e}return n(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return LB(0)},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.iconSize,e=this.attributes,n=e.x,i=e.y,o=e.speed,a=void 0===o?1:o,s=rt(this.attributes,["x","y","transform","transformOrigin","width","height","size","color","speed"]),l=O(t,20,1/0),u=r(r({},s),{x:n-l/2,y:i-10,width:l,height:20,defaultValue:a,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:t/5,placeholderFontSize:t/2,optionPadding:0,optionLabelFontSize:t/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});IB(this.icon).maybeAppend(".speed",(function(){return new GU({style:u})})).attr("className","speed").each((function(){this.update(u)}))},e.tag="SpeedSelect",e}(zU),eG=function(t){function e(e){var n=t.call(this,e)||this;return n.icon=n.appendChild(new Dw({})),n.currentType=n.attributes.type,n}return n(e,t),e.prototype.getType=function(){return this.currentType},e.prototype.render=function(){var t=this,e=this.attributes;e.onChange;var n=i(e,["onChange"]);IB(this.icon).selectAll(".icon").data([this.currentType]).join((function(e){return e.append((function(e){var n,r=null===(n=t.toggles.find((function(t){return l(t,1)[0]===e})))||void 0===n?void 0:n[1];if(!r)throw new Error("Invalid type: ".concat(e));return new r({})})).attr("className","icon").styles(n,!1).update({})}),(function(t){return t.styles({restStyles:n}).update({})}),(function(t){return t.remove()}))},e.prototype.bindEvents=function(){var t=this,e=this.attributes.onChange;this.addEventListener("click",(function(n){n.preventDefault(),n.stopPropagation();var r=(t.toggles.findIndex((function(e){return l(e,1)[0]===t.currentType}))+1)%t.toggles.length,i=t.toggles[r][0];null==e||e(t.currentType),t.currentType=i,t.render()}))},e.tag="ToggleIcon",e}(XB),nG=function(t){function e(e){var n=t.call(this,nB({},{style:{type:"play"}},e))||this;return n.toggles=[["play",XU],["pause",YU]],n}return n(e,t),e}(eG),rG=function(t){function e(e){var n=t.call(this,nB({},{style:{type:"range"}},e))||this;return n.toggles=[["range",KU],["value",$U]],n}return n(e,t),e}(eG),iG=function(t){function e(e){var n=t.call(this,nB({},{style:{type:"column"}},e))||this;return n.toggles=[["line",ZU],["column",QU]],n}return n(e,t),e}(eG),oG={reset:WU,speed:tG,backward:jU,playPause:nG,forward:HU,selectionType:rG,chartType:iG,split:JU},aG=function(t){function e(n){var r=t.call(this,nB({},e.defaultOptions,n))||this;return r.background=r.appendChild(new Vw({})),r.functions=r.appendChild(new Dw({})),r}return n(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return LB(this.attributes.padding)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.style,e=t.x,n=t.y,i=t.width,o=t.height,a=GB(this.attributes,"background");this.background.attr(r({x:e,y:n,width:i,height:o},a))},e.prototype.renderFunctions=function(){var t,e=this,n=this.attributes,i=n.functions,o=n.iconSize,a=n.iconSpacing,s=n.x,c=n.y,h=n.width,d=n.height,f=n.align,p=l(this.padding,4),g=p[1],v=p[3],m=i.reduce((function(t,e){return t.length&&e.length?t.concat.apply(t,u(["split"],l(e),!1)):t.concat.apply(t,u([],l(e),!1))}),[]),y=m.length*(o+a)-a,E={left:v+o/2,center:(h-y)/2+o/2,right:h-y-v-g+o/2}[f]||0;null===(t=this.speedSelect)||void 0===t||t.destroy(),this.functions.removeChildren(),m.forEach((function(t,n){var i,l=oG[t],u={x:s+n*(o+a)+E,y:c+d/2,size:o};if(l===tG?(u.speed=e.attributes.speed,u.onSelect=function(n){return e.handleFunctionChange(t,{value:n})}):[nG,rG,iG].includes(l)?(u.onChange=function(n){return e.handleFunctionChange(t,{value:n})},l===nG&&(u.type="play"===e.attributes.state?"pause":"play"),l===rG&&(u.type="range"===e.attributes.selectionType?"value":"range"),l===iG&&(u.type="line"===e.attributes.chartType?"column":"line")):u.onClick=function(){return e.handleFunctionChange(t,{value:t})},l===tG){var h=null===(i=e.ownerDocument)||void 0===i?void 0:i.defaultView;h&&(e.speedSelect=new l({style:r(r({},u),{zIndex:100})}),h.appendChild(e.speedSelect))}else e.functions.appendChild(new l({style:u}))}))},e.prototype.disconnectedCallback=function(){var e;t.prototype.disconnectedCallback.call(this),null===(e=this.speedSelect)||void 0===e||e.destroy()},e.prototype.render=function(){this.renderBackground(),this.renderFunctions()},e.prototype.handleFunctionChange=function(t,e){var n=this.attributes.onChange;null==n||n(t,e)},e.defaultOptions={style:{x:0,y:0,width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},e}(XB),sG=function(t){function e(n){var r=t.call(this,nB({},e.defaultOptions,n))||this;return r.bindEvents(),r}return n(e,t),e.prototype.bindEvents=function(){var t=this;this.addEventListener("mouseenter",(function(){t.attr("lineWidth",Math.ceil(+(t.style.r||0)/2))})),this.addEventListener("mouseleave",(function(){t.attr("lineWidth",0)}))},e.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},e}(Ow),lG=function(t){function e(n){return t.call(this,nB({},e.defaultOptions,n))||this}return n(e,t),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,o=t.height,a=GB(this.attributes,"background");IB(this).maybeAppend("background","rect").attr("className","background").styles(r({x:e-i/2,y:n-o/2,width:i,height:o},a))},e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.iconSize,o=GB(this.attributes,"icon"),a=i/2;IB(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles(r({x1:e-1,y1:n-a,x2:e-1,y2:n+a},o)),IB(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles(r({x1:e+1,y1:n-a,x2:e+1,y2:n+a},o))},e.prototype.renderBorder=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,o=t.height,a=t.type,s=GB(this.attributes,"border"),l="start"===a?+i/2:-i/2;IB(this).maybeAppend("border","line").attr("className","border").styles(r({x1:l+e,y1:n-o/2,x2:l+e,y2:n+o/2},s))},e.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},e.defaultOptions={style:{x:0,y:0,width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},e}(XB);function uG(t,e){return"number"==typeof t?cG(t):function(t,e){var n=new Date(t);switch(e){case"half-hour":case"hour":case"four-hour":return[0,6,12,18].includes(n.getHours())&&0===n.getMinutes()?WB(n,"HH:mm\nYYYY-MM-DD"):WB(n,"HH:mm");case"half-day":return n.getHours()<12?"AM\n".concat(WB(n,"YYYY-MM-DD")):"PM";case"day":return[1,10,20].includes(n.getDate())?WB(n,"DD\nYYYY-MM"):WB(n,"DD");case"week":return n.getDate()<=7?WB(n,"DD\nYYYY-MM"):WB(n,"DD");case"month":return[0,6].includes(n.getMonth())?WB(n,"MM月\nYYYY"):WB(n,"MM月");case"season":return[0].includes(n.getMonth())?WB(n,"MM月\nYYYY"):WB(n,"MM月");case"year":return WB(n,"YYYY");default:return WB(n,"YYYY-MM-DD HH:mm")}}(t,e)}function cG(t){var e=String(Math.floor(t/3600)).padStart(2,"0"),n=String(Math.floor(t%3600/60)).padStart(2,"0"),r=String(Math.floor(t%60)).padStart(2,"0");return t<3600?"".concat(n,":").concat(r):"".concat(e,":").concat(n,":").concat(r)}var hG=function(t){function e(n){var r=t.call(this,nB({},e.defaultOptions,n))||this;r.axis=r.appendChild(new vU({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),r.timeline=r.appendChild(new gF({style:{onChange:function(t){r.handleSliderChange(t)}}})),r.controller=r.appendChild(new aG({})),r.states={},r.handleSliderChange=function(t){var e,n=(e=r.states.values,Array.isArray(e)?u([],l(e),!1):e);r.setBySliderValues(t),r.dispatchOnChange(n)};var i=r.attributes,o=i.selectionType,a=i.chartType,s=i.speed,c=i.state,h=i.playMode,d=i.values;return r.states={chartType:a,playMode:h,selectionType:o,speed:s,state:c},r.setByTimebarValues(d),r}return n(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.data.sort((function(t,e){return t.time<e.time?-1:t.time>e.time?1:0}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"space",{get:function(){var t=this.attributes,e=t.x,n=t.y,r=t.width,i=t.height,o=t.type,a=t.controllerHeight,s=O(+i-a,0,+i),l=new ZD(e,n+ +i-a,+r,a),u=0,c="time"===o?10:s;return{axisBBox:"chart"===o?new ZD(e,n+s-(u=35),+r,u):new ZD,controllerBBox:l,timelineBBox:new ZD(e,n+("time"===o?s:s-c),+r,c-u)}},enumerable:!1,configurable:!0}),e.prototype.setBySliderValues=function(t){var e,n,r=this.data,i=l(Array.isArray(t)?t:[0,t],2),o=i[0],a=i[1],s=r.length,u=r[Math.floor(o*s)],c=r[Math.ceil(a*s)-(Array.isArray(t)?0:1)];this.states.values=[null!==(e=null==u?void 0:u.time)&&void 0!==e?e:r[0].time,null!==(n=null==c?void 0:c.time)&&void 0!==n?n:1/0]},e.prototype.setByTimebarValues=function(t){var e,n,r,i=this.data,o=l(Array.isArray(t)?t:[void 0,t],2),a=o[0],s=o[1],u=i.find((function(t){return t.time===a})),c=i.find((function(t){return t.time===s}));this.states.values=[null!==(e=null==u?void 0:u.time)&&void 0!==e?e:null===(n=i[0])||void 0===n?void 0:n.time,null!==(r=null==c?void 0:c.time)&&void 0!==r?r:1/0]},e.prototype.setByIndex=function(t){var e,n,r,i,o=this.data,a=l(t,2),s=a[0],u=a[1];this.states.values=[null!==(n=null===(e=o[s])||void 0===e?void 0:e.time)&&void 0!==n?n:o[0].time,null!==(i=null===(r=this.data[u])||void 0===r?void 0:r.time)&&void 0!==i?i:1/0]},Object.defineProperty(e.prototype,"sliderValues",{get:function(){var t,e=this.states,n=e.values,r=e.selectionType,i=l(Array.isArray(n)?n:[void 0,n],2),o=i[0],a=i[1],s=this.data,u=s.length,c="value"===r;return[(t=s.findIndex((function(t){return t.time===o})),c?0:t>-1?t/u:0),function(){if(a===1/0)return 1;var t=s.findIndex((function(t){return t.time===a}));return t>-1?t/u:c?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){var t=this.states,e=t.values,n=t.selectionType,r=l(Array.isArray(e)?e:[this.data[0].time,e],2),i=r[0],o=r[1];return"value"===n?o:[i,o]},enumerable:!1,configurable:!0}),e.prototype.getDatumByRatio=function(t){var e=this.data,n=e.length;return e[Math.floor(t*(n-1))]},Object.defineProperty(e.prototype,"chartHandleIconShape",{get:function(){var t=this.states.selectionType,e=this.space.timelineBBox.height;return"range"===t?function(t){return new lG({style:{type:t,height:e,iconSize:e/6}})}:function(){return new Fw({style:{x1:0,y1:-e/2,x2:0,y2:e/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),e.prototype.getChartStyle=function(t){var e=this,n=t.x,o=t.y,a=t.width,s=t.height,l=this.states,u=l.selectionType,c=l.chartType,h=this.data,d=this.attributes,f=d.type,p=d.labelFormatter,g=GB(this.attributes,"chart");g.type;var v=i(g,["type"]),m="range"===u;if("time"===f)return r({handleIconShape:function(){return new sG({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:m?-15:0,autoFitLabel:m,handleSpacing:m?-15:0,trackFill:"#edeeef",trackLength:a,trackOpacity:.5,trackRadius:s/2,trackSize:s/2,type:u,values:this.sliderValues,formatter:function(t){if(p)return p(t);var n=e.getDatumByRatio(t).time;return"number"==typeof n?cG(n):WB(n,"YYYY-MM-DD HH:mm:ss")},transform:"translate(".concat(n,", ").concat(o,")"),zIndex:1},v);var y="range"===u?5:0,E=h.map((function(t){return t.value}));return r({handleIconOffset:y,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData:E,sparklineType:c,sparklineScale:.8,trackLength:a,trackSize:s,type:u,values:this.sliderValues,transform:"translate(".concat(n,", ").concat(o,")"),zIndex:1},v)},e.prototype.renderChart=function(t){void 0===t&&(t=this.space.timelineBBox),this.timeline.update(this.getChartStyle(t))},e.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},e.prototype.getAxisStyle=function(t){var e=this.data,n=this.attributes,i=n.interval,o=n.labelFormatter,a=GB(this.attributes,"axis"),s=t.x,c=t.y,h=t.width,d=u(u([],l(e),!1),[{time:0}],!1).map((function(t,e,n){var r=t.time;return{label:"".concat(r),value:e/(n.length-1),time:r}})),f=r({startPos:[s,c],endPos:[s+h,c],data:d,labelFilter:function(t,e){return e<d.length-1},labelFormatter:function(t){var e=t.time;return o?o(e):uG(e,i)}},a);return f},e.prototype.renderAxis=function(t){void 0===t&&(t=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(t))},e.prototype.renderController=function(t){void 0===t&&(t=this.space.controllerBBox);var e=this.attributes.type,n=this.states,i=n.state,o=n.speed,a=n.selectionType,s=n.chartType,l=GB(this.attributes,"controller"),u=this,c=r(r(r({},t),{iconSize:20,speed:o,state:i,selectionType:a,chartType:s,onChange:function(t,e){var n=e.value;switch(t){case"reset":u.internalReset();break;case"speed":u.handleSpeedChange(n);break;case"backward":u.internalBackward();break;case"playPause":"play"===n?u.internalPlay():u.internalPause();break;case"forward":u.internalForward();break;case"selectionType":u.handleSelectionTypeChange(n);break;case"chartType":u.handleChartTypeChange(n)}}}),l);"time"===e&&(c.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(c)},e.prototype.dispatchOnChange=function(t){var e=this.data,n=this.attributes.onChange,r=this.states,i=r.values,o=r.selectionType,a=l(i,2),s=a[0],u=a[1],c=u===1/0?e.at(-1).time:u;t&&function(t,e){if(Array.isArray(t)){if(!Array.isArray(e))return!1;if(t[0]===e[0]){if(t[1]===e[1])return!0;if(t[1]===1/0||e[1]===1/0)return!0}return!1}return!Array.isArray(e)&&t===e}(t,"range"===o?[s,c]:c)||null==n||n("range"===o?[s,c]:c)},e.prototype.internalReset=function(t){var e,n,r=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===r?[0,1]:[0,0]),this.renderController(),this.updateSelection(),t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onReset)||void 0===n||n.call(e),this.dispatchOnChange())},e.prototype.reset=function(){this.internalReset()},e.prototype.moveSelection=function(t,e){var n=this.data,r=n.length,i=this.states,o=i.values,a=i.selectionType,s=i.playMode,u=l(o,2),c=u[0],h=u[1],d=n.findIndex((function(t){return t.time===c})),f=n.findIndex((function(t){return t.time===h}));-1===f&&(f=r);var p,g="backward"===t?-1:1;"range"===a?"acc"===s?(p=[d,f+g],-1===g&&d===f&&(p=[d,r])):p=[d+g,f+g]:p=[d,f+g];var v=function(t){var e=l(t.sort((function(t,e){return t-e})),2),n=e[0],i=e[1],o=function(t){return O(t,0,r)};return i>r?"value"===a?[0,0]:"acc"===s?[o(n),o(n)]:[0,o(i-n)]:n<0?"acc"===s?[0,o(i)]:[o(n+r-i),r]:[o(n),o(i)]}(p);return this.setByIndex(v),this.updateSelection(),v},e.prototype.internalBackward=function(t){var e,n,r=this.moveSelection("backward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onBackward)||void 0===n||n.call(e),this.dispatchOnChange()),r},e.prototype.backward=function(){this.internalBackward()},e.prototype.internalPlay=function(t){var e,n,r=this,i=this.data,o=this.attributes.loop,a=this.states.speed,s=void 0===a?1:a;this.playInterval=window.setInterval((function(){r.internalForward()[1]!==i.length||o||(r.internalPause(),r.renderController())}),1e3/s),this.states.state="play",!t&&(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPlay)||void 0===n||n.call(e))},e.prototype.play=function(){this.internalPlay()},e.prototype.internalPause=function(t){var e,n;clearInterval(this.playInterval),this.states.state="pause",!t&&(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPause)||void 0===n||n.call(e))},e.prototype.pause=function(){this.internalPause()},e.prototype.internalForward=function(t){var e,n,r=this.moveSelection("forward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onForward)||void 0===n||n.call(e),this.dispatchOnChange()),r},e.prototype.forward=function(){this.internalForward()},e.prototype.handleSpeedChange=function(t){var e,n;this.states.speed=t,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSpeedChange)||void 0===n||n.call(e,t)},e.prototype.handleSelectionTypeChange=function(t){var e,n;this.states.selectionType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSelectionTypeChange)||void 0===n||n.call(e,t)},e.prototype.handleChartTypeChange=function(t){var e,n;this.states.chartType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onChartTypeChange)||void 0===n||n.call(e,t)},e.prototype.render=function(){var t=this.space,e=t.axisBBox,n=t.controllerBBox,r=t.timelineBBox;this.renderController(n),this.renderAxis(e),this.renderChart(r),"play"===this.states.state&&this.internalPlay()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.internalPause(!0)},e.defaultOptions={style:{x:0,y:0,axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},e}(XB);class dG extends EL{static defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16};typePrefix="__data__";element=null;draw=!1;fieldMap={node:new Map,edge:new Map,combo:new Map};selectedItems=[];constructor(t,e){super(t,Object.assign({},dG.defaultOptions,e)),this.bindEvents()}update(t){super.update(t),this.clear(),this.createElement()}clear(){this.element?.destroy(),this.element=null,this.draw=!1}bindEvents=()=>{const{graph:t}=this.context;t.on(gN.AFTER_DRAW,this.createElement)};changeState=(t,e)=>{const{graph:n}=this.context,{typePrefix:r}=this,i=J(t,[r,"id"]),o=J(t,[r,"style","labelText"]),[a]=i.split("__"),s=this.fieldMap[a].get(o)||[];n.setElementState(Object.fromEntries(s?.map((t=>[t,e]))))};click=t=>{if("hover"===this.options.trigger)return;const e=J(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?(this.selectedItems=this.selectedItems.filter((t=>t!==e)),this.changeState(t,[])):(this.selectedItems.push(e),this.changeState(t,"selected"))};mouseleave=t=>{"click"!==this.options.trigger&&(this.selectedItems=[],this.changeState(t,[]))};mouseenter=t=>{if("click"===this.options.trigger)return;const e=J(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?this.selectedItems=this.selectedItems.filter((t=>t!==e)):(this.selectedItems.push(e),this.changeState(t,"active"))};updateElement(){if(!this.element)return;this.element.getChildByIndex(0).update({itemMarkerOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5,itemLabelOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5})}setFieldMap=(t,e,n)=>{if(!t)return;const r=this.fieldMap[n];if(r)if(r.has(t)){const n=r.get(t);n&&(n.push(e),r.set(t,n))}else r.set(t,[e])};getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click});getMarkerData=(t,e)=>{if(!t)return[];const{model:n,element:r,graph:i}=this.context,{nodes:o,edges:a,combos:s}=n.getData(),l={},u=e=>E(t)?t(e):t,c={node:"circle",edge:"line",combo:"rect"},h={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},d=(t,e)=>{t.forEach((t=>{const{id:n}=t,i=J(t,["data",u(t)]),o=r?.getElementType(e,t)||"circle",a=((t,e)=>{const n=r?.getElementComputedStyle(t,e);return n})(e,t),s=("edge"===e?a?.stroke:a?.fill)||"#1783ff";n&&i&&i.replace(/\s+/g,"")&&(this.setFieldMap(i,n,e),l[i]||(l[i]={id:`${e}__${n}`,label:i,marker:h[o]||c[e],elementType:e,lineWidth:1,stroke:s,fill:s}))}))};switch(e){case"node":d(o,"node");break;case"edge":d(a,"edge");break;case"combo":d(s,"combo");break;default:return[]}return Object.values(l)};layout=t=>{let{flexDirection:e,alignItems:n,justifyContent:r}={flexDirection:"row",alignItems:"flex-end",justifyContent:"center"};const i={top:["row","flex-start","center"],bottom:["row","flex-end","center"],left:["column","flex-start","center"],right:["column","flex-end","center"]};return t in i&&([e,n,r]=i[t]),{display:"flex",flexDirection:e,justifyContent:r,alignItems:n}};createElement=()=>{if(this.draw)return void this.updateElement();const{canvas:t}=this.context,[e,n]=t.getSize(),{width:r=e,height:i=n,nodeField:o,edgeField:a,comboField:s,trigger:l,position:u,...c}=this.options,h=this.getMarkerData(o,"node"),d=this.getMarkerData(a,"edge"),f=this.getMarkerData(s,"combo"),p=[...h,...f,...d],g=this.layout(u),v=new FU({style:{width:r,height:i,...g}}),m=Object.assign({width:r,height:i,data:p,itemMarkerLineWidth:({lineWidth:t})=>t,itemMarker:({marker:t})=>t,itemMarkerStroke:({stroke:t})=>t,itemMarkerFill:({fill:t})=>t,gridCol:h.length},c,this.getEvents()),y=new NU({className:"legend",style:m});v.appendChild(y),t.appendChild(v),this.element=v,this.draw=!0};destroy(){this.clear(),this.context.graph.off(gN.AFTER_DRAW,this.createElement),super.destroy()}}function fG(t,e){var n=e.cx,r=void 0===n?0:n,i=e.cy,o=void 0===i?0:i,a=e.r;t.arc(r,o,a,0,2*Math.PI,!1)}function pG(t,e){var n=e.cx,r=void 0===n?0:n,i=e.cy,o=void 0===i?0:i,a=e.rx,s=e.ry;if(t.ellipse)t.ellipse(r,o,a,s,0,0,2*Math.PI,!1);else{var l=a>s?a:s,u=a>s?1:a/s,c=a>s?s/a:1;t.save(),t.scale(u,c),t.arc(r,o,l,0,2*Math.PI)}}function gG(t,e){var n,r,i=e.x1,o=e.y1,a=e.x2,s=e.y2,l=e.markerStart,u=e.markerEnd,c=e.markerStartOffset,h=e.markerEndOffset,d=0,f=0,p=0,g=0,v=0;l&&Sw(l)&&c&&(n=a-i,r=s-o,v=Math.atan2(r,n),d=Math.cos(v)*(c||0),f=Math.sin(v)*(c||0)),u&&Sw(u)&&h&&(n=i-a,r=o-s,v=Math.atan2(r,n),p=Math.cos(v)*(h||0),g=Math.sin(v)*(h||0)),t.moveTo(i+d,o+f),t.lineTo(a+p,s+g)}function vG(t,e){var n,r,i=e.markerStart,o=e.markerEnd,a=e.markerStartOffset,s=e.markerEndOffset,u=e.d,c=u.absolutePath,h=u.segments,d=0,f=0,p=0,g=0,v=0;if(i&&Sw(i)&&a){var m=l(i.parentNode.getStartTangent(),2),y=m[0],E=m[1];n=y[0]-E[0],r=y[1]-E[1],v=Math.atan2(r,n),d=Math.cos(v)*(a||0),f=Math.sin(v)*(a||0)}if(o&&Sw(o)&&s){var _=l(o.parentNode.getEndTangent(),2);y=_[0],E=_[1];n=y[0]-E[0],r=y[1]-E[1],v=Math.atan2(r,n),p=Math.cos(v)*(s||0),g=Math.sin(v)*(s||0)}for(var b=0;b<c.length;b++){var x=c[b],S=x[0],M=c[b+1],A=0===b&&(0!==d||0!==f),R=(b===c.length-1||M&&("M"===M[0]||"Z"===M[0]))&&0!==p&&0!==g;switch(S){case"M":A?(t.moveTo(x[1]+d,x[2]+f),t.lineTo(x[1],x[2])):t.moveTo(x[1],x[2]);break;case"L":R?t.lineTo(x[1]+p,x[2]+g):t.lineTo(x[1],x[2]);break;case"Q":t.quadraticCurveTo(x[1],x[2],x[3],x[4]),R&&t.lineTo(x[3]+p,x[4]+g);break;case"C":t.bezierCurveTo(x[1],x[2],x[3],x[4],x[5],x[6]),R&&t.lineTo(x[5]+p,x[6]+g);break;case"A":var T=h[b].arcParams,w=T.cx,P=T.cy,N=T.rx,C=T.ry,O=T.startAngle,I=T.endAngle,L=T.xRotation,D=T.sweepFlag;if(t.ellipse)t.ellipse(w,P,N,C,L,O,I,!!(1-D));else{var B=N>C?N:C,k=N>C?1:N/C,F=N>C?C/N:1;t.translate(w,P),t.rotate(L),t.scale(k,F),t.arc(0,0,B,O,I,!!(1-D)),t.scale(1/k,1/F),t.rotate(-L),t.translate(-w,-P)}R&&t.lineTo(x[6]+p,x[7]+g);break;case"Z":t.closePath()}}}function mG(t,e){var n,r,i=e.markerStart,o=e.markerEnd,a=e.markerStartOffset,s=e.markerEndOffset,l=e.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],p=0,g=0,v=0,m=0,y=0;i&&Sw(i)&&a&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),p=Math.cos(y)*(a||0),g=Math.sin(y)*(a||0)),o&&Sw(o)&&s&&(n=l[u-1][0]-l[0][0],r=l[u-1][1]-l[0][1],y=Math.atan2(r,n),v=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),t.moveTo(c+(p||v),h+(g||m));for(var E=1;E<u-1;E++){var _=l[E];t.lineTo(_[0],_[1])}t.lineTo(d,f)}function yG(t,e){var n,r,i=e.markerStart,o=e.markerEnd,a=e.markerStartOffset,s=e.markerEndOffset,l=e.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],p=0,g=0,v=0,m=0,y=0;i&&Sw(i)&&a&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),p=Math.cos(y)*(a||0),g=Math.sin(y)*(a||0)),o&&Sw(o)&&s&&(n=l[u-2][0]-l[u-1][0],r=l[u-2][1]-l[u-1][1],y=Math.atan2(r,n),v=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),t.moveTo(c+p,h+g);for(var E=1;E<u-1;E++){var _=l[E];t.lineTo(_[0],_[1])}t.lineTo(d+v,f+m)}function EG(t,e){var n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.radius,s=e.width,u=e.height,c=s,h=u;if(a&&a.some((function(t){return 0!==t}))){var d=s>0?1:-1,f=u>0?1:-1,p=d+f===0,g=l(a.map((function(t){return O(t,0,Math.min(Math.abs(c)/2,Math.abs(h)/2))})),4),v=g[0],m=g[1],y=g[2],E=g[3];t.moveTo(d*v+r,o),t.lineTo(c-d*m+r,o),0!==m&&t.arc(c-d*m+r,f*m+o,m,-f*Math.PI/2,d>0?0:Math.PI,p),t.lineTo(c+r,h-f*y+o),0!==y&&t.arc(c-d*y+r,h-f*y+o,y,d>0?0:Math.PI,f>0?Math.PI/2:1.5*Math.PI,p),t.lineTo(d*E+r,h+o),0!==E&&t.arc(d*E+r,h-f*E+o,E,f>0?Math.PI/2:-Math.PI/2,d>0?Math.PI:0,p),t.lineTo(r,f*v+o),0!==v&&t.arc(d*v+r,f*v+o,v,d>0?Math.PI:0,f>0?1.5*Math.PI:Math.PI/2,p)}else t.rect(r,o,c,h)}var _G=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="canvas-path-generator",e}return n(e,t),e.prototype.init=function(){var t,e=((t={})[$S.CIRCLE]=fG,t[$S.ELLIPSE]=pG,t[$S.RECT]=EG,t[$S.LINE]=gG,t[$S.POLYLINE]=yG,t[$S.POLYGON]=mG,t[$S.PATH]=vG,t[$S.TEXT]=void 0,t[$S.GROUP]=void 0,t[$S.IMAGE]=void 0,t[$S.HTML]=void 0,t[$S.MESH]=void 0,t);this.context.pathGeneratorFactory=e},e.prototype.destroy=function(){delete this.context.pathGeneratorFactory},e}(QS),bG=Xt(),xG=Xt(),SG=Xt(),MG=ct(),AG=function(){function t(){var t=this;this.isHit=function(e,n,r,i){var o=t.context.pointInPathPickerFactory[e.nodeName];if(o){var a=mt(MG,r),s=oe(xG,Zt(SG,n[0],n[1],0),a);if(o(e,new MM(s[0],s[1]),i,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var r=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),i=t.context.pathGeneratorFactory[e.nodeName];return i&&(r.beginPath(),i(r,e.parsedStyle),r.closePath()),r.isPointInPath(n.x,n.y)}}return t.prototype.apply=function(e,n){var r,i=this,s=e.renderingService,l=e.renderingContext;this.context=e,this.runtime=n;var u=null===(r=l.root)||void 0===r?void 0:r.ownerDocument;s.hooks.pick.tapPromise(t.tag,(function(t){return o(i,void 0,void 0,(function(){return a(this,(function(e){return[2,this.pick(u,t)]}))}))})),s.hooks.pickSync.tap(t.tag,(function(t){return i.pick(u,t)}))},t.prototype.pick=function(t,e){var n,r,i=e.topmost,o=e.position,a=o.x,l=o.y,u=Zt(bG,a,l,0),c=t.elementsFromBBox(u[0],u[1],u[0],u[1]),h=[];try{for(var d=s(c),f=d.next();!f.done;f=d.next()){var p=f.value,g=p.getWorldTransform();if(this.isHit(p,u,g,!1)){var v=sT(p);if(v){var m=v.parsedStyle.clipPath;if(this.isHit(m,u,m.getWorldTransform(),!0)){if(i)return e.picked=[p],e;h.push(p)}}else{if(i)return e.picked=[p],e;h.push(p)}}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return e.picked=h,e},t.tag="CanvasPicker",t}();function RG(t,e,n){var r=t.parsedStyle,i=r.cx,o=void 0===i?0:i,a=r.cy,s=void 0===a?0:a,u=r.r,c=r.fill,h=r.stroke,d=r.lineWidth,f=void 0===d?1:d,p=r.increasedLineWidthForHitTesting,g=void 0===p?0:p,v=r.pointerEvents,m=void 0===v?"auto":v,y=(f+g)/2,E=PS(o,s,e.x,e.y),_=l(dT(m,c,h),2),b=_[0],x=_[1];return b&&x||n?E<=u+y:b?E<=u:!!x&&(E>=u-y&&E<=u+y)}function TG(t,e,n,r){return t/(n*n)+e/(r*r)}function wG(t,e,n){var r=t.parsedStyle,i=r.cx,o=void 0===i?0:i,a=r.cy,s=void 0===a?0:a,u=r.rx,c=r.ry,h=r.fill,d=r.stroke,f=r.lineWidth,p=void 0===f?1:f,g=r.increasedLineWidthForHitTesting,v=void 0===g?0:g,m=r.pointerEvents,y=void 0===m?"auto":m,E=e.x,_=e.y,b=l(dT(y,h,d),2),x=b[0],S=b[1],M=(p+v)/2,A=(E-o)*(E-o),R=(_-s)*(_-s);return x&&S||n?TG(A,R,u+M,c+M)<=1:x?TG(A,R,u,c)<=1:!!S&&(TG(A,R,u-M,c-M)>=1&&TG(A,R,u+M,c+M)<=1)}function PG(t,e,n,r,i,o){return i>=t&&i<=t+n&&o>=e&&o<=e+r}function NG(t,e,n,r,i,o,a,s){var l=(Math.atan2(s-e,a-t)+2*Math.PI)%(2*Math.PI),u={x:t+n*Math.cos(l),y:e+n*Math.sin(l)};return PS(u.x,u.y,a,s)<=o/2}function CG(t,e,n,r,i,o,a){var s=Math.min(t,n),l=Math.max(t,n),u=Math.min(e,r),c=Math.max(e,r),h=i/2;return o>=s-h&&o<=l+h&&a>=u-h&&a<=c+h&&FS(t,e,n,r,o,a)<=i/2}function OG(t,e,n,r,i){var o=t.length;if(o<2)return!1;for(var a=0;a<o-1;a++){if(CG(t[a][0],t[a][1],t[a+1][0],t[a+1][1],e,n,r))return!0}if(i){var s=t[0],l=t[o-1];if(CG(s[0],s[1],l[0],l[1],e,n,r))return!0}return!1}var IG=1e-6;function LG(t){return Math.abs(t)<IG?0:t<0?-1:1}function DG(t,e,n){return(n[0]-t[0])*(e[1]-t[1])==(e[0]-t[0])*(n[1]-t[1])&&Math.min(t[0],e[0])<=n[0]&&n[0]<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=n[1]&&n[1]<=Math.max(t[1],e[1])}function BG(t,e,n){var r=!1,i=t.length;if(i<=2)return!1;for(var o=0;o<i;o++){var a=t[o],s=t[(o+1)%i];if(DG(a,s,[e,n]))return!0;LG(a[1]-n)>0!=LG(s[1]-n)>0&&LG(e-(n-a[1])*(a[0]-s[0])/(a[1]-s[1])-a[0])<0&&(r=!r)}return r}function kG(t,e,n){for(var r=!1,i=0;i<t.length;i++){if(r=BG(t[i],e,n))break}return r}function FG(t,e,n){var r=t.parsedStyle,i=r.x1,o=r.y1,a=r.x2,s=r.y2,u=r.lineWidth,c=void 0===u?1:u,h=r.increasedLineWidthForHitTesting,d=void 0===h?0:h,f=r.pointerEvents;return!(!l(dT(void 0===f?"auto":f,r.fill,r.stroke),2)[1]&&!n||!c)&&CG(i,o,a,s,c+d,e.x,e.y)}function UG(t,e,n,r,i,o){var a=t.parsedStyle,s=a.lineWidth,u=void 0===s?1:s,c=a.increasedLineWidthForHitTesting,h=void 0===c?0:c,d=a.stroke,f=a.fill,p=a.d,g=a.pointerEvents,v=void 0===g?"auto":g,m=p.segments,y=p.hasArc,E=p.polylines,_=p.polygons,b=l(dT(v,(null==_?void 0:_.length)&&f,d),2),x=b[0],S=b[1],M=ZA(t),A=!1;return x||n?A=y?r(t,e):kG(_,e.x,e.y)||kG(E,e.x,e.y):((S||n)&&(A=function(t,e,n,r,i){for(var o=!1,a=e/2,s=0;s<t.length;s++){var l=t[s],u=l.currentPoint,c=l.params,h=l.prePoint,d=l.box;if(!d||PG(d.x-a,d.y-a,d.width+e,d.height+e,n,r))switch(l.command){case"L":case"Z":if(o=CG(h[0],h[1],u[0],u[1],e,n,r))return!0;break;case"Q":if(o=YS(h[0],h[1],c[1],c[2],c[3],c[4],n,r)<=e/2)return!0;break;case"C":if(o=VS(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],n,r,i)<=e/2)return!0;break;case"A":l.cubicParams||(l.cubicParams=Ue(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],c[7],void 0));for(var f=l.cubicParams,p=h,g=0;g<f.length;g+=6){var v=VS(p[0],p[1],f[g],f[g+1],f[g+2],f[g+3],f[g+4],f[g+5],n,r,i);if(p=[f[g+4],f[g+5]],o=v<=e/2)return!0}}}return o}(m,u+h,e.x,e.y,M)),A)}function GG(t,e,n){var r=t.parsedStyle,i=r.stroke,o=r.fill,a=r.lineWidth,s=void 0===a?1:a,u=r.increasedLineWidthForHitTesting,c=void 0===u?0:u,h=r.points,d=r.pointerEvents,f=l(dT(void 0===d?"auto":d,o,i),2),p=f[0],g=!1;return(f[1]||n)&&(g=OG(h.points,s+c,e.x,e.y,!0)),g||!p&&!n||(g=BG(h.points,e.x,e.y)),g}function zG(t,e,n){var r=t.parsedStyle,i=r.lineWidth,o=void 0===i?1:i,a=r.increasedLineWidthForHitTesting,s=void 0===a?0:a,u=r.points,c=r.pointerEvents;return!(!l(dT(void 0===c?"auto":c,r.fill,r.stroke),2)[1]&&!n||!o)&&OG(u.points,o+s,e.x,e.y,!1)}function VG(t,e,n,r,i){var o=t.parsedStyle,a=o.radius,s=o.fill,u=o.stroke,c=o.lineWidth,h=void 0===c?1:c,d=o.increasedLineWidthForHitTesting,f=void 0===d?0:d,p=o.x,g=void 0===p?0:p,v=o.y,m=void 0===v?0:v,y=o.width,E=o.height,_=o.pointerEvents,b=l(dT(void 0===_?"auto":_,s,u),2),x=b[0],S=b[1],M=h+f;if(a&&a.some((function(t){return 0!==t}))){var A=!1;return(S||n)&&(A=function(t,e,n,r,i,o,a,s){var u=l(i,4),c=u[0],h=u[1],d=u[2],f=u[3];return CG(t+c,e,t+n-h,e,o,a,s)||CG(t+n,e+h,t+n,e+r-d,o,a,s)||CG(t+n-d,e+r,t+f,e+r,o,a,s)||CG(t,e+r-f,t,e+c,o,a,s)||NG(t+n-h,e+h,h,Math.PI,Math.PI,o,a,s)||NG(t+n-d,e+r-d,d,0,Math.PI,o,a,s)||NG(t+f,e+r-f,f,Math.PI,Math.PI,o,a,s)||NG(t+c,e+c,c,Math.PI,Math.PI,o,a,s)}(g,m,y,E,a.map((function(t){return O(t,0,Math.min(Math.abs(y)/2,Math.abs(E)/2))})),M,e.x,e.y)),A||!x&&!n||(A=r(t,e)),A}var R=M/2;return x&&S||n?PG(g-R,m-R,y+R,E+R,e.x,e.y):x?PG(g,m,y,E,e.x,e.y):!!S&&function(t,e,n,r,i,o,a){var s=i/2;return PG(t-s,e-s,n,i,o,a)||PG(t+n-s,e-s,i,r,o,a)||PG(t+s,e+r-s,n,i,o,a)||PG(t-s,e+s,i,r,o,a)}(g,m,y,E,M,e.x,e.y)}function WG(t,e,n,i,o,a){var s=t.parsedStyle,l=s.pointerEvents,u=void 0===l?"auto":l,c=s.x,h=void 0===c?0:c,d=s.y,f=void 0===d?0:d,p=s.width,g=s.height;if("non-transparent-pixel"===u){var v=o.config.offscreenCanvas,m=a.offscreenCanvasCreator.getOrCreateCanvas(v),y=a.offscreenCanvasCreator.getOrCreateContext(v,{willReadFrequently:!0});return m.width=p,m.height=g,o.defaultStyleRendererFactory[$S.IMAGE].render(y,r(r({},t.parsedStyle),{x:0,y:0}),t,void 0,void 0,void 0),y.getImageData(e.x-h,e.y-f,1,1).data.every((function(t){return 0!==t}))}return!0}var jG=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="canvas-picker",e}return n(e,t),e.prototype.init=function(){var t,e=((t={})[$S.CIRCLE]=RG,t[$S.ELLIPSE]=wG,t[$S.RECT]=VG,t[$S.LINE]=FG,t[$S.POLYLINE]=zG,t[$S.POLYGON]=GG,t[$S.PATH]=UG,t[$S.TEXT]=function(){return!0},t[$S.GROUP]=null,t[$S.IMAGE]=WG,t[$S.HTML]=null,t[$S.MESH]=null,t);this.context.pointInPathPickerFactory=e,this.addRenderingPlugin(new AG)},e.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},e}(QS),HG=function(){function t(t){this.canvasRendererPluginOptions=t,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreenLastFrame=!1,this.clearFullScreen=!1,this.vpMatrix=ct(),this.dprMatrix=ct(),this.tmpMat4=ct(),this.vec3a=Xt(),this.vec3b=Xt(),this.vec3c=Xt(),this.vec3d=Xt()}return t.prototype.apply=function(e,n){var r=this;this.context=e;var i=e.config,o=e.camera,a=e.renderingService,s=e.renderingContext,c=e.rBushRoot,h=e.pathGeneratorFactory;this.rBush=c,this.pathGeneratorFactory=h;var d=e.contextService,f=s.root.ownerDocument.defaultView,p=function(t){var e=t.target.rBushNode;e.aabb&&r.removedRBushNodeAABBs.push(e.aabb)},g=function(t){var e=t.target.rBushNode;e.aabb&&r.removedRBushNodeAABBs.push(e.aabb)};a.hooks.init.tap(t.tag,(function(){f.addEventListener(nw.UNMOUNTED,p),f.addEventListener(nw.CULLED,g);var t=d.getDPR(),e=i.width,n=i.height,o=d.getContext();r.clearRect(o,0,0,e*t,n*t,i.background)})),a.hooks.destroy.tap(t.tag,(function(){f.removeEventListener(nw.UNMOUNTED,p),f.removeEventListener(nw.CULLED,g),r.renderQueue=[],r.removedRBushNodeAABBs=[],r.restoreStack=[]})),a.hooks.beginFrame.tap(t.tag,(function(){var t,e=d.getContext(),n=d.getDPR(),o=i.width,s=i.height,l=r.canvasRendererPluginOptions,u=l.dirtyObjectNumThreshold,c=l.dirtyObjectRatioThreshold,h=a.getStats(),p=h.total,g=h.rendered,v=g/p;r.clearFullScreen=r.clearFullScreenLastFrame||!(null===(t=f.context.renderingPlugins[1])||void 0===t?void 0:t.isFirstTimeRenderingFinished)||a.disableDirtyRectangleRendering()||g>u&&v>c,e&&(e.resetTransform?e.resetTransform():e.setTransform(1,0,0,1,0,0),r.clearFullScreen&&r.clearRect(e,0,0,o*n,s*n,i.background))}));var v=function(t,e){t.isVisible()&&!t.isCulled()&&r.renderDisplayObject(t,e,r.context,r.restoreStack,n),(t.sortable.sorted||t.childNodes).forEach((function(t){v(t,e)}))};a.hooks.endFrame.tap(t.tag,(function(){if(0!==s.root.childNodes.length){r.clearFullScreenLastFrame=!1;var t=d.getContext(),e=d.getDPR();if(At(r.dprMatrix,[e,e,1]),Et(r.vpMatrix,r.dprMatrix,o.getOrthoMatrix()),r.clearFullScreen)v(s.root,t);else{var a=r.safeMergeAABB.apply(r,u([r.mergeDirtyAABBs(r.renderQueue)],l(r.removedRBushNodeAABBs.map((function(t){var e=t.minX,n=t.minY,r=t.maxX,i=t.maxY,o=new yM;return o.setMinMax([e,n,0],[r,i,0]),o}))),!1));if(r.removedRBushNodeAABBs=[],yM.isEmpty(a))return void(r.renderQueue=[]);var c=r.convertAABB2Rect(a),h=c.x,p=c.y,g=c.width,m=c.height,y=oe(r.vec3a,[h,p,0],r.vpMatrix),E=oe(r.vec3b,[h+g,p,0],r.vpMatrix),_=oe(r.vec3c,[h,p+m,0],r.vpMatrix),b=oe(r.vec3d,[h+g,p+m,0],r.vpMatrix),x=Math.min(y[0],E[0],b[0],_[0]),S=Math.min(y[1],E[1],b[1],_[1]),M=Math.max(y[0],E[0],b[0],_[0]),A=Math.max(y[1],E[1],b[1],_[1]),R=Math.floor(x),T=Math.floor(S),w=Math.ceil(M-x),P=Math.ceil(A-S);t.save(),r.clearRect(t,R,T,w,P,i.background),t.beginPath(),t.rect(R,T,w,P),t.clip(),t.setTransform(r.vpMatrix[0],r.vpMatrix[1],r.vpMatrix[4],r.vpMatrix[5],r.vpMatrix[12],r.vpMatrix[13]),i.renderer.getConfig().enableDirtyRectangleRenderingDebug&&f.dispatchEvent(new ZT(Mw.DIRTY_RECTANGLE,{dirtyRect:{x:R,y:T,width:w,height:P}})),r.searchDirtyObjects(a).sort((function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder})).forEach((function(e){e&&e.isVisible()&&!e.isCulled()&&r.renderDisplayObject(e,t,r.context,r.restoreStack,n)})),t.restore(),r.renderQueue.forEach((function(t){r.saveDirtyAABB(t)})),r.renderQueue=[]}r.restoreStack.forEach((function(){t.restore()})),r.restoreStack=[]}else r.clearFullScreenLastFrame=!0})),a.hooks.render.tap(t.tag,(function(t){r.clearFullScreen||r.renderQueue.push(t)}))},t.prototype.clearRect=function(t,e,n,r,i,o){t.clearRect(e,n,r,i),o&&(t.fillStyle=o,t.fillRect(e,n,r,i))},t.prototype.renderDisplayObject=function(t,e,n,r,i){var o=t.nodeName,a=r[r.length-1];!a||t.compareDocumentPosition(a)&JT.DOCUMENT_POSITION_CONTAINS||(e.restore(),r.pop());var s=this.context.styleRendererFactory[o],l=this.pathGeneratorFactory[o],u=t.parsedStyle.clipPath;if(u){this.applyWorldTransform(e,u);var c=this.pathGeneratorFactory[u.nodeName];c&&(e.save(),r.push(t),e.beginPath(),c(e,u.parsedStyle),e.closePath(),e.clip())}s&&(this.applyWorldTransform(e,t),e.save(),this.applyAttributesToContext(e,t)),l&&(e.beginPath(),l(e,t.parsedStyle),t.nodeName!==$S.LINE&&t.nodeName!==$S.PATH&&t.nodeName!==$S.POLYLINE&&e.closePath()),s&&(s.render(e,t.parsedStyle,t,n,this,i),e.restore()),t.renderable.dirty=!1},t.prototype.convertAABB2Rect=function(t){var e=t.getMin(),n=t.getMax(),r=Math.floor(e[0]),i=Math.floor(e[1]);return{x:r,y:i,width:Math.ceil(n[0])-r,height:Math.ceil(n[1])-i}},t.prototype.mergeDirtyAABBs=function(t){var e=new yM;return t.forEach((function(t){var n=t.getRenderBounds();e.add(n);var r=t.renderable.dirtyRenderBounds;r&&e.add(r)})),e},t.prototype.searchDirtyObjects=function(t){var e=l(t.getMin(),2),n=e[0],r=e[1],i=l(t.getMax(),2),o=i[0],a=i[1];return this.rBush.search({minX:n,minY:r,maxX:o,maxY:a}).map((function(t){return t.displayObject}))},t.prototype.saveDirtyAABB=function(t){var e=t.renderable;e.dirtyRenderBounds||(e.dirtyRenderBounds=new yM);var n=t.getRenderBounds();n&&e.dirtyRenderBounds.update(n.center,n.halfExtents)},t.prototype.applyAttributesToContext=function(t,e){var n=e.parsedStyle,r=n.stroke,i=n.fill,o=n.opacity,a=n.lineDash,s=n.lineDashOffset;a&&t.setLineDash(a),_(s)||(t.lineDashOffset=s),_(o)||(t.globalAlpha*=o),_(r)||Array.isArray(r)||r.isNone||(t.strokeStyle=e.attributes.stroke),_(i)||Array.isArray(i)||i.isNone||(t.fillStyle=e.attributes.fill)},t.prototype.applyWorldTransform=function(t,e,n){n?(dt(this.tmpMat4,e.getLocalTransform()),Et(this.tmpMat4,n,this.tmpMat4),Et(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(dt(this.tmpMat4,e.getWorldTransform()),Et(this.tmpMat4,this.vpMatrix,this.tmpMat4)),t.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},t.prototype.safeMergeAABB=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=new yM;return t.forEach((function(t){n.add(t)})),n},t.tag="CanvasRenderer",t}(),XG=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n,r,i,o){var a=e.fill,s=e.fillRule,l=e.opacity,u=void 0===l?1:l,c=e.fillOpacity,h=void 0===c?1:c,d=e.stroke,f=e.strokeOpacity,p=void 0===f?1:f,g=e.lineWidth,v=void 0===g?1:g,m=e.lineCap,y=e.lineJoin,E=e.shadowType,b=e.shadowColor,x=e.shadowBlur,S=e.filter,M=e.miterLimit,A=a&&!a.isNone,R=d&&!d.isNone&&v>0,T=0===(null==a?void 0:a.alpha),w=!(!S||!S.length),P=!_(b)&&x>0,N=n.nodeName,C="inner"===E,O=R&&P&&(N===$S.PATH||N===$S.LINE||N===$S.POLYLINE||T||C);A&&(t.globalAlpha=u*h,O||YG(n,t,P),qG(t,n,a,s,r,i,o,this.imagePool),O||this.clearShadowAndFilter(t,w,P)),R&&(t.globalAlpha=u*p,t.lineWidth=v,_(M)||(t.miterLimit=M),_(m)||(t.lineCap=m),_(y)||(t.lineJoin=y),O&&(C&&(t.globalCompositeOperation="source-atop"),YG(n,t,!0),C&&(ZG(t,n,d,r,i,o,this.imagePool),t.globalCompositeOperation="source-over",this.clearShadowAndFilter(t,w,!0))),ZG(t,n,d,r,i,o,this.imagePool))},t.prototype.clearShadowAndFilter=function(t,e,n){if(n&&(t.shadowColor="transparent",t.shadowBlur=0),e){var r=t.filter;!_(r)&&r.indexOf("drop-shadow")>-1&&(t.filter=r.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},t}();function YG(t,e,n){var r=t.parsedStyle,i=r.filter,o=r.shadowColor,a=r.shadowBlur,s=r.shadowOffsetX,l=r.shadowOffsetY;i&&i.length&&(e.filter=t.style.filter),n&&(e.shadowColor=o.toString(),e.shadowBlur=a||0,e.shadowOffsetX=s||0,e.shadowOffsetY=l||0)}function KG(t,e,n,r,i,o,a){var s,l;if("rect"===t.image.nodeName){var u=t.image.parsedStyle,c=u.width,h=u.height;l=r.contextService.getDPR();var d=r.config.offscreenCanvas;(s=o.offscreenCanvasCreator.getOrCreateCanvas(d)).width=c*l,s.height=h*l;var f=o.offscreenCanvasCreator.getOrCreateContext(d),p=[];t.image.forEach((function(t){i.renderDisplayObject(t,f,r,p,o)})),p.forEach((function(){f.restore()}))}return a.getOrCreatePatternSync(t,n,s,l,e.getGeometryBounds().min,(function(){e.renderable.dirty=!0,r.renderingService.dirtify()}))}function $G(t,e,n,i){var o;if(t.type===UM.LinearGradient||t.type===UM.RadialGradient){var a=e.getGeometryBounds(),s=a&&2*a.halfExtents[0]||1,l=a&&2*a.halfExtents[1]||1,u=a&&a.min||[0,0];o=i.getOrCreateGradient(r(r({type:t.type},t.value),{min:u,width:s,height:l}),n)}return o}function qG(t,e,n,r,i,o,a,s,l){void 0===l&&(l=!1),Array.isArray(n)?n.forEach((function(n){t.fillStyle=$G(n,e,t,s),l||(r?t.fill(r):t.fill())})):(TA(n)&&(t.fillStyle=KG(n,e,t,i,o,a,s)),l||(r?t.fill(r):t.fill()))}function ZG(t,e,n,r,i,o,a,s){void 0===s&&(s=!1),Array.isArray(n)?n.forEach((function(n){t.strokeStyle=$G(n,e,t,a),s||t.stroke()})):(TA(n)&&(t.strokeStyle=KG(n,e,t,r,i,o,a)),s||t.stroke())}var QG=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n){var r,i=e.x,o=void 0===i?0:i,a=e.y,s=void 0===a?0:a,l=e.width,u=e.height,c=e.src,h=e.shadowColor,d=e.shadowBlur,f=l,p=u;if(N(c)?r=this.imagePool.getImageSync(c):(f||(f=c.width),p||(p=c.height),r=c),r){YG(n,t,!_(h)&&d>0);try{t.drawImage(r,o,s,f,p)}catch(t){}}},t}(),JG=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n,r,i,o){n.getBounds();var a=e,s=a.lineWidth,l=void 0===s?1:s,u=a.textAlign,c=void 0===u?"start":u,h=a.textBaseline,d=void 0===h?"alphabetic":h,f=a.lineJoin,p=void 0===f?"miter":f,g=a.miterLimit,v=void 0===g?10:g,m=a.letterSpacing,y=void 0===m?0:m,E=a.stroke,b=a.fill,x=a.fillRule,S=a.fillOpacity,M=void 0===S?1:S,A=a.strokeOpacity,R=void 0===A?1:A,T=a.opacity,w=void 0===T?1:T,P=a.metrics,N=a.x,C=void 0===N?0:N,O=a.y,I=void 0===O?0:O,L=a.dx,D=a.dy,B=a.shadowColor,k=a.shadowBlur,F=P.font,U=P.lines,G=P.height,z=P.lineHeight,V=P.lineMetrics;t.font=F,t.lineWidth=l,t.textAlign="middle"===c?"center":c;var W=d;o.enableCSSParsing||"alphabetic"!==W||(W="bottom"),t.lineJoin=p,_(v)||(t.miterLimit=v);var j=I;"middle"===d?j+=-G/2-z/2:"bottom"===d||"alphabetic"===d||"ideographic"===d?j+=-G:"top"!==d&&"hanging"!==d||(j+=-z);var H=C+(L||0);j+=D||0,1===U.length&&("bottom"===W?(W="middle",j-=.5*G):"top"===W&&(W="middle",j+=.5*G)),t.textBaseline=W,YG(n,t,!_(B)&&k>0);for(var X=0;X<U.length;X++){var Y=l/2+H;j+=z,_(E)||E.isNone||!l||this.drawLetterSpacing(t,n,U[X],V[X],c,Y,j,y,b,x,M,E,R,w,!0,r,i,o),_(b)||this.drawLetterSpacing(t,n,U[X],V[X],c,Y,j,y,b,x,M,E,R,w,!1,r,i,o)}},t.prototype.drawLetterSpacing=function(t,e,n,r,i,o,a,s,l,u,c,h,d,f,p,g,v,m){if(0!==s){var y=t.textAlign;t.textAlign="left";var E=o;"center"===i||"middle"===i?E=o-r.width/2:"right"!==i&&"end"!==i||(E=o-r.width);for(var _=Array.from(n),b=t.measureText(n).width,x=0,S=0;S<_.length;++S){var M=_[S];p?this.strokeText(t,e,M,E,a,h,d,g,v,m):this.fillText(t,e,M,E,a,l,u,c,f,g,v,m),E+=b-(x=t.measureText(n.substring(S+1)).width)+s,b=x}t.textAlign=y}else p?this.strokeText(t,e,n,o,a,h,d,g,v,m):this.fillText(t,e,n,o,a,l,u,c,f,g,v,m)},t.prototype.fillText=function(t,e,n,r,i,o,a,s,l,u,c,h){var d;qG(t,e,o,a,u,c,h,this.imagePool,!0);var f=!_(s)&&1!==s;f&&(d=t.globalAlpha,t.globalAlpha=s*l),t.fillText(n,r,i),f&&(t.globalAlpha=d)},t.prototype.strokeText=function(t,e,n,r,i,o,a,s,l,u){var c;ZG(t,e,o,s,l,u,this.imagePool,!0);var h=!_(a)&&1!==a;h&&(c=t.globalAlpha,t.globalAlpha=a),t.strokeText(n,r,i),h&&(t.globalAlpha=c)},t}();!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t)}(XG);var tz=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="canvas-renderer",n}return n(e,t),e.prototype.init=function(){var t,e=r({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),n=this.context.imagePool,i=new XG(n),o=((t={})[$S.CIRCLE]=i,t[$S.ELLIPSE]=i,t[$S.RECT]=i,t[$S.IMAGE]=new QG(n),t[$S.TEXT]=new JG(n),t[$S.LINE]=i,t[$S.POLYLINE]=i,t[$S.POLYGON]=i,t[$S.PATH]=i,t[$S.GROUP]=void 0,t[$S.HTML]=void 0,t[$S.MESH]=void 0,t);this.context.defaultStyleRendererFactory=o,this.context.styleRendererFactory=o,this.addRenderingPlugin(new HG(e))},e.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},e}(QS),ez=function(){function t(){}return t.prototype.apply=function(e,n){var r=this,i=e.renderingService,o=e.renderingContext,a=e.config;this.context=e;var s=o.root.ownerDocument.defaultView,l=function(t){i.hooks.pointerMove.call(t)},u=function(t){i.hooks.pointerUp.call(t)},c=function(t){i.hooks.pointerDown.call(t)},h=function(t){i.hooks.pointerOver.call(t)},d=function(t){i.hooks.pointerOut.call(t)},f=function(t){i.hooks.pointerCancel.call(t)},p=function(t){i.hooks.pointerWheel.call(t)},g=function(t){i.hooks.click.call(t)};i.hooks.init.tap(t.tag,(function(){var t=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="none",t.style.msTouchAction="none"):s.supportsPointerEvents&&(t.style.touchAction="none"),s.supportsPointerEvents?function(t){n.globalThis.document.addEventListener("pointermove",l,!0),t.addEventListener("pointerdown",c,!0),t.addEventListener("pointerleave",d,!0),t.addEventListener("pointerover",h,!0),n.globalThis.addEventListener("pointerup",u,!0),n.globalThis.addEventListener("pointercancel",f,!0)}(t):function(t){n.globalThis.document.addEventListener("mousemove",l,!0),t.addEventListener("mousedown",c,!0),t.addEventListener("mouseout",d,!0),t.addEventListener("mouseover",h,!0),n.globalThis.addEventListener("mouseup",u,!0)}(t),s.supportsTouchEvents&&function(t){t.addEventListener("touchstart",c,!0),t.addEventListener("touchend",u,!0),t.addEventListener("touchmove",l,!0),t.addEventListener("touchcancel",f,!0)}(t),a.useNativeClickEvent&&t.addEventListener("click",g,!0),t.addEventListener("wheel",p,{passive:!0,capture:!0})})),i.hooks.destroy.tap(t.tag,(function(){var t=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="",t.style.msTouchAction=""):s.supportsPointerEvents&&(t.style.touchAction=""),s.supportsPointerEvents?function(t){n.globalThis.document.removeEventListener("pointermove",l,!0),t.removeEventListener("pointerdown",c,!0),t.removeEventListener("pointerleave",d,!0),t.removeEventListener("pointerover",h,!0),n.globalThis.removeEventListener("pointerup",u,!0)}(t):function(t){n.globalThis.document.removeEventListener("mousemove",l,!0),t.removeEventListener("mousedown",c,!0),t.removeEventListener("mouseout",d,!0),t.removeEventListener("mouseover",h,!0),n.globalThis.removeEventListener("mouseup",u,!0)}(t),s.supportsTouchEvents&&function(t){t.removeEventListener("touchstart",c,!0),t.removeEventListener("touchend",u,!0),t.removeEventListener("touchmove",l,!0),t.removeEventListener("touchcancel",f,!0)}(t),a.useNativeClickEvent&&t.removeEventListener("click",g,!0),t.removeEventListener("wheel",p,!0)}))},t.tag="DOMInteraction",t}(),nz=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="dom-interaction",e}return n(e,t),e.prototype.init=function(){this.addRenderingPlugin(new ez)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(QS),rz=function(){function t(){this.displayObjectHTMLElementMap=new WeakMap}return t.prototype.joinTransformMatrix=function(t){return"matrix(".concat([t[0],t[1],t[4],t[5],t[12],t[13]].join(","),")")},t.prototype.apply=function(e,n){var r=this,i=e.camera,o=e.renderingContext,a=e.renderingService;this.context=e;var s=o.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,u=function(t,e){e.style.transform=r.joinTransformMatrix(t.getWorldTransform())},c=function(t){var e=t.target;if(e.nodeName===$S.HTML){r.$camera||(r.$camera=r.createCamera(i));var o=r.getOrCreateEl(e);if(r.$camera.appendChild(o),n.enableCSSParsing){var a=e.ownerDocument.documentElement.attributes;Object.keys(a).forEach((function(t){o.style[t]=a[t]}))}Object.keys(e.attributes).forEach((function(t){r.updateAttribute(t,e)})),u(e,o),l.set(o,e)}},h=function(t){var e=t.target;if(e.nodeName===$S.HTML&&r.$camera){var n=r.getOrCreateEl(e);n&&(n.remove(),l.delete(n))}},d=function(t){var e=t.target;if(e.nodeName===$S.HTML){var n=t.attrName;r.updateAttribute(n,e)}},f=function(t){var e=t.target;if(e.nodeName===$S.HTML){var n=r.getOrCreateEl(e);u(e,n)}},p=function(){if(r.$camera){var t=r.context.config,e=t.width,n=t.height;r.$camera.style.width="".concat(e||0,"px"),r.$camera.style.height="".concat(n||0,"px")}};a.hooks.init.tap(t.tag,(function(){s.addEventListener(Mw.RESIZE,p),s.addEventListener(nw.MOUNTED,c),s.addEventListener(nw.UNMOUNTED,h),s.addEventListener(nw.ATTR_MODIFIED,d),s.addEventListener(nw.BOUNDS_CHANGED,f)})),a.hooks.endFrame.tap(t.tag,(function(){r.$camera&&o.renderReasons.has(XT.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(i.getOrthoMatrix()))})),a.hooks.destroy.tap(t.tag,(function(){r.$camera&&r.$camera.remove(),s.removeEventListener(Mw.RESIZE,p),s.removeEventListener(nw.MOUNTED,c),s.removeEventListener(nw.UNMOUNTED,h),s.removeEventListener(nw.ATTR_MODIFIED,d),s.removeEventListener(nw.BOUNDS_CHANGED,f)}))},t.prototype.createCamera=function(t){var e=this.context.config,n=e.document,r=e.width,i=e.height,o=this.context.contextService.getDomElement(),a=o.parentNode;if(a){var s="g-canvas-camera",l=a.querySelector("#"+s);if(!l){var u=(n||document).createElement("div");l=u,u.id=s,u.style.position="absolute",u.style.left="".concat(o.offsetLeft||0,"px"),u.style.top="".concat(o.offsetTop||0,"px"),u.style.transformOrigin="left top",u.style.transform=this.joinTransformMatrix(t.getOrthoMatrix()),u.style.overflow="hidden",u.style.pointerEvents="none",u.style.width="".concat(r||0,"px"),u.style.height="".concat(i||0,"px"),a.appendChild(u)}return l}return null},t.prototype.getOrCreateEl=function(t){var e=this.context.config.document,n=this.displayObjectHTMLElementMap.get(t);return n||(n=(e||document).createElement("div"),t.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(t,n),t.id&&(n.id=t.id),t.name&&n.setAttribute("name",t.name),t.className&&(n.className=t.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(t.getWorldTransform())),n},t.prototype.updateAttribute=function(t,e){var n=this.getOrCreateEl(e);switch(t){case"innerHTML":var r=e.parsedStyle.innerHTML;N(r)?n.innerHTML=r:(n.innerHTML="",n.appendChild(r));break;case"x":n.style.left="".concat(e.parsedStyle.x,"px");break;case"y":n.style.top="".concat(e.parsedStyle.y,"px");break;case"transformOrigin":var i=e.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(i[0].value," ").concat(i[1].value);break;case"width":if(this.context.enableCSSParsing){var o=e.computedStyleMap().get("width");n.style.width=o.toString()}else{o=e.parsedStyle.width;n.style.width=I(o)?"".concat(o,"px"):o.toString()}break;case"height":if(this.context.enableCSSParsing){var a=e.computedStyleMap().get("height");n.style.height=a.toString()}else{a=e.parsedStyle.height;n.style.height=I(a)?"".concat(a,"px"):a.toString()}break;case"zIndex":var s=e.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=e.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var u=e.parsedStyle.pointerEvents,c=void 0===u?"auto":u;n.style.pointerEvents=c;break;case"opacity":var h=e.parsedStyle.opacity;n.style.opacity="".concat(h);break;case"fill":var d=e.parsedStyle.fill,f="";wA(d)?f=d.isNone?"transparent":e.getAttribute("fill"):Array.isArray(d)?f=e.getAttribute("fill"):TA(d),n.style.background=f;break;case"stroke":var p=e.parsedStyle.stroke,g="";wA(p)?g=p.isNone?"transparent":e.getAttribute("stroke"):Array.isArray(p)?g=e.getAttribute("stroke"):TA(p),n.style["border-color"]=g,n.style["border-style"]="solid";break;case"lineWidth":var v=e.parsedStyle.lineWidth;n.style["border-width"]="".concat(v||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var m=e.style.filter;n.style.filter=m;break;default:_(e.style[t])||""===e.style[t]||(n.style[t]=e.style[t])}},t.tag="HTMLRendering",t}(),iz=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="html-renderer",e}return n(e,t),e.prototype.init=function(){this.addRenderingPlugin(new rz)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(QS),oz=function(){function t(t){this.canvasConfig=t,this.imageCache={},this.gradientCache={},this.patternCache={}}return t.prototype.getImageSync=function(t,e){return this.imageCache[t]?e&&e(this.imageCache[t]):this.getOrCreateImage(t).then((function(t){e&&e(t)})),this.imageCache[t]},t.prototype.getOrCreateImage=function(t){var e=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var n=this.canvasConfig.createImage;return new Promise((function(r,i){var o;n?o=n(t):iT&&(o=new window.Image),o&&(o.onload=function(){e.imageCache[t]=o,r(o)},o.onerror=function(t){i(t)},o.crossOrigin="Anonymous",o.src=t)}))},t.prototype.getOrCreatePatternSync=function(t,e,n,r,i,o){var a=this.generatePatternKey(t);if(a&&this.patternCache[a])return this.patternCache[a];var s,l=t.image,u=t.repetition,c=t.transform,h=!1;N(l)?s=this.getImageSync(l,o):n?(s=n,h=!0):s=l;var d=s&&e.createPattern(s,u);if(d){var f=void 0;f=c?LT(_R(c),new Cw({})):gt(ct()),h&&bt(f,f,[1/r,1/r,1]),d.setTransform({a:f[0],b:f[1],c:f[4],d:f[5],e:f[12]+i[0],f:f[13]+i[1]})}return a&&d&&(this.patternCache[a]=d),d},t.prototype.getOrCreateGradient=function(t,e){var n=this.generateGradientKey(t),r=t.type,i=t.steps,o=t.min,a=t.width,s=t.height,l=t.angle,u=t.cx,c=t.cy,h=t.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===UM.LinearGradient){var f=function(t,e,n,r){var i=aM(r.value),o=0+e/2,a=0+n/2,s=Math.abs(e*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:t[0]+o-Math.cos(i)*s/2,y1:t[1]+a-Math.sin(i)*s/2,x2:t[0]+o+Math.cos(i)*s/2,y2:t[1]+a+Math.sin(i)*s/2}}(o,a,s,l),p=f.x1,g=f.y1,v=f.x2,m=f.y2;d=e.createLinearGradient(p,g,v,m)}else if(r===UM.RadialGradient){var y=function(t,e,n,r,i,o){var a=r.value,s=i.value;r.unit===wM.kPercentage&&(a=r.value/100*e),i.unit===wM.kPercentage&&(s=i.value/100*n);var l=Math.max(je([0,0],[a,s]),je([0,n],[a,s]),je([e,n],[a,s]),je([e,0],[a,s]));return o&&(o instanceof tA?l=o.value:o instanceof XM&&("closest-side"===o.value?l=Math.min(a,e-a,s,n-s):"farthest-side"===o.value?l=Math.max(a,e-a,s,n-s):"closest-corner"===o.value&&(l=Math.min(je([0,0],[a,s]),je([0,n],[a,s]),je([e,n],[a,s]),je([e,0],[a,s]))))),{x:a+t[0],y:s+t[1],r:l}}(o,a,s,u,c,h),E=y.x,_=y.y,b=y.r;d=e.createRadialGradient(E,_,0,E,_,b)}return d&&(i.forEach((function(t){var e=t.offset,n=t.color;e.unit===wM.kPercentage&&(null==d||d.addColorStop(e.value/100,n.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]},t.prototype.generateGradientKey=function(t){var e=t.type,n=t.min,r=t.width,i=t.height,o=t.steps,a=t.angle,s=t.cx,l=t.cy,u=t.size;return"gradient-".concat(e,"-").concat((null==a?void 0:a.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(o.map((function(t){var e=t.offset,n=t.color;return"".concat(e).concat(n)})).join("-"))},t.prototype.generatePatternKey=function(t){var e=t.image,n=t.repetition;return N(e)?"pattern-".concat(e,"-").concat(n):"rect"===e.nodeName?"pattern-".concat(e.entity,"-").concat(n):void 0},t}(),az=function(){function t(){}return t.prototype.apply=function(e){var n=e.renderingService,r=e.renderingContext,i=e.imagePool,o=r.root.ownerDocument.defaultView,a=function(t,e,n){var r=t.parsedStyle,i=r.width,o=r.height;i&&!o?t.setAttribute("height",n/e*i):!i&&o&&t.setAttribute("width",e/n*o)},s=function(t){var e=t.target,r=e.nodeName,o=e.attributes;if(r===$S.IMAGE){var s=o.src,l=o.keepAspectRatio;N(s)&&i.getImageSync(s,(function(t){var r=t.width,i=t.height;l&&a(e,r,i),e.renderable.dirty=!0,n.dirtify()}))}},l=function(t){var e=t.target,r=t.attrName,o=t.newValue;e.nodeName===$S.IMAGE&&"src"===r&&N(o)&&i.getOrCreateImage(o).then((function(t){var r=t.width,i=t.height;e.attributes.keepAspectRatio&&a(e,r,i),e.renderable.dirty=!0,n.dirtify()}))};n.hooks.init.tap(t.tag,(function(){o.addEventListener(nw.MOUNTED,s),o.addEventListener(nw.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(t.tag,(function(){o.removeEventListener(nw.MOUNTED,s),o.removeEventListener(nw.ATTR_MODIFIED,l)}))},t.tag="LoadImage",t}(),sz=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="image-loader",e}return n(e,t),e.prototype.init=function(){this.context.imagePool=new oz(this.context.config),this.addRenderingPlugin(new az)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(QS),lz=function(){function t(t){this.renderingContext=t.renderingContext,this.canvasConfig=t.config}return t.prototype.init=function(){var t=this.canvasConfig,e=t.container,n=t.canvas;if(n)this.$canvas=n,e&&n.parentElement!==e&&e.appendChild(n),this.$container=n.parentElement,this.canvasConfig.container=this.$container;else if(e&&(this.$container=N(e)?document.getElementById(e):e,this.$container)){var r=document.createElement("canvas");this.$container.appendChild(r),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=r}this.context=this.$canvas.getContext("2d"),this.resize(this.canvasConfig.width,this.canvasConfig.height)},t.prototype.getContext=function(){return this.context},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getDPR=function(){return this.dpr},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},t.prototype.resize=function(t,e){var n=this.canvasConfig.devicePixelRatio||iT&&window.devicePixelRatio||1;n=n>=1?Math.ceil(n):1,this.dpr=n,this.$canvas&&(this.$canvas.width=this.dpr*t,this.$canvas.height=this.dpr*e,lT(this.$canvas,t,e)),this.renderingContext.renderReasons.add(XT.CAMERA_CHANGED)},t.prototype.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},t.prototype.toDataURL=function(t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){return e=t.type,n=t.encoderOptions,[2,this.context.canvas.toDataURL(e,n)]}))}))},t}(),uz=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="canvas-context-register",e}return n(e,t),e.prototype.init=function(){this.context.ContextService=lz},e.prototype.destroy=function(){delete this.context.ContextService},e}(QS),cz=function(t){function e(e){var n=t.call(this,e)||this;return n.registerPlugin(new uz),n.registerPlugin(new sz),n.registerPlugin(new _G),n.registerPlugin(new tz),n.registerPlugin(new nz),n.registerPlugin(new jG),n.registerPlugin(new iz),n}return n(e,t),e}(JS);const hz=["timestamp","time","date","datetime"];class dz extends EL{static defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],mode:"modify",getTime:t=>gz(t,hz,void 0),loop:!1};timebar;canvas;wrapper;originalData;constructor(t,e){super(t,Object.assign({},dz.defaultOptions,e)),this.backup(),this.upsertTimebar()}play(){this.timebar?.play()}pause(){this.timebar?.pause()}forward(){this.timebar?.forward()}backward(){this.timebar?.backward()}reset(){this.timebar?.reset()}update(t){super.update(t),this.backup(),Object.keys(t).forEach((t=>{if("position"===t)this.upsertWrapper();else this.upsertTimebar()}))}backup(){this.originalData=fz(this.context.graph.getData())}upsertTimebar(){const{canvas:t}=this.context,{onChange:e,timebarType:n,data:r,x:i,y:o,width:a,height:s,mode:l,...u}=this.options,c=t.getSize();this.upsertCanvas().ready.then((()=>{const t={x:c[0]/2-a/2,y:10,onChange:t=>{const n=(S(t)?t:[t,t]).map((t=>function(t){return x(t,"Date")}(t)?t.getTime():t));"modify"===this.options.mode?this.filterElements(n):this.hiddenElements(n),e?.(n)},...u,data:r.map((t=>I(t)?{time:t,value:0}:t)),width:a,height:s,type:n};this.timebar?this.timebar.update(t):(this.timebar=new hG({style:t}),this.canvas?.appendChild(this.timebar))}))}upsertWrapper(){if(!this.wrapper){const t=document.createElement("div");t.style.position="absolute",this.wrapper=t}const{x:t,y:e,className:n,position:r}=this.options;return n&&(this.wrapper.className=n),I(t)||I(e)?Object.assign(this.wrapper.style,{left:`${t??0}px`,top:`${e??0}px`}):Object.assign(this.wrapper.style,{["top"===r?"bottom":"top"]:"unset",["top"===r?"top":"bottom"]:"0px"}),this.context.canvas.getContainer()?.appendChild(this.wrapper),this.wrapper}upsertCanvas(){const t=this.upsertWrapper();if(this.canvas)return this.canvas;const{height:e}=this.options,[n]=this.context.canvas.getSize();return this.canvas=new nP({container:t,width:n,height:e+10,renderer:this.context.options.renderer?.("main")||new cz,supportsMutipleCanvasesInOneContainer:!0}),this.canvas}async filterElements(t){if(!this.originalData)return;const{elementTypes:e,getTime:n}=this.options,{graph:r,element:i}=this.context,o=fz(this.originalData);e.forEach((e=>{const r=`${e}s`;o[r]=(this.originalData[r]||[]).filter((e=>{const r=n(e);return!!pz(r,t)}))}));const a=[...o.nodes,...o.combos].map((t=>xN(t)));o.edges=o.edges.filter((t=>{const e=t.source,n=t.target;return a.includes(e)&&a.includes(n)})),r.setData(o),await(i.draw({animation:!1,silence:!0})?.finished)}hiddenElements(t){const{graph:e}=this.context,{elementTypes:n,getTime:r}=this.options,i=[],o=[];n.forEach((e=>{const n=`${e}s`;(this.originalData?.[n]||[]).forEach((e=>{const n=xN(e),a=r(e);pz(a,t)?o.push(n):i.push(n)}))})),e.hideElement(i,!1),e.showElement(o,!1)}destroy(){const{graph:t}=this.context;this.originalData&&t.setData({...this.originalData}),this.timebar?.destroy(),this.canvas?.destroy(),this.wrapper?.remove(),this.originalData=void 0,this.wrapper=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}}const fz=t=>{const{nodes:e=[],edges:n=[],combos:r=[]}=t;return{nodes:[...e],edges:[...n],combos:[...r]}},pz=(t,e)=>{if(I(e))return t===e;const[n,r]=e;return t>=n&&t<=r},gz=(t,e,n)=>{for(let n=0;n<e.length;n++){const r=e[n],i=t.data?.[r];if(i)return i}return n};class vz extends EL{static defaultOptions={position:"top-left"};$element=mL("toolbar",!1);constructor(t,e){super(t,Object.assign({},vz.defaultOptions,e));const n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),yL("g6-toolbar-css","style",{},"\n  .g6-toolbar {\n    position: absolute;\n    z-index: 100;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);\n    opacity: 0.65;\n  }\n  .g6-toolbar .g6-toolbar-item {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    padding: 4px;\n    cursor: pointer;\n    box-sizing: content-box;\n  }\n\n  .g6-toolbar .g6-toolbar-item:hover {\n    background-color: #f0f0f0;\n  }\n\n  .g6-toolbar .g6-toolbar-item svg {\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n",document.head),yL("g6-toolbar-svgicon","div",{display:"none"},'\n  <svg>\n    <symbol id="zoom-in" viewBox="64 64 896 896">\n      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="zoom-out" viewBox="64 64 896 896">\n      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="edit" viewBox="64 64 896 896">\n      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>\n    </symbol>\n    <symbol id="delete" viewBox="64 64 896 896">\n      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>\n    </symbol>\n    <symbol id="redo" viewBox="64 64 896 896">\n      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>\n    </symbol>\n    <symbol id="undo" viewBox="64 64 896 896">\n      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>\n    </symbol>\n    <symbol id="export" viewBox="64 64 896 896">\n      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>\n    </symbol>\n    <symbol id="auto-fit" viewBox="64 64 896 896">\n      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>\n      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>\n    </symbol>\n    <symbol id="reset" viewBox="64 64 896 896">\n      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>\n    </symbol>\n  </svg>\n'),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}async update(t){super.update(t);const{className:e,position:n,style:r}=this.options;this.$element.className=`g6-toolbar ${e||""}`,Object.assign(this.$element.style,r,function(t){const e={top:"unset",right:"unset",bottom:"unset",left:"unset"};return t.split("-").forEach((t=>{e[t]="8px"})),e.flexDirection=t.startsWith("top")||t.startsWith("bottom")?"row":"column",e}(n)),this.$element.innerHTML=await this.getDOMContent()}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}async getDOMContent(){return(await this.options.getItems()).map((t=>`\n          <div class="g6-toolbar-item" value="${t.value}">\n            <svg aria-hidden="true" focusable="false">\n              <use xlink:href="#${t.id}"></use>\n            </svg>\n          </div>`)).join("")}onToolbarItemClick=t=>{const{onClick:e}=this.options;if(t.target instanceof Element&&t.target.className.includes("g6-toolbar-item")){const n=t.target.getAttribute("value");e?.(n,t.target)}}}class mz extends EL{static defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};currentTarget=null;tooltipElement=null;container=null;constructor(t,e){super(t,Object.assign({},mz.defaultOptions,e)),this.render(),this.bindEvents()}getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){this.unbindEvents(),super.update(t),this.tooltipElement&&this.container?.removeChild(this.tooltipElement.HTMLTooltipElement),this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){const{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach((n=>{t.off(n,e[n])}))}bindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach((n=>{t.on(n,e[n])}))}isEnable=t=>{const{enable:e}=this.options;return"function"==typeof e?e(t):e};onClick=t=>{const{target:{id:e}}=t;this.currentTarget===e?(this.currentTarget=null,this.hide(t)):(this.currentTarget=e,this.show(t))};onPointerMove=t=>{const{target:e}=t;this.currentTarget&&e.id!==this.currentTarget&&this.show(t)};onPointerLeave=t=>{this.hide(t),this.currentTarget=null};onCanvasMove=t=>{this.hide(t),this.currentTarget=null};onPointerEnter=t=>{this.show(t)};showById=t=>{const e={target:{id:t}};this.show(e)};getElementData=(t,e)=>{const{model:n}=this.context;switch(e){case"node":return n.getNodeData([t]);case"edge":return n.getEdgeData([t]);case"combo":return n.getComboData([t]);default:return[]}};show=t=>{const{client:e,target:{id:n}}=t,r=this.context.graph.getElementType(n);if(!this.tooltipElement||!this.isEnable(t))return;const{getContent:i,title:o}=this.options;this.currentTarget=n;const a=this.getElementData(n,r);let s,l;if(e)s=e.x,l=e.y;else{const t=J(a,"0.style",{x:0,y:0});s=t.x,l=t.y}let u={};if(i)u.content=i(t,a);else{const t=this.context.graph.getElementRenderStyle(n),e="node"===r?t.fill:t.stroke;u={title:o||r,data:a.map((t=>({name:"ID",value:t.id||`${t.source} -> ${t.target}`,color:e})))}}this.tooltipElement.update({x:s,y:l,style:{".tooltip":{visibility:"visible"}},...u})};hide=t=>{if(!t)return void this.tooltipElement?.hide();if(!this.tooltipElement||!this.isEnable(t))return;const{client:{x:e,y:n}}=t;this.tooltipElement.hide(e,n)};initTooltip=()=>{const{canvas:t}=this.context,{center:e}=t.getBounds(),n=t.getContainer(),{top:r,left:i}=n.getBoundingClientRect(),{style:o,position:a,enterable:s,container:l={x:-i,y:-r},title:u,offset:c}=this.options,[h,d]=e,[f,p]=t.getSize(),g=new kU({className:"tooltip",style:{x:h,y:d,container:l,title:u,bounding:{x:0,y:0,width:f,height:p},position:a,enterable:s,offset:c,style:o}});return this.container?.appendChild(g.HTMLTooltipElement),g};destroy(){this.unbindEvents(),this.tooltipElement&&this.container?.removeChild(this.tooltipElement.HTMLTooltipElement),super.destroy()}}let yz;function Ez(t,e){yz||(yz=document.createElement("canvas")),yz.width=t,yz.height=e;return yz.getContext("2d").clearRect(0,0,t,e),yz}class _z extends EL{static defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};$element=mL("watermark");constructor(t,e){super(t,Object.assign({},_z.defaultOptions,e));this.context.canvas.getContainer().appendChild(this.$element),this.update(e)}async update(t){super.update(t);const{width:e,height:n,text:r,imageURL:i,...o}=this.options;Object.keys(o).forEach((e=>{e.startsWith("background")&&(this.$element.style[e]=t[e])}));const a=i?await async function(t,e,n,r){const i=Ez(t,e),o=i.getContext("2d"),{rotate:a,opacity:s}=r;a&&o.rotate(a),s&&(o.globalAlpha=s);const l=new Image;return l.crossOrigin="anonymous",l.src=n,new Promise((n=>{l.onload=function(){const r=t>l.width?(t-l.width)/2:0,a=e>l.height?(e-l.height)/2:0;o.drawImage(l,0,0,l.width,l.height,r,a,t-2*r,e-2*a),n(i.toDataURL())}}))}(e,n,i,o):await async function(t,e,n,r){const i=Ez(t,e),o=i.getContext("2d"),{rotate:a,opacity:s,textFill:l,textFontSize:u,textFontFamily:c,textFontVariant:h,textFontWeight:d,textAlign:f,textBaseline:p}=r;return o.textAlign=f,o.textBaseline=p,o.translate(t/2,e/2),o.font=`${u}px ${c} ${h} ${d}`,a&&o.rotate(a),s&&(o.globalAlpha=s),l&&(o.fillStyle=l,o.fillText(`${n}`,0,0)),i.toDataURL()}(e,n,r,o);this.$element.style.backgroundImage=`url(${a})`}destroy(){super.destroy(),this.$element.remove()}}const bz=["#7E92B5","#f5222d","#faad14"],xz={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},Sz={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function Mz(t){const{bgColor:e,textColor:n,nodeColor:r,nodeColorDisabled:i,nodeStroke:o,nodeBadgePalette:a=bz,nodePaletteOptions:s=xz,edgeColor:l,edgeColorDisabled:u,edgePaletteOptions:c=Sz,comboColor:h,comboColorDisabled:d,comboStroke:f,comboStrokeDisabled:p}=t;return{background:e,node:{palette:s,style:{badgeFill:e,badgeFontSize:8,badgePadding:[1,4],badgePalette:a,fill:r,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:.25,iconFill:e,iconFontSize:16,iconOpacity:1,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.5,labelBackgroundPadding:[0,2],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineWidth:0,portFill:r,portLineWidth:1,portStroke:o,portStrokeOpacity:.65,stroke:o,strokeOpacity:1},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:3,stroke:o},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:3,stroke:o,strokeOpacity:.85},inactive:{donutOpacity:.25,fillOpacity:.25,iconOpacity:.25,labelOpacity:.25,strokeOpacity:.25},disabled:{fill:i,labelOpacity:.25,donutOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}]}},edge:{palette:c,style:{fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:.25,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:l,strokeOpacity:1},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:2},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:2},inactive:{fillOpacity:.25,labelOpacity:.25,strokeOpacity:.25},disabled:{stroke:u,labelOpacity:.25}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}]}},combo:{style:{collapsedMaskFill:h,collapsedMaskFontSize:12,collapsedSize:32,fill:h,halo:!1,haloLineWidth:12,haloStroke:f,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:1,strokeOpacity:1,padding:10,stroke:f},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:d,fillOpacity:.25,labelOpacity:.25,stroke:p,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}]}}}}const Az=Mz({bgColor:"#000000",textColor:"#ffffffd9",nodeColor:"#1783ff",nodeColorDisabled:"#d0e4ff",nodeStroke:"#d0e4ff",edgeColor:"#99add1",edgeColorDisabled:"#969696",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696"}),Rz=Mz({bgColor:"#fff",textColor:"#000000d9",nodeColor:"#1783ff",nodeColorDisabled:"#f0f0f0",nodeStroke:"#000000",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",comboColor:"#fdfdfd",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9"});class Tz extends ON{beforeDraw(t,e){return t}}function wz(t,e,n,r,i){const o=xN(r),a=`${n}s`,s=t.add[a].get(o)||t.update[a].get(o)||t.remove[a].get(o)||r;Object.entries(t).forEach((([t,n])=>{e===t?n[a].set(o,s):n[a].delete(o)}))}const Pz=(t,e,n,r)=>{const i=`${n}s`,o=xN(r);t.add[i].has(o)||t.update[i].has(o)||t[e][i].set(xN(r),r)};var Nz=function(){function t(t){this.dragndropPluginOptions=t}return t.prototype.apply=function(e){var n=this,r=e.renderingService,i=e.renderingContext.root.ownerDocument,s=i.defaultView,l=function(t){var e=t.target,r=e===i,l=r&&n.dragndropPluginOptions.isDocumentDraggable?i:e.closest&&e.closest("[draggable=true]");if(l){var u=!1,c=t.timeStamp,h=[t.clientX,t.clientY],d=null,f=[t.clientX,t.clientY],p=function(t){return o(n,void 0,void 0,(function(){var n,o,s,p,g,v;return a(this,(function(a){switch(a.label){case 0:if(!u){if(n=t.timeStamp-c,o=je([t.clientX,t.clientY],h),n<=this.dragndropPluginOptions.dragstartTimeThreshold||o<=this.dragndropPluginOptions.dragstartDistanceThreshold)return[2];t.type="dragstart",l.dispatchEvent(t),u=!0}return t.type="drag",t.dx=t.clientX-f[0],t.dy=t.clientY-f[1],l.dispatchEvent(t),f=[t.clientX,t.clientY],r?[3,2]:(s="pointer"===this.dragndropPluginOptions.overlap?[t.canvasX,t.canvasY]:e.getBounds().center,[4,i.elementsFromPoint(s[0],s[1])]);case 1:p=a.sent(),g=p[p.indexOf(e)+1],v=(null==g?void 0:g.closest("[droppable=true]"))||(this.dragndropPluginOptions.isDocumentDroppable?i:null),d!==v&&(d&&(t.type="dragleave",t.target=d,d.dispatchEvent(t)),v&&(t.type="dragenter",t.target=v,v.dispatchEvent(t)),(d=v)&&(t.type="dragover",t.target=d,d.dispatchEvent(t))),a.label=2;case 2:return[2]}}))}))};s.addEventListener("pointermove",p);var g=function(t){if(u){t.detail={preventClick:!0};var e=t.clone();d&&(e.type="drop",e.target=d,d.dispatchEvent(e)),e.type="dragend",l.dispatchEvent(e),u=!1}s.removeEventListener("pointermove",p)};e.addEventListener("pointerup",g,{once:!0}),e.addEventListener("pointerupoutside",g,{once:!0})}};r.hooks.init.tap(t.tag,(function(){s.addEventListener("pointerdown",l)})),r.hooks.destroy.tap(t.tag,(function(){s.removeEventListener("pointerdown",l)}))},t.tag="Dragndrop",t}();!function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="dragndrop",n}n(e,t),e.prototype.init=function(){this.addRenderingPlugin(new Nz(r({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e.prototype.setOptions=function(t){Object.assign(this.plugins[0].dragndropPluginOptions,t)}}(QS);const Cz=(t,e)=>{const{source:n,target:r}=e,i=t.getElementDataById(n),o=t.getElementDataById(r),a=PO(i,(e=>t.getParentData(e,yN))),s=PO(o,(e=>t.getParentData(e,yN))),l={sourceNode:xN(a),targetNode:xN(s)};return e.style?Object.assign(e.style,l):e.style=l,e},Oz=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class Iz extends Tz{static defaultOptions={mode:"bundle",edges:void 0,distance:15};cacheMergeStyle=new Map;constructor(t,e){super(t,Object.assign({},Iz.defaultOptions,e))}beforeDraw(t){const e=this.getAffectedParallelEdges(t);return 0===e.size||("bundle"===this.options.mode?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}getAffectedParallelEdges=t=>{const{add:{edges:e},update:{nodes:n,edges:r,combos:i},remove:{edges:o}}=t,{model:a}=this.context,s=new Map,l=(t,e)=>{a.getRelatedEdgesData(e).forEach((t=>!s.has(xN(t))&&s.set(xN(t),t)))};n.forEach(l),i.forEach(l);const u=t=>{const e=a.getEdgeData().map((t=>Cz(a,t)));Dz(t,e).forEach((t=>!s.has(xN(t))&&s.set(xN(t),t)))};if(o.size&&o.forEach(u),e.size&&e.forEach(u),r.size){const t=fD(dD(a.getChanges())).update.edges;r.forEach((e=>{u(e);const n=t.find((t=>xN(t.value)===xN(e)))?.original;n&&!Bz(e,n)&&u(n)}))}Z(this.options.edges)||s.forEach(((t,e)=>!this.options.edges.includes(e)&&s.delete(e)));const c=a.getEdgeData().map(xN);return new Map([...s].sort(((t,e)=>c.indexOf(t[0])-c.indexOf(e[0]))))};applyBundlingStyle=(t,e,n)=>{const{edgeMap:r,reverses:i}=Lz(e);r.forEach((e=>{e.forEach(((e,r,o)=>{const a=Object.assign(e,{type:"quadratic",style:(()=>{const t=o.length,a={};if(e.source===e.target){const t=Oz.length;a.loopPlacement=Oz[r%t],a.loopDist=Math.floor(r/t)*n+50}else if(1===t)a.curveOffset=0;else{const o=(r%2==0?1:-1)*(i[`${e.source}|${e.target}|${r}`]?-1:1);a.curveOffset=t%2==1?o*Math.ceil(r/2)*n*2:o*(Math.floor(r/2)*n*2+n)}return Object.assign({},e.style,a)})()}),s=this.context.element?.getElement(xN(e));MN(t,s?"update":"add","edge",a,!0)}))}))};resetEdgeStyle=t=>{const e=t.style||{},n=this.cacheMergeStyle.get(xN(t))||{};return Object.keys(n).forEach((r=>{Q(e[r],n[r])&&(t[r]?e[r]=t[r]:delete e[r])})),Object.assign(t,{style:e})};applyMergingStyle=(t,e)=>{const{edgeMap:n,reverses:r}=Lz(e);n.forEach((e=>{if(1===e.length){const n=e[0],r=this.context.element?.getElement(xN(n));return void MN(t,r?"update":"add","edge",this.resetEdgeStyle(n),!0)}const n=e.map((({source:t,target:e,style:n={}},i)=>{const{startArrow:o,endArrow:a}=n,s={},[l,u]=r[`${t}|${e}|${i}`]?["endArrow","startArrow"]:["startArrow","endArrow"];return W(o)&&(s[l]=o),W(a)&&(s[u]=a),s})).reduce(((t,e)=>({...t,...e})),{});e.forEach(((e,r,i)=>{if(0===r){const r=Object.assign({},E(this.options.style)?this.options.style(i):this.options.style,{childrenData:i});this.cacheMergeStyle.set(xN(e),r);const o={...e,type:"line",style:{...n,...r}},a=this.context.element?.getElement(xN(e));MN(t,a?"update":"add","edge",o,!0)}else MN(t,"remove","edge",e)}))}))}}const Lz=t=>{const e=new Map,n=new Set,r={};for(const[i,o]of t){if(n.has(i))continue;const{source:a,target:s}=o,l=`${a}-${s}`;e.has(l)||e.set(l,[]),e.get(l).push(o),n.add(i);for(const[i,u]of t)n.has(i)||Bz(o,u)&&(e.get(l).push(u),n.add(i),a===u.target&&s===u.source&&(r[`${u.source}|${u.target}|${e.get(l).length-1}`]=!0))}return{edgeMap:e,reverses:r}},Dz=(t,e,n)=>e.filter((e=>Bz(e,t))),Bz=(t,e)=>{const{sourceNode:n,targetNode:r}=t.style||{},{sourceNode:i,targetNode:o}=e.style||{};return n===i&&r===o||n===o&&r===i};const kz={animation:{"combo-collapse":PN,"combo-expand":NN,"node-collapse":AN,"node-expand":RN,"path-in":TN,"path-out":wN,fade:[{fields:["opacity"]}],translate:[{fields:["x","y"]}]},behavior:{"zoom-canvas":lI,"drag-canvas":eI,"drag-element":nI,"drag-element-force":class extends nI{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find((t=>["d3-force","d3-force-3d"].includes(t?.id)))}validate(t){return!!this.context.layout&&(this.forceLayoutInstance?super.validate(t):(console.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1))}async moveElement(t,e){const n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach(((r,i)=>{const{x:o=0,y:a=0}=r.style||{};n&&rI(n,"setFixedPosition",t[i],[...YN([+o,+a],e)])}))}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);const e=this.forceLayoutInstance;e&&iI(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach((t=>{const{x:n=0,y:r=0}=t.style||{};e&&rI(e,"setFixedPosition",xN(t),[+n,+r])}))}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){const t=this.forceLayoutInstance;t&&iI(t,"simulation").alphaTarget(0),this.context.graph.getNodeData(this.target).forEach((e=>{t&&rI(t,"setFixedPosition",xN(e),[null,null,null])}))}},"scroll-canvas":sI,"collapse-expand":QO,"click-select":TC,"hover-activate":aI,"focus-element":oI,"create-edge":tI,"brush-select":bC,"lasso-select":class extends bC{points;pathShape;onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;const{canvas:e}=this.context;this.pathShape=new Uw({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[xC(t)]}onPointerMove(t){if(!this.points)return;const{immediately:e,mode:n}=this.options;this.points.push(xC(t)),this.pathShape?.setAttribute("d",function(t,e=!0){const n=[];return t.forEach(((t,e)=>{n.push([0===e?"M":"L",...t])})),e&&n.push(["Z"]),n}(this.points)),e&&"default"===n&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){this.points&&(this.points.length<2||super.updateElementsStates(this.points),this.clearLasso())}clearLasso(){this.pathShape?.remove(),this.pathShape=void 0,this.points=void 0}}},combo:{circle:class extends uO{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",Ow,this.getKeyStyle(t),e)}getKeyStyle(t){const{collapsed:e}=t,n=super.getKeyStyle(t),[r]=this.getKeySize(t);return{...n,...e&&CC(n,"collapsed"),r:r/2}}getCollapsedKeySize(t){const[e,n]=LC(t.collapsedSize),r=Math.max(e,n)/2;return[2*r,2*r,0]}getExpandedKeySize(t){const e=this.getContentBBox(t),[n,r]=UN(e),i=Math.sqrt(n**2+r**2)/2;return[2*i,2*i,0]}getIntersectPoint(t){return pC(t,this.getKey().getBounds())}},rect:class extends uO{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",Vw,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,r]=this.getKeySize(t);return{...e,...t.collapsed&&CC(e,"collapsed"),width:n,height:r,x:-n/2,y:-r/2}}}},edge:{cubic:IO,line:class t extends OO{static defaultStyleProps={};constructor(e){super(DC({style:t.defaultStyleProps},e))}getKeyPath(t){const[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}},polyline:BO,quadratic:kO,"cubic-horizontal":LO,"cubic-vertical":DO},layout:{"antv-dagre":class{constructor(t={}){this.options=t,this.id="antv-dagre",this.options=Object.assign(Object.assign({},li),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericDagreLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){yield this.genericDagreLayout(!0,t,e)}))}genericDagreLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{nodeSize:i,align:o,rankdir:a="TB",ranksep:s,nodesep:l,ranksepFunc:u,nodesepFunc:c,edgeLabelSpace:h,ranker:d,nodeOrder:f,begin:p,controlPoints:g,radial:m,sortByCombo:y,preset:E}=r,_=new v({tree:[]}),b=oi(s||50,u),x=oi(l||50,c);let S=x,M=b;"LR"!==a&&"RL"!==a||(S=b,M=x);const A=si(i,void 0),R=e.getAllNodes(),T=e.getAllEdges();let w;R.forEach((t=>{const e=A(t),n=M(t),r=e+2*S(t),i=e+2*n,o=t.data.layer;I(o)?_.addNode({id:t.id,data:{width:r,height:i,layer:o}}):_.addNode({id:t.id,data:{width:r,height:i}})})),y&&(_.attachTreeStructure("combo"),R.forEach((t=>{const{parentId:e}=t.data;void 0!==e&&_.hasNode(e)&&_.setParent(t.id,e,"combo")}))),T.forEach((t=>{_.addEdge({id:t.id,source:t.source,target:t.target,data:{weight:t.data.weight||1}})})),(null==E?void 0:E.length)&&(w=new v({nodes:E})),((t,e)=>{const{edgeLabelSpace:n,keepNodeOrder:r,prevGraph:i,rankdir:o,ranksep:a}=e;!r&&i&&Nr(t,i);const s=kr(t);let l;n&&(e.ranksep=Fr(s,{rankdir:o,ranksep:a}));try{l=Pr(s,e)}catch(t){if("Not possible to find intersection inside of the rectangle"===t.message)return void console.error("The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\n",t);throw t}Cr(t,s)})(_,{prevGraph:w,edgeLabelSpace:h,keepNodeOrder:!!f,nodeOrder:f||[],acyclicer:"greedy",ranker:d,rankdir:a,nodesep:l,align:o});const P=[0,0];if(p){let t=1/0,e=1/0;_.getAllNodes().forEach((n=>{t>n.data.x&&(t=n.data.x),e>n.data.y&&(e=n.data.y)})),_.getAllEdges().forEach((n=>{var r;null===(r=n.data.points)||void 0===r||r.forEach((n=>{t>n.x&&(t=n.x),e>n.y&&(e=n.y)}))})),P[0]=p[0]-t,P[1]=p[1]-e}const N="LR"===a||"RL"===a;if(m);else{const t=new Set,e="BT"===a||"RL"===a?(t,e)=>e-t:(t,e)=>t-e;_.getAllNodes().forEach((e=>{e.data.x=e.data.x+P[0],e.data.y=e.data.y+P[1],t.add(N?e.data.x:e.data.y)}));const n=Array.from(t).sort(e),r=N?(t,e)=>t.x!==e.x:(t,e)=>t.y!==e.y,i=N?(t,e,n)=>{const r=Math.max(e.y,n.y),i=Math.min(e.y,n.y);return t.filter((t=>t.y<=r&&t.y>=i))}:(t,e,n)=>{const r=Math.max(e.x,n.x),i=Math.min(e.x,n.x);return t.filter((t=>t.x<=r&&t.x>=i))};_.getAllEdges().forEach(((t,e)=>{var o;h&&g&&"loop"!==t.data.type&&(t.data.controlPoints=ui(null===(o=t.data.points)||void 0===o?void 0:o.map((({x:t,y:e})=>({x:t+P[0],y:e+P[1]}))),_.getNode(t.source),_.getNode(t.target),n,N,r,i))}))}let C=[];C=_.getAllNodes().map((t=>ii(t)));const O=_.getAllEdges();t&&(C.forEach((t=>{e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})})),O.forEach((t=>{e.mergeEdgeData(t.id,{controlPoints:t.data.controlPoints})})));return{nodes:C,edges:O}}))}},"combo-combined":class{constructor(t={}){this.options=t,this.id="comboCombined",this.options=Object.assign(Object.assign({},Xo),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericComboCombinedLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){yield this.genericComboCombinedLayout(!0,t,e)}))}genericComboCombinedLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=this.initVals(Object.assign(Object.assign({},this.options),n)),{center:i,treeKey:o,outerLayout:a}=r,s=e.getAllNodes().filter((t=>!t.data._isCombo)),l=e.getAllNodes().filter((t=>t.data._isCombo)),u=e.getAllEdges(),c=null==s?void 0:s.length;if(!c||1===c)return ci(e,t,i);const h=[],d=new Map;s.forEach((t=>{d.set(t.id,t)}));const f=new Map;l.forEach((t=>{f.set(t.id,t)}));const p=new Map,g=this.getInnerGraphs(e,o,d,f,u,r,p);yield Promise.all(g);const m=new Map,y=[],E=new Map;let _=!0;e.getRoots(o).forEach((t=>{const n=p.get(t.id),r=f.get(t.id)||d.get(t.id),i={id:t.id,data:Object.assign(Object.assign({},t.data),{x:n.data.x||r.data.x,y:n.data.y||r.data.y,fx:n.data.fx||r.data.fx,fy:n.data.fy||r.data.fy,mass:n.data.mass||r.data.mass,size:n.data.size})};y.push(i),m.set(t.id,!0),isNaN(i.data.x)||0===i.data.x||isNaN(i.data.y)||0===i.data.y?(i.data.x=100*Math.random(),i.data.y=100*Math.random()):_=!1,ni(e,[t],(e=>{e.id!==t.id&&E.set(e.id,t.id)}),"TB",o)}));const b=[];let x;if(u.forEach((t=>{const e=E.get(t.source)||t.source,n=E.get(t.target)||t.target;e!==n&&m.has(e)&&m.has(n)&&b.push({id:t.id,source:e,target:n,data:{}})})),null==y?void 0:y.length){if(1===y.length)y[0].data.x=i[0],y[0].data.y=i[1];else{const t=new v({nodes:y,edges:b}),e=a||new ki;if(_&&Ho[e.id]){const e=y.length<100?new Vo:new gi;yield e.assign(t)}x=yield e.execute(t,Object.assign({center:i,kg:5,preventOverlap:!0,animate:!1},"force"===e.id?{gravity:1,factor:4,linkDistance:(t,e,n)=>(Math.max(...e.data.size)||32)/2+(Math.max(...n.data.size)||32)/2+200}:{}))}p.forEach((t=>{var e;const n=x.nodes.find((e=>e.id===t.id));if(n){const{x:e,y:r}=n.data;t.data.visited=!0,t.data.x=e,t.data.y=r,h.push({id:t.id,data:{x:e,y:r}})}const{x:r,y:i}=t.data;null===(e=t.data.nodes)||void 0===e||e.forEach((t=>{h.push({id:t.id,data:{x:t.data.x+r,y:t.data.y+i}})}))})),p.forEach((({data:t})=>{const{x:e,y:n,visited:r,nodes:i}=t;null==i||i.forEach((t=>{if(!r){const r=h.find((e=>e.id===t.id));r.data.x+=e||0,r.data.y+=n||0}}))}))}t&&h.forEach((t=>{e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})}));return{nodes:h,edges:u}}))}initVals(t){const e=Object.assign({},t),{nodeSize:n,spacing:r,comboPadding:i}=t;let o,a,s;if(a=I(r)?()=>r:E(r)?r:()=>0,e.spacing=a,n)if(E(n))o=t=>{const e=n(t),r=a(t);if(Qr(t.size)){return((t.size[0]>t.size[1]?t.size[0]:t.size[1])+r)/2}return((e||32)+r)/2};else if(Qr(n)){const t=(n[0]>n[1]?n[0]:n[1])/2;o=e=>t+a(e)/2}else{const t=n/2;o=e=>t+a(e)/2}else o=t=>{const e=a(t);if(t.size){if(Qr(t.size)){return((t.size[0]>t.size[1]?t.size[0]:t.size[1])+e)/2}if(M(t.size)){return((t.size.width>t.size.height?t.size.width:t.size.height)+e)/2}return(t.size+e)/2}return 32+e/2};return e.nodeSize=o,s=I(i)?()=>i:Qr(i)?()=>Math.max.apply(null,i):E(i)?i:()=>0,e.comboPadding=s,e}getInnerGraphs(t,e,n,r,i,a,s){const{nodeSize:l,comboPadding:u,spacing:c,innerLayout:h}=a,d=h||new gi({}),f={center:[0,0],preventOverlap:!0,nodeSpacing:c},p=[],g=t=>{let e=(null==u?void 0:u(t))||10;return Qr(e)&&(e=Math.max(...e)),{size:e?[2*e,2*e]:[30,30],padding:e}};return t.getRoots(e).forEach((a=>{s.set(a.id,{id:a.id,data:{nodes:[],size:g(a).size}});let u=Promise.resolve();ni(t,[a],(a=>{var c;if(!a.data._isCombo)return;const{size:h,padding:p}=g(a);if(null===(c=t.getChildren(a.id,e))||void 0===c?void 0:c.length){const c=s.get(a.id);s.set(a.id,{id:a.id,data:Object.assign({nodes:[]},null==c?void 0:c.data)});const h=new Map,g=t.getChildren(a.id,e).map((t=>{if(t.data._isCombo)return s.has(t.id)||s.set(t.id,{id:t.id,data:Object.assign({},t.data)}),h.set(t.id,!0),s.get(t.id);const e=n.get(t.id)||r.get(t.id);return h.set(t.id,!0),{id:t.id,data:Object.assign(Object.assign({},e.data),t.data)}})),m={nodes:g,edges:i.filter((t=>h.has(t.source)&&h.has(t.target)))};let y=1/0;g.forEach((t=>{var e;let{size:n}=t.data;n||(n=(null===(e=s.get(t.id))||void 0===e?void 0:e.data.size)||(null==l?void 0:l(t))||[30,30]),I(n)&&(n=[n,n]);const[r,i]=n;y>r&&(y=r),y>i&&(y=i),t.data.size=n})),u=u.then((()=>o(this,void 0,void 0,(function*(){const t=new v(m),e=yield d.assign(t,f),{minX:n,minY:r,maxX:i,maxY:o}=(t=>{let e=1/0,n=1/0,r=-1/0,i=-1/0;return t.forEach((t=>{let o=t.data.size;Qr(o)?1===o.length&&(o=[o[0],o[0]]):I(o)?o=[o,o]:(void 0===o||isNaN(o))&&(o=[30,30]);const a=[o[0]/2,o[1]/2],s=t.data.x-a[0],l=t.data.x+a[0],u=t.data.y-a[1],c=t.data.y+a[1];e>s&&(e=s),n>u&&(n=u),r<l&&(r=l),i<c&&(i=c)})),{minX:e,minY:n,maxX:r,maxY:i}})(g),l=(i+n)/2,u=(o+r)/2;m.nodes.forEach((t=>{t.data.x-=l,t.data.y-=u}));const c=[Math.max(i-n,y)+2*p,Math.max(o-r,y)+2*p];return s.get(a.id).data.size=c,s.get(a.id).data.nodes=g,e}))))}else s.set(a.id,{id:a.id,data:Object.assign(Object.assign({},a.data),{size:h})});return!0}),"BT",e),p.push(u)})),p}},"compact-box":vL.compactBox,"force-atlas2":class{constructor(t={}){this.options=t,this.id="forceAtlas2",this.options=Object.assign(Object.assign({},Px),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericForceAtlas2Layout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericForceAtlas2Layout(!0,t,e)}))}genericForceAtlas2Layout(t,e,n){return o(this,void 0,void 0,(function*(){const r=e.getAllEdges(),i=e.getAllNodes(),o=this.formatOptions(n,i.length),{width:a,height:s,prune:l,maxIteration:u,nodeSize:c,center:h}=o;if(!(null==i?void 0:i.length)||1===i.length)return ci(e,t,h);const d=i.map((t=>ii(t,[a,s]))),f=r.filter((t=>{const{source:e,target:n}=t;return e!==n})),p=new v({nodes:d,edges:f}),g=this.getSizes(p,e,c);if(this.run(p,e,u,g,t,o),l){for(let t=0;t<f.length;t+=1){const{source:e,target:n}=f[t],r=p.getDegree(e),i=p.getDegree(e);if(r<=1){const t=p.getNode(n);p.mergeNodeData(e,{x:t.data.x,y:t.data.y})}else if(i<=1){const t=p.getNode(e);p.mergeNodeData(n,{x:t.data.x,y:t.data.y})}}const n=Object.assign(Object.assign({},o),{prune:!1,barnesHut:!1});this.run(p,e,100,g,t,n)}return{nodes:d,edges:r}}))}getSizes(t,e,n){const r=t.getAllNodes(),i={};for(let t=0;t<r.length;t+=1){const{id:o,data:a}=r[t];if(i[o]=10,I(a.size))i[o]=a.size;else if(Qr(a.size))isNaN(a.size[0])||(i[o]=Math.max(a.size[0])),isNaN(a.size[1])||(i[o]=Math.max(a.size[1]));else if(M(a.size))i[o]=Math.max(a.size.width,a.size.height);else if(E(n)){const t=n(e.getNode(o));Qr(t)?i[o]=Math.max(...t):i[o]=t}else Qr(n)?i[o]=Math.max(...n):I(n)&&(i[o]=n)}return i}formatOptions(t={},e){const n=Object.assign(Object.assign({},this.options),t),{center:r,width:i,height:o,barnesHut:a,prune:s,maxIteration:l,kr:u,kg:c}=n;return n.width=i||"undefined"==typeof window?i:window.innerWidth,n.height=o||"undefined"==typeof window?o:window.innerHeight,n.center=r||[n.width/2,n.height/2],void 0===a&&e>250&&(n.barnesHut=!0),void 0===s&&e>100&&(n.prune=!0),0!==l||s?0===l&&s&&(n.maxIteration=100,e<=200&&e>100?n.maxIteration=500:e>200&&(n.maxIteration=950)):(n.maxIteration=250,e<=200&&e>100?n.maxIteration=1e3:e>200&&(n.maxIteration=1200)),u||(n.kr=50,e>100&&e<=500?n.kr=20:e>500&&(n.kr=1)),c||(n.kg=20,e>100&&e<=500?n.kg=10:e>500&&(n.kg=1)),n}run(t,e,n,r,i,o){const{kr:a,barnesHut:s,onTick:l}=o,u=t.getAllNodes();let c=0,h=n;const d={},f={},p={};for(let e=0;e<u.length;e+=1){const{data:n,id:r}=u[e];if(d[r]=[0,0],s){const i={id:e,rx:n.x,ry:n.y,mass:1,g:a,degree:t.getDegree(r)};p[r]=new Rx(i)}}for(;h>0;)c=this.oneStep(t,{iter:h,preventOverlapIters:50,krPrime:100,sg:c,forces:d,preForces:f,bodies:p,sizes:r},o),h--,null==l||l({nodes:u,edges:e.getAllEdges()});return t}oneStep(t,e,n){const{iter:r,preventOverlapIters:i,krPrime:o,sg:a,preForces:s,bodies:l,sizes:u}=e;let{forces:c}=e;const{preventOverlap:h,barnesHut:d}=n,f=t.getAllNodes();for(let t=0;t<f.length;t+=1){const{id:e}=f[t];s[e]=[...c[e]],c[e]=[0,0]}return c=this.getAttrForces(t,r,i,u,c,n),c=d&&(h&&r>i||!h)?this.getOptRepGraForces(t,c,l,n):this.getRepGraForces(t,r,i,c,o,u,n),this.updatePos(t,c,s,a,n)}getAttrForces(t,e,n,r,i,o){const{preventOverlap:a,dissuadeHubs:s,mode:l,prune:u}=o,c=t.getAllEdges();for(let o=0;o<c.length;o+=1){const{source:h,target:d}=c[o],f=t.getNode(h),p=t.getNode(d),g=t.getDegree(h),v=t.getDegree(d);if(u&&(g<=1||v<=1))continue;const m=[p.data.x-f.data.x,p.data.y-f.data.y];let y=Math.hypot(m[0],m[1]);y=y<1e-4?1e-4:y,m[0]=m[0]/y,m[1]=m[1]/y,a&&e<n&&(y=y-r[h]-r[d]);let E=y,_=E;"linlog"===l&&(E=Math.log(1+y),_=E),s&&(E=y/g,_=y/v),a&&e<n&&y<=0?(E=0,_=0):a&&e<n&&y>0&&(E=y,_=y),i[h][0]+=E*m[0],i[d][0]-=_*m[0],i[h][1]+=E*m[1],i[d][1]-=_*m[1]}return i}getOptRepGraForces(t,e,n,r){const{kg:i,center:o,prune:a}=r,s=t.getAllNodes(),l=s.length;let u=9e10,c=-9e10,h=9e10,d=-9e10;for(let e=0;e<l;e+=1){const{id:r,data:i}=s[e];a&&t.getDegree(r)<=1||(n[r].setPos(i.x,i.y),i.x>=c&&(c=i.x),i.x<=u&&(u=i.x),i.y>=d&&(d=i.y),i.y<=h&&(h=i.y))}const f=Math.max(c-u,d-h),p=new Tx({xmid:(c+u)/2,ymid:(d+h)/2,length:f,massCenter:o,mass:l}),g=new wx(p);for(let e=0;e<l;e+=1){const{id:r}=s[e];a&&t.getDegree(r)<=1||n[r].in(p)&&g.insert(n[r])}for(let r=0;r<l;r+=1){const{id:l,data:u}=s[r],c=t.getDegree(l);if(a&&c<=1)continue;n[l].resetForce(),g.updateForce(n[l]),e[l][0]-=n[l].fx,e[l][1]-=n[l].fy;const h=[u.x-o[0],u.y-o[1]];let d=Math.hypot(h[0],h[1]);d=d<1e-4?1e-4:d,h[0]=h[0]/d,h[1]=h[1]/d;const f=i*(c+1);e[l][0]-=f*h[0],e[l][1]-=f*h[1]}return e}getRepGraForces(t,e,n,r,i,o,a){const{preventOverlap:s,kr:l,kg:u,center:c,prune:h}=a,d=t.getAllNodes(),f=d.length;for(let a=0;a<f;a+=1){const p=d[a],g=t.getDegree(p.id);for(let u=a+1;u<f;u+=1){const a=d[u],c=t.getDegree(a.id);if(h&&(g<=1||c<=1))continue;const f=[a.data.x-p.data.x,a.data.y-p.data.y];let v=Math.hypot(f[0],f[1]);v=v<1e-4?1e-4:v,f[0]=f[0]/v,f[1]=f[1]/v,s&&e<n&&(v=v-o[p.id]-o[a.id]);let m=l*(g+1)*(c+1)/v;s&&e<n&&v<0?m=i*(g+1)*(c+1):s&&e<n&&0===v?m=0:s&&e<n&&v>0&&(m=l*(g+1)*(c+1)/v),r[p.id][0]-=m*f[0],r[a.id][0]+=m*f[0],r[p.id][1]-=m*f[1],r[a.id][1]+=m*f[1]}const v=[p.data.x-c[0],p.data.y-c[1]],m=Math.hypot(v[0],v[1]);v[0]=v[0]/m,v[1]=v[1]/m;const y=u*(g+1);r[p.id][0]-=y*v[0],r[p.id][1]-=y*v[1]}return r}updatePos(t,e,n,r,i){const{ks:o,tao:a,prune:s,ksmax:l}=i,u=t.getAllNodes(),c=u.length,h=[],d=[];let f=0,p=0,g=r;for(let r=0;r<c;r+=1){const{id:i}=u[r],o=t.getDegree(i);if(s&&o<=1)continue;const a=[e[i][0]-n[i][0],e[i][1]-n[i][1]],l=Math.hypot(a[0],a[1]),c=[e[i][0]+n[i][0],e[i][1]+n[i][1]],g=Math.hypot(c[0],c[1]);h[r]=l,d[r]=g/2,f+=(o+1)*h[r],p+=(o+1)*d[r]}const v=g;g=a*p/f,0!==v&&(g=g>1.5*v?1.5*v:g);for(let n=0;n<c;n+=1){const{id:r,data:i}=u[n],a=t.getDegree(r);if(s&&a<=1)continue;if(I(i.fx)&&I(i.fy))continue;let c=o*g/(1+g*Math.sqrt(h[n])),d=Math.hypot(e[r][0],e[r][1]);d=d<1e-4?1e-4:d;const f=l/d;c=c>f?f:c;const p=c*e[r][0],v=c*e[r][1];t.mergeNodeData(r,{x:i.x+p,y:i.y+v})}return g}},circular:class{constructor(t={}){this.options=t,this.id="circular",this.options=Object.assign(Object.assign({},hi),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericCircularLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){yield this.genericCircularLayout(!0,t,e)}))}genericCircularLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{width:i,height:o,center:a,divisions:s,startAngle:l=0,endAngle:u=2*Math.PI,angleRatio:c,ordering:h,clockwise:d,nodeSpacing:f,nodeSize:p}=r,g=e.getAllNodes(),v=e.getAllEdges(),[m,y,E]=fi(i,o,a),_=null==g?void 0:g.length;if(!_||1===_)return ci(e,t,E);const b=(u-l)/_;let{radius:x,startRadius:S,endRadius:M}=r;if(f){const t=oi(10,f),e=ai(10,p);let n=-1/0;g.forEach((t=>{const r=e(t);n<r&&(n=r)}));let r=0;g.forEach(((e,i)=>{r+=0===i?n||10:(t(e)||0)+(n||10)})),x=r/(2*Math.PI)}else x||S||M?!S&&M?S=M:S&&!M&&(M=S):x=Math.min(y,m)/2;const A=b*c;let R=[];R="topology"===h?di(e,g):"topology-directed"===h?di(e,g,!0):"degree"===h?function(t,e){const n=[];return e.forEach(((t,e)=>{n.push(ii(t))})),n.sort(((e,n)=>t.getDegree(e.id,"both")-t.getDegree(n.id,"both"))),n}(e,g):g.map((t=>ii(t)));const T=Math.ceil(_/s);for(let t=0;t<_;++t){let e=x;e||null===S||null===M||(e=S+t*(M-S)/(_-1)),e||(e=10+100*t/(_-1));let n=l+t%T*A+2*Math.PI/s*Math.floor(t/T);d||(n=u-t%T*A-2*Math.PI/s*Math.floor(t/T)),R[t].data.x=E[0]+Math.cos(n)*e,R[t].data.y=E[1]+Math.sin(n)*e}t&&R.forEach((t=>{e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})}));return{nodes:R,edges:v}}))}},concentric:gi,"d3-force":Ba,dagre:Ax,dendrogram:vL.dendrogram,force:ki,fruchterman:class{constructor(t={}){this.options=t,this.id="fruchterman",this.timeInterval=0,this.running=!1,this.options=Object.assign(Object.assign({},Nx),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericFruchtermanLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericFruchtermanLayout(!0,t,e)}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval),this.running=!1}tick(t=this.options.maxIteration||1){if(this.lastResult)return this.lastResult;for(let e=0;e<t;e++)this.runOneStep(this.lastGraph,this.lastClusterMap,this.lastOptions);const e={nodes:this.lastLayoutNodes,edges:this.lastLayoutEdges};return this.lastAssign&&e.nodes.forEach((t=>this.lastGraph.mergeNodeData(t.id,{x:t.data.x,y:t.data.y,z:3===this.options.dimensions?t.data.z:void 0}))),e}genericFruchtermanLayout(t,e,n){return o(this,void 0,void 0,(function*(){if(this.running)return;const r=this.formatOptions(n),{dimensions:i,width:o,height:a,center:s,clustering:l,nodeClusterBy:u,maxIteration:c,onTick:h}=r,d=e.getAllNodes(),f=e.getAllEdges();if(!(null==d?void 0:d.length)){const t={nodes:[],edges:f};return this.lastResult=t,t}if(1===d.length){t&&e.mergeNodeData(d[0].id,{x:s[0],y:s[1],z:3===i?s[2]:void 0});const n={nodes:[Object.assign(Object.assign({},d[0]),{data:Object.assign(Object.assign({},d[0].data),{x:s[0],y:s[1],z:3===i?s[2]:void 0})})],edges:f};return this.lastResult=n,n}const p=d.map((t=>ii(t,[o,a]))),g=new v({nodes:p,edges:f}),m={};if(l&&p.forEach((t=>{const e=t.data[u];m[e]||(m[e]={name:e,cx:0,cy:0,count:0})})),this.lastLayoutNodes=p,this.lastLayoutEdges=f,this.lastAssign=t,this.lastGraph=g,this.lastOptions=r,this.lastClusterMap=m,"undefined"==typeof window)return;let y=0;return new Promise((n=>{this.timeInterval=window.setInterval((()=>{this.running?(this.runOneStep(g,m,r),t&&p.forEach((({id:t,data:n})=>e.mergeNodeData(t,{x:n.x,y:n.y,z:3===i?n.z:void 0}))),null==h||h({nodes:p,edges:f}),y++,y>=c&&(window.clearInterval(this.timeInterval),n({nodes:p,edges:f}))):n({nodes:p,edges:f})}),0),this.running=!0}))}))}formatOptions(t={}){const e=Object.assign(Object.assign({},this.options),t),{clustering:n,nodeClusterBy:r}=e,{center:i,width:o,height:a}=e;return e.width=o||"undefined"==typeof window?o:window.innerWidth,e.height=a||"undefined"==typeof window?a:window.innerHeight,e.center=i||[e.width/2,e.height/2],e.clustering=n&&!!r,e}runOneStep(t,e,n){const{dimensions:r,height:i,width:o,gravity:a,center:s,speed:l,clustering:u,nodeClusterBy:c,clusterGravity:h}=n,d=i*o,f=Math.sqrt(d)/10,p=t.getAllNodes(),g=d/(p.length+1),v=Math.sqrt(g),m={};if(this.applyCalculate(t,m,v,g),u){for(const t in e)e[t].cx=0,e[t].cy=0,e[t].count=0;p.forEach((t=>{const{data:n}=t,r=e[n[c]];I(n.x)&&(r.cx+=n.x),I(n.y)&&(r.cy+=n.y),r.count++}));for(const t in e)e[t].cx/=e[t].count,e[t].cy/=e[t].count;const t=h||a;p.forEach(((n,r)=>{const{id:i,data:o}=n;if(!I(o.x)||!I(o.y))return;const a=e[o[c]],s=Math.sqrt((o.x-a.cx)*(o.x-a.cx)+(o.y-a.cy)*(o.y-a.cy)),l=v*t;m[i].x-=l*(o.x-a.cx)/s,m[i].y-=l*(o.y-a.cy)/s}))}p.forEach(((t,e)=>{const{id:n,data:i}=t;if(!I(i.x)||!I(i.y))return;const o=.01*v*a;m[n].x-=o*(i.x-s[0]),m[n].y-=o*(i.y-s[1]),3===r&&(m[n].z-=o*(i.z-s[2]))})),p.forEach(((e,n)=>{const{id:i,data:o}=e;if(I(o.fx)&&I(o.fy))return o.x=o.fx,o.y=o.fy,void(3===r&&(o.z=o.fz));if(!I(o.x)||!I(o.y))return;const a=Math.sqrt(m[i].x*m[i].x+m[i].y*m[i].y+(3===r?m[i].z*m[i].z:0));if(a>0){const e=Math.min(f*(l/800),a);t.mergeNodeData(i,{x:o.x+m[i].x/a*e,y:o.y+m[i].y/a*e,z:3===r?o.z+m[i].z/a*e:void 0})}}))}applyCalculate(t,e,n,r){this.calRepulsive(t,e,r),this.calAttractive(t,e,n)}calRepulsive(t,e,n){const r=t.getAllNodes();r.forEach((({data:t,id:i},o)=>{e[i]={x:0,y:0,z:0},r.forEach((({data:r,id:a},s)=>{if(o<=s||!I(t.x)||!I(r.x)||!I(t.y)||!I(r.y))return;let l=t.x-r.x,u=t.y-r.y,c=3===this.options.dimensions?t.z-r.z:0,h=l*l+u*u+c*c;0===h&&(h=1,l=.01,u=.01,c=.01);const d=n/h,f=l*d,p=u*d,g=c*d;e[i].x+=f,e[i].y+=p,e[a].x-=f,e[a].y-=p,3===this.options.dimensions&&(e[i].z+=g,e[a].z-=g)}))}))}calAttractive(t,e,n){t.getAllEdges().forEach((r=>{const{source:i,target:o}=r;if(!i||!o||i===o)return;const{data:a}=t.getNode(i),{data:s}=t.getNode(o);if(!(I(s.x)&&I(a.x)&&I(s.y)&&I(a.y)))return;const l=s.x-a.x,u=s.y-a.y,c=3===this.options.dimensions?s.z-a.z:0,h=Math.sqrt(l*l+u*u+c*c)/n,d=l*h,f=u*h,p=c*h;e[i].x+=d,e[i].y+=f,e[o].x-=d,e[o].y-=f,3===this.options.dimensions&&(e[i].z+=p,e[o].z-=p)}))}},grid:class{constructor(t={}){this.options=t,this.id="grid",this.options=Object.assign(Object.assign({},Cx),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericGridLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericGridLayout(!0,t,e)}))}genericGridLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{begin:i=[0,0],condense:o,preventOverlapPadding:a,preventOverlap:s,rows:l,cols:u,nodeSpacing:c,nodeSize:h,width:d,height:f,position:p}=r;let{sortBy:g}=r;const v=e.getAllNodes(),m=e.getAllEdges(),y=null==v?void 0:v.length;if(!y||1===y)return ci(e,t,i);const E=v.map((t=>ii(t)));"id"===g||N(g)&&void 0!==E[0].data[g]||(g="degree"),"degree"===g?E.sort(((t,n)=>e.getDegree(n.id,"both")-e.getDegree(t.id,"both"))):"id"===g?E.sort(((t,e)=>I(e.id)&&I(t.id)?e.id-t.id:`${t.id}`.localeCompare(`${e.id}`))):E.sort(((t,e)=>e.data[g]-t.data[g]));const _=d||"undefined"==typeof window?d:window.innerWidth,b=f||"undefined"==typeof window?f:window.innerHeight,x=y,S={rows:l,cols:u};if(null!=l&&null!=u)S.rows=l,S.cols=u;else if(null!=l&&null==u)S.rows=l,S.cols=Math.ceil(x/S.rows);else if(null==l&&null!=u)S.cols=u,S.rows=Math.ceil(x/S.cols);else{const t=Math.sqrt(x*b/_);S.rows=Math.round(t),S.cols=Math.round(_/b*t)}if(S.rows=Math.max(S.rows,1),S.cols=Math.max(S.cols,1),S.cols*S.rows>x){const t=Ox(S),e=Ix(S);(t-1)*e>=x?Ox(S,t-1):(e-1)*t>=x&&Ix(S,e-1)}else for(;S.cols*S.rows<x;){const t=Ox(S),e=Ix(S);(e+1)*t>=x?Ix(S,e+1):Ox(S,t+1)}let M=o?0:_/S.cols,A=o?0:b/S.rows;if(s||c){const t=oi(10,c),n=ai(30,h,!1);E.forEach((r=>{r.data.x&&r.data.y||(r.data.x=0,r.data.y=0);const i=e.getNode(r.id),o=n(i)||30;let s,l;Qr(o)?(s=o[0],l=o[1]):(s=o,l=o);const u=void 0!==t?t(r):a,c=s+u,h=l+u;M=Math.max(M,c),A=Math.max(A,h)}))}const R={},T={row:0,col:0},w={};for(let t=0;t<E.length;t++){const n=E[t];let r;if(p&&(r=p(e.getNode(n.id))),r&&(void 0!==r.row||void 0!==r.col)){const t={row:r.row,col:r.col};if(void 0===t.col)for(t.col=0;Lx(R,t);)t.col++;else if(void 0===t.row)for(t.row=0;Lx(R,t);)t.row++;w[n.id]=t,Dx(R,t)}kx(n,i,M,A,w,S,T,R)}const P={nodes:E,edges:m};return t&&E.forEach((t=>{e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})})),P}))}},indented:vL.indented,mds:Vo,mindmap:vL.mindmap,radial:class{constructor(t={}){this.options=t,this.id="radial",this.options=Object.assign(Object.assign({},zx),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericRadialLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericRadialLayout(!0,t,e)}))}genericRadialLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{width:i,height:o,center:a,focusNode:s,unitRadius:l,nodeSize:u,nodeSpacing:c,strictRadial:h,preventOverlap:d,maxPreventOverlapIteration:f,sortBy:p,linkDistance:g=50,sortStrength:v=10,maxIteration:m=1e3}=r,y=e.getAllNodes(),E=e.getAllEdges(),_=i||"undefined"==typeof window?i:window.innerWidth,b=o||"undefined"==typeof window?o:window.innerHeight,x=a||[_/2,b/2];if(!(null==y?void 0:y.length)||1===y.length)return ci(e,t,x);let S=y[0];if(N(s)){for(let t=0;t<y.length;t++)if(y[t].id===s){S=y[t];break}}else S=s||y[0];const M=jx(y,S.id),A=ti({nodes:y,edges:E}),R=Jr(A),T=Xx(R,M);Hx(R,M,T+1);const w=R[M];let P=_-x[0]>x[0]?x[0]:_-x[0],C=b-x[1]>x[1]?x[1]:b-x[1];0===P&&(P=_/2),0===C&&(C=b/2);const O=Math.min(P,C),I=Math.max(...w),L=[],D=l||O/I;w.forEach(((t,e)=>{L[e]=t*D}));const B=Vx(y,R,g,L,D,p,v),k=Wx(B),F=((t,e,n)=>{try{const n=Uo.mul(Uo.pow(e,2),-.5),r=n.mean("row"),i=n.mean("column"),o=n.mean();n.add(o).subRowVector(r).subColumnVector(i);const a=new Go(n),s=Uo.sqrt(a.diagonalMatrix).diagonal();return a.leftSingularVectors.toJSON().map((e=>Uo.mul([e],[s]).toJSON()[0].splice(0,t)))}catch(t){const r=[];for(let t=0;t<e.length;t++){const t=Math.random()*n,e=Math.random()*n;r.push([t,e])}return r}})(g,B,g);let U,G=F.map((([t,e])=>({x:(isNaN(t)?Math.random()*g:t)-F[M][0],y:(isNaN(e)?Math.random()*g:e)-F[M][1]})));if(this.run(m,G,k,B,L,M),d){U=si(u,c);const t={nodes:y,nodeSizeFunc:U,positions:G,radii:L,height:b,width:_,strictRadial:Boolean(h),focusIdx:M,iterations:f||200,k:G.length/4.5};G=((t,e)=>{const n=Object.assign(Object.assign({},Fx),e),{positions:r,iterations:i,width:o,k:a,speed:s=100,strictRadial:l,focusIdx:u,radii:c=[],nodeSizeFunc:h}=n,d=t.getAllNodes(),f=[],p=o/10;for(let t=0;t<i;t++)r.forEach(((t,e)=>{f[e]={x:0,y:0}})),Ux(d,r,f,a,c,h),Gx(r,f,s,l,u,p,o,c);return r})(e,t)}const z=[];G.forEach(((t,e)=>{const n=ii(y[e]);n.data.x=t.x+x[0],n.data.y=t.y+x[1],z.push(n)})),t&&z.forEach((t=>e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})));return{nodes:z,edges:E}}))}run(t,e,n,r,i,o){for(let a=0;a<=t;a++){const s=a/t;this.oneIteration(s,e,i,r,n,o)}}oneIteration(t,e,n,r,i,o){const a=1-t;e.forEach(((s,l)=>{const u=ei(s,{x:0,y:0}),c=0===u?0:1/u;if(l===o)return;let h=0,d=0,f=0;e.forEach(((t,e)=>{if(l===e)return;const n=ei(s,t),o=0===n?0:1/n,a=r[e][l];f+=i[l][e],h+=i[l][e]*(t.x+a*(s.x-t.x)*o),d+=i[l][e]*(t.y+a*(s.y-t.y)*o)}));const p=0===n[l]?0:1/n[l];f*=a,f+=t*p*p,h*=a,h+=t*p*s.x*c,s.x=h/f,d*=a,d+=t*p*s.y*c,s.y=d/f}))}},random:class{constructor(t={}){this.options=t,this.id="random",this.options=Object.assign(Object.assign({},Yx),t)}execute(t,e){return o(this,void 0,void 0,(function*(){return this.genericRandomLayout(!1,t,e)}))}assign(t,e){return o(this,void 0,void 0,(function*(){this.genericRandomLayout(!0,t,e)}))}genericRandomLayout(t,e,n){return o(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},this.options),n),{center:i,width:o,height:a}=r,s=e.getAllNodes(),l=o||"undefined"==typeof window?o:window.innerWidth,u=a||"undefined"==typeof window?a:window.innerHeight,c=i||[l/2,u/2],h=[];s&&s.forEach((t=>{h.push({id:t.id,data:{x:.9*(Math.random()-.5)*l+c[0],y:.9*(Math.random()-.5)*u+c[1]}})})),t&&h.forEach((t=>e.mergeNodeData(t.id,{x:t.data.x,y:t.data.y})));return{nodes:h,edges:e.getAllEdges()}}))}}},node:{circle:tO,diamond:class extends eO{constructor(t){super(t)}getPoints(t){const[e,n]=this.getSize(t);return function(t,e){return[[0,-e/2],[t/2,0],[0,e/2],[-t/2,0]]}(e,n)}getIntersectPoint(t){const{points:e}=this.getKeyStyle(this.parsedAttributes);return fC(t,[this.attributes.x,this.attributes.y],e).point}},ellipse:oO,hexagon:class extends eO{constructor(t){super(t)}getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){return[[0,e=this.getOuterR(t)],[e*Math.sqrt(3)/2,e/2],[e*Math.sqrt(3)/2,-e/2],[0,-e],[-e*Math.sqrt(3)/2,-e/2],[-e*Math.sqrt(3)/2,e/2]];var e}getIconStyle(t){const e=super.getIconStyle(t),n=this.getOuterR(t)*SC;return!!e&&{width:n,height:n,...e}}},html:aO,image:class t extends JC{static defaultStyleProps={size:50};constructor(e){super(DC({style:t.defaultStyleProps},e))}getKeyStyle(t){const[e,n]=this.getSize(t),{fillOpacity:r,opacity:i=r,...o}=super.getKeyStyle(t);return{opacity:i,...o,width:e,height:n,x:-e/2,y:-n/2}}getHaloStyle(t){if(!1===t.halo)return!1;const{fill:e,stroke:n,...r}=this.getKeyStyle(t),i=CC(this.getGraphicStyle(t),"halo"),o=Number(i.lineWidth),[a,s]=YN(this.getSize(t),[o,o]);return{...r,...i,width:a,height:s,fill:"transparent",x:-a/2,y:-s/2}}getIconStyle(t){const e=super.getIconStyle(t),[n,r]=this.getSize(t);return!!e&&{width:n*SC,height:r*SC,...e}}drawKeyShape(t,e){return this.upsert("key",kw,this.getKeyStyle(t),e)}drawHaloShape(t,e){this.upsert("halo",Vw,this.getHaloStyle(t),e)}},rect:sO,star:class extends eO{constructor(t){super(t)}getInnerR(t){return t.innerR||3*this.getOuterR(t)/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){return e=this.getOuterR(t),n=this.getInnerR(t),[[0,-e],[n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)],[e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[0,n],[-e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[-n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[-e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[-n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)]];var e,n}getIconStyle(t){const e=super.getIconStyle(t),n=2*this.getInnerR(t)*SC;return!!e&&{width:n,height:n,...e}}getPortXY(t,e){const{placement:n="top"}=e;return VO(this.getKey().getLocalBounds(),n,function(t,e){const n={};return n.top=[0,-t],n.left=[-t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n["left-bottom"]=[-t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.bottom=[0,e],n["right-bottom"]=[t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.right=n.default=[t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n}(this.getOuterR(t),this.getInnerR(t)),!1)}},donut:nO,triangle:lO},palette:{spectral:["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],tableau:["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],oranges:["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],greens:["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],blues:["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"]},theme:{dark:Az,light:Rz},plugin:{"bubble-sets":sD,"grid-line":hD,contextmenu:cD,history:vD,timebar:dz,hull:zD,legend:dG,toolbar:vz,tooltip:mz,watermark:_z,background:_L},transform:{"update-related-edges":class extends Tz{beforeDraw(t,e){const{stage:n}=e;if("visibility"===n)return t;const{model:r}=this.context,{update:{nodes:i,edges:o,combos:a}}=t,s=(t,e)=>{r.getRelatedEdgesData(e).forEach((t=>!o.has(xN(t))&&o.set(xN(t),t)))};return i.forEach(s),a.forEach(s),t}},"arrange-draw-order":class extends Tz{beforeDraw(t){const{model:e}=this.context,n=t.add.combos,r=t=>{const n=[];return t.forEach(((t,r)=>{const i=e.getAncestorsData(r,"combo").map((t=>xN(t))).reverse();n.push([r,t,i.length])})),new Map(n.sort((([,,t],[,,e])=>e-t)).map((([t,e])=>[t,e])))};return t.add.combos=r(n),t.update.combos=r(t.update.combos),t}},"collapse-expand-combo":class extends Tz{beforeDraw(t,e){if("visibility"===e.stage)return t;const{model:n}=this.context,{add:r,update:i}=t,o=[...t.update.combos.entries(),...t.add.combos.entries()];for(;o.length;){const[e,a]=o.pop();if(wC(a)){const a=n.getDescendantsData(e),s=a.map(xN),{internal:l,external:u}=wO(s,(t=>n.getRelatedEdgesData(t)));a.forEach((e=>{const r=xN(e),i=o.findIndex((([t])=>t===r));-1!==i&&o.splice(i,1);const a=n.getElementType(r);wz(t,"remove",a,e)})),l.forEach((e=>wz(t,"remove","edge",e))),u.forEach((t=>{const e=xN(t),n=this.context.element?.getElement(e);n?i.edges.set(e,t):r.edges.set(e,t)}))}else{const r=n.getChildrenData(e),i=r.map(xN),{edges:a}=wO(i,(t=>n.getRelatedEdgesData(t)));[...r,...a].forEach((e=>{const r=xN(e),i=n.getElementType(r),a=this.context.element?.getElement(r);wz(t,a?"update":"add",i,e),"combo"===i&&o.push([r,e])}))}}return t}},"collapse-expand-node":class extends Tz{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(Pz(e,"add","node",t),wC(t))return;const n=xN(t);Pz(e,"add","node",t);this.context.model.getRelatedEdgesData(n,"out").forEach((t=>{wz(e,"add","edge",t)}));this.context.model.getChildrenData(n).forEach((t=>{this.handleExpand(t,e)}))}beforeDraw(t){const{add:{nodes:e},update:{nodes:n}}=t,r=new Map,i=new Map;e.forEach(((t,e)=>{wC(t)&&r.set(e,t)})),n.forEach(((t,e)=>{const n=this.getElement(e);if(!n)return;const o=n.attributes.collapsed;wC(t)?o||r.set(e,t):o&&i.set(e,t)}));const o=new Set;return r.forEach(((e,n)=>{this.context.model.getDescendantsData(n).forEach((e=>{const n=xN(e);if(o.has(n))return;wz(t,"remove","node",e);this.context.model.getRelatedEdgesData(n).forEach((e=>{wz(t,"remove","edge",e)})),o.add(n)}))})),i.forEach(((e,n)=>{this.context.model.getAncestorsData(n,"tree").some(wC)?wz(t,"remove","node",e):this.handleExpand(e,t)})),t}},"process-parallel-edges":Iz,"get-edge-actual-ends":class extends Tz{beforeDraw(t){const{add:e,update:n}=t,{model:r}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach((([,t])=>{Cz(r,t)})),t}}}},Fz={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{}};gw.enableCSSParsing=!1,Object.entries(kz).forEach((([t,e])=>{Object.entries(e).forEach((([e,n])=>{!function(t,e,n){const r=Fz[t][e];r?r!==n&&console.error(`The extension ${e} of ${t} has been registered before.`):Object.assign(Fz[t],{[e]:n})}(t,e,n)}))}));class Uz extends IN{static defaultOptions={enable:!0,mode:"orbiting",trigger:[]};shortcut;get camera(){return this.context.canvas.getCamera()}constructor(t,e){super(t,{...Uz.defaultOptions,...e}),this.shortcut=new _C(t.graph),this.bindEvents()}update(t){super.update(t),this.setCameraType()}setCameraType=()=>{const{mode:t}=this.options,e={orbiting:_M.ORBITING,exploring:_M.EXPLORING,tracking:_M.TRACKING};this.camera.setType(e[t])};getRatio(){const{sensitivity:t,mode:e}=this.options;return t?t/10:"tracking"===e?.1:1}onDrag=t=>{if(!this.options.enable)return;const{x:e,y:n}=t.movement,r=this.getRatio();this.camera.rotate(e*r,-n*r,0)};bindEvents(){const{graph:t}=this.context;t.once(gN.BEFORE_DRAW,this.setCameraType),this.shortcut.unbindAll(),this.shortcut.bind([...this.options.trigger,"drag"],this.onDrag)}destroy(){this.shortcut.destroy(),super.destroy()}}class Gz extends EL{static defaultOptions={enable:!0,trigger:["wheel"],sensitivity:1};shortcut;get camera(){return this.context.canvas.getCamera()}constructor(t,e){super(t,{...Gz.defaultOptions,...e}),this.shortcut=new _C(t.graph),this.bindEvents()}getAngle(t){const{sensitivity:e}=this.options;return-t*e/10}onRoll=t=>{const e=this.camera.getRoll(),n=t.deltaY;this.camera.setRoll(e+this.getAngle(n))};bindEvents(){const{trigger:t}=this.options;this.shortcut.unbindAll(),this.shortcut.bind([...t,"wheel"],this.onRoll)}}var zz,Vz,Wz,jz,Hz,Xz,Yz,Kz,$z,qz,Zz,Qz,Jz,tV,eV,nV,rV,iV,oV,aV,sV,lV,uV,cV,hV,dV,fV;function pV(t,e,n,r){return{dimension:nV.TEXTURE_2D,format:t,width:e,height:n,depthOrArrayLayers:1,mipLevelCount:r,usage:rV.SAMPLED}}function gV(t,e,n){return t<<16|e<<8|n}function vV(t){return t>>>8&255}function mV(t){return t>>>16&255}function yV(t){return 255&t}function EV(t){switch(t){case cV.F32:case cV.U32:case cV.S32:return 4;case cV.U16:case cV.S16:case cV.F16:return 2;case cV.U8:case cV.S8:return 1;default:throw new Error("whoops")}}function _V(t){return EV(mV(t))}function bV(t){var e=yV(t);if(e&dV.Depth)return aV.Depth;if(e&dV.Normalized)return aV.Float;var n=mV(t);if(n===cV.F16||n===cV.F32)return aV.Float;if(n===cV.U8||n===cV.U16||n===cV.U32)return aV.Uint;if(n===cV.S8||n===cV.S16||n===cV.S32)return aV.Sint;throw new Error("whoops")}function xV(t,e){if(void 0===e&&(e=""),!t)throw new Error("Assert fail: ".concat(e))}function SV(t){if(null!=t)return t;throw new Error("Missing object")}function MV(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}function AV(t,e){t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a}function RV(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}function TV(t,e,n,r){return void 0===r&&(r=1),{r:t,g:e,b:n,a:r}}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.ALWAYS=519]="ALWAYS",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.GEQUAL=518]="GEQUAL",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.RGB32F_EXT=34837]="RGB32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",t[t.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",t[t.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",t[t.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",t[t.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",t[t.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",t[t.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",t[t.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",t[t.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",t[t.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",t[t.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",t[t.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",t[t.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",t[t.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",t[t.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",t[t.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",t[t.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",t[t.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",t[t.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",t[t.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",t[t.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",t[t.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",t[t.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",t[t.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",t[t.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",t[t.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",t[t.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",t[t.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",t[t.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",t[t.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",t[t.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",t[t.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",t[t.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",t[t.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",t[t.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",t[t.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(zz||(zz={})),function(t){t[t.Buffer=0]="Buffer",t[t.Texture=1]="Texture",t[t.RenderTarget=2]="RenderTarget",t[t.Sampler=3]="Sampler",t[t.Program=4]="Program",t[t.Bindings=5]="Bindings",t[t.InputLayout=6]="InputLayout",t[t.RenderPipeline=7]="RenderPipeline",t[t.ComputePipeline=8]="ComputePipeline",t[t.Readback=9]="Readback",t[t.QueryPool=10]="QueryPool",t[t.RenderBundle=11]="RenderBundle"}(Vz||(Vz={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Wz||(Wz={})),function(t){t[t.CCW=2305]="CCW",t[t.CW=2304]="CW"}(jz||(jz={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(Hz||(Hz={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC=768]="SRC",t[t.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",t[t.DST=774]="DST",t[t.ONE_MINUS_DST=775]="ONE_MINUS_DST",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.CONST=32769]="CONST",t[t.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(Xz||(Xz={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBSTRACT=32778]="SUBSTRACT",t[t.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"}(Yz||(Yz={})),function(t){t[t.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",t[t.REPEAT=1]="REPEAT",t[t.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(Kz||(Kz={})),function(t){t[t.POINT=0]="POINT",t[t.BILINEAR=1]="BILINEAR"}($z||($z={})),function(t){t[t.NO_MIP=0]="NO_MIP",t[t.NEAREST=1]="NEAREST",t[t.LINEAR=2]="LINEAR"}(qz||(qz={})),function(t){t[t.POINTS=0]="POINTS",t[t.TRIANGLES=1]="TRIANGLES",t[t.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",t[t.LINES=3]="LINES",t[t.LINE_STRIP=4]="LINE_STRIP"}(Zz||(Zz={})),function(t){t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(Qz||(Qz={})),function(t){t[t.STATIC=1]="STATIC",t[t.DYNAMIC=2]="DYNAMIC"}(Jz||(Jz={})),function(t){t[t.VERTEX=1]="VERTEX",t[t.INSTANCE=2]="INSTANCE"}(tV||(tV={})),function(t){t.LOADED="loaded"}(eV||(eV={})),function(t){t[t.TEXTURE_2D=0]="TEXTURE_2D",t[t.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",t[t.TEXTURE_3D=2]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(nV||(nV={})),function(t){t[t.SAMPLED=1]="SAMPLED",t[t.RENDER_TARGET=2]="RENDER_TARGET",t[t.STORAGE=4]="STORAGE"}(rV||(rV={})),function(t){t[t.NONE=0]="NONE",t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t[t.RGB=7]="RGB",t[t.ALL=15]="ALL"}(iV||(iV={})),function(t){t[t.KEEP=7680]="KEEP",t[t.ZERO=0]="ZERO",t[t.REPLACE=7681]="REPLACE",t[t.INVERT=5386]="INVERT",t[t.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",t[t.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",t[t.INCREMENT_WRAP=34055]="INCREMENT_WRAP",t[t.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(oV||(oV={})),function(t){t[t.Float=0]="Float",t[t.UnfilterableFloat=1]="UnfilterableFloat",t[t.Uint=2]="Uint",t[t.Sint=3]="Sint",t[t.Depth=4]="Depth"}(aV||(aV={})),function(t){t[t.LOWER_LEFT=0]="LOWER_LEFT",t[t.UPPER_LEFT=1]="UPPER_LEFT"}(sV||(sV={})),function(t){t[t.NEGATIVE_ONE=0]="NEGATIVE_ONE",t[t.ZERO=1]="ZERO"}(lV||(lV={})),function(t){t[t.OcclusionConservative=0]="OcclusionConservative"}(uV||(uV={})),function(t){t[t.U8=1]="U8",t[t.U16=2]="U16",t[t.U32=3]="U32",t[t.S8=4]="S8",t[t.S16=5]="S16",t[t.S32=6]="S32",t[t.F16=7]="F16",t[t.F32=8]="F32",t[t.BC1=65]="BC1",t[t.BC2=66]="BC2",t[t.BC3=67]="BC3",t[t.BC4_UNORM=68]="BC4_UNORM",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5_UNORM=70]="BC5_UNORM",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.U16_PACKED_5551=97]="U16_PACKED_5551",t[t.U16_PACKED_565=98]="U16_PACKED_565",t[t.D24=129]="D24",t[t.D32F=130]="D32F",t[t.D24S8=131]="D24S8",t[t.D32FS8=132]="D32FS8"}(cV||(cV={})),function(t){t[t.R=1]="R",t[t.RG=2]="RG",t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA",t[t.A=5]="A"}(hV||(hV={})),function(t){t[t.None=0]="None",t[t.Normalized=1]="Normalized",t[t.sRGB=2]="sRGB",t[t.Depth=4]="Depth",t[t.Stencil=8]="Stencil",t[t.RenderTarget=16]="RenderTarget",t[t.Luminance=32]="Luminance"}(dV||(dV={})),function(t){t[t.ALPHA=gV(cV.U8,hV.A,dV.None)]="ALPHA",t[t.U8_LUMINANCE=gV(cV.U8,hV.A,dV.Luminance)]="U8_LUMINANCE",t[t.F16_LUMINANCE=gV(cV.F16,hV.A,dV.Luminance)]="F16_LUMINANCE",t[t.F32_LUMINANCE=gV(cV.F32,hV.A,dV.Luminance)]="F32_LUMINANCE",t[t.F16_R=gV(cV.F16,hV.R,dV.None)]="F16_R",t[t.F16_RG=gV(cV.F16,hV.RG,dV.None)]="F16_RG",t[t.F16_RGB=gV(cV.F16,hV.RGB,dV.None)]="F16_RGB",t[t.F16_RGBA=gV(cV.F16,hV.RGBA,dV.None)]="F16_RGBA",t[t.F32_R=gV(cV.F32,hV.R,dV.None)]="F32_R",t[t.F32_RG=gV(cV.F32,hV.RG,dV.None)]="F32_RG",t[t.F32_RGB=gV(cV.F32,hV.RGB,dV.None)]="F32_RGB",t[t.F32_RGBA=gV(cV.F32,hV.RGBA,dV.None)]="F32_RGBA",t[t.U8_R=gV(cV.U8,hV.R,dV.None)]="U8_R",t[t.U8_R_NORM=gV(cV.U8,hV.R,dV.Normalized)]="U8_R_NORM",t[t.U8_RG=gV(cV.U8,hV.RG,dV.None)]="U8_RG",t[t.U8_RG_NORM=gV(cV.U8,hV.RG,dV.Normalized)]="U8_RG_NORM",t[t.U8_RGB=gV(cV.U8,hV.RGB,dV.None)]="U8_RGB",t[t.U8_RGB_NORM=gV(cV.U8,hV.RGB,dV.Normalized)]="U8_RGB_NORM",t[t.U8_RGB_SRGB=gV(cV.U8,hV.RGB,dV.sRGB|dV.Normalized)]="U8_RGB_SRGB",t[t.U8_RGBA=gV(cV.U8,hV.RGBA,dV.None)]="U8_RGBA",t[t.U8_RGBA_NORM=gV(cV.U8,hV.RGBA,dV.Normalized)]="U8_RGBA_NORM",t[t.U8_RGBA_SRGB=gV(cV.U8,hV.RGBA,dV.sRGB|dV.Normalized)]="U8_RGBA_SRGB",t[t.U16_R=gV(cV.U16,hV.R,dV.None)]="U16_R",t[t.U16_R_NORM=gV(cV.U16,hV.R,dV.Normalized)]="U16_R_NORM",t[t.U16_RG_NORM=gV(cV.U16,hV.RG,dV.Normalized)]="U16_RG_NORM",t[t.U16_RGBA_NORM=gV(cV.U16,hV.RGBA,dV.Normalized)]="U16_RGBA_NORM",t[t.U16_RGBA=gV(cV.U16,hV.RGBA,dV.None)]="U16_RGBA",t[t.U16_RGB=gV(cV.U16,hV.RGB,dV.None)]="U16_RGB",t[t.U16_RG=gV(cV.U16,hV.RG,dV.None)]="U16_RG",t[t.U32_R=gV(cV.U32,hV.R,dV.None)]="U32_R",t[t.U32_RG=gV(cV.U32,hV.RG,dV.None)]="U32_RG",t[t.U32_RGB=gV(cV.U32,hV.RGB,dV.None)]="U32_RGB",t[t.U32_RGBA=gV(cV.U32,hV.RGBA,dV.None)]="U32_RGBA",t[t.S8_R=gV(cV.S8,hV.R,dV.None)]="S8_R",t[t.S8_R_NORM=gV(cV.S8,hV.R,dV.Normalized)]="S8_R_NORM",t[t.S8_RG_NORM=gV(cV.S8,hV.RG,dV.Normalized)]="S8_RG_NORM",t[t.S8_RGB_NORM=gV(cV.S8,hV.RGB,dV.Normalized)]="S8_RGB_NORM",t[t.S8_RGBA_NORM=gV(cV.S8,hV.RGBA,dV.Normalized)]="S8_RGBA_NORM",t[t.S16_R=gV(cV.S16,hV.R,dV.None)]="S16_R",t[t.S16_RG=gV(cV.S16,hV.RG,dV.None)]="S16_RG",t[t.S16_RG_NORM=gV(cV.S16,hV.RG,dV.Normalized)]="S16_RG_NORM",t[t.S16_RGB_NORM=gV(cV.S16,hV.RGB,dV.Normalized)]="S16_RGB_NORM",t[t.S16_RGBA=gV(cV.S16,hV.RGBA,dV.None)]="S16_RGBA",t[t.S16_RGBA_NORM=gV(cV.S16,hV.RGBA,dV.Normalized)]="S16_RGBA_NORM",t[t.S32_R=gV(cV.S32,hV.R,dV.None)]="S32_R",t[t.S32_RG=gV(cV.S32,hV.RG,dV.None)]="S32_RG",t[t.S32_RGB=gV(cV.S32,hV.RGB,dV.None)]="S32_RGB",t[t.S32_RGBA=gV(cV.S32,hV.RGBA,dV.None)]="S32_RGBA",t[t.U16_RGBA_5551=gV(cV.U16_PACKED_5551,hV.RGBA,dV.Normalized)]="U16_RGBA_5551",t[t.U16_RGB_565=gV(cV.U16_PACKED_565,hV.RGB,dV.Normalized)]="U16_RGB_565",t[t.BC1=gV(cV.BC1,hV.RGBA,dV.Normalized)]="BC1",t[t.BC1_SRGB=gV(cV.BC1,hV.RGBA,dV.Normalized|dV.sRGB)]="BC1_SRGB",t[t.BC2=gV(cV.BC2,hV.RGBA,dV.Normalized)]="BC2",t[t.BC2_SRGB=gV(cV.BC2,hV.RGBA,dV.Normalized|dV.sRGB)]="BC2_SRGB",t[t.BC3=gV(cV.BC3,hV.RGBA,dV.Normalized)]="BC3",t[t.BC3_SRGB=gV(cV.BC3,hV.RGBA,dV.Normalized|dV.sRGB)]="BC3_SRGB",t[t.BC4_UNORM=gV(cV.BC4_UNORM,hV.R,dV.Normalized)]="BC4_UNORM",t[t.BC4_SNORM=gV(cV.BC4_SNORM,hV.R,dV.Normalized)]="BC4_SNORM",t[t.BC5_UNORM=gV(cV.BC5_UNORM,hV.RG,dV.Normalized)]="BC5_UNORM",t[t.BC5_SNORM=gV(cV.BC5_SNORM,hV.RG,dV.Normalized)]="BC5_SNORM",t[t.D24=gV(cV.D24,hV.R,dV.Depth)]="D24",t[t.D24_S8=gV(cV.D24S8,hV.RG,dV.Depth|dV.Stencil)]="D24_S8",t[t.D32F=gV(cV.D32F,hV.R,dV.Depth)]="D32F",t[t.D32F_S8=gV(cV.D32FS8,hV.RG,dV.Depth|dV.Stencil)]="D32F_S8",t[t.U8_RGB_RT=gV(cV.U8,hV.RGB,dV.RenderTarget|dV.Normalized)]="U8_RGB_RT",t[t.U8_RGBA_RT=gV(cV.U8,hV.RGBA,dV.RenderTarget|dV.Normalized)]="U8_RGBA_RT",t[t.U8_RGBA_RT_SRGB=gV(cV.U8,hV.RGBA,dV.RenderTarget|dV.Normalized|dV.sRGB)]="U8_RGBA_RT_SRGB"}(fV||(fV={}));var wV=TV(0,0,0,0);TV(0,0,0,1);var PV=TV(1,1,1,0),NV=TV(1,1,1,1);function CV(t){return!(!t||t&t-1)}function OV(t,e){return null!=t?t:e}function IV(t){return void 0===t?null:t}function LV(t,e,n){t.length=e,t.fill(n)}function DV(t,e){var n=e-1;return t+n&~n}function BV(t,e){return((t+e-1)/e|0)*e}function kV(t,e,n){return n?t|=e:t&=~e,t}function FV(t,e){for(var n=new Array(t),r=0;r<t;r++)n[r]=e();return n}function UV(t,e){t.blendDstFactor=e.blendDstFactor,t.blendSrcFactor=e.blendSrcFactor,t.blendMode=e.blendMode}function GV(t,e){return void 0===t&&(t={}),t.compare=e.compare,t.depthFailOp=e.depthFailOp,t.passOp=e.passOp,t.failOp=e.failOp,t.mask=e.mask,t}function zV(t,e){return void 0===t&&(t={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),UV(t.rgbBlendState,e.rgbBlendState),UV(t.alphaBlendState,e.alphaBlendState),t.channelWriteMask=e.channelWriteMask,t}function VV(t,e){t.length!==e.length&&(t.length=e.length);for(var n=0;n<e.length;n++)t[n]=zV(t[n],e[n])}function WV(t,e){void 0!==e.attachmentsState&&VV(t.attachmentsState,e.attachmentsState),t.blendConstant&&e.blendConstant&&AV(t.blendConstant,e.blendConstant),t.depthCompare=OV(e.depthCompare,t.depthCompare),t.depthWrite=OV(e.depthWrite,t.depthWrite),t.stencilWrite=OV(e.stencilWrite,t.stencilWrite),t.stencilFront&&e.stencilFront&&GV(t.stencilFront,e.stencilFront),t.stencilBack&&e.stencilBack&&GV(t.stencilBack,e.stencilBack),t.cullMode=OV(e.cullMode,t.cullMode),t.frontFace=OV(e.frontFace,t.frontFace),t.polygonOffset=OV(e.polygonOffset,t.polygonOffset),t.polygonOffsetFactor=OV(e.polygonOffsetFactor,t.polygonOffsetFactor),t.polygonOffsetUnits=OV(e.polygonOffsetUnits,t.polygonOffsetUnits)}function jV(t){var e=Object.assign({},t);return e.attachmentsState=[],VV(e.attachmentsState,t.attachmentsState),e.blendConstant=e.blendConstant&&RV(e.blendConstant),e.stencilFront=GV(void 0,t.stencilFront),e.stencilBack=GV(void 0,t.stencilBack),e}var HV={blendMode:Yz.ADD,blendSrcFactor:Xz.ONE,blendDstFactor:Xz.ZERO},XV={attachmentsState:[{channelWriteMask:iV.ALL,rgbBlendState:HV,alphaBlendState:HV}],blendConstant:RV(wV),depthWrite:!0,depthCompare:Wz.LEQUAL,stencilWrite:!1,stencilFront:{compare:Wz.ALWAYS,passOp:oV.KEEP,depthFailOp:oV.KEEP,failOp:oV.KEEP},stencilBack:{compare:Wz.ALWAYS,passOp:oV.KEEP,depthFailOp:oV.KEEP,failOp:oV.KEEP},cullMode:Hz.NONE,frontFace:jz.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};var YV=function(t,e){void 0===t&&(t=null),void 0===e&&(e=XV);var n=jV(e);return null!==t&&WV(n,t),n}({depthCompare:Wz.ALWAYS,depthWrite:!1},XV);function KV(t,e){return void 0===t.attachmentsState&&(t.attachmentsState=[],VV(t.attachmentsState,XV.attachmentsState)),function(t,e){void 0!==e.channelWriteMask&&(t.channelWriteMask=e.channelWriteMask),void 0!==e.rgbBlendMode&&(t.rgbBlendState.blendMode=e.rgbBlendMode),void 0!==e.alphaBlendMode&&(t.alphaBlendState.blendMode=e.alphaBlendMode),void 0!==e.rgbBlendSrcFactor&&(t.rgbBlendState.blendSrcFactor=e.rgbBlendSrcFactor),void 0!==e.alphaBlendSrcFactor&&(t.alphaBlendState.blendSrcFactor=e.alphaBlendSrcFactor),void 0!==e.rgbBlendDstFactor&&(t.rgbBlendState.blendDstFactor=e.rgbBlendDstFactor),void 0!==e.alphaBlendDstFactor&&(t.alphaBlendState.blendDstFactor=e.alphaBlendDstFactor)}(t.attachmentsState[0],e),t}var $V,qV={texture:null,sampler:null,formatKind:aV.Float,dimension:nV.TEXTURE_2D};function ZV(t,e,n){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1;return!0}function QV(t,e){for(var n=Array(t.length),r=0;r<t.length;r++)n[r]=e(t[r]);return n}function JV(t,e){return t.texture===e.texture&&t.binding===e.binding}function tW(t,e){return t.buffer===e.buffer&&t.size===e.size&&t.binding===e.binding&&t.offset===e.offset}function eW(t,e){return null===t?null===e:null!==e&&(t.sampler===e.sampler&&t.texture===e.texture&&t.dimension===e.dimension&&t.formatKind===e.formatKind&&t.comparison===e.comparison)}function nW(t,e){return t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings.length===e.samplerBindings.length&&(!!ZV(t.samplerBindings,e.samplerBindings,eW)&&(!!ZV(t.uniformBufferBindings,e.uniformBufferBindings,tW)&&(!!ZV(t.storageBufferBindings,e.storageBufferBindings,tW)&&!!ZV(t.storageTextureBindings,e.storageTextureBindings,JV))))}function rW(t,e){return t.blendMode==e.blendMode&&t.blendSrcFactor===e.blendSrcFactor&&t.blendDstFactor===e.blendDstFactor}function iW(t,e){return!!rW(t.rgbBlendState,e.rgbBlendState)&&(!!rW(t.alphaBlendState,e.alphaBlendState)&&t.channelWriteMask===e.channelWriteMask)}function oW(t,e){return t.compare==e.compare&&t.depthFailOp===e.depthFailOp&&t.failOp===e.failOp&&t.passOp===e.passOp&&t.mask===e.mask}function aW(t,e){return t.id===e.id}function sW(t,e){return t===e}function lW(t,e){return t.topology===e.topology&&(t.inputLayout===e.inputLayout&&(t.sampleCount===e.sampleCount&&(!(t.megaStateDescriptor&&e.megaStateDescriptor&&!function(t,e){return!(!ZV(t.attachmentsState,e.attachmentsState,iW)||t.blendConstant&&e.blendConstant&&!MV(t.blendConstant,e.blendConstant)||t.stencilFront&&e.stencilFront&&!oW(t.stencilFront,e.stencilFront)||t.stencilBack&&e.stencilBack&&!oW(t.stencilBack,e.stencilBack)||t.depthCompare!==e.depthCompare||t.depthWrite!==e.depthWrite||t.stencilWrite!==e.stencilWrite||t.cullMode!==e.cullMode||t.frontFace!==e.frontFace||t.polygonOffset!==e.polygonOffset||t.polygonOffsetFactor!==e.polygonOffsetFactor||t.polygonOffsetUnits!==e.polygonOffsetUnits)}(t.megaStateDescriptor,e.megaStateDescriptor))&&(!!aW(t.program,e.program)&&(!!ZV(t.colorAttachmentFormats,e.colorAttachmentFormats,sW)&&t.depthStencilAttachmentFormat===e.depthStencilAttachmentFormat)))))}function uW(t,e){return t.offset===e.offset&&t.shaderLocation===e.shaderLocation&&t.format===e.format&&t.divisor===e.divisor}function cW(t,e){return _(t)?_(e):!_(e)&&(t.arrayStride===e.arrayStride&&t.stepMode===e.stepMode&&ZV(t.attributes,e.attributes,uW))}function hW(t,e){return t.indexBufferFormat===e.indexBufferFormat&&(!!ZV(t.vertexBufferDescriptors,e.vertexBufferDescriptors,cW)&&!!aW(t.program,e.program))}function dW(t,e){return t.addressModeU===e.addressModeU&&t.addressModeV===e.addressModeV&&t.minFilter===e.minFilter&&t.magFilter===e.magFilter&&t.mipmapFilter===e.mipmapFilter&&t.lodMinClamp===e.lodMinClamp&&t.lodMaxClamp===e.lodMaxClamp&&t.maxAnisotropy===e.maxAnisotropy&&t.compareFunction===e.compareFunction}function fW(t){return{sampler:t.sampler,texture:t.texture,dimension:t.dimension,formatKind:t.formatKind,comparison:t.comparison}}function pW(t){var e=t.buffer,n=t.size;return{binding:t.binding,buffer:e,offset:t.offset,size:n}}function gW(t){return{binding:t.binding,texture:t.texture}}function vW(t){return{shaderLocation:t.shaderLocation,format:t.format,offset:t.offset,divisor:t.divisor}}function mW(t){return _(t)?t:{arrayStride:t.arrayStride,stepMode:t.stepMode,attributes:QV(t.attributes,vW)}}var yW=/([^[]*)(\[[0-9]+\])?/;function EW(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(yW);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:Number(e[2])||1,isArray:Boolean(e[2])}}function _W(){var t=null;return function(e,n,r){var i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function bW(t,e,n,r){var i=null,o=null;return function(a,s,l){var u=e(l,n),c=u.length,h=!1;if(null===i)i=new Float32Array(c),o=c,h=!0;else{xV(o===c,"Uniform length cannot change.");for(var d=0;d<c;++d)if(u[d]!==i[d]){h=!0;break}}return h&&(r(a,t,s,u),i.set(u)),h}}function xW(t,e,n,r){t[e](n,r)}function SW(t,e,n,r){t[e](n,!1,r)}var MW={},AW={},RW={},TW=[0];function wW(t,e,n,r){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(TW[0]=t,t=TW);var i=t.length;if(t instanceof n)return t;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=t[a];return o}function PW(t,e){return wW(t,e,Float32Array,MW)}function NW(t,e){return wW(t,e,Int32Array,AW)}function CW(t,e){return wW(t,e,Uint32Array,RW)}var OW=(($V={})[zz.FLOAT]=bW.bind(null,"uniform1fv",PW,1,xW),$V[zz.FLOAT_VEC2]=bW.bind(null,"uniform2fv",PW,2,xW),$V[zz.FLOAT_VEC3]=bW.bind(null,"uniform3fv",PW,3,xW),$V[zz.FLOAT_VEC4]=bW.bind(null,"uniform4fv",PW,4,xW),$V[zz.INT]=bW.bind(null,"uniform1iv",NW,1,xW),$V[zz.INT_VEC2]=bW.bind(null,"uniform2iv",NW,2,xW),$V[zz.INT_VEC3]=bW.bind(null,"uniform3iv",NW,3,xW),$V[zz.INT_VEC4]=bW.bind(null,"uniform4iv",NW,4,xW),$V[zz.BOOL]=bW.bind(null,"uniform1iv",NW,1,xW),$V[zz.BOOL_VEC2]=bW.bind(null,"uniform2iv",NW,2,xW),$V[zz.BOOL_VEC3]=bW.bind(null,"uniform3iv",NW,3,xW),$V[zz.BOOL_VEC4]=bW.bind(null,"uniform4iv",NW,4,xW),$V[zz.FLOAT_MAT2]=bW.bind(null,"uniformMatrix2fv",PW,4,SW),$V[zz.FLOAT_MAT3]=bW.bind(null,"uniformMatrix3fv",PW,9,SW),$V[zz.FLOAT_MAT4]=bW.bind(null,"uniformMatrix4fv",PW,16,SW),$V[zz.UNSIGNED_INT]=bW.bind(null,"uniform1uiv",CW,1,xW),$V[zz.UNSIGNED_INT_VEC2]=bW.bind(null,"uniform2uiv",CW,2,xW),$V[zz.UNSIGNED_INT_VEC3]=bW.bind(null,"uniform3uiv",CW,3,xW),$V[zz.UNSIGNED_INT_VEC4]=bW.bind(null,"uniform4uiv",CW,4,xW),$V[zz.FLOAT_MAT2x3]=bW.bind(null,"uniformMatrix2x3fv",PW,6,SW),$V[zz.FLOAT_MAT2x4]=bW.bind(null,"uniformMatrix2x4fv",PW,8,SW),$V[zz.FLOAT_MAT3x2]=bW.bind(null,"uniformMatrix3x2fv",PW,6,SW),$V[zz.FLOAT_MAT3x4]=bW.bind(null,"uniformMatrix3x4fv",PW,12,SW),$V[zz.FLOAT_MAT4x2]=bW.bind(null,"uniformMatrix4x2fv",PW,8,SW),$V[zz.FLOAT_MAT4x3]=bW.bind(null,"uniformMatrix4x3fv",PW,12,SW),$V[zz.SAMPLER_2D]=_W,$V[zz.SAMPLER_CUBE]=_W,$V[zz.SAMPLER_3D]=_W,$V[zz.SAMPLER_2D_SHADOW]=_W,$V[zz.SAMPLER_2D_ARRAY]=_W,$V[zz.SAMPLER_2D_ARRAY_SHADOW]=_W,$V[zz.SAMPLER_CUBE_SHADOW]=_W,$V[zz.INT_SAMPLER_2D]=_W,$V[zz.INT_SAMPLER_3D]=_W,$V[zz.INT_SAMPLER_CUBE]=_W,$V[zz.INT_SAMPLER_2D_ARRAY]=_W,$V[zz.UNSIGNED_INT_SAMPLER_2D]=_W,$V[zz.UNSIGNED_INT_SAMPLER_3D]=_W,$V[zz.UNSIGNED_INT_SAMPLER_CUBE]=_W,$V[zz.UNSIGNED_INT_SAMPLER_2D_ARRAY]=_W,$V);function IW(t,e,n){var r=OW[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}var LW={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function DW(t,e){return"#define ".concat(t," ").concat(e)}function BW(t){if(void 0===t)return null;var e=/binding\s*=\s*(\d+)/.exec(t);if(null!==e){var n=parseInt(e[1],10);if(!Number.isNaN(n))return n}return null}function kW(t){return[t,""]}function FW(t,e,n,r,i){var o;void 0===r&&(r=null),void 0===i&&(i=!0);var a="#version 100"===t.glslVersion,s="frag"===e&&(null===(o=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,u=n.replace("\r\n","\n").split("\n").map((function(t){return t.replace(/[/][/].*$/,"")})).filter((function(t){return!(!t||/^\s+$/.test(t))})),c="";null!==r&&(c=Object.keys(r).map((function(t){return DW(t,r[t])})).join("\n"));var h=u.find((function(t){return t.startsWith("precision")}))||"precision mediump float;",d=i?u.filter((function(t){return!t.startsWith("precision")})).join("\n"):u.join("\n"),f="";if(t.viewportOrigin===sV.UPPER_LEFT&&(f+="".concat(DW("VIEWPORT_ORIGIN_TL","1"),"\n")),t.clipSpaceNearZ===lV.ZERO&&(f+="".concat(DW("CLIPSPACE_NEAR_ZERO","1"),"\n")),t.explicitBindingLocations){var p=0,g=0,v=0;d=d.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(t,e,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(p,", binding = ").concat(g++,") uniform ").concat(r)})),p++,g=0,xV(t.separateSamplerTextures),d=d.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(t,n,r,i,o){var a=BW(r);null===a&&(a=g++);var s=l(kW(i),2),u=s[0],c=s[1];return"frag"===e?"\nlayout(set = ".concat(p,", binding = ").concat(2*a+0,") uniform texture").concat(u," T_").concat(o,";\nlayout(set = ").concat(p,", binding = ").concat(2*a+1,") uniform sampler").concat(c," S_").concat(o,";").trim():""})),d=d.replace("frag"===e?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(t,e){return"layout(location = ".concat(v++,") ").concat(e)})),f+="".concat(DW("gl_VertexID","gl_VertexIndex"),"\n"),f+="".concat(DW("gl_InstanceID","gl_InstanceIndex"),"\n"),h=h.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var m=0;d=d.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(t,e,n,r,i){var o=BW(n);return null===o&&(o=m++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(o)}))}if(d=(d=(d=d.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return"SAMPLER_".concat(e,"(P_").concat(n,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return"PP_SAMPLER_".concat(e,"(P_").concat(n,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(t,e){return"TEXTURE(P_".concat(e,")")})),t.separateSamplerTextures)d=d.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){var r=l(kW(e),2),i=r[0],o=r[1];return"texture".concat(i," T_P_").concat(n,", sampler").concat(o," S_P_").concat(n)})),d=(d=(d=d.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return"T_".concat(n,", S_").concat(n)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return"sampler".concat(e,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(t,e){return"T_".concat(e)}));else{var y=[];d=(d=(d=d.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return"sampler".concat(e," P_").concat(n)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return n}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(t,e,n){return y.push([n,e]),n})),a&&y.forEach((function(t){var e=l(t,2),n=e[0],r=e[1];d=d.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),d=d.replace(/\bTEXTURE\((.*?)\)/g,(function(t,e){return e}))}var E="".concat(a?"":t.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===e?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?h:"","\n").concat(f||"").concat(c?c+"\n":"","\n").concat(d,"\n").trim();if(t.explicitBindingLocations&&"frag"===e&&(E=E.replace(/^\b(out)\b/g,(function(t,e){return"layout(location = 0) ".concat(e)}))),a){if("frag"===e&&(E=E.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"varying ".concat(e," ").concat(n,";\n")}))),"vert"===e&&(E=E.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"varying ".concat(e," ").concat(n,";\n")})),E=E.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return"attribute ".concat(e," ").concat(n,";\n")}))),E=E.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(t,e){return e.trim().replace(/^.*$/gm,(function(t){var e=t.trim();return e.startsWith("#")?e:t?"uniform ".concat(e):""}))})),"frag"===e)if(s){var _=[];E=E.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(t,e){return _.push(e),"vec4 ".concat(e,";\n")}));var b=E.lastIndexOf("}");E=E.substring(0,b)+"\n    ".concat(_.map((function(t,e){return"gl_FragData[".concat(e,"] = ").concat(t,";\n    ")})).join("\n"))+E.substring(b)}else{var x;if(E=E.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(t,e,n){return x=n,"".concat(e," ").concat(n,";\n")})),x){b=E.lastIndexOf("}");E=E.substring(0,b)+"\n  gl_FragColor = vec4(".concat(x,");\n")+E.substring(b)}}E=E.replace(/^\s*layout\((.*)\)/gm,"")}return E}var UW=function(t){function e(e){var n=e.id,r=e.device,i=t.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return n(e,t),e.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},e}($x),GW=function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.Bindings;var a=i.uniformBufferBindings,s=i.samplerBindings;return o.uniformBufferBindings=a||[],o.samplerBindings=s||[],o.bindingLayouts=o.createBindingLayouts(),o}return n(e,t),e.prototype.createBindingLayouts=function(){var t=0,e=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:t,numUniformBuffers:r,firstSampler:e,numSamplers:i}),{numUniformBuffers:t+=r,numSamplers:e+=i,bindingLayoutTables:n}},e}(UW);function zW(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function VW(t){switch(mV(t)){case cV.BC1:case cV.BC2:case cV.BC3:case cV.BC4_UNORM:case cV.BC4_SNORM:case cV.BC5_UNORM:case cV.BC5_SNORM:return!0;default:return!1}}function WW(t){if(yV(t)&dV.Normalized)return!1;var e=mV(t);return e===cV.S8||e===cV.S16||e===cV.S32||(e===cV.U8||e===cV.U16||e===cV.U32)}function jW(t){return t&Qz.INDEX?zz.ELEMENT_ARRAY_BUFFER:t&Qz.VERTEX?zz.ARRAY_BUFFER:t&Qz.UNIFORM?zz.UNIFORM_BUFFER:void 0}function HW(t){var e=mV(t),n=vV(t),r=yV(t),i=function(t){switch(t){case cV.U8:return zz.UNSIGNED_BYTE;case cV.U16:return zz.UNSIGNED_SHORT;case cV.U32:return zz.UNSIGNED_INT;case cV.S8:return zz.BYTE;case cV.S16:return zz.SHORT;case cV.S32:return zz.INT;case cV.F16:return zz.HALF_FLOAT;case cV.F32:return zz.FLOAT;default:throw new Error("whoops")}}(e),o=function(t){switch(t){case hV.R:return 1;case hV.RG:return 2;case hV.RGB:return 3;case hV.RGBA:return 4;default:return 1}}(n);return{size:o,type:i,normalized:!!(r&dV.Normalized)}}function XW(t){switch(t){case Kz.CLAMP_TO_EDGE:return zz.CLAMP_TO_EDGE;case Kz.REPEAT:return zz.REPEAT;case Kz.MIRRORED_REPEAT:return zz.MIRRORED_REPEAT;default:throw new Error("whoops")}}function YW(t,e){if(e===qz.LINEAR&&t===$z.BILINEAR)return zz.LINEAR_MIPMAP_LINEAR;if(e===qz.LINEAR&&t===$z.POINT)return zz.NEAREST_MIPMAP_LINEAR;if(e===qz.NEAREST&&t===$z.BILINEAR)return zz.LINEAR_MIPMAP_NEAREST;if(e===qz.NEAREST&&t===$z.POINT)return zz.NEAREST_MIPMAP_NEAREST;if(e===qz.NO_MIP&&t===$z.BILINEAR)return zz.LINEAR;if(e===qz.NO_MIP&&t===$z.POINT)return zz.NEAREST;throw new Error("Unknown texture filter mode")}function KW(t,e){void 0===e&&(e=0);var n=t;return n.gl_buffer_pages[e/n.pageByteSize|0]}function $W(t){return t.gl_texture}function qW(t){return t.gl_sampler}function ZW(t,e){t.name=e,t.__SPECTOR_Metadata={name:e}}function QW(t,e){for(var n=[];;){var r=e.exec(t);if(!r)break;n.push(r)}return n}function JW(t){return t.blendMode==Yz.ADD&&t.blendSrcFactor==Xz.ONE&&t.blendDstFactor===Xz.ZERO}function tj(t){if(t===nV.TEXTURE_2D)return zz.TEXTURE_2D;if(t===nV.TEXTURE_2D_ARRAY)return zz.TEXTURE_2D_ARRAY;if(t===nV.TEXTURE_CUBE_MAP)return zz.TEXTURE_CUBE_MAP;if(t===nV.TEXTURE_3D)return zz.TEXTURE_3D;throw new Error("whoops")}function ej(t,e,n,r){return t%n==0&&e%r==0}var nj,rj=function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.Buffer;var a=i.viewOrSize,s=i.usage,l=i.hint,u=void 0===l?Jz.STATIC:l,c=r.uniformBufferMaxPageByteSize,h=r.gl,d=s&Qz.UNIFORM;d||(zW(h)?h.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var f,p=I(a)?DV(a,4):DV(a.byteLength,4);if(o.gl_buffer_pages=[],d){for(var g=p;g>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(g,c),s,u)),g-=c;f=c}else o.gl_buffer_pages.push(o.createBufferPage(p,s,u)),f=p;return o.pageByteSize=f,o.byteSize=p,o.usage=s,o.gl_target=jW(s),I(a)||o.setSubData(0,new Uint8Array(a.buffer)),d||(zW(h)?h.bindVertexArray(o.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return n(e,t),e.prototype.setSubData=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.byteLength-n);for(var i=this.device.gl,o=this.pageByteSize,a=t+r,s=t,l=t%o;s<a;){var u=zW(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=KW(this,s);if(c.ubo)return;i.bindBuffer(u,c),zW(i)?i.bufferSubData(u,l,e,n,Math.min(a-s,o)):i.bufferSubData(u,l,e),s+=o,l=0,n+=o,this.device.debugGroupStatisticsBufferUpload()}},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.gl_buffer_pages.length;e++)this.gl_buffer_pages[e].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[e]);this.gl_buffer_pages=[]},e.prototype.createBufferPage=function(t,e,n){var r=this.device.gl,i=e&Qz.UNIFORM;if(!zW(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=jW(e),s=function(t){switch(t){case Jz.STATIC:return zz.STATIC_DRAW;case Jz.DYNAMIC:return zz.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,t,s),o},e}(UW),ij=function(t){function e(e){var n,r,i,o,a,l=e.id,u=e.device,c=e.descriptor,h=t.call(this,{id:l,device:u})||this;h.type=Vz.InputLayout;var d=c.vertexBufferDescriptors,f=c.indexBufferFormat,p=c.program;xV(f===fV.U16_R||f===fV.U32_R||null===f);var g=null!==f?function(t){switch(t){case fV.U8_R:return zz.UNSIGNED_BYTE;case fV.U16_R:return zz.UNSIGNED_SHORT;case fV.U32_R:return zz.UNSIGNED_INT;default:throw new Error("whoops")}}(f):null,v=null!==f?_V(f):null,m=h.device.gl,y=h.device.ensureResourceExists(zW(m)?m.createVertexArray():u.OES_vertex_array_object.createVertexArrayOES());zW(m)?m.bindVertexArray(y):u.OES_vertex_array_object.bindVertexArrayOES(y),m.bindBuffer(m.ARRAY_BUFFER,KW(h.device.fallbackVertexBuffer));try{for(var E=s(c.vertexBufferDescriptors),b=E.next();!b.done;b=E.next()){var x=b.value,S=x.stepMode,M=x.attributes;try{for(var A=(i=void 0,s(M)),R=A.next();!R.done;R=A.next()){var T=R.value,w=T.shaderLocation,P=T.format,N=T.divisor,C=void 0===N?1:N,O=zW(m)?w:null===(a=p.attributes[w])||void 0===a?void 0:a.location,I=HW(P);if(T.vertexFormat=I,!_(O)){WW(P);var L=I.size,D=I.type,B=I.normalized;m.vertexAttribPointer(O,L,D,B,0,0),S===tV.INSTANCE&&(zW(m)?m.vertexAttribDivisor(O,C):u.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(O,C)),m.enableVertexAttribArray(O)}}}catch(t){i={error:t}}finally{try{R&&!R.done&&(o=A.return)&&o.call(A)}finally{if(i)throw i.error}}}}catch(t){n={error:t}}finally{try{b&&!b.done&&(r=E.return)&&r.call(E)}finally{if(n)throw n.error}}return zW(m)?m.bindVertexArray(null):u.OES_vertex_array_object.bindVertexArrayOES(null),h.vertexBufferDescriptors=d,h.vao=y,h.indexBufferFormat=f,h.indexBufferType=g,h.indexBufferCompByteSize=v,h.program=p,h}return n(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(zW(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},e}(UW),oj=function(t){function e(e){var n=e.id,i=e.device,o=e.descriptor,a=e.fake,s=t.call(this,{id:n,device:i})||this;s.type=Vz.Texture,o=r({dimension:nV.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},o);var l,u,c=s.device.gl,h=s.clampmipLevelCount(o);if(s.immutable=o.usage===rV.RENDER_TARGET,s.pixelStore=o.pixelStore,s.format=o.format,s.dimension=o.dimension,s.formatKind=bV(o.format),s.width=o.width,s.height=o.height,s.depthOrArrayLayers=o.depthOrArrayLayers,s.mipmaps=h>=1,!a){u=s.device.ensureResourceExists(c.createTexture());var d=s.device.translateTextureType(o.format),f=s.device.translateTextureInternalFormat(o.format);if(s.device.setActiveTexture(c.TEXTURE0),s.device.currentTextures[0]=null,s.preprocessImage(),o.dimension===nV.TEXTURE_2D){if(l=zz.TEXTURE_2D,c.bindTexture(l,u),s.immutable)if(zW(c))c.texStorage2D(l,h,f,o.width,o.height);else{var p=(f===zz.DEPTH_COMPONENT||s.isNPOT(),0);(s.format!==fV.D32F&&s.format!==fV.D24_S8||zW(c)||i.WEBGL_depth_texture)&&(c.texImage2D(l,p,f,o.width,o.height,0,f,d,null),s.mipmaps&&(s.mipmaps=!1,c.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_MIN_FILTER,zz.LINEAR),c.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_WRAP_S,zz.CLAMP_TO_EDGE),c.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_WRAP_T,zz.CLAMP_TO_EDGE)))}xV(1===o.depthOrArrayLayers)}else if(o.dimension===nV.TEXTURE_2D_ARRAY)l=zz.TEXTURE_2D_ARRAY,c.bindTexture(l,u),s.immutable&&zW(c)&&c.texStorage3D(l,h,f,o.width,o.height,o.depthOrArrayLayers);else if(o.dimension===nV.TEXTURE_3D)l=zz.TEXTURE_3D,c.bindTexture(l,u),s.immutable&&zW(c)&&c.texStorage3D(l,h,f,o.width,o.height,o.depthOrArrayLayers);else{if(o.dimension!==nV.TEXTURE_CUBE_MAP)throw new Error("whoops");l=zz.TEXTURE_CUBE_MAP,c.bindTexture(l,u),s.immutable&&zW(c)&&c.texStorage2D(l,h,f,o.width,o.height),xV(6===o.depthOrArrayLayers)}}return s.gl_texture=u,s.gl_target=l,s.mipLevelCount=h,s}return n(e,t),e.prototype.setImageData=function(t,e){void 0===e&&(e=0);var n=this.device.gl;VW(this.format);var r=this.gl_target===zz.TEXTURE_3D||this.gl_target===zz.TEXTURE_2D_ARRAY,i=this.gl_target===zz.TEXTURE_CUBE_MAP,o=function(t){return Object.prototype.toString.call(t)in LW}(t[0]);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var a,s,l=t[0];o?(a=this.width,s=this.height):(a=l.width,s=l.height,this.width=a,this.height=s),n.bindTexture(this.gl_target,this.gl_texture);var u=this.device.translateTextureFormat(this.format),c=zW(n)?this.device.translateInternalTextureFormat(this.format):u,h=this.device.translateTextureType(this.format);this.preprocessImage();for(var d=0;d<this.depthOrArrayLayers;d++){var f=t[d],p=this.gl_target;i&&(p=zz.TEXTURE_CUBE_MAP_POSITIVE_X+d%6),this.immutable?n.texSubImage2D(p,e,0,0,a,s,u,h,f):zW(n)?r?n.texImage3D(p,e,c,a,s,this.depthOrArrayLayers,0,u,h,f):n.texImage2D(p,e,c,a,s,0,u,h,f):o?n.texImage2D(p,e,u,a,s,0,u,h,f):n.texImage2D(p,e,u,u,h,f)}this.mipmaps&&this.generateMipmap(r)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteTexture($W(this))},e.prototype.clampmipLevelCount=function(t){if(t.dimension===nV.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1&&mV(t.format)===cV.BC1)for(var e=t.width,n=t.height,r=0;r<t.mipLevelCount;r++){if(e<=2||n<=2)return r-1;e=Math.max(e/2|0,1),n=Math.max(n/2|0,1)}return t.mipLevelCount},e.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(zz.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(zz.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(zz.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},e.prototype.generateMipmap=function(t){void 0===t&&(t=!1);var e=this.device.gl;return!zW(e)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(e.bindTexture(this.gl_target,this.gl_texture),t?(e.texParameteri(this.gl_target,zz.TEXTURE_BASE_LEVEL,0),e.texParameteri(this.gl_target,zz.TEXTURE_MAX_LEVEL,Math.log2(this.width)),e.texParameteri(this.gl_target,zz.TEXTURE_MIN_FILTER,zz.LINEAR_MIPMAP_LINEAR),e.texParameteri(this.gl_target,zz.TEXTURE_MAG_FILTER,zz.LINEAR)):e.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_MIN_FILTER,zz.NEAREST_MIPMAP_LINEAR),e.generateMipmap(this.gl_target),e.bindTexture(this.gl_target,null)),this},e.prototype.isNPOT=function(){return!zW(this.device.gl)&&(!CV(this.width)||!CV(this.height))},e}(UW),aj=function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var a=o.device.gl,s=i.format,l=i.width,u=i.height,c=i.sampleCount,h=void 0===c?1:c,d=i.texture,f=!1;if(s!==fV.D32F&&s!==fV.D24_S8||!d||zW(a)||r.WEBGL_depth_texture||(d.destroy(),o.texture=null,f=!0),!f&&d)o.texture=d;else{o.gl_renderbuffer=o.device.ensureResourceExists(a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,o.gl_renderbuffer);var p=o.device.translateTextureInternalFormat(s,!0);zW(a)&&h>1?a.renderbufferStorageMultisample(zz.RENDERBUFFER,h,p,l,u):a.renderbufferStorage(zz.RENDERBUFFER,p,l,u)}return o.format=s,o.width=l,o.height=u,o.sampleCount=h,o}return n(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},e}(UW);!function(t){t[t.NeedsCompile=0]="NeedsCompile",t[t.Compiling=1]="Compiling",t[t.NeedsBind=2]="NeedsBind",t[t.ReadyToUse=3]="ReadyToUse"}(nj||(nj={}));var sj=function(t){function e(e,n){var r=e.id,i=e.device,o=e.descriptor,a=t.call(this,{id:r,device:i})||this;a.rawVertexGLSL=n,a.type=Vz.Program,a.uniformSetters={},a.attributes=[];var s=a.device.gl;return a.descriptor=o,a.gl_program=a.device.ensureResourceExists(s.createProgram()),a.gl_shader_vert=null,a.gl_shader_frag=null,a.compileState=nj.NeedsCompile,a.tryCompileProgram(),a}return n(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},e.prototype.tryCompileProgram=function(){xV(this.compileState===nj.NeedsCompile);var t=this.descriptor,e=t.vertex,n=t.fragment,r=this.device.gl;(null==e?void 0:e.glsl)&&(null==n?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(e.postprocess?e.postprocess(e.glsl):e.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=nj.Compiling,zW(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},e.prototype.readAttributesFromLinkedProgram=function(){for(var t,e=this.device.gl,n=e.getProgramParameter(this.gl_program,e.ACTIVE_ATTRIBUTES),r=function(t){var e={};return t.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(t,n,r){var i=Number(r);return e[n]=isNaN(i)?r:i,""})),e}(this.descriptor.vertex.glsl),i=function(t,e){var n=[];return t.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(t,r,i){var o=Number(r);return n.push({location:isNaN(o)?e[r]:o,name:i}),""})),n}(this.rawVertexGLSL,r),o=function(n){var r=e.getActiveAttrib(a.gl_program,n),o=r.name,s=r.type,l=r.size,u=e.getAttribLocation(a.gl_program,o),c=null===(t=i.find((function(t){return t.name===o})))||void 0===t?void 0:t.location;u>=0&&!_(c)&&(a.attributes[c]={name:o,location:u,type:s,size:l})},a=this,s=0;s<n;s++)o(s)},e.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,e=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),n=0;n<e;n++){var r=t.getActiveUniform(this.gl_program,n),i=EW(r.name).name,o=t.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=IW(t,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=t.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=IW(t,o,r)}},e.prototype.compileShader=function(t,e){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(e));return n.shaderSource(r,t),n.compileShader(r),r},e.prototype.setUniformsLegacy=function(t){void 0===t&&(t={});var e=this.device.gl;if(!zW(e)){var n=!1;for(var r in t){n||(e.useProgram(this.gl_program),n=!0);var i=t[r],o=this.uniformSetters[r];if(o){var a=i;a instanceof oj&&(a=a.textureIndex),o(a)}}}return this},e}(UW),lj=function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.QueryPool;var a=o.device.gl;if(zW(a)){var s=i.elemCount,l=i.type;o.gl_query=FV(s,(function(){return o.device.ensureResourceExists(a.createQuery())})),o.gl_query_type=function(t){if(t===uV.OcclusionConservative)return zz.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(l)}return o}return n(e,t),e.prototype.queryResultOcclusion=function(t){var e=this.device.gl;if(zW(e)){var n=this.gl_query[t];return e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)?!!e.getQueryParameter(n,e.QUERY_RESULT):null}return null},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this.device.gl;if(zW(e))for(var n=0;n<this.gl_query.length;n++)e.deleteQuery(this.gl_query[n])},e}(UW),uj=function(t){function e(e){var n=e.id,r=e.device,i=t.call(this,{id:n,device:r})||this;return i.type=Vz.Readback,i.gl_pbo=null,i.gl_sync=null,i}return n(e,t),e.prototype.clientWaitAsync=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,o){!function a(){var s=r.clientWaitSync(t,e,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(a,O(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))},e.prototype.getBufferSubDataAsync=function(t,e,n,r,i,s){return o(this,void 0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:return zW(o=this.device.gl)?(this.gl_sync=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0),o.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return a.sent(),o.bindBuffer(t,e),o.getBufferSubData(t,n,r,i,s),o.bindBuffer(t,null),[2,r];case 2:return[2]}}))}))},e.prototype.readTexture=function(t,e,n,r,i,s,l,u){return void 0===l&&(l=0),void 0===u&&(u=s.byteLength||0),o(this,void 0,void 0,(function(){var o,c,h,d,f;return a(this,(function(a){var p;return o=this.device.gl,c=t,h=this.device.translateTextureFormat(c.format),d=this.device.translateTextureType(c.format),p=c.format,f=EV(mV(p))*vV(p),zW(o)?(this.gl_pbo=this.device.ensureResourceExists(o.createBuffer()),o.bindBuffer(o.PIXEL_PACK_BUFFER,this.gl_pbo),o.bufferData(o.PIXEL_PACK_BUFFER,u,o.STREAM_READ),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.bindFramebuffer(zz.READ_FRAMEBUFFER,this.device.readbackFramebuffer),o.framebufferTexture2D(zz.READ_FRAMEBUFFER,zz.COLOR_ATTACHMENT0,zz.TEXTURE_2D,c.gl_texture,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,this.gl_pbo),o.readPixels(e,n,r,i,h,d,l*f),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(o.PIXEL_PACK_BUFFER,this.gl_pbo,0,s,l,0)]):[2,this.readTextureSync(t,e,n,r,i,s,l,u)]}))}))},e.prototype.readTextureSync=function(t,e,n,r,i,o,a,s){void 0===s&&(s=o.byteLength||0);var l=this.device.gl,u=t,c=this.device.translateTextureType(u.format);return l.bindFramebuffer(zz.FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(zz.FRAMEBUFFER,zz.COLOR_ATTACHMENT0,zz.TEXTURE_2D,u.gl_texture,0),l.pixelStorei(l.PACK_ALIGNMENT,4),l.readPixels(e,n,r,i,l.RGBA,c,o),o},e.prototype.readBuffer=function(t,e,n,r,i){return o(this,void 0,void 0,(function(){var o;return a(this,(function(a){return zW(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,KW(t,e),e,n,r,i)]:[2,Promise.reject()]}))}))},e.prototype.destroy=function(){t.prototype.destroy.call(this),zW(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},e}(UW),cj=function(t){function e(e){var n,i,o=e.id,a=e.device,s=e.descriptor,l=t.call(this,{id:o,device:a})||this;return l.type=Vz.RenderPipeline,l.drawMode=function(t){switch(t){case Zz.TRIANGLES:return zz.TRIANGLES;case Zz.POINTS:return zz.POINTS;case Zz.TRIANGLE_STRIP:return zz.TRIANGLE_STRIP;case Zz.LINES:return zz.LINES;case Zz.LINE_STRIP:return zz.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=s.topology)&&void 0!==n?n:Zz.TRIANGLES),l.program=s.program,l.inputLayout=s.inputLayout,l.megaState=r(r({},jV(XV)),s.megaStateDescriptor),l.colorAttachmentFormats=s.colorAttachmentFormats.slice(),l.depthStencilAttachmentFormat=s.depthStencilAttachmentFormat,l.sampleCount=null!==(i=s.sampleCount)&&void 0!==i?i:1,l}return n(e,t),e}(UW),hj=function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;return o.type=Vz.ComputePipeline,o.descriptor=i,o}return n(e,t),e}(UW),dj=function(){function t(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return t.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,(new Error).stack),this.liveObjects.add(t)},t.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,"\n\nCreation stack: ",this.creationStacks.get(t),"\n\nDeletion stack: ",this.deletionStacks.get(t),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(t,(new Error).stack),this.liveObjects.delete(t)},t.prototype.checkForLeaks=function(){var t,e;try{for(var n=s(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.setResourceLeakCheck=function(t,e){e?this.liveObjects.add(t):this.liveObjects.delete(t)},t}(),fj=function(t){function e(e){var n,r,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;s.type=Vz.Sampler;var l=s.device.gl;if(zW(l)){var u=s.device.ensureResourceExists(l.createSampler());l.samplerParameteri(u,zz.TEXTURE_WRAP_S,XW(a.addressModeU)),l.samplerParameteri(u,zz.TEXTURE_WRAP_T,XW(a.addressModeV)),l.samplerParameteri(u,zz.TEXTURE_WRAP_R,XW(null!==(n=a.addressModeW)&&void 0!==n?n:a.addressModeU)),l.samplerParameteri(u,zz.TEXTURE_MIN_FILTER,YW(a.minFilter,a.mipmapFilter)),l.samplerParameteri(u,zz.TEXTURE_MAG_FILTER,YW(a.magFilter,qz.NO_MIP)),void 0!==a.lodMinClamp&&l.samplerParameterf(u,zz.TEXTURE_MIN_LOD,a.lodMinClamp),void 0!==a.lodMaxClamp&&l.samplerParameterf(u,zz.TEXTURE_MAX_LOD,a.lodMaxClamp),void 0!==a.compareFunction&&(l.samplerParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.samplerParameteri(u,l.TEXTURE_COMPARE_FUNC,a.compareFunction));var c=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(xV(a.minFilter===$z.BILINEAR&&a.magFilter===$z.BILINEAR&&a.mipmapFilter===qz.LINEAR),l.samplerParameterf(u,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=u}else s.descriptor=a;return s}return n(e,t),e.prototype.setTextureParameters=function(t,e,n){var r,i=this.device.gl,o=this.descriptor;this.isNPOT(e,n)?i.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_MIN_FILTER,zz.LINEAR):i.texParameteri(t,zz.TEXTURE_MIN_FILTER,YW(o.minFilter,o.mipmapFilter)),i.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_WRAP_S,XW(o.addressModeU)),i.texParameteri(zz.TEXTURE_2D,zz.TEXTURE_WRAP_T,XW(o.addressModeV)),i.texParameteri(t,zz.TEXTURE_MAG_FILTER,YW(o.magFilter,qz.NO_MIP));var a=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(xV(o.minFilter===$z.BILINEAR&&o.magFilter===$z.BILINEAR&&o.mipmapFilter===qz.LINEAR),i.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},e.prototype.destroy=function(){t.prototype.destroy.call(this),zW(this.device.gl)&&this.device.gl.deleteSampler(qW(this))},e.prototype.isNPOT=function(t,e){return!CV(t)||!CV(e)},e}(UW),pj=function(){function t(){}return t.prototype.dispatchWorkgroups=function(t,e,n){},t.prototype.dispatchWorkgroupsIndirect=function(t,e){},t.prototype.setPipeline=function(t){},t.prototype.setBindings=function(t){},t.prototype.pushDebugGroup=function(t){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(t){},t}(),gj=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=Vz.RenderBundle,e.commands=[],e}return n(e,t),e.prototype.push=function(t){this.commands.push(t)},e.prototype.replay=function(){this.commands.forEach((function(t){return t()}))},e}(UW),vj=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,mj=function(){function t(t,e){void 0===e&&(e={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=jV(XV),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=sV.LOWER_LEFT,this.clipSpaceNearZ=lV.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=SV(t.getContextAttributes()),zW(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),zW(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new oj({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:nV.TEXTURE_2D,mipLevelCount:1,usage:rV.RENDER_TARGET,format:!1===this.contextAttributes.alpha?fV.U8_RGB_RT:fV.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=aV.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(nV.TEXTURE_2D,aV.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(nV.TEXTURE_2D,aV.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Qz.VERTEX,hint:Jz.STATIC}),zW(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(nV.TEXTURE_2D_ARRAY,aV.Float),this.fallbackTexture3D=this.createFallbackTexture(nV.TEXTURE_3D,aV.Float),this.fallbackTextureCube=this.createFallbackTexture(nV.TEXTURE_CUBE_MAP,aV.Float)),this.currentMegaState.depthCompare=Wz.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=iV.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),e.shaderDebug&&(this.shaderDebug=!0),e.trackResources&&(this.resourceCreationTracker=new dj)}return t.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},t.prototype.createFallbackTexture=function(t,e){var n=t===nV.TEXTURE_CUBE_MAP?6:1,r=e===aV.Depth?fV.D32F:fV.U8_RGBA_NORM,i=this.createTexture({dimension:t,format:r,usage:rV.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return e===aV.Float&&i.setImageData([new Uint8Array(4*n)]),$W(i)},t.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},t.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(zz.MAX_VERTEX_ATTRIBS),zW(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(zz.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var e=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=e?u([],l(e),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(t,e){return t-e}))},t.prototype.configureSwapChain=function(t,e,n){var r=this.scTexture;r.width=t,r.height=e,this.scPlatformFramebuffer=IV(n)},t.prototype.getDevice=function(){return this},t.prototype.getCanvas=function(){return this.gl.canvas},t.prototype.getOnscreenTexture=function(){return this.scTexture},t.prototype.beginFrame=function(){},t.prototype.endFrame=function(){},t.prototype.translateTextureInternalFormat=function(t,e){switch(void 0===e&&(e=!1),t){case fV.ALPHA:return zz.ALPHA;case fV.U8_LUMINANCE:case fV.F16_LUMINANCE:case fV.F32_LUMINANCE:return zz.LUMINANCE;case fV.F16_R:return zz.R16F;case fV.F16_RG:return zz.RG16F;case fV.F16_RGB:return zz.RGB16F;case fV.F16_RGBA:return zz.RGBA16F;case fV.F32_R:return zz.R32F;case fV.F32_RG:return zz.RG32F;case fV.F32_RGB:return zz.RGB32F;case fV.F32_RGBA:return zW(this.gl)?zz.RGBA32F:e?this.WEBGL_color_buffer_float.RGBA32F_EXT:zz.RGBA;case fV.U8_R_NORM:return zz.R8;case fV.U8_RG_NORM:return zz.RG8;case fV.U8_RGB_NORM:case fV.U8_RGB_RT:return zz.RGB8;case fV.U8_RGB_SRGB:return zz.SRGB8;case fV.U8_RGBA_NORM:case fV.U8_RGBA_RT:return zW(this.gl)?zz.RGBA8:e?zz.RGBA4:zz.RGBA;case fV.U8_RGBA:return zz.RGBA;case fV.U8_RGBA_SRGB:case fV.U8_RGBA_RT_SRGB:return zz.SRGB8_ALPHA8;case fV.U16_R:return zz.R16UI;case fV.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case fV.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case fV.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case fV.U16_RGBA_5551:return zz.RGB5_A1;case fV.U16_RGB_565:return zz.RGB565;case fV.U32_R:return zz.R32UI;case fV.S8_RGBA_NORM:return zz.RGBA8_SNORM;case fV.S8_RG_NORM:return zz.RG8_SNORM;case fV.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case fV.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case fV.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case fV.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case fV.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case fV.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case fV.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case fV.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case fV.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case fV.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case fV.D32F_S8:return zW(this.gl)?zz.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?zz.DEPTH_STENCIL:zz.DEPTH_COMPONENT16;case fV.D24_S8:return zW(this.gl)?zz.DEPTH24_STENCIL8:this.WEBGL_depth_texture?zz.DEPTH_STENCIL:zz.DEPTH_COMPONENT16;case fV.D32F:return zW(this.gl)?zz.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?zz.DEPTH_COMPONENT:zz.DEPTH_COMPONENT16;case fV.D24:return zW(this.gl)?zz.DEPTH_COMPONENT24:this.WEBGL_depth_texture?zz.DEPTH_COMPONENT:zz.DEPTH_COMPONENT16;default:throw new Error("whoops")}},t.prototype.translateTextureType=function(t){switch(mV(t)){case cV.U8:return zz.UNSIGNED_BYTE;case cV.U16:return zz.UNSIGNED_SHORT;case cV.U32:return zz.UNSIGNED_INT;case cV.S8:return zz.BYTE;case cV.F16:return zz.HALF_FLOAT;case cV.F32:return zz.FLOAT;case cV.U16_PACKED_5551:return zz.UNSIGNED_SHORT_5_5_5_1;case cV.D32F:return zW(this.gl)?zz.FLOAT:this.WEBGL_depth_texture?zz.UNSIGNED_INT:zz.UNSIGNED_BYTE;case cV.D24:return zW(this.gl)?zz.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?zz.UNSIGNED_SHORT:zz.UNSIGNED_BYTE;case cV.D24S8:return zW(this.gl)?zz.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?zz.UNSIGNED_INT_24_8_WEBGL:zz.UNSIGNED_BYTE;case cV.D32FS8:return zz.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},t.prototype.translateInternalTextureFormat=function(t){switch(t){case fV.F32_R:return zz.R32F;case fV.F32_RG:return zz.RG32F;case fV.F32_RGB:return zz.RGB32F;case fV.F32_RGBA:return zz.RGBA32F;case fV.F16_R:return zz.R16F;case fV.F16_RG:return zz.RG16F;case fV.F16_RGB:return zz.RGB16F;case fV.F16_RGBA:return zz.RGBA16F}return this.translateTextureFormat(t)},t.prototype.translateTextureFormat=function(t){if(VW(t)||t===fV.F32_LUMINANCE||t===fV.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var e=zW(this.gl)||!zW(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case fV.D24_S8:case fV.D32F_S8:return e?zz.DEPTH_STENCIL:zz.RGBA;case fV.D24:case fV.D32F:return e?zz.DEPTH_COMPONENT:zz.RGBA}var n=WW(t);switch(vV(t)){case hV.A:return zz.ALPHA;case hV.R:return n?zz.RED_INTEGER:zz.RED;case hV.RG:return n?zz.RG_INTEGER:zz.RG;case hV.RGB:return n?zz.RGB_INTEGER:zz.RGB;case hV.RGBA:return zz.RGBA}},t.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},t.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(zW(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},t.prototype.programCompiled=function(t){xV(t.compileState!==nj.NeedsCompile),t.compileState===nj.Compiling&&(t.compileState=nj.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},t.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},t.prototype.ensureResourceExists=function(t){if(null===t){var e=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(e))}return t},t.prototype.createBuffer=function(t){return new rj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createTexture=function(t){return new oj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createSampler=function(t){return new fj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderTarget=function(t){return new aj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderTargetFromTexture=function(t){var e=t,n=e.format,r=e.width,i=e.height;return xV(1===e.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:t})},t.prototype.createProgram=function(t){var e,n,r,i=null===(e=t.vertex)||void 0===e?void 0:e.glsl;return(null===(n=t.vertex)||void 0===n?void 0:n.glsl)&&(t.vertex.glsl=FW(this.queryVendorInfo(),"vert",t.vertex.glsl)),(null===(r=t.fragment)||void 0===r?void 0:r.glsl)&&(t.fragment.glsl=FW(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,i)},t.prototype.createProgramSimple=function(t,e){return new sj({id:this.getNextUniqueId(),device:this,descriptor:t},e)},t.prototype.createBindings=function(t){return new GW({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createInputLayout=function(t){return new ij({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderPipeline=function(t){return new cj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createComputePass=function(){return new pj},t.prototype.createComputePipeline=function(t){return new hj({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createReadback=function(){return new uj({id:this.getNextUniqueId(),device:this})},t.prototype.createQueryPool=function(t,e){return new lj({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},t.prototype.formatRenderPassDescriptor=function(t){var e,n,r,i,o,a,s=t.colorAttachment;t.depthClearValue=null!==(e=t.depthClearValue)&&void 0!==e?e:"load",t.stencilClearValue=null!==(n=t.stencilClearValue)&&void 0!==n?n:"load";for(var l=0;l<s.length;l++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[l]=null!==(r=t.colorAttachmentLevel[l])&&void 0!==r?r:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[l]=null!==(i=t.colorResolveToLevel[l])&&void 0!==i?i:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[l]=null!==(o=t.colorClearColor[l])&&void 0!==o?o:"load",t.colorStore||(t.colorStore=[]),t.colorStore[l]=null!==(a=t.colorStore[l])&&void 0!==a&&a},t.prototype.createRenderBundle=function(){return new gj({id:this.getNextUniqueId(),device:this})},t.prototype.beginBundle=function(t){this.renderBundle=t},t.prototype.endBundle=function(){this.renderBundle=void 0},t.prototype.executeBundles=function(t){t.forEach((function(t){t.replay()}))},t.prototype.createRenderPass=function(t){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var e=t.colorAttachment,n=t.colorAttachmentLevel,r=t.colorClearColor,i=t.colorResolveTo,o=t.colorResolveToLevel,a=t.depthStencilAttachment,s=t.depthClearValue,l=t.stencilClearValue,u=t.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(e.length,c);for(var h=0;h<e.length;h++)this.setRenderPassParametersColor(h,e[h],n[h],i[h],o[h],c);this.setRenderPassParametersDepthStencil(a,u,c),this.validateCurrentAttachments();for(h=0;h<e.length;h++){var d=r[h];"load"!==d&&this.setRenderPassParametersClearColor(h,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(s,l),this},t.prototype.submitPass=function(t){xV(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},t.prototype.copySubTexture2D=function(t,e,n,r,i,o){var a=this.gl,s=t,l=r;if(xV(1===l.mipLevelCount),xV(1===s.mipLevelCount),zW(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,l,0),a.blitFramebuffer(i,o,i+l.width,o+l.height,e,n,e+l.width,n+l.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var u=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(u,s)}},t.prototype.queryLimits=function(){return this},t.prototype.queryTextureFormatSupported=function(t,e,n){switch(t){case fV.BC1_SRGB:case fV.BC2_SRGB:case fV.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&ej(e,n,4,4);case fV.BC1:case fV.BC2:case fV.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&ej(e,n,4,4);case fV.BC4_UNORM:case fV.BC4_SNORM:case fV.BC5_UNORM:case fV.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&ej(e,n,4,4);case fV.U16_R_NORM:case fV.U16_RG_NORM:case fV.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case fV.F32_R:case fV.F32_RG:case fV.F32_RGB:case fV.F32_RGBA:return null!==this.OES_texture_float_linear;case fV.F16_R:case fV.F16_RG:case fV.F16_RGB:case fV.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},t.prototype.queryProgramReady=function(t){var e=this.gl;if(t.compileState===nj.NeedsCompile)throw new Error("whoops");if(t.compileState===nj.Compiling){var n=void 0;return(n=null===this.KHR_parallel_shader_compile||e.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(t),n}return t.compileState===nj.NeedsBind||t.compileState===nj.ReadyToUse},t.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},t.prototype.queryVendorInfo=function(){return this},t.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},t.prototype.queryRenderTarget=function(t){return t},t.prototype.setResourceName=function(t,e){if(t.name=e,t.type===Vz.Buffer)for(var n=t.gl_buffer_pages,r=0;r<n.length;r++)ZW(n[r],"".concat(e," Page ").concat(r));else if(t.type===Vz.Texture)ZW($W(t),e);else if(t.type===Vz.Sampler)ZW(qW(t),e);else if(t.type===Vz.RenderTarget){var i=t.gl_renderbuffer;null!==i&&ZW(i,e)}else t.type===Vz.InputLayout&&ZW(t.vao,e)},t.prototype.setResourceLeakCheck=function(t,e){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(t,e)},t.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},t.prototype.pushDebugGroup=function(t){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(t){},t.prototype.programPatched=function(t,e){xV(this.shaderDebug)},t.prototype.getBufferData=function(t,e,n){void 0===n&&(n=0);var r=this.gl;zW(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,KW(t,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,e))},t.prototype.debugGroupStatisticsDrawCall=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].drawCallCount+=t},t.prototype.debugGroupStatisticsBufferUpload=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].bufferUploadCount+=t},t.prototype.debugGroupStatisticsTextureBind=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].textureBindCount+=t},t.prototype.debugGroupStatisticsTriangles=function(t){for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].triangleCount+=t},t.prototype.reportShaderError=function(t,e){var n=this.gl,r=n.getShaderParameter(t,n.COMPILE_STATUS);if(!r){console.error(function(t,e){return void 0===e&&(e=1),t.split("\n").map((function(t,n){return"".concat(function(t,e,n){for(;t.length<e;)t="".concat(n).concat(t);return t}(""+(e+n),4," "),"  ").concat(t)})).join("\n")}(e));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return r},t.prototype.checkProgramCompilationForErrors=function(t){var e=this.gl,n=t.gl_program;if(!e.getProgramParameter(n,e.LINK_STATUS)){var r=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(t.gl_shader_frag,r.fragment.glsl))return;console.error(e.getProgramInfoLog(t.gl_program))}},t.prototype.bindFramebufferAttachment=function(t,e,n,r){var i=this.gl;if(_(n))i.framebufferRenderbuffer(t,e,i.RENDERBUFFER,null);else if(n.type===Vz.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(t,e,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(t,e,zz.TEXTURE_2D,$W(n.texture),r);else if(n.type===Vz.Texture){var o=$W(n);n.dimension===nV.TEXTURE_2D?i.framebufferTexture2D(t,e,zz.TEXTURE_2D,o,r):zW(i)&&(n.dimension,nV.TEXTURE_2D_ARRAY)}},t.prototype.bindFramebufferDepthStencilAttachment=function(t,e){var n=this.gl,r=_(e)?dV.Depth|dV.Stencil:yV(e.format),i=!!(r&dV.Depth),o=!!(r&dV.Stencil);i&&o?zW(this.gl)||!zW(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,e,0):this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,e,0):i?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null,0))},t.prototype.validateCurrentAttachments=function(){for(var t=-1,e=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===t?(t=i.sampleCount,e=i.width,n=i.height):(xV(t===i.sampleCount),xV(e===i.width),xV(n===i.height)))}this.currentDepthStencilAttachment&&(-1===t?t=this.currentDepthStencilAttachment.sampleCount:(xV(t===this.currentDepthStencilAttachment.sampleCount),xV(e===this.currentDepthStencilAttachment.width),xV(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},t.prototype.setRenderPassParametersBegin=function(t,e){void 0===e&&(e=!1);var n=this.gl;if(e)n.bindFramebuffer(zz.FRAMEBUFFER,null);else if(zW(n)?n.bindFramebuffer(zz.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(zz.FRAMEBUFFER,this.renderPassDrawFramebuffer),zW(n)?n.drawBuffers([zz.COLOR_ATTACHMENT0,zz.COLOR_ATTACHMENT1,zz.COLOR_ATTACHMENT2,zz.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([zz.COLOR_ATTACHMENT0_WEBGL,zz.COLOR_ATTACHMENT1_WEBGL,zz.COLOR_ATTACHMENT2_WEBGL,zz.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var r=t;r<this.currentColorAttachments.length;r++){var i=zW(n)?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,o=zW(n)?zz.COLOR_ATTACHMENT0:zz.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(i,o+r,zz.RENDERBUFFER,null),n.framebufferTexture2D(i,o+r,zz.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},t.prototype.setRenderPassParametersColor=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=zW(this.gl);this.currentColorAttachments[t]===e&&this.currentColorAttachmentLevels[t]===n||(this.currentColorAttachments[t]=e,this.currentColorAttachmentLevels[t]=n,!o&&(a||!a&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(a?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,(a?zz.COLOR_ATTACHMENT0:zz.COLOR_ATTACHMENT0_WEBGL)+t,e,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[t]===r&&this.currentColorResolveToLevels[t]===i||(this.currentColorResolveTos[t]=r,this.currentColorResolveToLevels[t]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},t.prototype.setRenderPassParametersDepthStencil=function(t,e,n){void 0===n&&(n=!1);var r=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,n||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(zW(r)?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==e&&(this.currentDepthStencilResolveTo=e,e&&(this.resolveDepthStencilAttachmentsChanged=!0))},t.prototype.setRenderPassParametersClearColor=function(t,e,n,r,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[t])&&o.channelWriteMask!==iV.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),o.channelWriteMask=iV.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==iV.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=iV.ALL);this.setScissorRectEnabled(!1),zW(a)?a.clearBufferfv(a.COLOR,t,[e,n,r,i]):(a.clearColor(e,n,r,i),a.clear(a.COLOR_BUFFER_BIT))},t.prototype.setRenderPassParametersClearDepthStencil=function(t,e){void 0===t&&(t="load"),void 0===e&&(e="load");var n=this.gl;"load"!==t&&(xV(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),zW(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==e&&(xV(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),zW(n)?n.clearBufferiv(n.STENCIL,0,[e]):(n.clearStencil(e),n.clear(n.STENCIL_BUFFER_BIT)))},t.prototype.setBindings=function(t){var e,n=this;if(this.renderBundle)this.renderBundle.push((function(){return n.setBindings(t)}));else{var i=this.gl,o=t,a=o.uniformBufferBindings,s=o.samplerBindings,l=o.bindingLayouts;xV(0<l.bindingLayoutTables.length);var u=l.bindingLayoutTables[0];xV(a.length>=u.numUniformBuffers),xV(s.length>=u.numSamplers);for(var c=0;c<a.length;c++){if(0!==(m=a[c]).size){var h=u.firstUniformBuffer+c,d=m.buffer,f=m.offset||0,p=m.size||d.byteSize;if(d!==this.currentUniformBuffers[h]||f!==this.currentUniformBufferByteOffsets[h]||p!==this.currentUniformBufferByteSizes[h]){var g=f%d.pageByteSize,v=d.gl_buffer_pages[f/d.pageByteSize|0];xV(g+p<=d.pageByteSize),zW(i)&&i.bindBufferRange(i.UNIFORM_BUFFER,h,v,g,p),this.currentUniformBuffers[h]=d,this.currentUniformBufferByteOffsets[h]=f,this.currentUniformBufferByteSizes[h]=p}}}for(c=0;c<u.numSamplers;c++){var m=s[c],y=u.firstSampler+c,E=null!==m&&null!==m.sampler?qW(m.sampler):null,_=null!==m&&null!==m.texture?$W(m.texture):null;if(this.currentSamplers[y]!==E&&(zW(i)&&i.bindSampler(y,E),this.currentSamplers[y]=E),this.currentTextures[y]!==_){if(this.setActiveTexture(i.TEXTURE0+y),null!==_){var b=SV(m).texture,x=b.gl_target,S=b.width,M=b.height;m.texture.textureIndex=y,i.bindTexture(x,_),zW(i)||null===(e=m.sampler)||void 0===e||e.setTextureParameters(x,S,M),this.debugGroupStatisticsTextureBind()}else{var A=r(r({},m),qV),R=A.dimension,T=A.formatKind;x=tj(R);i.bindTexture(x,this.getFallbackTexture(r({gl_target:x,formatKind:T},A)))}this.currentTextures[y]=_}}}},t.prototype.setViewport=function(t,e,n,r){this.gl.viewport(t,e,n,r)},t.prototype.setScissorRect=function(t,e,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(t,e,n,r)},t.prototype.applyAttachmentStateIndexed=function(t,e,n){var r=this.gl,i=this.OES_draw_buffers_indexed;e.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(t,!!(n.channelWriteMask&iV.RED),!!(n.channelWriteMask&iV.GREEN),!!(n.channelWriteMask&iV.BLUE),!!(n.channelWriteMask&iV.ALPHA)),e.channelWriteMask=n.channelWriteMask);var o=e.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=e.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(JW(e.rgbBlendState)&&JW(e.alphaBlendState)?i.enableiOES(t,r.BLEND):JW(n.rgbBlendState)&&JW(n.alphaBlendState)&&i.disableiOES(t,r.BLEND)),o&&(i.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),e.rgbBlendState.blendMode=n.rgbBlendState.blendMode,e.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},t.prototype.applyAttachmentState=function(t,e){var n=this.gl;t.channelWriteMask!==e.channelWriteMask&&(n.colorMask(!!(e.channelWriteMask&iV.RED),!!(e.channelWriteMask&iV.GREEN),!!(e.channelWriteMask&iV.BLUE),!!(e.channelWriteMask&iV.ALPHA)),t.channelWriteMask=e.channelWriteMask);var r=t.rgbBlendState.blendMode!==e.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==e.alphaBlendState.blendMode,i=t.rgbBlendState.blendSrcFactor!==e.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==e.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==e.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==e.alphaBlendState.blendDstFactor;(i||r)&&(JW(t.rgbBlendState)&&JW(t.alphaBlendState)?n.enable(n.BLEND):JW(e.rgbBlendState)&&JW(e.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(e.rgbBlendState.blendMode,e.alphaBlendState.blendMode),t.rgbBlendState.blendMode=e.rgbBlendState.blendMode,t.alphaBlendState.blendMode=e.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(e.rgbBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor,e.alphaBlendState.blendSrcFactor,e.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=e.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=e.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=e.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=e.alphaBlendState.blendDstFactor)},t.prototype.setMegaState=function(t){var e=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<t.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],t.attachmentsState[0]);else xV(1===t.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);MV(n.blendConstant,t.blendConstant)||(e.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),AV(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(e.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),!!n.depthWrite!=!!t.depthWrite&&(e.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),!!n.stencilWrite!=!!t.stencilWrite&&(e.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite);var i=!1;if(!oW(n.stencilFront,t.stencilFront)){i=!0;var o=t.stencilFront,a=o.passOp,s=o.failOp,l=o.depthFailOp,u=o.compare;n.stencilFront.passOp===a&&n.stencilFront.failOp===s&&n.stencilFront.depthFailOp===l||(e.stencilOpSeparate(e.FRONT,s,l,a),n.stencilFront.passOp=a,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=l),n.stencilFront.compare!==u&&(this.setStencilReference(0),n.stencilFront.compare=u)}if(!oW(n.stencilBack,t.stencilBack)){i=!0;var c=t.stencilBack;a=c.passOp,s=c.failOp,l=c.depthFailOp,u=c.compare;n.stencilBack.passOp===a&&n.stencilBack.failOp===s&&n.stencilBack.depthFailOp===l||(e.stencilOpSeparate(e.BACK,s,l,a),n.stencilBack.passOp=a,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=l),n.stencilBack.compare!==u&&(this.setStencilReference(0),n.stencilBack.compare=u)}n.stencilFront.mask===t.stencilFront.mask&&n.stencilBack.mask===t.stencilBack.mask||(i=!0,n.stencilFront.mask=t.stencilFront.mask,n.stencilBack.mask=t.stencilBack.mask),i&&this.applyStencil(),n.cullMode!==t.cullMode&&(n.cullMode===Hz.NONE?e.enable(e.CULL_FACE):t.cullMode===Hz.NONE&&e.disable(e.CULL_FACE),t.cullMode===Hz.BACK?e.cullFace(e.BACK):t.cullMode===Hz.FRONT?e.cullFace(e.FRONT):t.cullMode===Hz.FRONT_AND_BACK&&e.cullFace(e.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(e.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset),n.polygonOffsetFactor===t.polygonOffsetFactor&&n.polygonOffsetUnits===t.polygonOffsetUnits||(e.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),n.polygonOffsetFactor=t.polygonOffsetFactor,n.polygonOffsetUnits=t.polygonOffsetUnits)},t.prototype.validatePipelineFormats=function(t){for(var e=0;e<this.currentColorAttachments.length;e++)this.currentColorAttachments[e];this.currentDepthStencilAttachment&&xV(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&xV(this.currentSampleCount===t.sampleCount)},t.prototype.setPipeline=function(t){var e=this;if(this.renderBundle)this.renderBundle.push((function(){return e.setPipeline(t)}));else{this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===nj.NeedsBind){var r=this.gl,i=n.gl_program,o=n.descriptor,a=QW(o.vertex.glsl,vj);if(zW(r))for(var s=0;s<a.length;s++){var u=l(a[s],2)[1],c=r.getUniformBlockIndex(i,u);-1!==c&&4294967295!==c&&r.uniformBlockBinding(i,c,s)}var h=QW(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<h.length;s++){var d=l(h[s],3),f=d[1],p=d[2],g=r.getUniformLocation(i,f);r.uniform1i(g,parseInt(p))}n.compileState=nj.ReadyToUse}}},t.prototype.setVertexInput=function(t,e,n){var r,i,o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.setVertexInput(t,e,n)}));else if(null!==t){xV(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var u=this.gl,c=0;c<l.vertexBufferDescriptors.length;c++){var h=l.vertexBufferDescriptors[c],d=h.arrayStride,f=h.attributes;try{for(var p=(r=void 0,s(f)),g=p.next();!g.done;g=p.next()){var v=g.value,m=v.shaderLocation,y=v.offset,E=zW(u)?m:null===(o=l.program.attributes[m])||void 0===o?void 0:o.location;if(!_(E)){var b=e[c];if(null===b)continue;var x=v.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,KW(b.buffer));var S=(b.offset||0)+y;u.vertexAttribPointer(E,x.size,x.type,x.normalized,d,S)}}}catch(t){r={error:t}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(xV(null!==n==(null!==l.indexBufferFormat)),null!==n){var M=n.buffer;xV(M.usage===Qz.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,KW(M)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else xV(null===this.currentPipeline.inputLayout),xV(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},t.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},t.prototype.draw=function(t,e,n,r){var i,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.draw(t,e,n,r)}));else{var a=this.gl,s=this.currentPipeline;if(e){var c=[s.drawMode,n||0,t,e];zW(a)?a.drawArraysInstanced.apply(a,u([],l(c),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,u([],l(c),!1))}else a.drawArrays(s.drawMode,n,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))}},t.prototype.drawIndexed=function(t,e,n,r,i){var o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.drawIndexed(t,e,n,r,i)}));else{var s=this.gl,c=this.currentPipeline,h=SV(c.inputLayout),d=SV(this.currentIndexBufferByteOffset)+n*h.indexBufferCompByteSize;if(e){var f=[c.drawMode,t,h.indexBufferType,d,e];zW(s)?s.drawElementsInstanced.apply(s,u([],l(f),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,u([],l(f),!1))}else s.drawElements(c.drawMode,t,h.indexBufferType,d);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))}},t.prototype.drawIndirect=function(t,e){},t.prototype.drawIndexedIndirect=function(t,e){},t.prototype.beginOcclusionQuery=function(t){var e=this.gl;if(zW(e)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;e.beginQuery(n.gl_query_type,n.gl_query[t])}},t.prototype.endOcclusionQuery=function(){var t=this.gl;if(zW(t)){var e=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(e.gl_query_type)}},t.prototype.pipelineQueryReady=function(t){var e=t;return this.queryProgramReady(e.program)},t.prototype.pipelineForceReady=function(t){},t.prototype.endPass=function(){for(var t=this.gl,e=zW(t),n=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,r=!1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];if(null!==o){var a=this.currentColorResolveTos[i],s=!1;null!==a&&(xV(o.width===a.width&&o.height===a.height),this.setScissorRectEnabled(!1),n||(e&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&e&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),s=!0,n||(a===this.scTexture?t.bindFramebuffer(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a.gl_texture,this.currentColorResolveToLevels[i]))),n||(e?(t.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,a)),r=!0),this.currentRenderPassDescriptor.colorStore[i]||n||s||(t.bindFramebuffer(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),n||t.bindFramebuffer(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l){var u=this.currentDepthStencilResolveTo;s=!1;u&&(xV(l.width===u.width&&l.height===u.height),this.setScissorRectEnabled(!1),n||(t.bindFramebuffer(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,u))),s=!0,n||(e&&t.blitFramebuffer(0,0,l.width,l.height,0,0,u.width,u.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,null)),r=!0),n||this.currentRenderPassDescriptor.depthStencilStore||(s||(t.bindFramebuffer(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,l),s=!0),e&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!n&&s&&t.bindFramebuffer(e?zz.READ_FRAMEBUFFER:zz.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r||t.bindFramebuffer(e?zz.DRAW_FRAMEBUFFER:zz.FRAMEBUFFER,null)},t.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.currentScissorEnabled=t}},t.prototype.applyStencil=function(){_(this.currentStencilRef)||(this.gl.stencilFuncSeparate(zz.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(zz.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},t.prototype.getFallbackTexture=function(t){var e=t.gl_target,n=t.formatKind;if(e===zz.TEXTURE_2D)return n===aV.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===zz.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===zz.TEXTURE_3D)return this.fallbackTexture3D;if(e===zz.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},t.prototype.submitBlitRenderPass=function(t,e){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:Qz.VERTEX|Qz.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Zz.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[fV.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:jV(XV)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[t],colorResolveTo:[e],colorClearColor:[PV]}),i=this.getCanvas(),o=i.width,a=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},t}(),yj=function(){function t(t){this.pluginOptions=t}return t.prototype.createSwapChain=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o,s,l,u,c,h,d,f,p;return a(this,(function(a){return e=this.pluginOptions,n=e.targets,r=e.xrCompatible,i=e.antialias,o=void 0!==i&&i,s=e.preserveDrawingBuffer,l=void 0!==s&&s,u=e.premultipliedAlpha,c=void 0===u||u,h=e.shaderDebug,d=e.trackResources,f={antialias:o,preserveDrawingBuffer:l,stencil:!0,premultipliedAlpha:c,xrCompatible:r},this.handleContextEvents(t),n.includes("webgl2")&&(p=t.getContext("webgl2",f)||t.getContext("experimental-webgl2",f)),!p&&n.includes("webgl1")&&(p=t.getContext("webgl",f)||t.getContext("experimental-webgl",f)),[2,new mj(p,{shaderDebug:h,trackResources:d})]}))}))},t.prototype.handleContextEvents=function(t){var e=this.pluginOptions,n=e.onContextLost,r=e.onContextRestored,i=e.onContextCreationError;i&&t.addEventListener("webglcontextcreationerror",i,!1),n&&t.addEventListener("webglcontextlost",n,!1),r&&t.addEventListener("webglcontextrestored",r,!1)},t}();const Ej="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&Ej.decode();const _j=new Array(128).fill(void 0);_j.push(void 0,null,!0,!1),_j.length;const bj="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};var xj,Sj;function Mj(t){if(t===nV.TEXTURE_2D)return"2d";if(t===nV.TEXTURE_CUBE_MAP)return"cube";if(t===nV.TEXTURE_2D_ARRAY)return"2d-array";if(t===nV.TEXTURE_3D)return"3d";throw new Error("whoops")}function Aj(t){if(t===Kz.CLAMP_TO_EDGE)return"clamp-to-edge";if(t===Kz.REPEAT)return"repeat";if(t===Kz.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function Rj(t){if(t===$z.BILINEAR)return"linear";if(t===$z.POINT)return"nearest";throw new Error("whoops")}function Tj(t){if(t===qz.LINEAR)return"linear";if(t===qz.NEAREST)return"nearest";if(t===qz.NO_MIP)return"nearest";throw new Error("whoops")}function wj(t){return t.gpuBuffer}function Pj(t){if(t===uV.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Nj(t){if(t===Wz.NEVER)return"never";if(t===Wz.LESS)return"less";if(t===Wz.EQUAL)return"equal";if(t===Wz.LEQUAL)return"less-equal";if(t===Wz.GREATER)return"greater";if(t===Wz.NOTEQUAL)return"not-equal";if(t===Wz.GEQUAL)return"greater-equal";if(t===Wz.ALWAYS)return"always";throw new Error("whoops")}function Cj(t){if(t===tV.VERTEX)return"vertex";if(t===tV.INSTANCE)return"instance";throw new Error("whoops")}function Oj(t){if(t===fV.U8_R)return"uint8x2";if(t===fV.U8_RG)return"uint8x2";if(t===fV.U8_RGB)return"uint8x4";if(t===fV.U8_RGBA)return"uint8x4";if(t===fV.U8_RG_NORM)return"unorm8x2";if(t===fV.U8_RGBA_NORM)return"unorm8x4";if(t===fV.S8_RGB_NORM)return"snorm8x4";if(t===fV.S8_RGBA_NORM)return"snorm8x4";if(t===fV.U16_RG_NORM)return"unorm16x2";if(t===fV.U16_RGBA_NORM)return"unorm16x4";if(t===fV.S16_RG_NORM)return"snorm16x2";if(t===fV.S16_RGBA_NORM)return"snorm16x4";if(t===fV.S16_RG)return"uint16x2";if(t===fV.F16_RG)return"float16x2";if(t===fV.F16_RGBA)return"float16x4";if(t===fV.F32_R)return"float32";if(t===fV.F32_RG)return"float32x2";if(t===fV.F32_RGB)return"float32x3";if(t===fV.F32_RGBA)return"float32x4";throw"whoops"}function Ij(t,e,n,r){switch(void 0===n&&(n=!1),t){case fV.S8_R:case fV.S8_R_NORM:case fV.S8_RG_NORM:case fV.S8_RGB_NORM:case fV.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(e));return r&&i.set(new Int8Array(r)),i;case fV.U8_R:case fV.U8_R_NORM:case fV.U8_RG:case fV.U8_RG_NORM:case fV.U8_RGB:case fV.U8_RGB_NORM:case fV.U8_RGB_SRGB:case fV.U8_RGBA:case fV.U8_RGBA_NORM:case fV.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(e));return r&&o.set(new Uint8Array(r)),o;case fV.S16_R:case fV.S16_RG:case fV.S16_RG_NORM:case fV.S16_RGB_NORM:case fV.S16_RGBA:case fV.S16_RGBA_NORM:var a=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(n?e/2:e);return r&&a.set(new Int16Array(r)),a;case fV.U16_R:case fV.U16_RGB:case fV.U16_RGBA_5551:case fV.U16_RGBA_NORM:case fV.U16_RG_NORM:case fV.U16_R_NORM:var s=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(n?e/2:e);return r&&s.set(new Uint16Array(r)),s;case fV.S32_R:var l=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(n?e/4:e);return r&&l.set(new Int32Array(r)),l;case fV.U32_R:case fV.U32_RG:var u=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(n?e/4:e);return r&&u.set(new Uint32Array(r)),u;case fV.F32_R:case fV.F32_RG:case fV.F32_RGB:case fV.F32_RGBA:var c=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(n?e/4:e);return r&&c.set(new Float32Array(r)),c}var h=(ArrayBuffer,new Uint8Array(e));return r&&h.set(new Uint8Array(r)),h}function Lj(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}bj.encodeInto,function(t){t[t.COPY_SRC=1]="COPY_SRC",t[t.COPY_DST=2]="COPY_DST",t[t.TEXTURE_BINDING=4]="TEXTURE_BINDING",t[t.STORAGE_BINDING=8]="STORAGE_BINDING",t[t.STORAGE=8]="STORAGE",t[t.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(xj||(xj={})),function(t){t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(Sj||(Sj={}));var Dj=function(t){function e(e){var n=e.id,r=e.device,i=t.call(this)||this;return i.id=n,i.device=r,i}return n(e,t),e.prototype.destroy=function(){},e}($x);!function(t){function e(e){var n,i,o=e.id,a=e.device,s=e.descriptor,l=t.call(this,{id:o,device:a})||this;l.type=Vz.Bindings;var u=s.pipeline;xV(!!u);var c=s.uniformBufferBindings,h=s.storageBufferBindings,d=s.samplerBindings,f=s.storageTextureBindings;l.numUniformBuffers=(null==c?void 0:c.length)||0;var p=[[],[],[],[]],g=0;if(c&&c.length)for(var v=0;v<c.length;v++){var m=s.uniformBufferBindings[v],y=m.binding,E=m.size,_=m.offset,b={buffer:wj(m.buffer),offset:null!=_?_:0,size:E};p[0].push({binding:null!=y?y:g++,resource:b})}if(d&&d.length){g=0;for(v=0;v<d.length;v++){var x=r(r({},d[v]),qV),S=null!==(y=s.samplerBindings[v]).texture?y.texture:l.device.getFallbackTexture(x);x.dimension=S.dimension,x.formatKind=bV(S.format);var M=S.gpuTextureView;if(p[1].push({binding:null!==(n=y.textureBinding)&&void 0!==n?n:g++,resource:M}),-1!==y.samplerBinding){var A=null!==y.sampler?y.sampler:l.device.getFallbackSampler(x),R=A.gpuSampler;p[1].push({binding:null!==(i=y.samplerBinding)&&void 0!==i?i:g++,resource:R})}}}if(h&&h.length){g=0;for(v=0;v<h.length;v++){var T=s.storageBufferBindings[v];y=T.binding,E=T.size,_=T.offset,b={buffer:wj(T.buffer),offset:null!=_?_:0,size:E};p[2].push({binding:null!=y?y:g++,resource:b})}}if(f&&f.length){g=0;for(v=0;v<f.length;v++){var w=s.storageTextureBindings[v];y=w.binding,M=(S=w.texture).gpuTextureView;p[3].push({binding:null!=y?y:g++,resource:M})}}var P=p.findLastIndex((function(t){return!!t.length}));return l.gpuBindGroup=p.map((function(t,e){return e<=P&&l.device.device.createBindGroup({layout:u.getBindGroupLayout(e),entries:t})})),l}n(e,t)}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.Buffer;var a=i.usage,s=i.viewOrSize,l=!!(a&Qz.MAP_READ);o.usage=function(t){var e=0;return t&Qz.INDEX&&(e|=GPUBufferUsage.INDEX),t&Qz.VERTEX&&(e|=GPUBufferUsage.VERTEX),t&Qz.UNIFORM&&(e|=GPUBufferUsage.UNIFORM),t&Qz.STORAGE&&(e|=GPUBufferUsage.STORAGE),t&Qz.COPY_SRC&&(e|=GPUBufferUsage.COPY_SRC),t&Qz.INDIRECT&&(e|=GPUBufferUsage.INDIRECT),e|GPUBufferUsage.COPY_DST}(a),l&&(o.usage=Qz.MAP_READ|Qz.COPY_DST);var u=!I(s);(o.view=I(s)?null:s,o.size=I(s)?DV(s,4):DV(s.byteLength,4),I(s))?o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!!l&&u}):(o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(o.gpuBuffer.getMappedRange()).set(s),o.gpuBuffer.unmap());return o}n(e,t),e.prototype.setSubData=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||e.byteLength,r=Math.min(r,this.size-t);var o=e.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var l=new Uint8Array(e.buffer.slice(o,a));(e=new Uint8Array(s)).set(l),n=0,o=0,a=s,r=s}for(var u=15728640,c=0;a-(o+c)>u;)this.device.device.queue.writeBuffer(i,t+c,e.buffer,o+c,u),c+=u;this.device.device.queue.writeBuffer(i,t+c,e.buffer,o+c,r-c)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuBuffer.destroy()}}(Dj),function(t){function e(e){var n=e.id,i=e.device,o=e.descriptor,a=t.call(this,{id:n,device:i})||this;a.type=Vz.ComputePipeline,a.gpuComputePipeline=null,a.descriptor=o;var s=o.program.computeStage;if(null===s)return a;var l={layout:"auto",compute:r({},s)};return a.gpuComputePipeline=a.device.device.createComputePipeline(l),void 0!==a.name&&(a.gpuComputePipeline.label=a.name),a}n(e,t),e.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)}}(Dj),function(t){function e(e){var n,r,i,o,a=e.id,l=e.device,u=e.descriptor,c=t.call(this,{id:a,device:l})||this;c.type=Vz.InputLayout;var h=[];try{for(var d=s(u.vertexBufferDescriptors),f=d.next();!f.done;f=d.next()){var p=f.value,g=p.arrayStride,v=p.stepMode,m=p.attributes;h.push({arrayStride:g,stepMode:Cj(v),attributes:[]});try{for(var y=(i=void 0,s(m)),E=y.next();!E.done;E=y.next()){var _=E.value,b=_.shaderLocation,x=_.format,S=_.offset;h[h.length-1].attributes.push({shaderLocation:b,format:Oj(x),offset:S})}}catch(t){i={error:t}}finally{try{E&&!E.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return c.indexFormat=function(t){if(null!==t){if(t===fV.U16_R)return"uint16";if(t===fV.U32_R)return"uint32";throw new Error("whoops")}}(u.indexBufferFormat),c.buffers=h,c}n(e,t)}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;return o.type=Vz.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=i,i.vertex&&(o.vertexStage=o.createShaderStage(i.vertex,"vertex")),i.fragment&&(o.fragmentStage=o.createShaderStage(i.fragment,"fragment")),i.compute&&(o.computeStage=o.createShaderStage(i.compute,"compute")),o}n(e,t),e.prototype.setUniformsLegacy=function(t){},e.prototype.createShaderStage=function(t,e){var n,r,i=t.glsl,o=t.wgsl,a=t.entryPoint,l=t.postprocess,u=o;if(!u)try{u=this.device.glsl_compile(i,e,!1)}catch(t){throw console.error(t,i),new Error("whoops")}var c=function(t){if(!u.includes(t))return"continue";u=(u=u.replace("var T_".concat(t,": texture_2d<f32>;"),"var T_".concat(t,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(t,"(.*)\\);$"),"gm"),(function(e,n){return"vec4<f32>(textureSample(T_".concat(t).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var h=s(["u_TextureFramebufferDepth"]),d=h.next();!d.done;d=h.next()){c(d.value)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l&&(u=l(u)),{module:this.device.device.createShaderModule({code:u}),entryPoint:a||"main"}}}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;o.type=Vz.QueryPool;var a=i.elemCount,s=i.type;return o.querySet=o.device.device.createQuerySet({type:Pj(s),count:a}),o.resolveBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}n(e,t),e.prototype.queryResultOcclusion=function(t){return null===this.results?null:this.results[t]!==BigInt(0)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()}}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=t.call(this,{id:n,device:r})||this;return i.type=Vz.Readback,i}n(e,t),e.prototype.readTexture=function(t,e,n,r,i,s,l,u){return void 0===l&&(l=0),o(this,void 0,void 0,(function(){var o,u,c,h,d,f,p;return a(this,(function(a){return 0,u=Lj((o=t).gpuTextureformat),c=Math.ceil(r/u.width)*u.length,h=256*Math.ceil(c/256),d=h*i,f=this.device.createBuffer({usage:Qz.STORAGE|Qz.MAP_READ|Qz.COPY_DST,hint:Jz.STATIC,viewOrSize:d}),(p=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:o.gpuTexture,mipLevel:0,origin:{x:e,y:n,z:Math.max(0,0)}},{buffer:f.gpuBuffer,offset:0,bytesPerRow:h},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([p.finish()]),[2,this.readBuffer(f,0,s.byteLength===d?s:null,l,d,o.format,!0,!1,c,h,i)]}))}))},e.prototype.readTextureSync=function(t,e,n,r,i,o,a,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},e.prototype.readBuffer=function(t,e,n,r,i,o,a,s,l,u,c){var h=this;void 0===e&&(e=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=fV.U8_RGB),void 0===a&&(a=!1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0);var d=t,f=i||d.size,p=n||d.view,g=p&&p.constructor&&p.constructor.BYTES_PER_ELEMENT||_V(o),v=d;if(!(d.usage&Qz.MAP_READ&&d.usage&Qz.COPY_DST)){var m=this.device.device.createCommandEncoder();v=this.device.createBuffer({usage:Qz.STORAGE|Qz.MAP_READ|Qz.COPY_DST,hint:Jz.STATIC,viewOrSize:f}),m.copyBufferToBuffer(d.gpuBuffer,e,v.gpuBuffer,0,f),this.device.device.queue.submit([m.finish()])}return new Promise((function(t,n){v.gpuBuffer.mapAsync(Sj.READ,e,f).then((function(){var n=v.gpuBuffer.getMappedRange(e,f),r=p;if(a)r=null===r?Ij(o,f,!0,n):Ij(o,r.buffer,void 0,n);else if(null===r)switch(g){case 1:(r=new Uint8Array(f)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n);break;case 4:(r=new Float32Array(f/4)).set(new Float32Array(n))}else switch(g){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n,p);break;case 4:var i=p&&p.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}if(l!==u){1!==g||a||(l*=2,u*=2);for(var s=new Uint8Array(r.buffer),d=l,m=0,y=1;y<c;++y){m=y*u;for(var E=0;E<l;++E)s[d++]=s[m++]}r=0===g||a?new Uint8Array(s.buffer,0,d):new Float32Array(s.buffer,0,d/4)}v.gpuBuffer.unmap(),t(r)}),(function(t){return n(t)}))}))},e.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,e,n){n||(n=new Float32Array(t));for(var r,i,o,a,s=new Uint16Array(e);t--;)n[t]=(r=s[t],i=void 0,o=void 0,a=void 0,i=(32768&r)>>15,a=1023&r,0===(o=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return n}}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=t.call(this,{id:n,device:r})||this;return o.type=Vz.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=i,o.device.createRenderPipelineInternal(o,!1),o}n(e,t),e.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)}}(Dj),function(t){function e(e){var n,r,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;s.type=Vz.Sampler;var l=a.lodMinClamp,u=a.mipmapFilter===qz.NO_MIP?a.lodMinClamp:a.lodMaxClamp,c=null!==(n=a.maxAnisotropy)&&void 0!==n?n:1;return c>1&&xV(a.minFilter===$z.BILINEAR&&a.magFilter===$z.BILINEAR&&a.mipmapFilter===qz.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:Aj(a.addressModeU),addressModeV:Aj(a.addressModeV),addressModeW:Aj(null!==(r=a.addressModeW)&&void 0!==r?r:a.addressModeU),lodMinClamp:l,lodMaxClamp:u,minFilter:Rj(a.minFilter),magFilter:Rj(a.magFilter),mipmapFilter:Tj(a.mipmapFilter),compare:void 0!==a.compareFunction?Nj(a.compareFunction):void 0,maxAnisotropy:c}),s}n(e,t)}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=e.descriptor,o=e.skipCreate,a=e.sampleCount,s=t.call(this,{id:n,device:r})||this;s.type=Vz.Texture,s.flipY=!1;var l=i.format,u=i.dimension,c=i.width,h=i.height,d=i.depthOrArrayLayers,f=i.mipLevelCount,p=i.usage,g=i.pixelStore;return s.flipY=!!(null==g?void 0:g.unpackFlipY),s.device.createTextureShared({format:l,dimension:null!=u?u:nV.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=d?d:1,mipLevelCount:null!=f?f:1,usage:p,sampleCount:null!=a?a:1},s,o),s}n(e,t),e.prototype.textureFromImageBitmapOrCanvas=function(t,e,n){for(var r=e[0].width,i=e[0].height,o={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=t.createTexture(o),s=0;s<e.length;s++)t.queue.copyExternalImageToTexture({source:e[s],flipY:this.flipY},{texture:a,origin:[0,0,s]},[r,i]);return[a,r,i]},e.prototype.isImageBitmapOrCanvases=function(t){var e=t[0];return e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas},e.prototype.isVideo=function(t){return t[0]instanceof HTMLVideoElement},e.prototype.setImageData=function(t,e){var n,r,i,o,a=this,s=this.device.device;if(this.isImageBitmapOrCanvases(t))r=(n=l(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3))[0],i=n[1],o=n[2];else if(this.isVideo(t))r=s.importExternalTexture({source:t[0]});else{var u=Lj(this.gpuTextureformat),c=Math.ceil(this.width/u.width)*u.length;t.forEach((function(t){s.queue.writeTexture({texture:a.gpuTexture},t,{bytesPerRow:c},{width:a.width,height:a.height})}))}this.width=i,this.height=o,r&&(this.gpuTexture=r),this.gpuTextureView=this.gpuTexture.createView({dimension:Mj(this.dimension)})},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuTexture.destroy()}}(Dj),function(t){function e(e){var n=e.id,r=e.device,i=t.call(this,{id:n,device:r})||this;return i.type=Vz.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}n(e,t),e.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()}}(Dj);var Bj={exports:{}};function kj(t,e,n){n=n||2;var r,i,o,a,s,l,u,c=e&&e.length,h=c?e[0]*n:t.length,d=Fj(t,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Fj(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push($j(a));for(s.sort(Hj),i=0;i<s.length;i++)n=Xj(s[i],n);return n}(t,e,d,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var p=n;p<h;p+=n)(s=t[p])<r&&(r=s),(l=t[p+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-i))?32767/u:0}return Gj(d,f,n,r,i,u,0),f}function Fj(t,e,n,r,i){var o,a;if(i===lH(t,e,n,r)>0)for(o=e;o<n;o+=r)a=oH(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=oH(o,t[o],t[o+1],a);return a&&Jj(a,a.next)&&(aH(a),a=a.next),a}function Uj(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Jj(r,r.next)&&0!==Qj(r.prev,r,r.next))r=r.next;else{if(aH(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Gj(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=Kj(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,l,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Vj(t,r,i,o):zj(t))e.push(s.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),aH(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?Gj(t=Wj(Uj(t),e,n),e,n,r,i,o,2):2===a&&jj(t,e,n,r,i,o):Gj(Uj(t),e,n,r,i,o,1);break}}}function zj(t){var e=t.prev,n=t,r=t.next;if(Qj(e,n,r)>=0)return!1;for(var i=e.x,o=n.x,a=r.x,s=e.y,l=n.y,u=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<l?s<u?s:u:l<u?l:u,d=i>o?i>a?i:a:o>a?o:a,f=s>l?s>u?s:u:l>u?l:u,p=r.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&qj(i,s,o,l,a,u,p.x,p.y)&&Qj(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Vj(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Qj(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,u=a.x,c=i.y,h=o.y,d=a.y,f=s<l?s<u?s:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,g=s>l?s>u?s:u:l>u?l:u,v=c>h?c>d?c:d:h>d?h:d,m=Kj(f,p,e,n,r),y=Kj(g,v,e,n,r),E=t.prevZ,_=t.nextZ;E&&E.z>=m&&_&&_.z<=y;){if(E.x>=f&&E.x<=g&&E.y>=p&&E.y<=v&&E!==i&&E!==a&&qj(s,c,l,h,u,d,E.x,E.y)&&Qj(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,_.x>=f&&_.x<=g&&_.y>=p&&_.y<=v&&_!==i&&_!==a&&qj(s,c,l,h,u,d,_.x,_.y)&&Qj(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;E&&E.z>=m;){if(E.x>=f&&E.x<=g&&E.y>=p&&E.y<=v&&E!==i&&E!==a&&qj(s,c,l,h,u,d,E.x,E.y)&&Qj(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=g&&_.y>=p&&_.y<=v&&_!==i&&_!==a&&qj(s,c,l,h,u,d,_.x,_.y)&&Qj(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Wj(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Jj(i,o)&&tH(i,r,r.next,o)&&rH(i,o)&&rH(o,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),aH(r),aH(r.next),r=t=o),r=r.next}while(r!==t);return Uj(r)}function jj(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Zj(a,s)){var l=iH(a,s);return a=Uj(a,a.next),l=Uj(l,l.next),Gj(a,e,n,r,i,o,0),void Gj(l,e,n,r,i,o,0)}s=s.next}a=a.next}while(a!==t)}function Hj(t,e){return t.x-e.x}function Xj(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==e);if(!n)return null;var l,u=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&qj(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),rH(r,t)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&Yj(n,r)))&&(n=r,d=l)),r=r.next}while(r!==u);return n}(t,e);if(!n)return e;var r=iH(n,t);return Uj(r,r.next),Uj(n,n.next)}function Yj(t,e){return Qj(t.prev,t,e.prev)<0&&Qj(e.next,t,t.next)<0}function Kj(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $j(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function qj(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function Zj(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&tH(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(rH(t,e)&&rH(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Qj(t.prev,t,e.prev)||Qj(t,e.prev,e))||Jj(t,e)&&Qj(t.prev,t,t.next)>0&&Qj(e.prev,e,e.next)>0)}function Qj(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Jj(t,e){return t.x===e.x&&t.y===e.y}function tH(t,e,n,r){var i=nH(Qj(t,e,n)),o=nH(Qj(t,e,r)),a=nH(Qj(n,r,t)),s=nH(Qj(n,r,e));return i!==o&&a!==s||(!(0!==i||!eH(t,n,e))||(!(0!==o||!eH(t,r,e))||(!(0!==a||!eH(n,t,r))||!(0!==s||!eH(n,e,r)))))}function eH(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function nH(t){return t>0?1:t<0?-1:0}function rH(t,e){return Qj(t.prev,t,t.next)<0?Qj(t,e,t.next)>=0&&Qj(t,t.prev,e)>=0:Qj(t,e,t.prev)<0||Qj(t,t.next,e)<0}function iH(t,e){var n=new sH(t.i,t.x,t.y),r=new sH(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function oH(t,e,n,r){var i=new sH(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function aH(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function sH(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lH(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}Bj.exports=kj,Bj.exports.default=kj,kj.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(lH(t,0,o,n));if(i)for(var s=0,l=e.length;s<l;s++){var u=e[s]*n,c=s<l-1?e[s+1]*n:t.length;a-=Math.abs(lH(t,u,c,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},kj.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var uH=ji(Bj.exports),cH=function(){function t(){this.drawcalls=[]}return t.tag="c-renderable-3d",t}(),hH=function(){function t(){this.lights=[]}return t.prototype.addLight=function(t){this.lights.push(t),this.sortLights()},t.prototype.removeLight=function(t){var e=this.lights.indexOf(t);this.lights.splice(e,1),this.sortLights()},t.prototype.addFog=function(t){this.fog=t},t.prototype.removeFog=function(t){this.fog=null},t.prototype.getFog=function(){return this.fog},t.prototype.getAllLights=function(){return this.lights},t.prototype.getDefines=function(){var t={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(e){t[e.define]||(t[e.define]=0),t[e.define]++})),t},t.prototype.sortLights=function(){this.lights.sort((function(t,e){return t.order-e.order}))},t}(),dH=function(t){function e(e){var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,r({type:$S.MESH,style:r({x:"",y:"",z:"",lineWidth:0},o)},a))||this).cullable.enable=!1,n.style.geometry.meshes.push(n),n.style.material.meshes.push(n),n}return n(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this.style.geometry.meshes,n=e.indexOf(this);e.splice(n,1),n=(e=this.style.material.meshes).indexOf(this),e.splice(n,1)},e}(Cw),fH=function(){function t(){}return t.prototype.update=function(t){var e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.z,a=void 0===o?0:o,s=t.geometry.computeBoundingBox();return{cx:n,cy:i,cz:a,hwidth:s.halfExtents[0],hheight:s.halfExtents[1],hdepth:s.halfExtents[2]}},t}(),pH=function(){function t(){this.counter=0,this.id2DisplayObjectMap={}}return t.prototype.getId=function(t){var e=this.counter++;return this.id2DisplayObjectMap[e]=t,e},t.prototype.getById=function(t){return this.id2DisplayObjectMap[t]},t.prototype.deleteById=function(t){delete this.id2DisplayObjectMap[t]},t.prototype.reset=function(){this.counter=0,this.id2DisplayObjectMap={}},t.prototype.decodePickingColor=function(t){var e=l(t,3);return e[0]+256*e[1]+65536*e[2]-1},t.prototype.encodePickingColor=function(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]},t}(),gH=function(){function t(){this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={}}return t.prototype.definesChanged=function(){this.preprocessedVert="",this.preprocessedFrag=""},t.prototype.setDefineString=function(t,e){if(null!==e){if(this.defines[t]===e)return!1;this.defines[t]=e}else{if(_(this.defines[t]))return!1;delete this.defines[t]}return this.definesChanged(),!0},t.prototype.setDefineBool=function(t,e){return this.setDefineString(t,e?"1":null)},t.prototype.getDefineString=function(t){return IV(this.defines[t])},t.prototype.getDefineBool=function(t){var e=this.getDefineString(t);return null!==e&&xV("1"===e),null!==e},t}(),vH=function(){function t(t){this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=t;var e=t.queryLimits();this.uniformBufferWordAlignment=e.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=e.uniformBufferMaxPageWordSize}return t.prototype.isSupportedUBO=function(){return"WebGL1"!==this.device.queryVendorInfo().platformString},t.prototype.findPageIndex=function(t){return t/this.uniformBufferMaxPageWordSize|0},t.prototype.allocateChunk=function(t){xV((t=BV(t,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var e=this.currentWordOffset;return this.findPageIndex(e)!==this.findPageIndex(e+t-1)&&(e=BV(e,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=e+t,this.ensureShadowBuffer(e,t),e},t.prototype.ensureShadowBuffer=function(t,e){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var n=BV(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*n),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(t+e>=this.shadowBufferF32.length){xV(t<this.currentWordOffset&&t+e<=this.currentWordOffset);n=BV(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize);var r=new Uint8Array(4*n);if(r.set(this.shadowBufferU8,0),this.shadowBufferU8=r,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=n))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(n,"]"))}},t.prototype.mapBufferF32=function(){return SV(this.shadowBufferF32)},t.prototype.prepareToRender=function(){if(null!==this.shadowBufferF32){var t=SV(this.shadowBufferF32);t.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=t.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:Qz.UNIFORM,hint:Jz.DYNAMIC}));var e=BV(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(e<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(e,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())SV(this.buffer).setSubData(0,this.shadowBufferU8,0,4*e);this.currentWordOffset=0}},t.prototype.destroy=function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null},t}();function mH(t,e){return t+=e,t+=t<<10,(t+=t>>>6)>>>0}function yH(t){return t+=t<<3,t^=t>>>11,(t+=t<<15)>>>0}function EH(t){return 0}var _H=function(){this.keys=[],this.values=[]},bH=function(){function t(t,e){this.keyEqualFunc=t,this.keyHashFunc=e,this.buckets=new Map}return t.prototype.findBucketIndex=function(t,e){for(var n=0;n<t.keys.length;n++)if(this.keyEqualFunc(e,t.keys[n]))return n;return-1},t.prototype.findBucket=function(t){var e=this.keyHashFunc(t);return this.buckets.get(e)},t.prototype.get=function(t){var e=this.findBucket(t);if(void 0===e)return null;var n=this.findBucketIndex(e,t);return n<0?null:e.values[n]},t.prototype.add=function(t,e){var n=this.keyHashFunc(t);void 0===this.buckets.get(n)&&this.buckets.set(n,new _H);var r=this.buckets.get(n);r.keys.push(t),r.values.push(e)},t.prototype.delete=function(t){var e=this.findBucket(t);if(void 0!==e){var n=this.findBucketIndex(e,t);-1!==n&&(e.keys.splice(n,1),e.values.splice(n,1))}},t.prototype.clear=function(){this.buckets.clear()},t.prototype.size=function(){var t,e,n=0;try{for(var r=s(this.buckets.values()),i=r.next();!i.done;i=r.next()){n+=i.value.values.length}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.values=function(){var t,e,n,r,i,o,l;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,7,8,9]),t=s(this.buckets.values()),e=t.next(),a.label=1;case 1:if(e.done)return[3,6];n=e.value,r=n.values.length-1,a.label=2;case 2:return r>=0?[4,n.values[r]]:[3,5];case 3:a.sent(),a.label=4;case 4:return r--,[3,2];case 5:return e=t.next(),[3,1];case 6:return[3,9];case 7:return i=a.sent(),o={error:i},[3,9];case 8:try{e&&!e.done&&(l=t.return)&&l.call(t)}finally{if(o)throw o.error}return[7];case 9:return[2]}}))},t}();function xH(t,e){var n=void 0!==e.defines?e.defines:null,r=void 0!==e.both?e.both+e.vert:e.vert,i=void 0!==e.both?e.both+e.frag:e.frag;return function(t,e,n,r){return void 0===r&&(r=null),{vert:e,frag:n,preprocessedVert:FW(t,"vert",e,r),preprocessedFrag:FW(t,"frag",n,r)}}(t.queryVendorInfo(),r,i,n)}function SH(t,e){return xV(""!==t.preprocessedVert&&""!==e.preprocessedVert),xV(""!==t.preprocessedFrag&&""!==e.preprocessedFrag),t.preprocessedVert===e.preprocessedVert&&t.preprocessedFrag===e.preprocessedFrag}function MH(t,e){return t=mH(t,e.blendMode),t=mH(t,e.blendSrcFactor),t=mH(t,e.blendDstFactor)}function AH(t,e){return t=MH(t,e.rgbBlendState),t=mH(t=MH(t,e.alphaBlendState),e.channelWriteMask)}function RH(t,e){for(var n,r,i,o,a,s,l,u,c=0;c<e.attachmentsState.length;c++)t=AH(t,e.attachmentsState[c]);return t=function(t,e){return mH(t,e.r<<24|e.g<<16|e.b<<8|e.a)}(t,e.blendConstant),t=mH(t,e.depthCompare),t=mH(t,e.depthWrite?1:0),t=mH(t,null===(n=e.stencilFront)||void 0===n?void 0:n.compare),t=mH(t,null===(r=e.stencilFront)||void 0===r?void 0:r.passOp),t=mH(t,null===(i=e.stencilFront)||void 0===i?void 0:i.failOp),t=mH(t,null===(o=e.stencilFront)||void 0===o?void 0:o.depthFailOp),t=mH(t,null===(a=e.stencilBack)||void 0===a?void 0:a.compare),t=mH(t,null===(s=e.stencilBack)||void 0===s?void 0:s.passOp),t=mH(t,null===(l=e.stencilBack)||void 0===l?void 0:l.failOp),t=mH(t,null===(u=e.stencilBack)||void 0===u?void 0:u.depthFailOp),t=mH(t,e.stencilWrite?1:0),t=mH(t,e.cullMode),t=mH(t,e.frontFace?1:0),t=mH(t,e.polygonOffset?1:0)}function TH(t){var e=0;e=mH(e,t.program.id),null!==t.inputLayout&&(e=mH(e,t.inputLayout.id)),e=RH(e,t.megaStateDescriptor);for(var n=0;n<t.colorAttachmentFormats.length;n++)e=mH(e,t.colorAttachmentFormats[n]||0);return yH(e=mH(e,t.depthStencilAttachmentFormat||0))}function wH(t){for(var e=0,n=0;n<t.samplerBindings.length;n++){null!==(r=t.samplerBindings[n])&&null!==r.texture&&(e=mH(e,r.texture.id))}for(n=0;n<t.uniformBufferBindings.length;n++){var r;null!==(r=t.uniformBufferBindings[n])&&null!==r.buffer&&(e=mH(e,r.buffer.id),e=mH(e,r.binding),e=mH(e,r.offset),e=mH(e,r.size))}return yH(e)}var PH,NH,CH=function(){function t(t){this.bindingsCache=new bH(nW,wH),this.renderPipelinesCache=new bH(lW,TH),this.inputLayoutsCache=new bH(hW,EH),this.programCache=new bH(SH,EH),this.samplerCache=new bH(dW,EH),this.device=t}return t.prototype.createBindings=function(t){var e=this.bindingsCache.get(t);if(null===e){var n=function(t){return{samplerBindings:t.samplerBindings&&QV(t.samplerBindings,fW),uniformBufferBindings:t.uniformBufferBindings&&QV(t.uniformBufferBindings,pW),storageBufferBindings:t.storageBufferBindings&&QV(t.storageBufferBindings,pW),storageTextureBindings:t.storageTextureBindings&&QV(t.storageTextureBindings,gW),pipeline:t.pipeline}}(t);n.uniformBufferBindings=n.uniformBufferBindings.filter((function(t){return t.size>0})),e=this.device.createBindings(n),this.bindingsCache.add(n,e)}return e},t.prototype.createRenderPipeline=function(t){var e=this.renderPipelinesCache.get(t);if(null===e){var n=function(t){var e=t.inputLayout,n=t.program,r=t.topology;return{inputLayout:e,megaStateDescriptor:t.megaStateDescriptor&&jV(t.megaStateDescriptor),program:n,topology:r,colorAttachmentFormats:t.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:t.depthStencilAttachmentFormat,sampleCount:t.sampleCount}}(t);n.colorAttachmentFormats=n.colorAttachmentFormats.filter((function(t){return t})),e=this.device.createRenderPipeline(n),this.renderPipelinesCache.add(n,e)}return e},t.prototype.createInputLayout=function(t){t.vertexBufferDescriptors=t.vertexBufferDescriptors.filter((function(t){return!!t}));var e=this.inputLayoutsCache.get(t);if(null===e){var n=function(t){return{vertexBufferDescriptors:QV(t.vertexBufferDescriptors,mW),indexBufferFormat:t.indexBufferFormat,program:t.program}}(t);e=this.device.createInputLayout(n),this.inputLayoutsCache.add(n,e)}return e},t.prototype.createProgramSimple=function(t){var e=t.vert,n=t.frag,r=t.preprocessedFrag,i=t.preprocessedVert,o=null;if(i&&r&&(o=this.programCache.get({vert:e,frag:n,preprocessedFrag:r,preprocessedVert:i})),null===o){var a=xH(this.device,t),s=a.preprocessedVert,l=a.preprocessedFrag;t.preprocessedVert=s,t.preprocessedFrag=l;var u=function(t){return{preprocessedVert:t.preprocessedVert,preprocessedFrag:t.preprocessedFrag,vert:t.vert,frag:t.frag}}(t);o=this.device.createProgramSimple({vertex:{glsl:s},fragment:{glsl:l}},e),this.programCache.add(u,o)}return o},t.prototype.createSampler=function(t){var e=this.samplerCache.get(t);return null===e&&(e=this.device.createSampler(t),this.samplerCache.add(t,e)),e},t.prototype.destroy=function(){var t,e,n,r,i,o,a,l,u,c;try{for(var h=s(this.bindingsCache.values()),d=h.next();!d.done;d=h.next()){d.value.destroy()}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}try{for(var f=s(this.renderPipelinesCache.values()),p=f.next();!p.done;p=f.next()){p.value.destroy()}}catch(t){n={error:t}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}try{for(var g=s(this.inputLayoutsCache.values()),v=g.next();!v.done;v=g.next()){v.value.destroy()}}catch(t){i={error:t}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}try{for(var m=s(this.programCache.values()),y=m.next();!y.done;y=m.next()){y.value.destroy()}}catch(t){a={error:t}}finally{try{y&&!y.done&&(l=m.return)&&l.call(m)}finally{if(a)throw a.error}}try{for(var E=s(this.samplerCache.values()),_=E.next();!_.done;_=E.next()){_.value.destroy()}}catch(t){u={error:t}}finally{try{_&&!_.done&&(c=E.return)&&c.call(E)}finally{if(u)throw u.error}}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()},t}();!function(t){t.NONE="none",t.LINEAR="LinearToneMapping",t.REINHARD="ReinhardToneMapping",t.CINEON="OptimizedCineonToneMapping",t.ACES_FILMIC="ACESFilmicToneMapping",t.CUSTOM="CustomToneMapping"}(PH||(PH={})),function(t){t[t.Color0=0]="Color0",t[t.Color1=1]="Color1",t[t.Color2=2]="Color2",t[t.Color3=3]="Color3",t[t.ColorMax=3]="ColorMax",t[t.DepthStencil=4]="DepthStencil"}(NH||(NH={}));var OH,IH,LH=function(){function t(){this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}return t.prototype.setDebugName=function(t){this.debugName=t},t.prototype.pushDebugThumbnail=function(t){this.debugThumbnails[t]=!0},t.prototype.setViewport=function(t,e,n,r){this.viewportX=t,this.viewportY=e,this.viewportW=n,this.viewportH=r},t.prototype.attachRenderTargetID=function(t,e,n){void 0===n&&(n=0),xV(void 0===this.renderTargetIDs[t]),this.renderTargetIDs[t]=e,this.renderTargetLevels[t]=n},t.prototype.attachResolveTexture=function(t){this.resolveTextureInputIDs.push(t)},t.prototype.attachOcclusionQueryPool=function(t){this.descriptor.occlusionQueryPool=t},t.prototype.exec=function(t){xV(null===this.execFunc),this.execFunc=t},t.prototype.post=function(t){xV(null===this.postFunc),this.postFunc=t},t.prototype.addExtraRef=function(t){this.renderTargetExtraRefs[t]=!0},t}(),DH=function(){function t(t,e){this.dimension=nV.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=rV.RENDER_TARGET,this.needsClear=!0,this.texture=null,this.age=0,this.format=e.format,this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount,xV(this.sampleCount>=1),this.sampleCount>1?this.attachment=t.createRenderTarget(this):(this.texture=t.createTexture(this),this.attachment=t.createRenderTargetFromTexture(this.texture))}return t.prototype.setDebugName=function(t,e){this.debugName=e,null!==this.texture&&t.setResourceName(this.texture,this.debugName),t.setResourceName(this.attachment,this.debugName)},t.prototype.matchesDescription=function(t){return this.format===t.format&&this.width===t.width&&this.height===t.height&&this.sampleCount===t.sampleCount},t.prototype.reset=function(t){xV(this.matchesDescription(t)),this.age=0},t.prototype.destroy=function(){this.attachment.destroy()},t}(),BH=function(){function t(t,e){this.dimension=nV.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.usage=rV.RENDER_TARGET,this.width=0,this.height=0,this.age=0,this.format=e.format,this.width=e.width,this.height=e.height,this.texture=t.createTexture(this)}return t.prototype.matchesDescription=function(t){return this.format===t.format&&this.width===t.width&&this.height===t.height},t.prototype.reset=function(t){xV(this.matchesDescription(t)),this.age=0},t.prototype.destroy=function(){this.texture.destroy()},t}(),kH=function(){this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},FH=function(){function t(t){this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=t}return t.prototype.acquireRenderTargetForDescription=function(t){for(var e=0;e<this.renderTargetDeadPool.length;e++){var n=this.renderTargetDeadPool[e];if(n.matchesDescription(t))return n.reset(t),this.renderTargetDeadPool.splice(e--,1),n}return new DH(this.device,t)},t.prototype.acquireSingleSampledTextureForDescription=function(t){for(var e=0;e<this.singleSampledTextureDeadPool.length;e++){var n=this.singleSampledTextureDeadPool[e];if(n.matchesDescription(t))return n.reset(t),this.singleSampledTextureDeadPool.splice(e--,1),n}return new BH(this.device,t)},t.prototype.beginGraphBuilder=function(){xV(null===this.currentGraph),this.currentGraph=new kH},t.prototype.pushPass=function(t){var e=new LH;t(e),this.currentGraph.passes.push(e)},t.prototype.createRenderTargetID=function(t,e){return this.currentGraph.renderTargetDebugNames.push(e),this.currentGraph.renderTargetDescriptions.push(t)-1},t.prototype.createResolveTextureID=function(t){return this.currentGraph.resolveTextureRenderTargetIDs.push(t)-1},t.prototype.findMostRecentPassThatAttachedRenderTarget=function(t){for(var e=this.currentGraph.passes.length-1;e>=0;e--){var n=this.currentGraph.passes[e];if(n.renderTargetIDs.includes(t))return n}return null},t.prototype.resolveRenderTargetPassAttachmentSlot=function(t,e){var n=t;if(void 0===n.resolveTextureOutputIDs[e]){var r=n.renderTargetIDs[e],i=this.createResolveTextureID(r);n.resolveTextureOutputIDs[e]=i}return n.resolveTextureOutputIDs[e]},t.prototype.findPassForResolveRenderTarget=function(t){var e=SV(this.findMostRecentPassThatAttachedRenderTarget(t)),n=e.renderTargetIDs.indexOf(t);return xV(void 0===e.resolveTextureOutputExternalTextures[n]),e},t.prototype.resolveRenderTarget=function(t){var e=this.findPassForResolveRenderTarget(t),n=e.renderTargetIDs.indexOf(t);return this.resolveRenderTargetPassAttachmentSlot(e,n)},t.prototype.resolveRenderTargetToExternalTexture=function(t,e,n){void 0===n&&(n=0);var r=this.findPassForResolveRenderTarget(t),i=r.renderTargetIDs.indexOf(t);xV(void 0===r.resolveTextureOutputIDs[i]),r.resolveTextureOutputExternalTextures[i]=e,r.resolveTextureOutputExternalTextureLevel[i]=n},t.prototype.getRenderTargetDescription=function(t){return SV(this.currentGraph.renderTargetDescriptions[t])},t.prototype.scheduleAddUseCount=function(t,e){for(var n=0;n<e.renderTargetIDs.length;n++){void 0!==(o=e.renderTargetIDs[n])&&(this.renderTargetOutputCount[o]++,e.renderTargetExtraRefs[n]&&this.renderTargetOutputCount[o]++)}for(var r=0;r<e.resolveTextureInputIDs.length;r++){var i=e.resolveTextureInputIDs[r];if(void 0!==i){this.resolveTextureUseCount[i]++;var o=t.resolveTextureRenderTargetIDs[i];this.renderTargetResolveCount[o]++}}},t.prototype.acquireRenderTargetForID=function(t,e){if(void 0===e)return null;if(xV(this.renderTargetOutputCount[e]>0),!this.renderTargetAliveForID[e]){var n=t.renderTargetDescriptions[e],r=this.acquireRenderTargetForDescription(n);r.setDebugName(this.device,t.renderTargetDebugNames[e]),this.renderTargetAliveForID[e]=r}return this.renderTargetAliveForID[e]},t.prototype.releaseRenderTargetForID=function(t,e){if(void 0===t)return null;var n=SV(this.renderTargetAliveForID[t]);return e?(xV(this.renderTargetOutputCount[t]>0),this.renderTargetOutputCount[t]--):(xV(this.renderTargetResolveCount[t]>0),this.renderTargetResolveCount[t]--),0===this.renderTargetOutputCount[t]&&0===this.renderTargetResolveCount[t]&&(n.needsClear=!0,delete this.renderTargetAliveForID[t],this.renderTargetDeadPool.push(n)),n},t.prototype.acquireResolveTextureInputTextureForID=function(t,e){var n=t.resolveTextureRenderTargetIDs[e];xV(this.resolveTextureUseCount[e]>0),this.resolveTextureUseCount[e]--;var r=SV(this.releaseRenderTargetForID(n,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[e]){var i=this.singleSampledTextureForResolveTextureID[e];return 0===this.resolveTextureUseCount[e]&&this.singleSampledTextureDeadPool.push(i),i.texture}return SV(r.texture)},t.prototype.determineResolveParam=function(t,e,n){var r=e.renderTargetIDs[n],i=e.resolveTextureOutputIDs[n],o=e.resolveTextureOutputExternalTextures[n],a=void 0!==i,s=void 0!==o;xV(!(a&&s));var l=null,u=!1,c=0;if(this.renderTargetOutputCount[r]>1&&(u=!0),a){xV(t.resolveTextureRenderTargetIDs[i]===r),xV(this.resolveTextureUseCount[i]>0),xV(this.renderTargetOutputCount[r]>0);var h=SV(this.renderTargetAliveForID[r]);if(null!==h.texture&&1===this.renderTargetOutputCount[r])l=null,u=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var d=SV(t.renderTargetDescriptions[r]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(d),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,h.debugName+" (Resolve ".concat(i,")"))}l=this.singleSampledTextureForResolveTextureID[i].texture}}else s?(l=o,c=e.resolveTextureOutputExternalTextureLevel[n]):l=null;return{resolveTo:l,store:u,level:c}},t.prototype.schedulePass=function(t,e){for(var n=e.renderTargetIDs[NH.DepthStencil],r=NH.Color0;r<=NH.ColorMax;r++){var i=e.renderTargetIDs[r],o=this.acquireRenderTargetForID(t,i);e.renderTargets[r]=o,e.descriptor.colorAttachment[r]=null!==o?o.attachment:null,e.descriptor.colorAttachmentLevel[r]=e.renderTargetLevels[r];var a=this.determineResolveParam(t,e,r),s=a.resolveTo,l=a.store,u=a.level;e.descriptor.colorResolveTo[r]=s,e.descriptor.colorResolveToLevel[r]=u,e.descriptor.colorStore[r]=l,e.descriptor.colorClearColor[r]=null!==o&&o.needsClear?t.renderTargetDescriptions[i].colorClearColor:"load"}var c=this.acquireRenderTargetForID(t,n);e.renderTargets[NH.DepthStencil]=c,e.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var h=this.determineResolveParam(t,e,NH.DepthStencil),d=h.resolveTo,f=h.store;e.descriptor.depthStencilResolveTo=d,e.descriptor.depthStencilStore=f,e.descriptor.depthClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].depthClearValue:"load",e.descriptor.stencilClearValue=null!==c&&c.needsClear?t.renderTargetDescriptions[n].stencilClearValue:"load";for(var p=0,g=0,v=0,m=0;m<e.renderTargets.length;m++){var y=e.renderTargets[m];if(y){var E=y.width>>>e.renderTargetLevels[m],_=y.height>>>e.renderTargetLevels[m];0===p&&(p=E,g=_,v=y.sampleCount),xV(E===p),xV(_===g),xV(y.sampleCount===v),y.needsClear=!1}}p>0&&g>0&&(e.viewportX*=p,e.viewportY*=g,e.viewportW*=p,e.viewportH*=g);for(m=0;m<e.resolveTextureInputIDs.length;m++){var b=e.resolveTextureInputIDs[m];e.resolveTextureInputTextures[m]=this.acquireResolveTextureInputTextureForID(t,b)}for(m=0;m<e.renderTargetIDs.length;m++)this.releaseRenderTargetForID(e.renderTargetIDs[m],!0);for(r=0;r<e.renderTargetExtraRefs.length;r++)e.renderTargetExtraRefs[r]&&this.releaseRenderTargetForID(e.renderTargetIDs[r],!0)},t.prototype.scheduleGraph=function(t){xV(0===this.renderTargetOutputCount.length),xV(0===this.renderTargetResolveCount.length),xV(0===this.resolveTextureUseCount.length);for(var e=0;e<this.renderTargetDeadPool.length;e++)this.renderTargetDeadPool[e].age++;for(e=0;e<this.singleSampledTextureDeadPool.length;e++)this.singleSampledTextureDeadPool[e].age++;LV(this.renderTargetOutputCount,t.renderTargetDescriptions.length,0),LV(this.renderTargetResolveCount,t.renderTargetDescriptions.length,0),LV(this.resolveTextureUseCount,t.resolveTextureRenderTargetIDs.length,0);for(e=0;e<t.passes.length;e++)this.scheduleAddUseCount(t,t.passes[e]);for(e=0;e<t.passes.length;e++)this.schedulePass(t,t.passes[e]);for(e=0;e<this.renderTargetOutputCount.length;e++)xV(0===this.renderTargetOutputCount[e]);for(e=0;e<this.renderTargetResolveCount.length;e++)xV(0===this.renderTargetResolveCount[e]);for(e=0;e<this.resolveTextureUseCount.length;e++)xV(0===this.resolveTextureUseCount[e]);for(e=0;e<this.renderTargetAliveForID.length;e++)xV(void 0===this.renderTargetAliveForID[e]);for(e=0;e<this.renderTargetDeadPool.length;e++)this.renderTargetDeadPool[e].age>=1&&(this.renderTargetDeadPool[e].destroy(),this.renderTargetDeadPool.splice(e--,1));for(e=0;e<this.singleSampledTextureDeadPool.length;e++)this.singleSampledTextureDeadPool[e].age>=1&&(this.singleSampledTextureDeadPool[e].destroy(),this.singleSampledTextureDeadPool.splice(e--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0},t.prototype.execPass=function(t){xV(null===this.currentPass),this.currentPass=t;var e=this.device.createRenderPass(t.descriptor);e.pushDebugGroup(t.debugName),e.setViewport(t.viewportX,t.viewportY,t.viewportW,t.viewportH),null!==t.execFunc&&t.execFunc(e,this),e.popDebugGroup(),this.device.submitPass(e),null!==t.postFunc&&t.postFunc(this),this.currentPass=null},t.prototype.execGraph=function(t){var e=this;this.scheduleGraph(t),this.device.beginFrame(),t.passes.forEach((function(t){e.execPass(t)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0},t.prototype.execute=function(){var t=SV(this.currentGraph);this.execGraph(t),this.currentGraph=null},t.prototype.getDebug=function(){return this},t.prototype.getPasses=function(){return this.currentGraph.passes},t.prototype.getPassDebugThumbnails=function(t){return t.debugThumbnails},t.prototype.getPassRenderTargetID=function(t,e){return t.renderTargetIDs[e]},t.prototype.getRenderTargetIDDebugName=function(t){return this.currentGraph.renderTargetDebugNames[t]},t.prototype.getResolveTextureForID=function(t){var e=this.currentPass,n=e.resolveTextureInputIDs.indexOf(t);return xV(n>=0),SV(e.resolveTextureInputTextures[n])},t.prototype.getRenderTargetAttachment=function(t){var e=this.currentPass.renderTargets[t];return e?e.attachment:null},t.prototype.getRenderTargetTexture=function(t){var e=this.currentPass.renderTargets[t];return e?e.texture:null},t.prototype.newGraphBuilder=function(){return this.beginGraphBuilder(),this},t.prototype.destroy=function(){for(var t=0;t<this.renderTargetAliveForID.length;t++)xV(void 0===this.renderTargetAliveForID[t]);for(t=0;t<this.singleSampledTextureForResolveTextureID.length;t++)xV(void 0===this.singleSampledTextureForResolveTextureID[t]);for(t=0;t<this.renderTargetDeadPool.length;t++)this.renderTargetDeadPool[t].destroy();for(t=0;t<this.singleSampledTextureDeadPool.length;t++)this.singleSampledTextureDeadPool[t].destroy()},t}();function UH(t,e,n,r,i,o){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),t[e+0]=n,t[e+1]=r,t[e+2]=i,t[e+3]=o,4}!function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.ALPHA_TEST=16]="ALPHA_TEST",t[t.OPAQUE=32]="OPAQUE",t[t.TRANSLUCENT=128]="TRANSLUCENT"}(OH||(OH={})),ft(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1),ft(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),function(t){t[t.None=0]="None",t[t.Indexed=1]="Indexed",t[t.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",t[t.Template=4]="Template",t[t.Draw=8]="Draw",t[t.InheritedFlags=3]="InheritedFlags"}(IH||(IH={}));var GH,zH=function(){function t(){this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=FV(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=FV(4,(function(){return 0})),this.flags=0,this.vertexBuffers=null,this.indexBuffer=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={inputLayout:null,megaStateDescriptor:jV(XV),program:null,topology:Zz.TRIANGLES,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return t.prototype.reset=function(){this.sortKey=0,this.flags=IH.AllowSkippingIfPipelineNotReady,this.vertexBuffers=null,this.indexBuffer=null,this.renderPipelineDescriptor.inputLayout=null},t.prototype.setFromTemplate=function(t){var e,n;WV(this.renderPipelineDescriptor.megaStateDescriptor,t.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=t.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=t.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=t.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,t.renderPipelineDescriptor.colorAttachmentFormats.length);for(var r=0;r<t.renderPipelineDescriptor.colorAttachmentFormats.length;r++)this.renderPipelineDescriptor.colorAttachmentFormats[r]=t.renderPipelineDescriptor.colorAttachmentFormats[r];this.renderPipelineDescriptor.depthStencilAttachmentFormat=t.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=t.renderPipelineDescriptor.sampleCount,this.uniformBuffer=t.uniformBuffer,this.uniforms=u([],l(t.uniforms),!1),this.drawCount=t.drawCount,this.drawStart=t.drawStart,this.drawInstanceCount=t.drawInstanceCount,this.vertexBuffers=t.vertexBuffers,this.indexBuffer=t.indexBuffer,this.flags=this.flags&~IH.InheritedFlags|t.flags&IH.InheritedFlags,this.sortKey=t.sortKey;var i=this.bindingDescriptors[0],o=t.bindingDescriptors[0];this.setBindingLayout({numSamplers:null===(e=o.samplerBindings)||void 0===e?void 0:e.length,numUniformBuffers:null===(n=o.uniformBufferBindings)||void 0===n?void 0:n.length});for(r=0;r<Math.min(i.uniformBufferBindings.length,o.uniformBufferBindings.length);r++)i.uniformBufferBindings[r].size=t.bindingDescriptors[0].uniformBufferBindings[r].size;this.setSamplerBindingsFromTextureMappings(o.samplerBindings);for(r=0;r<t.dynamicUniformBufferByteOffsets.length;r++)this.dynamicUniformBufferByteOffsets[r]=t.dynamicUniformBufferByteOffsets[r]},t.prototype.validate=function(){for(var t,e=0;e<this.bindingDescriptors.length;e++)for(var n=this.bindingDescriptors[e],r=0;r<(null===(t=n.uniformBufferBindings)||void 0===t?void 0:t.length);r++)xV(n.uniformBufferBindings[r].size>0);xV(this.drawCount>0)},t.prototype.setProgram=function(t){this.renderPipelineDescriptor.program=t},t.prototype.setMegaStateFlags=function(t){return WV(this.renderPipelineDescriptor.megaStateDescriptor,t),this.renderPipelineDescriptor.megaStateDescriptor},t.prototype.getMegaStateFlags=function(){return this.renderPipelineDescriptor.megaStateDescriptor},t.prototype.setVertexInput=function(t,e,n){this.vertexBuffers=e,this.indexBuffer=n,this.renderPipelineDescriptor.inputLayout=t},t.prototype.setBindingLayout=function(t){xV(t.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length);for(var e=this.bindingDescriptors[0].uniformBufferBindings.length;e<t.numUniformBuffers;e++)this.bindingDescriptors[0].uniformBufferBindings.push({binding:e,buffer:null,size:0});for(e=this.bindingDescriptors[0].samplerBindings.length;e<t.numSamplers;e++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null})},t.prototype.drawIndexes=function(t,e){void 0===e&&(e=0),this.flags=kV(this.flags,IH.Indexed,!0),this.drawCount=t,this.drawStart=e,this.drawInstanceCount=1},t.prototype.drawIndexesInstanced=function(t,e,n){void 0===n&&(n=0),this.flags=kV(this.flags,IH.Indexed,!0),this.drawCount=t,this.drawStart=n,this.drawInstanceCount=e},t.prototype.drawPrimitives=function(t,e){void 0===e&&(e=0),this.flags=kV(this.flags,IH.Indexed,!1),this.drawCount=t,this.drawStart=e,this.drawInstanceCount=1},t.prototype.setUniforms=function(t,e){if(0!==e.length){this.uniforms[t]=e;var n=0,r=[];e.forEach((function(t){var e=t.value;if(I(e)||Array.isArray(e)||e instanceof Float32Array){var i=I(e)?[e]:e,o=i.length>4?4:i.length,a=4-n%4;if(4!==a)if(a>=o);else{n+=a;for(var s=0;s<a;s++)r.push(0)}n+=i.length,r.push.apply(r,u([],l(i),!1))}}));var i=4-r.length%4;if(4!==i)for(var o=0;o<i;o++)r.push(0);for(var a=this.allocateUniformBuffer(t,r.length),s=this.mapUniformBufferF32(t),c=0;c<r.length;c+=4)a+=UH(s,a,r[c],r[c+1],r[c+2],r[c+3])}},t.prototype.setUniformBuffer=function(t){this.uniformBuffer=t},t.prototype.allocateUniformBuffer=function(t,e){var n;return xV((null===(n=this.bindingDescriptors[0].uniformBufferBindings)||void 0===n?void 0:n.length)<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[t]=this.uniformBuffer.allocateChunk(e)<<2,this.bindingDescriptors[0].uniformBufferBindings[t].size=e<<2,this.getUniformBufferOffset(t)},t.prototype.getUniformBufferOffset=function(t){return this.dynamicUniformBufferByteOffsets[t]>>>2},t.prototype.mapUniformBufferF32=function(t){return this.uniformBuffer.mapBufferF32()},t.prototype.getUniformBuffer=function(){return this.uniformBuffer},t.prototype.setSamplerBindingsFromTextureMappings=function(t){t=t.filter((function(t){return t}));for(var e=0;e<this.bindingDescriptors[0].samplerBindings.length;e++){var n=this.bindingDescriptors[0].samplerBindings[e],r=t[e];null!=r?(n.texture=r.texture,n.sampler=r.sampler):(n.texture=null,n.sampler=null)}},t.prototype.setAllowSkippingIfPipelineNotReady=function(t){this.flags=kV(this.flags,IH.AllowSkippingIfPipelineNotReady,t)},t.prototype.setAttachmentFormatsFromRenderPass=function(t,e){for(var n=t.queryRenderPass(e),r=-1,i=0;i<n.colorAttachment.length;i++){var o=null!==n.colorAttachment[i]?t.queryRenderTarget(n.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==o?o.format:null,null!==o&&(-1===r?r=o.sampleCount:xV(r===o.sampleCount))}var a=null!==n.depthStencilAttachment?t.queryRenderTarget(n.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==a?a.format:null,null!==a&&(-1===r?r=a.sampleCount:xV(r==a.sampleCount)),xV(r>0),this.renderPipelineDescriptor.sampleCount=r},t.prototype.drawOnPass=function(t,e){var n=this,i=t.device;this.setAttachmentFormatsFromRenderPass(i,e);var o=t.createRenderPipeline(this.renderPipelineDescriptor);if(!i.pipelineQueryReady(o)){if(this.flags&IH.AllowSkippingIfPipelineNotReady)return!1;i.pipelineForceReady(o)}e.setPipeline(o),e.setVertexInput(this.renderPipelineDescriptor.inputLayout,this.vertexBuffers,this.indexBuffer);for(var a=0;a<this.bindingDescriptors[0].uniformBufferBindings.length;a++)this.bindingDescriptors[0].uniformBufferBindings[a].buffer=SV(this.uniformBuffer.buffer),this.bindingDescriptors[0].uniformBufferBindings[a].offset=this.dynamicUniformBufferByteOffsets[a];this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(t){var e={};t.forEach((function(t){var n=t.name,r=t.value;e[n]=r})),n.renderPipelineDescriptor.program.setUniformsLegacy(e)}));var s=t.createBindings(r(r({},this.bindingDescriptors[0]),{pipeline:o}));return e.setBindings(s),this.flags&IH.Indexed?e.drawIndexed(this.drawCount,this.drawInstanceCount,this.drawStart,0,0):e.draw(this.drawCount,this.drawInstanceCount,this.drawStart,0),!0},t}();function VH(t,e){return t.sortKey-e.sortKey}!function(t){t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards"}(GH||(GH={}));var WH=function(){function t(t,e){void 0===t&&(t=VH),void 0===e&&(e=GH.Forwards),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=t,this.executionOrder=e}return t.prototype.checkUsePostSort=function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500},t.prototype.insertSorted=function(t){var e,n,r,i;null===this.compareFunction||this.usePostSort?this.renderInsts.push(t):(e=this.renderInsts,n=t,r=this.compareFunction,i=function(t,e,n){for(var r=0,i=t.length;r<i;){var o=r+(i-r>>>1);n(e,t[o])<0?i=o:r=o+1}return r}(e,n,r),e.splice(i,0,n)),this.checkUsePostSort()},t.prototype.submitRenderInst=function(t){t.flags|=IH.Draw,this.insertSorted(t)},t.prototype.ensureSorted=function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)},t.prototype.drawOnPassRendererNoReset=function(t,e){if(this.ensureSorted(),this.executionOrder===GH.Forwards)for(var n=0;n<this.renderInsts.length;n++)this.renderInsts[n].drawOnPass(t,e);else for(n=this.renderInsts.length-1;n>=0;n--)this.renderInsts[n].drawOnPass(t,e)},t.prototype.reset=function(){this.renderInsts.length=0},t.prototype.drawOnPassRenderer=function(t,e){this.drawOnPassRendererNoReset(t,e),this.reset()},t}(),jH=function(){function t(){this.pool=[],this.allocCount=0}return t.prototype.allocRenderInstIndex=function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new zH),this.allocCount-1},t.prototype.popRenderInst=function(){this.allocCount--},t.prototype.reset=function(){for(var t=0;t<this.pool.length;t++)this.pool[t].reset();this.allocCount=0},t.prototype.destroy=function(){this.pool.length=0,this.allocCount=0},t}(),HH=function(){function t(t){this.renderCache=t,this.instPool=new jH,this.templatePool=new jH,this.simpleRenderInstList=new WH,this.currentRenderInstList=this.simpleRenderInstList}return t.prototype.newRenderInst=function(){var t=this.templatePool.allocCount-1,e=this.instPool.allocRenderInstIndex(),n=this.instPool.pool[e];return n.debug=null,t>=0&&n.setFromTemplate(this.templatePool.pool[t]),n},t.prototype.submitRenderInst=function(t,e){void 0===e&&(e=this.currentRenderInstList),e.submitRenderInst(t)},t.prototype.setCurrentRenderInstList=function(t){xV(null===this.simpleRenderInstList),this.currentRenderInstList=t},t.prototype.pushTemplateRenderInst=function(){var t=this.templatePool.allocCount-1,e=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[e];return t>=0&&n.setFromTemplate(this.templatePool.pool[t]),n.flags|=IH.Template,n},t.prototype.popTemplateRenderInst=function(){this.templatePool.popRenderInst()},t.prototype.getTemplateRenderInst=function(){var t=this.templatePool.allocCount-1;return this.templatePool.pool[t]},t.prototype.resetRenderInsts=function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),xV(0===this.templatePool.allocCount)},t.prototype.destroy=function(){this.instPool.destroy(),this.renderCache.destroy()},t.prototype.disableSimpleMode=function(){this.simpleRenderInstList=null},t.prototype.drawOnPassRenderer=function(t){SV(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,t)},t.prototype.drawOnPassRendererNoReset=function(t){SV(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,t)},t}(),XH=function(){function t(t){this.parameters=t}return t.prototype.getDevice=function(){return this.device},t.prototype.setDevice=function(t){this.device=t,this.renderCache=new CH(t),this.renderGraph=new FH(this.device),this.renderInstManager=new HH(this.renderCache),this.uniformBuffer=new vH(this.device)},t.prototype.pushTemplateRenderInst=function(){var t=this.renderInstManager.pushTemplateRenderInst();return t.setUniformBuffer(this.uniformBuffer),t},t.prototype.prepareToRender=function(){this.uniformBuffer.prepareToRender()},t.prototype.destroy=function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()},t.prototype.getCache=function(){return this.renderCache},t.prototype.getDefines=function(){var t,e,n;return{USE_TONEMAPPING:(null===(t=this.parameters)||void 0===t?void 0:t.toneMapping)&&(null===(e=this.parameters)||void 0===e?void 0:e.toneMapping)!==PH.NONE,toneMapping:null===(n=this.parameters)||void 0===n?void 0:n.toneMapping}},t}(),YH=function(){function t(t){this.format=t,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load"}return t.prototype.setDimensions=function(t,e,n){this.width=t,this.height=e,this.sampleCount=n},t.prototype.copyDimensions=function(t){this.width=t.width,this.height=t.height,this.sampleCount=t.sampleCount},t}();function KH(t){return{colorClearColor:t,depthClearValue:1,stencilClearValue:0}}KH(TV(.88,.88,.88,1));var $H,qH=KH(NV);function ZH(t,e){var n=function(t){return t.antialiasingMode===$H.MSAAx4?4:1}(e);t.setDimensions(e.backbufferWidth,e.backbufferHeight,n)}function QH(t,e,n){var r=function(t){if(t===NH.Color0)return fV.U8_RGBA_RT;if(t===NH.DepthStencil)return fV.D24_S8;throw new Error("whoops")}(t),i=new YH(r);return ZH(i,e),null!==n&&(i.colorClearColor=n.colorClearColor,i.depthClearValue=n.depthClearValue,i.stencilClearValue=n.stencilClearValue),i}!function(t){t[t.None=0]="None",t[t.FXAA=1]="FXAA",t[t.MSAAx4=2]="MSAAx4"}($H||($H={}));var JH,tX=function(){function t(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}return t.prototype.reset=function(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0},t.prototype.copy=function(t){this.texture=t.texture,this.sampler=t.sampler,this.width=t.width,this.height=t.height,this.lodBias=t.lodBias},t}(),eX=function(t){function e(n){void 0===n&&(n={});var o=n.style,a=i(n,["style"]);return t.call(this,r({type:e.tag,style:r({intensity:Math.PI},o)},a))||this}return n(e,t),e.tag="light",e}(Cw);!function(t){t[t.NONE=0]="NONE",t[t.EXP=1]="EXP",t[t.EXP2=2]="EXP2",t[t.LINEAR=3]="LINEAR"}(JH||(JH={}));var nX,rX=function(t){function e(n){void 0===n&&(n={});var o=n.style,a=i(n,["style"]);return t.call(this,r({type:e.tag,style:r({type:JH.NONE,fill:"black",start:1,end:1e3,density:0},o)},a))||this}return n(e,t),e.tag="fog",e}(Cw);function iX(t,e,n,r){void 0===r&&(r=Jz.STATIC);var i=t.createBuffer({viewOrSize:n.byteLength,usage:e,hint:r});return i.setSubData(0,new Uint8Array(n)),i}!function(t){t.CHANGED="changed"}(nX||(nX={}));var oX,aX,sX=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.device=e,r.props=n,r.drawMode=Zz.TRIANGLES,r.vertexBuffers=[],r.vertices=[],r.inputLayoutDescriptor={vertexBufferDescriptors:[],indexBufferFormat:null,program:null},r.vertexCount=0,r.instancedCount=0,r.indexStart=0,r.primitiveStart=0,r.dirty=!0,r.meshes=[],r}return n(e,t),e.prototype.validate=function(t){return!0},e.prototype.build=function(t){},e.prototype.computeBoundingBox=function(){return new yM},e.prototype.setIndexBuffer=function(t){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=iX(this.device,Qz.INDEX,new Uint32Array(ArrayBuffer.isView(t)?t.buffer:t).buffer),this.indices=t,this.inputLayoutDescriptor.indexBufferFormat=fV.U32_R,this},e.prototype.setVertexBuffer=function(t){var e=this,n=t.bufferIndex,r=t.byteStride,i=t.stepMode,o=t.attributes,a=t.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={arrayStride:r,stepMode:i,attributes:[]},this.vertices[n]=a,o.forEach((function(t){var r=t.format,i=t.bufferByteOffset,o=t.location,a=t.divisor;t.byteStride;var s=e.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.find((function(t){return t.shaderLocation===o}));s?(s.format=r,s.offset=i,s.divisor=a):e.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.push({format:r,offset:i,shaderLocation:o,divisor:a})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var s=iX(this.device,Qz.VERTEX,a.buffer,Jz.DYNAMIC);return this.vertexBuffers[n]=s,this},e.prototype.getVertexBuffer=function(t){return this.vertexBuffers[t]},e.prototype.updateVertexBuffer=function(t,e,n,r){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[t];if(i){var o=i.arrayStride,a=this.inputLayoutDescriptor.vertexBufferDescriptors[t].attributes.find((function(t){return t.shaderLocation===e}));if(a){var s=n*o;this.getVertexBuffer(t).setSubData(a.offset+s,r)}this.emit(nX.CHANGED)}},e.prototype.updateIndices=function(t,e){return void 0===e&&(e=0),this.indexBuffer&&this.indexBuffer.setSubData(e,new Uint8Array(ArrayBuffer.isView(t)?t:new Uint32Array(t))),this},e.prototype.destroy=function(){this.vertexBuffers.forEach((function(t){t&&t.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0},e}($x),lX=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.features={},e.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",e.vert="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",e.frag="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",e}return n(e,t),e}(gH),uX=FV(1,(function(){return new tX}));var cX;!function(t){t.PROJECTION_MATRIX="u_ProjectionMatrix",t.VIEW_MATRIX="u_ViewMatrix",t.CAMERA_POSITION="u_CameraPosition",t.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",t.VIEWPORT="u_Viewport",t.IS_ORTHO="u_IsOrtho",t.IS_PICKING="u_IsPicking"}(cX||(cX={}));var hX,dX=function(){function t(t,e,n,r,i){this.renderHelper=t,this.lightPool=e,this.texturePool=n,this.batchManager=r,this.options=i,this.renderLists={leftEye:new WH,rightEye:new WH,picking:new WH},this.cameras=[]}return t.prototype.getDevice=function(){return this.device},t.prototype.getSwapChain=function(){return this.swapChain},t.prototype.getRenderLists=function(){return this.renderLists},t.prototype.apply=function(e){var n=this;this.context=e;var i=e.renderingService,s=e.renderingContext,c=e.config,h=s.root.ownerDocument.defaultView;c.disableRenderHooks=!0;var d=function(t){var e=t.target;e.nodeName!==eX.tag?e.nodeName!==rX.tag?(e.renderable3D||(e.renderable3D=new cH),n.batchManager.add(e)):n.lightPool.addFog(e):n.lightPool.addLight(e)},f=function(t){var e,r,i=t.target;if(i.nodeName!==eX.tag)if(i.nodeName!==rX.tag){if(i.nodeName===$S.MESH){var o;if(null===(e=i.style.geometry)||void 0===e?void 0:e.meshes)(o=i.style.geometry.meshes.indexOf(i))>-1&&i.style.geometry.meshes.splice(o,1);if(null===(r=i.style.material)||void 0===r?void 0:r.meshes)(o=i.style.material.meshes.indexOf(i))>-1&&i.style.material.meshes.splice(o,1)}n.swapChain&&n.batchManager.remove(i),delete i.renderable3D}else n.lightPool.removeFog(i);else n.lightPool.removeLight(i)},p=function(t){if(n.swapChain){var e=t.target,r=t.attrName,i=t.newValue;"zIndex"===r?e.parentNode.forEach((function(t){n.batchManager.changeRenderOrder(t,t.sortable.renderOrder)})):n.batchManager.updateAttribute(e,r,i)}},g=function(t){if(n.swapChain){var e=t.target;n.batchManager.updateAttribute(e,"modelMatrix",null)}};i.hooks.initAsync.tapPromise(t.tag,(function(){return o(n,void 0,void 0,(function(){var t,n,i,o,s,l=this;return a(this,(function(a){switch(a.label){case 0:return h.addEventListener(nw.MOUNTED,d),h.addEventListener(nw.UNMOUNTED,f),h.addEventListener(nw.ATTR_MODIFIED,p),h.addEventListener(nw.BOUNDS_CHANGED,g),this.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,t=this.context.contextService.getDomElement(),n=this.context.config,i=n.width,o=n.height,this.context.contextService.resize(i,o),s=this,[4,this.context.deviceContribution.createSwapChain(t)];case 1:return s.swapChain=a.sent(),this.device=this.swapChain.getDevice(),this.renderHelper.setDevice(this.device),this.renderHelper.renderInstManager.disableSimpleMode(),this.swapChain.configureSwapChain(t.width,t.height),h.addEventListener(Mw.RESIZE,(function(){l.swapChain.configureSwapChain(t.width,t.height)})),this.batchManager.attach(r({device:this.device},e)),[2]}}))}))})),i.hooks.destroy.tap(t.tag,(function(){n.renderHelper.destroy(),n.batchManager.destroy(),n.texturePool.destroy(),h.removeEventListener(nw.MOUNTED,d),h.removeEventListener(nw.UNMOUNTED,f),h.removeEventListener(nw.ATTR_MODIFIED,p),h.removeEventListener(nw.BOUNDS_CHANGED,g),n.device.destroy(),n.device.checkForLeaks(),c.disableRenderHooks=!1})),i.hooks.beginFrame.tap(t.tag,(function(t){var e,r=null==t?void 0:t.session,i=n.context.config,o=i.width,a=i.height;if(r){var s=r.renderState.baseLayer;s||(s=r.renderState.layers[0]),n.swapChain.configureSwapChain(s.framebufferWidth,s.framebufferHeight,s.framebuffer);var c=r.referenceSpace,h=t.getViewerPose(c);h&&h.views.forEach((function(t,e){var i=r.renderState.baseLayer.getViewport(t),c=ft.apply(Ht,u([],l(t.transform.matrix),!1));c[12]*=o,c[13]*=a,c[14]*=500,c[12]+=o/2,c[13]-=a/2,c[14]+=250;var h=ft.apply(Ht,u([],l(t.projectionMatrix),!1)),d=mt(ct(),c);bt(d,d,$t(1,-1,1));var f=t.transform.position,p=f.x,g=f.y,v=f.z;n.cameras[e]={viewport:{x:i.x/s.framebufferWidth,y:i.y/s.framebufferHeight,width:i.width/s.framebufferWidth,height:i.height/s.framebufferHeight},projectionMatrix:h,viewMatrix:d,cameraPosition:[p,g,v],isOrtho:!1}}))}else{var d=n.context.camera;n.cameras=[{viewport:{x:0,y:0,width:1,height:1},projectionMatrix:d.getPerspective(),viewMatrix:d.getViewTransform(),cameraPosition:d.getPosition(),isOrtho:d.isOrtho()}]}var f,p=n.swapChain.getCanvas(),g=n.renderHelper.renderInstManager;if(n.builder=n.renderHelper.renderGraph.newGraphBuilder(),"transparent"===n.context.config.background)f=wV;else{var v=PA(n.context.config.background);f=n.context.config.background?TV(Number(v.r)/255*Number(v.alpha),Number(v.g)/255*Number(v.alpha),Number(v.b)/255*Number(v.alpha),Number(v.alpha)):PV}var m={backbufferWidth:p.width,backbufferHeight:p.height,antialiasingMode:$H.None},y=QH(NH.Color0,m,KH(f)),E=QH(NH.DepthStencil,m,qH),_=n.builder.createRenderTargetID(y,"Main Color"),b=n.builder.createRenderTargetID(E,"Main Depth");n.builder.pushPass((function(t){t.setDebugName("Main Render Pass"),t.attachRenderTargetID(NH.Color0,_),t.attachRenderTargetID(NH.DepthStencil,b),t.exec((function(t,e){n.cameras.forEach((function(r,i){var o=r.viewport,a=o.x,s=o.y,l=o.width,u=o.height,c=e.currentPass,h=c.viewportW,d=c.viewportH;t.setViewport(a*h,s*d,l*h,u*d),(0===i?n.renderLists.leftEye:n.renderLists.rightEye).drawOnPassRenderer(g.renderCache,t)}))}))})),(null===(e=n.options)||void 0===e?void 0:e.enableFXAA)&&function(t,e,n,r){t.pushPass((function(i){i.setDebugName("FXAA"),i.attachRenderTargetID(NH.Color0,r);var o=t.resolveRenderTarget(r);i.attachResolveTexture(o);var a=e.renderInstManager.newRenderInst();a.setUniformBuffer(e.uniformBuffer),a.setAllowSkippingIfPipelineNotReady(!1),a.setMegaStateFlags(YV),a.setBindingLayout({numUniformBuffers:1,numSamplers:1}),a.drawPrimitives(3);var s=a.allocateUniformBuffer(0,4);UH(a.mapUniformBufferF32(0),s,1/n.backbufferWidth,1/n.backbufferHeight);var l=new lX,u=e.renderCache.createProgramSimple(l);a.setProgram(u),oX||((oX=new sX(e.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([1,3,-3,-1,1,-1])}),oX.vertexCount=3,aX=e.getCache().createInputLayout(oX.inputLayoutDescriptor)),i.exec((function(t,n){uX[0].texture=n.getResolveTextureForID(o),a.setSamplerBindingsFromTextureMappings(uX),a.setVertexInput(aX,oX.vertexBuffers.map((function(t){return{buffer:t,byteOffset:0}})),null),a.drawOnPass(e.renderCache,t)}))}))}(n.builder,n.renderHelper,m,_),n.builder.resolveRenderTargetToExternalTexture(_,n.swapChain.getOnscreenTexture())})),i.hooks.endFrame.tap(t.tag,(function(t){var e=n.renderHelper.renderInstManager,r=n.context.config,i=r.width,o=r.height;if(n.cameras.forEach((function(t,r){var a=t.viewport,s=t.cameraPosition,l=t.viewMatrix,u=t.projectionMatrix,c=t.isOrtho,h=a.width,d=a.height,f=n.renderHelper.pushTemplateRenderInst();f.setBindingLayout({numUniformBuffers:2,numSamplers:0}),f.setMegaStateFlags(KV({depthWrite:!0,blendConstant:wV},{rgbBlendMode:Yz.ADD,alphaBlendMode:Yz.ADD,rgbBlendSrcFactor:Xz.SRC_ALPHA,alphaBlendSrcFactor:Xz.ONE,rgbBlendDstFactor:Xz.ONE_MINUS_SRC_ALPHA,alphaBlendDstFactor:Xz.ONE_MINUS_SRC_ALPHA})),f.setUniforms(0,[{name:cX.PROJECTION_MATRIX,value:u},{name:cX.VIEW_MATRIX,value:l},{name:cX.CAMERA_POSITION,value:s},{name:cX.DEVICE_PIXEL_RATIO,value:n.context.contextService.getDPR()},{name:cX.VIEWPORT,value:[i*h,o*d]},{name:cX.IS_ORTHO,value:c?1:0},{name:cX.IS_PICKING,value:0}]),n.batchManager.render(0===r?n.renderLists.leftEye:n.renderLists.rightEye),e.popTemplateRenderInst()})),n.renderHelper.prepareToRender(),n.renderHelper.renderGraph.execute(),e.resetRenderInsts(),n.enableCapture&&n.resolveCapturePromise){var a=n.captureOptions,s=a.type,l=a.encoderOptions,u=n.context.contextService.getDomElement().toDataURL(s,l);n.resolveCapturePromise(u),n.enableCapture=!1,n.captureOptions=void 0,n.resolveCapturePromise=void 0}}))},t.prototype.loadTexture=function(t,e,n){return this.texturePool.getOrCreateTexture(this.device,t,e,(function(t){n&&n(t)}))},t.prototype.toDataURL=function(t){return o(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){return this.enableCapture=!0,this.captureOptions=t,this.capturePromise=new Promise((function(t){e.resolveCapturePromise=function(e){t(e)}})),[2,this.capturePromise]}))}))},t.tag="RenderGraph",t}(),fX=function(){function t(t,e,n,r){this.renderHelper=t,this.renderGraphPlugin=e,this.pickingIdGenerator=n,this.batchManager=r}return t.prototype.apply=function(e){var n=this;this.context=e;var r=e.renderingService,i=e.renderingContext.root.ownerDocument.defaultView,s=function(t){var e=t.target;e.renderable3D||(e.renderable3D=new cH);var r=e.renderable3D,i=n.pickingIdGenerator.getId(e);r.pickingId=i,r.encodedPickingColor=n.pickingIdGenerator.encodePickingColor(i)},l=function(t){var e=t.target.renderable3D;e&&n.pickingIdGenerator.deleteById(e.pickingId)};r.hooks.init.tap(t.tag,(function(){i.addEventListener(nw.MOUNTED,s),i.addEventListener(nw.UNMOUNTED,l)})),r.hooks.destroy.tap(t.tag,(function(){i.removeEventListener(nw.MOUNTED,s),i.removeEventListener(nw.UNMOUNTED,l),n.pickingIdGenerator.reset()})),r.hooks.pickSync.tap(t.tag,(function(t){return n.pick(t)})),r.hooks.pick.tapPromise(t.tag,(function(t){return o(n,void 0,void 0,(function(){return a(this,(function(e){return[2,this.pick(t)]}))}))}))},t.prototype.pick=function(t){var e=t.topmost,n=t.position,r=n.viewportX,i=n.viewportY,o=this.context.contextService.getDPR(),a=this.context.config.width*o,s=this.context.config.height*o,l=r*o,u=i*o;if(!this.renderHelper.renderGraph||l>a||l<0||u>s||u<0)return t.picked=[],t;var c=this.pickByRectangleInDepth(new AM(O(Math.round(l),0,a-1),O(Math.round(u),0,s-1),1,1),e?1:100);return t.picked=c,t},t.prototype.pickByRectangleInDepth=function(t,e){void 0===e&&(e=100);var n=null,r=1,i=[];do{if(!(n=this.pickByRectangle(t,n)))break;r++,i.push(n)}while(n&&r<=e);return e>1&&this.restorePickingColor(i),i},t.prototype.restorePickingColor=function(t){var e=this;t.forEach((function(t){e.batchManager.updateAttribute(t,"pointerEvents",!0,!0)}))},t.prototype.pickByRectangle=function(t,e){var n,i=this,o=this.renderGraphPlugin.getDevice(),a=this.renderGraphPlugin.getRenderLists(),s=this.renderHelper.renderInstManager,l=this.renderHelper.renderGraph.newGraphBuilder(),u=wV,c=this.context.camera,h=t.x,d=t.y,f=t.width,p=t.height,g={backbufferWidth:f,backbufferHeight:p,antialiasingMode:$H.None},v=QH(NH.Color0,g,KH(u)),m=l.createRenderTargetID(v,"Picking Color"),y=QH(NH.DepthStencil,g,qH),E=l.createRenderTargetID(y,"Picking Depth"),_=r({},c.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(t){t.age=-1})),l.pushPass((function(t){t.setDebugName("Picking Pass"),t.attachRenderTargetID(NH.Color0,m),t.attachRenderTargetID(NH.DepthStencil,E),t.exec((function(t){a.picking.drawOnPassRenderer(s.renderCache,t)})),t.post((function(t){var e,r=t.getRenderTargetTexture(NH.Color0),a=o.createReadback();_&&_.enabled?c.setViewOffset(_.fullWidth,_.fullHeight,_.offsetX,_.offsetY,_.width,_.height):c.clearViewOffset(),c.setEnableUpdate(!0);try{e=a.readTextureSync(r,0,0,f,p,new Uint8Array(f*p*4))}catch(t){}var s=-1;if(!e||0===e[0]&&0===e[1]&&0===e[2]||(s=i.pickingIdGenerator.decodePickingColor(e)),s>-1){var l=i.pickingIdGenerator.getById(s);l&&l.isVisible()&&l.isInteractive()&&(n=l)}a.destroy()}))}));var b=this.renderHelper.pushTemplateRenderInst();b.setBindingLayout({numUniformBuffers:2,numSamplers:0}),b.setMegaStateFlags(KV({depthWrite:!0},{rgbBlendMode:Yz.ADD,rgbBlendSrcFactor:Xz.ONE,rgbBlendDstFactor:Xz.ZERO,alphaBlendMode:Yz.ADD,alphaBlendSrcFactor:Xz.ONE,alphaBlendDstFactor:Xz.ZERO}));var x=this.context.config,S=x.width,M=x.height,A=this.context.contextService.getDPR();return c.setEnableUpdate(!1),c.setViewOffset(S*A,M*A,h,d,f,p),b.setUniforms(0,[{name:cX.PROJECTION_MATRIX,value:c.getPerspective()},{name:cX.VIEW_MATRIX,value:c.getViewTransform()},{name:cX.CAMERA_POSITION,value:c.getPosition()},{name:cX.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:cX.VIEWPORT,value:[f,p]},{name:cX.IS_ORTHO,value:c.isOrtho()?1:0},{name:cX.IS_PICKING,value:1}]),e&&this.batchManager.updateAttribute(e,"pointerEvents",!1,!0),this.batchManager.render(a.picking,!0),s.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),s.resetRenderInsts(),n},t.tag="WebGLPicker",t}(),pX=5e-4,gX=function(){function t(){this.clipPathMeshCreated=!1}return t.prototype.beforeUploadUBO=function(t,e){},t.prototype.beforeInitMesh=function(t){},t.prototype.afterInitMesh=function(t){},t}();!function(t){t.CHANGED="changed"}(hX||(hX={}));var vX=function(t){function e(e,n){var i=t.call(this)||this;i.props={},i.meshes=[],i.defines={},i.uniforms={},i.uboBuffer=[],i.textures={},i.samplers=[],i.programDirty=!0,i.textureDirty=!0,i.geometryDirty=!0;var o=jV(XV),a=o.cullMode,s=o.depthCompare,l=o.depthWrite,u=o.stencilFront,c=o.stencilBack,h=o.stencilWrite,d=o.frontFace,f=o.polygonOffset,p=o.attachmentsState;return i.device=e,i.props=r({cullMode:a,depthTest:!0,depthCompare:s,depthWrite:l,stencilFront:u,stencilBack:c,stencilWrite:h,frontFace:d,polygonOffset:f,attachmentsState:p,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},n),i.compile(),i}return n(e,t),Object.defineProperty(e.prototype,"cullMode",{get:function(){return this.props.cullMode},set:function(t){this.props.cullMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this.props.frontFace},set:function(t){this.props.frontFace=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendConstant",{get:function(){return this.props.blendConstant},set:function(t){this.props.blendConstant=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendEquation",{get:function(){return this.props.blendEquation},set:function(t){this.props.blendEquation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendEquationAlpha",{get:function(){return this.props.blendEquationAlpha},set:function(t){this.props.blendEquationAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendSrc",{get:function(){return this.props.blendSrc},set:function(t){this.props.blendSrc=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendDst",{get:function(){return this.props.blendDst},set:function(t){this.props.blendDst=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendSrcAlpha",{get:function(){return this.props.blendSrcAlpha},set:function(t){this.props.blendSrcAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendDstAlpha",{get:function(){return this.props.blendDstAlpha},set:function(t){this.props.blendDstAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthCompare",{get:function(){return this.props.depthCompare},set:function(t){this.props.depthCompare=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this.props.depthTest},set:function(t){this.props.depthTest=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthWrite",{get:function(){return this.props.depthWrite},set:function(t){this.props.depthWrite=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFront",{get:function(){return this.props.stencilFront},set:function(t){this.props.stencilFront=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilBack",{get:function(){return this.props.stencilBack},set:function(t){this.props.stencilBack=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilWrite",{get:function(){return this.props.stencilWrite},set:function(t){this.props.stencilWrite=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilRef",{get:function(){return this.props.stencilRef},set:function(t){this.props.stencilRef=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffset",{get:function(){return this.props.polygonOffset},set:function(t){this.props.polygonOffset=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dithering",{get:function(){return this.props.dithering},set:function(t){this.props.dithering=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){return this.props.wireframe},set:function(t){this.props.wireframe!==t&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=t,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframeColor",{get:function(){return this.props.wireframeColor},set:function(t){this.props.wireframeColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframeLineWidth",{get:function(){return this.props.wireframeLineWidth},set:function(t){this.props.wireframeLineWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexShader",{get:function(){return this.props.vertexShader},set:function(t){this.props.vertexShader!==t&&(this.programDirty=!0,this.props.vertexShader=t,this.compile())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentShader",{get:function(){return this.props.fragmentShader},set:function(t){this.props.fragmentShader!==t&&(this.programDirty=!0,this.props.fragmentShader=t,this.compile())},enumerable:!1,configurable:!0}),e.prototype.compile=function(){var t=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(e,n){return t.samplers.push(n),""})),this.uniformNames=function(t){var e=[],n=[];return t.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(t,e,r){var i=[];return r.trim().replace("\r\n","\n").split("\n").forEach((function(t){var e=l(t.trim().split(/\s+/),2),n=e[0],r=e[1];i.push({type:n.trim(),name:r.replace(";","").trim()})})),n.push({type:e.trim(),uniforms:i}),""})),t.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,(function(t,r){return r.trim().replace("\r\n","\n").split("\n").forEach((function(t){var r=t.trim().split(" "),i=r[0]||"",o=r[1]||"",a=o.indexOf("[")>-1;if(o=o.replace(";","").replace("[","").trim(),!i.startsWith("#")){if(i){var s=n.find((function(t){return i===t.type}));if(s)if(a)for(var l=function(t){s.uniforms.forEach((function(n){e.push("".concat(o,"[").concat(t,"].").concat(n.name))}))},u=0;u<5;u++)l(u);else s.uniforms.forEach((function(t){e.push("".concat(o,".").concat(t.name))}))}o&&e.push(o)}})),""})),e}(this.props.fragmentShader)},e.prototype.setUniforms=function(t){var e=this,n=!1;Object.keys(t).forEach((function(r){var i,o=t[r],a=e.textures[r];a&&a!==o&&(e.textureDirty=!0),(i=o)&&i.type?(e.textures[r]=o,e.textureDirty=!0,o.on(eV.LOADED,(function(){e.dispatchMutationEvent()}))):(e.uniforms[r]=o,n=!0),_(t[r])&&(delete e.textures[r],delete e.uniforms[r])})),n&&this.dispatchMutationEvent()},e.prototype.dispatchMutationEvent=function(){this.emit(hX.CHANGED)},e}($x),mX=function(t){function e(e,n){var i=t.call(this,e,r({},n))||this;return i.defines=r(r({},i.defines),{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),i}return n(e,t),e}(vX);function yX(t){var e={};return Object.keys(t).forEach((function(n){"number"==typeof t[n]&&(e[n]=t[n])})),e}var EX=function(t){return Object.fromEntries(Object.entries(t).filter((function(t){var e=l(t,2);return e[0],void 0!==e[1]})))};function _X(t,e){return 256*(t=O(Math.floor(t),0,255))+(e=O(Math.floor(e),0,255))}var bX,xX,SX=1,MX="FillTextureMapping";!function(t){t[t.MODEL_MATRIX=0]="MODEL_MATRIX",t[t.PACKED_COLOR=1]="PACKED_COLOR",t[t.PACKED_STYLE=2]="PACKED_STYLE",t[t.PICKING_COLOR=3]="PICKING_COLOR",t[t.POSITION=4]="POSITION",t[t.NORMAL=5]="NORMAL",t[t.UV=6]="UV",t[t.BARYCENTRIC=7]="BARYCENTRIC",t[t.MAX=8]="MAX"}(bX||(bX={})),function(t){t[t.MODEL_MATRIX0=0]="MODEL_MATRIX0",t[t.MODEL_MATRIX1=1]="MODEL_MATRIX1",t[t.MODEL_MATRIX2=2]="MODEL_MATRIX2",t[t.MODEL_MATRIX3=3]="MODEL_MATRIX3",t[t.PACKED_COLOR=4]="PACKED_COLOR",t[t.PACKED_STYLE1=5]="PACKED_STYLE1",t[t.PACKED_STYLE2=6]="PACKED_STYLE2",t[t.PICKING_COLOR=7]="PICKING_COLOR",t[t.POSITION=8]="POSITION",t[t.NORMAL=9]="NORMAL",t[t.UV=10]="UV",t[t.BARYCENTRIC=11]="BARYCENTRIC",t[t.MAX=12]="MAX"}(xX||(xX={}));var AX,RX,TX=function(){function t(t,e,n,r,i,o,a){void 0===o&&(o=-1),this.renderHelper=t,this.texturePool=e,this.lightPool=n,this.drawcallCtors=i,this.index=o,this.context=a,this.id=SX++,this.gradientAttributeName="fill",this.objects=[],this.program=new gH,this.geometryDirty=!0,this.materialDirty=!0,this.textureMappings=[],this.divisor=1,this.mergeXYZIntoModelMatrix=!1,this.checkNodeName=!0,this.maxInstances=1/0,this.inited=!1}return Object.defineProperty(t.prototype,"instance",{get:function(){return this.objects[0]},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.inited||(this.renderer.beforeInitMesh(this),this.material=new mX(this.context.device),this.material.defines=r(r({},yX(xX)),this.material.defines),this.geometry=new sX(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))},t.prototype.observeGeometryChanged=function(){var t=this;this.geometry.on(nX.CHANGED,(function(){t.geometry.meshes.forEach((function(t){t.renderable.dirty=!0})),t.context.renderingService.dirtify()}))},t.prototype.observeMaterialChanged=function(){var t=this;this.material.on(hX.CHANGED,(function(){t.material.meshes.forEach((function(t){t.renderable.dirty=!0})),t.context.renderingService.dirtify()}))},t.prototype.shouldMergeColor=function(t,e,n){var r=t.parsedStyle[n],i=e.parsedStyle[n];return!r&&!i||(!(!wA(r)||!wA(i))||(!(!TA(r)||!TA(i)||r.image!==i.image)||!(!Array.isArray(r)||!Array.isArray(i)||t.style[n]!==e.style[n])))},t.prototype.shouldMerge=function(t,e){return!this.instance||(!this.checkNodeName||this.instance.nodeName===t.nodeName)&&(!t.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,t,"fill")||!this.shouldMergeColor(this.instance,t,"stroke")))},t.prototype.createGeometry=function(t){var e,n,r=this,i=ct(),o=ct(),a=[],s=[],c=[],h=[],d=this.divisor,f=(null===(e=t[0])||void 0===e?void 0:e.nodeName)===$S.CIRCLE||(null===(n=t[0])||void 0===n?void 0:n.nodeName)===$S.ELLIPSE?.5:0;t.forEach((function(t){var e,n=t.parsedStyle,d=n.fill,p=n.stroke,g=n.opacity,v=void 0===g?1:g,m=n.fillOpacity,y=void 0===m?1:m,E=n.strokeOpacity,_=void 0===E?1:E,b=n.lineWidth,x=void 0===b?1:b,S=n.visibility,M=n.increasedLineWidthForHitTesting,A=void 0===M?0:M,R=[0,0,0,0];wA(d)&&(R=[Number(d.r),Number(d.g),Number(d.b),255*Number(d.alpha)]);var T=[0,0,0,0];wA(p)&&(T=[Number(p.r),Number(p.g),Number(p.b),255*Number(p.alpha)]),Wt(o,r.context.camera.getViewTransform(),i);var w=t.isInteractive()&&(null===(e=t.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0];if(r.mergeXYZIntoModelMatrix){var P=t.parsedStyle,N=P.x,C=P.y,O=P.z;Wt(i,t.getWorldTransform(),Mt(i,$t(N,C,O)))}else dt(i,t.getWorldTransform());a.push.apply(a,u([],l(i),!1)),s.push(_X(R[0],R[1]),_X(R[2],R[3]),_X(T[0],T[1]),_X(T[2],T[3])),c.push(v,y,_,x,"hidden"!==S?1:0,f,f,A),h.push.apply(h,u(u([],l(w),!1),[t.sortable.renderOrder*pX],!1))})),this.geometry.instancedCount=t.length,this.geometry.setVertexBuffer({bufferIndex:bX.MODEL_MATRIX,byteStride:64,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:xX.MODEL_MATRIX0,divisor:d},{format:fV.F32_RGBA,bufferByteOffset:16,location:xX.MODEL_MATRIX1,divisor:d},{format:fV.F32_RGBA,bufferByteOffset:32,location:xX.MODEL_MATRIX2,divisor:d},{format:fV.F32_RGBA,bufferByteOffset:48,location:xX.MODEL_MATRIX3,divisor:d}],data:new Float32Array(a)}),this.geometry.setVertexBuffer({bufferIndex:bX.PACKED_COLOR,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:xX.PACKED_COLOR,divisor:d}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:bX.PACKED_STYLE,byteStride:32,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:xX.PACKED_STYLE1,divisor:d},{format:fV.F32_RGBA,bufferByteOffset:16,location:xX.PACKED_STYLE2,divisor:d}],data:new Float32Array(c)}),this.geometry.setVertexBuffer({bufferIndex:bX.PICKING_COLOR,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:xX.PICKING_COLOR,divisor:d}],data:new Float32Array(h)})},t.prototype.destroy=function(){this.geometry&&this.geometry.destroy()},t.prototype.applyRenderInst=function(t,e){var n=this,i=!!this.lightPool.getFog();this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilFront={compare:Wz.ALWAYS,passOp:oV.REPLACE},this.material.stencilBack={compare:Wz.ALWAYS,passOp:oV.REPLACE}):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilFront={compare:Wz.EQUAL,passOp:oV.KEEP},this.material.stencilBack={compare:Wz.EQUAL,passOp:oV.KEEP}):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(e);var o,a,s,l,u=r({},this.material.defines);if(this.material.defines.USE_FOG=i,this.material.defines=r(r(r({},this.lightPool.getDefines()),this.material.defines),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var c=this.createFillGradientTextureMapping(e);c&&this.textureMappings.push(c),Object.keys(this.material.textures).sort((function(t,e){return n.material.samplers.indexOf(t)-n.material.samplers.indexOf(e)})).forEach((function(t){var e=new tX;e.name=t,e.texture=n.material.textures[t],n.context.device.setResourceName(e.texture,"Material Texture "+t),e.sampler=n.renderHelper.getCache().createSampler({addressModeU:Kz.CLAMP_TO_EDGE,addressModeV:Kz.CLAMP_TO_EDGE,minFilter:$z.POINT,magFilter:$z.BILINEAR,mipmapFilter:qz.LINEAR,lodMinClamp:0,lodMaxClamp:0}),n.textureMappings.push(e)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}((o=u,a=this.material.defines,s=Object.keys(o),l=Object.keys(a),!(s.length===l.length&&s.every((function(t){return o[t]===a[t]}))))||this.material.programDirty||this.materialDirty)&&(this.material.defines=r(r({},this.material.defines),yX(xX)),Object.keys(this.material.defines).forEach((function(t){var e=n.material.defines[t];"boolean"==typeof e?n.program.setDefineBool(t,e):n.program.setDefineString(t,"".concat(e))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(e),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1);var h=this.renderHelper.getCache().createProgramSimple(this.program),d=this.renderHelper.getCache().createInputLayout(r(r({},this.geometry.inputLayoutDescriptor),{program:h})),f=!!this.geometry.indexBuffer;t.renderPipelineDescriptor.topology=this.geometry.drawMode,t.setProgram(h),t.setVertexInput(d,this.geometry.vertexBuffers.filter((function(t){return!!t})).map((function(t){return{buffer:t,byteOffset:0}})),f?{buffer:this.geometry.indexBuffer,offset:0}:null),this.renderer.beforeUploadUBO(t,this),this.uploadUBO(t),f?t.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):t.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),t.sortKey=function(t,e){return function(t,e){return(16777215&t|(255&e)<<24)>>>0}(function(t,e){return(4278190335&0|(65535&e)<<8)>>>0}(0,e),t)}(OH.OPAQUE,e[0].sortable.renderOrder)},t.prototype.updateBatchedAttribute=function(t,e,n,r){var i,o,a=this;if(0!==t.length){if("fill"===n||"stroke"===n){var s=[];t.forEach((function(t){var e=t.parsedStyle,n=e.fill,r=e.stroke,i=[0,0,0,0];wA(n)&&(i=[Number(n.r),Number(n.g),Number(n.b),255*Number(n.alpha)]);var o=[0,0,0,0];wA(r)&&(o=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]),s.push(_X(i[0],i[1]),_X(i[2],i[3]),_X(o[0],o[1]),_X(o[2],o[3]))})),this.geometry.updateVertexBuffer(bX.PACKED_COLOR,xX.PACKED_COLOR,e,new Uint8Array(new Float32Array(s).buffer));var c=this.instance.parsedStyle.fill,h=this.textureMappings.findIndex((function(t){return t.name===MX}));if(wA(c))h>=0&&(this.textureMappings.splice(h,-1),this.material.textureDirty=!0);else{var d=this.createFillGradientTextureMapping([this.instance]);h>=0&&this.textureMappings.splice(h,1,d),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(n)>-1){var f=[],p=(null===(i=t[0])||void 0===i?void 0:i.nodeName)===$S.CIRCLE||(null===(o=t[0])||void 0===o?void 0:o.nodeName)===$S.ELLIPSE?.5:0;t.forEach((function(t){var e=t.parsedStyle,n=e.opacity,r=void 0===n?1:n,i=e.fillOpacity,o=void 0===i?1:i,a=e.strokeOpacity,s=void 0===a?1:a,l=e.lineWidth,u=void 0===l?1:l,c=e.visibility,h=e.increasedLineWidthForHitTesting,d=void 0===h?0:h;f.push(r,o,s,u,"hidden"!==c?1:0,p,p,d)})),this.geometry.updateVertexBuffer(bX.PACKED_STYLE,xX.PACKED_STYLE1,e,new Uint8Array(new Float32Array(f).buffer))}else if("modelMatrix"===n||this.mergeXYZIntoModelMatrix&&("x"===n||"y"===n||"z"===n)){var g=[],v=ct();t.forEach((function(t){if(a.mergeXYZIntoModelMatrix){var e=t.parsedStyle,n=e.x,r=e.y,i=e.z;Wt(v,t.getWorldTransform(),Mt(v,$t(n,r,i)))}else dt(v,t.getWorldTransform());g.push.apply(g,u([],l(v),!1))})),this.geometry.updateVertexBuffer(bX.MODEL_MATRIX,xX.MODEL_MATRIX0,e,new Uint8Array(new Float32Array(g).buffer))}else if("pointerEvents"===n){var m=[];t.forEach((function(t){var e,n=r&&t.isInteractive()&&(null===(e=t.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0];m.push.apply(m,u(u([],l(n),!1),[t.sortable.renderOrder*pX],!1))})),this.geometry.updateVertexBuffer(bX.PICKING_COLOR,xX.PICKING_COLOR,e,new Uint8Array(new Float32Array(m).buffer))}}},t.prototype.updateAttribute=function(t,e,n,r){"clipPath"===n&&this.clipPath&&(this.geometryDirty=!0)},t.prototype.changeRenderOrder=function(t,e){var n,r=this.objects.indexOf(t),i=t.isInteractive()&&(null===(n=t.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(bX.PICKING_COLOR,xX.PICKING_COLOR,r,new Uint8Array(new Float32Array(u(u([],l(i),!1),[e*pX],!1)).buffer))},t.prototype.generateWireframe=function(t){for(var e=t.indices,n=t.indices.length,r=t.vertices.map((function(t){return t.slice()})),i=bX.PICKING_COLOR;i<t.vertexBuffers.length;i++){var o=t.inputLayoutDescriptor.vertexBufferDescriptors[i].arrayStride;t.vertices[i]=new Float32Array(o/4*n)}var a=0,s=new Uint32Array(n);for(i=0;i<n;i++){for(var l=e[i],u=1;u<t.vertices.length;u++)for(var c=(o=t.inputLayoutDescriptor.vertexBufferDescriptors[u].arrayStride)/4,h=0;h<c;h++)t.vertices[u][a*c+h]=r[u][l*c+h];s[i]=a,a++}for(i=bX.PICKING_COLOR+1;i<t.vertexBuffers.length;i++){var d=t.inputLayoutDescriptor.vertexBufferDescriptors[i],f=d.stepMode,p=(o=d.arrayStride,t.inputLayoutDescriptor.vertexBufferDescriptors[i].attributes[0]);if(p){var g=p.shaderLocation,v=p.offset,m=p.format,y=p.divisor;t.setVertexBuffer({bufferIndex:i,byteStride:o,stepMode:f,attributes:[{format:m,bufferByteOffset:v,location:g,divisor:y}],data:t.vertices[i]})}}var E=new Float32Array(3*n);for(i=0;i<n;)for(u=0;u<3;u++){E[3*(l=s[i++])+u]=1}t.setVertexBuffer({bufferIndex:bX.BARYCENTRIC,byteStride:12,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:Number(xX.BARYCENTRIC)}],data:E}),t.setIndexBuffer(s)},t.prototype.beforeUploadUBO=function(t,e){},t.prototype.uploadUBO=function(t){var e,n=this,i=this.material,o=this.lightPool.getAllLights(),a=this.lightPool.getFog(),s=!!a,l=null!==(e=i.defines.USE_LIGHT)&&void 0!==e?e:!!o.length,u=i.defines.USE_WIREFRAME,c=[];if(u){var h=PA(i.wireframeColor);c.push({name:"u_WireframeLineColor",value:[Number(h.r)/255,Number(h.g)/255,Number(h.b)/255]}),c.push({name:"u_WireframeLineWidth",value:i.wireframeLineWidth})}if(s&&this.uploadFog(c,a),this.uploadMaterial(c,i),l){var d={};o.forEach((function(t){d[t.define]||(d[t.define]=-1),d[t.define]++,t.uploadUBO(c,d[t.define])}))}c.sort((function(t,e){return n.material.uniformNames.indexOf(t.name)-n.material.uniformNames.indexOf(e.name)})),t.setUniforms(1,c);var f=i.depthCompare,p=i.depthWrite,g=i.stencilFront,v=i.stencilBack,m=i.stencilWrite,y=i.stencilRef,E=i.cullMode,_=i.frontFace,b=i.polygonOffset,x=i.blendConstant,S=i.blendEquation,M=i.blendEquationAlpha,A=i.blendSrc,R=i.blendDst,T=i.blendSrcAlpha,w=i.blendDstAlpha,P=EX({blendConstant:x,depthCompare:f,depthWrite:p,stencilFront:g,stencilBack:v,stencilWrite:m,stencilRef:y,cullMode:E,frontFace:_,polygonOffset:b}),N=t.getMegaStateFlags().attachmentsState[0];t.setMegaStateFlags(r({attachmentsState:[{channelWriteMask:this.material.stencilWrite?iV.NONE:iV.ALL,rgbBlendState:r(r({},N.rgbBlendState),EX({blendMode:S,blendSrcFactor:A,blendDstFactor:R})),alphaBlendState:r(r({},N.alphaBlendState),EX({blendMode:M,blendSrcFactor:T,blendDstFactor:w}))}]},P)),t.setBindingLayout({numUniformBuffers:1,numSamplers:this.textureMappings.length}),t.setSamplerBindingsFromTextureMappings(this.textureMappings)},t.prototype.uploadFog=function(t,e){var n=e.parsedStyle,r=n.type,i=n.fill,o=n.start,a=n.end,s=n.density;if(wA(i)){var l=[Number(i.r)/255,Number(i.g)/255,Number(i.b)/255,Number(i.alpha)];t.push({name:"u_FogInfos",value:[r,o,a,s]}),t.push({name:"u_FogColor",value:l})}},t.prototype.uploadMaterial=function(t,e){var n=Object.keys(e.uniforms).map((function(t){return{name:t,value:e.uniforms[t]}}));t.push.apply(t,u([],l(n),!1))},t.prototype.createFillGradientTextureMapping=function(t){var e,n=this,r=t[0],i=r.parsedStyle[this.gradientAttributeName];if(i&&(TA(i)||Array.isArray(i))){Array.isArray(i)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:i,width:128,height:128,instance:r})):TA(i)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(i,r,(function(){t.forEach((function(t){t.renderable.dirty=!0})),n.material.textureDirty=!0}))),e=this.texturePool.getOrCreateCanvas();var o=this.texturePool.getOrCreateTexture(this.context.device,e,pV(fV.U8_RGBA_NORM,1,1,1));if(o){var a=new tX;return a.name=MX,a.texture=o,a.texture.on("loaded",(function(){t.forEach((function(t){t.renderable.dirty=!0})),n.material.textureDirty=!0})),this.context.device.setResourceName(a.texture,"Fill Texture"+this.id),a.sampler=this.renderHelper.getCache().createSampler({addressModeU:Kz.CLAMP_TO_EDGE,addressModeV:Kz.CLAMP_TO_EDGE,minFilter:$z.POINT,magFilter:$z.BILINEAR,mipmapFilter:qz.LINEAR,lodMinClamp:0,lodMaxClamp:0}),a}}return null},t}();!function(t){t[t.PACKED_STYLE=5]="PACKED_STYLE"}(AX||(AX={})),function(t){t[t.PACKED_STYLE3=12]="PACKED_STYLE3",t[t.EXTRUDE=13]="EXTRUDE",t[t.SIZE=14]="SIZE"}(RX||(RX={}));var wX=[$S.CIRCLE,$S.ELLIPSE,$S.RECT],PX=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.shouldMerge=function(e,n){return!!t.prototype.shouldMerge.call(this,e,n)},e.prototype.createMaterial=function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = EXTRUDE) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec3 a_StylePacked3;\nlayout(location = SIZE) in vec4 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec2 v_Data;\nout vec2 v_Radius;\nout vec3 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size.xy + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size.xy + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n\n  bool isBillboard = a_Size.z > 0.5;\n  if (isBillboard) {\n    float rotation = 0.0;\n    bool isSizeAttenuation = a_Size.w > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec2(a_Extrude * radius / radius.y);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec2 v_Data;\nin vec2 v_Radius;\nin vec3 v_StylePacked3;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float dist = length(v_Data);\n  float antialiased_blur = -fwidth(dist);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data, 1.0);\n    inner_df = sdCircle(v_Data, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=r(r({},this.material.defines),yX(RX))},e.prototype.createGeometry=function(e){var n=this;t.prototype.createGeometry.call(this,e);var r=[],i=[];e.forEach((function(t,e){var o=t,a=o.parsedStyle.radius,s=n.shouldOmitStroke(o.parsedStyle),c=n.getSize(t.parsedStyle,o.nodeName),h=n.getPosition(t.parsedStyle,o.nodeName);r.push.apply(r,u(u([],l(c),!1),[o.parsedStyle.isBillboard?1:0,o.parsedStyle.isSizeAttenuation?1:0,wX.indexOf(o.nodeName),a&&a[0]||0,s?1:0],!1)),i.push.apply(i,u([],l(h),!1))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:bX.UV,byteStride:16,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:RX.EXTRUDE},{format:fV.F32_RG,bufferByteOffset:8,location:xX.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:12,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:AX.PACKED_STYLE,byteStride:28,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:RX.SIZE,divisor:1},{format:fV.F32_RGB,bufferByteOffset:16,location:RX.PACKED_STYLE3,divisor:1}],data:new Float32Array(r)})},e.prototype.updateAttribute=function(e,n,r,i){var o=this;if(t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"lineWidth"===r||"stroke"===r||"lineDash"===r||"strokeOpacity"===r||"radius"===r||"isBillboard"===r||"isSizeAttenuation"===r){var a=[];e.forEach((function(t){var e=t,n=o.shouldOmitStroke(e.parsedStyle),r=l(o.getSize(t.parsedStyle,t.nodeName),2),i=[r[0],r[1]];a.push.apply(a,u(u([],l(i),!1),[e.parsedStyle.isBillboard?1:0,e.parsedStyle.isSizeAttenuation?1:0,wX.indexOf(t.nodeName),t.parsedStyle.radius&&t.parsedStyle.radius[0]||0,n?1:0],!1))})),this.geometry.updateVertexBuffer(AX.PACKED_STYLE,RX.SIZE,n,new Uint8Array(new Float32Array(a).buffer))}else if("cx"===r||"cy"===r||"x"===r||"y"===r){var s=[];e.forEach((function(t){var e=l(o.getPosition(t.parsedStyle,t.nodeName),2),n=e[0],r=e[1];s.push(n,r)})),this.geometry.updateVertexBuffer(bX.POSITION,xX.POSITION,n,new Uint8Array(new Float32Array(s).buffer))}},e.prototype.getPosition=function(t,e){var n=[0,0,0];if(e===$S.CIRCLE||e===$S.ELLIPSE){var r=t,i=r.cx,o=void 0===i?0:i,a=r.cy,s=void 0===a?0:a,l=r.cz;n=[o,s,void 0===l?0:l]}else if(e===$S.RECT){var u=t,c=u.x,h=void 0===c?0:c,d=u.y,f=void 0===d?0:d,p=u.z;n=[h,f,void 0===p?0:p]}return n},e.prototype.getSize=function(t,e){var n=[0,0];if(e===$S.CIRCLE){var r=t.r;n=[r,r]}else if(e===$S.ELLIPSE){var i=t;n=[i.rx,i.ry]}else if(e===$S.RECT){var o=t;n=[o.width/2,o.height/2]}return n},e.prototype.shouldOmitStroke=function(t){var e=t.lineDash,n=t.stroke,r=t.strokeOpacity,i=n&&!n.isNone,o=e&&e.length&&e.every((function(t){return 0!==t}));return!i||i&&(o||r<1)},e}(TX);function NX(t,e,n,r,i,o,a,s){var l=a[a.length-3],u=a[a.length-2];a.length-=3;var c=s,h=0,d=0,f=0,p=0,g=0;a.push(l,u,0);for(var v=1,m=0;v<=c;++v)f=(d=(h=1-(m=v/c))*h)*h,g=(p=m*m)*m,a.push(f*l+3*d*m*t+3*h*p*n+g*i,f*u+3*d*m*e+3*h*p*r+g*o,0)}var CX,OX,IX=1e20,LX=function(){function t(t,e){var n=t.fontSize,r=void 0===n?24:n,i=t.buffer,o=void 0===i?3:i,a=t.radius,s=void 0===a?8:a,l=t.cutoff,u=void 0===l?.25:l,c=t.fontFamily,h=void 0===c?"sans-serif":c,d=t.fontWeight,f=void 0===d?"normal":d,p=t.fontStyle,g=void 0===p?"normal":p,v=t.canvas;this.buffer=o,this.cutoff=u,this.radius=s;var m=this.size=r+4*o,y=e.offscreenCanvasCreator.getOrCreateCanvas(v);y.width=m,y.height=m;var E=e.offscreenCanvasCreator.getOrCreateContext(v,{willReadFrequently:!0});this.ctx=E,E.font="".concat(g," ").concat(f," ").concat(r,"px ").concat(h),E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}return t.prototype.draw=function(t){var e=this.ctx.measureText(t),n=e.width,r=e.actualBoundingBoxAscent,i=e.actualBoundingBoxDescent,o=e.actualBoundingBoxLeft,a=e.actualBoundingBoxRight,s=Math.ceil(r),l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),u=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=l+2*this.buffer,h=u+2*this.buffer,d=Math.max(c*h,0),f=new Uint8ClampedArray(d),p={data:f,width:c,height:h,glyphWidth:l,glyphHeight:u,glyphTop:s,glyphLeft:0,glyphAdvance:n};if(0===l||0===u)return p;var g=this,v=g.ctx,m=g.buffer,y=g.gridInner,E=g.gridOuter;v.clearRect(m,m,l,u),v.fillText(t,m,m+s);var _=v.getImageData(m,m,l,u);E.fill(IX,0,d),y.fill(0,0,d);for(var b=0;b<u;b++)for(var x=0;x<l;x++){var S=_.data[4*(b*l+x)+3]/255;if(0!==S){var M=(b+m)*c+x+m;if(1===S)E[M]=0,y[M]=IX;else{var A=.5-S;E[M]=A>0?A*A:0,y[M]=A<0?A*A:0}}}DX(E,0,0,c,h,c,this.f,this.v,this.z),DX(y,m,m,l,u,c,this.f,this.v,this.z);for(var R=0;R<d;R++){A=Math.sqrt(E[R])-Math.sqrt(y[R]);f[R]=Math.round(255-255*(A/this.radius+this.cutoff))}return p},t}();function DX(t,e,n,r,i,o,a,s,l){for(var u=e;u<e+r;u++)BX(t,n*o+u,o,i,a,s,l);for(var c=n;c<n+i;c++)BX(t,c*o+e,1,r,a,s,l)}function BX(t,e,n,r,i,o,a){o[0]=0,a[0]=-IX,a[1]=IX,i[0]=t[e];for(var s=1,l=0,u=0;s<r;s++){i[s]=t[e+s*n];var c=s*s;do{var h=o[l];u=(i[s]-i[h]+c-h*h)/(s-h)/2}while(u<=a[l]&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=IX}for(s=0,l=0;s<r;s++){for(;a[l+1]<s;)l++;var d=s-(h=o[l]);t[e+s*n]=i[h]+d*d}}!function(t){t[t.PACKED=5]="PACKED",t[t.VERTEX_NUM=6]="VERTEX_NUM",t[t.TRAVEL=7]="TRAVEL",t[t.DASH=8]="DASH"}(CX||(CX={})),function(t){t[t.PREV=8]="PREV",t[t.POINT1=9]="POINT1",t[t.POINT2=10]="POINT2",t[t.NEXT=11]="NEXT",t[t.VERTEX_JOINT=12]="VERTEX_JOINT",t[t.VERTEX_NUM=13]="VERTEX_NUM",t[t.TRAVEL=14]="TRAVEL",t[t.DASH=15]="DASH"}(OX||(OX={}));function kX(t,e,n){return 4*(t?1:0)+2*(e?1:0)+(n?1:0)}function FX(t){if(!(t.nodeName===$S.POLYLINE))return!1;var e=t.parsedStyle.points.points;return e.length&&!_(e[0][2])}var UX,GX=function(t){function e(e,n,r,i,o,a,s){var l=t.call(this,e,n,r,i,o,a,s)||this;return l.renderHelper=e,l.texturePool=n,l.lightPool=r,l.segmentNum=-1,l.segmentNum=l.calcSegmentNum(i),l.gradientAttributeName="stroke",l}return n(e,t),e.calcSubpathNum=function(t){return t.nodeName===$S.PATH?t.parsedStyle.d.absolutePath.filter((function(t){return"M"===t[0]})).length:1},e.prototype.calcSegmentNum=function(t){return WX(t,!1,12,this.calcSubpathIndex(t)).instancedCount},e.prototype.calcSubpathIndex=function(t){if(t.nodeName===$S.PATH){var e=this.drawcallCtors.filter((function(t){return t===$X})).length;return this.index-e}return 0},e.prototype.shouldMerge=function(e,n){if(!t.prototype.shouldMerge.call(this,e,n))return!1;if(this.index!==n)return!1;var r=this.calcSegmentNum(e);return this.segmentNum===r},e.prototype.createMaterial=function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = PREV) in vec3 a_Prev;\nlayout(location = POINT1) in vec3 a_Point1;\nlayout(location = POINT2) in vec3 a_Point2;\nlayout(location = NEXT) in vec3 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\nout vec4 v_Dash;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float u_Expand = 1.0;\nconst float u_MiterLimit = 5.0;\nconst float u_ScaleMode = 1.0;\nconst float u_Alignment = 0.5;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvec2 clip2ScreenSpace(vec4 clip) {\n  return u_Viewport * (0.5 * clip.xy / clip.w + 0.5);\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  v_Dash = a_Dash;\n\n  vec2 pointA;\n  vec2 pointB;\n  vec4 clip0;\n  vec4 clip1;\n\n  float compressed = a_Dash.w;\n  float is_billboard = floor(compressed / 4.0);\n  compressed -= is_billboard * 4.0;\n  float is_size_attenuation = floor(compressed / 2.0);\n  compressed -= is_size_attenuation * 2.0;\n  float is_3d_polyline = compressed;\n\n  bool isBillboard = is_billboard > 0.5;\n  bool isSizeAttenuation = is_size_attenuation > 0.5;\n  bool is3DPolyline = is_3d_polyline > 0.5;\n  if (isBillboard) {\n    clip0 = billboard(a_Point1.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n    clip1 = billboard(a_Point2.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else if (is3DPolyline) {\n    clip0 = project(vec4(a_Point1, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = project(vec4(a_Point2, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  if (isBillboard || is3DPolyline) {\n    pointA = clip2ScreenSpace(clip0);\n    pointB = clip2ScreenSpace(clip1);\n  } else {\n    pointA = (u_ModelMatrix * vec4(a_Point1, 1.0)).xy;\n    pointB = (u_ModelMatrix * vec4(a_Point2, 1.0)).xy;\n  }\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Prev.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Prev, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Prev, 1.0)).xy;\n      }\n\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Next.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Next, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Next, 1.0)).xy;\n      }\n      \n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  if (isBillboard || is3DPolyline) {\n    vec4 clip = mix(clip0, clip1, 0.5);\n    gl_Position = vec4(clip.w * (2.0 * pos / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  float u_Dash = v_Dash.x;\n  float u_Gap = v_Dash.y;\n  float u_DashOffset = v_Dash.z;\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    vec3 pickingColor = u_PickingColor;\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=r(r({},this.material.defines),yX(OX))},e.prototype.createGeometry=function(e){var n=this,r=[],i=[],o=[],a=[],s=0,c=0;e.forEach((function(t){var e=WX(t,!1,12,n.calcSubpathIndex(t)),h=e.pointsBuffer,d=e.travelBuffer,f=e.instancedCount,p=t.parsedStyle,g=p.lineDash,v=p.lineDashOffset,m=p.isBillboard,y=p.isSizeAttenuation;a.push(g&&g[0]||0,g&&g[1]||0,v||0,kX(m,y,FX(t))),s+=f;for(var E=0;E<h.length-12;E+=4)i.push(h[E],h[E+1],h[E+2],h[E+3],h[E+4],h[E+5],h[E+6],h[E+7],h[E+8],h[E+9],h[E+10],h[E+11],h[E+12],h[E+13],h[E+14],h[E+15]);o.push.apply(o,u([],l(d),!1)),r.push(0+c,2+c,1+c,0+c,3+c,2+c,4+c,6+c,5+c,4+c,7+c,6+c,4+c,7+c,8+c),c+=9})),i.length&&(this.geometry.setVertexBuffer({bufferIndex:CX.PACKED,byteStride:64,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:OX.PREV,divisor:1},{format:fV.F32_RGB,bufferByteOffset:16,location:OX.POINT1,divisor:1},{format:fV.F32_R,bufferByteOffset:28,location:OX.VERTEX_JOINT,divisor:1},{format:fV.F32_RGB,bufferByteOffset:32,location:OX.POINT2,divisor:1},{format:fV.F32_RGB,bufferByteOffset:48,location:OX.NEXT,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:CX.VERTEX_NUM,byteStride:4,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_R,bufferByteOffset:0,byteStride:4,location:OX.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:CX.TRAVEL,byteStride:4,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_R,bufferByteOffset:0,byteStride:4,location:OX.TRAVEL,divisor:1}],data:new Float32Array(o)}),this.divisor=s/e.length,this.geometry.setVertexBuffer({bufferIndex:CX.DASH,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:OX.DASH,divisor:this.divisor}],data:new Float32Array(a)}),t.prototype.createGeometry.call(this,e),this.geometry.vertexCount=15,this.geometry.instancedCount=s,this.geometry.setIndexBuffer(new Uint32Array(r)))},e.prototype.updateAttribute=function(e,n,r,i){var o=this;if(t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"radius"===r||"x1"===r||"y1"===r||"x2"===r||"y2"===r||"points"===r||"path"===r||"d"===r||"lineJoin"===r||"lineCap"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r){var a=[],s=[],c=0;e.forEach((function(t){var e=WX(t,!1,12,o.calcSubpathIndex(t)),n=e.pointsBuffer,r=e.travelBuffer,i=e.instancedCount;c=i;for(var h=0;h<n.length-12;h+=4)a.push(n[h],n[h+1],n[h+2],n[h+3],n[h+4],n[h+5],n[h+6],n[h+7],n[h+8],n[h+9],n[h+10],n[h+11],n[h+12],n[h+13],n[h+14],n[h+15]);s.push.apply(s,u([],l(r),!1))})),this.geometry.updateVertexBuffer(CX.PACKED,OX.PREV,n*c,new Uint8Array(new Float32Array(a).buffer)),this.geometry.updateVertexBuffer(CX.TRAVEL,OX.TRAVEL,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isBillboard"===r||"isSizeAttenuation"===r){var h=[];e.forEach((function(t){var e=t.parsedStyle,n=e.lineDash,r=e.lineDashOffset,i=e.isBillboard,o=e.isSizeAttenuation;h.push(n&&n[0]||0,n&&n[1]||0,r||0,kX(i,o,FX(t)))})),this.geometry.updateVertexBuffer(CX.DASH,OX.DASH,n,new Uint8Array(new Float32Array(h).buffer))}},e}(TX);!function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.JOINT_BEVEL=4]="JOINT_BEVEL",t[t.JOINT_MITER=8]="JOINT_MITER",t[t.JOINT_ROUND=12]="JOINT_ROUND",t[t.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",t[t.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",t[t.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",t[t.FILL_EXPAND=24]="FILL_EXPAND",t[t.CAP_BUTT=32]="CAP_BUTT",t[t.CAP_SQUARE=64]="CAP_SQUARE",t[t.CAP_ROUND=96]="CAP_ROUND",t[t.CAP_BUTT2=128]="CAP_BUTT2"}(UX||(UX={}));var zX=3,VX=4;function WX(t,e,n,r){var i;void 0===e&&(e=!1),void 0===r&&(r=0);var o=t.parsedStyle,a=o.lineCap,s=o.lineJoin,c=t.sortable.renderOrder*pX,h=0,d=0,f=t.parsedStyle,p=f.markerStart,g=f.markerEnd,v=f.markerStartOffset,m=f.markerEndOffset,y=[],E=[];if(t.nodeName===$S.POLYLINE||t.nodeName===$S.POLYGON){var _=t.parsedStyle.points.points,b=_.length,x=0,S=0,M=0,A=0,R=0,T=void 0,w=void 0;p&&Sw(p)&&v&&(T=_[1][0]-_[0][0],w=_[1][1]-_[0][1],R=Math.atan2(w,T),x=Math.cos(R)*(v||0),S=Math.sin(R)*(v||0)),g&&Sw(g)&&m&&(T=_[b-2][0]-_[b-1][0],w=_[b-2][1]-_[b-1][1],R=Math.atan2(w,T),M=Math.cos(R)*(m||0),A=Math.sin(R)*(m||0));var P=t.nodeName===$S.POLYLINE;if(y[0]=_.reduce((function(t,e,n){var r=0,i=0;return 0===n?(r=x,i=S):n===b-1&&(r=M,i=A),t.push(e[0]+r,e[1]+i,P?e[2]||0:c),t}),[]),t.nodeName===$S.POLYGON){if(e)return E=uH(y[0],[],3),{pointsBuffer:y[0],travelBuffer:[],triangles:E,instancedCount:Math.round(y[0].length/zX)};y[0].push(y[0][0],y[0][1],y[0][2]||c),(i=y[0]).push.apply(i,u([],l(jX(y[0][0],y[0][1],y[0][2]||c,y[0][3],y[0][4],y[0][5]||c)),!1))}}else if(t.nodeName===$S.PATH||t.nodeName===$S.CIRCLE||t.nodeName===$S.ELLIPSE||t.nodeName===$S.RECT){var N=void 0;if(t.nodeName!==$S.PATH){if(N=dR(uR(t,gt(ct()))),t.nodeName===$S.RECT){var C=t.parsedStyle,O=C.width,I=C.height;O<0&&(h+=N.rect.width),I<0&&(d+=N.rect.height)}}else N=t.parsedStyle.d;var L=N.absolutePath,D=N.segments,B=0,k=0,F=0,U=0;R=0,T=void 0,w=void 0;if(p&&p.parentNode&&Sw(p)&&v){var G=l(p.parentNode.getStartTangent(),2),z=G[0],V=G[1];T=z[0]-V[0],w=z[1]-V[1],R=Math.atan2(w,T),B=Math.cos(R)*(v||0),k=Math.sin(R)*(v||0)}if(g&&g.parentNode&&Sw(g)&&m){var W=l(g.parentNode.getEndTangent(),2);z=W[0],V=W[1];T=z[0]-V[0],w=z[1]-V[1],R=Math.atan2(w,T),F=Math.cos(R)*(m||0),U=Math.sin(R)*(m||0)}var j=-1,H=-1;if(L.forEach((function(e,r){var i,o=l(e),a=o[0],s=o.slice(1),f=L[r+1],p=0===r&&(0!==B||0!==k),g=(r===L.length-1||f&&("M"===f[0]||"Z"===f[0]))&&0!==F&&0!==U;if("M"===a)H++,y[H]=[],j=y[H].length,p?y[H].push(s[0]-h+B,s[1]-d+k,c,s[0]-h,s[1]-d,c):y[H].push(s[0]-h,s[1]-d,c);else if("L"===a)g?y[H].push(s[0]-h+F,s[1]-d+U,c):y[H].push(s[0]-h,s[1]-d,c);else if("Q"===a)!function(t,e,n,r,i,o){for(var a=i[i.length-3],s=i[i.length-2],l=o,u=0,c=0,h=1;h<=l;++h){var d=h/l;u=a+(t-a)*d,c=s+(e-s)*d,i.push(u+(t+(n-t)*d-u)*d,c+(e+(r-e)*d-c)*d,0)}}(s[0]-h,s[1]-d,s[2]-h,s[3]-d,y[H],n),g&&y[H].push(s[2]-h+F,s[3]-d+U,c);else if("A"===a){for(var v=l(D[r].prePoint,2),m=Ue(v[0],v[1],s[0],s[1],s[2],s[3],s[4],s[5],s[6],void 0),E=0;E<m.length;E+=6)NX(m[E]-h,m[E+1]-d,m[E+2]-h,m[E+3]-d,m[E+4]-h,m[E+5]-d,y[H],n);g&&y[H].push(s[5]-h+F,s[6]-d+U,c)}else if("C"===a)NX(s[0]-h,s[1]-d,s[2]-h,s[3]-d,s[4]-h,s[5]-d,y[H],n),g&&y[H].push(s[4]-h+F,s[5]-d+U,c);else if("Z"===a&&(t.nodeName===$S.PATH||t.nodeName===$S.RECT)){var _=1e-4;(Math.abs(y[H][y[H].length-2]-y[H][j])>_||Math.abs(y[H][y[H].length-1]-y[H][j+1])>_)&&y[H].push(y[H][j],y[H][j+1],c),(i=y[H]).push.apply(i,u([],l(jX(y[H][j],y[H][j+1],y[H][j+2],y[H][j+3],y[H][j+4],y[H][j+5])),!1))}})),e)return{pointsBuffer:Q=y[r],travelBuffer:[],triangles:E=uH(Q,[],3),instancedCount:Math.round(Q.length/zX)}}var X=function(t){var e;switch(t){case"bevel":e=UX.JOINT_BEVEL;break;case"round":e=UX.JOINT_ROUND;break;default:e=UX.JOINT_MITER}return e}(s),Y=function(t){var e;switch(t){case"square":e=UX.CAP_SQUARE;break;case"round":e=UX.CAP_ROUND;break;default:e=UX.CAP_BUTT}return e}(a),K=Y;Y===UX.CAP_ROUND&&(K=UX.JOINT_CAP_ROUND),Y===UX.CAP_BUTT&&(K=UX.JOINT_CAP_BUTT),Y===UX.CAP_SQUARE&&(K=UX.JOINT_CAP_SQUARE);for(var $=y[r],q=(Math.round(0/zX)+2)*VX,Z=0,Q=[],J=[],tt=0;tt<$.length;tt+=zX)tt>1&&(Z+=Math.sqrt(Math.pow($[tt]-$[tt-zX],2)+Math.pow($[tt+1]-$[tt+1-zX],2)+Math.pow($[tt+2]-$[tt+2-zX],2))),J.push(Z),Q[q++]=$[tt],Q[q++]=$[tt+1],Q[q++]=$[tt+2]||0,Q[q]=X,0==tt&&Y!==UX.CAP_ROUND&&(Q[q]+=Y),tt+2*zX>=$.length?Q[q]+=K-X:tt+zX>=$.length&&(Q[q]=0),q++;return Q[q++]=$[$.length-6],Q[q++]=$[$.length-5],Q[q++]=$[$.length-4]||c,Q[q++]=0,Q[0]=$[0],Q[1]=$[1],Q[2]=$[2]||c,Q[3]=0,Q[4]=$[3],Q[5]=$[4],Q[6]=$[5]||c,Q[7]=Y===UX.CAP_ROUND?Y:0,{pointsBuffer:Q,travelBuffer:J,triangles:E,instancedCount:Math.round($.length/zX)}}function jX(t,e,n,r,i,o){void 0===r&&(r=t),void 0===i&&(i=e),void 0===o&&(o=n);var a=[r-t,i-e,o-n],s=.01;return[t+a[0]*s,e+a[1]*s,n+a[2]*s]}var HX,XX;!function(t){t[t.PACKED_STYLE=5]="PACKED_STYLE"}(HX||(HX={})),function(t){t[t.PACKED_STYLE3=12]="PACKED_STYLE3"}(XX||(XX={}));var YX,KX,$X=function(t){function e(e,n,r,i,o,a,s){var l=t.call(this,e,n,r,i,o,a,s)||this;return l.renderHelper=e,l.texturePool=n,l.lightPool=r,l.trianglesHash=[[],[]],l.trianglesHash=l.calcSegmentNum(i),l}return n(e,t),e.prototype.calcSegmentNum=function(t){var e=WX(t,!0,12,this.calcSubpathIndex(t));return[e.triangles,e.pointsBuffer]},e.prototype.calcSubpathIndex=function(t){return t.nodeName===$S.PATH?this.index:0},e.prototype.compareTrianglesHash=function(t){var e=l(this.trianglesHash,2),n=e[0],r=e[1],i=l(t,2),o=i[0],a=i[1];return n.length===o.length&&r.length===a.length&&(!n.some((function(t,e){return t!==o[e]}))&&!r.some((function(t,e){return t!==a[e]})))},e.prototype.shouldMerge=function(e,n){if(!t.prototype.shouldMerge.call(this,e,n))return!1;if(this.index!==n)return!1;var r=this.calcSegmentNum(e);return this.compareTrianglesHash(r)},e.prototype.createGeometry=function(e){var n=this,r=[],i=[],o=[],a=0;if(e.forEach((function(t,e){var s=WX(t,!0,12,n.calcSubpathIndex(t)),c=s.triangles,h=s.pointsBuffer;if(c.length){var d=t.getGeometryBounds().halfExtents,f=[];h.forEach((function(t,e){e%3!=2&&f.push(t/d[e%3]/2)})),a+=i.length/3,i.push.apply(i,u([],l(h),!1)),o.push.apply(o,u([],l(f),!1)),r.push.apply(r,u([],l(c.map((function(t){return t+a}))),!1))}})),i.length){t.prototype.createGeometry.call(this,e);var s=[];e.forEach((function(t){var e=t.parsedStyle,n=e.isBillboard,r=e.billboardRotation,i=e.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:12,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:HX.PACKED_STYLE,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:XX.PACKED_STYLE3,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:bX.UV,byteStride:8,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:xX.UV}],data:new Float32Array(o)}),this.geometry.vertexCount=r.length/e.length,this.geometry.setIndexBuffer(new Uint32Array(r))}},e.prototype.createMaterial=function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(a_Position.xy, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else {\n    gl_Position = project(vec4(a_Position.xy, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=r(r(r({},this.material.defines),yX(XX)),{INSTANCED:!0})},e.prototype.updateAttribute=function(e,n,r,i){if(t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i),"isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var o=[];e.forEach((function(t){var e=t.parsedStyle,n=e.isBillboard,r=e.billboardRotation,i=e.isSizeAttenuation;o.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(HX.PACKED_STYLE,XX.PACKED_STYLE3,n,new Uint8Array(new Float32Array(o).buffer))}},e}(TX),qX=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1];!function(t){t[t.POINT=5]="POINT",t[t.CAP=6]="CAP",t[t.DASH=7]="DASH"}(YX||(YX={})),function(t){t[t.POSITION=8]="POSITION",t[t.UV=10]="UV",t[t.POINTA=9]="POINTA",t[t.POINTB=11]="POINTB",t[t.CAP=12]="CAP",t[t.DASH=13]="DASH"}(KX||(KX={}));var ZX,QX,JX={butt:1,round:2,square:3},tY=function(t){function e(e,n,r,i,o,a,s){var l=t.call(this,e,n,r,i,o,a,s)||this;return l.renderHelper=e,l.texturePool=n,l.lightPool=r,l.gradientAttributeName="stroke",l}return n(e,t),e.isLine=function(t,e){if(t.nodeName===$S.PATH){for(var n=t.parsedStyle.d.absolutePath,r=0,i=0,o=0;o<n.length;o++){if("M"===n[o][0]){if(r===e){i=o;break}r++}}if("M"===n[i][0]&&"L"===n[i+1][0]&&(void 0===n[i+2]||"M"===n[i+2][0]))return!0}else if(t.nodeName===$S.POLYLINE){var a=t.parsedStyle.points.points,s=(a[1][0]-a[1][1])/(a[0][0]-a[0][1]);for(o=1;o<a.length-1;o++)if((a[o+1][0]-a[o+1][1])/(a[o][0]-a[o][1])!==s)return!1;return!0}return!1},e.prototype.shouldMerge=function(e,n){return!!t.prototype.shouldMerge.call(this,e,n)},e.prototype.createMaterial=function(t){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  bool isSizeAttenuation = a_Dash.w > 0.5;\n  if (isSizeAttenuation) {\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * max(blur, 0.5)\n      * u_Opacity * u_StrokeOpacity\n      * (u_dash_array < 1.0 ? (ceil((u_dash_array * u_dash_ratio) - mod(v_Dash.x + u_dash_offset, u_dash_array))) : 1.0);\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=r(r({},this.material.defines),yX(KX))},e.prototype.calcSubpathIndex=function(t){if(t.nodeName===$S.PATH){var e=this.drawcallCtors.filter((function(t){return t===$X})).length;return this.index-e}return 0},e.prototype.createGeometry=function(e){var n=this;t.prototype.createGeometry.call(this,e);var r=[],i=[],o=[],a=[],s=0;e.forEach((function(t){var e,l;if(t.nodeName===$S.LINE)e=t.parsedStyle,l=t.getTotalLength();else if(t.nodeName===$S.POLYLINE){var u=t.parsedStyle,c=u.points.points,h=u.lineCap,d=u.lineDash,f=u.lineDashOffset,p=u.markerStart,g=u.markerEnd,v=u.markerStartOffset,m=u.markerEndOffset,y=u.isBillboard,E=u.isSizeAttenuation;e={x1:c[0][0],y1:c[0][1],x2:c[c.length-1][0],y2:c[c.length-1][1],z1:0,z2:0,lineCap:h,lineDash:d,lineDashOffset:f,isBillboard:y,isSizeAttenuation:E,markerStart:p,markerEnd:g,markerStartOffset:v,markerEndOffset:m},l=t.getTotalLength()}else if(t.nodeName===$S.PATH){for(var _=t.parsedStyle,b=_.d.absolutePath,x=_.lineCap,S=(d=_.lineDash,f=_.lineDashOffset,p=_.markerStart,g=_.markerEnd,v=_.markerStartOffset,m=_.markerEndOffset,_.isBillboard),M=_.isSizeAttenuation,A=0,R=0,T=n.calcSubpathIndex(t),w=0;w<b.length;w++){if("M"===b[w][0]){if(A===T){R=w;break}A++}}e={x1:b[R][1],y1:b[R][2],x2:b[R+1][1],y2:b[R+1][2],z1:0,z2:0,lineCap:x,lineDash:d,lineDashOffset:f,isBillboard:S,isSizeAttenuation:M,markerStart:p,markerEnd:g,markerStartOffset:v,markerEndOffset:m},l=t.getTotalLength()}var P=e.x1,N=e.y1,C=e.x2,O=e.y2,I=e.z1,L=e.z2,D=e.lineCap,B=e.isBillboard,k=e.isSizeAttenuation,F=n.calcOffset(e),U=F.startOffsetX,G=F.startOffsetY,z=F.endOffsetX,V=F.endOffsetY,W=n.calcDash(e,l),j=W.dashOffset,H=W.dashSegmentPercent,X=W.dashRatioInEachSegment;i.push(JX[D]),o.push(j,H,X,B||k?1:0),r.push(P+U,N+G,I,C+z,O+V,L),a.push(0+s,2+s,1+s,0+s,3+s,2+s),s+=4})),this.geometry.setIndexBuffer(new Uint32Array(a)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:20,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:KX.POSITION,divisor:0},{format:fV.F32_RG,bufferByteOffset:12,location:KX.UV,divisor:0}],data:new Float32Array(qX)}),this.geometry.setVertexBuffer({bufferIndex:YX.POINT,byteStride:24,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:KX.POINTA,divisor:1},{format:fV.F32_RGB,bufferByteOffset:12,location:KX.POINTB,divisor:1}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:YX.CAP,byteStride:4,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_R,bufferByteOffset:0,location:KX.CAP,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:YX.DASH,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:KX.DASH,divisor:1}],data:new Float32Array(o)})},e.prototype.updateAttribute=function(e,n,r,i){var o=this;if(t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i),"x1"===r||"y1"===r||"x2"===r||"y2"===r||"z1"===r||"z2"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r||"points"===r||"d"===r){var a=[];e.forEach((function(t){var e;if(t.nodeName===$S.LINE)e=t.parsedStyle;else if(t.nodeName===$S.POLYLINE){var n=t.parsedStyle,r=n.points.points,i=n.lineCap,s=n.markerStart,l=n.markerEnd,u=n.markerStartOffset,c=n.markerEndOffset,h=n.isBillboard,d=n.isSizeAttenuation;e={x1:r[0][0],y1:r[0][1],x2:r[r.length-1][0],y2:r[r.length-1][1],z1:0,z2:0,lineCap:i,isSizeAttenuation:d,isBillboard:h,markerStart:s,markerEnd:l,markerStartOffset:u,markerEndOffset:c}}else if(t.nodeName===$S.PATH){var f=t.parsedStyle,p=f.d.absolutePath;i=f.lineCap,s=f.markerStart,l=f.markerEnd,u=f.markerStartOffset,c=f.markerEndOffset,h=f.isBillboard,d=f.isSizeAttenuation;e={x1:p[0][1],y1:p[0][2],x2:p[1][1],y2:p[1][2],z1:0,z2:0,lineCap:i,isBillboard:h,isSizeAttenuation:d,markerStart:s,markerEnd:l,markerStartOffset:u,markerEndOffset:c}}var g=e.x1,v=e.y1,m=e.x2,y=e.y2,E=e.z1,_=e.z2,b=o.calcOffset(e),x=b.startOffsetX,S=b.startOffsetY,M=b.endOffsetX,A=b.endOffsetY;a.push(g+x,v+S,E,m+M,y+A,_)})),this.geometry.updateVertexBuffer(YX.POINT,KX.POINTA,n,new Uint8Array(new Float32Array(a).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isSizeAttenuation"===r||"isBillboard"===r){var s=[];e.forEach((function(t){var e=t.getTotalLength(),n=o.calcDash(t.parsedStyle,e),r=n.dashOffset,i=n.dashSegmentPercent,a=n.dashRatioInEachSegment;s.push(r,i,a,t.parsedStyle.isBillboard||t.parsedStyle.isSizeAttenuation?1:0)})),this.geometry.updateVertexBuffer(YX.DASH,KX.DASH,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineCap"===r){var l=[];e.forEach((function(t){var e=t.parsedStyle.lineCap;l.push(JX[e])})),this.geometry.updateVertexBuffer(YX.CAP,KX.CAP,n,new Uint8Array(new Float32Array(l).buffer))}},e.prototype.calcOffset=function(t){var e,n,r=t.x1,i=t.y1,o=t.x2,a=t.y2,s=t.markerStart,l=t.markerEnd,u=t.markerStartOffset,c=t.markerEndOffset,h=0,d=0,f=0,p=0,g=0;return s&&Sw(s)&&u&&(e=o-r,n=a-i,g=Math.atan2(n,e),h=Math.cos(g)*(u||0),d=Math.sin(g)*(u||0)),l&&Sw(l)&&c&&(e=r-o,n=i-a,g=Math.atan2(n,e),f=Math.cos(g)*(c||0),p=Math.sin(g)*(c||0)),{startOffsetX:h,startOffsetY:d,endOffsetX:f,endOffsetY:p}},e.prototype.calcDash=function(t,e){var n=t.lineDash,r=t.lineDashOffset,i=0,o=1,a=0;if(n&&n.length){i=(r||0)/e;var s=n.reduce((function(t,e){return t+e}),0);0===s?(o=1,a=0):(o=s/e,a=n[1]/s)}return{dashOffset:i,dashSegmentPercent:o,dashRatioInEachSegment:a}},e}(TX);!function(t){t[t.PACKED_STYLE=5]="PACKED_STYLE",t[t.SIZE=8]="SIZE"}(ZX||(ZX={})),function(t){t[t.PACKED_STYLE3=12]="PACKED_STYLE3",t[t.SIZE=13]="SIZE"}(QX||(QX={}));var eY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.shouldMerge=function(e,n){return!!t.prototype.shouldMerge.call(this,e,n)&&this.instance.parsedStyle.src===e.parsedStyle.src},e.prototype.createMaterial=function(t){var e=t[0].parsedStyle.src;this.material.defines=r(r({},this.material.defines),yX(QX)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = SIZE) in vec2 a_Size;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size;\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}";var n=this.texturePool.getOrCreateTexture(this.context.device,e,void 0);this.material.setUniforms({u_Map:n})},e.prototype.createGeometry=function(e){t.prototype.createGeometry.call(this,e);var n=[],r=[],i=[];e.forEach((function(t,e){var o=t.parsedStyle,a=o.x,s=void 0===a?0:a,l=o.y,u=void 0===l?0:l,c=o.z,h=void 0===c?0:c,d=o.width,f=o.height,p=o.isBillboard,g=o.billboardRotation,v=o.isSizeAttenuation;n.push(s,u,h),r.push(d,f),i.push(p?1:0,null!=g?g:0,v?1:0,0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:12,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.POSITION}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:ZX.SIZE,byteStride:8,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:QX.SIZE}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:ZX.PACKED_STYLE,byteStride:16,stepMode:tV.INSTANCE,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:QX.PACKED_STYLE3,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:bX.UV,byteStride:8,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:xX.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})},e.prototype.updateAttribute=function(e,n,r,i){if(t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i),"x"===r||"y"===r||"z"===r){var o=[];e.forEach((function(t){var e=t.parsedStyle,n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,s=e.z,l=void 0===s?0:s;o.push(r,a,l)})),this.geometry.updateVertexBuffer(bX.POSITION,xX.POSITION,n,new Uint8Array(new Float32Array(o).buffer))}else if("width"===r||"height"===r){var a=[];e.forEach((function(t){var e=t.parsedStyle,n=e.width,r=e.height;a.push(n,r)})),this.geometry.updateVertexBuffer(ZX.SIZE,QX.SIZE,n,new Uint8Array(new Float32Array(a).buffer))}else if("isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var s=[];e.forEach((function(t){var e=t.parsedStyle,n=e.isBillboard,r=e.billboardRotation,i=e.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(ZX.PACKED_STYLE,QX.PACKED_STYLE3,n,new Uint8Array(new Float32Array(s).buffer))}else if("src"===r){var l=this.texturePool.getOrCreateTexture(this.context.device,i);this.material.setUniforms({u_Map:l})}},e}(TX);function nY(t,e,n,r){var i=e.width,o=e.height;if(r){if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function rY(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<i.height;l++)for(var u=((n.y+l)*t.width+n.x)*o,c=((r.y+l)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[u+h];return e}var iY=function(){function t(t,e){nY(this,t,1,e)}return t.prototype.resize=function(t){!function(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=nY({},{width:r,height:i},n);rY(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}(this,t,1)},t.prototype.clone=function(){return new t({width:this.width,height:this.height},new Uint8Array(this.data))},t.copy=function(t,e,n,r,i){rY(t,e,n,r,i,1)},t}();var oY=function(t){var e={},n=[];for(var r in t){var i=t[r],o=e[r]={};for(var a in i)if((f=i[+a])&&0!==f.bitmap.width&&0!==f.bitmap.height){var l={x:0,y:0,w:f.bitmap.width+2,h:f.bitmap.height+2};n.push(l),o[a]={rect:l,metrics:f.metrics}}}var u=function(t){var e,n,r,i,o=0,a=0;try{for(var l=s(t),u=l.next();!u.done;u=l.next())o+=(g=u.value).w*g.h,a=Math.max(a,g.w)}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}t.sort((function(t,e){return e.h-t.h}));var c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),a),h:1/0}],h=0,d=0;try{for(var f=s(t),p=f.next();!p.done;p=f.next())for(var g=p.value,v=c.length-1;v>=0;v--){var m=c[v];if(!(g.w>m.w||g.h>m.h)){if(g.x=m.x,g.y=m.y,d=Math.max(d,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===m.w&&g.h===m.h){var y=c.pop();v<c.length&&(c[v]=y)}else g.h===m.h?(m.x+=g.w,m.w-=g.w):g.w===m.w?(m.y+=g.h,m.h-=g.h):(c.push({x:m.x+g.w,y:m.y,w:m.w-g.w,h:g.h}),m.y+=g.h,m.h-=g.h);break}}}catch(t){r={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}return{w:h,h:d,fill:o/(h*d)||0}}(n),c=u.w,h=u.h,d=new iY({width:c||1,height:h||1});for(var r in t)for(var a in i=t[r]){var f;(f=i[+a])&&0!==f.bitmap.width&&0!==f.bitmap.height&&(l=e[r][a].rect,iY.copy(f.bitmap,d,{x:0,y:0},{x:l.x+1,y:l.y+1},f.bitmap))}this.image=d,this.positions=e};var aY,sY,lY,uY=function(){function t(t){this.runtime=t,this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={}}return t.prototype.destroy=function(){this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy()},t.prototype.getMap=function(){return this.glyphMap},t.prototype.getAtlas=function(){return this.glyphAtlas},t.prototype.getAtlasTexture=function(){return this.glyphAtlasTexture},t.prototype.layout=function(t,e,n,r,i,o,a){var s=this,l=[],u=o,c=a,h="right"===r||"end"===r?1:"left"===r||"start"===r?0:.5;return t.forEach((function(t){var r=l.length;Array.from(t).forEach((function(t){var n=s.glyphMap[e],r=t.charCodeAt(0),o=n&&n[r];o&&(l.push({glyph:r,x:u,y:c,scale:1,fontStack:e}),u+=o.metrics.advance+i)}));for(var o=u-i,a=r;a<l.length;a++)l[a].x=l[a].x-h*o;u=0,c+=n})),l},t.prototype.generateAtlas=function(t,e,n,i,o,a,s){var l=this;void 0===e&&(e=""),void 0===o&&(o="");var u=[];this.glyphMap[e]||(u=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}());var c=Object.keys(this.glyphMap[e]||{});if(Array.from(new Set(a.split(""))).forEach((function(t){-1===c.indexOf(t.charCodeAt(0).toString())&&u.push(t)})),u.length){var h=u.map((function(r){return l.generateSDF(t,e,n,i,o,r)})).reduce((function(t,e){return t[e.id]=e,t}),{});this.glyphMap[e]=r(r({},this.glyphMap[e]),h),this.glyphAtlas=new oY(this.glyphMap);var d=this.glyphAtlas.image,f=d.width,p=d.height,g=d.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=s.createTexture(r(r({},pV(fV.ALPHA,f,p,1)),{pixelStore:{unpackFlipY:!1,unpackAlignment:1}})),this.glyphAtlasTexture.setImageData([g])}},t.prototype.generateSDF=function(t,e,n,r,i,o){void 0===e&&(e="");var a=o.charCodeAt(0),s=this.sdfGeneratorCache[e];s||(s=this.sdfGeneratorCache[e]=new LX({canvas:t,fontSize:24,fontFamily:n,fontWeight:r,fontStyle:i,buffer:3,radius:8,cutoff:.25},this.runtime)),this.textMetricsCache[e]||(this.textMetricsCache[e]={}),this.textMetricsCache[e][o]||(this.textMetricsCache[e][o]=s.ctx.measureText(o).width);var l=s.draw(o),u=l.data,c=l.width,h=l.height,d=l.glyphWidth,f=l.glyphHeight,p=l.glyphLeft,g=l.glyphTop,v=l.glyphAdvance;return{id:a,bitmap:new iY({width:c,height:h},u),metrics:{width:d,height:f,left:p,top:g-24+3,advance:v}}},t}();!function(t){t[t.INSTANCED=5]="INSTANCED",t[t.TEX=6]="TEX"}(aY||(aY={})),function(t){t[t.TEX=12]="TEX",t[t.OFFSET=13]="OFFSET"}(sY||(sY={})),function(t){t.SDF_MAP="u_SDFMap",t.SDF_MAP_SIZE="u_SDFMapSize",t.FONT_SIZE="u_FontSize",t.GAMMA_SCALE="u_GammaScale",t.STROKE_BLUR="u_StrokeBlur",t.HAS_STROKE="u_HasStroke"}(lY||(lY={}));var cY=function(t){function e(e,n,r,i,o,a,s){var l=t.call(this,e,n,r,i,o,a,s)||this;return l.renderHelper=e,l.texturePool=n,l.lightPool=r,l.packedBufferObjectMap=new WeakMap,l.tmpMat4=ct(),l.fontHash=l.calcFontHash(i),l.glyphManager=new uY(l.context),l}return n(e,t),e.prototype.calcFontHash=function(t){t.getBounds();return t.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(e,n){return e+t.parsedStyle[n]}),"")},e.prototype.shouldMerge=function(e,n){return!!t.prototype.shouldMerge.call(this,e,n)&&(this.index===n&&this.fontHash===this.calcFontHash(e))},e.prototype.createGeometry=function(t){var e=this,n=this.instance,r=n.parsedStyle,i=r.fontSize,o=void 0===i?16:i,a=r.letterSpacing,s=void 0===a?0:a,c=n.parsedStyle.textBaseline,h=void 0===c?"alphabetic":c,d=24/o,f=[],p=[],g=[],v=[],m=0;t.forEach((function(t){var n=t.parsedStyle,r=n.metrics,i=n.dx,o=void 0===i?0:i,a=n.dy,c=void 0===a?0:a,y=r.font,E=r.lines,_=r.height,b=r.lineHeight,x=o,S=c;e.context.enableCSSParsing||"alphabetic"!==h||(h="bottom");var M=0;"middle"===h?M+=-_/2:"bottom"===h?M+=-_:"top"===h||"hanging"===h?M+=0:"alphabetic"===h?M+=.25*b-_:"ideographic"===h&&(M+=-_);var A=e.glyphManager.getAtlas(),R=e.buildTextBuffers({object:t,lines:E,fontStack:y,lineHeight:d*b,offsetX:d*x,offsetY:d*(M+S),letterSpacing:d*s,glyphAtlas:A,indicesOffset:m}),T=R.indicesOffset,w=R.indexBuffer,P=R.charUVOffsetBuffer,N=R.charPositionsBuffer,C=R.charPackedBuffer;m=T;var O=v.length;v.push.apply(v,u([],l(C),!1));var I=v.length;e.packedBufferObjectMap.set(t,[O,I]),g.push.apply(g,u([],l(P),!1)),p.push.apply(p,u([],l(N),!1)),f.push.apply(f,u([],l(w),!1))})),this.geometry.vertexCount=f.length,this.geometry.setIndexBuffer(new Uint32Array(f)),this.geometry.setVertexBuffer({bufferIndex:aY.INSTANCED,byteStride:128,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGBA,bufferByteOffset:0,location:xX.MODEL_MATRIX0},{format:fV.F32_RGBA,bufferByteOffset:16,location:xX.MODEL_MATRIX1},{format:fV.F32_RGBA,bufferByteOffset:32,location:xX.MODEL_MATRIX2},{format:fV.F32_RGBA,bufferByteOffset:48,location:xX.MODEL_MATRIX3},{format:fV.F32_RGBA,bufferByteOffset:64,location:xX.PACKED_COLOR},{format:fV.F32_RGBA,bufferByteOffset:80,location:xX.PACKED_STYLE1},{format:fV.F32_RGBA,bufferByteOffset:96,location:xX.PACKED_STYLE2},{format:fV.F32_RGBA,bufferByteOffset:112,location:xX.PICKING_COLOR}],data:new Float32Array(v)}),this.geometry.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:12,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.POSITION}],data:new Float32Array(p)}),this.geometry.setVertexBuffer({bufferIndex:aY.TEX,byteStride:16,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:sY.TEX},{format:fV.F32_RG,bufferByteOffset:8,location:sY.OFFSET}],data:new Float32Array(g)})},e.prototype.createMaterial=function(t){var e;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + + bufferOffset;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  if (isBillboard) {\n    float rotation =  a_StylePacked2.w;\n    bool isSizeAttenuation = a_StylePacked2.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position );\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float fontScale = u_FontSize / 24.0;\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = fwidth(dist);\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < epsilon) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=Hz.BACK,this.material.defines=r(r({},this.material.defines),yX(sY));var n=this.instance.parsedStyle,i=n.fontSize,o=void 0===i?16:i,a=n.fontFamily,s=void 0===a?"sans-serif":a,l=n.fontWeight,u=void 0===l?"normal":l,c=n.fontStyle,h=void 0===c?"normal":c,d=n.metrics.font,f=t.map((function(t){return t.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,d,s,u.toString(),h,f,this.context.device);var p=this.glyphManager.getAtlasTexture(),g=this.glyphManager.getAtlas();this.context.device.setResourceName(p,"TextSDF Texture");var v=g.image,m=v.width,y=v.height;this.material.setUniforms(((e={})[lY.SDF_MAP]=p,e[lY.SDF_MAP_SIZE]=[m,y],e[lY.FONT_SIZE]=o,e[lY.GAMMA_SCALE]=1,e[lY.STROKE_BLUR]=.2,e[lY.HAS_STROKE]=this.index,e))},e.prototype.changeRenderOrder=function(t,e){for(var n=this.geometry.vertices[aY.INSTANCED],r=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[aY.INSTANCED].arrayStride/4,i=l(this.packedBufferObjectMap.get(t),2),o=i[0],a=i[1],s=n.slice(o,a),u=0;u<a-o;u+=r)s[u+r-1]=e*pX;this.geometry.updateVertexBuffer(aY.INSTANCED,xX.MODEL_MATRIX0,o/r,new Uint8Array(s.buffer))},e.prototype.updateAttribute=function(t,e,n,r){var i=this;if("text"===n||"fontFamily"===n||"fontSize"===n||"fontWeight"===n||"fontStyle"===n||"fontVariant"===n||"textBaseline"===n||"letterSpacing"===n||"wordWrapWidth"===n||"lineHeight"===n||"wordWrap"===n||"textAlign"===n||"x"===n||"y"===n||"dx"===n||"dy"===n)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===n||"fill"===n||"fillOpacity"===n||"stroke"===n||"strokeOpacity"===n||"opacity"===n||"lineWidth"===n||"visibility"===n||"pointerEvents"===n||"isBillboard"===n||"billboardRotation"===n||"isSizeAttenuation"===n){var o=this.geometry.vertices[aY.INSTANCED],a=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[aY.INSTANCED].arrayStride/4;t.forEach((function(t){var e,n=t.parsedStyle,r=n.fill,s=n.stroke,u=n.opacity,c=void 0===u?1:u,h=n.fillOpacity,d=void 0===h?1:h,f=n.strokeOpacity,p=void 0===f?1:f,g=n.lineWidth,v=void 0===g?1:g,m=n.visibility,y=n.isBillboard,E=n.billboardRotation,_=n.isSizeAttenuation,b=[0,0,0,0];wA(r)&&(b=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]);var x=[0,0,0,0];wA(s)&&(x=[Number(s.r),Number(s.g),Number(s.b),255*Number(s.alpha)]);for(var S=t.isInteractive()&&(null===(e=t.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0],M=dt(i.tmpMat4,t.getWorldTransform()),A=l(i.packedBufferObjectMap.get(t),2),R=A[0],T=A[1],w=o.slice(R,T),P=0;P<T-R;P+=a)w[P+0]=M[0],w[P+1]=M[1],w[P+2]=M[2],w[P+3]=M[3],w[P+4]=M[4],w[P+5]=M[5],w[P+6]=M[6],w[P+7]=M[7],w[P+8]=M[8],w[P+9]=M[9],w[P+10]=M[10],w[P+11]=M[11],w[P+12]=M[12],w[P+13]=M[13],w[P+14]=M[14],w[P+15]=M[15],w[P+16]=_X(b[0],b[1]),w[P+17]=_X(b[2],b[3]),w[P+18]=_X(x[0],x[1]),w[P+19]=_X(x[2],x[3]),w[P+20]=c,w[P+21]=d,w[P+22]=p,w[P+23]=v,w[P+24]="hidden"!==m?1:0,w[P+25]=y?1:0,w[P+26]=_?1:0,w[P+27]=null!=E?E:0,w[P+28]=S[0],w[P+29]=S[1],w[P+30]=S[2];i.geometry.updateVertexBuffer(aY.INSTANCED,xX.MODEL_MATRIX0,R/a,new Uint8Array(w.buffer))}))}},e.prototype.buildTextBuffers=function(t){var e,n=t.object,r=t.lines,i=t.fontStack,o=t.lineHeight,a=t.letterSpacing,s=t.offsetX,c=t.offsetY,h=t.glyphAtlas,d=t.indicesOffset,f=n.parsedStyle,p=f.textAlign,g=void 0===p?"start":p,v=f.fill,m=f.stroke,y=f.opacity,E=void 0===y?1:y,_=f.fillOpacity,b=void 0===_?1:_,x=f.strokeOpacity,S=void 0===x?1:x,M=f.lineWidth,A=void 0===M?1:M,R=f.visibility,T=f.isBillboard,w=f.billboardRotation,P=f.isSizeAttenuation,N=f.x,C=void 0===N?0:N,O=f.y,I=void 0===O?0:O,L=f.z,D=void 0===L?0:L,B=[0,0,0,0];wA(v)&&(B=[Number(v.r),Number(v.g),Number(v.b),255*Number(v.alpha)]);var k=[0,0,0,0];wA(m)&&(k=[Number(m.r),Number(m.g),Number(m.b),255*Number(m.alpha)]);var F=n.isInteractive()&&(null===(e=n.renderable3D)||void 0===e?void 0:e.encodedPickingColor)||[0,0,0],U=dt(this.tmpMat4,n.getWorldTransform()),G=[],z=[],V=[],W=[],j=d,H=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=e[i.fontStack],a=o&&o[i.glyph];if(a){var s=a.rect;if(s){var l=a.metrics.advance*i.scale/2,u=[i.x+l,i.y],c=(a.metrics.left-4)*i.scale-l+u[0],h=(-a.metrics.top-4)*i.scale+u[1],d=c+s.w*i.scale,f=h+s.h*i.scale,p={x:c,y:h},g={x:d,y:h},v={x:c,y:f},m={x:d,y:f};n.push({tl:p,tr:g,bl:v,br:m,tex:s,glyphOffset:[0,0]})}}}return n}(this.glyphManager.layout(r,i,o,g,a,s,c),h.positions);return H.forEach((function(t){var e=[];e.push.apply(e,u([],l(U),!1));var r=u(u(u(u([],l(e),!1),[_X(B[0],B[1]),_X(B[2],B[3]),_X(k[0],k[1]),_X(k[2],k[3]),E,b,S,A,"hidden"!==R?1:0,T?1:0,P?1:0,null!=w?w:0],!1),l(F),!1),[n.sortable.renderOrder*pX],!1);G.push.apply(G,u(u(u(u([],l(r),!1),l(r),!1),l(r),!1),l(r),!1)),z.push(t.tex.x,t.tex.y,t.tl.x,t.tl.y),z.push(t.tex.x+t.tex.w,t.tex.y,t.tr.x,t.tr.y),z.push(t.tex.x+t.tex.w,t.tex.y+t.tex.h,t.br.x,t.br.y),z.push(t.tex.x,t.tex.y+t.tex.h,t.bl.x,t.bl.y),V.push(C,I,D,C,I,D,C,I,D,C,I,D),W.push(0+j,2+j,1+j),W.push(2+j,0+j,3+j),j+=4})),{indexBuffer:W,charUVOffsetBuffer:z,charPositionsBuffer:V,charPackedBuffer:G,indicesOffset:j}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.glyphManager.destroy()},e}(TX),hY=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.mergeXYZIntoModelMatrix=!1,e}return n(e,t),e.prototype.shouldMerge=function(e,n){return!!t.prototype.shouldMerge.call(this,e,n)&&(this.instance.nodeName!==$S.MESH||this.instance.parsedStyle.material===e.parsedStyle.material&&this.instance.parsedStyle.geometry===e.parsedStyle.geometry)},e.prototype.updateAttribute=function(e,n,r,i){t.prototype.updateAttribute.call(this,e,n,r,i),this.updateBatchedAttribute(e,n,r,i)},e.prototype.createMaterial=function(t){var e=this.instance.parsedStyle.material;this.material=e,this.observeMaterialChanged()},e.prototype.createGeometry=function(e){var n=this.instance.parsedStyle.geometry;this.geometry=n,t.prototype.createGeometry.call(this,e),this.geometry.build(e),this.observeGeometryChanged()},e}(TX),dY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(t){var e=[],n=t.parsedStyle.fill;return n&&!n.isNone&&e.push(PX),this.needDrawStrokeSeparately(t)&&e.push(GX),e},e.prototype.needDrawStrokeSeparately=function(t){var e=t.parsedStyle,n=e.fill,r=e.stroke,i=e.lineDash,o=e.lineWidth,a=e.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(t){return 0!==t}));return!s||l&&o>0&&(a<1||u)},e}(gX),fY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(t){var e=t.parsedStyle,n=e.fill,r=e.stroke,i=e.opacity,o=e.strokeOpacity,a=e.lineWidth,s=r&&!r.isNone,l=GX.calcSubpathNum(t),u=[];if(t.nodeName!==$S.POLYLINE&&!(null==n?void 0:n.isNone))for(var c=0;c<l;c++)u.push($X);for(c=0;c<l;c++){if(0!==o&&0!==i&&0!==a&&s)tY.isLine(t,c)?u.push(tY):u.push(GX)}return u},e}(gX);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.getDrawcallCtors=function(){return[]}}(gX);var pY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(){return[eY]},e}(gX),gY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(t){var e=[],n=t.parsedStyle,r=n.stroke,i=n.lineWidth,o=void 0===i?1:i;return!(!r||r.isNone||!o)&&e.push(cY),e.push(cY),e},e.prototype.beforeUploadUBO=function(t,e){var n,r=e.instance.renderable3D.drawcalls.length;e.material.setUniforms(((n={})[lY.HAS_STROKE]=1===r?0:1-e.index,n))},e}(gX),vY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(){return[tY]},e}(gX),mY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(){return[hY]},e}(gX),yY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDrawcallCtors=function(t){var e=[],n=t.parsedStyle,r=n.fill,i=n.radius,o=i&&i.length&&i.some((function(t){return t!==i[0]}));return(null==r?void 0:r.isNone)||o||e.push(PX),o&&e.push($X),(o||this.needDrawStrokeSeparately(t))&&e.push(GX),e},e.prototype.needDrawStrokeSeparately=function(t){var e=t.parsedStyle,n=e.fill,r=e.stroke,i=e.lineDash,o=e.lineWidth,a=e.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(t){return 0!==t}));return!s||l&&o>0&&(a<1||u)},e}(gX),EY=1,_Y=function(){function t(t,e,n,r){this.renderHelper=t,this.rendererFactory=e,this.texturePool=n,this.lightPool=r,this.drawcalls=[],this.pendingUpdatePatches={},this.stencilRefCache={}}return t.prototype.destroy=function(){this.drawcalls.forEach((function(t){t.destroy()})),this.drawcalls=[],this.pendingUpdatePatches={}},t.prototype.render=function(t,e){var n=this;void 0===e&&(e=!1),e||this.updatePendingPatches(),this.drawcalls.forEach((function(r){r.init();var i=r.objects;r.clipPathTarget&&(i=[r.clipPath]);var o=n.renderHelper.renderInstManager.newRenderInst();o.setAllowSkippingIfPipelineNotReady(!1),r.applyRenderInst(o,i),n.renderHelper.renderInstManager.submitRenderInst(o,t),e||r.objects.forEach((function(t){t.renderable.dirty=!1}))}))},t.prototype.attach=function(t){this.context=t},t.prototype.add=function(t){var e=this,n=t.renderable3D;if(n&&!n.drawcalls.length){var r=this.rendererFactory[t.nodeName];r&&r.getDrawcallCtors(t).forEach((function(i,o,a){var s=e.drawcalls.find((function(e){return i===e.constructor&&e.index===o&&e.objects.length<e.maxInstances&&e.shouldMerge(t,o)}));s&&s.key===t.parsedStyle.batchKey||((s=new i(e.renderHelper,e.texturePool,e.lightPool,t,a,o,e.context)).renderer=r,e.drawcalls.push(s),t.parsedStyle.batchKey&&(s.key=t.parsedStyle.batchKey)),s&&(s.objects.push(t),n.drawcalls[o]=s,s.geometryDirty=!0)}))}},t.prototype.remove=function(t){var e=this,n=t.renderable3D;n&&(n.drawcalls.forEach((function(n){if(n){var r=n.objects.indexOf(t);if(r>-1&&(n.objects.splice(r,1),n.geometryDirty=!0),0===n.objects.length)e.drawcalls.splice(e.drawcalls.indexOf(n),1).forEach((function(t){t.destroy()}))}})),n.drawcalls=[])},t.prototype.updateAttribute=function(t,e,n,r){var i=this;void 0===r&&(r=!1);var o=t.renderable3D,a=this.rendererFactory[t.nodeName];if(a){var s=a.getDrawcallCtors(t);if(s.forEach((function(s,l,u){var c=o.drawcalls.find((function(t){return t&&t.index===l&&t.constructor===s}));if(c||((c=o.drawcalls[l])&&(c.objects.splice(c.objects.indexOf(t),1),c.geometryDirty=!0,0===c.objects.length&&i.drawcalls.splice(i.drawcalls.indexOf(c),1),o.drawcalls[o.drawcalls.indexOf(c)]=void 0),(c=i.drawcalls.find((function(e){return s===e.constructor&&e.index===l&&e.objects.length<e.maxInstances&&e.shouldMerge(t,l)})))?c.geometryDirty=!0:((c=new s(i.renderHelper,i.texturePool,i.lightPool,t,u,l,i.context)).renderer=a,c.init(),i.drawcalls.push(c)),c.objects.push(t),o.drawcalls[l]=c),c.inited&&!c.geometryDirty)if(c.shouldMerge(t,l)){var h=c.objects.indexOf(t);if(r)t.parsedStyle[e]=n,c.updateAttribute([t],h,e,n);else{var d=c.id+e;i.pendingUpdatePatches[d]||(i.pendingUpdatePatches[d]={instance:c,objectIndices:[],name:e,value:n}),-1===i.pendingUpdatePatches[d].objectIndices.indexOf(h)&&i.pendingUpdatePatches[d].objectIndices.push(h)}}else i.remove(t),i.add(t);else i.remove(t),i.add(t)})),o.drawcalls.length>s.length)for(var l=o.drawcalls.length-1;l>=s.length;l--){var u=o.drawcalls[l];u.objects.splice(u.objects.indexOf(t),1),u.geometryDirty=!0,0===u.objects.length&&this.drawcalls.splice(this.drawcalls.indexOf(u),1),o.drawcalls.pop()}}},t.prototype.changeRenderOrder=function(t,e){var n=t.renderable3D;n&&n.drawcalls.length&&n.drawcalls.forEach((function(n){n&&n.inited&&!n.geometryDirty&&n.inited&&n.changeRenderOrder(t,e)}))},t.prototype.getStencilRef=function(t){return this.stencilRefCache[t.entity]||(this.stencilRefCache[t.entity]=EY++),this.stencilRefCache[t.entity]},t.prototype.updatePendingPatches=function(){var t=this;Object.keys(this.pendingUpdatePatches).forEach((function(e){var n=t.pendingUpdatePatches[e],r=n.instance,i=n.objectIndices,o=n.name,a=n.value;i.sort((function(t,e){return t-e}));var s=[];i.forEach((function(t){var e=s[s.length-1];e&&t===e[e.length-1]+1?e.push(t):s.push([t])})),s.forEach((function(t){r.updateAttribute(r.objects.slice(t[0],t[0]+t.length),t[0],o,a)}))})),this.pendingUpdatePatches={}},t}(),bY=function(){function t(t,e){this.context=t,this.runtime=e,this.textureCache={}}return t.prototype.getOrCreateTexture=function(t,e,n,i){var o,a=this,s="string"==typeof e?e:e.src||"";if(s&&this.textureCache[s])(o=this.textureCache[s]).emit(eV.LOADED);else if(o=t.createTexture(r({format:fV.U8_RGBA_NORM,width:1,height:1,depthOrArrayLayers:1,mipLevelCount:1,dimension:nV.TEXTURE_2D,usage:rV.SAMPLED,pixelStore:{unpackFlipY:!1}},n)),s&&(this.textureCache[s]=o),N(e)){var l,u=this.context.config.createImage;u?l=u(e):iT&&(l=new window.Image),l&&(l.onload=function(){var t=function(t){a.textureCache[s].setImageData([t]),a.textureCache[s].emit(eV.LOADED),a.context.renderingService.dirtify(),i&&i(a.textureCache[s],t)};a.runtime.globalThis.createImageBitmap?a.runtime.globalThis.createImageBitmap(l).then((function(e){return t(e)})).catch((function(){t(l)})):t(l)},l.onerror=function(){},l.crossOrigin="Anonymous",l.src=e)}else o.setImageData([e]),o.emit(eV.LOADED),this.context.renderingService.dirtify();return o},t.prototype.getOrCreateCanvas=function(){return this.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)},t.prototype.getOrCreateGradient=function(t){var e=t.instance,n=t.gradients,i=e.getGeometryBounds().halfExtents,o=2*i[0]||1,a=2*i[1]||1,s=this.context.config.offscreenCanvas,l=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(s),u=this.runtime.offscreenCanvasCreator.getOrCreateContext(s);l.width=o,l.height=a;var c=this.context.imagePool;n.forEach((function(t){var e=c.getOrCreateGradient(r(r({type:t.type},t.value),{width:o,height:a,min:[0,0]}),u);u.fillStyle=e,u.fillRect(0,0,o,a)}))},t.prototype.getOrCreatePattern=function(t,e,n){var r,i=t.image,o=t.repetition,a=t.transform,s=e.getGeometryBounds().halfExtents,l=2*s[0]||1,u=2*s[1]||1,c=this.context.config.offscreenCanvas,h=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(c),d=this.runtime.offscreenCanvasCreator.getOrCreateContext(c);h.width=l,h.height=u;var f=(r=N(i)?this.context.imagePool.getImageSync(i,n):i)&&d.createPattern(r,o);if(a){var p=LT(_R(a),new Cw({}));f.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12],f:p[13]})}d.fillStyle=f,d.fillRect(0,0,l,u)},t.prototype.destroy=function(){for(var t in this.textureCache)this.textureCache[t].destroy();this.textureCache={}},t}(),xY=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="device-renderer",n.parameters={toneMapping:PH.NONE,toneMappingExposure:1},n}return n(e,t),e.prototype.init=function(t){var e;t.geometryUpdaterFactory[$S.MESH]=new fH;var n=new XH(this.parameters),r=new hH,i=new bY(this.context,t),o=new pH,a=new dY,s=new fY,l=((e={})[$S.CIRCLE]=a,e[$S.ELLIPSE]=a,e[$S.POLYLINE]=s,e[$S.PATH]=s,e[$S.POLYGON]=s,e[$S.RECT]=new yY,e[$S.IMAGE]=new pY,e[$S.LINE]=new vY,e[$S.TEXT]=new gY,e[$S.MESH]=new mY,e[$S.GROUP]=void 0,e[$S.HTML]=void 0,e),u=new _Y(n,l,i,r),c=new dX(n,r,i,u,this.options);this.addRenderingPlugin(c),this.addRenderingPlugin(new fX(n,c,o,u))},e.prototype.destroy=function(t){delete t.geometryUpdaterFactory[$S.MESH]},e.prototype.getRenderGraphPlugin=function(){return this.plugins[0]},e.prototype.getDevice=function(){return this.getRenderGraphPlugin().getDevice()},e.prototype.getSwapChain=function(){return this.getRenderGraphPlugin().getSwapChain()},e.prototype.loadTexture=function(t,e,n){return this.getRenderGraphPlugin().loadTexture(t,e,n)},e.prototype.toDataURL=function(t){return this.getRenderGraphPlugin().toDataURL(t)},e.prototype.setParameters=function(t){this.parameters=r(r({},this.parameters),t)},e}(QS),SY=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e,n)||this;return r.flipYMatrix=At(ct(),$t(1,-1,1)),r.topology=r.createTopology(),r}return n(e,t),e.prototype.applyMa4Position=function(t,e){for(var n=ce(),r=0;r<e.byteLength/4;r+=3)n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=1,he(n,n,t),e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2];this.updateVertexBuffer(bX.POSITION,xX.POSITION,0,new Uint8Array(e.buffer))},e.prototype.applyMa4Normal=function(t,e){var n=ce(),r=dt(ct(),t);mt(r,r),vt(r,r);for(var i=0;i<e.byteLength/4;i+=3)n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=1,he(n,n,r),e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2];this.updateVertexBuffer(bX.NORMAL,xX.NORMAL,0,new Uint8Array(e.buffer))},e.prototype.rebuildPosition=function(){this.topology=this.createTopology();var t=Float32Array.from(this.topology.positions);this.applyMa4Position(this.flipYMatrix,t),this.dirty=!0},e.prototype.applyMat4=function(t){this.applyMa4Position(t,this.vertices[bX.POSITION]),this.applyMa4Normal(t,this.vertices[bX.NORMAL])},e.prototype.computeBoundingBox=function(){for(var t=this.topology.positions,e=-1/0,n=-1/0,r=-1/0,i=1/0,o=1/0,a=1/0,s=0;s<t.length;s+=3){var l=t[s],u=t[s+1],c=t[s+2];e=Math.max(e,l),n=Math.max(n,u),r=Math.max(r,c),i=Math.min(i,l),o=Math.min(o,u),a=Math.min(a,c)}var h=new yM;return h.setMinMax([i,o,a],[e,n,r]),h},e.prototype.build=function(){var t=this.topology,e=t.indices,n=t.positions,r=t.normals,i=t.uvs;this.setIndexBuffer(new Uint32Array(e)),this.vertexCount=e.length,this.setVertexBuffer({bufferIndex:bX.POSITION,byteStride:12,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.POSITION}],data:Float32Array.from(n)}),this.setVertexBuffer({bufferIndex:bX.NORMAL,byteStride:12,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RGB,bufferByteOffset:0,location:xX.NORMAL}],data:Float32Array.from(r)}),this.setVertexBuffer({bufferIndex:bX.UV,byteStride:8,stepMode:tV.VERTEX,attributes:[{format:fV.F32_RG,bufferByteOffset:0,location:xX.UV}],data:Float32Array.from(i)}),this.applyMat4(this.flipYMatrix),this.dirty=!0},e}(sX),MY=4/64,AY=.875;function RY(t,e,n,r,i,o){var a,s,l,u,c,h,d,f,p,g,v,m,y,E,_,b,x,S,M,A=Xt(),R=Xt(),T=Xt(),w=[],P=[],N=[],C=[],O=[];if(n>0)for(a=0;a<=r;a++)for(s=0;s<=i;s++){g=s/i*2*Math.PI-Math.PI,ie(A,p=$t((m=Math.sin(g))*t,-n/2,(v=Math.cos(g))*t),f=$t(m*e,n/2,v*e),a/r),ee(R,se(R,f,p)),ee(T,re(T,$t(v,0,-m),R)),w.push(A[0],A[1],A[2]),P.push(T[0],T[1],T[2]),h=s/i,d=a/r,N.push(h,1-d);var I=d;d=h,h=I,h=(h/=3)*AY+MY,d=d*AY+MY,C.push(h,1-d),a<r&&s<i&&(_=a*(i+1)+s,b=a*(i+1)+(s+1),x=(a+1)*(i+1)+s,S=(a+1)*(i+1)+(s+1),O.push(_,b,x),O.push(b,S,x))}if(o){var L=void 0,D=void 0,B=Math.floor(i/2),k=i,F=n/2;for(L=0;L<=B;L++)for(g=L*Math.PI*.5/B,m=Math.sin(g),v=Math.cos(g),D=0;D<=k;D++)y=2*D*Math.PI/k-Math.PI/2,E=Math.sin(y),l=Math.cos(y)*m,u=v,c=E*m,h=1-D/k,d=1-L/B,w.push(l*e,u*e+F,c*e),P.push(l,u,c),N.push(h,1-d),h=(h/=3)*AY+MY,d=(d/=3)*AY+MY,h+=1/3,C.push(h,1-d);for(M=(r+1)*(i+1),L=0;L<B;++L)for(D=0;D<k;++D)b=(_=L*(k+1)+D)+k+1,O.push(M+_+1,M+b,M+_),O.push(M+_+1,M+b+1,M+b);for(L=0;L<=B;L++)for(g=.5*Math.PI+L*Math.PI*.5/B,m=Math.sin(g),v=Math.cos(g),D=0;D<=k;D++)y=2*D*Math.PI/k-Math.PI/2,E=Math.sin(y),l=Math.cos(y)*m,u=v,c=E*m,h=1-D/k,d=1-L/B,w.push(l*e,u*e-F,c*e),P.push(l,u,c),N.push(h,1-d),h=(h/=3)*AY+MY,d=(d/=3)*AY+MY,h+=2/3,C.push(h,1-d);for(M=(r+1)*(i+1)+(k+1)*(B+1),L=0;L<B;++L)for(D=0;D<k;++D)b=(_=L*(k+1)+D)+k+1,O.push(M+_+1,M+b,M+_),O.push(M+_+1,M+b+1,M+b)}else{if(M=(r+1)*(i+1),t>0)for(a=0;a<i;a++)g=a/i*2*Math.PI,u=-n/2,h=1-((l=Math.sin(g))+1)/2,d=((c=Math.cos(g))+1)/2,w.push(l*t,u,c*t),P.push(0,-1,0),N.push(h,1-d),h=(h/=3)*AY+MY,d=(d/=3)*AY+MY,h+=1/3,C.push(h,1-d),a>1&&O.push(M,M+a,M+a-1);if(M+=i,e>0)for(a=0;a<i;a++)g=a/i*2*Math.PI,u=n/2,h=1-((l=Math.sin(g))+1)/2,d=((c=Math.cos(g))+1)/2,w.push(l*e,u,c*e),P.push(0,1,0),N.push(h,1-d),h=(h/=3)*AY+MY,d=(d/=3)*AY+MY,h+=2/3,C.push(h,1-d),a>1&&O.push(M,M+a-1,M+a)}return{positions:w,normals:P,uvs:N,uvs1:C,indices:O}}var TY,wY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1},n))||this}return n(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.props.width},set:function(t){this.props.width!==t&&(this.props.width=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props.height},set:function(t){this.props.height!==t&&(this.props.height=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.props.depth},set:function(t){this.props.depth!==t&&(this.props.depth=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"widthSegments",{get:function(){return this.props.widthSegments},set:function(t){this.props.widthSegments!==t&&(this.props.widthSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(t){this.props.heightSegments!==t&&(this.props.heightSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthSegments",{get:function(){return this.props.depthSegments},set:function(t){this.props.depthSegments!==t&&(this.props.depthSegments=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t=this.props,e=t.widthSegments,n=void 0===e?1:e,r=t.heightSegments,i=void 0===r?1:r,o=t.depthSegments,a=void 0===o?1:o,s=t.height,l=void 0===s?1:s,u=t.width,c=void 0===u?1:u,h=t.depth,d=n,f=i,p=a,g=c/2,v=l/2,m=(void 0===h?1:h)/2,y=[$t(-g,-v,m),$t(g,-v,m),$t(g,v,m),$t(-g,v,m),$t(g,-v,-m),$t(-g,-v,-m),$t(-g,v,-m),$t(g,v,-m)],E=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],_=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],b=1,x=2,S=3,M=4,A=5,R=[],T=[],w=[],P=[],N=[],C=0,O=function(t,e,n){var r,i,o,a;for(o=0;o<=e;o++)for(a=0;a<=n;a++){var s=Xt(),l=Xt(),u=Xt(),c=Xt();ie(s,y[E[t][0]],y[E[t][1]],o/e),ie(l,y[E[t][0]],y[E[t][2]],a/n),se(u,l,y[E[t][0]]),Qt(c,s,u),r=o/e,i=a/n,R.push(c[0],c[1],c[2]),T.push(_[t][0],_[t][1],_[t][2]),w.push(r,1-i),r=(r/=3)*AY+MY,i=(i/=3)*AY+MY,r+=t%3/3,i+=Math.floor(t/3)/3,P.push(r,1-i),o<e&&a<n&&(N.push(C+n+1,C+1,C),N.push(C+n+1,C+n+2,C+1)),C++}};return O(0,d,f),O(b,d,f),O(x,d,p),O(S,d,p),O(M,p,f),O(A,p,f),{indices:N,positions:R,normals:T,uvs:w,uv1s:P}},e}(SY),PY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({radius:.5,latitudeBands:16,longitudeBands:16},n))||this}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this.props.radius},set:function(t){this.props.radius!==t&&(this.props.radius=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"latitudeBands",{get:function(){return this.props.latitudeBands},set:function(t){this.props.latitudeBands!==t&&(this.props.latitudeBands=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitudeBands",{get:function(){return this.props.longitudeBands},set:function(t){this.props.longitudeBands!==t&&(this.props.longitudeBands=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t,e,n,r,i,o,a,s,l,u,c,h,d,f,p=this.props,g=p.radius,v=void 0===g?.5:g,m=p.latitudeBands,y=void 0===m?16:m,E=p.longitudeBands,_=void 0===E?16:E,b=[],x=[],S=[],M=[];for(e=0;e<=y;e++)for(n=e*Math.PI/y,r=Math.sin(n),i=Math.cos(n),t=0;t<=_;t++)o=2*t*Math.PI/_-Math.PI/2,a=Math.sin(o),u=Math.cos(o)*r,c=i,h=a*r,d=1-t/_,f=1-e/y,b.push(u*v,c*v,h*v),x.push(u,c,h),S.push(d,1-f);for(e=0;e<y;++e)for(t=0;t<_;++t)l=(s=e*(_+1)+t)+_+1,M.push(s+1,l,s),M.push(s+1,l+1,l);return{indices:M,positions:b,normals:x,uvs:S,uv1s:S}},e}(SY),NY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({tubeRadius:.2,ringRadius:.3,segments:30,sides:20},n))||this}return n(e,t),Object.defineProperty(e.prototype,"tubeRadius",{get:function(){return this.props.tubeRadius},set:function(t){this.props.tubeRadius!==t&&(this.props.tubeRadius=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringRadius",{get:function(){return this.props.ringRadius},set:function(t){this.props.ringRadius!==t&&(this.props.ringRadius=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"segments",{get:function(){return this.props.segments},set:function(t){this.props.segments!==t&&(this.props.segments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sides",{get:function(){return this.props.sides},set:function(t){this.props.sides!==t&&(this.props.sides=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t,e,n,r,i,o,a,s,l,u,c=this.props,h=c.tubeRadius,d=void 0===h?.2:h,f=c.ringRadius,p=void 0===f?.3:f,g=c.segments,v=void 0===g?30:g,m=c.sides,y=void 0===m?20:m,E=d,_=p,b=[],x=[],S=[],M=[];for(l=0;l<=y;l++)for(u=0;u<=v;u++)if(t=Math.cos(2*Math.PI*u/v)*(_+E*Math.cos(2*Math.PI*l/y)),e=Math.sin(2*Math.PI*l/y)*E,n=Math.sin(2*Math.PI*u/v)*(_+E*Math.cos(2*Math.PI*l/y)),r=Math.cos(2*Math.PI*u/v)*Math.cos(2*Math.PI*l/y),i=Math.sin(2*Math.PI*l/y),o=Math.sin(2*Math.PI*u/v)*Math.cos(2*Math.PI*l/y),a=l/y,s=1-u/v,b.push(t,e,n),x.push(r,i,o),S.push(a,1-s),l<y&&u<v){var A=l*(v+1)+u,R=(l+1)*(v+1)+u,T=l*(v+1)+(u+1),w=(l+1)*(v+1)+(u+1);M.push(A,R,T),M.push(R,w,T)}return{indices:M,positions:b,normals:x,uvs:S,uv1s:S}},e}(SY),CY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({width:1,depth:1,widthSegments:5,depthSegments:5},n))||this}return n(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.props.width},set:function(t){this.props.width!==t&&(this.props.width=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.props.depth},set:function(t){this.props.depth!==t&&(this.props.depth=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"widthSegments",{get:function(){return this.props.widthSegments},set:function(t){this.props.widthSegments!==t&&(this.props.widthSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthSegments",{get:function(){return this.props.depthSegments},set:function(t){this.props.depthSegments!==t&&(this.props.depthSegments=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t,e,n,r,i,o,a=[],s=[],l=[],u=[],c=this.props,h=c.widthSegments,d=void 0===h?5:h,f=c.depthSegments,p=void 0===f?5:f,g=c.width,v=void 0===g?1:g,m=c.depth,y=v/2,E=(void 0===m?1:m)/2,_=d,b=p,x=0;for(t=0;t<=_;t++)for(e=0;e<=b;e++)n=2*y*t/_-y,0,r=-(2*E*e/b-E),i=t/_,o=e/b,a.push(n,0,r),s.push(0,1,0),l.push(i,1-o),t<_&&e<b&&(u.push(x+b+1,x+1,x),u.push(x+b+1,x+b+2,x+1)),x++;return{indices:u,positions:a,normals:s,uvs:l,uv1s:l}},e}(SY),OY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({radius:.5,height:1,heightSegments:5,capSegments:20},n))||this}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this.props.radius},set:function(t){this.props.radius!==t&&(this.props.radius=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props.height},set:function(t){this.props.height!==t&&(this.props.height=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(t){this.props.heightSegments!==t&&(this.props.heightSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capSegments",{get:function(){return this.props.capSegments},set:function(t){this.props.capSegments!==t&&(this.props.capSegments=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t=this.props,e=t.radius,n=RY(e,e,t.height,t.heightSegments,t.capSegments,!1);return{indices:n.indices,positions:n.positions,normals:n.normals,uvs:n.uvs,uv1s:n.uvs1}},e}(SY),IY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({baseRadius:.5,peakRadius:0,height:1,heightSegments:5,capSegments:18},n))||this}return n(e,t),Object.defineProperty(e.prototype,"baseRadius",{get:function(){return this.props.baseRadius},set:function(t){this.props.baseRadius!==t&&(this.props.baseRadius=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peakRadius",{get:function(){return this.props.peakRadius},set:function(t){this.props.peakRadius!==t&&(this.props.peakRadius=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props.height},set:function(t){this.props.height!==t&&(this.props.height=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(t){this.props.heightSegments!==t&&(this.props.heightSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capSegments",{get:function(){return this.props.capSegments},set:function(t){this.props.capSegments!==t&&(this.props.capSegments=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t=this.props,e=RY(t.baseRadius,t.peakRadius,t.height,t.heightSegments,t.capSegments,!1);return{indices:e.indices,positions:e.positions,normals:e.normals,uvs:e.uvs,uv1s:e.uvs1}},e}(SY),LY=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,r({radius:.5,height:1,heightSegments:1,sides:20},n))||this}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this.props.radius},set:function(t){this.props.radius!==t&&(this.props.radius=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props.height},set:function(t){this.props.height!==t&&(this.props.height=t,this.rebuildPosition())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightSegments",{get:function(){return this.props.heightSegments},set:function(t){this.props.heightSegments!==t&&(this.props.heightSegments=t,this.build())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sides",{get:function(){return this.props.sides},set:function(t){this.props.sides!==t&&(this.props.sides=t,this.build())},enumerable:!1,configurable:!0}),e.prototype.createTopology=function(){var t=this.props,e=t.radius,n=RY(e,e,t.height-2*e,t.heightSegments,t.sides,!0);return{indices:n.indices,positions:n.positions,normals:n.normals,uvs:n.uvs,uv1s:n.uvs1}},e}(SY),DY=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,r({style:r({fill:"black"},o)},a))||this).define="NUM_AMBIENT_LIGHTS",n.order=-1,n}return n(e,t),e.prototype.uploadUBO=function(t,e){var n=this.parsedStyle.fill;if(wA(n)){var r=[Number(n.r)/255,Number(n.g)/255,Number(n.b)/255];t.push({name:"u_AmbientLightColor",value:r})}},e}(eX),BY=function(t){function e(e){void 0===e&&(e={});var n=this,o=e.style,a=i(e,["style"]);return(n=t.call(this,r({style:r({direction:$t(0,-1,0)},o)},a))||this).define="NUM_DIR_LIGHTS",n.order=10,n}return n(e,t),e.prototype.getUniformWordCount=function(){return 8},e.prototype.uploadUBO=function(t,e){var n=this.parsedStyle,r=n.fill,i=n.direction,o=n.intensity;if(wA(r)){var a=[Number(r.r)/255,Number(r.g)/255,Number(r.b)/255];t.push({name:"directionalLights[".concat(e,"].direction"),value:i}),t.push({name:"directionalLights[".concat(e,"].intensity"),value:o}),t.push({name:"directionalLights[".concat(e,"].color"),value:a})}},e}(eX);!function(t){t.MAP="u_Map",t.PLACE_HOLDER="u_Placeholder"}(TY||(TY={}));var kY,FY=function(t){function e(e,n){var i,o=t.call(this,e,r({vertexShader:"#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec4 u_Placeholder;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nvoid main() {\n  // WGSL will remove unused uniforms.\n  float a = u_Placeholder.x;\n\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  gl_Position = project(vec4(a_Position, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec4 u_Placeholder;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n    vec4 diffuseColor = outputColor;\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    reflectedLight.indirectDiffuse += vec3( 1.0 );\n    reflectedLight.indirectDiffuse *= outputColor.rgb;\n\n    vec3 outgoingLight = reflectedLight.indirectDiffuse;\n    \n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",cullMode:Hz.BACK},n))||this;o.defines=r(r({},o.defines),{USE_UV:!0,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1});var a=n||{},s=a.map,l=a.wireframe;return s&&(o.map=s),o.wireframe=l,o.setUniforms(((i={})[TY.PLACE_HOLDER]=[0,0,0,0],i)),o}return n(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this.props.map},set:function(t){var e;this.props.map!==t&&(this.props.map=t,this.programDirty=!0),this.setUniforms(((e={})[TY.MAP]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aoMap",{get:function(){return this.props.aoMap},set:function(t){this.props.aoMap=t},enumerable:!1,configurable:!0}),e}(vX);!function(t){t.EMISSIVE="u_Emissive",t.SHININESS="u_Shininess",t.SPECULAR="u_Specular",t.BUMP_SCALE="u_BumpScale",t.SPECULAR_MAP="u_SpecularMap",t.BUMP_MAP="u_BumpMap"}(kY||(kY={}));var UY,GY=function(t){function e(e,n){var i,o=t.call(this,e,r({vertexShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n  float u_Shininess;\n  vec3 u_Specular;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = NORMAL) in vec3 a_Normal;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nout vec3 v_ViewPosition;\nout vec3 v_Normal;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec4 position = vec4(a_Position, 1.0);\n\n  gl_Position = project(position, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * position;\n  v_ViewPosition = - mvPosition.xyz;\n\n  // v_ViewPosition = vec3(mvPosition) / mvPosition.w;\n\n  mat3 normalWorld = mat3(transposeMat3(inverseMat3(mat3(u_ViewMatrix * u_ModelMatrix))));\n  v_Normal = normalize(normalWorld * a_Normal);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n  float u_Shininess;\n  vec3 u_Specular;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#if defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  uniform sampler2D u_BumpMap;\n\n  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n  vec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( v_Uv );\n    vec2 dSTdy = dFdy( v_Uv );\n\n    float Hll = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv ).x;\n    float dBx = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdx ).x - Hll;\n    float dBy = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdy ).x - Hll;\n\n    return vec2( dBx, dBy );\n  }\n\n  vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n  }\n#endif\n#ifdef USE_SPECULARMAP\n  uniform sampler2D u_SpecularMap;\n#endif\nvec3 BRDF_Lambert(vec3 diffuseColor) {\n  return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(\n  vec3 f0,\n  float f90,\n  float dotVH\n) {\n  // Original approximation by Christophe Schlick '94\n  // float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n  // Optimized variant (presented by Epic at SIGGRAPH '13)\n  // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n  float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n  return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\n\nfloat G_BlinnPhong_Implicit( /* float dotNL, float dotNV */ ) {\n  // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n  return 0.25;\n}\n\nfloat D_BlinnPhong(\n  float shininess,\n  float dotNH\n) {\n  return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\n\nvec3 BRDF_BlinnPhong(\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 normal,\n  vec3 specularColor,\n  float shininess\n) {\n  vec3 halfDir = normalize( lightDir + viewDir );\n\n  float dotNH = saturate( dot( normal, halfDir ) );\n  float dotVH = saturate( dot( viewDir, halfDir ) );\n\n  vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n  float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n  float D = D_BlinnPhong( shininess, dotNH );\n\n  return F * ( G * D );\n}\n\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\n#ifdef USE_LIGHT\n  void getDirectionalLightInfo(\n    DirectionalLight directionalLight, \n    GeometricContext geometry,\n    out IncidentLight light\n  ) {\n    light.color = directionalLight.color * directionalLight.intensity;\n    light.direction = normalize(directionalLight.direction);\n    light.visible = true;\n  }\n\n  vec3 getAmbientLightIrradiance( vec3 ambientLightColor ) {\n    vec3 irradiance = ambientLightColor;\n    return irradiance;\n  }\n#endif\nstruct BlinnPhongMaterial {\n  vec3 diffuseColor;\n  vec3 specularColor;\n  float specularShininess;\n  float specularStrength;\n};\n\nvoid RE_Direct_BlinnPhong(\n  IncidentLight directLight,\n  GeometricContext geometry,\n  BlinnPhongMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  float dotNL = saturate(dot(geometry.normal, directLight.direction));\n  vec3 irradiance = dotNL * directLight.color;\n\n  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong(\n  vec3 irradiance,\n  GeometricContext geometry,\n  BlinnPhongMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\n#define RE_Direct           RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse  RE_IndirectDiffuse_BlinnPhong\n\nin vec3 v_ViewPosition;\nin vec3 v_Normal;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  // diffusemap\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n  // specularmap\n  float specularStrength = 1.0;\n\n#ifdef USE_SPECULARMAP\n  vec4 texelSpecular = texture(SAMPLER_2D(u_SpecularMap), v_Uv);\n  specularStrength = texelSpecular.r;\n#endif\n  // bumpmap & normalmap\n  float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\nvec3 normal = normalize(v_Normal);\n#ifdef USE_DOUBLESIDE\n  normal = normal * faceDirection;\n#endif\n\n// #ifdef USE_TANGENT\n//   vec3 tangent = normalize( vTangent );\n//   vec3 bitangent = normalize( vBitangent );\n\n//   #ifdef DOUBLE_SIDED\n//     tangent = tangent * faceDirection;\n//     bitangent = bitangent * faceDirection;\n//   #endif\n\n// #if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n// mat3 vTBN = mat3( tangent, bitangent, normal );\n\n// #endif\n// #endif\n  #ifdef OBJECTSPACE_NORMALMAP\n  // normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n  // #ifdef FLIP_SIDED\n  //   normal = - normal;\n  // #endif\n\n  // #ifdef DOUBLE_SIDED\n  //   normal = normal * faceDirection;\n  // #endif\n\n  // normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n  // vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n  // mapN.xy *= normalScale;\n\n  // #ifdef USE_TANGENT\n  //   normal = normalize( vTBN * mapN );\n  // #else\n  //   normal = perturbNormal2Arb( - v_ViewPosition, normal, mapN, faceDirection );\n  // #endif\n\n#elif defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  normal = perturbNormalArb( - v_ViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    vec4 diffuseColor = outputColor;\n    ReflectedLight reflectedLight = ReflectedLight(vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\n    vec3 totalEmissiveRadiance = u_Emissive;\n\n    // calculate lighting accumulation\n    BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = u_Specular;\nmaterial.specularShininess = u_Shininess;\nmaterial.specularStrength = specularStrength;\n    GeometricContext geometry;\ngeometry.position = - v_ViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = u_IsOrtho == 1.0 ? vec3(0, 0, 1) : normalize(v_ViewPosition);\n\nIncidentLight directLight;\n#if defined( NUM_DIR_LIGHTS ) && ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n    DirectionalLightShadow directionalLightShadow;\n  #endif\n\n  #pragma unroll_loop_start\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n    directionalLight = directionalLights[ i ];\n\n    getDirectionalLightInfo( directionalLight, geometry, directLight );\n\n    #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n      directionalLightShadow = directionalLightShadows[ i ];\n      directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n  #pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n  vec3 iblIrradiance = vec3(0.0);\n  vec3 ambient = vec3(0.0);\n  #ifdef NUM_AMBIENT_LIGHTS\n    ambient = u_AmbientLightColor;\n  #endif\n  vec3 irradiance = getAmbientLightIrradiance(ambient);\n\n  // irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n  // #if ( NUM_HEMI_LIGHTS > 0 )\n  //   #pragma unroll_loop_start\n  //   for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n  //     irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n  //   }\n  //   #pragma unroll_loop_end\n  // #endif\n#endif\n\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearcoatRadiance = vec3( 0.0 );\n#endif\n\n    #if defined( RE_IndirectDiffuse )\n  RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n\n#if defined( RE_IndirectSpecular )\n  RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif\n\n    vec3 outgoingLight = reflectedLight.directDiffuse +\n      reflectedLight.indirectDiffuse + \n      reflectedLight.directSpecular + \n      reflectedLight.indirectSpecular + \n      totalEmissiveRadiance;\n\n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",emissive:"black",shininess:30,specular:"#111111",bumpScale:1,doubleSide:!1},n))||this,a=o,s=a.specularMap,l=a.bumpMap,u=a.doubleSide,c=a.emissive,h=a.shininess,d=a.specular,f=PA(c),p=PA(d);return o.setUniforms(((i={u_Placeholder:null})[kY.EMISSIVE]=[Number(f.r)/255,Number(f.g)/255,Number(f.b)/255],i[kY.SHININESS]=h,i[kY.SPECULAR]=[Number(p.r)/255,Number(p.g)/255,Number(p.b)/255],i)),s&&(o.specularMap=s),l&&(o.bumpMap=l),o.doubleSide=u,o.defines=r(r({},o.defines),{USE_LIGHT:!0}),o}return n(e,t),Object.defineProperty(e.prototype,"emissive",{get:function(){return this.props.emissive},set:function(t){var e;this.props.emissive=t;var n=PA(t);this.setUniforms(((e={})[kY.EMISSIVE]=[Number(n.r)/255,Number(n.g)/255,Number(n.b)/255],e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shininess",{get:function(){return this.props.shininess},set:function(t){var e;this.props.shininess=t,this.setUniforms(((e={})[kY.SHININESS]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"specular",{get:function(){return this.props.specular},set:function(t){var e;this.props.specular=t;var n=PA(t);this.setUniforms(((e={})[kY.SPECULAR]=[Number(n.r)/255,Number(n.g)/255,Number(n.b)/255],e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"specularMap",{get:function(){return this.props.specularMap},set:function(t){var e;this.props.map!==t&&(this.props.specularMap=t,this.programDirty=!0),this.defines.USE_SPECULARMAP=!!t,this.setUniforms(((e={})[kY.SPECULAR_MAP]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bumpMap",{get:function(){return this.props.bumpMap},set:function(t){var e;this.props.map!==t&&(this.props.bumpMap=t,this.programDirty=!0),this.defines.USE_BUMPMAP=!!t,this.setUniforms(((e={})[kY.BUMP_MAP]=t,e[kY.BUMP_SCALE]=this.bumpScale,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bumpScale",{get:function(){return this.props.bumpScale},set:function(t){var e;this.props.bumpScale=t,this.setUniforms(((e={})[kY.BUMP_SCALE]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doubleSide",{get:function(){return this.props.doubleSide},set:function(t){this.props.doubleSide=t,this.defines.USE_DOUBLESIDE=t},enumerable:!1,configurable:!0}),e}(FY);!function(t){t.EMISSIVE="u_Emissive",t.BUMP_SCALE="u_BumpScale",t.BUMP_MAP="u_BumpMap"}(UY||(UY={}));var zY,VY=function(t){function e(e,n){var i,o=t.call(this,e,r({vertexShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = NORMAL) in vec3 a_Normal;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nout vec3 v_ViewPosition;\nout vec3 v_Normal;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec4 position = vec4(a_Position, 1.0);\n\n  gl_Position = project(position, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * position;\n  v_ViewPosition = - mvPosition.xyz;\n\n  // v_ViewPosition = vec3(mvPosition) / mvPosition.w;\n\n  mat3 normalWorld = mat3(transposeMat3(inverseMat3(mat3(u_ViewMatrix * u_ModelMatrix))));\n  v_Normal = normalize(normalWorld * a_Normal);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  vec3 u_Emissive;\n\n  #ifdef USE_LIGHT\n    #ifdef USE_BUMPMAP\n      float u_BumpScale;\n    #endif\n\n    #ifdef NUM_AMBIENT_LIGHTS\n      vec3 u_AmbientLightColor;\n    #endif\n\n    #ifdef NUM_DIR_LIGHTS\n      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n    #endif\n  #endif\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#if defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  uniform sampler2D u_BumpMap;\n\n  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n  vec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( v_Uv );\n    vec2 dSTdy = dFdy( v_Uv );\n\n    float Hll = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv ).x;\n    float dBx = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdx ).x - Hll;\n    float dBy = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdy ).x - Hll;\n\n    return vec2( dBx, dBy );\n  }\n\n  vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n  }\n#endif\n#ifdef USE_SPECULARMAP\n  uniform sampler2D u_SpecularMap;\n#endif\nvec3 BRDF_Lambert(vec3 diffuseColor) {\n  return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(\n  vec3 f0,\n  float f90,\n  float dotVH\n) {\n  // Original approximation by Christophe Schlick '94\n  // float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n  // Optimized variant (presented by Epic at SIGGRAPH '13)\n  // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n  float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n  return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\n\nfloat G_BlinnPhong_Implicit( /* float dotNL, float dotNV */ ) {\n  // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n  return 0.25;\n}\n\nfloat D_BlinnPhong(\n  float shininess,\n  float dotNH\n) {\n  return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\n\nvec3 BRDF_BlinnPhong(\n  vec3 lightDir,\n  vec3 viewDir,\n  vec3 normal,\n  vec3 specularColor,\n  float shininess\n) {\n  vec3 halfDir = normalize( lightDir + viewDir );\n\n  float dotNH = saturate( dot( normal, halfDir ) );\n  float dotVH = saturate( dot( viewDir, halfDir ) );\n\n  vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n  float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n  float D = D_BlinnPhong( shininess, dotNH );\n\n  return F * ( G * D );\n}\n\n#ifdef USE_WIREFRAME\n  in vec3 v_Barycentric;\n\n  float edgeFactor() {\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n  }\n#endif\n\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\n#ifdef USE_LIGHT\n  void getDirectionalLightInfo(\n    DirectionalLight directionalLight, \n    GeometricContext geometry,\n    out IncidentLight light\n  ) {\n    light.color = directionalLight.color * directionalLight.intensity;\n    light.direction = normalize(directionalLight.direction);\n    light.visible = true;\n  }\n\n  vec3 getAmbientLightIrradiance( vec3 ambientLightColor ) {\n    vec3 irradiance = ambientLightColor;\n    return irradiance;\n  }\n#endif\nstruct LambertMaterial {\n  vec3 diffuseColor;\n  float specularStrength;\n};\n\nvoid RE_Direct_Lambert(\n  IncidentLight directLight,\n  GeometricContext geometry,\n  LambertMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  float dotNL = saturate(dot(geometry.normal, directLight.direction));\n  vec3 irradiance = dotNL * directLight.color;\n\n  reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Lambert(\n  vec3 irradiance,\n  GeometricContext geometry,\n  LambertMaterial material,\n  inout ReflectedLight reflectedLight\n) {\n  reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n\nin vec3 v_ViewPosition;\nin vec3 v_Normal;\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  // diffusemap\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n  // specularmap\n  float specularStrength = 1.0;\n\n#ifdef USE_SPECULARMAP\n  vec4 texelSpecular = texture(SAMPLER_2D(u_SpecularMap), v_Uv);\n  specularStrength = texelSpecular.r;\n#endif\n  // bumpmap & normalmap\n  float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\nvec3 normal = normalize(v_Normal);\n#ifdef USE_DOUBLESIDE\n  normal = normal * faceDirection;\n#endif\n\n// #ifdef USE_TANGENT\n//   vec3 tangent = normalize( vTangent );\n//   vec3 bitangent = normalize( vBitangent );\n\n//   #ifdef DOUBLE_SIDED\n//     tangent = tangent * faceDirection;\n//     bitangent = bitangent * faceDirection;\n//   #endif\n\n// #if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n// mat3 vTBN = mat3( tangent, bitangent, normal );\n\n// #endif\n// #endif\n  #ifdef OBJECTSPACE_NORMALMAP\n  // normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n  // #ifdef FLIP_SIDED\n  //   normal = - normal;\n  // #endif\n\n  // #ifdef DOUBLE_SIDED\n  //   normal = normal * faceDirection;\n  // #endif\n\n  // normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n  // vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n  // mapN.xy *= normalScale;\n\n  // #ifdef USE_TANGENT\n  //   normal = normalize( vTBN * mapN );\n  // #else\n  //   normal = perturbNormal2Arb( - v_ViewPosition, normal, mapN, faceDirection );\n  // #endif\n\n#elif defined(USE_BUMPMAP) && defined(USE_LIGHT)\n  normal = perturbNormalArb( - v_ViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    vec4 diffuseColor = outputColor;\n    ReflectedLight reflectedLight = ReflectedLight(vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\n    vec3 totalEmissiveRadiance = u_Emissive;\n\n    // calculate lighting accumulation\n    LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;\n    GeometricContext geometry;\ngeometry.position = - v_ViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = u_IsOrtho == 1.0 ? vec3(0, 0, 1) : normalize(v_ViewPosition);\n\nIncidentLight directLight;\n#if defined( NUM_DIR_LIGHTS ) && ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n    DirectionalLightShadow directionalLightShadow;\n  #endif\n\n  #pragma unroll_loop_start\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n    directionalLight = directionalLights[ i ];\n\n    getDirectionalLightInfo( directionalLight, geometry, directLight );\n\n    #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n      directionalLightShadow = directionalLightShadows[ i ];\n      directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n  #pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n  vec3 iblIrradiance = vec3(0.0);\n  vec3 ambient = vec3(0.0);\n  #ifdef NUM_AMBIENT_LIGHTS\n    ambient = u_AmbientLightColor;\n  #endif\n  vec3 irradiance = getAmbientLightIrradiance(ambient);\n\n  // irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n  // #if ( NUM_HEMI_LIGHTS > 0 )\n  //   #pragma unroll_loop_start\n  //   for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n  //     irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n  //   }\n  //   #pragma unroll_loop_end\n  // #endif\n#endif\n\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearcoatRadiance = vec3( 0.0 );\n#endif\n\n    #if defined( RE_IndirectDiffuse )\n  RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n\n#if defined( RE_IndirectSpecular )\n  RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif\n\n    vec3 outgoingLight = reflectedLight.directDiffuse +\n      reflectedLight.indirectDiffuse + \n      totalEmissiveRadiance;\n\n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_WIREFRAME\n  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));\n  outputColor.xyz = color;\n#endif\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",emissive:"black",bumpScale:1,doubleSide:!1},n))||this,a=o,s=a.bumpMap,l=a.doubleSide,u=a.emissive,c=PA(u);return o.setUniforms(((i={u_Placeholder:null})[UY.EMISSIVE]=[Number(c.r)/255,Number(c.g)/255,Number(c.b)/255],i)),s&&(o.bumpMap=s),o.doubleSide=l,o.defines=r(r({},o.defines),{USE_LIGHT:!0}),o}return n(e,t),Object.defineProperty(e.prototype,"emissive",{get:function(){return this.props.emissive},set:function(t){var e;this.props.emissive=t;var n=PA(t);this.setUniforms(((e={})[UY.EMISSIVE]=[Number(n.r)/255,Number(n.g)/255,Number(n.b)/255],e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bumpMap",{get:function(){return this.props.bumpMap},set:function(t){var e;this.props.map!==t&&(this.props.bumpMap=t,this.programDirty=!0),this.defines.USE_BUMPMAP=!!t,this.setUniforms(((e={})[UY.BUMP_MAP]=t,e[UY.BUMP_SCALE]=this.bumpScale,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bumpScale",{get:function(){return this.props.bumpScale},set:function(t){var e;this.props.bumpScale=t,this.setUniforms(((e={})[UY.BUMP_SCALE]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doubleSide",{get:function(){return this.props.doubleSide},set:function(t){this.props.doubleSide=t,this.defines.USE_DOUBLESIDE=t},enumerable:!1,configurable:!0}),e}(FY);!function(t){t.MAP="u_Map",t.PLACE_HOLDER="u_Placeholder",t.SIZE="u_Size"}(zY||(zY={}));var WY=function(t){function e(e,n){var i,o=t.call(this,e,r({vertexShader:"#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  float u_Size;\n  vec4 u_Placeholder;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\n#ifdef USE_WIREFRAME\n  layout(location = BARYCENTRIC) in vec3 a_Barycentric;\n  out vec3 v_Barycentric;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  gl_PointSize = u_Size;\n  gl_Position = project(vec4(a_Position, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  #ifdef USE_WIREFRAME\n  v_Barycentric = a_Barycentric;\n#endif\n\n}",fragmentShader:"#define GLSLIFY 1\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n  #define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( float x ) { return x*x; }\nfloat pow3( float x ) { return x*x*x; }\nfloat pow4( float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( vec2 uv ) {\n  const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n  return fract( sin( sn ) * c );\n}\n\nmat3 transposeMat3(mat3 inMatrix) {\n  vec3 i0 = inMatrix[0];\n  vec3 i1 = inMatrix[1];\n  vec3 i2 = inMatrix[2];\n\n  mat3 outMatrix = mat3(\n    vec3(i0.x, i1.x, i2.x),\n    vec3(i0.y, i1.y, i2.y),\n    vec3(i0.z, i1.z, i2.z)\n    );\n\n  return outMatrix;\n}\n\n// https://github.com/glslify/glsl-inverse/blob/master/index.glsl\nmat3 inverseMat3(mat3 inMatrix) {\n  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];\n  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];\n  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nstruct DirectionalLight {\n  vec3 direction;\n  float intensity;\n  vec3 color;\n};\n\nstruct IncidentLight {\n  vec3 color;\n  vec3 direction;\n  bool visible;\n};\n\nstruct ReflectedLight {\n  vec3 directDiffuse;\n  vec3 directSpecular;\n  vec3 indirectDiffuse;\n  vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n  vec3 position;\n  vec3 normal;\n  vec3 viewDir;\n};\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(std140) uniform ub_MaterialParams {\n  #ifdef USE_WIREFRAME\n    vec3 u_WireframeLineColor;\n    float u_WireframeLineWidth;\n  #endif\n\n  #ifdef USE_FOG\n    vec4 u_FogInfos;\n    vec3 u_FogColor;\n  #endif\n\n  float u_Size;\n  vec4 u_Placeholder;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n#ifdef USE_FOG\n  #define FOGMODE_NONE 0.\n  #define FOGMODE_EXP 1.\n  #define FOGMODE_EXP2 2.\n  #define FOGMODE_LINEAR 3.\n\n  // in float v_FogDepth;\n\n  float dBlendModeFogFactor = 1.0;\n\n  vec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    // float depth = v_FogDepth;\n    float fogFactor;\n    float fogStart = u_FogInfos.y;\n    float fogEnd = u_FogInfos.z;\n    float fogDensity = u_FogInfos.w;\n\n    if (u_FogInfos.x == FOGMODE_NONE) {\n      fogFactor = 1.0;\n    } else if (u_FogInfos.x == FOGMODE_EXP) {\n      fogFactor = exp(-depth * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_EXP2) {\n      fogFactor = exp(-depth * depth * fogDensity * fogDensity);\n    } else if (u_FogInfos.x == FOGMODE_LINEAR) {\n      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);\n    }\n\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);\n  }\n#endif\n\nout vec4 outputColor;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  vec2 uv = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);\n\tvec4 mapTexel = texture(SAMPLER_2D(u_Map), uv);\n  u_Color *= mapTexel;\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n    vec4 diffuseColor = outputColor;\n\n    vec3 outgoingLight = diffuseColor.rgb;\n    \n    outputColor = vec4(outgoingLight, diffuseColor.a);\n\n    #ifdef USE_FOG\n  outputColor.rgb = addFog(outputColor.rgb);\n#endif\n  }\n}",cullMode:Hz.BACK},n))||this;o.defines=r(r({},o.defines),{USE_UV:!0,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1});var a=n||{},s=a.map,l=a.size;return s&&(o.map=s),o.setUniforms(((i={})[zY.PLACE_HOLDER]=[0,0,0,0],i[zY.SIZE]=l||1,i)),o}return n(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this.props.map},set:function(t){var e;this.props.map!==t&&(this.props.map=t,this.programDirty=!0),this.setUniforms(((e={})[zY.MAP]=t,e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.props.size},set:function(t){var e;this.props.size=t,this.setUniforms(((e={})[zY.SIZE]=t,e))},enumerable:!1,configurable:!0}),e}(vX),jY=function(t){function e(){var e=t.apply(this,u([],l(arguments),!1))||this;return e.name="3d",e}return n(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){},e}(QS);const HY=new Map;function XY(t,e){if(!e)return;if(HY.has(e))return HY.get(e);const n=t.loadTexture(e);return HY.set(e,n),n}const YY=new class{map=new Map;has(t,e){return this.map.has(t)&&this.map.get(t).has(e)}get(t,e){return this.map.get(t)?.get(e)}set(t,e,n){this.map.has(t)||this.map.set(t,new Map),this.map.get(t).set(e,n)}},KY={basic:FY,point:WY,lambert:VY,phong:GY};function $Y(t,e,n){const r=function(t){const e=Object.entries(t);if(e.some((([,t])=>"object"==typeof t)))return Symbol();const n=e.sort(((t,e)=>t[0].localeCompare(e[0]))).map((([t,e])=>`${t}:${e}`)).join(" ");return Symbol.for(n)}(e);if(YY.has(r,n))return YY.get(r,n);const i=t.getDevice(),{type:o,map:a=n,...s}=e,l=new(0,KY[o])(i,{map:XY(t,a),...s});return YY.set(r,n,l),l}class qY extends JC{static defaultStyleProps={materialType:"basic"};type="node-3d";get plugin(){return this.attributes.context.canvas.renderers.main.getPlugin("device-renderer")}get device(){return this.plugin.getDevice()}constructor(t){super($({},{style:qY.defaultStyleProps},t))}render(t,e){super.render(t,e)}getKeyStyle(t){return{x:0,y:0,z:0,...IC(super.getKeyStyle(t),"material"),geometry:this.getGeometry(t),material:this.getMaterial(t)}}drawKeyShape(t,e=this){return this.upsert("key",dH,this.getKeyStyle(t),e)}getMaterial(t){const{texture:e}=t,n=CC(t,"material");return $Y(this.plugin,n,e)}}const ZY=new Map;function QY(t,e,n,r){const i=t+"|"+Object.entries(r).sort((([t],[e])=>t.localeCompare(e))).map((([t,e])=>`${t}:${e}`)).join(",");if(ZY.has(i))return ZY.get(i);const o=new n(e,r);return ZY.set(i,o),o}class JY extends qY{static defaultStyleProps={size:[24,48],heightSegments:1,sides:20};constructor(t){super($({},{style:JY.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{radius:n=e[0]/2,height:r=e[1],heightSegments:i,sides:o}=t;return QY("capsule",this.device,LY,{radius:n,height:r,heightSegments:i,sides:o})}}class tK extends qY{static defaultStyleProps={size:[24,0,48],heightSegments:5,capSegments:20};constructor(t){super($({},{style:tK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{baseRadius:n=e[0]/2,peakRadius:r=e[1]/2,height:i=e[2],heightSegments:o,capSegments:a}=t;return QY("cone",this.device,IY,{baseRadius:n,peakRadius:r,height:i,heightSegments:o,capSegments:a})}}class eK extends qY{static defaultStyleProps={widthSegments:1,heightSegments:1,depthSegments:1};constructor(t){super($({},{style:eK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{width:n=e[0],height:r=e[1],depth:i=e[2],widthSegments:o,heightSegments:a,depthSegments:s}=t;return QY("cube",this.device,wY,{width:n,height:r,depth:i,widthSegments:o,heightSegments:a,depthSegments:s})}}class nK extends qY{static defaultStyleProps={size:[24,48],heightSegments:5,capSegments:20};constructor(t){super($({},{style:nK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{radius:n=e[0]/2,height:r=e[1],heightSegments:i,capSegments:o}=t;return QY("cylinder",this.device,OY,{radius:n,height:r,heightSegments:i,capSegments:o})}}class rK extends qY{static defaultStyleProps={materialCullMode:Hz.NONE};constructor(t){super($({},{style:rK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{width:n=e[0],depth:r=e[1],widthSegments:i,depthSegments:o}=t;return QY("plane",this.device,CY,{width:n,depth:r,widthSegments:i,depthSegments:o})}}class iK extends qY{static defaultStyleProps={size:24,latitudeBands:16,longitudeBands:16};constructor(t){super($({},{style:iK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{radius:n=e[0]/2,latitudeBands:r,longitudeBands:i}=t;return QY("sphere",this.device,PY,{radius:n,latitudeBands:r,longitudeBands:i})}}class oK extends qY{static defaultStyleProps={size:[8,48],segments:30,sides:20};constructor(t){super($({},{style:oK.defaultStyleProps},t))}getGeometry(t){const e=this.getSize(),{tubeRadius:n=e[0]/2,ringRadius:r=e[1]/2,segments:i,sides:o}=t;return QY("torus",this.device,NY,{tubeRadius:n,ringRadius:r,segments:i,sides:o})}}class aK extends EL{static defaultOptions={ambient:{fill:"#fff",intensity:2*Math.PI},directional:{fill:"#fff",direction:[-1,0,1],intensity:.7*Math.PI}};ambient;directional;constructor(t,e){super(t,$({},aK.defaultOptions,e)),this.bindEvents()}bindEvents(){this.context.graph.on(gN.BEFORE_DRAW,this.setLight)}unbindEvents(){this.context.graph.off(gN.BEFORE_DRAW,this.setLight)}setLight=()=>{const{ambient:t,directional:e}=this.options;this.upsertLight("directional",e),this.upsertLight("ambient",t)};upsertLight(t,e){if(e){const n=this[t];if(n)n.attr(e);else{const n=new("ambient"===t?DY:BY)({style:e});this[t]=n,this.context.canvas.appendChild(n)}}else this[t]?.remove()}destroy(){this.unbindEvents(),super.destroy()}}var sK=function(){function t(t){this.canvasConfig=t.config,this.deviceRendererPlugin=t.deviceRendererPlugin}return t.prototype.init=function(){var t=this.canvasConfig,e=t.container,n=t.canvas;if(n)this.$canvas=n,e&&n.parentElement!==e&&e.appendChild(n),this.$container=n.parentElement,this.canvasConfig.container=this.$container;else if(e&&(this.$container=N(e)?document.getElementById(e):e,this.$container)){var r=document.createElement("canvas");this.$container.appendChild(r),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=r}this.resize(this.canvasConfig.width,this.canvasConfig.height)},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getContext=function(){return this.deviceRendererPlugin.getDevice().gl},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},t.prototype.resize=function(t,e){var n=this.canvasConfig.devicePixelRatio||iT&&window.devicePixelRatio||1;if(n=n>=1?Math.ceil(n):1,this.dpr=n,this.$canvas){var r=this.getDPR();this.$canvas.width=r*t,this.$canvas.height=r*e,lT(this.$canvas,t,e)}},t.prototype.getDPR=function(){return this.dpr},t.prototype.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},t.prototype.toDataURL=function(t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,this.deviceRendererPlugin.toDataURL(t)]}))}))},t}(),lK=function(t){function e(e,n){var r=t.call(this)||this;return r.rendererPlugin=e,r.config=n,r.name="webgl-context-register",r}return n(e,t),e.prototype.init=function(){this.context.ContextService=sK,this.context.deviceRendererPlugin=this.rendererPlugin;var t=this.config;this.context.deviceContribution=new yj(r(r({},(null==t?void 0:t.targets)?{targets:t.targets}:{targets:["webgl2","webgl1"]}),{onContextLost:null==t?void 0:t.onContextLost,onContextRestored:null==t?void 0:t.onContextRestored,onContextCreationError:null==t?void 0:t.onContextCreationError}))},e.prototype.destroy=function(){delete this.context.ContextService},e}(QS),uK=new ZT(""),cK=function(){function t(){this.targetRay=null}return t.prototype.connect=function(t){return this.dispatchEvent({type:"connected",data:t}),this},t.prototype.disconnect=function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this.targetRay&&(this.targetRay.style.visible=!1),this},t.prototype.update=function(t,e,n){var r=null,i=this.targetRay;return t&&"visible-blurred"!==e.session.visibilityState&&null!==i&&null!==(r=e.getPose(t.targetRaySpace,n))&&(i.setLocalTransform(r.transform.matrix),r.linearVelocity?(i.style.hasLinearVelocity=!0,qt(i.style.linearVelocity,r.linearVelocity)):i.style.hasLinearVelocity=!1,r.angularVelocity?(i.style.hasAngularVelocity=!0,i.style.angularVelocity.copy(r.angularVelocity)):i.style.hasAngularVelocity=!1,this.dispatchEvent({type:"move"})),null!==i&&(i.style.visible=null!==r),this},t.prototype.getTargetRaySpace=function(){return null===this.targetRay&&(this.targetRay=new Dw,this.targetRay.style.visible=!1,this.targetRay.style.hasLinearVelocity=!1,this.targetRay.style.linearVelocity=Xt(),this.targetRay.style.hasAngularVelocity=!1,this.targetRay.style.angularVelocity=Xt()),this.targetRay},t.prototype.dispatchEvent=function(t){var e=t.type,n=t.data;return uK.type=e,uK.detail=n,null!==this.targetRay&&this.targetRay.dispatchEvent(uK),this},t}(),hK=function(){function t(t){var e=this;this.plugin=t,this.controllers=[],this.controllerInputSources=[],this.onSessionEnd=function(){e.session.removeEventListener("select",e.onSessionEvent),e.session.removeEventListener("selectstart",e.onSessionEvent),e.session.removeEventListener("selectend",e.onSessionEvent),e.session.removeEventListener("squeeze",e.onSessionEvent),e.session.removeEventListener("squeezestart",e.onSessionEvent),e.session.removeEventListener("squeezeend",e.onSessionEvent),e.session.removeEventListener("end",e.onSessionEnd),e.session.removeEventListener("inputsourceschange",e.onInputSourcesChange);for(var t=0;t<e.controllers.length;t++){var n=e.controllerInputSources[t];null!==n&&(e.controllerInputSources[t]=null,e.controllers[t].disconnect(n))}},this.onSessionEvent=function(t){var n=e.controllerInputSources.indexOf(t.inputSource);if(-1!==n){var r=e.controllers[n];void 0!==r&&(r.update(t.inputSource,t.frame,e.session.referenceSpace),r.dispatchEvent({type:t.type,data:t.inputSource}))}},this.onInputSourcesChange=function(t){for(var n=0;n<t.removed.length;n++){var r=t.removed[n],i=e.controllerInputSources.indexOf(r);i>=0&&(e.controllerInputSources[i]=null,e.controllers[i].disconnect(r))}for(n=0;n<t.added.length;n++){r=t.added[n];var o=e.controllerInputSources.indexOf(r);if(-1===o){for(var a=0;a<e.controllers.length;a++){if(a>=e.controllerInputSources.length){e.controllerInputSources.push(r),o=a;break}if(null===e.controllerInputSources[a]){e.controllerInputSources[a]=r,o=a;break}}if(-1===o)break}var s=e.controllers[o];s&&s.connect(r)}}}return t.prototype.setSession=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(a){switch(a.label){case 0:return e?(this.session=e,n=this.plugin.getDevice().gl,!0===(r=n.getContextAttributes()).xrCompatible?[3,2]:[4,n.makeXRCompatible()]):[3,5];case 1:a.sent(),a.label=2;case 2:return e.addEventListener("select",this.onSessionEvent),e.addEventListener("selectstart",this.onSessionEvent),e.addEventListener("selectend",this.onSessionEvent),e.addEventListener("squeeze",this.onSessionEvent),e.addEventListener("squeezestart",this.onSessionEvent),e.addEventListener("squeezeend",this.onSessionEvent),e.addEventListener("end",this.onSessionEnd),e.addEventListener("inputsourceschange",this.onInputSourcesChange),void 0!==e.renderState.layers?[3,4]:(i={antialias:r.antialias,alpha:!0,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:1},this.glBaseLayer=new XRWebGLLayer(e,n,i),e.updateRenderState({baseLayer:this.glBaseLayer}),o=this,[4,e.requestReferenceSpace(this.referenceSpaceType)]);case 3:o.referenceSpace=a.sent(),e.referenceSpace=this.referenceSpace,a.label=4;case 4:t.requestAnimationFrame=e.requestAnimationFrame.bind(e),a.label=5;case 5:return[2]}}))}))},t.prototype.setReferenceSpaceType=function(t){this.referenceSpaceType=t},t.prototype.getSession=function(){return this.session},t.prototype.getReferenceSpace=function(){return this.referenceSpace},t.prototype.getOrCreateController=function(t){var e=this.controllers[t];return void 0===e&&(e=new cK,this.controllers[t]=e),e},t.prototype.getController=function(t){return this.getOrCreateController(t).getTargetRaySpace()},t}(),dK=function(t){function e(e){var n=t.call(this,r({enableSizeAttenuation:!1},e))||this,i=new xY(e);return n.xr=new hK(i),n.registerPlugin(new lK(i,e)),n.registerPlugin(new sz),n.registerPlugin(i),n.registerPlugin(new nz),n.registerPlugin(new iz),n}return n(e,t),e}(JS);t.BaseNode3D=qY,t.Capsule=JY,t.Cone=tK,t.Cube=eK,t.Cylinder=nK,t.D3Force3DLayout=class extends Ba{constructor(){super(...arguments),this.id="d3-force-3d",this.config={inputNodeAttrs:["x","y","z","vx","vy","vz","fx","fy","fz"],outputNodeAttrs:["x","y","z","vx","vy","vz"],simulationAttrs:["alpha","alphaMin","alphaDecay","alphaTarget","velocityDecay","randomSource","numDimensions"]},this.forceMap={link:ts,manyBody:cu,center:Fa,collide:Za,radial:hu,x:du,y:fu,z:pu},this.options={numDimensions:3,link:{id:t=>t.id},manyBody:{},center:{x:0,y:0,z:0}}}initSimulation(){return uu()}},t.DragCanvas3D=class extends eI{async translate(t,e){this.context.canvas.getCamera().pan(-t[0],-t[1])}},t.Light=aK,t.Line3D=class extends OO{getKeyPath(){return[]}getKeyStyle(t){const{sourceNode:e,targetNode:n}=this,[r,i,o]=e.getPosition(),[a,s,l]=n.getPosition(),{d:u,...c}=super.getKeyStyle(t);return{x1:r,y1:i,z1:o,x2:a,y2:s,z2:l,...c}}drawKeyShape(t=this.parsedAttributes,e=this){return this.upsert("key",Fw,this.getKeyStyle(t),e)}},t.ObserveCanvas3D=Uz,t.Plane=rK,t.RollCanvas3D=Gz,t.Sphere=iK,t.Torus=oK,t.ZoomCanvas3D=class extends lI{zoom=async(t,e,n)=>{if(!this.validate(e))return;const{graph:r}=this.context,{sensitivity:i,onFinish:o}=this.options,a=1+O(t,-50,50)*i/100,s=r.getZoom();this.context.canvas.getCamera().setZoom(s*a),o?.()}},t.renderer=t=>{if("label"===t)return new cz;const e=new dK;return"main"===t&&e.registerPlugin(new jY),e}}));
