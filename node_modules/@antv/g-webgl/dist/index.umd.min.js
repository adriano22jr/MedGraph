!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).G=e.G||{},e.G.WebGL={}),e.window.G)}(this,(function(e,t){"use strict";var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};function o(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);n.length>i;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function a(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&i[3]>s[1])){a.label=s[1];break}if(6===s[0]&&i[1]>a.label){a.label=i[1],i=s;break}if(i&&i[2]>a.label){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function c(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;o>i;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var f=function(e){return null==e},d={}.toString,h=function(e,t){return d.call(e)==="[object "+t+"]"},_=function(e){return h(e,"String")},p=function(e,t,r){return t>e?t:e>r?r:e},E=function(e){return h(e,"Number")},R=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array;function T(){var e=new v(16);return v!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function A(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,r,n,i,o,a,s,l,u,c,f,d,h,_,p){var E=new v(16);return E[0]=e,E[1]=t,E[2]=r,E[3]=n,E[4]=i,E[5]=o,E[6]=a,E[7]=s,E[8]=l,E[9]=u,E[10]=c,E[11]=f,E[12]=d,E[13]=h,E[14]=_,E[15]=p,E}function g(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=t[9],d=t[10],h=t[11],_=t[12],p=t[13],E=t[14],R=t[15],v=r*s-n*a,T=r*l-i*a,A=r*u-o*a,m=n*l-i*s,g=n*u-o*s,S=i*u-o*l,y=c*p-f*_,C=c*E-d*_,M=c*R-h*_,P=f*E-d*p,B=f*R-h*p,N=d*R-h*E,x=v*N-T*B+A*P+m*M-g*C+S*y;return x?(e[0]=(s*N-l*B+u*P)*(x=1/x),e[1]=(i*B-n*N-o*P)*x,e[2]=(p*S-E*g+R*m)*x,e[3]=(d*g-f*S-h*m)*x,e[4]=(l*M-a*N-u*C)*x,e[5]=(r*N-i*M+o*C)*x,e[6]=(E*A-_*S-R*T)*x,e[7]=(c*S-d*A+h*T)*x,e[8]=(a*B-s*M+u*y)*x,e[9]=(n*M-r*B-o*y)*x,e[10]=(_*g-p*A+R*v)*x,e[11]=(f*A-c*g-h*v)*x,e[12]=(s*C-a*P-l*y)*x,e[13]=(r*P-n*C+i*y)*x,e[14]=(p*T-_*m-E*v)*x,e[15]=(c*m-f*T+d*v)*x,e):null}function y(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],d=t[9],h=t[10],_=t[11],p=t[12],E=t[13],R=t[14],v=t[15],T=r[0],A=r[1],m=r[2],g=r[3];return e[0]=T*n+A*s+m*f+g*p,e[1]=T*i+A*l+m*d+g*E,e[2]=T*o+A*u+m*h+g*R,e[3]=T*a+A*c+m*_+g*v,e[4]=(T=r[4])*n+(A=r[5])*s+(m=r[6])*f+(g=r[7])*p,e[5]=T*i+A*l+m*d+g*E,e[6]=T*o+A*u+m*h+g*R,e[7]=T*a+A*c+m*_+g*v,e[8]=(T=r[8])*n+(A=r[9])*s+(m=r[10])*f+(g=r[11])*p,e[9]=T*i+A*l+m*d+g*E,e[10]=T*o+A*u+m*h+g*R,e[11]=T*a+A*c+m*_+g*v,e[12]=(T=r[12])*n+(A=r[13])*s+(m=r[14])*f+(g=r[15])*p,e[13]=T*i+A*l+m*d+g*E,e[14]=T*o+A*u+m*h+g*R,e[15]=T*a+A*c+m*_+g*v,e}function C(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function M(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function P(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=n+n,l=i+i,u=o+o,c=n*s,f=n*l,d=n*u,h=i*l,_=i*u,p=o*u,E=a*s,R=a*l,v=a*u;return e[0]=1-(h+p),e[1]=f+v,e[2]=d-R,e[3]=0,e[4]=f-v,e[5]=1-(c+p),e[6]=_+E,e[7]=0,e[8]=d+R,e[9]=_-E,e[10]=1-(c+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function B(e,t){var r=t[4],n=t[5],i=t[6],o=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,n,i),e[2]=Math.hypot(o,a,s),e}function N(e,t,r,n,i){var o,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(o=1/(n-i)),e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}function x(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),u=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*u,e[15]=1,e}function O(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var I=y,D=Object.freeze({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=t[9],d=t[10],h=t[11],_=t[12],p=t[13],E=t[14],R=t[15];return e[0]=s*(d*R-h*E)-f*(l*R-u*E)+p*(l*h-u*d),e[1]=-(n*(d*R-h*E)-f*(i*R-o*E)+p*(i*h-o*d)),e[2]=n*(l*R-u*E)-s*(i*R-o*E)+p*(i*u-o*l),e[3]=-(n*(l*h-u*d)-s*(i*h-o*d)+f*(i*u-o*l)),e[4]=-(a*(d*R-h*E)-c*(l*R-u*E)+_*(l*h-u*d)),e[5]=r*(d*R-h*E)-c*(i*R-o*E)+_*(i*h-o*d),e[6]=-(r*(l*R-u*E)-a*(i*R-o*E)+_*(i*u-o*l)),e[7]=r*(l*h-u*d)-a*(i*h-o*d)+c*(i*u-o*l),e[8]=a*(f*R-h*p)-c*(s*R-u*p)+_*(s*h-u*f),e[9]=-(r*(f*R-h*p)-c*(n*R-o*p)+_*(n*h-o*f)),e[10]=r*(s*R-u*p)-a*(n*R-o*p)+_*(n*u-o*s),e[11]=-(r*(s*h-u*f)-a*(n*h-o*f)+c*(n*u-o*s)),e[12]=-(a*(f*E-d*p)-c*(s*E-l*p)+_*(s*d-l*f)),e[13]=r*(f*E-d*p)-c*(n*E-i*p)+_*(n*d-i*f),e[14]=-(r*(s*E-l*p)-a*(n*E-i*p)+_*(n*l-i*s)),e[15]=r*(s*d-l*f)-a*(n*d-i*f)+c*(n*l-i*s),e},clone:function(e){var t=new v(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:A,create:T,determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],f=e[10],d=e[11],h=e[12],_=e[13],p=e[14],E=e[15];return(t*a-r*o)*(f*E-d*p)-(t*s-n*o)*(c*E-d*_)+(t*l-i*o)*(c*p-f*_)+(r*s-n*a)*(u*E-d*h)-(r*l-i*a)*(u*p-f*h)+(n*l-i*s)*(u*_-c*h)},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],f=e[9],d=e[10],h=e[11],_=e[12],p=e[13],E=e[14],v=e[15],T=t[0],A=t[1],m=t[2],g=t[3],S=t[4],y=t[5],C=t[6],M=t[7],P=t[8],B=t[9],N=t[10],x=t[11],O=t[12],I=t[13],D=t[14],F=t[15];return!(Math.abs(r-T)>R*Math.max(1,Math.abs(r),Math.abs(T))||Math.abs(n-A)>R*Math.max(1,Math.abs(n),Math.abs(A))||Math.abs(i-m)>R*Math.max(1,Math.abs(i),Math.abs(m))||Math.abs(o-g)>R*Math.max(1,Math.abs(o),Math.abs(g))||Math.abs(a-S)>R*Math.max(1,Math.abs(a),Math.abs(S))||Math.abs(s-y)>R*Math.max(1,Math.abs(s),Math.abs(y))||Math.abs(l-C)>R*Math.max(1,Math.abs(l),Math.abs(C))||Math.abs(u-M)>R*Math.max(1,Math.abs(u),Math.abs(M))||Math.abs(c-P)>R*Math.max(1,Math.abs(c),Math.abs(P))||Math.abs(f-B)>R*Math.max(1,Math.abs(f),Math.abs(B))||Math.abs(d-N)>R*Math.max(1,Math.abs(d),Math.abs(N))||Math.abs(h-x)>R*Math.max(1,Math.abs(h),Math.abs(x))||Math.abs(_-O)>R*Math.max(1,Math.abs(_),Math.abs(O))||Math.abs(p-I)>R*Math.max(1,Math.abs(p),Math.abs(I))||Math.abs(E-D)>R*Math.max(1,Math.abs(E),Math.abs(D))||Math.abs(v-F)>R*Math.max(1,Math.abs(v),Math.abs(F)))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,u=r*a,c=n*a,f=n*s,d=i*a,h=i*s,_=i*l,p=o*a,E=o*s,R=o*l;return e[0]=1-f-_,e[1]=c+R,e[2]=d-E,e[3]=0,e[4]=c-R,e[5]=1-u-_,e[6]=h+p,e[7]=0,e[8]=d+E,e[9]=h-p,e[10]=1-u-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromQuat2:function(e,t){var r=new v(3),n=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=n*n+i*i+o*o+a*a;return f>0?(r[0]=2*(s*a+c*n+l*o-u*i)/f,r[1]=2*(l*a+c*i+u*n-s*o)/f,r[2]=2*(u*a+c*o+s*i-l*n)/f):(r[0]=2*(s*a+c*n+l*o-u*i),r[1]=2*(l*a+c*i+u*n-s*o),r[2]=2*(u*a+c*o+s*i-l*n)),P(e,t,r),e},fromRotation:function(e,t,r){var n,i,o,a=r[0],s=r[1],l=r[2],u=Math.hypot(a,s,l);return R>u?null:(a*=u=1/u,s*=u,l*=u,n=Math.sin(t),e[0]=a*a*(o=1-(i=Math.cos(t)))+i,e[1]=s*a*o+l*n,e[2]=l*a*o-s*n,e[3]=0,e[4]=a*s*o-l*n,e[5]=s*s*o+i,e[6]=l*s*o+a*n,e[7]=0,e[8]=a*l*o+s*n,e[9]=s*l*o-a*n,e[10]=l*l*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromRotationTranslation:P,fromRotationTranslationScale:function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3],l=i+i,u=o+o,c=a+a,f=i*l,d=i*u,h=i*c,_=o*u,p=o*c,E=a*c,R=s*l,v=s*u,T=s*c,A=n[0],m=n[1],g=n[2];return e[0]=(1-(_+E))*A,e[1]=(d+T)*A,e[2]=(h-v)*A,e[3]=0,e[4]=(d-T)*m,e[5]=(1-(f+E))*m,e[6]=(p+R)*m,e[7]=0,e[8]=(h+v)*g,e[9]=(p-R)*g,e[10]=(1-(f+_))*g,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,n,i){var o=t[0],a=t[1],s=t[2],l=t[3],u=o+o,c=a+a,f=s+s,d=o*u,h=o*c,_=o*f,p=a*c,E=a*f,R=s*f,v=l*u,T=l*c,A=l*f,m=n[0],g=n[1],S=n[2],y=i[0],C=i[1],M=i[2],P=(1-(p+R))*m,B=(h+A)*m,N=(_-T)*m,x=(h-A)*g,O=(1-(d+R))*g,I=(E+v)*g,D=(_+T)*S,F=(E-v)*S,b=(1-(d+p))*S;return e[0]=P,e[1]=B,e[2]=N,e[3]=0,e[4]=x,e[5]=O,e[6]=I,e[7]=0,e[8]=D,e[9]=F,e[10]=b,e[11]=0,e[12]=r[0]+y-(P*y+x*C+D*M),e[13]=r[1]+C-(B*y+O*C+F*M),e[14]=r[2]+M-(N*y+I*C+b*M),e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromTranslation:M,fromValues:m,fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,i,o,a){var s=1/(r-t),l=1/(i-n),u=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(a+o)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*u,e[15]=0,e},getRotation:function(e,t){var r=new v(3);B(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],a=t[0]*n,s=t[1]*i,l=t[2]*o,u=t[4]*n,c=t[5]*i,f=t[6]*o,d=t[8]*n,h=t[9]*i,_=t[10]*o,p=a+c+_,E=0;return p>0?(e[3]=.25*(E=2*Math.sqrt(p+1)),e[0]=(f-h)/E,e[1]=(d-l)/E,e[2]=(s-u)/E):a>c&&a>_?(e[3]=(f-h)/(E=2*Math.sqrt(1+a-c-_)),e[0]=.25*E,e[1]=(s+u)/E,e[2]=(d+l)/E):c>_?(e[3]=(d-l)/(E=2*Math.sqrt(1+c-a-_)),e[0]=(s+u)/E,e[1]=.25*E,e[2]=(f+h)/E):(e[3]=(s-u)/(E=2*Math.sqrt(1+_-a-c)),e[0]=(d+l)/E,e[1]=(f+h)/E,e[2]=.25*E),e},getScaling:B,getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:g,invert:S,lookAt:function(e,t,r,n){var i,o,a,s,l,u,c,f,d,h,_=t[0],p=t[1],E=t[2],v=n[0],T=n[1],A=n[2],m=r[0],S=r[1],y=r[2];return R>Math.abs(_-m)&&R>Math.abs(p-S)&&R>Math.abs(E-y)?g(e):(h=1/Math.hypot(c=_-m,f=p-S,d=E-y),(h=Math.hypot(i=T*(d*=h)-A*(f*=h),o=A*(c*=h)-v*d,a=v*f-T*c))?(i*=h=1/h,o*=h,a*=h):(i=0,o=0,a=0),(h=Math.hypot(s=f*a-d*o,l=d*i-c*a,u=c*o-f*i))?(s*=h=1/h,l*=h,u*=h):(s=0,l=0,u=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(i*_+o*p+a*E),e[13]=-(s*_+l*p+u*E),e[14]=-(c*_+f*p+d*E),e[15]=1,e)},mul:I,multiply:y,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},ortho:x,orthoNO:x,orthoZO:function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),u=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=o*u,e[15]=1,e},perspective:N,perspectiveFromFieldOfView:function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),u=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(i-o)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},perspectiveNO:N,perspectiveZO:function(e,t,r,n,i){var o,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=i*(o=1/(n-i)),e[14]=i*n*o):(e[10]=-1,e[14]=-n),e},rotate:function(e,t,r,n){var i,o,a,s,l,u,c,f,d,h,_,p,E,v,T,A,m,g,S,y,C,M,P,B,N=n[0],x=n[1],O=n[2],I=Math.hypot(N,x,O);return R>I?null:(N*=I=1/I,x*=I,O*=I,i=Math.sin(r),l=t[1],u=t[2],c=t[3],d=t[5],h=t[6],_=t[7],E=t[9],v=t[10],T=t[11],S=N*x*(a=1-(o=Math.cos(r)))-O*i,y=x*x*a+o,C=O*x*a+N*i,M=N*O*a+x*i,P=x*O*a-N*i,B=O*O*a+o,e[0]=(s=t[0])*(A=N*N*a+o)+(f=t[4])*(m=x*N*a+O*i)+(p=t[8])*(g=O*N*a-x*i),e[1]=l*A+d*m+E*g,e[2]=u*A+h*m+v*g,e[3]=c*A+_*m+T*g,e[4]=s*S+f*y+p*C,e[5]=l*S+d*y+E*C,e[6]=u*S+h*y+v*C,e[7]=c*S+_*y+T*C,e[8]=s*M+f*P+p*B,e[9]=l*M+d*P+E*B,e[10]=u*M+h*P+v*B,e[11]=c*M+_*P+T*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],f=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+u*n,e[5]=a*i+c*n,e[6]=s*i+f*n,e[7]=l*i+d*n,e[8]=u*i-o*n,e[9]=c*i-a*n,e[10]=f*i-s*n,e[11]=d*i-l*n,e},rotateY:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],u=t[8],c=t[9],f=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-u*n,e[1]=a*i-c*n,e[2]=s*i-f*n,e[3]=l*i-d*n,e[8]=o*n+u*i,e[9]=a*n+c*i,e[10]=s*n+f*i,e[11]=l*n+d*i,e},rotateZ:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],u=t[4],c=t[5],f=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+u*n,e[1]=a*i+c*n,e[2]=s*i+f*n,e[3]=l*i+d*n,e[4]=u*i-o*n,e[5]=c*i-a*n,e[6]=f*i-s*n,e[7]=d*i-l*n,e},scale:C,set:function(e,t,r,n,i,o,a,s,l,u,c,f,d,h,_,p,E){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=f,e[11]=d,e[12]=h,e[13]=_,e[14]=p,e[15]=E,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},sub:O,subtract:O,targetTo:function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=n[0],l=n[1],u=n[2],c=i-r[0],f=o-r[1],d=a-r[2],h=c*c+f*f+d*d;h>0&&(c*=h=1/Math.sqrt(h),f*=h,d*=h);var _=l*d-u*f,p=u*c-s*d,E=s*f-l*c;return(h=_*_+p*p+E*E)>0&&(_*=h=1/Math.sqrt(h),p*=h,E*=h),e[0]=_,e[1]=p,e[2]=E,e[3]=0,e[4]=f*E-d*p,e[5]=d*_-c*E,e[6]=c*p-f*_,e[7]=0,e[8]=c,e[9]=f,e[10]=d,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},translate:function(e,t,r){var n,i,o,a,s,l,u,c,f,d,h,_,p=r[0],E=r[1],R=r[2];return t===e?(e[12]=t[0]*p+t[4]*E+t[8]*R+t[12],e[13]=t[1]*p+t[5]*E+t[9]*R+t[13],e[14]=t[2]*p+t[6]*E+t[10]*R+t[14],e[15]=t[3]*p+t[7]*E+t[11]*R+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],d=t[9],h=t[10],_=t[11],e[0]=n=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=f,e[9]=d,e[10]=h,e[11]=_,e[12]=n*p+s*E+f*R+t[12],e[13]=i*p+l*E+d*R+t[13],e[14]=o*p+u*E+h*R+t[14],e[15]=a*p+c*E+_*R+t[15]),e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}});function F(){var e=new v(3);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e,t,r){var n=new v(3);return n[0]=e,n[1]=t,n[2]=r,n}function L(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}}function U(e,t,r,n,i,o,a,s,l,u){var c,f,d,h,_,p=e,E=t,R=r,v=n,T=s,A=l,m=120*Math.PI/180,g=Math.PI/180*(+i||0),S=[];if(u)f=u[0],d=u[1],h=u[2],_=u[3];else{E=(c=L(p,E,-g)).y;var y=((p=c.x)-(T=(c=L(T,A,-g)).x))/2,C=(E-(A=c.y))/2,M=y*y/(R*R)+C*C/(v*v);M>1&&(R*=M=Math.sqrt(M),v*=M);var P=R*R,B=v*v,N=(o===a?-1:1)*Math.sqrt(Math.abs((P*B-P*C*C-B*y*y)/(P*C*C+B*y*y)));h=N*R*C/v+(p+T)/2,f=Math.asin(((E-(_=N*-v*y/R+(E+A)/2))/v*1e9>>0)/1e9),d=Math.asin(((A-_)/v*1e9>>0)/1e9),0>(f=h>p?Math.PI-f:f)&&(f=2*Math.PI+f),0>(d=h>T?Math.PI-d:d)&&(d=2*Math.PI+d),a&&f>d&&(f-=2*Math.PI),!a&&d>f&&(d-=2*Math.PI)}var x=d-f;if(Math.abs(x)>m){var O=d,I=T,D=A;S=U(T=h+R*Math.cos(d=f+m*(a&&d>f?1:-1)),A=_+v*Math.sin(d),R,v,i,0,a,I,D,[d,O,h,_])}x=d-f;var F=Math.cos(f),b=Math.sin(f),G=Math.cos(d),w=Math.sin(d),k=Math.tan(x/4),V=4/3*R*k,X=4/3*v*k,W=[p,E],H=[p+V*b,E-X*F],z=[T+V*w,A-X*G],Y=[T,A];if(H[0]=2*W[0]-H[0],H[1]=2*W[1]-H[1],u)return H.concat(z,Y,S);for(var K=[],j=0,Z=(S=H.concat(z,Y,S)).length;Z>j;j+=1)K[j]=j%2?L(S[j-1],S[j],g).y:L(S[j],S[j+1],g).x;return K}F();var G={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=this._events[r?r+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,i=t.length,o=Array(i);i>n;n++)o[n]=t[n].fn;return o},s.prototype.listenerCount=function(e){var t=this._events[r?r+e:e];return t?t.fn?1:t.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,o),!0;case 6:return c.fn.call(c.context,t,n,i,o,a),!0}for(u=1,l=Array(f-1);f>u;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,h=c.length;for(u=0;h>u;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),f){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(d=1,l=Array(f-1);f>d;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var l=0,u=[],c=s.length;c>l;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?this._events[t=r?r+e:e]&&a(this,t):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(G);var w,k,V,X,W,H,z,Y,K,j,Z,q,Q,$,J,ee,te,re,ne,ie,oe,ae,se,le,ue,ce,fe,de=G.exports;function he(e,t,r,n){return{dimension:ee.TEXTURE_2D,format:e,width:t,height:r,depthOrArrayLayers:1,mipLevelCount:n,usage:te.SAMPLED}}function _e(e,t,r){return e<<16|t<<8|r}function pe(e){return e>>>8&255}function Ee(e){return e>>>16&255}function Re(e){return 255&e}function ve(e){switch(e){case le.F32:case le.U32:case le.S32:return 4;case le.U16:case le.S16:case le.F16:return 2;case le.U8:case le.S8:return 1;default:throw Error("whoops")}}function Te(e){return ve(Ee(e))}function Ae(e){var t=Re(e);if(t&ce.Depth)return ie.Depth;if(t&ce.Normalized)return ie.Float;var r=Ee(e);if(r===le.F16||r===le.F32)return ie.Float;if(r===le.U8||r===le.U16||r===le.U32)return ie.Uint;if(r===le.S8||r===le.S16||r===le.S32)return ie.Sint;throw Error("whoops")}function me(e,t){if(void 0===t&&(t=""),!e)throw Error("Assert fail: ".concat(t))}function ge(e){if(null!=e)return e;throw Error("Missing object")}function Se(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function ye(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function Ce(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function Me(e,t,r,n){return void 0===n&&(n=1),{r:e,g:t,b:r,a:n}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(w||(w={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"}(k||(k={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(V||(V={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(X||(X={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(W||(W={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(H||(H={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(z||(z={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(Y||(Y={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(K||(K={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(j||(j={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(Z||(Z={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(q||(q={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(Q||(Q={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}($||($={})),function(e){e.LOADED="loaded"}(J||(J={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(ee||(ee={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"}(te||(te={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(re||(re={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(ne||(ne={})),function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"}(ie||(ie={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(oe||(oe={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(ae||(ae={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(se||(se={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}(le||(le={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(ue||(ue={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"}(ce||(ce={})),function(e){e[e.ALPHA=_e(le.U8,ue.A,ce.None)]="ALPHA",e[e.U8_LUMINANCE=_e(le.U8,ue.A,ce.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=_e(le.F16,ue.A,ce.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=_e(le.F32,ue.A,ce.Luminance)]="F32_LUMINANCE",e[e.F16_R=_e(le.F16,ue.R,ce.None)]="F16_R",e[e.F16_RG=_e(le.F16,ue.RG,ce.None)]="F16_RG",e[e.F16_RGB=_e(le.F16,ue.RGB,ce.None)]="F16_RGB",e[e.F16_RGBA=_e(le.F16,ue.RGBA,ce.None)]="F16_RGBA",e[e.F32_R=_e(le.F32,ue.R,ce.None)]="F32_R",e[e.F32_RG=_e(le.F32,ue.RG,ce.None)]="F32_RG",e[e.F32_RGB=_e(le.F32,ue.RGB,ce.None)]="F32_RGB",e[e.F32_RGBA=_e(le.F32,ue.RGBA,ce.None)]="F32_RGBA",e[e.U8_R=_e(le.U8,ue.R,ce.None)]="U8_R",e[e.U8_R_NORM=_e(le.U8,ue.R,ce.Normalized)]="U8_R_NORM",e[e.U8_RG=_e(le.U8,ue.RG,ce.None)]="U8_RG",e[e.U8_RG_NORM=_e(le.U8,ue.RG,ce.Normalized)]="U8_RG_NORM",e[e.U8_RGB=_e(le.U8,ue.RGB,ce.None)]="U8_RGB",e[e.U8_RGB_NORM=_e(le.U8,ue.RGB,ce.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=_e(le.U8,ue.RGB,ce.sRGB|ce.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=_e(le.U8,ue.RGBA,ce.None)]="U8_RGBA",e[e.U8_RGBA_NORM=_e(le.U8,ue.RGBA,ce.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=_e(le.U8,ue.RGBA,ce.sRGB|ce.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=_e(le.U16,ue.R,ce.None)]="U16_R",e[e.U16_R_NORM=_e(le.U16,ue.R,ce.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=_e(le.U16,ue.RG,ce.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=_e(le.U16,ue.RGBA,ce.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=_e(le.U16,ue.RGBA,ce.None)]="U16_RGBA",e[e.U16_RGB=_e(le.U16,ue.RGB,ce.None)]="U16_RGB",e[e.U16_RG=_e(le.U16,ue.RG,ce.None)]="U16_RG",e[e.U32_R=_e(le.U32,ue.R,ce.None)]="U32_R",e[e.U32_RG=_e(le.U32,ue.RG,ce.None)]="U32_RG",e[e.U32_RGB=_e(le.U32,ue.RGB,ce.None)]="U32_RGB",e[e.U32_RGBA=_e(le.U32,ue.RGBA,ce.None)]="U32_RGBA",e[e.S8_R=_e(le.S8,ue.R,ce.None)]="S8_R",e[e.S8_R_NORM=_e(le.S8,ue.R,ce.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=_e(le.S8,ue.RG,ce.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=_e(le.S8,ue.RGB,ce.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=_e(le.S8,ue.RGBA,ce.Normalized)]="S8_RGBA_NORM",e[e.S16_R=_e(le.S16,ue.R,ce.None)]="S16_R",e[e.S16_RG=_e(le.S16,ue.RG,ce.None)]="S16_RG",e[e.S16_RG_NORM=_e(le.S16,ue.RG,ce.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=_e(le.S16,ue.RGB,ce.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=_e(le.S16,ue.RGBA,ce.None)]="S16_RGBA",e[e.S16_RGBA_NORM=_e(le.S16,ue.RGBA,ce.Normalized)]="S16_RGBA_NORM",e[e.S32_R=_e(le.S32,ue.R,ce.None)]="S32_R",e[e.S32_RG=_e(le.S32,ue.RG,ce.None)]="S32_RG",e[e.S32_RGB=_e(le.S32,ue.RGB,ce.None)]="S32_RGB",e[e.S32_RGBA=_e(le.S32,ue.RGBA,ce.None)]="S32_RGBA",e[e.U16_RGBA_5551=_e(le.U16_PACKED_5551,ue.RGBA,ce.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=_e(le.U16_PACKED_565,ue.RGB,ce.Normalized)]="U16_RGB_565",e[e.BC1=_e(le.BC1,ue.RGBA,ce.Normalized)]="BC1",e[e.BC1_SRGB=_e(le.BC1,ue.RGBA,ce.Normalized|ce.sRGB)]="BC1_SRGB",e[e.BC2=_e(le.BC2,ue.RGBA,ce.Normalized)]="BC2",e[e.BC2_SRGB=_e(le.BC2,ue.RGBA,ce.Normalized|ce.sRGB)]="BC2_SRGB",e[e.BC3=_e(le.BC3,ue.RGBA,ce.Normalized)]="BC3",e[e.BC3_SRGB=_e(le.BC3,ue.RGBA,ce.Normalized|ce.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=_e(le.BC4_UNORM,ue.R,ce.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=_e(le.BC4_SNORM,ue.R,ce.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=_e(le.BC5_UNORM,ue.RG,ce.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=_e(le.BC5_SNORM,ue.RG,ce.Normalized)]="BC5_SNORM",e[e.D24=_e(le.D24,ue.R,ce.Depth)]="D24",e[e.D24_S8=_e(le.D24S8,ue.RG,ce.Depth|ce.Stencil)]="D24_S8",e[e.D32F=_e(le.D32F,ue.R,ce.Depth)]="D32F",e[e.D32F_S8=_e(le.D32FS8,ue.RG,ce.Depth|ce.Stencil)]="D32F_S8",e[e.U8_RGB_RT=_e(le.U8,ue.RGB,ce.RenderTarget|ce.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=_e(le.U8,ue.RGBA,ce.RenderTarget|ce.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=_e(le.U8,ue.RGBA,ce.RenderTarget|ce.Normalized|ce.sRGB)]="U8_RGBA_RT_SRGB"}(fe||(fe={}));var Pe=Me(0,0,0,0),Be=Me(0,0,0,1),Ne=Me(1,1,1,0),xe=Me(1,1,1,1);function Oe(e){return!(!e||0!=(e&e-1))}function Ie(e,t){return null!=e?e:t}function De(e){return void 0===e?null:e}function Fe(e,t,r){e.length=t,e.fill(r)}function be(e,t){var r=t-1;return e+r&~r}function Le(e,t){return((e+t-1)/t|0)*t}function Ue(e,t,r){return r?e|=t:e&=~t,e}function Ge(e,t){for(var r=Array(e),n=0;e>n;n++)r[n]=t();return r}function we(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function ke(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function Ve(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),we(e.rgbBlendState,t.rgbBlendState),we(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Xe(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;t.length>r;r++)e[r]=Ve(e[r],t[r])}function We(e,t){void 0!==t.attachmentsState&&Xe(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&ye(e.blendConstant,t.blendConstant),e.depthCompare=Ie(t.depthCompare,e.depthCompare),e.depthWrite=Ie(t.depthWrite,e.depthWrite),e.stencilWrite=Ie(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&ke(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&ke(e.stencilBack,t.stencilBack),e.cullMode=Ie(t.cullMode,e.cullMode),e.frontFace=Ie(t.frontFace,e.frontFace),e.polygonOffset=Ie(t.polygonOffset,e.polygonOffset)}function He(e){var t=Object.assign({},e);return t.attachmentsState=[],Xe(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&Ce(t.blendConstant),t.stencilFront=ke(void 0,e.stencilFront),t.stencilBack=ke(void 0,e.stencilBack),t}var ze={blendMode:z.ADD,blendSrcFactor:H.ONE,blendDstFactor:H.ZERO},Ye={attachmentsState:[{channelWriteMask:re.ALL,rgbBlendState:ze,alphaBlendState:ze}],blendConstant:Ce(Pe),depthWrite:!0,depthCompare:V.LEQUAL,stencilWrite:!1,stencilFront:{compare:V.ALWAYS,passOp:ne.KEEP,depthFailOp:ne.KEEP,failOp:ne.KEEP},stencilBack:{compare:V.ALWAYS,passOp:ne.KEEP,depthFailOp:ne.KEEP,failOp:ne.KEEP},cullMode:W.NONE,frontFace:X.CCW,polygonOffset:!1};var Ke=function(e,t){void 0===e&&(e=null),void 0===t&&(t=Ye);var r=He(t);return null!==e&&We(r,e),r}({depthCompare:V.ALWAYS,depthWrite:!1},Ye);function je(e,t){return void 0===e.attachmentsState&&(e.attachmentsState=[],Xe(e.attachmentsState,Ye.attachmentsState)),function(e,t){void 0!==t.channelWriteMask&&(e.channelWriteMask=t.channelWriteMask),void 0!==t.rgbBlendMode&&(e.rgbBlendState.blendMode=t.rgbBlendMode),void 0!==t.alphaBlendMode&&(e.alphaBlendState.blendMode=t.alphaBlendMode),void 0!==t.rgbBlendSrcFactor&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),void 0!==t.alphaBlendSrcFactor&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),void 0!==t.rgbBlendDstFactor&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),void 0!==t.alphaBlendDstFactor&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}(e.attachmentsState[0],t),e}var Ze,qe={texture:null,sampler:null,formatKind:ie.Float,dimension:ee.TEXTURE_2D};function Qe(e,t,r){if(e.length!==t.length)return!1;for(var n=0;e.length>n;n++)if(!r(e[n],t[n]))return!1;return!0}function $e(e,t){for(var r=Array(e.length),n=0;e.length>n;n++)r[n]=t(e[n]);return r}function Je(e,t){return e.texture===t.texture&&e.binding===t.binding}function et(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function tt(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison)}function rt(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings.length===t.samplerBindings.length&&(!!Qe(e.samplerBindings,t.samplerBindings,tt)&&(!!Qe(e.uniformBufferBindings,t.uniformBufferBindings,et)&&(!!Qe(e.storageBufferBindings,t.storageBufferBindings,et)&&!!Qe(e.storageTextureBindings,t.storageTextureBindings,Je))))}function nt(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function it(e,t){return!!nt(e.rgbBlendState,t.rgbBlendState)&&(!!nt(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function ot(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function at(e,t){return e.id===t.id}function st(e,t){return e===t}function lt(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!(e.megaStateDescriptor&&t.megaStateDescriptor&&!function(e,t){return!(!Qe(e.attachmentsState,t.attachmentsState,it)||e.blendConstant&&t.blendConstant&&!Se(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!ot(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!ot(e.stencilBack,t.stencilBack)||e.depthCompare!==t.depthCompare||e.depthWrite!==t.depthWrite||e.stencilWrite!==t.stencilWrite||e.cullMode!==t.cullMode||e.frontFace!==t.frontFace||e.polygonOffset!==t.polygonOffset)}(e.megaStateDescriptor,t.megaStateDescriptor))&&(!!at(e.program,t.program)&&(!!Qe(e.colorAttachmentFormats,t.colorAttachmentFormats,st)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)))))}function ut(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function ct(e,t){return f(e)?f(t):!f(t)&&(e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&Qe(e.attributes,t.attributes,ut))}function ft(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!Qe(e.vertexBufferDescriptors,t.vertexBufferDescriptors,ct)&&!!at(e.program,t.program))}function dt(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function ht(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function _t(e){return{binding:e.binding,buffer:e.buffer,offset:e.offset,size:e.size}}function pt(e){return{binding:e.binding,texture:e.texture}}function Et(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function Rt(e){return f(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:$e(e.attributes,Et)}}var vt=/([^[]*)(\[[0-9]+\])?/;function Tt(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(vt);if(!t||2>t.length)throw Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function At(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function mt(e,t,r,n){var i=null,o=null;return function(a,s,l){var u=t(l,r),c=u.length,f=!1;if(null===i)i=new Float32Array(c),o=c,f=!0;else{me(o===c,"Uniform length cannot change.");for(var d=0;c>d;++d)if(u[d]!==i[d]){f=!0;break}}return f&&(n(a,e,s,u),i.set(u)),f}}function gt(e,t,r,n){e[t](r,n)}function St(e,t,r,n){e[t](r,!1,n)}var yt={},Ct={},Mt={},Pt=[0];function Bt(e,t,r,n){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Pt[0]=e,e=Pt);var i=e.length;if(e instanceof r)return e;var o=n[i];o||(o=new r(i),n[i]=o);for(var a=0;i>a;a++)o[a]=e[a];return o}function Nt(e,t){return Bt(e,t,Float32Array,yt)}function xt(e,t){return Bt(e,t,Int32Array,Ct)}function Ot(e,t){return Bt(e,t,Uint32Array,Mt)}var It=((Ze={})[w.FLOAT]=mt.bind(null,"uniform1fv",Nt,1,gt),Ze[w.FLOAT_VEC2]=mt.bind(null,"uniform2fv",Nt,2,gt),Ze[w.FLOAT_VEC3]=mt.bind(null,"uniform3fv",Nt,3,gt),Ze[w.FLOAT_VEC4]=mt.bind(null,"uniform4fv",Nt,4,gt),Ze[w.INT]=mt.bind(null,"uniform1iv",xt,1,gt),Ze[w.INT_VEC2]=mt.bind(null,"uniform2iv",xt,2,gt),Ze[w.INT_VEC3]=mt.bind(null,"uniform3iv",xt,3,gt),Ze[w.INT_VEC4]=mt.bind(null,"uniform4iv",xt,4,gt),Ze[w.BOOL]=mt.bind(null,"uniform1iv",xt,1,gt),Ze[w.BOOL_VEC2]=mt.bind(null,"uniform2iv",xt,2,gt),Ze[w.BOOL_VEC3]=mt.bind(null,"uniform3iv",xt,3,gt),Ze[w.BOOL_VEC4]=mt.bind(null,"uniform4iv",xt,4,gt),Ze[w.FLOAT_MAT2]=mt.bind(null,"uniformMatrix2fv",Nt,4,St),Ze[w.FLOAT_MAT3]=mt.bind(null,"uniformMatrix3fv",Nt,9,St),Ze[w.FLOAT_MAT4]=mt.bind(null,"uniformMatrix4fv",Nt,16,St),Ze[w.UNSIGNED_INT]=mt.bind(null,"uniform1uiv",Ot,1,gt),Ze[w.UNSIGNED_INT_VEC2]=mt.bind(null,"uniform2uiv",Ot,2,gt),Ze[w.UNSIGNED_INT_VEC3]=mt.bind(null,"uniform3uiv",Ot,3,gt),Ze[w.UNSIGNED_INT_VEC4]=mt.bind(null,"uniform4uiv",Ot,4,gt),Ze[w.FLOAT_MAT2x3]=mt.bind(null,"uniformMatrix2x3fv",Nt,6,St),Ze[w.FLOAT_MAT2x4]=mt.bind(null,"uniformMatrix2x4fv",Nt,8,St),Ze[w.FLOAT_MAT3x2]=mt.bind(null,"uniformMatrix3x2fv",Nt,6,St),Ze[w.FLOAT_MAT3x4]=mt.bind(null,"uniformMatrix3x4fv",Nt,12,St),Ze[w.FLOAT_MAT4x2]=mt.bind(null,"uniformMatrix4x2fv",Nt,8,St),Ze[w.FLOAT_MAT4x3]=mt.bind(null,"uniformMatrix4x3fv",Nt,12,St),Ze[w.SAMPLER_2D]=At,Ze[w.SAMPLER_CUBE]=At,Ze[w.SAMPLER_3D]=At,Ze[w.SAMPLER_2D_SHADOW]=At,Ze[w.SAMPLER_2D_ARRAY]=At,Ze[w.SAMPLER_2D_ARRAY_SHADOW]=At,Ze[w.SAMPLER_CUBE_SHADOW]=At,Ze[w.INT_SAMPLER_2D]=At,Ze[w.INT_SAMPLER_3D]=At,Ze[w.INT_SAMPLER_CUBE]=At,Ze[w.INT_SAMPLER_2D_ARRAY]=At,Ze[w.UNSIGNED_INT_SAMPLER_2D]=At,Ze[w.UNSIGNED_INT_SAMPLER_3D]=At,Ze[w.UNSIGNED_INT_SAMPLER_CUBE]=At,Ze[w.UNSIGNED_INT_SAMPLER_2D_ARRAY]=At,Ze);function Dt(e,t,r){var n=It[r.type];if(!n)throw Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)}var Ft={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function bt(e,t){return"#define ".concat(e," ").concat(t)}function Lt(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function Ut(e){return[e,""]}function Gt(e,t,r,n,i){var o;void 0===n&&(n=null),void 0===i&&(i=!0);var a="#version 100"===e.glslVersion,s="frag"===t&&(null===(o=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,l=r.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),c="";null!==n&&(c=Object.keys(n).map((function(e){return bt(e,n[e])})).join("\n"));var f=l.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",d=i?l.filter((function(e){return!e.startsWith("precision")})).join("\n"):l.join("\n"),h="";if(e.viewportOrigin===oe.UPPER_LEFT&&(h+="".concat(bt("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===ae.ZERO&&(h+="".concat(bt("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var _=0,p=0,E=0;d=d.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,r,n){return"layout(".concat(r?"".concat(r,", "):"","set = ").concat(_,", binding = ").concat(p++,") uniform ").concat(n)})),_++,p=0,me(e.separateSamplerTextures),d=d.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,r,n,i,o){var a=Lt(n);null===a&&(a=p++);var s=u(Ut(i),2),l=s[0],c=s[1];return"frag"===t?"\nlayout(set = ".concat(_,", binding = ").concat(2*a+0,") uniform texture").concat(l," T_").concat(o,";\nlayout(set = ").concat(_,", binding = ").concat(2*a+1,") uniform sampler").concat(c," S_").concat(o,";").trim():""})),d=d.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(E++,") ").concat(t)})),h+="".concat(bt("gl_VertexID","gl_VertexIndex"),"\n"),h+="".concat(bt("gl_InstanceID","gl_InstanceIndex"),"\n"),f=f.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var R=0;d=d.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,r,n,i){var o=Lt(r);return null===o&&(o=R++),"uniform sampler".concat(n," ").concat(i,"; // BINDING=").concat(o)}))}if(d=(d=(d=d.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return"SAMPLER_".concat(t,"(P_").concat(r,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return"PP_SAMPLER_".concat(t,"(P_").concat(r,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(e,t){return"TEXTURE(P_".concat(t,")")})),e.separateSamplerTextures)d=d.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){var n=u(Ut(t),2),i=n[1];return"texture".concat(n[0]," T_P_").concat(r,", sampler").concat(i," S_P_").concat(r)})),d=(d=(d=d.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return"T_".concat(r,", S_").concat(r)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return"sampler".concat(t,"(T_").concat(r,", S_").concat(r,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var v=[];d=(d=(d=d.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return"sampler".concat(t," P_").concat(r)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return r}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,r){return v.push([r,t]),r})),a&&v.forEach((function(e){var t=u(e,2),r=t[0],n=t[1];d=d.replace(RegExp("texture\\(".concat(r),"g"),(function(){return"texture".concat(n,"(").concat(r)}))})),d=d.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var T="".concat(a?"":e.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?f:"","\n").concat(h||"").concat(c?c+"\n":"","\n").concat(d,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(T=T.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),a){if("frag"===t&&(T=T.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"varying ".concat(t," ").concat(r,";\n")}))),"vert"===t&&(T=(T=T.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"varying ".concat(t," ").concat(r,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return"attribute ".concat(t," ").concat(r,";\n")}))),T=T.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var A=[];T=T.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return A.push(t),"vec4 ".concat(t,";\n")}));var m=T.lastIndexOf("}");T=T.substring(0,m)+"\n    ".concat(A.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+T.substring(m)}else{var g;if(T=T.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,r){return g=r,"".concat(t," ").concat(r,";\n")})),g){m=T.lastIndexOf("}");T=T.substring(0,m)+"\n  gl_FragColor = vec4(".concat(g,");\n")+T.substring(m)}}T=T.replace(/^\s*layout\((.*)\)/gm,"")}return T}var wt=function(e){function t(t){var r=t.id,n=t.device,i=e.call(this)||this;return i.id=r,i.device=n,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return n(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(de),kt=function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;n.type=k.Bindings;var i=r.samplerBindings;return n.uniformBufferBindings=r.uniformBufferBindings||[],n.samplerBindings=i||[],n.bindingLayouts=n.createBindingLayouts(),n}return n(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,r=[],n=this.uniformBufferBindings.length,i=this.samplerBindings.length;return r.push({firstUniformBuffer:e,numUniformBuffers:n,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=n,numSamplers:t+=i,bindingLayoutTables:r}},t}(wt);function Vt(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||!(!e||2!==e._version)}function Xt(e){switch(Ee(e)){case le.BC1:case le.BC2:case le.BC3:case le.BC4_UNORM:case le.BC4_SNORM:case le.BC5_UNORM:case le.BC5_SNORM:return!0;default:return!1}}function Wt(e){if(Re(e)&ce.Normalized)return!1;var t=Ee(e);return t===le.S8||t===le.S16||t===le.S32||(t===le.U8||t===le.U16||t===le.U32)}function Ht(e){return e&q.INDEX?w.ELEMENT_ARRAY_BUFFER:e&q.VERTEX?w.ARRAY_BUFFER:e&q.UNIFORM?w.UNIFORM_BUFFER:void 0}function zt(e){var t=Ee(e),r=pe(e),n=Re(e),i=function(e){switch(e){case le.U8:return w.UNSIGNED_BYTE;case le.U16:return w.UNSIGNED_SHORT;case le.U32:return w.UNSIGNED_INT;case le.S8:return w.BYTE;case le.S16:return w.SHORT;case le.S32:return w.INT;case le.F16:return w.HALF_FLOAT;case le.F32:return w.FLOAT;default:throw Error("whoops")}}(t),o=function(e){switch(e){case ue.R:return 1;case ue.RG:return 2;case ue.RGB:return 3;case ue.RGBA:return 4;default:return 1}}(r);return{size:o,type:i,normalized:!!(n&ce.Normalized)}}function Yt(e){switch(e){case Y.CLAMP_TO_EDGE:return w.CLAMP_TO_EDGE;case Y.REPEAT:return w.REPEAT;case Y.MIRRORED_REPEAT:return w.MIRRORED_REPEAT;default:throw Error("whoops")}}function Kt(e,t){if(t===j.LINEAR&&e===K.BILINEAR)return w.LINEAR_MIPMAP_LINEAR;if(t===j.LINEAR&&e===K.POINT)return w.NEAREST_MIPMAP_LINEAR;if(t===j.NEAREST&&e===K.BILINEAR)return w.LINEAR_MIPMAP_NEAREST;if(t===j.NEAREST&&e===K.POINT)return w.NEAREST_MIPMAP_NEAREST;if(t===j.NO_MIP&&e===K.BILINEAR)return w.LINEAR;if(t===j.NO_MIP&&e===K.POINT)return w.NEAREST;throw Error("Unknown texture filter mode")}function jt(e,t){void 0===t&&(t=0);return e.gl_buffer_pages[t/e.pageByteSize|0]}function Zt(e){return e.gl_texture}function qt(e){return e.gl_sampler}function Qt(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function $t(e,t){for(var r=[];;){var n=t.exec(e);if(!n)break;r.push(n)}return r}function Jt(e){return e.blendMode==z.ADD&&e.blendSrcFactor==H.ONE&&e.blendDstFactor===H.ZERO}function er(e){if(e===ee.TEXTURE_2D)return w.TEXTURE_2D;if(e===ee.TEXTURE_2D_ARRAY)return w.TEXTURE_2D_ARRAY;if(e===ee.TEXTURE_CUBE_MAP)return w.TEXTURE_CUBE_MAP;if(e===ee.TEXTURE_3D)return w.TEXTURE_3D;throw Error("whoops")}function tr(e,t,r,n){return e%r==0&&t%n==0}var rr,nr=function(e){function t(t){var r=t.device,n=t.descriptor,i=e.call(this,{id:t.id,device:r})||this;i.type=k.Buffer;var o=n.viewOrSize,a=n.usage,s=n.hint,l=void 0===s?Q.STATIC:s,u=r.uniformBufferMaxPageByteSize,c=r.gl,f=a&q.UNIFORM;f||(Vt(c)?c.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var d,h=E(o)?be(o,4):be(o.byteLength,4);if(i.gl_buffer_pages=[],f){for(var _=h;_>0;)i.gl_buffer_pages.push(i.createBufferPage(Math.min(_,u),a,l)),_-=u;d=u}else i.gl_buffer_pages.push(i.createBufferPage(h,a,l)),d=h;return i.pageByteSize=d,i.byteSize=h,i.usage=a,i.gl_target=Ht(a),E(o)||i.setSubData(0,new Uint8Array(o.buffer)),f||(Vt(c)?c.bindVertexArray(i.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(i.device.currentBoundVAO)),i}return n(t,e),t.prototype.setSubData=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=t.byteLength-r);for(var i=this.device.gl,o=this.pageByteSize,a=e+n,s=e,l=e%o;a>s;){var u=Vt(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=jt(this,s);if(c.ubo)return;i.bindBuffer(u,c),Vt(i)?i.bufferSubData(u,l,t,r,Math.min(a-s,o)):i.bufferSubData(u,l,t),s+=o,l=0,r+=o,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;this.gl_buffer_pages.length>t;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,r){var n=this.device.gl,i=t&q.UNIFORM;if(!Vt(n)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(n.createBuffer()),a=Ht(t),s=function(e){switch(e){case Q.STATIC:return w.STATIC_DRAW;case Q.DYNAMIC:return w.DYNAMIC_DRAW}}(r);return n.bindBuffer(a,o),n.bufferData(a,e,s),o},t}(wt),ir=function(e){function t(t){var r,n,i,o,a,s=t.device,u=t.descriptor,c=e.call(this,{id:t.id,device:s})||this;c.type=k.InputLayout;var d=u.vertexBufferDescriptors,h=u.indexBufferFormat,_=u.program;me(h===fe.U16_R||h===fe.U32_R||null===h);var p=null!==h?function(e){switch(e){case fe.U8_R:return w.UNSIGNED_BYTE;case fe.U16_R:return w.UNSIGNED_SHORT;case fe.U32_R:return w.UNSIGNED_INT;default:throw Error("whoops")}}(h):null,E=null!==h?Te(h):null,R=c.device.gl,v=c.device.ensureResourceExists(Vt(R)?R.createVertexArray():s.OES_vertex_array_object.createVertexArrayOES());Vt(R)?R.bindVertexArray(v):s.OES_vertex_array_object.bindVertexArrayOES(v),R.bindBuffer(R.ARRAY_BUFFER,jt(c.device.fallbackVertexBuffer));try{for(var T=l(u.vertexBufferDescriptors),A=T.next();!A.done;A=T.next()){var m=A.value,g=m.stepMode,S=m.attributes;try{for(var y=(i=void 0,l(S)),C=y.next();!C.done;C=y.next()){var M=C.value,P=M.shaderLocation,B=M.format,N=M.divisor,x=void 0===N?1:N,O=Vt(R)?P:null===(a=_.attributes[P])||void 0===a?void 0:a.location,I=zt(B);if(M.vertexFormat=I,!f(O))Wt(B),R.vertexAttribPointer(O,I.size,I.type,I.normalized,0,0),g===$.INSTANCE&&(Vt(R)?R.vertexAttribDivisor(O,x):s.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(O,x)),R.enableVertexAttribArray(O)}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{A&&!A.done&&(n=T.return)&&n.call(T)}finally{if(r)throw r.error}}return Vt(R)?R.bindVertexArray(null):s.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=d,c.vao=v,c.indexBufferFormat=h,c.indexBufferType=p,c.indexBufferCompByteSize=E,c.program=_,c}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Vt(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(wt),or=function(e){function t(t){var r=t.device,n=t.descriptor,o=t.fake,a=e.call(this,{id:t.id,device:r})||this;a.type=k.Texture,n=i({dimension:ee.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},n);var s,l,u=a.device.gl,c=a.clampmipLevelCount(n);if(a.immutable=n.usage===te.RENDER_TARGET,a.pixelStore=n.pixelStore,a.format=n.format,a.dimension=n.dimension,a.formatKind=Ae(n.format),a.width=n.width,a.height=n.height,a.depthOrArrayLayers=n.depthOrArrayLayers,a.mipmaps=c>=1,!o){l=a.device.ensureResourceExists(u.createTexture());var f=a.device.translateTextureType(n.format),d=a.device.translateTextureInternalFormat(n.format);if(a.device.setActiveTexture(u.TEXTURE0),a.device.currentTextures[0]=null,a.preprocessImage(),n.dimension===ee.TEXTURE_2D){if(u.bindTexture(s=w.TEXTURE_2D,l),a.immutable)if(Vt(u))u.texStorage2D(s,c,d,n.width,n.height);else{var h=(d===w.DEPTH_COMPONENT||a.isNPOT(),0);(a.format!==fe.D32F&&a.format!==fe.D24_S8||Vt(u)||r.WEBGL_depth_texture)&&(u.texImage2D(s,h,d,n.width,n.height,0,d,f,null),a.mipmaps&&(a.mipmaps=!1,u.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),u.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),u.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE)))}me(1===n.depthOrArrayLayers)}else if(n.dimension===ee.TEXTURE_2D_ARRAY)u.bindTexture(s=w.TEXTURE_2D_ARRAY,l),a.immutable&&Vt(u)&&u.texStorage3D(s,c,d,n.width,n.height,n.depthOrArrayLayers);else if(n.dimension===ee.TEXTURE_3D)u.bindTexture(s=w.TEXTURE_3D,l),a.immutable&&Vt(u)&&u.texStorage3D(s,c,d,n.width,n.height,n.depthOrArrayLayers);else{if(n.dimension!==ee.TEXTURE_CUBE_MAP)throw Error("whoops");u.bindTexture(s=w.TEXTURE_CUBE_MAP,l),a.immutable&&Vt(u)&&u.texStorage2D(s,c,d,n.width,n.height),me(6===n.depthOrArrayLayers)}}return a.gl_texture=l,a.gl_target=s,a.mipLevelCount=c,a}return n(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var r=this.device.gl;Xt(this.format);var n=this.gl_target===w.TEXTURE_3D||this.gl_target===w.TEXTURE_2D_ARRAY,i=this.gl_target===w.TEXTURE_CUBE_MAP,o=Object.prototype.toString.call(e[0])in Ft;this.device.setActiveTexture(r.TEXTURE0),this.device.currentTextures[0]=null;var a,s,l=e[0];o?(a=this.width,s=this.height):(s=l.height,this.width=a=l.width,this.height=s),r.bindTexture(this.gl_target,this.gl_texture);var u=this.device.translateTextureFormat(this.format),c=Vt(r)?this.device.translateInternalTextureFormat(this.format):u,f=this.device.translateTextureType(this.format);this.preprocessImage();for(var d=0;this.depthOrArrayLayers>d;d++){var h=e[d],_=this.gl_target;i&&(_=w.TEXTURE_CUBE_MAP_POSITIVE_X+d%6),this.immutable?r.texSubImage2D(_,t,0,0,a,s,u,f,h):Vt(r)?n?r.texImage3D(_,t,c,a,s,this.depthOrArrayLayers,0,u,f,h):r.texImage2D(_,t,c,a,s,0,u,f,h):o?r.texImage2D(_,t,u,a,s,0,u,f,h):r.texImage2D(_,t,u,u,f,h)}this.mipmaps&&this.generateMipmap(n)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Zt(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===ee.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&Ee(e.format)===le.BC1)for(var t=e.width,r=e.height,n=0;e.mipLevelCount>n;n++){if(2>=t||2>=r)return n-1;t=Math.max(t/2|0,1),r=Math.max(r/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(w.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(w.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!Vt(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,w.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,w.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,w.TEXTURE_MIN_FILTER,w.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,w.TEXTURE_MAG_FILTER,w.LINEAR)):t.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!Vt(this.device.gl)&&(!Oe(this.width)||!Oe(this.height))},t}(wt),ar=function(e){function t(t){var r=t.device,n=t.descriptor,i=e.call(this,{id:t.id,device:r})||this;i.type=k.RenderTarget,i.gl_renderbuffer=null,i.texture=null;var o=i.device.gl,a=n.format,s=n.width,l=n.height,u=n.sampleCount,c=void 0===u?1:u,f=n.texture,d=!1;if(a!==fe.D32F&&a!==fe.D24_S8||!f||Vt(o)||r.WEBGL_depth_texture||(f.destroy(),i.texture=null,d=!0),!d&&f)i.texture=f;else{i.gl_renderbuffer=i.device.ensureResourceExists(o.createRenderbuffer()),o.bindRenderbuffer(o.RENDERBUFFER,i.gl_renderbuffer);var h=i.device.translateTextureInternalFormat(a,!0);Vt(o)&&c>1?o.renderbufferStorageMultisample(w.RENDERBUFFER,c,h,s,l):o.renderbufferStorage(w.RENDERBUFFER,h,s,l)}return i.format=a,i.width=s,i.height=l,i.sampleCount=c,i}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(wt);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(rr||(rr={}));var sr=function(e){function t(t,r){var n=t.descriptor,i=e.call(this,{id:t.id,device:t.device})||this;i.rawVertexGLSL=r,i.type=k.Program,i.uniformSetters={},i.attributes=[];var o=i.device.gl;return i.descriptor=n,i.gl_program=i.device.ensureResourceExists(o.createProgram()),i.gl_shader_vert=null,i.gl_shader_frag=null,i.compileState=rr.NeedsCompile,i.tryCompileProgram(),i}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){me(this.compileState===rr.NeedsCompile);var e=this.descriptor,t=e.vertex,r=e.fragment,n=this.device.gl;(null==t?void 0:t.glsl)&&(null==r?void 0:r.glsl)&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,n.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(r.postprocess?r.postprocess(r.glsl):r.glsl,n.FRAGMENT_SHADER),n.attachShader(this.gl_program,this.gl_shader_vert),n.attachShader(this.gl_program,this.gl_shader_frag),n.linkProgram(this.gl_program),this.compileState=rr.Compiling,Vt(n)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,r=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),n=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,r,n){var i=Number(n);return t[r]=isNaN(i)?n:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,n,i){var o=Number(n);return r.push({location:isNaN(o)?t[n]:o,name:i}),""})),r}(this.rawVertexGLSL,n),o=function(r){var n=t.getActiveAttrib(a.gl_program,r),o=n.name,s=n.type,l=n.size,u=t.getAttribLocation(a.gl_program,o),c=null===(e=i.find((function(e){return e.name===o})))||void 0===e?void 0:e.location;0>u||f(c)||(a.attributes[c]={name:o,location:u,type:s,size:l})},a=this,s=0;r>s;s++)o(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),r=0;t>r;r++){var n=e.getActiveUniform(this.gl_program,r),i=Tt(n.name).name,o=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=Dt(e,o,n),n&&n.size>1)for(var a=0;n.size>a;a++)o=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=Dt(e,o,n)}},t.prototype.compileShader=function(e,t){var r=this.device.gl,n=this.device.ensureResourceExists(r.createShader(t));return r.shaderSource(n,e),r.compileShader(n),n},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!Vt(t)){var r=!1;for(var n in e){r||(t.useProgram(this.gl_program),r=!0);var i=this.uniformSetters[n];if(i){var o=e[n];o instanceof or&&(o=o.textureIndex),i(o)}}}return this},t}(wt),lr=function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;n.type=k.QueryPool;var i=n.device.gl;if(Vt(i)){var o=r.type;n.gl_query=Ge(r.elemCount,(function(){return n.device.ensureResourceExists(i.createQuery())})),n.gl_query_type=function(e){if(e===se.OcclusionConservative)return w.ANY_SAMPLES_PASSED_CONSERVATIVE;throw Error("whoops")}(o)}return n}return n(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(Vt(t)){var r=this.gl_query[e];return t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(r,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Vt(t))for(var r=0;this.gl_query.length>r;r++)t.deleteQuery(this.gl_query[r])},t}(wt),ur=function(e){function t(t){var r=e.call(this,{id:t.id,device:t.device})||this;return r.type=k.Readback,r.gl_pbo=null,r.gl_sync=null,r}return n(t,e),t.prototype.clientWaitAsync=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var n=this.device.gl;return new Promise((function(i,o){!function a(){var s=n.clientWaitSync(e,t,0);s!=n.WAIT_FAILED?s!=n.TIMEOUT_EXPIRED?i():setTimeout(a,p(r,0,n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,r,n,i,o){return a(this,void 0,void 0,(function(){var a;return s(this,(function(s){switch(s.label){case 0:return Vt(a=this.device.gl)?(this.gl_sync=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0),a.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),a.bindBuffer(e,t),a.getBufferSubData(e,r,n,i,o),a.bindBuffer(e,null),[2,n];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,r,n,i,o,l,u){return void 0===l&&(l=0),void 0===u&&(u=o.byteLength||0),a(this,void 0,void 0,(function(){var a,c,f,d,h;return s(this,(function(s){var _;return a=this.device.gl,f=this.device.translateTextureFormat((c=e).format),d=this.device.translateTextureType(c.format),h=ve(Ee(_=c.format))*pe(_),Vt(a)?(this.gl_pbo=this.device.ensureResourceExists(a.createBuffer()),a.bindBuffer(a.PIXEL_PACK_BUFFER,this.gl_pbo),a.bufferData(a.PIXEL_PACK_BUFFER,u,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.bindFramebuffer(w.READ_FRAMEBUFFER,this.device.readbackFramebuffer),a.framebufferTexture2D(w.READ_FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,c.gl_texture,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,this.gl_pbo),a.readPixels(t,r,n,i,f,d,l*h),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(a.PIXEL_PACK_BUFFER,this.gl_pbo,0,o,l,0)]):[2,this.readTextureSync(e,t,r,n,i,o,l,u)]}))}))},t.prototype.readTextureSync=function(e,t,r,n,i,o,a,s){void 0===s&&(s=o.byteLength||0);var l=this.device.gl,u=e,c=this.device.translateTextureType(u.format);return l.bindFramebuffer(w.FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,u.gl_texture,0),l.pixelStorei(l.PACK_ALIGNMENT,4),l.readPixels(t,r,n,i,l.RGBA,c,o),o},t.prototype.readBuffer=function(e,t,r,n,i){return a(this,void 0,void 0,(function(){var o;return s(this,(function(a){return Vt(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,jt(e,t),t,r,n,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Vt(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(wt),cr=function(e){function t(t){var r,n,o=t.descriptor,a=e.call(this,{id:t.id,device:t.device})||this;return a.type=k.RenderPipeline,a.drawMode=function(e){switch(e){case Z.TRIANGLES:return w.TRIANGLES;case Z.POINTS:return w.POINTS;case Z.TRIANGLE_STRIP:return w.TRIANGLE_STRIP;case Z.LINES:return w.LINES;case Z.LINE_STRIP:return w.LINE_STRIP;default:throw Error("Unknown primitive topology mode")}}(null!==(r=o.topology)&&void 0!==r?r:Z.TRIANGLES),a.program=o.program,a.inputLayout=o.inputLayout,a.megaState=i(i({},He(Ye)),o.megaStateDescriptor),a.colorAttachmentFormats=o.colorAttachmentFormats.slice(),a.depthStencilAttachmentFormat=o.depthStencilAttachmentFormat,a.sampleCount=null!==(n=o.sampleCount)&&void 0!==n?n:1,a}return n(t,e),t}(wt),fr=function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;return n.type=k.ComputePipeline,n.descriptor=r,n}return n(t,e),t}(wt),dr=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,Error().stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",Error().stack),this.deletionStacks.set(e,Error().stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var r=l(this.liveObjects.values()),n=r.next();!n.done;n=r.next()){var i=n.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),hr=function(e){function t(t){var r,n,i=t.descriptor,o=e.call(this,{id:t.id,device:t.device})||this;o.type=k.Sampler;var a=o.device.gl;if(Vt(a)){var s=o.device.ensureResourceExists(a.createSampler());a.samplerParameteri(s,w.TEXTURE_WRAP_S,Yt(i.addressModeU)),a.samplerParameteri(s,w.TEXTURE_WRAP_T,Yt(i.addressModeV)),a.samplerParameteri(s,w.TEXTURE_WRAP_R,Yt(null!==(r=i.addressModeW)&&void 0!==r?r:i.addressModeU)),a.samplerParameteri(s,w.TEXTURE_MIN_FILTER,Kt(i.minFilter,i.mipmapFilter)),a.samplerParameteri(s,w.TEXTURE_MAG_FILTER,Kt(i.magFilter,j.NO_MIP)),void 0!==i.lodMinClamp&&a.samplerParameterf(s,w.TEXTURE_MIN_LOD,i.lodMinClamp),void 0!==i.lodMaxClamp&&a.samplerParameterf(s,w.TEXTURE_MAX_LOD,i.lodMaxClamp),void 0!==i.compareFunction&&(a.samplerParameteri(s,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.samplerParameteri(s,a.TEXTURE_COMPARE_FUNC,i.compareFunction));var l=null!==(n=i.maxAnisotropy)&&void 0!==n?n:1;l>1&&null!==o.device.EXT_texture_filter_anisotropic&&(me(i.minFilter===K.BILINEAR&&i.magFilter===K.BILINEAR&&i.mipmapFilter===j.LINEAR),a.samplerParameterf(s,o.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l)),o.gl_sampler=s}else o.descriptor=i;return o}return n(t,e),t.prototype.setTextureParameters=function(e,t,r){var n,i=this.device.gl,o=this.descriptor;this.isNPOT(t,r)?i.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR):i.texParameteri(e,w.TEXTURE_MIN_FILTER,Kt(o.minFilter,o.mipmapFilter)),i.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,Yt(o.addressModeU)),i.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,Yt(o.addressModeV)),i.texParameteri(e,w.TEXTURE_MAG_FILTER,Kt(o.magFilter,j.NO_MIP));var a=null!==(n=o.maxAnisotropy)&&void 0!==n?n:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(me(o.minFilter===K.BILINEAR&&o.magFilter===K.BILINEAR&&o.mipmapFilter===j.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Vt(this.device.gl)&&this.device.gl.deleteSampler(qt(this))},t.prototype.isNPOT=function(e,t){return!Oe(e)||!Oe(t)},t}(wt),_r=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,r){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),pr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=k.RenderBundle,t.commands=[],t}return n(t,e),t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach((function(e){return e()}))},t}(wt),Er=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,Rr=function(){function e(e,t){void 0===t&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=He(Ye),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=oe.LOWER_LEFT,this.clipSpaceNearZ=ae.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=ge(e.getContextAttributes()),Vt(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),Vt(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new or({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:ee.TEXTURE_2D,mipLevelCount:1,usage:te.RENDER_TARGET,format:!1===this.contextAttributes.alpha?fe.U8_RGB_RT:fe.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=ie.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(ee.TEXTURE_2D,ie.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(ee.TEXTURE_2D,ie.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:q.VERTEX,hint:Q.STATIC}),Vt(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(ee.TEXTURE_2D_ARRAY,ie.Float),this.fallbackTexture3D=this.createFallbackTexture(ee.TEXTURE_3D,ie.Float),this.fallbackTextureCube=this.createFallbackTexture(ee.TEXTURE_CUBE_MAP,ie.Float)),this.currentMegaState.depthCompare=V.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=re.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new dr)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var r=e===ee.TEXTURE_CUBE_MAP?6:1,n=this.createTexture({dimension:e,format:t===ie.Depth?fe.D32F:fe.U8_RGBA_NORM,usage:te.SAMPLED,width:1,height:1,depthOrArrayLayers:r,mipLevelCount:1});return t===ie.Float&&n.setImageData([new Uint8Array(4*r)]),Zt(n)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(w.MAX_VERTEX_ATTRIBS),Vt(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(w.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?c([],u(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,r){var n=this.scTexture;n.width=e,n.height=t,this.scPlatformFramebuffer=De(r)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case fe.ALPHA:return w.ALPHA;case fe.U8_LUMINANCE:case fe.F16_LUMINANCE:case fe.F32_LUMINANCE:return w.LUMINANCE;case fe.F16_R:return w.R16F;case fe.F16_RG:return w.RG16F;case fe.F16_RGB:return w.RGB16F;case fe.F16_RGBA:return w.RGBA16F;case fe.F32_R:return w.R32F;case fe.F32_RG:return w.RG32F;case fe.F32_RGB:return w.RGB32F;case fe.F32_RGBA:return Vt(this.gl)?w.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:w.RGBA;case fe.U8_R_NORM:return w.R8;case fe.U8_RG_NORM:return w.RG8;case fe.U8_RGB_NORM:case fe.U8_RGB_RT:return w.RGB8;case fe.U8_RGB_SRGB:return w.SRGB8;case fe.U8_RGBA_NORM:case fe.U8_RGBA_RT:return Vt(this.gl)?w.RGBA8:t?w.RGBA4:w.RGBA;case fe.U8_RGBA:return w.RGBA;case fe.U8_RGBA_SRGB:case fe.U8_RGBA_RT_SRGB:return w.SRGB8_ALPHA8;case fe.U16_R:return w.R16UI;case fe.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case fe.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case fe.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case fe.U16_RGBA_5551:return w.RGB5_A1;case fe.U16_RGB_565:return w.RGB565;case fe.U32_R:return w.R32UI;case fe.S8_RGBA_NORM:return w.RGBA8_SNORM;case fe.S8_RG_NORM:return w.RG8_SNORM;case fe.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case fe.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case fe.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case fe.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case fe.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case fe.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case fe.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case fe.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case fe.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case fe.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case fe.D32F_S8:return Vt(this.gl)?w.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?w.DEPTH_STENCIL:w.DEPTH_COMPONENT16;case fe.D24_S8:return Vt(this.gl)?w.DEPTH24_STENCIL8:this.WEBGL_depth_texture?w.DEPTH_STENCIL:w.DEPTH_COMPONENT16;case fe.D32F:return Vt(this.gl)?w.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?w.DEPTH_COMPONENT:w.DEPTH_COMPONENT16;case fe.D24:return Vt(this.gl)?w.DEPTH_COMPONENT24:this.WEBGL_depth_texture?w.DEPTH_COMPONENT:w.DEPTH_COMPONENT16;default:throw Error("whoops")}},e.prototype.translateTextureType=function(e){switch(Ee(e)){case le.U8:return w.UNSIGNED_BYTE;case le.U16:return w.UNSIGNED_SHORT;case le.U32:return w.UNSIGNED_INT;case le.S8:return w.BYTE;case le.F16:return w.HALF_FLOAT;case le.F32:return w.FLOAT;case le.U16_PACKED_5551:return w.UNSIGNED_SHORT_5_5_5_1;case le.D32F:return Vt(this.gl)?w.FLOAT:this.WEBGL_depth_texture?w.UNSIGNED_INT:w.UNSIGNED_BYTE;case le.D24:return Vt(this.gl)?w.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?w.UNSIGNED_SHORT:w.UNSIGNED_BYTE;case le.D24S8:return Vt(this.gl)?w.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?w.UNSIGNED_INT_24_8_WEBGL:w.UNSIGNED_BYTE;case le.D32FS8:return w.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw Error("whoops")}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case fe.F32_R:return w.R32F;case fe.F32_RG:return w.RG32F;case fe.F32_RGB:return w.RGB32F;case fe.F32_RGBA:return w.RGBA32F;case fe.F16_R:return w.R16F;case fe.F16_RG:return w.RG16F;case fe.F16_RGB:return w.RGB16F;case fe.F16_RGBA:return w.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(Xt(e)||e===fe.F32_LUMINANCE||e===fe.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=Vt(this.gl)||!Vt(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case fe.D24_S8:case fe.D32F_S8:return t?w.DEPTH_STENCIL:w.RGBA;case fe.D24:case fe.D32F:return t?w.DEPTH_COMPONENT:w.RGBA}var r=Wt(e);switch(pe(e)){case ue.A:return w.ALPHA;case ue.R:return r?w.RED_INTEGER:w.RED;case ue.RG:return r?w.RG_INTEGER:w.RG;case ue.RGB:return r?w.RGB_INTEGER:w.RGB;case ue.RGBA:return w.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(Vt(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){me(e.compileState!==rr.NeedsCompile),e.compileState===rr.Compiling&&(e.compileState=rr.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new nr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new or({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new hr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new ar({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e.format,r=e.width,n=e.height;return me(1===e.mipLevelCount),this.createRenderTarget({format:t,width:r,height:n,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,r,n,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(r=e.vertex)||void 0===r?void 0:r.glsl)&&(e.vertex.glsl=Gt(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=Gt(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new sr({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new kt({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new ir({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new cr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new _r},e.prototype.createComputePipeline=function(e){return new fr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new ur({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new lr({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,r,n,i,o,a,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(r=e.stencilClearValue)&&void 0!==r?r:"load";for(var l=0;s.length>l;l++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[l]=null!==(n=e.colorAttachmentLevel[l])&&void 0!==n?n:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[l]=null!==(i=e.colorResolveToLevel[l])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[l]=null!==(o=e.colorClearColor[l])&&void 0!==o?o:"load",e.colorStore||(e.colorStore=[]),e.colorStore[l]=null!==(a=e.colorStore[l])&&void 0!==a&&a},e.prototype.createRenderBundle=function(){return new pr({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach((function(e){e.replay()}))},e.prototype.createRenderPass=function(e){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,r=e.colorAttachmentLevel,n=e.colorClearColor,i=e.colorResolveTo,o=e.colorResolveToLevel,a=e.depthStencilAttachment,s=e.depthClearValue,l=e.stencilClearValue,u=e.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(t.length,c);for(var f=0;t.length>f;f++)this.setRenderPassParametersColor(f,t[f],r[f],i[f],o[f],c);this.setRenderPassParametersDepthStencil(a,u,c),this.validateCurrentAttachments();for(f=0;t.length>f;f++){var d=n[f];"load"!==d&&this.setRenderPassParametersClearColor(f,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(s,l),this},e.prototype.submitPass=function(e){me(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptorStack.pop():null},e.prototype.copySubTexture2D=function(e,t,r,n,i,o){var a=this.gl,s=e,l=n;if(me(1===l.mipLevelCount),me(1===s.mipLevelCount),Vt(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,l,0),a.blitFramebuffer(i,o,i+l.width,o+l.height,t,r,t+l.width,r+l.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var u=this.createRenderTargetFromTexture(n);this.submitBlitRenderPass(u,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,r){switch(e){case fe.BC1_SRGB:case fe.BC2_SRGB:case fe.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&tr(t,r,4,4);case fe.BC1:case fe.BC2:case fe.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&tr(t,r,4,4);case fe.BC4_UNORM:case fe.BC4_SNORM:case fe.BC5_UNORM:case fe.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&tr(t,r,4,4);case fe.U16_R_NORM:case fe.U16_RG_NORM:case fe.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case fe.F32_R:case fe.F32_RG:case fe.F32_RGB:case fe.F32_RGBA:return null!==this.OES_texture_float_linear;case fe.F16_R:case fe.F16_RG:case fe.F16_RGB:case fe.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===rr.NeedsCompile)throw Error("whoops");if(e.compileState===rr.Compiling){var r=void 0;return(r=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),r}return e.compileState===rr.NeedsBind||e.compileState===rr.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===k.Buffer)for(var r=e.gl_buffer_pages,n=0;r.length>n;n++)Qt(r[n],"".concat(t," Page ").concat(n));else if(e.type===k.Texture)Qt(Zt(e),t);else if(e.type===k.Sampler)Qt(qt(e),t);else if(e.type===k.RenderTarget){var i=e.gl_renderbuffer;null!==i&&Qt(i,t)}else e.type===k.InputLayout&&Qt(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){me(this.shaderDebug)},e.prototype.getBufferData=function(e,t,r){void 0===r&&(r=0);var n=this.gl;Vt(n)&&(n.bindBuffer(n.COPY_READ_BUFFER,jt(e,4*r)),n.getBufferSubData(n.COPY_READ_BUFFER,4*r,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var r=this.gl,n=r.getShaderParameter(e,r.COMPILE_STATUS);if(!n){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,r){return"".concat(function(e,t,r){for(void 0===r&&(r="0");t>e.length;)e="".concat(r).concat(e);return e}(""+(t+r),4," "),"  ").concat(e)})).join("\n")}(t));var i=r.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(r.getShaderInfoLog(e))}return n},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl;if(!t.getProgramParameter(e.gl_program,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,r,n){var i=this.gl;if(f(r))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(r.type===k.RenderTarget)null!==r.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,r.gl_renderbuffer):null!==r.texture&&i.framebufferTexture2D(e,t,w.TEXTURE_2D,Zt(r.texture),n);else if(r.type===k.Texture){var o=Zt(r);r.dimension===ee.TEXTURE_2D?i.framebufferTexture2D(e,t,w.TEXTURE_2D,o,n):Vt(i)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var r=this.gl,n=f(t)?ce.Depth|ce.Stencil:Re(t.format),i=!!(n&ce.Depth),o=!!(n&ce.Stencil);if(i&&o){var a=Vt(this.gl)||!Vt(this.gl)&&!!this.WEBGL_depth_texture;this.bindFramebufferAttachment(e,a?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,t,0)}else i?(this.bindFramebufferAttachment(e,r.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,r.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(e,r.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,r.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,r=-1,n=0;this.currentColorAttachments.length>n;n++){var i=this.currentColorAttachments[n];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,r=i.height):(me(e===i.sampleCount),me(t===i.width),me(r===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(me(e===this.currentDepthStencilAttachment.sampleCount),me(t===this.currentDepthStencilAttachment.width),me(r===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e,t){void 0===t&&(t=!1);var r=this.gl;if(!t&&(Vt(r)?r.bindFramebuffer(w.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer(w.FRAMEBUFFER,this.renderPassDrawFramebuffer),Vt(r)?r.drawBuffers([w.COLOR_ATTACHMENT0,w.COLOR_ATTACHMENT1,w.COLOR_ATTACHMENT2,w.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([w.COLOR_ATTACHMENT0_WEBGL,w.COLOR_ATTACHMENT1_WEBGL,w.COLOR_ATTACHMENT2_WEBGL,w.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass))for(var n=e;this.currentColorAttachments.length>n;n++){var i=Vt(r)?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,o=Vt(r)?w.COLOR_ATTACHMENT0:w.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(i,o+n,w.RENDERBUFFER,null),r.framebufferTexture2D(i,o+n,w.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,r,n,i,o){void 0===o&&(o=!1);var a=Vt(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===r||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=r,!o&&(a||!a&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(a?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,(a?w.COLOR_ATTACHMENT0:w.COLOR_ATTACHMENT0_WEBGL)+e,t,r),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===n&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=n,this.currentColorResolveToLevels[e]=i,null!==n&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t,r){void 0===r&&(r=!1);var n=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,r||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Vt(n)?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,r,n,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[e])&&o.channelWriteMask!==re.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),o.channelWriteMask=re.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==re.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=re.ALL);this.setScissorRectEnabled(!1),Vt(a)?a.clearBufferfv(a.COLOR,e,[t,r,n,i]):(a.clearColor(t,r,n,i),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var r=this.gl;"load"!==e&&(me(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(r.depthMask(!0),this.currentMegaState.depthWrite=!0),Vt(r)?r.clearBufferfv(r.DEPTH,0,[e]):(r.clearDepth(e),r.clear(r.DEPTH_BUFFER_BIT))),"load"!==t&&(me(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(r.enable(r.STENCIL_TEST),r.stencilMask(255),this.currentMegaState.stencilWrite=!0),Vt(r)?r.clearBufferiv(r.STENCIL,0,[t]):(r.clearStencil(t),r.clear(r.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,r=this;if(this.renderBundle)this.renderBundle.push((function(){return r.setBindings(e)}));else{var n=this.gl,o=e.uniformBufferBindings,a=e.samplerBindings,s=e.bindingLayouts;me(s.bindingLayoutTables.length>0);var l=s.bindingLayoutTables[0];me(o.length>=l.numUniformBuffers),me(a.length>=l.numSamplers);for(var u=0;o.length>u;u++){if(0!==(E=o[u]).size){var c=l.firstUniformBuffer+u,f=E.buffer,d=E.offset||0,h=E.size||f.byteSize;if(f!==this.currentUniformBuffers[c]||d!==this.currentUniformBufferByteOffsets[c]||h!==this.currentUniformBufferByteSizes[c]){var _=d%f.pageByteSize,p=f.gl_buffer_pages[d/f.pageByteSize|0];me(f.pageByteSize>=_+h),Vt(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,c,p,_,h),this.currentUniformBuffers[c]=f,this.currentUniformBufferByteOffsets[c]=d,this.currentUniformBufferByteSizes[c]=h}}}for(u=0;l.numSamplers>u;u++){var E,R=l.firstSampler+u,v=null!==(E=a[u])&&null!==E.sampler?qt(E.sampler):null,T=null!==E&&null!==E.texture?Zt(E.texture):null;if(this.currentSamplers[R]!==v&&(Vt(n)&&n.bindSampler(R,v),this.currentSamplers[R]=v),this.currentTextures[R]!==T){if(this.setActiveTexture(n.TEXTURE0+R),null!==T){var A=ge(E).texture,m=A.gl_target,g=A.width,S=A.height;E.texture.textureIndex=R,n.bindTexture(m,T),Vt(n)||null===(t=E.sampler)||void 0===t||t.setTextureParameters(m,g,S),this.debugGroupStatisticsTextureBind()}else{var y=i(i({},E),qe),C=y.formatKind;m=er(y.dimension);n.bindTexture(m,this.getFallbackTexture(i({gl_target:m,formatKind:C},y)))}this.currentTextures[R]=T}}}},e.prototype.setViewport=function(e,t,r,n){this.gl.viewport(e,t,r,n)},e.prototype.setScissorRect=function(e,t,r,n){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,r,n)},e.prototype.applyAttachmentStateIndexed=function(e,t,r){var n=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==r.channelWriteMask&&(i.colorMaskiOES(e,!!(r.channelWriteMask&re.RED),!!(r.channelWriteMask&re.GREEN),!!(r.channelWriteMask&re.BLUE),!!(r.channelWriteMask&re.ALPHA)),t.channelWriteMask=r.channelWriteMask);var o=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(a||o)&&(Jt(t.rgbBlendState)&&Jt(t.alphaBlendState)?i.enableiOES(e,n.BLEND):Jt(r.rgbBlendState)&&Jt(r.alphaBlendState)&&i.disableiOES(e,n.BLEND)),o&&(i.blendEquationSeparateiOES(e,r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(e,r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var r=this.gl;e.channelWriteMask!==t.channelWriteMask&&(r.colorMask(!!(t.channelWriteMask&re.RED),!!(t.channelWriteMask&re.GREEN),!!(t.channelWriteMask&re.BLUE),!!(t.channelWriteMask&re.ALPHA)),e.channelWriteMask=t.channelWriteMask);var n=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||n)&&(Jt(e.rgbBlendState)&&Jt(e.alphaBlendState)?r.enable(r.BLEND):Jt(t.rgbBlendState)&&Jt(t.alphaBlendState)&&r.disable(r.BLEND)),n&&(r.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(r.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,r=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var n=0;e.attachmentsState.length>n;n++)this.applyAttachmentStateIndexed(n,r.attachmentsState[0],e.attachmentsState[0]);else me(1===e.attachmentsState.length),this.applyAttachmentState(r.attachmentsState[0],e.attachmentsState[0]);Se(r.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),ye(r.blendConstant,e.blendConstant)),r.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),r.depthCompare=e.depthCompare),!!r.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),r.depthWrite=e.depthWrite),!!r.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),r.stencilWrite=e.stencilWrite);var i=!1;if(!ot(r.stencilFront,e.stencilFront)){i=!0;var o=e.stencilFront,a=o.failOp,s=o.depthFailOp,l=o.compare;r.stencilFront.passOp===(u=o.passOp)&&r.stencilFront.failOp===a&&r.stencilFront.depthFailOp===s||(t.stencilOpSeparate(t.FRONT,a,s,u),r.stencilFront.passOp=u,r.stencilFront.failOp=a,r.stencilFront.depthFailOp=s),r.stencilFront.compare!==l&&(this.setStencilReference(0),r.stencilFront.compare=l)}if(!ot(r.stencilBack,e.stencilBack)){i=!0;var u,c=e.stencilBack;a=c.failOp,s=c.depthFailOp,l=c.compare;r.stencilBack.passOp===(u=c.passOp)&&r.stencilBack.failOp===a&&r.stencilBack.depthFailOp===s||(t.stencilOpSeparate(t.BACK,a,s,u),r.stencilBack.passOp=u,r.stencilBack.failOp=a,r.stencilBack.depthFailOp=s),r.stencilBack.compare!==l&&(this.setStencilReference(0),r.stencilBack.compare=l)}r.stencilFront.mask===e.stencilFront.mask&&r.stencilBack.mask===e.stencilBack.mask||(i=!0,r.stencilFront.mask=e.stencilFront.mask,r.stencilBack.mask=e.stencilBack.mask),i&&this.applyStencil(),r.cullMode!==e.cullMode&&(r.cullMode===W.NONE?t.enable(t.CULL_FACE):e.cullMode===W.NONE&&t.disable(t.CULL_FACE),e.cullMode===W.BACK?t.cullFace(t.BACK):e.cullMode===W.FRONT?t.cullFace(t.FRONT):e.cullMode===W.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),r.cullMode=e.cullMode),r.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),r.frontFace=e.frontFace),r.polygonOffset!==e.polygonOffset&&(e.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),r.polygonOffset=e.polygonOffset)},e.prototype.validatePipelineFormats=function(e){for(var t=0;this.currentColorAttachments.length>t;t++);this.currentDepthStencilAttachment&&me(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&me(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle)this.renderBundle.push((function(){return t.setPipeline(e)}));else{this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var r=this.currentPipeline.program;if(this.useProgram(r),r.compileState===rr.NeedsBind){var n=this.gl,i=r.gl_program,o=r.descriptor,a=$t(o.vertex.glsl,Er);if(Vt(n))for(var s=0;a.length>s;s++){var l=u(a[s],2),c=n.getUniformBlockIndex(i,l[1]);-1!==c&&4294967295!==c&&n.uniformBlockBinding(i,c,s)}var f=$t(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;f.length>s;s++){var d=u(f[s],3),h=d[2],_=n.getUniformLocation(i,d[1]);n.uniform1i(_,parseInt(h))}r.compileState=rr.ReadyToUse}}},e.prototype.setVertexInput=function(e,t,r){var n,i,o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.setVertexInput(e,t,r)}));else if(null!==e){me(this.currentPipeline.inputLayout===e);var s=e;this.bindVAO(s.vao);for(var u=this.gl,c=0;s.vertexBufferDescriptors.length>c;c++){var d=s.vertexBufferDescriptors[c],h=d.arrayStride,_=d.attributes;try{for(var p=(n=void 0,l(_)),E=p.next();!E.done;E=p.next()){var R=E.value,v=R.shaderLocation,T=R.offset,A=Vt(u)?v:null===(o=s.program.attributes[v])||void 0===o?void 0:o.location;if(!f(A)){var m=t[c];if(null===m)continue;var g=R.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,jt(m.buffer)),u.vertexAttribPointer(A,g.size,g.type,g.normalized,h,(m.offset||0)+T)}}}catch(e){n={error:e}}finally{try{E&&!E.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(me(null!==r==(null!==s.indexBufferFormat)),null!==r){var S=r.buffer;me(S.usage===q.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,jt(S)),this.currentIndexBufferByteOffset=r.offset||0}else this.currentIndexBufferByteOffset=null}else me(null===this.currentPipeline.inputLayout),me(null===r),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,r,n){var i,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.draw(e,t,r,n)}));else{var a=this.gl,s=this.currentPipeline;if(t){var l=[s.drawMode,r||0,e,t];Vt(a)?a.drawArraysInstanced.apply(a,c([],u(l),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,c([],u(l),!1))}else a.drawArrays(s.drawMode,r,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndexed=function(e,t,r,n,i){var o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.drawIndexed(e,t,r,n,i)}));else{var s=this.gl,l=this.currentPipeline,f=ge(l.inputLayout),d=ge(this.currentIndexBufferByteOffset)+r*f.indexBufferCompByteSize;if(t){var h=[l.drawMode,e,f.indexBufferType,d,t];Vt(s)?s.drawElementsInstanced.apply(s,c([],u(h),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,c([],u(h),!1))}else s.drawElements(l.drawMode,e,f.indexBufferType,d);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(Vt(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(r.gl_query_type,r.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;Vt(e)&&e.endQuery(this.currentRenderPassDescriptor.occlusionQueryPool.gl_query_type)},e.prototype.pipelineQueryReady=function(e){return this.queryProgramReady(e.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=Vt(e),r=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,n=!1,i=0;this.currentColorAttachments.length>i;i++){var o=this.currentColorAttachments[i];if(null!==o){var a=this.currentColorResolveTos[i],s=!1;null!==a&&(me(o.width===a.width&&o.height===a.height),this.setScissorRectEnabled(!1),r||(t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),s=!0,r||(a===this.scTexture?e.bindFramebuffer(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.gl_texture,this.currentColorResolveToLevels[i]))),r||(t?(e.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,a)),n=!0),this.currentRenderPassDescriptor.colorStore[i]||r||s||(e.bindFramebuffer(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,e.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),r||e.bindFramebuffer(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l){var u=this.currentDepthStencilResolveTo;s=!1;u&&(me(l.width===u.width&&l.height===u.height),this.setScissorRectEnabled(!1),r||(e.bindFramebuffer(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,u))),s=!0,r||(t&&e.blitFramebuffer(0,0,l.width,l.height,0,0,u.width,u.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,null)),n=!0),r||this.currentRenderPassDescriptor.depthStencilStore||(s||(e.bindFramebuffer(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,l),s=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),!r&&s&&e.bindFramebuffer(t?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}r||n||e.bindFramebuffer(t?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){f(this.currentStencilRef)||(this.gl.stencilFuncSeparate(w.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(w.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target;if(t===w.TEXTURE_2D)return e.formatKind===ie.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===w.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===w.TEXTURE_3D)return this.fallbackTexture3D;if(t===w.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:q.VERTEX|q.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Z.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[fe.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:He(Ye)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var r=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var n=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[Ne]}),i=this.getCanvas(),o=i.width,a=i.height;n.setPipeline(this.blitRenderPipeline),n.setBindings(this.blitBindings),n.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),n.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),n.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=r,this.inBlitRenderPass=!1},e}(),vr=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return a(this,void 0,void 0,(function(){var t,r,n,i,o,a,l,u,c;return s(this,(function(s){return r=(t=this.pluginOptions).targets,a=t.shaderDebug,l=t.trackResources,u={antialias:void 0!==(n=t.antialias)&&n,preserveDrawingBuffer:void 0!==(i=t.preserveDrawingBuffer)&&i,stencil:!0,premultipliedAlpha:void 0===(o=t.premultipliedAlpha)||o,xrCompatible:t.xrCompatible},this.handleContextEvents(e),r.includes("webgl2")&&(c=e.getContext("webgl2",u)||e.getContext("experimental-webgl2",u)),!c&&r.includes("webgl1")&&(c=e.getContext("webgl",u)||e.getContext("experimental-webgl",u)),[2,new Rr(c,{shaderDebug:a,trackResources:l})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,r=t.onContextLost,n=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),r&&e.addEventListener("webglcontextlost",r,!1),n&&e.addEventListener("webglcontextrestored",n,!1)},e}();const Tr="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&Tr.decode();const Ar=Array(128).fill(void 0);Ar.push(void 0,null,!0,!1);"undefined"!=typeof TextEncoder&&new TextEncoder("utf-8");var mr,gr;function Sr(e){if(e===ee.TEXTURE_2D)return"2d";if(e===ee.TEXTURE_CUBE_MAP)return"cube";if(e===ee.TEXTURE_2D_ARRAY)return"2d-array";if(e===ee.TEXTURE_3D)return"3d";throw Error("whoops")}function yr(e){if(e===Y.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===Y.REPEAT)return"repeat";if(e===Y.MIRRORED_REPEAT)return"mirror-repeat";throw Error("whoops")}function Cr(e){if(e===K.BILINEAR)return"linear";if(e===K.POINT)return"nearest";throw Error("whoops")}function Mr(e){if(e===j.LINEAR)return"linear";if(e===j.NEAREST)return"nearest";if(e===j.NO_MIP)return"nearest";throw Error("whoops")}function Pr(e){return e.gpuBuffer}function Br(e){if(e===se.OcclusionConservative)return"occlusion";throw Error("whoops")}function Nr(e){if(e===V.NEVER)return"never";if(e===V.LESS)return"less";if(e===V.EQUAL)return"equal";if(e===V.LEQUAL)return"less-equal";if(e===V.GREATER)return"greater";if(e===V.NOTEQUAL)return"not-equal";if(e===V.GEQUAL)return"greater-equal";if(e===V.ALWAYS)return"always";throw Error("whoops")}function xr(e){if(e===$.VERTEX)return"vertex";if(e===$.INSTANCE)return"instance";throw Error("whoops")}function Or(e){if(e===fe.U8_R)return"uint8x2";if(e===fe.U8_RG)return"uint8x2";if(e===fe.U8_RGB)return"uint8x4";if(e===fe.U8_RGBA)return"uint8x4";if(e===fe.U8_RG_NORM)return"unorm8x2";if(e===fe.U8_RGBA_NORM)return"unorm8x4";if(e===fe.S8_RGB_NORM)return"snorm8x4";if(e===fe.S8_RGBA_NORM)return"snorm8x4";if(e===fe.U16_RG_NORM)return"unorm16x2";if(e===fe.U16_RGBA_NORM)return"unorm16x4";if(e===fe.S16_RG_NORM)return"snorm16x2";if(e===fe.S16_RGBA_NORM)return"snorm16x4";if(e===fe.S16_RG)return"uint16x2";if(e===fe.F16_RG)return"float16x2";if(e===fe.F16_RGBA)return"float16x4";if(e===fe.F32_R)return"float32";if(e===fe.F32_RG)return"float32x2";if(e===fe.F32_RGB)return"float32x3";if(e===fe.F32_RGBA)return"float32x4";throw"whoops"}function Ir(e,t,r,n){switch(void 0===r&&(r=!1),e){case fe.S8_R:case fe.S8_R_NORM:case fe.S8_RG_NORM:case fe.S8_RGB_NORM:case fe.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return n&&i.set(new Int8Array(n)),i;case fe.U8_R:case fe.U8_R_NORM:case fe.U8_RG:case fe.U8_RG_NORM:case fe.U8_RGB:case fe.U8_RGB_NORM:case fe.U8_RGB_SRGB:case fe.U8_RGBA:case fe.U8_RGBA_NORM:case fe.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(t));return n&&o.set(new Uint8Array(n)),o;case fe.S16_R:case fe.S16_RG:case fe.S16_RG_NORM:case fe.S16_RGB_NORM:case fe.S16_RGBA:case fe.S16_RGBA_NORM:var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&a.set(new Int16Array(n)),a;case fe.U16_R:case fe.U16_RGB:case fe.U16_RGBA_5551:case fe.U16_RGBA_NORM:case fe.U16_RG_NORM:case fe.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&s.set(new Uint16Array(n)),s;case fe.S32_R:var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&l.set(new Int32Array(n)),l;case fe.U32_R:case fe.U32_RG:var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&u.set(new Uint32Array(n)),u;case fe.F32_R:case fe.F32_RG:case fe.F32_RGB:case fe.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&c.set(new Float32Array(n)),c}var f=(ArrayBuffer,new Uint8Array(t));return n&&f.set(new Uint8Array(n)),f}function Dr(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw Error("No fixed size for Stencil8 format!");case"depth24plus":throw Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(mr||(mr={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(gr||(gr={}));var Fr=function(e){function t(t){var r=t.id,n=t.device,i=e.call(this)||this;return i.id=r,i.device=n,i}return n(t,e),t.prototype.destroy=function(){},t}(de);!function(e){function t(t){var r,n,o=t.descriptor,a=e.call(this,{id:t.id,device:t.device})||this;a.type=k.Bindings;var s=o.pipeline;me(!!s);var l=o.uniformBufferBindings,u=o.storageBufferBindings,c=o.samplerBindings,f=o.storageTextureBindings;a.numUniformBuffers=(null==l?void 0:l.length)||0;var d=[[],[],[],[]],h=0;if(l&&l.length)for(var _=0;l.length>_;_++){var p=o.uniformBufferBindings[_],E=p.binding,R=p.size,v=p.offset,T={buffer:Pr(p.buffer),offset:null!=v?v:0,size:R};d[0].push({binding:null!=E?E:h++,resource:T})}if(c&&c.length){h=0;for(_=0;c.length>_;_++){var A=i(i({},c[_]),qe),m=null!==(E=o.samplerBindings[_]).texture?E.texture:a.device.getFallbackTexture(A);if(A.dimension=m.dimension,A.formatKind=Ae(m.format),d[1].push({binding:null!==(r=E.textureBinding)&&void 0!==r?r:h++,resource:m.gpuTextureView}),-1!==E.samplerBinding){var g=null!==E.sampler?E.sampler:a.device.getFallbackSampler(A),S=g.gpuSampler;d[1].push({binding:null!==(n=E.samplerBinding)&&void 0!==n?n:h++,resource:S})}}}if(u&&u.length){h=0;for(_=0;u.length>_;_++){var y=o.storageBufferBindings[_];E=y.binding,R=y.size,v=y.offset,T={buffer:Pr(y.buffer),offset:null!=v?v:0,size:R};d[2].push({binding:null!=E?E:h++,resource:T})}}if(f&&f.length){h=0;for(_=0;f.length>_;_++){var C=o.storageTextureBindings[_];d[3].push({binding:null!=(E=C.binding)?E:h++,resource:(m=C.texture).gpuTextureView})}}var M=d.findLastIndex((function(e){return!!e.length}));return a.gpuBindGroup=d.map((function(e,t){return M>=t&&a.device.device.createBindGroup({layout:s.getBindGroupLayout(t),entries:e})})),a}n(t,e)}(Fr),function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;n.type=k.Buffer;var i=r.usage,o=r.viewOrSize,a=!!(i&q.MAP_READ);n.usage=function(e){var t=0;return e&q.INDEX&&(t|=GPUBufferUsage.INDEX),e&q.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&q.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&q.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&q.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&q.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|GPUBufferUsage.COPY_DST}(i),a&&(n.usage=q.MAP_READ|q.COPY_DST);var s=!E(o);(n.view=E(o)?null:o,n.size=E(o)?be(o,4):be(o.byteLength,4),E(o))?n.gpuBuffer=n.device.device.createBuffer({usage:n.usage,size:n.size,mappedAtCreation:!!a&&s}):(n.gpuBuffer=n.device.device.createBuffer({usage:n.usage,size:n.size,mappedAtCreation:!0}),new(o&&o.constructor||Float32Array)(n.gpuBuffer.getMappedRange()).set(o),n.gpuBuffer.unmap());return n}n(t,e),t.prototype.setSubData=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this.gpuBuffer,o=t.byteOffset+r,a=o+(n=Math.min(n=n||t.byteLength,this.size-e)),s=n+3&-4;if(s!==n){var l=new Uint8Array(t.buffer.slice(o,a));(t=new Uint8Array(s)).set(l),r=0,o=0,a=s,n=s}for(var u=15728640,c=0;a-(o+c)>u;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,u),c+=u;this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,n-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()}}(Fr),function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;n.type=k.ComputePipeline,n.gpuComputePipeline=null,n.descriptor=r;var o=r.program.computeStage;if(null===o)return n;var a={layout:"auto",compute:i({},o)};return n.gpuComputePipeline=n.device.device.createComputePipeline(a),void 0!==n.name&&(n.gpuComputePipeline.label=n.name),n}n(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)}}(Fr),function(e){function t(t){var r,n,i,o,a=t.descriptor,s=e.call(this,{id:t.id,device:t.device})||this;s.type=k.InputLayout;var u=[];try{for(var c=l(a.vertexBufferDescriptors),f=c.next();!f.done;f=c.next()){var d=f.value,h=d.attributes;u.push({arrayStride:d.arrayStride,stepMode:xr(d.stepMode),attributes:[]});try{for(var _=(i=void 0,l(h)),p=_.next();!p.done;p=_.next()){var E=p.value,R=E.offset;u[u.length-1].attributes.push({shaderLocation:E.shaderLocation,format:Or(E.format),offset:R})}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return s.indexFormat=function(e){if(null!==e){if(e===fe.U16_R)return"uint16";if(e===fe.U32_R)return"uint32";throw Error("whoops")}}(a.indexBufferFormat),s.buffers=u,s}n(t,e)}(Fr),function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;return n.type=k.Program,n.vertexStage=null,n.fragmentStage=null,n.computeStage=null,n.descriptor=r,r.vertex&&(n.vertexStage=n.createShaderStage(r.vertex,"vertex")),r.fragment&&(n.fragmentStage=n.createShaderStage(r.fragment,"fragment")),r.compute&&(n.computeStage=n.createShaderStage(r.compute,"compute")),n}n(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var r,n,i=e.glsl,o=e.entryPoint,a=e.postprocess,s=e.wgsl;if(!s)try{s=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),Error("whoops")}var u=function(e){if(!s.includes(e))return"continue";s=(s=s.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,r){return"vec4<f32>(textureSample(T_".concat(e).concat(r,"), 0.0, 0.0, 0.0);")}))};try{for(var c=l(["u_TextureFramebufferDepth"]),f=c.next();!f.done;f=c.next()){u(f.value)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return a&&(s=a(s)),{module:this.device.device.createShaderModule({code:s}),entryPoint:o||"main"}}}(Fr),function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;n.type=k.QueryPool;var i=r.elemCount;return n.querySet=n.device.device.createQuerySet({type:Br(r.type),count:i}),n.resolveBuffer=n.device.device.createBuffer({size:8*i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),n.cpuBuffer=n.device.device.createBuffer({size:8*i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n.results=null,n}n(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()}}(Fr),function(e){function t(t){var r=e.call(this,{id:t.id,device:t.device})||this;return r.type=k.Readback,r}n(t,e),t.prototype.readTexture=function(e,t,r,n,i,o,l,u){return void 0===l&&(l=0),a(this,void 0,void 0,(function(){var a,u,c,f,d,h,_;return s(this,(function(s){return 0,u=Dr((a=e).gpuTextureformat),h=this.device.createBuffer({usage:q.STORAGE|q.MAP_READ|q.COPY_DST,hint:Q.STATIC,viewOrSize:d=(f=256*Math.ceil((c=Math.ceil(n/u.width)*u.length)/256))*i}),(_=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:a.gpuTexture,mipLevel:0,origin:{x:t,y:r,z:0}},{buffer:h.gpuBuffer,offset:0,bytesPerRow:f},{width:n,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([_.finish()]),[2,this.readBuffer(h,0,o.byteLength===d?o:null,l,d,a.format,!0,!1,c,f,i)]}))}))},t.prototype.readTextureSync=function(e,t,r,n,i,o,a,s){throw Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,r,n,i,o,a,s,l,u,c){var f=this;void 0===t&&(t=0),void 0===r&&(r=null),void 0===i&&(i=0),void 0===o&&(o=fe.U8_RGB),void 0===a&&(a=!1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0);var d=e,h=i||d.size,_=r||d.view,p=_&&_.constructor&&_.constructor.BYTES_PER_ELEMENT||Te(o),E=d;if(!(d.usage&q.MAP_READ&&d.usage&q.COPY_DST)){var R=this.device.device.createCommandEncoder();E=this.device.createBuffer({usage:q.STORAGE|q.MAP_READ|q.COPY_DST,hint:Q.STATIC,viewOrSize:h}),R.copyBufferToBuffer(d.gpuBuffer,t,E.gpuBuffer,0,h),this.device.device.queue.submit([R.finish()])}return new Promise((function(e,r){E.gpuBuffer.mapAsync(gr.READ,t,h).then((function(){var r=E.gpuBuffer.getMappedRange(t,h),n=_;if(a)n=null===n?Ir(o,h,!0,r):Ir(o,n.buffer,void 0,r);else if(null===n)switch(p){case 1:(n=new Uint8Array(h)).set(new Uint8Array(r));break;case 2:n=f.getHalfFloatAsFloatRGBAArrayBuffer(h/2,r);break;case 4:(n=new Float32Array(h/4)).set(new Float32Array(r))}else switch(p){case 1:(n=new Uint8Array(n.buffer)).set(new Uint8Array(r));break;case 2:n=f.getHalfFloatAsFloatRGBAArrayBuffer(h/2,r,_);break;case 4:var i=_&&_.constructor||Float32Array;(n=new i(n.buffer)).set(new i(r))}if(l!==u){1!==p||a||(l*=2,u*=2);for(var s=new Uint8Array(n.buffer),d=l,R=0,v=1;c>v;++v){R=v*u;for(var T=0;l>T;++T)s[d++]=s[R++]}n=0===p||a?new Uint8Array(s.buffer,0,d):new Float32Array(s.buffer,0,d/4)}E.gpuBuffer.unmap(),e(n)}),(function(e){return r(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,r){r||(r=new Float32Array(e));for(var n,i,o,a,s=new Uint16Array(t);e--;)r[e]=(i=void 0,o=void 0,a=void 0,i=(32768&(n=s[e]))>>15,a=1023&n,0===(o=(31744&n)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/1024):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/1024));return r}}(Fr),function(e){function t(t){var r=t.descriptor,n=e.call(this,{id:t.id,device:t.device})||this;return n.type=k.RenderPipeline,n.isCreatingAsync=!1,n.gpuRenderPipeline=null,n.descriptor=r,n.device.createRenderPipelineInternal(n,!1),n}n(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)}}(Fr),function(e){function t(t){var r,n,i=t.descriptor,o=e.call(this,{id:t.id,device:t.device})||this;o.type=k.Sampler;var a=i.lodMinClamp,s=i.mipmapFilter===j.NO_MIP?i.lodMinClamp:i.lodMaxClamp,l=null!==(r=i.maxAnisotropy)&&void 0!==r?r:1;return l>1&&me(i.minFilter===K.BILINEAR&&i.magFilter===K.BILINEAR&&i.mipmapFilter===j.LINEAR),o.gpuSampler=o.device.device.createSampler({addressModeU:yr(i.addressModeU),addressModeV:yr(i.addressModeV),addressModeW:yr(null!==(n=i.addressModeW)&&void 0!==n?n:i.addressModeU),lodMinClamp:a,lodMaxClamp:s,minFilter:Cr(i.minFilter),magFilter:Cr(i.magFilter),mipmapFilter:Mr(i.mipmapFilter),compare:void 0!==i.compareFunction?Nr(i.compareFunction):void 0,maxAnisotropy:l}),o}n(t,e)}(Fr),function(e){function t(t){var r=t.descriptor,n=t.skipCreate,i=t.sampleCount,o=e.call(this,{id:t.id,device:t.device})||this;o.type=k.Texture,o.flipY=!1;var a=r.format,s=r.dimension,l=r.width,u=r.height,c=r.depthOrArrayLayers,f=r.mipLevelCount,d=r.usage,h=r.pixelStore;return o.flipY=!!(null==h?void 0:h.unpackFlipY),o.device.createTextureShared({format:a,dimension:null!=s?s:ee.TEXTURE_2D,width:l,height:u,depthOrArrayLayers:null!=c?c:1,mipLevelCount:null!=f?f:1,usage:d,sampleCount:null!=i?i:1},o,n),o}n(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,r){for(var n=t[0].width,i=t[0].height,o={size:{width:n,height:i,depthOrArrayLayers:r},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=e.createTexture(o),s=0;t.length>s;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:a,origin:[0,0,s]},[n,i]);return[a,n,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var r,n,i,o,a=this,s=this.device.device;if(this.isImageBitmapOrCanvases(e))n=(r=u(this.textureFromImageBitmapOrCanvas(s,e,this.depthOrArrayLayers),3))[0],i=r[1],o=r[2];else if(this.isVideo(e))n=s.importExternalTexture({source:e[0]});else{var l=Dr(this.gpuTextureformat),c=Math.ceil(this.width/l.width)*l.length;e.forEach((function(e){s.queue.writeTexture({texture:a.gpuTexture},e,{bytesPerRow:c},{width:a.width,height:a.height})}))}this.width=i,this.height=o,n&&(this.gpuTexture=n),this.gpuTextureView=this.gpuTexture.createView({dimension:Sr(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()}}(Fr),function(e){function t(t){var r=e.call(this,{id:t.id,device:t.device})||this;return r.type=k.RenderBundle,r.renderBundleEncoder=r.device.device.createRenderBundleEncoder({colorFormats:[r.device.swapChainFormat]}),r}n(t,e),t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()}}(Fr);var br={exports:{}};function Lr(e,t,r){r=r||2;var n,i,o,a,s,l,u,c=t&&t.length,f=c?t[0]*r:e.length,d=Ur(e,0,f,r,!0),h=[];if(!d||d.next===d.prev)return h;if(c&&(d=function(e,t,r,n){var i,o,a,s=[];for(i=0,o=t.length;o>i;i++)(a=Ur(e,t[i]*n,o-1>i?t[i+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(jr(a));for(s.sort(Hr),i=0;s.length>i;i++)r=Gr(r=zr(s[i],r),r.next);return r}(e,t,d,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var _=r;f>_;_+=r)n>(s=e[_])&&(n=s),i>(l=e[_+1])&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return wr(d,h,r,n,i,u),h}function Ur(e,t,r,n,i){var o,a;if(i===ln(e,t,r,n)>0)for(o=t;r>o;o+=n)a=on(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=on(o,e[o],e[o+1],a);return a&&$r(a,a.next)&&(an(a),a=a.next),a}function Gr(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!$r(n,n.next)&&0!==Qr(n.prev,n,n.next))n=n.next;else{if(an(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function wr(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=Kr(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,s,l,u=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;u>t&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0===s||0!==l&&n&&r.z>n.z?(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(e,n,i,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Vr(e,n,i,o):kr(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),an(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?wr(e=Xr(Gr(e),t,r),t,r,n,i,o,2):2===a&&Wr(e,t,r,n,i,o):wr(Gr(e),t,r,n,i,o,1);break}}}function kr(e){var t=e.prev,r=e,n=e.next;if(Qr(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Zr(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Qr(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Vr(e,t,r,n){var i=e.prev,o=e,a=e.next;if(Qr(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=Kr(o.x>i.x?a.x>i.x?i.x:a.x:a.x>o.x?o.x:a.x,o.y>i.y?a.y>i.y?i.y:a.y:a.y>o.y?o.y:a.y,t,r,n),c=Kr(s,l,t,r,n),f=e.prevZ,d=e.nextZ;f&&f.z>=u&&d&&c>=d.z;){if(f!==e.prev&&f!==e.next&&Zr(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Qr(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==e.prev&&d!==e.next&&Zr(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Qr(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&Zr(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Qr(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&c>=d.z;){if(d!==e.prev&&d!==e.next&&Zr(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Qr(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Xr(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!$r(i,o)&&Jr(i,n,n.next,o)&&rn(i,o)&&rn(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),an(n),an(n.next),n=e=o),n=n.next}while(n!==e);return Gr(n)}function Wr(e,t,r,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&qr(a,s)){var l=nn(a,s);return a=Gr(a,a.next),l=Gr(l,l.next),wr(a,t,r,n,i,o),void wr(l,t,r,n,i,o)}s=s.next}a=a.next}while(a!==e)}function Hr(e,t){return e.x-t.x}function zr(e,t){var r=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(n.y>=o&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(i>=s&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.next.x>n.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var l,u=r,c=r.x,f=r.y,d=1/0;n=r;do{n.x>i||c>n.x||i===n.x||!Zr(f>o?i:a,o,c,f,f>o?a:i,o,n.x,n.y)||(l=Math.abs(o-n.y)/(i-n.x),rn(n,e)&&(d>l||l===d&&(n.x>r.x||n.x===r.x&&Yr(r,n)))&&(r=n,d=l)),n=n.next}while(n!==u);return r}(e,t);if(!r)return t;var n=nn(r,e),i=Gr(r,r.next);return Gr(n,n.next),t===r?i:t}function Yr(e,t){return 0>Qr(e.prev,e,t.prev)&&0>Qr(t.next,e,e.next)}function Kr(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jr(e){var t=e,r=e;do{(r.x>t.x||t.x===r.x&&r.y>t.y)&&(r=t),t=t.next}while(t!==e);return r}function Zr(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function qr(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Jr(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(rn(e,t)&&rn(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x>i&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Qr(e.prev,e,t.prev)||Qr(e,t.prev,t))||$r(e,t)&&Qr(e.prev,e,e.next)>0&&Qr(t.prev,t,t.next)>0)}function Qr(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function $r(e,t){return e.x===t.x&&e.y===t.y}function Jr(e,t,r,n){var i=tn(Qr(e,t,r)),o=tn(Qr(e,t,n)),a=tn(Qr(r,n,e)),s=tn(Qr(r,n,t));return i!==o&&a!==s||(!(0!==i||!en(e,r,t))||(!(0!==o||!en(e,n,t))||(!(0!==a||!en(r,e,n))||!(0!==s||!en(r,t,n)))))}function en(e,t,r){return!(t.x>Math.max(e.x,r.x)||Math.min(e.x,r.x)>t.x||t.y>Math.max(e.y,r.y)||Math.min(e.y,r.y)>t.y)}function tn(e){return e>0?1:0>e?-1:0}function rn(e,t){return 0>Qr(e.prev,e,e.next)?Qr(e,t,e.next)>=0&&Qr(e,e.prev,t)>=0:0>Qr(e,t,e.prev)||0>Qr(e,e.next,t)}function nn(e,t){var r=new sn(e.i,e.x,e.y),n=new sn(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function on(e,t,r,n){var i=new sn(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function an(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function sn(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ln(e,t,r,n){for(var i=0,o=t,a=r-n;r>o;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}br.exports=Lr,br.exports.default=Lr,Lr.deviation=function(e,t,r,n){var i=t&&t.length,o=Math.abs(ln(e,0,i?t[0]*r:e.length,r));if(i)for(var a=0,s=t.length;s>a;a++){o-=Math.abs(ln(e,t[a]*r,s-1>a?t[a+1]*r:e.length,r))}var l=0;for(a=0;n.length>a;a+=3){var u=n[a]*r,c=n[a+1]*r,f=n[a+2]*r;l+=Math.abs((e[u]-e[f])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[f+1]-e[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Lr.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;e.length>i;i++){for(var o=0;e[i].length>o;o++)for(var a=0;t>a;a++)r.vertices.push(e[i][o][a]);i>0&&r.holes.push(n+=e[i-1].length)}return r};var un=br.exports;function cn(e,t,r,n){var i=e-r,o=t-n;return Math.sqrt(i*i+o*o)}function fn(e,t,r,n,i){return{x:(1-i)*e+i*r,y:(1-i)*t+i*n}}function dn(e,t,r,n,i){var o=1-i;return o*o*o*e+3*t*i*o*o+3*r*i*i*o+n*i*i*i}function hn(e,t,r,n,i,o,a,s,l){if(0===l)return function(e,t){for(var r=0,n=e.length,i=0;n>i;i++)r+=cn(e[i],t[i],e[(i+1)%n],t[(i+1)%n]);return r/2}([e,r,i,a],[t,n,o,s]);var f=function(e,t,r,n,i,o,a,s,l){var u=dn(e,r,i,a,l),c=dn(t,n,o,s,l),f=fn(e,t,r,n,l),d=fn(r,n,i,o,l),h=fn(i,o,a,s,l),_=fn(f.x,f.y,d.x,d.y,l),p=fn(d.x,d.y,h.x,h.y,l);return[[e,t,f.x,f.y,_.x,_.y,u,c],[u,c,p.x,p.y,h.x,h.y,a,s]]}(e,t,r,n,i,o,a,s,.5),d=c(c([],u(f[0]),!1),[l-1],!1),h=c(c([],u(f[1]),!1),[l-1],!1);return hn.apply(void 0,c([],u(d),!1))+hn.apply(void 0,c([],u(h),!1))}function _n(e,t,r,n){var i=1-n;return i*i*e+2*n*i*t+n*n*r}function pn(e,t,r,n,i,o,a){if(0===a)return(cn(e,t,r,n)+cn(r,n,i,o)+cn(e,t,i,o))/2;var s=function(e,t,r,n,i,o,a){var s=_n(e,r,i,a),l=_n(t,n,o,a),u=fn(e,t,r,n,a),c=fn(r,n,i,o,a);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,o]]}(e,t,r,n,i,o,.5),l=s[0],f=s[1];return l.push(a-1),f.push(a-1),pn.apply(void 0,c([],u(l),!1))+pn.apply(void 0,c([],u(f),!1))}var En=function(){function e(){this.drawcalls=[]}return e.tag="c-renderable-3d",e}(),Rn=function(){function e(){this.lights=[]}return e.prototype.addLight=function(e){this.lights.push(e),this.sortLights()},e.prototype.removeLight=function(e){var t=this.lights.indexOf(e);this.lights.splice(t,1),this.sortLights()},e.prototype.addFog=function(e){this.fog=e},e.prototype.removeFog=function(e){this.fog=null},e.prototype.getFog=function(){return this.fog},e.prototype.getAllLights=function(){return this.lights},e.prototype.getDefines=function(){var e={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(t){e[t.define]||(e[t.define]=0),e[t.define]++})),e},e.prototype.sortLights=function(){this.lights.sort((function(e,t){return e.order-t.order}))},e}(),vn=function(e){function r(r){var n=this,a=r.style,s=o(r,["style"]);return(n=e.call(this,i({type:t.Shape.MESH,style:i({x:"",y:"",z:"",lineWidth:0},a)},s))||this).cullable.enable=!1,n.style.geometry.meshes.push(n),n.style.material.meshes.push(n),n}return n(r,e),r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.style.geometry.meshes,r=t.indexOf(this);t.splice(r,1),r=(t=this.style.material.meshes).indexOf(this),t.splice(r,1)},r}(t.DisplayObject),Tn=function(){function e(){}return e.prototype.update=function(e){var t=e.x,r=void 0===t?0:t,n=e.y,i=void 0===n?0:n,o=e.z,a=void 0===o?0:o,s=e.geometry.computeBoundingBox();return{cx:r,cy:i,cz:a,hwidth:s.halfExtents[0],hheight:s.halfExtents[1],hdepth:s.halfExtents[2]}},e}(),An=function(){function e(){this.counter=0,this.id2DisplayObjectMap={}}return e.prototype.getId=function(e){var t=this.counter++;return this.id2DisplayObjectMap[t]=e,t},e.prototype.getById=function(e){return this.id2DisplayObjectMap[e]},e.prototype.deleteById=function(e){delete this.id2DisplayObjectMap[e]},e.prototype.reset=function(){this.counter=0,this.id2DisplayObjectMap={}},e.prototype.decodePickingColor=function(e){var t=u(e,3);return t[0]+256*t[1]+65536*t[2]-1},e.prototype.encodePickingColor=function(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]},e}(),mn=function(){function e(){this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={}}return e.prototype.definesChanged=function(){this.preprocessedVert="",this.preprocessedFrag=""},e.prototype.setDefineString=function(e,t){if(null!==t){if(this.defines[e]===t)return!1;this.defines[e]=t}else{if(f(this.defines[e]))return!1;delete this.defines[e]}return this.definesChanged(),!0},e.prototype.setDefineBool=function(e,t){return this.setDefineString(e,t?"1":null)},e.prototype.getDefineString=function(e){return De(this.defines[e])},e.prototype.getDefineBool=function(e){var t=this.getDefineString(e);return null!==t&&me("1"===t),null!==t},e}(),gn=function(){function e(e){this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=e;var t=e.queryLimits();this.uniformBufferWordAlignment=t.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=t.uniformBufferMaxPageWordSize}return e.prototype.isSupportedUBO=function(){return"WebGL1"!==this.device.queryVendorInfo().platformString},e.prototype.findPageIndex=function(e){return e/this.uniformBufferMaxPageWordSize|0},e.prototype.allocateChunk=function(e){e=Le(e,this.uniformBufferWordAlignment),me(this.uniformBufferMaxPageWordSize>e);var t=this.currentWordOffset;return this.findPageIndex(t)!==this.findPageIndex(t+e-1)&&(t=Le(t,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=t+e,this.ensureShadowBuffer(t,e),t},e.prototype.ensureShadowBuffer=function(e,t){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var r=Le(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*r),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(e+t>=this.shadowBufferF32.length){me(this.currentWordOffset>e&&this.currentWordOffset>=e+t);r=Le(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize);var n=new Uint8Array(4*r);if(n.set(this.shadowBufferU8,0),this.shadowBufferU8=n,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),r<this.currentWordOffset)throw Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}},e.prototype.mapBufferF32=function(){return ge(this.shadowBufferF32)},e.prototype.prepareToRender=function(){if(null!==this.shadowBufferF32){var e=ge(this.shadowBufferF32);e.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=e.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:q.UNIFORM,hint:Q.DYNAMIC}));var t=Le(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(this.currentBufferWordSize<t)throw Error("Assert fail: wordCount [".concat(t,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())ge(this.buffer).setSubData(0,this.shadowBufferU8,0,4*t);this.currentWordOffset=0}},e.prototype.destroy=function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null},e}();function Sn(e,t){return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function yn(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function Cn(e){return 0}var Mn=function(){this.keys=[],this.values=[]},Pn=function(){function e(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}return e.prototype.findBucketIndex=function(e,t){for(var r=0;e.keys.length>r;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1},e.prototype.findBucket=function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)},e.prototype.get=function(e){var t=this.findBucket(e);if(void 0===t)return null;var r=this.findBucketIndex(t,e);return 0>r?null:t.values[r]},e.prototype.add=function(e,t){var r=this.keyHashFunc(e);void 0===this.buckets.get(r)&&this.buckets.set(r,new Mn);var n=this.buckets.get(r);n.keys.push(e),n.values.push(t)},e.prototype.delete=function(e){var t=this.findBucket(e);if(void 0!==t){var r=this.findBucketIndex(t,e);-1!==r&&(t.keys.splice(r,1),t.values.splice(r,1))}},e.prototype.clear=function(){this.buckets.clear()},e.prototype.size=function(){var e,t,r=0;try{for(var n=l(this.buckets.values()),i=n.next();!i.done;i=n.next()){r+=i.value.values.length}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},e.prototype.values=function(){var e,t,r,n,i,o,a;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,9]),e=l(this.buckets.values()),t=e.next(),s.label=1;case 1:if(t.done)return[3,6];n=(r=t.value).values.length-1,s.label=2;case 2:return n<0?[3,5]:[4,r.values[n]];case 3:s.sent(),s.label=4;case 4:return n--,[3,2];case 5:return t=e.next(),[3,1];case 6:return[3,9];case 7:return i=s.sent(),o={error:i},[3,9];case 8:try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(o)throw o.error}return[7];case 9:return[2]}}))},e}();function Bn(e,t){var r=void 0!==t.defines?t.defines:null,n=void 0!==t.both?t.both+t.vert:t.vert,i=void 0!==t.both?t.both+t.frag:t.frag;return function(e,t,r,n){return void 0===n&&(n=null),{vert:t,frag:r,preprocessedVert:Gt(e,"vert",t,n),preprocessedFrag:Gt(e,"frag",r,n)}}(e.queryVendorInfo(),n,i,r)}function Nn(e,t){return me(""!==e.preprocessedVert&&""!==t.preprocessedVert),me(""!==e.preprocessedFrag&&""!==t.preprocessedFrag),e.preprocessedVert===t.preprocessedVert&&e.preprocessedFrag===t.preprocessedFrag}function xn(e,t){return e=Sn(e,t.blendMode),e=Sn(e,t.blendSrcFactor),e=Sn(e,t.blendDstFactor)}function On(e,t){return e=xn(e,t.rgbBlendState),e=Sn(e=xn(e,t.alphaBlendState),t.channelWriteMask)}function In(e,t){for(var r,n,i,o,a,s,l,u,c=0;t.attachmentsState.length>c;c++)e=On(e,t.attachmentsState[c]);return e=function(e,t){return Sn(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant),e=Sn(e,t.depthCompare),e=Sn(e,t.depthWrite?1:0),e=Sn(e,null===(r=t.stencilFront)||void 0===r?void 0:r.compare),e=Sn(e,null===(n=t.stencilFront)||void 0===n?void 0:n.passOp),e=Sn(e,null===(i=t.stencilFront)||void 0===i?void 0:i.failOp),e=Sn(e,null===(o=t.stencilFront)||void 0===o?void 0:o.depthFailOp),e=Sn(e,null===(a=t.stencilBack)||void 0===a?void 0:a.compare),e=Sn(e,null===(s=t.stencilBack)||void 0===s?void 0:s.passOp),e=Sn(e,null===(l=t.stencilBack)||void 0===l?void 0:l.failOp),e=Sn(e,null===(u=t.stencilBack)||void 0===u?void 0:u.depthFailOp),e=Sn(e,t.stencilWrite?1:0),e=Sn(e,t.cullMode),e=Sn(e,t.frontFace?1:0),e=Sn(e,t.polygonOffset?1:0)}function Dn(e){var t=0;t=Sn(t,e.program.id),null!==e.inputLayout&&(t=Sn(t,e.inputLayout.id)),t=In(t,e.megaStateDescriptor);for(var r=0;e.colorAttachmentFormats.length>r;r++)t=Sn(t,e.colorAttachmentFormats[r]||0);return yn(t=Sn(t,e.depthStencilAttachmentFormat||0))}function Fn(e){for(var t=0,r=0;e.samplerBindings.length>r;r++){null!==(n=e.samplerBindings[r])&&null!==n.texture&&(t=Sn(t,n.texture.id))}for(r=0;e.uniformBufferBindings.length>r;r++){var n;null!==(n=e.uniformBufferBindings[r])&&null!==n.buffer&&(t=Sn(t,n.buffer.id),t=Sn(t,n.binding),t=Sn(t,n.offset),t=Sn(t,n.size))}return yn(t)}var bn,Ln,Un=function(){function e(e){this.bindingsCache=new Pn(rt,Fn),this.renderPipelinesCache=new Pn(lt,Dn),this.inputLayoutsCache=new Pn(ft,Cn),this.programCache=new Pn(Nn,Cn),this.samplerCache=new Pn(dt,Cn),this.device=e}return e.prototype.createBindings=function(e){var t,r=this.bindingsCache.get(e);if(null===r){var n={samplerBindings:(t=e).samplerBindings&&$e(t.samplerBindings,ht),uniformBufferBindings:t.uniformBufferBindings&&$e(t.uniformBufferBindings,_t),storageBufferBindings:t.storageBufferBindings&&$e(t.storageBufferBindings,_t),storageTextureBindings:t.storageTextureBindings&&$e(t.storageTextureBindings,pt),pipeline:t.pipeline};n.uniformBufferBindings=n.uniformBufferBindings.filter((function(e){return e.size>0})),r=this.device.createBindings(n),this.bindingsCache.add(n,r)}return r},e.prototype.createRenderPipeline=function(e){var t,r,n,i=this.renderPipelinesCache.get(e);if(null===i){var o=(r=(t=e).program,n=t.topology,{inputLayout:t.inputLayout,megaStateDescriptor:t.megaStateDescriptor&&He(t.megaStateDescriptor),program:r,topology:n,colorAttachmentFormats:t.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:t.depthStencilAttachmentFormat,sampleCount:t.sampleCount});o.colorAttachmentFormats=o.colorAttachmentFormats.filter((function(e){return e})),i=this.device.createRenderPipeline(o),this.renderPipelinesCache.add(o,i)}return i},e.prototype.createInputLayout=function(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter((function(e){return!!e}));var t,r=this.inputLayoutsCache.get(e);if(null===r){var n={vertexBufferDescriptors:$e((t=e).vertexBufferDescriptors,Rt),indexBufferFormat:t.indexBufferFormat,program:t.program};r=this.device.createInputLayout(n),this.inputLayoutsCache.add(n,r)}return r},e.prototype.createProgramSimple=function(e){var t,r=e.vert,n=e.preprocessedFrag,i=e.preprocessedVert,o=null;if(i&&n&&(o=this.programCache.get({vert:r,frag:e.frag,preprocessedFrag:n,preprocessedVert:i})),null===o){var a=Bn(this.device,e),s=a.preprocessedVert,l=a.preprocessedFrag;e.preprocessedVert=s,e.preprocessedFrag=l;var u={preprocessedVert:(t=e).preprocessedVert,preprocessedFrag:t.preprocessedFrag,vert:t.vert,frag:t.frag};o=this.device.createProgramSimple({vertex:{glsl:s},fragment:{glsl:l}},r),this.programCache.add(u,o)}return o},e.prototype.createSampler=function(e){var t=this.samplerCache.get(e);return null===t&&(t=this.device.createSampler(e),this.samplerCache.add(e,t)),t},e.prototype.destroy=function(){var e,t,r,n,i,o,a,s,u,c;try{for(var f=l(this.bindingsCache.values()),d=f.next();!d.done;d=f.next()){d.value.destroy()}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}try{for(var h=l(this.renderPipelinesCache.values()),_=h.next();!_.done;_=h.next()){_.value.destroy()}}catch(e){r={error:e}}finally{try{_&&!_.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}try{for(var p=l(this.inputLayoutsCache.values()),E=p.next();!E.done;E=p.next()){E.value.destroy()}}catch(e){i={error:e}}finally{try{E&&!E.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}try{for(var R=l(this.programCache.values()),v=R.next();!v.done;v=R.next()){v.value.destroy()}}catch(e){a={error:e}}finally{try{v&&!v.done&&(s=R.return)&&s.call(R)}finally{if(a)throw a.error}}try{for(var T=l(this.samplerCache.values()),A=T.next();!A.done;A=T.next()){A.value.destroy()}}catch(e){u={error:e}}finally{try{A&&!A.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()},e}();!function(e){e.NONE="none",e.LINEAR="LinearToneMapping",e.REINHARD="ReinhardToneMapping",e.CINEON="OptimizedCineonToneMapping",e.ACES_FILMIC="ACESFilmicToneMapping",e.CUSTOM="CustomToneMapping"}(bn||(bn={})),function(e){e[e.Color0=0]="Color0",e[e.Color1=1]="Color1",e[e.Color2=2]="Color2",e[e.Color3=3]="Color3",e[e.ColorMax=3]="ColorMax",e[e.DepthStencil=4]="DepthStencil"}(Ln||(Ln={}));var Gn,wn=function(){function e(){this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}return e.prototype.setDebugName=function(e){this.debugName=e},e.prototype.pushDebugThumbnail=function(e){this.debugThumbnails[e]=!0},e.prototype.setViewport=function(e,t,r,n){this.viewportX=e,this.viewportY=t,this.viewportW=r,this.viewportH=n},e.prototype.attachRenderTargetID=function(e,t,r){void 0===r&&(r=0),me(void 0===this.renderTargetIDs[e]),this.renderTargetIDs[e]=t,this.renderTargetLevels[e]=r},e.prototype.attachResolveTexture=function(e){this.resolveTextureInputIDs.push(e)},e.prototype.attachOcclusionQueryPool=function(e){this.descriptor.occlusionQueryPool=e},e.prototype.exec=function(e){me(null===this.execFunc),this.execFunc=e},e.prototype.post=function(e){me(null===this.postFunc),this.postFunc=e},e.prototype.addExtraRef=function(e){this.renderTargetExtraRefs[e]=!0},e}(),kn=function(){function e(e,t){this.dimension=ee.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=te.RENDER_TARGET,this.needsClear=!0,this.texture=null,this.age=0,this.format=t.format,this.width=t.width,this.height=t.height,this.sampleCount=t.sampleCount,me(this.sampleCount>=1),this.sampleCount>1?this.attachment=e.createRenderTarget(this):(this.texture=e.createTexture(this),this.attachment=e.createRenderTargetFromTexture(this.texture))}return e.prototype.setDebugName=function(e,t){this.debugName=t,null!==this.texture&&e.setResourceName(this.texture,this.debugName),e.setResourceName(this.attachment,this.debugName)},e.prototype.matchesDescription=function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height&&this.sampleCount===e.sampleCount},e.prototype.reset=function(e){me(this.matchesDescription(e)),this.age=0},e.prototype.destroy=function(){this.attachment.destroy()},e}(),Vn=function(){function e(e,t){this.dimension=ee.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.usage=te.RENDER_TARGET,this.width=0,this.height=0,this.age=0,this.format=t.format,this.width=t.width,this.height=t.height,this.texture=e.createTexture(this)}return e.prototype.matchesDescription=function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height},e.prototype.reset=function(e){me(this.matchesDescription(e)),this.age=0},e.prototype.destroy=function(){this.texture.destroy()},e}(),Xn=function(){this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},Wn=function(){function e(e){this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=e}return e.prototype.acquireRenderTargetForDescription=function(e){for(var t=0;this.renderTargetDeadPool.length>t;t++){var r=this.renderTargetDeadPool[t];if(r.matchesDescription(e))return r.reset(e),this.renderTargetDeadPool.splice(t--,1),r}return new kn(this.device,e)},e.prototype.acquireSingleSampledTextureForDescription=function(e){for(var t=0;this.singleSampledTextureDeadPool.length>t;t++){var r=this.singleSampledTextureDeadPool[t];if(r.matchesDescription(e))return r.reset(e),this.singleSampledTextureDeadPool.splice(t--,1),r}return new Vn(this.device,e)},e.prototype.beginGraphBuilder=function(){me(null===this.currentGraph),this.currentGraph=new Xn},e.prototype.pushPass=function(e){var t=new wn;e(t),this.currentGraph.passes.push(t)},e.prototype.createRenderTargetID=function(e,t){return this.currentGraph.renderTargetDebugNames.push(t),this.currentGraph.renderTargetDescriptions.push(e)-1},e.prototype.createResolveTextureID=function(e){return this.currentGraph.resolveTextureRenderTargetIDs.push(e)-1},e.prototype.findMostRecentPassThatAttachedRenderTarget=function(e){for(var t=this.currentGraph.passes.length-1;t>=0;t--){var r=this.currentGraph.passes[t];if(r.renderTargetIDs.includes(e))return r}return null},e.prototype.resolveRenderTargetPassAttachmentSlot=function(e,t){var r=e;if(void 0===r.resolveTextureOutputIDs[t]){var n=this.createResolveTextureID(r.renderTargetIDs[t]);r.resolveTextureOutputIDs[t]=n}return r.resolveTextureOutputIDs[t]},e.prototype.findPassForResolveRenderTarget=function(e){var t=ge(this.findMostRecentPassThatAttachedRenderTarget(e)),r=t.renderTargetIDs.indexOf(e);return me(void 0===t.resolveTextureOutputExternalTextures[r]),t},e.prototype.resolveRenderTarget=function(e){var t=this.findPassForResolveRenderTarget(e),r=t.renderTargetIDs.indexOf(e);return this.resolveRenderTargetPassAttachmentSlot(t,r)},e.prototype.resolveRenderTargetToExternalTexture=function(e,t,r){void 0===r&&(r=0);var n=this.findPassForResolveRenderTarget(e),i=n.renderTargetIDs.indexOf(e);me(void 0===n.resolveTextureOutputIDs[i]),n.resolveTextureOutputExternalTextures[i]=t,n.resolveTextureOutputExternalTextureLevel[i]=r},e.prototype.getRenderTargetDescription=function(e){return ge(this.currentGraph.renderTargetDescriptions[e])},e.prototype.scheduleAddUseCount=function(e,t){for(var r=0;t.renderTargetIDs.length>r;r++){void 0!==(i=t.renderTargetIDs[r])&&(this.renderTargetOutputCount[i]++,t.renderTargetExtraRefs[r]&&this.renderTargetOutputCount[i]++)}for(var n=0;t.resolveTextureInputIDs.length>n;n++){var i,o=t.resolveTextureInputIDs[n];if(void 0!==o)this.resolveTextureUseCount[o]++,this.renderTargetResolveCount[i=e.resolveTextureRenderTargetIDs[o]]++}},e.prototype.acquireRenderTargetForID=function(e,t){if(void 0===t)return null;if(me(this.renderTargetOutputCount[t]>0),!this.renderTargetAliveForID[t]){var r=this.acquireRenderTargetForDescription(e.renderTargetDescriptions[t]);r.setDebugName(this.device,e.renderTargetDebugNames[t]),this.renderTargetAliveForID[t]=r}return this.renderTargetAliveForID[t]},e.prototype.releaseRenderTargetForID=function(e,t){if(void 0===e)return null;var r=ge(this.renderTargetAliveForID[e]);return t?(me(this.renderTargetOutputCount[e]>0),this.renderTargetOutputCount[e]--):(me(this.renderTargetResolveCount[e]>0),this.renderTargetResolveCount[e]--),0===this.renderTargetOutputCount[e]&&0===this.renderTargetResolveCount[e]&&(r.needsClear=!0,delete this.renderTargetAliveForID[e],this.renderTargetDeadPool.push(r)),r},e.prototype.acquireResolveTextureInputTextureForID=function(e,t){var r=e.resolveTextureRenderTargetIDs[t];me(this.resolveTextureUseCount[t]>0),this.resolveTextureUseCount[t]--;var n=ge(this.releaseRenderTargetForID(r,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[t]){var i=this.singleSampledTextureForResolveTextureID[t];return 0===this.resolveTextureUseCount[t]&&this.singleSampledTextureDeadPool.push(i),i.texture}return ge(n.texture)},e.prototype.determineResolveParam=function(e,t,r){var n=t.renderTargetIDs[r],i=t.resolveTextureOutputIDs[r],o=t.resolveTextureOutputExternalTextures[r],a=void 0!==i,s=void 0!==o;me(!(a&&s));var l=null,u=!1,c=0;if(this.renderTargetOutputCount[n]>1&&(u=!0),a){me(e.resolveTextureRenderTargetIDs[i]===n),me(this.resolveTextureUseCount[i]>0),me(this.renderTargetOutputCount[n]>0);var f=ge(this.renderTargetAliveForID[n]);if(null!==f.texture&&1===this.renderTargetOutputCount[n])l=null,u=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var d=ge(e.renderTargetDescriptions[n]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(d),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,f.debugName+" (Resolve ".concat(i,")"))}l=this.singleSampledTextureForResolveTextureID[i].texture}}else s?(l=o,c=t.resolveTextureOutputExternalTextureLevel[r]):l=null;return{resolveTo:l,store:u,level:c}},e.prototype.schedulePass=function(e,t){for(var r=t.renderTargetIDs[Ln.DepthStencil],n=Ln.Color0;Ln.ColorMax>=n;n++){var i=t.renderTargetIDs[n],o=this.acquireRenderTargetForID(e,i);t.renderTargets[n]=o,t.descriptor.colorAttachment[n]=null!==o?o.attachment:null,t.descriptor.colorAttachmentLevel[n]=t.renderTargetLevels[n];var a=this.determineResolveParam(e,t,n),s=a.store,l=a.level;t.descriptor.colorResolveTo[n]=a.resolveTo,t.descriptor.colorResolveToLevel[n]=l,t.descriptor.colorStore[n]=s,t.descriptor.colorClearColor[n]=null!==o&&o.needsClear?e.renderTargetDescriptions[i].colorClearColor:"load"}var u=this.acquireRenderTargetForID(e,r);t.renderTargets[Ln.DepthStencil]=u,t.descriptor.depthStencilAttachment=null!==u?u.attachment:null;var c=this.determineResolveParam(e,t,Ln.DepthStencil),f=c.store;t.descriptor.depthStencilResolveTo=c.resolveTo,t.descriptor.depthStencilStore=f,t.descriptor.depthClearValue=null!==u&&u.needsClear?e.renderTargetDescriptions[r].depthClearValue:"load",t.descriptor.stencilClearValue=null!==u&&u.needsClear?e.renderTargetDescriptions[r].stencilClearValue:"load";for(var d=0,h=0,_=0,p=0;t.renderTargets.length>p;p++){var E=t.renderTargets[p];if(E){var R=E.width>>>t.renderTargetLevels[p],v=E.height>>>t.renderTargetLevels[p];0===d&&(d=R,h=v,_=E.sampleCount),me(R===d),me(v===h),me(E.sampleCount===_),E.needsClear=!1}}d>0&&h>0&&(t.viewportX*=d,t.viewportY*=h,t.viewportW*=d,t.viewportH*=h);for(p=0;t.resolveTextureInputIDs.length>p;p++){t.resolveTextureInputTextures[p]=this.acquireResolveTextureInputTextureForID(e,t.resolveTextureInputIDs[p])}for(p=0;t.renderTargetIDs.length>p;p++)this.releaseRenderTargetForID(t.renderTargetIDs[p],!0);for(n=0;t.renderTargetExtraRefs.length>n;n++)t.renderTargetExtraRefs[n]&&this.releaseRenderTargetForID(t.renderTargetIDs[n],!0)},e.prototype.scheduleGraph=function(e){me(0===this.renderTargetOutputCount.length),me(0===this.renderTargetResolveCount.length),me(0===this.resolveTextureUseCount.length);for(var t=0;this.renderTargetDeadPool.length>t;t++)this.renderTargetDeadPool[t].age++;for(t=0;this.singleSampledTextureDeadPool.length>t;t++)this.singleSampledTextureDeadPool[t].age++;Fe(this.renderTargetOutputCount,e.renderTargetDescriptions.length,0),Fe(this.renderTargetResolveCount,e.renderTargetDescriptions.length,0),Fe(this.resolveTextureUseCount,e.resolveTextureRenderTargetIDs.length,0);for(t=0;e.passes.length>t;t++)this.scheduleAddUseCount(e,e.passes[t]);for(t=0;e.passes.length>t;t++)this.schedulePass(e,e.passes[t]);for(t=0;this.renderTargetOutputCount.length>t;t++)me(0===this.renderTargetOutputCount[t]);for(t=0;this.renderTargetResolveCount.length>t;t++)me(0===this.renderTargetResolveCount[t]);for(t=0;this.resolveTextureUseCount.length>t;t++)me(0===this.resolveTextureUseCount[t]);for(t=0;this.renderTargetAliveForID.length>t;t++)me(void 0===this.renderTargetAliveForID[t]);for(t=0;this.renderTargetDeadPool.length>t;t++)1>this.renderTargetDeadPool[t].age||(this.renderTargetDeadPool[t].destroy(),this.renderTargetDeadPool.splice(t--,1));for(t=0;this.singleSampledTextureDeadPool.length>t;t++)1>this.singleSampledTextureDeadPool[t].age||(this.singleSampledTextureDeadPool[t].destroy(),this.singleSampledTextureDeadPool.splice(t--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0},e.prototype.execPass=function(e){me(null===this.currentPass),this.currentPass=e;var t=this.device.createRenderPass(e.descriptor);t.pushDebugGroup(e.debugName),t.setViewport(e.viewportX,e.viewportY,e.viewportW,e.viewportH),null!==e.execFunc&&e.execFunc(t,this),t.popDebugGroup(),this.device.submitPass(t),null!==e.postFunc&&e.postFunc(this),this.currentPass=null},e.prototype.execGraph=function(e){var t=this;this.scheduleGraph(e),this.device.beginFrame(),e.passes.forEach((function(e){t.execPass(e)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0},e.prototype.execute=function(){var e=ge(this.currentGraph);this.execGraph(e),this.currentGraph=null},e.prototype.getDebug=function(){return this},e.prototype.getPasses=function(){return this.currentGraph.passes},e.prototype.getPassDebugThumbnails=function(e){return e.debugThumbnails},e.prototype.getPassRenderTargetID=function(e,t){return e.renderTargetIDs[t]},e.prototype.getRenderTargetIDDebugName=function(e){return this.currentGraph.renderTargetDebugNames[e]},e.prototype.getResolveTextureForID=function(e){var t=this.currentPass,r=t.resolveTextureInputIDs.indexOf(e);return me(r>=0),ge(t.resolveTextureInputTextures[r])},e.prototype.getRenderTargetAttachment=function(e){var t=this.currentPass.renderTargets[e];return t?t.attachment:null},e.prototype.getRenderTargetTexture=function(e){var t=this.currentPass.renderTargets[e];return t?t.texture:null},e.prototype.newGraphBuilder=function(){return this.beginGraphBuilder(),this},e.prototype.destroy=function(){for(var e=0;this.renderTargetAliveForID.length>e;e++)me(void 0===this.renderTargetAliveForID[e]);for(e=0;this.singleSampledTextureForResolveTextureID.length>e;e++)me(void 0===this.singleSampledTextureForResolveTextureID[e]);for(e=0;this.renderTargetDeadPool.length>e;e++)this.renderTargetDeadPool[e].destroy();for(e=0;this.singleSampledTextureDeadPool.length>e;e++)this.singleSampledTextureDeadPool[e].destroy()},e}();!function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.ALPHA_TEST=16]="ALPHA_TEST",e[e.OPAQUE=32]="OPAQUE",e[e.TRANSLUCENT=128]="TRANSLUCENT"}(Gn||(Gn={}));var Hn=65536,zn=16;function Yn(e,t,r){void 0===r&&(r=Hn);var n=p(e,0,r)/r;return t&&(n=1-n),65535&n*((1<<zn)-1)}function Kn(e,t){return(16777215&e|(255&t)<<24)>>>0}function jn(e,t){return!!(e>>>31&1)?e:(4278190335&e|(65535&t)<<8)>>>0}function Zn(e,t){return Kn(jn(0,t),e)}function qn(e,t){return me(t>=0),(4294967040&e|t>>>8&255)>>>0}function Qn(e){return Kn(0,e)}function $n(e,t){return me(t>=0),(4278190335&e|t<<8)>>>0}var Jn=m(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);var ei,ti=m(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function ri(e,t,r,n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),e[t+0]=r,e[t+1]=n,e[t+2]=i,e[t+3]=o,4}!function(e){e[e.None=0]="None",e[e.Indexed=1]="Indexed",e[e.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",e[e.Template=4]="Template",e[e.Draw=8]="Draw",e[e.InheritedFlags=3]="InheritedFlags"}(ei||(ei={}));var ni,ii=function(){function e(){this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=Ge(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=Ge(4,(function(){return 0})),this.flags=0,this.vertexBuffers=null,this.indexBuffer=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={inputLayout:null,megaStateDescriptor:He(Ye),program:null,topology:Z.TRIANGLES,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}return e.prototype.reset=function(){this.sortKey=0,this.flags=ei.AllowSkippingIfPipelineNotReady,this.vertexBuffers=null,this.indexBuffer=null,this.renderPipelineDescriptor.inputLayout=null},e.prototype.setFromTemplate=function(e){var t,r;We(this.renderPipelineDescriptor.megaStateDescriptor,e.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=e.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=e.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=e.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,e.renderPipelineDescriptor.colorAttachmentFormats.length);for(var n=0;e.renderPipelineDescriptor.colorAttachmentFormats.length>n;n++)this.renderPipelineDescriptor.colorAttachmentFormats[n]=e.renderPipelineDescriptor.colorAttachmentFormats[n];this.renderPipelineDescriptor.depthStencilAttachmentFormat=e.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=e.renderPipelineDescriptor.sampleCount,this.uniformBuffer=e.uniformBuffer,this.uniforms=c([],u(e.uniforms),!1),this.drawCount=e.drawCount,this.drawStart=e.drawStart,this.drawInstanceCount=e.drawInstanceCount,this.vertexBuffers=e.vertexBuffers,this.indexBuffer=e.indexBuffer,this.flags=this.flags&~ei.InheritedFlags|e.flags&ei.InheritedFlags,this.sortKey=e.sortKey;var i=this.bindingDescriptors[0],o=e.bindingDescriptors[0];this.setBindingLayout({numSamplers:null===(t=o.samplerBindings)||void 0===t?void 0:t.length,numUniformBuffers:null===(r=o.uniformBufferBindings)||void 0===r?void 0:r.length});for(n=0;Math.min(i.uniformBufferBindings.length,o.uniformBufferBindings.length)>n;n++)i.uniformBufferBindings[n].size=e.bindingDescriptors[0].uniformBufferBindings[n].size;this.setSamplerBindingsFromTextureMappings(o.samplerBindings);for(n=0;e.dynamicUniformBufferByteOffsets.length>n;n++)this.dynamicUniformBufferByteOffsets[n]=e.dynamicUniformBufferByteOffsets[n]},e.prototype.validate=function(){for(var e,t=0;this.bindingDescriptors.length>t;t++)for(var r=this.bindingDescriptors[t],n=0;n<(null===(e=r.uniformBufferBindings)||void 0===e?void 0:e.length);n++)me(r.uniformBufferBindings[n].size>0);me(this.drawCount>0)},e.prototype.setProgram=function(e){this.renderPipelineDescriptor.program=e},e.prototype.setMegaStateFlags=function(e){return We(this.renderPipelineDescriptor.megaStateDescriptor,e),this.renderPipelineDescriptor.megaStateDescriptor},e.prototype.getMegaStateFlags=function(){return this.renderPipelineDescriptor.megaStateDescriptor},e.prototype.setVertexInput=function(e,t,r){this.vertexBuffers=t,this.indexBuffer=r,this.renderPipelineDescriptor.inputLayout=e},e.prototype.setBindingLayout=function(e){me(this.dynamicUniformBufferByteOffsets.length>e.numUniformBuffers);for(var t=this.bindingDescriptors[0].uniformBufferBindings.length;e.numUniformBuffers>t;t++)this.bindingDescriptors[0].uniformBufferBindings.push({binding:t,buffer:null,size:0});for(t=this.bindingDescriptors[0].samplerBindings.length;e.numSamplers>t;t++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null})},e.prototype.drawIndexes=function(e,t){void 0===t&&(t=0),this.flags=Ue(this.flags,ei.Indexed,!0),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1},e.prototype.drawIndexesInstanced=function(e,t,r){void 0===r&&(r=0),this.flags=Ue(this.flags,ei.Indexed,!0),this.drawCount=e,this.drawStart=r,this.drawInstanceCount=t},e.prototype.drawPrimitives=function(e,t){void 0===t&&(t=0),this.flags=Ue(this.flags,ei.Indexed,!1),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1},e.prototype.setUniforms=function(e,t){if(0!==t.length){this.uniforms[e]=t;var r=0,n=[];t.forEach((function(e){var t=e.value;if(E(t)||Array.isArray(t)||t instanceof Float32Array){var i=E(t)?[t]:t,o=4-r%4;if(4!==o)if(o<(i.length>4?4:i.length)){r+=o;for(var a=0;o>a;a++)n.push(0)}else;r+=i.length,n.push.apply(n,c([],u(i),!1))}}));var i=4-n.length%4;if(4!==i)for(var o=0;i>o;o++)n.push(0);for(var a=this.allocateUniformBuffer(e,n.length),s=this.mapUniformBufferF32(e),l=0;n.length>l;l+=4)a+=ri(s,a,n[l],n[l+1],n[l+2],n[l+3])}},e.prototype.setUniformBuffer=function(e){this.uniformBuffer=e},e.prototype.allocateUniformBuffer=function(e,t){var r;return me((null===(r=this.bindingDescriptors[0].uniformBufferBindings)||void 0===r?void 0:r.length)<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[e]=this.uniformBuffer.allocateChunk(t)<<2,this.bindingDescriptors[0].uniformBufferBindings[e].size=t<<2,this.getUniformBufferOffset(e)},e.prototype.getUniformBufferOffset=function(e){return this.dynamicUniformBufferByteOffsets[e]>>>2},e.prototype.mapUniformBufferF32=function(e){return this.uniformBuffer.mapBufferF32()},e.prototype.getUniformBuffer=function(){return this.uniformBuffer},e.prototype.setSamplerBindingsFromTextureMappings=function(e){e=e.filter((function(e){return e}));for(var t=0;this.bindingDescriptors[0].samplerBindings.length>t;t++){var r=this.bindingDescriptors[0].samplerBindings[t],n=e[t];null!=n?(r.texture=n.texture,r.sampler=n.sampler):(r.texture=null,r.sampler=null)}},e.prototype.setAllowSkippingIfPipelineNotReady=function(e){this.flags=Ue(this.flags,ei.AllowSkippingIfPipelineNotReady,e)},e.prototype.setAttachmentFormatsFromRenderPass=function(e,t){for(var r=e.queryRenderPass(t),n=-1,i=0;r.colorAttachment.length>i;i++){var o=null!==r.colorAttachment[i]?e.queryRenderTarget(r.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==o?o.format:null,null!==o&&(-1===n?n=o.sampleCount:me(n===o.sampleCount))}var a=null!==r.depthStencilAttachment?e.queryRenderTarget(r.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==a?a.format:null,null!==a&&(-1===n?n=a.sampleCount:me(n==a.sampleCount)),me(n>0),this.renderPipelineDescriptor.sampleCount=n},e.prototype.drawOnPass=function(e,t){var r=this,n=e.device;this.setAttachmentFormatsFromRenderPass(n,t);var o=e.createRenderPipeline(this.renderPipelineDescriptor);if(!n.pipelineQueryReady(o)){if(this.flags&ei.AllowSkippingIfPipelineNotReady)return!1;n.pipelineForceReady(o)}t.setPipeline(o),t.setVertexInput(this.renderPipelineDescriptor.inputLayout,this.vertexBuffers,this.indexBuffer);for(var a=0;this.bindingDescriptors[0].uniformBufferBindings.length>a;a++)this.bindingDescriptors[0].uniformBufferBindings[a].buffer=ge(this.uniformBuffer.buffer),this.bindingDescriptors[0].uniformBufferBindings[a].offset=this.dynamicUniformBufferByteOffsets[a];this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(e){var t={};e.forEach((function(e){t[e.name]=e.value})),r.renderPipelineDescriptor.program.setUniformsLegacy(t)}));var s=e.createBindings(i(i({},this.bindingDescriptors[0]),{pipeline:o}));return t.setBindings(s),this.flags&ei.Indexed?t.drawIndexed(this.drawCount,this.drawInstanceCount,this.drawStart,0,0):t.draw(this.drawCount,this.drawInstanceCount,this.drawStart,0),!0},e}();function oi(e,t){return e.sortKey-t.sortKey}!function(e){e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards"}(ni||(ni={}));var ai=function(){function e(e,t){void 0===e&&(e=oi),void 0===t&&(t=ni.Forwards),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=e,this.executionOrder=t}return e.prototype.checkUsePostSort=function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500},e.prototype.insertSorted=function(e){var t,r,n;null===this.compareFunction||this.usePostSort?this.renderInsts.push(e):(n=function(e,t,r){for(var n=0,i=e.length;i>n;){var o=n+(i-n>>>1);0>r(t,e[o])?i=o:n=o+1}return n}(t=this.renderInsts,r=e,this.compareFunction),t.splice(n,0,r)),this.checkUsePostSort()},e.prototype.submitRenderInst=function(e){e.flags|=ei.Draw,this.insertSorted(e)},e.prototype.ensureSorted=function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)},e.prototype.drawOnPassRendererNoReset=function(e,t){if(this.ensureSorted(),this.executionOrder===ni.Forwards)for(var r=0;this.renderInsts.length>r;r++)this.renderInsts[r].drawOnPass(e,t);else for(r=this.renderInsts.length-1;r>=0;r--)this.renderInsts[r].drawOnPass(e,t)},e.prototype.reset=function(){this.renderInsts.length=0},e.prototype.drawOnPassRenderer=function(e,t){this.drawOnPassRendererNoReset(e,t),this.reset()},e}(),si=function(){function e(){this.pool=[],this.allocCount=0}return e.prototype.allocRenderInstIndex=function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new ii),this.allocCount-1},e.prototype.popRenderInst=function(){this.allocCount--},e.prototype.reset=function(){for(var e=0;this.pool.length>e;e++)this.pool[e].reset();this.allocCount=0},e.prototype.destroy=function(){this.pool.length=0,this.allocCount=0},e}(),li=function(){function e(e){this.renderCache=e,this.instPool=new si,this.templatePool=new si,this.simpleRenderInstList=new ai,this.currentRenderInstList=this.simpleRenderInstList}return e.prototype.newRenderInst=function(){var e=this.templatePool.allocCount-1,t=this.instPool.allocRenderInstIndex(),r=this.instPool.pool[t];return r.debug=null,0>e||r.setFromTemplate(this.templatePool.pool[e]),r},e.prototype.submitRenderInst=function(e,t){void 0===t&&(t=this.currentRenderInstList),t.submitRenderInst(e)},e.prototype.setCurrentRenderInstList=function(e){me(null===this.simpleRenderInstList),this.currentRenderInstList=e},e.prototype.pushTemplateRenderInst=function(){var e=this.templatePool.allocCount-1,t=this.templatePool.allocRenderInstIndex(),r=this.templatePool.pool[t];return 0>e||r.setFromTemplate(this.templatePool.pool[e]),r.flags|=ei.Template,r},e.prototype.popTemplateRenderInst=function(){this.templatePool.popRenderInst()},e.prototype.getTemplateRenderInst=function(){return this.templatePool.pool[this.templatePool.allocCount-1]},e.prototype.resetRenderInsts=function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),me(0===this.templatePool.allocCount)},e.prototype.destroy=function(){this.instPool.destroy(),this.renderCache.destroy()},e.prototype.disableSimpleMode=function(){this.simpleRenderInstList=null},e.prototype.drawOnPassRenderer=function(e){ge(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,e)},e.prototype.drawOnPassRendererNoReset=function(e){ge(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,e)},e}(),ui=function(){function e(e){this.parameters=e}return e.prototype.getDevice=function(){return this.device},e.prototype.setDevice=function(e){this.device=e,this.renderCache=new Un(e),this.renderGraph=new Wn(this.device),this.renderInstManager=new li(this.renderCache),this.uniformBuffer=new gn(this.device)},e.prototype.pushTemplateRenderInst=function(){var e=this.renderInstManager.pushTemplateRenderInst();return e.setUniformBuffer(this.uniformBuffer),e},e.prototype.prepareToRender=function(){this.uniformBuffer.prepareToRender()},e.prototype.destroy=function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()},e.prototype.getCache=function(){return this.renderCache},e.prototype.getDefines=function(){var e,t,r;return{USE_TONEMAPPING:(null===(e=this.parameters)||void 0===e?void 0:e.toneMapping)&&(null===(t=this.parameters)||void 0===t?void 0:t.toneMapping)!==bn.NONE,toneMapping:null===(r=this.parameters)||void 0===r?void 0:r.toneMapping}},e}(),ci=function(){function e(e){this.format=e,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load"}return e.prototype.setDimensions=function(e,t,r){this.width=e,this.height=t,this.sampleCount=r},e.prototype.copyDimensions=function(e){this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount},e}();function fi(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}var di,hi=fi(Me(.88,.88,.88,1)),_i=fi(Be),pi=fi(xe);function Ei(e,t){var r=function(e){return e.antialiasingMode===di.MSAAx4?4:1}(t);e.setDimensions(t.backbufferWidth,t.backbufferHeight,r)}function Ri(e,t,r){var n=function(e){if(e===Ln.Color0)return fe.U8_RGBA_RT;if(e===Ln.DepthStencil)return fe.D24_S8;throw Error("whoops")}(e),i=new ci(n);return Ei(i,t),null!==r&&(i.colorClearColor=r.colorClearColor,i.depthClearValue=r.depthClearValue,i.stencilClearValue=r.stencilClearValue),i}!function(e){e[e.None=0]="None",e[e.FXAA=1]="FXAA",e[e.MSAAx4=2]="MSAAx4"}(di||(di={}));var vi,Ti=function(){function e(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}return e.prototype.reset=function(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0},e.prototype.copy=function(e){this.texture=e.texture,this.sampler=e.sampler,this.width=e.width,this.height=e.height,this.lodBias=e.lodBias},e}(),Ai=function(){function e(){this.inputTexture=null,this.outputTexture=null}return e.prototype.setDescription=function(e,t){this.inputTexture!==this.outputTexture&&(null!==this.inputTexture&&this.inputTexture.destroy(),this.inputTexture=this.outputTexture),me(this.inputTexture===this.outputTexture),null!==this.outputTexture&&this.outputTexture.matchesDescription(t)||(this.outputTexture=new Vn(e,t),null===this.inputTexture&&(this.inputTexture=this.outputTexture))},e.prototype.getTextureForSampling=function(){return null!==this.inputTexture?this.inputTexture.texture:null},e.prototype.getTextureForResolving=function(){var e;return null===(e=this.outputTexture)||void 0===e?void 0:e.texture},e.prototype.destroy=function(){null!==this.outputTexture&&this.outputTexture!==this.inputTexture&&(this.outputTexture.destroy(),this.outputTexture=null),null!==this.inputTexture&&(this.inputTexture.destroy(),this.inputTexture=null)},e}(),mi=function(e){function t(r){void 0===r&&(r={});var n=r.style,a=o(r,["style"]);return e.call(this,i({type:t.tag,style:i({intensity:Math.PI},n)},a))||this}return n(t,e),t.tag="light",t}(t.DisplayObject);!function(e){e[e.NONE=0]="NONE",e[e.EXP=1]="EXP",e[e.EXP2=2]="EXP2",e[e.LINEAR=3]="LINEAR"}(vi||(vi={}));var gi,Si=function(e){function t(r){void 0===r&&(r={});var n=r.style,a=o(r,["style"]);return e.call(this,i({type:t.tag,style:i({type:vi.NONE,fill:"black",start:1,end:1e3,density:0},n)},a))||this}return n(t,e),t.tag="fog",t}(t.DisplayObject);function yi(e,t,r,n){void 0===n&&(n=Q.STATIC);var i=e.createBuffer({viewOrSize:r.byteLength,usage:t,hint:n});return i.setSubData(0,new Uint8Array(r)),i}!function(e){e.CHANGED="changed"}(gi||(gi={}));var Ci,Mi,Pi=function(e){function r(t,r){void 0===r&&(r={});var n=e.call(this)||this;return n.device=t,n.props=r,n.drawMode=Z.TRIANGLES,n.vertexBuffers=[],n.vertices=[],n.inputLayoutDescriptor={vertexBufferDescriptors:[],indexBufferFormat:null,program:null},n.vertexCount=0,n.instancedCount=0,n.indexStart=0,n.primitiveStart=0,n.dirty=!0,n.meshes=[],n}return n(r,e),r.prototype.validate=function(e){return!0},r.prototype.build=function(e){},r.prototype.computeBoundingBox=function(){return new t.AABB},r.prototype.setIndexBuffer=function(e){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=yi(this.device,q.INDEX,new Uint32Array(ArrayBuffer.isView(e)?e.buffer:e).buffer),this.indices=e,this.inputLayoutDescriptor.indexBufferFormat=fe.U32_R,this},r.prototype.setVertexBuffer=function(e){var t=this,r=e.bufferIndex,n=e.attributes,i=e.data;this.inputLayoutDescriptor.vertexBufferDescriptors[r]={arrayStride:e.byteStride,stepMode:e.stepMode,attributes:[]},this.vertices[r]=i,n.forEach((function(e){var n=e.format,i=e.bufferByteOffset,o=e.location,a=e.divisor,s=t.inputLayoutDescriptor.vertexBufferDescriptors[r].attributes.find((function(e){return e.shaderLocation===o}));s?(s.format=n,s.offset=i,s.divisor=a):t.inputLayoutDescriptor.vertexBufferDescriptors[r].attributes.push({format:n,offset:i,shaderLocation:o,divisor:a})})),this.vertexBuffers[r]&&this.vertexBuffers[r].destroy();var o=yi(this.device,q.VERTEX,i.buffer,Q.DYNAMIC);return this.vertexBuffers[r]=o,this},r.prototype.getVertexBuffer=function(e){return this.vertexBuffers[e]},r.prototype.updateVertexBuffer=function(e,t,r,n){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[e];if(i){var o=i.arrayStride,a=this.inputLayoutDescriptor.vertexBufferDescriptors[e].attributes.find((function(e){return e.shaderLocation===t}));if(a)this.getVertexBuffer(e).setSubData(a.offset+r*o,n);this.emit(gi.CHANGED)}},r.prototype.updateIndices=function(e,t){return void 0===t&&(t=0),this.indexBuffer&&this.indexBuffer.setSubData(t,new Uint8Array(ArrayBuffer.isView(e)?e:new Uint32Array(e))),this},r.prototype.destroy=function(){this.vertexBuffers.forEach((function(e){e&&e.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0},r}(de),Bi=function(e){function t(){var t=e.apply(this,c([],u(arguments),!1))||this;return t.features={},t.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",t.vert="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",t.frag="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",t}return n(t,e),t}(mn),Ni=Ge(1,(function(){return new Ti}));function xi(e,t,r,n){e.pushPass((function(i){i.setDebugName("FXAA"),i.attachRenderTargetID(Ln.Color0,n);var o=e.resolveRenderTarget(n);i.attachResolveTexture(o);var a=t.renderInstManager.newRenderInst();a.setUniformBuffer(t.uniformBuffer),a.setAllowSkippingIfPipelineNotReady(!1),a.setMegaStateFlags(Ke),a.setBindingLayout({numUniformBuffers:1,numSamplers:1}),a.drawPrimitives(3);var s=a.allocateUniformBuffer(0,4);ri(a.mapUniformBufferF32(0),s,1/r.backbufferWidth,1/r.backbufferHeight);var l=new Bi,u=t.renderCache.createProgramSimple(l);a.setProgram(u),Ci||((Ci=new Pi(t.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([1,3,-3,-1,1,-1])}),Ci.vertexCount=3,Mi=t.getCache().createInputLayout(Ci.inputLayoutDescriptor)),i.exec((function(e,r){Ni[0].texture=r.getResolveTextureForID(o),a.setSamplerBindingsFromTextureMappings(Ni),a.setVertexInput(Mi,Ci.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),null),a.drawOnPass(t.renderCache,e)}))}))}var Oi;!function(e){e.PROJECTION_MATRIX="u_ProjectionMatrix",e.VIEW_MATRIX="u_ViewMatrix",e.CAMERA_POSITION="u_CameraPosition",e.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",e.VIEWPORT="u_Viewport",e.IS_ORTHO="u_IsOrtho",e.IS_PICKING="u_IsPicking"}(Oi||(Oi={}));var Ii,Di=function(){function e(e,t,r,n,i){this.renderHelper=e,this.lightPool=t,this.texturePool=r,this.batchManager=n,this.options=i,this.renderLists={leftEye:new ai,rightEye:new ai,picking:new ai},this.cameras=[]}return e.prototype.getDevice=function(){return this.device},e.prototype.getSwapChain=function(){return this.swapChain},e.prototype.getRenderLists=function(){return this.renderLists},e.prototype.apply=function(r){var n=this;this.context=r;var o=r.renderingService,l=r.config,f=r.renderingContext.root.ownerDocument.defaultView;l.disableRenderHooks=!0;var d=function(e){var t=e.target;t.nodeName!==mi.tag?t.nodeName!==Si.tag?(t.renderable3D||(t.renderable3D=new En),n.batchManager.add(t)):n.lightPool.addFog(t):n.lightPool.addLight(t)},h=function(e){var r,i,o=e.target;if(o.nodeName!==mi.tag)if(o.nodeName!==Si.tag){if(o.nodeName===t.Shape.MESH){var a;if(null===(r=o.style.geometry)||void 0===r?void 0:r.meshes)(a=o.style.geometry.meshes.indexOf(o))>-1&&o.style.geometry.meshes.splice(a,1);if(null===(i=o.style.material)||void 0===i?void 0:i.meshes)(a=o.style.material.meshes.indexOf(o))>-1&&o.style.material.meshes.splice(a,1)}n.swapChain&&n.batchManager.remove(o),delete o.renderable3D}else n.lightPool.removeFog(o);else n.lightPool.removeLight(o)},_=function(e){if(n.swapChain){var t=e.target,r=e.attrName,i=e.newValue;"zIndex"===r?t.parentNode.forEach((function(e){n.batchManager.changeRenderOrder(e,e.sortable.renderOrder)})):n.batchManager.updateAttribute(t,r,i)}},p=function(e){n.swapChain&&n.batchManager.updateAttribute(e.target,"modelMatrix",null)};o.hooks.initAsync.tapPromise(e.tag,(function(){return a(n,void 0,void 0,(function(){var e,n,o,a=this;return s(this,(function(s){switch(s.label){case 0:return f.addEventListener(t.ElementEvent.MOUNTED,d),f.addEventListener(t.ElementEvent.UNMOUNTED,h),f.addEventListener(t.ElementEvent.ATTR_MODIFIED,_),f.addEventListener(t.ElementEvent.BOUNDS_CHANGED,p),this.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,e=this.context.contextService.getDomElement(),this.context.contextService.resize((n=this.context.config).width,n.height),o=this,[4,this.context.deviceContribution.createSwapChain(e)];case 1:return o.swapChain=s.sent(),this.device=this.swapChain.getDevice(),this.renderHelper.setDevice(this.device),this.renderHelper.renderInstManager.disableSimpleMode(),this.swapChain.configureSwapChain(e.width,e.height),f.addEventListener(t.CanvasEvent.RESIZE,(function(){a.swapChain.configureSwapChain(e.width,e.height)})),this.batchManager.attach(i({device:this.device},r)),[2]}}))}))})),o.hooks.destroy.tap(e.tag,(function(){n.renderHelper.destroy(),n.batchManager.destroy(),n.texturePool.destroy(),f.removeEventListener(t.ElementEvent.MOUNTED,d),f.removeEventListener(t.ElementEvent.UNMOUNTED,h),f.removeEventListener(t.ElementEvent.ATTR_MODIFIED,_),f.removeEventListener(t.ElementEvent.BOUNDS_CHANGED,p),n.device.destroy(),n.device.checkForLeaks(),l.disableRenderHooks=!1})),o.hooks.beginFrame.tap(e.tag,(function(e){var r,i=null==e?void 0:e.session,o=n.context.config,a=o.width,s=o.height;if(i){var l=i.renderState.baseLayer;l||(l=i.renderState.layers[0]),n.swapChain.configureSwapChain(l.framebufferWidth,l.framebufferHeight,l.framebuffer);var f=e.getViewerPose(i.referenceSpace);f&&f.views.forEach((function(e,t){var r=i.renderState.baseLayer.getViewport(e),o=m.apply(D,c([],u(e.transform.matrix),!1));o[12]*=a,o[13]*=s,o[14]*=500,o[12]+=a/2,o[13]-=s/2,o[14]+=250;var f=m.apply(D,c([],u(e.projectionMatrix),!1)),d=S(T(),o);C(d,d,b(1,-1,1));var h=e.transform.position;n.cameras[t]={viewport:{x:r.x/l.framebufferWidth,y:r.y/l.framebufferHeight,width:r.width/l.framebufferWidth,height:r.height/l.framebufferHeight},projectionMatrix:f,viewMatrix:d,cameraPosition:[h.x,h.y,h.z],isOrtho:!1}}))}else{var d=n.context.camera;n.cameras=[{viewport:{x:0,y:0,width:1,height:1},projectionMatrix:d.getPerspective(),viewMatrix:d.getViewTransform(),cameraPosition:d.getPosition(),isOrtho:d.isOrtho()}]}var h,_=n.swapChain.getCanvas(),p=n.renderHelper.renderInstManager;if(n.builder=n.renderHelper.renderGraph.newGraphBuilder(),"transparent"===n.context.config.background)h=Pe;else{var E=t.parseColor(n.context.config.background);h=n.context.config.background?Me(Number(E.r)/255*Number(E.alpha),Number(E.g)/255*Number(E.alpha),Number(E.b)/255*Number(E.alpha),Number(E.alpha)):Ne}var R={backbufferWidth:_.width,backbufferHeight:_.height,antialiasingMode:di.None},v=Ri(Ln.Color0,R,fi(h)),A=Ri(Ln.DepthStencil,R,pi),g=n.builder.createRenderTargetID(v,"Main Color"),y=n.builder.createRenderTargetID(A,"Main Depth");n.builder.pushPass((function(e){e.setDebugName("Main Render Pass"),e.attachRenderTargetID(Ln.Color0,g),e.attachRenderTargetID(Ln.DepthStencil,y),e.exec((function(e,t){n.cameras.forEach((function(r,i){var o=r.viewport,a=t.currentPass,s=a.viewportW,l=a.viewportH;e.setViewport(o.x*s,o.y*l,o.width*s,o.height*l),(0===i?n.renderLists.leftEye:n.renderLists.rightEye).drawOnPassRenderer(p.renderCache,e)}))}))})),(null===(r=n.options)||void 0===r?void 0:r.enableFXAA)&&xi(n.builder,n.renderHelper,R,g),n.builder.resolveRenderTargetToExternalTexture(g,n.swapChain.getOnscreenTexture())})),o.hooks.endFrame.tap(e.tag,(function(e){var t=n.renderHelper.renderInstManager,r=n.context.config,i=r.width,o=r.height;if(n.cameras.forEach((function(e,r){var a=e.viewport,s=e.cameraPosition,l=e.viewMatrix,u=e.projectionMatrix,c=e.isOrtho,f=a.width,d=a.height,h=n.renderHelper.pushTemplateRenderInst();h.setBindingLayout({numUniformBuffers:2,numSamplers:0}),h.setMegaStateFlags(je({depthWrite:!0,blendConstant:Pe},{rgbBlendMode:z.ADD,alphaBlendMode:z.ADD,rgbBlendSrcFactor:H.SRC_ALPHA,alphaBlendSrcFactor:H.ONE,rgbBlendDstFactor:H.ONE_MINUS_SRC_ALPHA,alphaBlendDstFactor:H.ONE_MINUS_SRC_ALPHA})),h.setUniforms(0,[{name:Oi.PROJECTION_MATRIX,value:u},{name:Oi.VIEW_MATRIX,value:l},{name:Oi.CAMERA_POSITION,value:s},{name:Oi.DEVICE_PIXEL_RATIO,value:n.context.contextService.getDPR()},{name:Oi.VIEWPORT,value:[i*f,o*d]},{name:Oi.IS_ORTHO,value:c?1:0},{name:Oi.IS_PICKING,value:0}]),n.batchManager.render(0===r?n.renderLists.leftEye:n.renderLists.rightEye),t.popTemplateRenderInst()})),n.renderHelper.prepareToRender(),n.renderHelper.renderGraph.execute(),t.resetRenderInsts(),n.enableCapture&&n.resolveCapturePromise){var a=n.captureOptions,s=a.type,l=a.encoderOptions,u=n.context.contextService.getDomElement().toDataURL(s,l);n.resolveCapturePromise(u),n.enableCapture=!1,n.captureOptions=void 0,n.resolveCapturePromise=void 0}}))},e.prototype.loadTexture=function(e,t,r){return this.texturePool.getOrCreateTexture(this.device,e,t,(function(e){r&&r(e)}))},e.prototype.toDataURL=function(e){return a(this,void 0,void 0,(function(){var t=this;return s(this,(function(r){return this.enableCapture=!0,this.captureOptions=e,this.capturePromise=new Promise((function(e){t.resolveCapturePromise=function(t){e(t)}})),[2,this.capturePromise]}))}))},e.tag="RenderGraph",e}(),Fi=function(){function e(e,t,r,n){this.renderHelper=e,this.renderGraphPlugin=t,this.pickingIdGenerator=r,this.batchManager=n}return e.prototype.apply=function(r){var n=this;this.context=r;var i=r.renderingService,o=r.renderingContext.root.ownerDocument.defaultView,l=function(e){var t=e.target;t.renderable3D||(t.renderable3D=new En);var r=t.renderable3D,i=n.pickingIdGenerator.getId(t);r.pickingId=i,r.encodedPickingColor=n.pickingIdGenerator.encodePickingColor(i)},u=function(e){var t=e.target.renderable3D;t&&n.pickingIdGenerator.deleteById(t.pickingId)};i.hooks.init.tap(e.tag,(function(){o.addEventListener(t.ElementEvent.MOUNTED,l),o.addEventListener(t.ElementEvent.UNMOUNTED,u)})),i.hooks.destroy.tap(e.tag,(function(){o.removeEventListener(t.ElementEvent.MOUNTED,l),o.removeEventListener(t.ElementEvent.UNMOUNTED,u),n.pickingIdGenerator.reset()})),i.hooks.pickSync.tap(e.tag,(function(e){return n.pick(e)})),i.hooks.pick.tapPromise(e.tag,(function(e){return a(n,void 0,void 0,(function(){return s(this,(function(t){return[2,this.pick(e)]}))}))}))},e.prototype.pick=function(e){var r=e.topmost,n=e.position,i=n.viewportX,o=n.viewportY,a=this.context.contextService.getDPR(),s=this.context.config.width*a,l=this.context.config.height*a,u=i*a,c=o*a;if(!this.renderHelper.renderGraph||u>s||0>u||c>l||0>c)return e.picked=[],e;var f=this.pickByRectangleInDepth(new t.Rectangle(p(Math.round(u),0,s-1),p(Math.round(c),0,l-1),1,1),r?1:100);return e.picked=f,e},e.prototype.pickByRectangleInDepth=function(e,t){void 0===t&&(t=100);var r=null,n=1,i=[];do{if(!(r=this.pickByRectangle(e,r)))break;n++,i.push(r)}while(r&&t>=n);return t>1&&this.restorePickingColor(i),i},e.prototype.restorePickingColor=function(e){var t=this;e.forEach((function(e){t.batchManager.updateAttribute(e,"pointerEvents",!0,!0)}))},e.prototype.pickByRectangle=function(e,t){var r,n=this,o=this.renderGraphPlugin.getDevice(),a=this.renderGraphPlugin.getRenderLists(),s=this.renderHelper.renderInstManager,l=this.renderHelper.renderGraph.newGraphBuilder(),u=this.context.camera,c=e.x,f=e.y,d=e.width,h=e.height,_={backbufferWidth:d,backbufferHeight:h,antialiasingMode:di.None},p=Ri(Ln.Color0,_,fi(Pe)),E=l.createRenderTargetID(p,"Picking Color"),R=Ri(Ln.DepthStencil,_,pi),v=l.createRenderTargetID(R,"Picking Depth"),T=i({},u.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(e){e.age=-1})),l.pushPass((function(e){e.setDebugName("Picking Pass"),e.attachRenderTargetID(Ln.Color0,E),e.attachRenderTargetID(Ln.DepthStencil,v),e.exec((function(e){a.picking.drawOnPassRenderer(s.renderCache,e)})),e.post((function(e){var t,i=e.getRenderTargetTexture(Ln.Color0),a=o.createReadback();T&&T.enabled?u.setViewOffset(T.fullWidth,T.fullHeight,T.offsetX,T.offsetY,T.width,T.height):u.clearViewOffset(),u.setEnableUpdate(!0);try{t=a.readTextureSync(i,0,0,d,h,new Uint8Array(d*h*4))}catch(e){}var s=-1;if(!t||0===t[0]&&0===t[1]&&0===t[2]||(s=n.pickingIdGenerator.decodePickingColor(t)),s>-1){var l=n.pickingIdGenerator.getById(s);l&&l.isVisible()&&l.isInteractive()&&(r=l)}a.destroy()}))}));var A=this.renderHelper.pushTemplateRenderInst();A.setBindingLayout({numUniformBuffers:2,numSamplers:0}),A.setMegaStateFlags(je({depthWrite:!0},{rgbBlendMode:z.ADD,rgbBlendSrcFactor:H.ONE,rgbBlendDstFactor:H.ZERO,alphaBlendMode:z.ADD,alphaBlendSrcFactor:H.ONE,alphaBlendDstFactor:H.ZERO}));var m=this.context.config,g=m.width,S=m.height,y=this.context.contextService.getDPR();return u.setEnableUpdate(!1),u.setViewOffset(g*y,S*y,c,f,d,h),A.setUniforms(0,[{name:Oi.PROJECTION_MATRIX,value:u.getPerspective()},{name:Oi.VIEW_MATRIX,value:u.getViewTransform()},{name:Oi.CAMERA_POSITION,value:u.getPosition()},{name:Oi.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:Oi.VIEWPORT,value:[d,h]},{name:Oi.IS_ORTHO,value:u.isOrtho()?1:0},{name:Oi.IS_PICKING,value:1}]),t&&this.batchManager.updateAttribute(t,"pointerEvents",!1,!0),this.batchManager.render(a.picking,!0),s.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),s.resetRenderInsts(),r},e.tag="WebGLPicker",e}(),bi=5e-4,Li=function(){function e(){this.clipPathMeshCreated=!1}return e.prototype.beforeUploadUBO=function(e,t){},e.prototype.beforeInitMesh=function(e){},e.prototype.afterInitMesh=function(e){},e}();!function(e){e.CHANGED="changed"}(Ii||(Ii={}));var Ui=function(e){function t(t,r){var n=e.call(this)||this;n.props={},n.meshes=[],n.defines={},n.uniforms={},n.uboBuffer=[],n.textures={},n.samplers=[],n.programDirty=!0,n.textureDirty=!0,n.geometryDirty=!0;var o=He(Ye),a=o.cullMode,s=o.depthCompare,l=o.depthWrite,u=o.stencilFront,c=o.stencilBack,f=o.stencilWrite,d=o.frontFace,h=o.polygonOffset,_=o.attachmentsState;return n.device=t,n.props=i({cullMode:a,depthTest:!0,depthCompare:s,depthWrite:l,stencilFront:u,stencilBack:c,stencilWrite:f,frontFace:d,polygonOffset:h,attachmentsState:_,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},r),n.compile(),n}return n(t,e),Object.defineProperty(t.prototype,"cullMode",{get:function(){return this.props.cullMode},set:function(e){this.props.cullMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this.props.frontFace},set:function(e){this.props.frontFace=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendConstant",{get:function(){return this.props.blendConstant},set:function(e){this.props.blendConstant=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendEquation",{get:function(){return this.props.blendEquation},set:function(e){this.props.blendEquation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendEquationAlpha",{get:function(){return this.props.blendEquationAlpha},set:function(e){this.props.blendEquationAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendSrc",{get:function(){return this.props.blendSrc},set:function(e){this.props.blendSrc=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendDst",{get:function(){return this.props.blendDst},set:function(e){this.props.blendDst=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendSrcAlpha",{get:function(){return this.props.blendSrcAlpha},set:function(e){this.props.blendSrcAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendDstAlpha",{get:function(){return this.props.blendDstAlpha},set:function(e){this.props.blendDstAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthCompare",{get:function(){return this.props.depthCompare},set:function(e){this.props.depthCompare=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this.props.depthTest},set:function(e){this.props.depthTest=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthWrite",{get:function(){return this.props.depthWrite},set:function(e){this.props.depthWrite=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilFront",{get:function(){return this.props.stencilFront},set:function(e){this.props.stencilFront=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilBack",{get:function(){return this.props.stencilBack},set:function(e){this.props.stencilBack=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilWrite",{get:function(){return this.props.stencilWrite},set:function(e){this.props.stencilWrite=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilRef",{get:function(){return this.props.stencilRef},set:function(e){this.props.stencilRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this.props.polygonOffset},set:function(e){this.props.polygonOffset=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dithering",{get:function(){return this.props.dithering},set:function(e){this.props.dithering=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){return this.props.wireframe},set:function(e){this.props.wireframe!==e&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=e,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wireframeColor",{get:function(){return this.props.wireframeColor},set:function(e){this.props.wireframeColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wireframeLineWidth",{get:function(){return this.props.wireframeLineWidth},set:function(e){this.props.wireframeLineWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShader",{get:function(){return this.props.vertexShader},set:function(e){this.props.vertexShader!==e&&(this.programDirty=!0,this.props.vertexShader=e,this.compile())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fragmentShader",{get:function(){return this.props.fragmentShader},set:function(e){this.props.fragmentShader!==e&&(this.programDirty=!0,this.props.fragmentShader=e,this.compile())},enumerable:!1,configurable:!0}),t.prototype.compile=function(){var e=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(t,r){return e.samplers.push(r),""})),this.uniformNames=function(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(e,t,n){var i=[];return n.trim().replace("\r\n","\n").split("\n").forEach((function(e){var t=u(e.trim().split(/\s+/),2),r=t[1];i.push({type:t[0].trim(),name:r.replace(";","").trim()})})),r.push({type:t.trim(),uniforms:i}),""})),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,(function(e,n){return n.trim().replace("\r\n","\n").split("\n").forEach((function(e){var n=e.trim().split(" "),i=n[0]||"",o=n[1]||"",a=o.indexOf("[")>-1;if(o=o.replace(";","").replace("[","").trim(),!i.startsWith("#")){if(i){var s=r.find((function(e){return i===e.type}));if(s)if(a)for(var l=function(e){s.uniforms.forEach((function(r){t.push("".concat(o,"[").concat(e,"].").concat(r.name))}))},u=0;5>u;u++)l(u);else s.uniforms.forEach((function(e){t.push("".concat(o,".").concat(e.name))}))}o&&t.push(o)}})),""})),t}(this.props.fragmentShader)},t.prototype.setUniforms=function(e){var t=this,r=!1;Object.keys(e).forEach((function(n){var i,o=e[n],a=t.textures[n];a&&a!==o&&(t.textureDirty=!0),(i=o)&&i.type?(t.textures[n]=o,t.textureDirty=!0,o.on(J.LOADED,(function(){t.dispatchMutationEvent()}))):(t.uniforms[n]=o,r=!0),f(e[n])&&(delete t.textures[n],delete t.uniforms[n])})),r&&this.dispatchMutationEvent()},t.prototype.dispatchMutationEvent=function(){this.emit(Ii.CHANGED)},t}(de),Gi=function(e){function t(t,r){var n=e.call(this,t,i({},r))||this;return n.defines=i(i({},n.defines),{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),n}return n(t,e),t}(Ui);function wi(e){var t={};return Object.keys(e).forEach((function(r){"number"==typeof e[r]&&(t[r]=e[r])})),t}function ki(e,t){var r=Object.keys(e);return r.length===Object.keys(t).length&&r.every((function(r){return e[r]===t[r]}))}var Vi=function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=u(e,2);return void 0!==t[1]})))};function Xi(e,t){return 256*(e=p(Math.floor(e),0,255))+(t=p(Math.floor(t),0,255))}var Wi,Hi,zi=1,Yi="FillTextureMapping";!function(e){e[e.MODEL_MATRIX=0]="MODEL_MATRIX",e[e.PACKED_COLOR=1]="PACKED_COLOR",e[e.PACKED_STYLE=2]="PACKED_STYLE",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.POSITION=4]="POSITION",e[e.NORMAL=5]="NORMAL",e[e.UV=6]="UV",e[e.BARYCENTRIC=7]="BARYCENTRIC",e[e.MAX=8]="MAX"}(Wi||(Wi={})),function(e){e[e.MODEL_MATRIX0=0]="MODEL_MATRIX0",e[e.MODEL_MATRIX1=1]="MODEL_MATRIX1",e[e.MODEL_MATRIX2=2]="MODEL_MATRIX2",e[e.MODEL_MATRIX3=3]="MODEL_MATRIX3",e[e.PACKED_COLOR=4]="PACKED_COLOR",e[e.PACKED_STYLE1=5]="PACKED_STYLE1",e[e.PACKED_STYLE2=6]="PACKED_STYLE2",e[e.PICKING_COLOR=7]="PICKING_COLOR",e[e.POSITION=8]="POSITION",e[e.NORMAL=9]="NORMAL",e[e.UV=10]="UV",e[e.BARYCENTRIC=11]="BARYCENTRIC",e[e.MAX=12]="MAX"}(Hi||(Hi={}));var Ki,ji,Zi=function(){function e(e,t,r,n,i,o,a){void 0===o&&(o=-1),this.renderHelper=e,this.texturePool=t,this.lightPool=r,this.drawcallCtors=i,this.index=o,this.context=a,this.id=zi++,this.gradientAttributeName="fill",this.objects=[],this.program=new mn,this.geometryDirty=!0,this.materialDirty=!0,this.textureMappings=[],this.divisor=1,this.mergeXYZIntoModelMatrix=!1,this.checkNodeName=!0,this.maxInstances=1/0,this.inited=!1}return Object.defineProperty(e.prototype,"instance",{get:function(){return this.objects[0]},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.inited||(this.renderer.beforeInitMesh(this),this.material=new Gi(this.context.device),this.material.defines=i(i({},wi(Hi)),this.material.defines),this.geometry=new Pi(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))},e.prototype.observeGeometryChanged=function(){var e=this;this.geometry.on(gi.CHANGED,(function(){e.geometry.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirtify()}))},e.prototype.observeMaterialChanged=function(){var e=this;this.material.on(Ii.CHANGED,(function(){e.material.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirtify()}))},e.prototype.shouldMergeColor=function(e,r,n){var i=e.parsedStyle[n],o=r.parsedStyle[n];return!i&&!o||(!(!t.isCSSRGB(i)||!t.isCSSRGB(o))||(!(!t.isPattern(i)||!t.isPattern(o)||i.image!==o.image)||!(!Array.isArray(i)||!Array.isArray(o)||e.style[n]!==r.style[n])))},e.prototype.shouldMerge=function(e,t){return!this.instance||(!this.checkNodeName||this.instance.nodeName===e.nodeName)&&(!e.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,e,"fill")||!this.shouldMergeColor(this.instance,e,"stroke")))},e.prototype.createGeometry=function(e){var r,n,i=this,o=T(),a=T(),s=[],l=[],f=[],d=[],h=this.divisor,_=(null===(r=e[0])||void 0===r?void 0:r.nodeName)===t.Shape.CIRCLE||(null===(n=e[0])||void 0===n?void 0:n.nodeName)===t.Shape.ELLIPSE?.5:0;e.forEach((function(e){var r,n=e.parsedStyle,h=n.fill,p=n.stroke,E=n.opacity,R=void 0===E?1:E,v=n.fillOpacity,T=void 0===v?1:v,m=n.strokeOpacity,g=void 0===m?1:m,S=n.lineWidth,y=void 0===S?1:S,C=n.visibility,P=n.increasedLineWidthForHitTesting,B=void 0===P?0:P,N=[0,0,0,0];t.isCSSRGB(h)&&(N=[Number(h.r),Number(h.g),Number(h.b),255*Number(h.alpha)]);var x=[0,0,0,0];t.isCSSRGB(p)&&(x=[Number(p.r),Number(p.g),Number(p.b),255*Number(p.alpha)]),I(a,i.context.camera.getViewTransform(),o);var O=e.isInteractive()&&(null===(r=e.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0];if(i.mergeXYZIntoModelMatrix){var D=e.parsedStyle,F=D.x,L=D.y,U=D.z;I(o,e.getWorldTransform(),M(o,b(F,L,U)))}else A(o,e.getWorldTransform());s.push.apply(s,c([],u(o),!1)),l.push(Xi(N[0],N[1]),Xi(N[2],N[3]),Xi(x[0],x[1]),Xi(x[2],x[3])),f.push(R,T,g,y,"hidden"!==C?1:0,_,_,B),d.push.apply(d,c(c([],u(O),!1),[e.sortable.renderOrder*bi],!1))})),this.geometry.instancedCount=e.length,this.geometry.setVertexBuffer({bufferIndex:Wi.MODEL_MATRIX,byteStride:64,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Hi.MODEL_MATRIX0,divisor:h},{format:fe.F32_RGBA,bufferByteOffset:16,location:Hi.MODEL_MATRIX1,divisor:h},{format:fe.F32_RGBA,bufferByteOffset:32,location:Hi.MODEL_MATRIX2,divisor:h},{format:fe.F32_RGBA,bufferByteOffset:48,location:Hi.MODEL_MATRIX3,divisor:h}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:Wi.PACKED_COLOR,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Hi.PACKED_COLOR,divisor:h}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:Wi.PACKED_STYLE,byteStride:32,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Hi.PACKED_STYLE1,divisor:h},{format:fe.F32_RGBA,bufferByteOffset:16,location:Hi.PACKED_STYLE2,divisor:h}],data:new Float32Array(f)}),this.geometry.setVertexBuffer({bufferIndex:Wi.PICKING_COLOR,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Hi.PICKING_COLOR,divisor:h}],data:new Float32Array(d)})},e.prototype.destroy=function(){this.geometry&&this.geometry.destroy()},e.prototype.applyRenderInst=function(e,t){var r=this,n=!!this.lightPool.getFog();this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilFront={compare:V.ALWAYS,passOp:ne.REPLACE},this.material.stencilBack={compare:V.ALWAYS,passOp:ne.REPLACE}):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilFront={compare:V.EQUAL,passOp:ne.KEEP},this.material.stencilBack={compare:V.EQUAL,passOp:ne.KEEP}):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(t);var o=i({},this.material.defines);if(this.material.defines.USE_FOG=n,this.material.defines=i(i(i({},this.lightPool.getDefines()),this.material.defines),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var a=this.createFillGradientTextureMapping(t);a&&this.textureMappings.push(a),Object.keys(this.material.textures).sort((function(e,t){return r.material.samplers.indexOf(e)-r.material.samplers.indexOf(t)})).forEach((function(e){var t=new Ti;t.name=e,t.texture=r.material.textures[e],r.context.device.setResourceName(t.texture,"Material Texture "+e),t.sampler=r.renderHelper.getCache().createSampler({addressModeU:Y.CLAMP_TO_EDGE,addressModeV:Y.CLAMP_TO_EDGE,minFilter:K.POINT,magFilter:K.BILINEAR,mipmapFilter:j.LINEAR,lodMinClamp:0,lodMaxClamp:0}),r.textureMappings.push(t)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}(!ki(o,this.material.defines)||this.material.programDirty||this.materialDirty)&&(this.material.defines=i(i({},this.material.defines),wi(Hi)),Object.keys(this.material.defines).forEach((function(e){var t=r.material.defines[e];"boolean"==typeof t?r.program.setDefineBool(e,t):r.program.setDefineString(e,"".concat(t))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(t),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1);var s=this.renderHelper.getCache().createProgramSimple(this.program),l=this.renderHelper.getCache().createInputLayout(i(i({},this.geometry.inputLayoutDescriptor),{program:s})),u=!!this.geometry.indexBuffer;e.renderPipelineDescriptor.topology=this.geometry.drawMode,e.setProgram(s),e.setVertexInput(l,this.geometry.vertexBuffers.filter((function(e){return!!e})).map((function(e){return{buffer:e,byteOffset:0}})),u?{buffer:this.geometry.indexBuffer,offset:0}:null),this.renderer.beforeUploadUBO(e,this),this.uploadUBO(e),u?e.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):e.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),e.sortKey=Zn(Gn.OPAQUE,t[0].sortable.renderOrder)},e.prototype.updateBatchedAttribute=function(e,r,n,i){var o,a,s=this;if(0!==e.length){if("fill"===n||"stroke"===n){var l=[];e.forEach((function(e){var r=e.parsedStyle,n=r.fill,i=r.stroke,o=[0,0,0,0];t.isCSSRGB(n)&&(o=[Number(n.r),Number(n.g),Number(n.b),255*Number(n.alpha)]);var a=[0,0,0,0];t.isCSSRGB(i)&&(a=[Number(i.r),Number(i.g),Number(i.b),255*Number(i.alpha)]),l.push(Xi(o[0],o[1]),Xi(o[2],o[3]),Xi(a[0],a[1]),Xi(a[2],a[3]))})),this.geometry.updateVertexBuffer(Wi.PACKED_COLOR,Hi.PACKED_COLOR,r,new Uint8Array(new Float32Array(l).buffer));var f=this.instance.parsedStyle.fill,d=this.textureMappings.findIndex((function(e){return e.name===Yi}));if(t.isCSSRGB(f))0>d||(this.textureMappings.splice(d,-1),this.material.textureDirty=!0);else{var h=this.createFillGradientTextureMapping([this.instance]);0>d||this.textureMappings.splice(d,1,h),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(n)>-1){var _=[],p=(null===(o=e[0])||void 0===o?void 0:o.nodeName)===t.Shape.CIRCLE||(null===(a=e[0])||void 0===a?void 0:a.nodeName)===t.Shape.ELLIPSE?.5:0;e.forEach((function(e){var t=e.parsedStyle,r=t.opacity,n=t.fillOpacity,i=t.strokeOpacity,o=t.lineWidth,a=t.increasedLineWidthForHitTesting;_.push(void 0===r?1:r,void 0===n?1:n,void 0===i?1:i,void 0===o?1:o,"hidden"!==t.visibility?1:0,p,p,void 0===a?0:a)})),this.geometry.updateVertexBuffer(Wi.PACKED_STYLE,Hi.PACKED_STYLE1,r,new Uint8Array(new Float32Array(_).buffer))}else if("modelMatrix"===n||this.mergeXYZIntoModelMatrix&&("x"===n||"y"===n||"z"===n)){var E=[],R=T();e.forEach((function(e){if(s.mergeXYZIntoModelMatrix){var t=e.parsedStyle,r=t.x,n=t.y,i=t.z;I(R,e.getWorldTransform(),M(R,b(r,n,i)))}else A(R,e.getWorldTransform());E.push.apply(E,c([],u(R),!1))})),this.geometry.updateVertexBuffer(Wi.MODEL_MATRIX,Hi.MODEL_MATRIX0,r,new Uint8Array(new Float32Array(E).buffer))}else if("pointerEvents"===n){var v=[];e.forEach((function(e){var t,r=i&&e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];v.push.apply(v,c(c([],u(r),!1),[e.sortable.renderOrder*bi],!1))})),this.geometry.updateVertexBuffer(Wi.PICKING_COLOR,Hi.PICKING_COLOR,r,new Uint8Array(new Float32Array(v).buffer))}}},e.prototype.updateAttribute=function(e,t,r,n){"clipPath"===r&&this.clipPath&&(this.geometryDirty=!0)},e.prototype.changeRenderOrder=function(e,t){var r,n=this.objects.indexOf(e),i=e.isInteractive()&&(null===(r=e.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(Wi.PICKING_COLOR,Hi.PICKING_COLOR,n,new Uint8Array(new Float32Array(c(c([],u(i),!1),[t*bi],!1)).buffer))},e.prototype.generateWireframe=function(e){for(var t=e.indices,r=e.indices.length,n=e.vertices.map((function(e){return e.slice()})),i=Wi.PICKING_COLOR;e.vertexBuffers.length>i;i++){var o=e.inputLayoutDescriptor.vertexBufferDescriptors[i].arrayStride;e.vertices[i]=new Float32Array(o/4*r)}var a=0,s=new Uint32Array(r);for(i=0;r>i;i++){for(var l=t[i],u=1;e.vertices.length>u;u++)for(var c=(o=e.inputLayoutDescriptor.vertexBufferDescriptors[u].arrayStride)/4,f=0;c>f;f++)e.vertices[u][a*c+f]=n[u][l*c+f];s[i]=a,a++}for(i=Wi.PICKING_COLOR+1;e.vertexBuffers.length>i;i++){var d=e.inputLayoutDescriptor.vertexBufferDescriptors[i],h=(o=d.arrayStride,e.inputLayoutDescriptor.vertexBufferDescriptors[i].attributes[0]);if(h)e.setVertexBuffer({bufferIndex:i,byteStride:o,stepMode:d.stepMode,attributes:[{format:h.format,bufferByteOffset:h.offset,location:h.shaderLocation,divisor:h.divisor}],data:e.vertices[i]})}var _=new Float32Array(3*r);for(i=0;r>i;)for(u=0;3>u;u++){_[3*(l=s[i++])+u]=1}e.setVertexBuffer({bufferIndex:Wi.BARYCENTRIC,byteStride:12,stepMode:$.VERTEX,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:Number(Hi.BARYCENTRIC)}],data:_}),e.setIndexBuffer(s)},e.prototype.beforeUploadUBO=function(e,t){},e.prototype.uploadUBO=function(e){var r,n=this,o=this.material,a=this.lightPool.getAllLights(),s=this.lightPool.getFog(),l=!!s,u=null!==(r=o.defines.USE_LIGHT)&&void 0!==r?r:!!a.length,c=[];if(o.defines.USE_WIREFRAME){var f=t.parseColor(o.wireframeColor);c.push({name:"u_WireframeLineColor",value:[Number(f.r)/255,Number(f.g)/255,Number(f.b)/255]}),c.push({name:"u_WireframeLineWidth",value:o.wireframeLineWidth})}if(l&&this.uploadFog(c,s),this.uploadMaterial(c,o),u){var d={};a.forEach((function(e){d[e.define]||(d[e.define]=-1),d[e.define]++,e.uploadUBO(c,d[e.define])}))}c.sort((function(e,t){return n.material.uniformNames.indexOf(e.name)-n.material.uniformNames.indexOf(t.name)})),e.setUniforms(1,c);var h=o.blendEquation,_=o.blendEquationAlpha,p=o.blendSrc,E=o.blendDst,R=o.blendSrcAlpha,v=o.blendDstAlpha,T=Vi({blendConstant:o.blendConstant,depthCompare:o.depthCompare,depthWrite:o.depthWrite,stencilFront:o.stencilFront,stencilBack:o.stencilBack,stencilWrite:o.stencilWrite,stencilRef:o.stencilRef,cullMode:o.cullMode,frontFace:o.frontFace,polygonOffset:o.polygonOffset}),A=e.getMegaStateFlags().attachmentsState[0];e.setMegaStateFlags(i({attachmentsState:[{channelWriteMask:this.material.stencilWrite?re.NONE:re.ALL,rgbBlendState:i(i({},A.rgbBlendState),Vi({blendMode:h,blendSrcFactor:p,blendDstFactor:E})),alphaBlendState:i(i({},A.alphaBlendState),Vi({blendMode:_,blendSrcFactor:R,blendDstFactor:v}))}]},T)),e.setBindingLayout({numUniformBuffers:1,numSamplers:this.textureMappings.length}),e.setSamplerBindingsFromTextureMappings(this.textureMappings)},e.prototype.uploadFog=function(e,r){var n=r.parsedStyle,i=n.type,o=n.fill,a=n.start,s=n.end,l=n.density;if(t.isCSSRGB(o)){var u=[Number(o.r)/255,Number(o.g)/255,Number(o.b)/255,Number(o.alpha)];e.push({name:"u_FogInfos",value:[i,a,s,l]}),e.push({name:"u_FogColor",value:u})}},e.prototype.uploadMaterial=function(e,t){var r=Object.keys(t.uniforms).map((function(e){return{name:e,value:t.uniforms[e]}}));e.push.apply(e,c([],u(r),!1))},e.prototype.createFillGradientTextureMapping=function(e){var r,n=this,i=e[0],o=i.parsedStyle[this.gradientAttributeName];if(o&&(t.isPattern(o)||Array.isArray(o))){Array.isArray(o)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:o,width:128,height:128,instance:i})):t.isPattern(o)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(o,i,(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0}))),r=this.texturePool.getOrCreateCanvas();var a=this.texturePool.getOrCreateTexture(this.context.device,r,he(fe.U8_RGBA_NORM,1,1,1));if(a){var s=new Ti;return s.name=Yi,s.texture=a,s.texture.on("loaded",(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0})),this.context.device.setResourceName(s.texture,"Fill Texture"+this.id),s.sampler=this.renderHelper.getCache().createSampler({addressModeU:Y.CLAMP_TO_EDGE,addressModeV:Y.CLAMP_TO_EDGE,minFilter:K.POINT,magFilter:K.BILINEAR,mipmapFilter:j.LINEAR,lodMinClamp:0,lodMaxClamp:0}),s}}return null},e}();!function(e){e[e.PACKED_STYLE=5]="PACKED_STYLE"}(Ki||(Ki={})),function(e){e[e.PACKED_STYLE3=12]="PACKED_STYLE3",e[e.EXTRUDE=13]="EXTRUDE",e[e.SIZE=14]="SIZE"}(ji||(ji={}));var qi=[t.Shape.CIRCLE,t.Shape.ELLIPSE,t.Shape.RECT],Qi=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.shouldMerge=function(t,r){return!!e.prototype.shouldMerge.call(this,t,r)},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = EXTRUDE) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec3 a_StylePacked3;\nlayout(location = SIZE) in vec4 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec2 v_Data;\nout vec2 v_Radius;\nout vec3 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size.xy + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size.xy + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n\n  bool isBillboard = a_Size.z > 0.5;\n  if (isBillboard) {\n    float rotation = 0.0;\n    bool isSizeAttenuation = a_Size.w > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec2(a_Extrude * radius / radius.y);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec2 v_Data;\nin vec2 v_Radius;\nin vec3 v_StylePacked3;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float dist = length(v_Data);\n  float antialiased_blur = -fwidth(dist);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data, 1.0);\n    inner_df = sdCircle(v_Data, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=i(i({},this.material.defines),wi(ji))},r.prototype.createGeometry=function(t){var r=this;e.prototype.createGeometry.call(this,t);var n=[],i=[];t.forEach((function(e,t){var o=e,a=o.parsedStyle.radius,s=r.shouldOmitStroke(o.parsedStyle),l=r.getSize(e.parsedStyle,o.nodeName),f=r.getPosition(e.parsedStyle,o.nodeName);n.push.apply(n,c(c([],u(l),!1),[o.parsedStyle.isBillboard?1:0,o.parsedStyle.isSizeAttenuation?1:0,qi.indexOf(o.nodeName),a&&a[0]||0,s?1:0],!1)),i.push.apply(i,c([],u(f),!1))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Wi.UV,byteStride:16,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:ji.EXTRUDE},{format:fe.F32_RG,bufferByteOffset:8,location:Hi.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:Wi.POSITION,byteStride:12,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:Hi.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Ki.PACKED_STYLE,byteStride:28,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:ji.SIZE,divisor:1},{format:fe.F32_RGB,bufferByteOffset:16,location:ji.PACKED_STYLE3,divisor:1}],data:new Float32Array(n)})},r.prototype.updateAttribute=function(t,r,n,i){var o=this;if(e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i),"r"===n||"rx"===n||"ry"===n||"width"===n||"height"===n||"lineWidth"===n||"stroke"===n||"lineDash"===n||"strokeOpacity"===n||"radius"===n||"isBillboard"===n||"isSizeAttenuation"===n){var a=[];t.forEach((function(e){var t=e,r=o.shouldOmitStroke(t.parsedStyle),n=u(o.getSize(e.parsedStyle,e.nodeName),2);a.push.apply(a,c(c([],u([n[0],n[1]]),!1),[t.parsedStyle.isBillboard?1:0,t.parsedStyle.isSizeAttenuation?1:0,qi.indexOf(e.nodeName),e.parsedStyle.radius&&e.parsedStyle.radius[0]||0,r?1:0],!1))})),this.geometry.updateVertexBuffer(Ki.PACKED_STYLE,ji.SIZE,r,new Uint8Array(new Float32Array(a).buffer))}else if("cx"===n||"cy"===n||"x"===n||"y"===n){var s=[];t.forEach((function(e){var t=u(o.getPosition(e.parsedStyle,e.nodeName),2);s.push(t[0],t[1])})),this.geometry.updateVertexBuffer(Wi.POSITION,Hi.POSITION,r,new Uint8Array(new Float32Array(s).buffer))}},r.prototype.getPosition=function(e,r){var n=[0,0,0];if(r===t.Shape.CIRCLE||r===t.Shape.ELLIPSE){var i=e.cx,o=e.cy,a=e.cz;n=[void 0===i?0:i,void 0===o?0:o,void 0===a?0:a]}else if(r===t.Shape.RECT){var s=e.x,l=e.y,u=e.z;n=[void 0===s?0:s,void 0===l?0:l,void 0===u?0:u]}return n},r.prototype.getSize=function(e,r){var n=[0,0];if(r===t.Shape.CIRCLE){var i=e.r;n=[i,i]}else if(r===t.Shape.ELLIPSE){n=[e.rx,e.ry]}else if(r===t.Shape.RECT){n=[e.width/2,e.height/2]}return n},r.prototype.shouldOmitStroke=function(e){var t=e.lineDash,r=e.stroke,n=e.strokeOpacity,i=r&&!r.isNone,o=t&&t.length&&t.every((function(e){return 0!==e}));return!i||i&&(o||1>n)},r}(Zi),$i=10,Ji=8,eo=100;function to(e,t,r,n,i,o){for(var a=i[i.length-3],s=i[i.length-2],l=null!=o?o:p(pn(a,s,e,t,r,n,3)/$i,Ji,eo),u=0,c=0,f=1;l>=f;++f){var d=f/l;i.push((u=a+(e-a)*d)+(e+(r-e)*d-u)*d,(c=s+(t-s)*d)+(t+(n-t)*d-c)*d,0)}}function ro(e,t,r,n,i,o,a,s){var l=a[a.length-3],u=a[a.length-2];a.length-=3;var c=null!=s?s:p(hn(l,u,e,t,r,n,i,o,3)/$i,Ji,eo),f=0,d=0,h=0,_=0,E=0;a.push(l,u,0);for(var R=1,v=0;c>=R;++R)a.push((h=(d=(f=1-(v=R/c))*f)*f)*l+3*d*v*e+3*f*(_=v*v)*r+(E=_*v)*i,h*u+3*d*v*t+3*f*_*n+E*o,0)}var no,io,oo=1e20,ao=function(){function e(e,t){var r=e.fontSize,n=void 0===r?24:r,i=e.buffer,o=void 0===i?3:i,a=e.radius,s=void 0===a?8:a,l=e.cutoff,u=void 0===l?.25:l,c=e.fontFamily,f=void 0===c?"sans-serif":c,d=e.fontWeight,h=void 0===d?"normal":d,_=e.fontStyle,p=void 0===_?"normal":_,E=e.canvas;this.buffer=o,this.cutoff=u,this.radius=s;var R=this.size=n+4*o,v=t.offscreenCanvasCreator.getOrCreateCanvas(E);v.width=R,v.height=R;var T=t.offscreenCanvasCreator.getOrCreateContext(E,{willReadFrequently:!0});this.ctx=T,T.font="".concat(p," ").concat(h," ").concat(n,"px ").concat(f),T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}return e.prototype.draw=function(e){var t=this.ctx.measureText(e),r=t.width,n=t.actualBoundingBoxDescent,i=t.actualBoundingBoxLeft,o=t.actualBoundingBoxRight,a=Math.ceil(t.actualBoundingBoxAscent),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),u=s+2*this.buffer,c=l+2*this.buffer,f=Math.max(u*c,0),d=new Uint8ClampedArray(f),h={data:d,width:u,height:c,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:r};if(0===s||0===l)return h;var _=this,p=_.ctx,E=_.buffer,R=_.gridInner,v=_.gridOuter;p.clearRect(E,E,s,l),p.fillText(e,E,E+a);var T=p.getImageData(E,E,s,l);v.fill(oo,0,f),R.fill(0,0,f);for(var A=0;l>A;A++)for(var m=0;s>m;m++){var g=T.data[4*(A*s+m)+3]/255;if(0!==g){var S=(A+E)*u+m+E;if(1===g)v[S]=0,R[S]=oo;else v[S]=(C=.5-g)>0?C*C:0,R[S]=0>C?C*C:0}}so(v,0,0,u,c,u,this.f,this.v,this.z),so(R,E,E,s,l,u,this.f,this.v,this.z);for(var y=0;f>y;y++){var C;d[y]=Math.round(255-255*((C=Math.sqrt(v[y])-Math.sqrt(R[y]))/this.radius+this.cutoff))}return h},e}();function so(e,t,r,n,i,o,a,s,l){for(var u=t;t+n>u;u++)lo(e,r*o+u,o,i,a,s,l);for(var c=r;r+i>c;c++)lo(e,c*o+t,1,n,a,s,l)}function lo(e,t,r,n,i,o,a){o[0]=0,a[0]=-oo,a[1]=oo,i[0]=e[t];for(var s=1,l=0,u=0;n>s;s++){i[s]=e[t+s*r];var c=s*s;do{u=(i[s]-i[f=o[l]]+c-f*f)/(s-f)/2}while(a[l]>=u&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=oo}for(s=0,l=0;n>s;s++){for(;s>a[l+1];)l++;var f,d=s-(f=o[l]);e[t+s*r]=i[f]+d*d}}!function(e){e[e.PACKED=5]="PACKED",e[e.VERTEX_NUM=6]="VERTEX_NUM",e[e.TRAVEL=7]="TRAVEL",e[e.DASH=8]="DASH"}(no||(no={})),function(e){e[e.PREV=8]="PREV",e[e.POINT1=9]="POINT1",e[e.POINT2=10]="POINT2",e[e.NEXT=11]="NEXT",e[e.VERTEX_JOINT=12]="VERTEX_JOINT",e[e.VERTEX_NUM=13]="VERTEX_NUM",e[e.TRAVEL=14]="TRAVEL",e[e.DASH=15]="DASH"}(io||(io={}));function uo(e,t,r){return 4*(e?1:0)+2*(t?1:0)+(r?1:0)}function co(e){if(!(e.nodeName===t.Shape.POLYLINE))return!1;var r=e.parsedStyle.points.points;return r.length&&!f(r[0][2])}var fo,ho=function(e){function r(t,r,n,i,o,a,s){var l=e.call(this,t,r,n,i,o,a,s)||this;return l.renderHelper=t,l.texturePool=r,l.lightPool=n,l.segmentNum=-1,l.segmentNum=l.calcSegmentNum(i),l.gradientAttributeName="stroke",l}return n(r,e),r.calcSubpathNum=function(e){return e.nodeName===t.Shape.PATH?e.parsedStyle.d.absolutePath.filter((function(e){return"M"===e[0]})).length:1},r.prototype.calcSegmentNum=function(e){return Eo(e,!1,12,this.calcSubpathIndex(e)).instancedCount},r.prototype.calcSubpathIndex=function(e){if(e.nodeName===t.Shape.PATH){var r=this.drawcallCtors.filter((function(e){return e===go})).length;return this.index-r}return 0},r.prototype.shouldMerge=function(t,r){if(!e.prototype.shouldMerge.call(this,t,r))return!1;if(this.index!==r)return!1;var n=this.calcSegmentNum(t);return this.segmentNum===n},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = PREV) in vec3 a_Prev;\nlayout(location = POINT1) in vec3 a_Point1;\nlayout(location = POINT2) in vec3 a_Point2;\nlayout(location = NEXT) in vec3 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\nout vec4 v_Dash;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float u_Expand = 1.0;\nconst float u_MiterLimit = 5.0;\nconst float u_ScaleMode = 1.0;\nconst float u_Alignment = 0.5;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvec2 clip2ScreenSpace(vec4 clip) {\n  return u_Viewport * (0.5 * clip.xy / clip.w + 0.5);\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  v_Dash = a_Dash;\n\n  vec2 pointA;\n  vec2 pointB;\n  vec4 clip0;\n  vec4 clip1;\n\n  float compressed = a_Dash.w;\n  float is_billboard = floor(compressed / 4.0);\n  compressed -= is_billboard * 4.0;\n  float is_size_attenuation = floor(compressed / 2.0);\n  compressed -= is_size_attenuation * 2.0;\n  float is_3d_polyline = compressed;\n\n  bool isBillboard = is_billboard > 0.5;\n  bool isSizeAttenuation = is_size_attenuation > 0.5;\n  bool is3DPolyline = is_3d_polyline > 0.5;\n  if (isBillboard) {\n    clip0 = billboard(a_Point1.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n    clip1 = billboard(a_Point2.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else if (is3DPolyline) {\n    clip0 = project(vec4(a_Point1, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = project(vec4(a_Point2, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  if (isBillboard || is3DPolyline) {\n    pointA = clip2ScreenSpace(clip0);\n    pointB = clip2ScreenSpace(clip1);\n  } else {\n    pointA = (u_ModelMatrix * vec4(a_Point1, 1.0)).xy;\n    pointB = (u_ModelMatrix * vec4(a_Point2, 1.0)).xy;\n  }\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Prev.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Prev, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Prev, 1.0)).xy;\n      }\n\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Next.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Next, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Next, 1.0)).xy;\n      }\n      \n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  if (isBillboard || is3DPolyline) {\n    vec4 clip = mix(clip0, clip1, 0.5);\n    gl_Position = vec4(clip.w * (2.0 * pos / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  float u_Dash = v_Dash.x;\n  float u_Gap = v_Dash.y;\n  float u_DashOffset = v_Dash.z;\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    vec3 pickingColor = u_PickingColor;\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=i(i({},this.material.defines),wi(io))},r.prototype.createGeometry=function(t){var r=this,n=[],i=[],o=[],a=[],s=0,l=0;t.forEach((function(e){var t=Eo(e,!1,12,r.calcSubpathIndex(e)),f=t.pointsBuffer,d=t.travelBuffer,h=t.instancedCount,_=e.parsedStyle,p=_.lineDash;a.push(p&&p[0]||0,p&&p[1]||0,_.lineDashOffset||0,uo(_.isBillboard,_.isSizeAttenuation,co(e))),s+=h;for(var E=0;f.length-12>E;E+=4)i.push(f[E],f[E+1],f[E+2],f[E+3],f[E+4],f[E+5],f[E+6],f[E+7],f[E+8],f[E+9],f[E+10],f[E+11],f[E+12],f[E+13],f[E+14],f[E+15]);o.push.apply(o,c([],u(d),!1)),n.push(0+l,2+l,1+l,0+l,3+l,2+l,4+l,6+l,5+l,4+l,7+l,6+l,4+l,7+l,8+l),l+=9})),i.length&&(this.geometry.setVertexBuffer({bufferIndex:no.PACKED,byteStride:64,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:io.PREV,divisor:1},{format:fe.F32_RGB,bufferByteOffset:16,location:io.POINT1,divisor:1},{format:fe.F32_R,bufferByteOffset:28,location:io.VERTEX_JOINT,divisor:1},{format:fe.F32_RGB,bufferByteOffset:32,location:io.POINT2,divisor:1},{format:fe.F32_RGB,bufferByteOffset:48,location:io.NEXT,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:no.VERTEX_NUM,byteStride:4,stepMode:$.INSTANCE,attributes:[{format:fe.F32_R,bufferByteOffset:0,byteStride:4,location:io.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:no.TRAVEL,byteStride:4,stepMode:$.INSTANCE,attributes:[{format:fe.F32_R,bufferByteOffset:0,byteStride:4,location:io.TRAVEL,divisor:1}],data:new Float32Array(o)}),this.divisor=s/t.length,this.geometry.setVertexBuffer({bufferIndex:no.DASH,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:io.DASH,divisor:this.divisor}],data:new Float32Array(a)}),e.prototype.createGeometry.call(this,t),this.geometry.vertexCount=15,this.geometry.instancedCount=s,this.geometry.setIndexBuffer(new Uint32Array(n)))},r.prototype.updateAttribute=function(t,r,n,i){var o=this;if(e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i),"r"===n||"rx"===n||"ry"===n||"width"===n||"height"===n||"radius"===n||"x1"===n||"y1"===n||"x2"===n||"y2"===n||"points"===n||"path"===n||"d"===n||"lineJoin"===n||"lineCap"===n||"markerStartOffset"===n||"markerEndOffset"===n||"markerStart"===n||"markerEnd"===n){var a=[],s=[],l=0;t.forEach((function(e){var t=Eo(e,!1,12,o.calcSubpathIndex(e)),r=t.pointsBuffer,n=t.travelBuffer;l=t.instancedCount;for(var i=0;r.length-12>i;i+=4)a.push(r[i],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5],r[i+6],r[i+7],r[i+8],r[i+9],r[i+10],r[i+11],r[i+12],r[i+13],r[i+14],r[i+15]);s.push.apply(s,c([],u(n),!1))})),this.geometry.updateVertexBuffer(no.PACKED,io.PREV,r*l,new Uint8Array(new Float32Array(a).buffer)),this.geometry.updateVertexBuffer(no.TRAVEL,io.TRAVEL,r,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===n||"lineDash"===n||"isBillboard"===n||"isSizeAttenuation"===n){var f=[];t.forEach((function(e){var t=e.parsedStyle,r=t.lineDash;f.push(r&&r[0]||0,r&&r[1]||0,t.lineDashOffset||0,uo(t.isBillboard,t.isSizeAttenuation,co(e)))})),this.geometry.updateVertexBuffer(no.DASH,io.DASH,r,new Uint8Array(new Float32Array(f).buffer))}},r}(Zi);!function(e){e[e.NONE=0]="NONE",e[e.FILL=1]="FILL",e[e.JOINT_BEVEL=4]="JOINT_BEVEL",e[e.JOINT_MITER=8]="JOINT_MITER",e[e.JOINT_ROUND=12]="JOINT_ROUND",e[e.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",e[e.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",e[e.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",e[e.FILL_EXPAND=24]="FILL_EXPAND",e[e.CAP_BUTT=32]="CAP_BUTT",e[e.CAP_SQUARE=64]="CAP_SQUARE",e[e.CAP_ROUND=96]="CAP_ROUND",e[e.CAP_BUTT2=128]="CAP_BUTT2"}(fo||(fo={}));var _o=3,po=4;function Eo(e,r,n,i){var o;void 0===r&&(r=!1),void 0===i&&(i=0);var a=e.parsedStyle,s=a.lineCap,l=a.lineJoin,f=e.sortable.renderOrder*bi,d=0,h=0,_=e.parsedStyle,p=_.markerStart,E=_.markerEnd,R=_.markerStartOffset,v=_.markerEndOffset,A=[],m=[];if(e.nodeName===t.Shape.POLYLINE||e.nodeName===t.Shape.POLYGON){var S=e.parsedStyle.points.points,y=S.length,C=0,M=0,P=0,B=0,N=0;p&&t.isDisplayObject(p)&&R&&(C=Math.cos(N=Math.atan2(S[1][1]-S[0][1],S[1][0]-S[0][0]))*(R||0),M=Math.sin(N)*(R||0)),E&&t.isDisplayObject(E)&&v&&(P=Math.cos(N=Math.atan2(S[y-2][1]-S[y-1][1],S[y-2][0]-S[y-1][0]))*(v||0),B=Math.sin(N)*(v||0));var x=e.nodeName===t.Shape.POLYLINE;if(A[0]=S.reduce((function(e,t,r){var n=0,i=0;return 0===r?(n=C,i=M):r===y-1&&(n=P,i=B),e.push(t[0]+n,t[1]+i,x?t[2]||0:f),e}),[]),e.nodeName===t.Shape.POLYGON){if(r)return m=un(A[0],[],3),{pointsBuffer:A[0],travelBuffer:[],triangles:m,instancedCount:Math.round(A[0].length/_o)};A[0].push(A[0][0],A[0][1],A[0][2]||f),(o=A[0]).push.apply(o,c([],u(Ro(A[0][0],A[0][1],A[0][2]||f,A[0][3],A[0][4],A[0][5]||f)),!1))}}else if(e.nodeName===t.Shape.PATH||e.nodeName===t.Shape.CIRCLE||e.nodeName===t.Shape.ELLIPSE||e.nodeName===t.Shape.RECT){var O=void 0;if(e.nodeName!==t.Shape.PATH){if(O=t.parsePath(t.convertToPath(e,g(T()))),e.nodeName===t.Shape.RECT){var I=e.parsedStyle;0>I.width&&(d+=O.rect.width),0>I.height&&(h+=O.rect.height)}}else O=e.parsedStyle.d;var D=O.absolutePath,F=O.segments,b=0,L=0,G=0,w=0;N=0;if(p&&p.parentNode&&t.isDisplayObject(p)&&R){var k=u(p.parentNode.getStartTangent(),2);b=Math.cos(N=Math.atan2((V=k[0])[1]-(X=k[1])[1],V[0]-X[0]))*(R||0),L=Math.sin(N)*(R||0)}if(E&&E.parentNode&&t.isDisplayObject(E)&&v){var V,X,W=u(E.parentNode.getEndTangent(),2);G=Math.cos(N=Math.atan2((V=W[0])[1]-(X=W[1])[1],V[0]-X[0]))*(v||0),w=Math.sin(N)*(v||0)}var H=-1,z=-1;if(D.forEach((function(r,i){var o,a=u(r),s=a[0],l=a.slice(1),_=D[i+1],p=0===i&&(0!==b||0!==L),E=(i===D.length-1||_&&("M"===_[0]||"Z"===_[0]))&&0!==G&&0!==w;if("M"===s)z++,A[z]=[],H=A[z].length,p?A[z].push(l[0]-d+b,l[1]-h+L,f,l[0]-d,l[1]-h,f):A[z].push(l[0]-d,l[1]-h,f);else if("L"===s)E?A[z].push(l[0]-d+G,l[1]-h+w,f):A[z].push(l[0]-d,l[1]-h,f);else if("Q"===s)to(l[0]-d,l[1]-h,l[2]-d,l[3]-h,A[z],n),E&&A[z].push(l[2]-d+G,l[3]-h+w,f);else if("A"===s){for(var R=u(F[i].prePoint,2),v=U(R[0],R[1],l[0],l[1],l[2],l[3],l[4],l[5],l[6],void 0),T=0;v.length>T;T+=6)ro(v[T]-d,v[T+1]-h,v[T+2]-d,v[T+3]-h,v[T+4]-d,v[T+5]-h,A[z],n);E&&A[z].push(l[5]-d+G,l[6]-h+w,f)}else if("C"===s)ro(l[0]-d,l[1]-h,l[2]-d,l[3]-h,l[4]-d,l[5]-h,A[z],n),E&&A[z].push(l[4]-d+G,l[5]-h+w,f);else if("Z"===s&&(e.nodeName===t.Shape.PATH||e.nodeName===t.Shape.RECT)){var m=1e-4;(Math.abs(A[z][A[z].length-2]-A[z][H])>m||Math.abs(A[z][A[z].length-1]-A[z][H+1])>m)&&A[z].push(A[z][H],A[z][H+1],f),(o=A[z]).push.apply(o,c([],u(Ro(A[z][H],A[z][H+1],A[z][H+2],A[z][H+3],A[z][H+4],A[z][H+5])),!1))}})),r)return{pointsBuffer:$=A[i],travelBuffer:[],triangles:m=un($,[],3),instancedCount:Math.round($.length/_o)}}var Y=function(e){var t;switch(e){case"bevel":t=fo.JOINT_BEVEL;break;case"round":t=fo.JOINT_ROUND;break;default:t=fo.JOINT_MITER}return t}(l),K=function(e){var t;switch(e){case"square":t=fo.CAP_SQUARE;break;case"round":t=fo.CAP_ROUND;break;default:t=fo.CAP_BUTT}return t}(s),j=K;K===fo.CAP_ROUND&&(j=fo.JOINT_CAP_ROUND),K===fo.CAP_BUTT&&(j=fo.JOINT_CAP_BUTT),K===fo.CAP_SQUARE&&(j=fo.JOINT_CAP_SQUARE);for(var Z=A[i],q=(Math.round(0/_o)+2)*po,Q=0,$=[],J=[],ee=0;Z.length>ee;ee+=_o)ee>1&&(Q+=Math.sqrt(Math.pow(Z[ee]-Z[ee-_o],2)+Math.pow(Z[ee+1]-Z[ee+1-_o],2)+Math.pow(Z[ee+2]-Z[ee+2-_o],2))),J.push(Q),$[q++]=Z[ee],$[q++]=Z[ee+1],$[q++]=Z[ee+2]||0,$[q]=Y,0==ee&&K!==fo.CAP_ROUND&&($[q]+=K),Z.length>ee+2*_o?Z.length>ee+_o||($[q]=0):$[q]+=j-Y,q++;return $[q++]=Z[Z.length-6],$[q++]=Z[Z.length-5],$[q++]=Z[Z.length-4]||f,$[q++]=0,$[0]=Z[0],$[1]=Z[1],$[2]=Z[2]||f,$[3]=0,$[4]=Z[3],$[5]=Z[4],$[6]=Z[5]||f,$[7]=K===fo.CAP_ROUND?K:0,{pointsBuffer:$,travelBuffer:J,triangles:m,instancedCount:Math.round(Z.length/_o)}}function Ro(e,t,r,n,i,o){void 0===n&&(n=e),void 0===i&&(i=t),void 0===o&&(o=r);var a=[n-e,i-t,o-r],s=.01;return[e+a[0]*s,t+a[1]*s,r+a[2]*s]}var vo,To;!function(e){e[e.PACKED_STYLE=5]="PACKED_STYLE"}(vo||(vo={})),function(e){e[e.PACKED_STYLE3=12]="PACKED_STYLE3"}(To||(To={}));var Ao,mo,go=function(e){function r(t,r,n,i,o,a,s){var l=e.call(this,t,r,n,i,o,a,s)||this;return l.renderHelper=t,l.texturePool=r,l.lightPool=n,l.trianglesHash=[[],[]],l.trianglesHash=l.calcSegmentNum(i),l}return n(r,e),r.prototype.calcSegmentNum=function(e){var t=Eo(e,!0,12,this.calcSubpathIndex(e));return[t.triangles,t.pointsBuffer]},r.prototype.calcSubpathIndex=function(e){return e.nodeName===t.Shape.PATH?this.index:0},r.prototype.compareTrianglesHash=function(e){var t=u(this.trianglesHash,2),r=t[0],n=t[1],i=u(e,2),o=i[0],a=i[1];return r.length===o.length&&n.length===a.length&&(!r.some((function(e,t){return e!==o[t]}))&&!n.some((function(e,t){return e!==a[t]})))},r.prototype.shouldMerge=function(t,r){if(!e.prototype.shouldMerge.call(this,t,r))return!1;if(this.index!==r)return!1;var n=this.calcSegmentNum(t);return this.compareTrianglesHash(n)},r.prototype.createGeometry=function(t){var r=this,n=[],i=[],o=[],a=0;if(t.forEach((function(e,t){var s=Eo(e,!0,12,r.calcSubpathIndex(e)),l=s.triangles,f=s.pointsBuffer;if(l.length){var d=e.getGeometryBounds().halfExtents,h=[];f.forEach((function(e,t){t%3!=2&&h.push(e/d[t%3]/2)})),a+=i.length/3,i.push.apply(i,c([],u(f),!1)),o.push.apply(o,c([],u(h),!1)),n.push.apply(n,c([],u(l.map((function(e){return e+a}))),!1))}})),i.length){e.prototype.createGeometry.call(this,t);var s=[];t.forEach((function(e){var t=e.parsedStyle,r=t.billboardRotation;s.push(t.isBillboard?1:0,null!=r?r:0,t.isSizeAttenuation?1:0,0)})),this.geometry.setVertexBuffer({bufferIndex:Wi.POSITION,byteStride:12,stepMode:$.VERTEX,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:Hi.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:vo.PACKED_STYLE,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:To.PACKED_STYLE3,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:Wi.UV,byteStride:8,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:Hi.UV}],data:new Float32Array(o)}),this.geometry.vertexCount=n.length/t.length,this.geometry.setIndexBuffer(new Uint32Array(n))}},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(a_Position.xy, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else {\n    gl_Position = project(vec4(a_Position.xy, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=i(i(i({},this.material.defines),wi(To)),{INSTANCED:!0})},r.prototype.updateAttribute=function(t,r,n,i){if(e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i),"isBillboard"===n||"billboardRotation"===n||"isSizeAttenuation"===n){var o=[];t.forEach((function(e){var t=e.parsedStyle,r=t.billboardRotation;o.push(t.isBillboard?1:0,null!=r?r:0,t.isSizeAttenuation?1:0,0)})),this.geometry.updateVertexBuffer(vo.PACKED_STYLE,To.PACKED_STYLE3,r,new Uint8Array(new Float32Array(o).buffer))}},r}(Zi),So=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1];!function(e){e[e.POINT=5]="POINT",e[e.CAP=6]="CAP",e[e.DASH=7]="DASH"}(Ao||(Ao={})),function(e){e[e.POSITION=8]="POSITION",e[e.UV=10]="UV",e[e.POINTA=9]="POINTA",e[e.POINTB=11]="POINTB",e[e.CAP=12]="CAP",e[e.DASH=13]="DASH"}(mo||(mo={}));var yo,Co,Mo={butt:1,round:2,square:3},Po=function(e){function r(t,r,n,i,o,a,s){var l=e.call(this,t,r,n,i,o,a,s)||this;return l.renderHelper=t,l.texturePool=r,l.lightPool=n,l.gradientAttributeName="stroke",l}return n(r,e),r.isLine=function(e,r){if(e.nodeName===t.Shape.PATH){for(var n=e.parsedStyle.d.absolutePath,i=0,o=0,a=0;n.length>a;a++){if("M"===n[a][0]){if(i===r){o=a;break}i++}}if("M"===n[o][0]&&"L"===n[o+1][0]&&(void 0===n[o+2]||"M"===n[o+2][0]))return!0}else if(e.nodeName===t.Shape.POLYLINE){var s=e.parsedStyle.points.points,l=(s[1][0]-s[1][1])/(s[0][0]-s[0][1]);for(a=1;s.length-1>a;a++)if((s[a+1][0]-s[a+1][1])/(s[a][0]-s[a][1])!==l)return!1;return!0}return!1},r.prototype.shouldMerge=function(t,r){return!!e.prototype.shouldMerge.call(this,t,r)},r.prototype.createMaterial=function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  bool isSizeAttenuation = a_Dash.w > 0.5;\n  if (isSizeAttenuation) {\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * max(blur, 0.5)\n      * u_Opacity * u_StrokeOpacity\n      * (u_dash_array < 1.0 ? (ceil((u_dash_array * u_dash_ratio) - mod(v_Dash.x + u_dash_offset, u_dash_array))) : 1.0);\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=i(i({},this.material.defines),wi(mo))},r.prototype.calcSubpathIndex=function(e){if(e.nodeName===t.Shape.PATH){var r=this.drawcallCtors.filter((function(e){return e===go})).length;return this.index-r}return 0},r.prototype.createGeometry=function(r){var n=this;e.prototype.createGeometry.call(this,r);var i=[],o=[],a=[],s=[],l=0;r.forEach((function(e){var r,u;if(e.nodeName===t.Shape.LINE)r=e.parsedStyle,u=e.getTotalLength();else if(e.nodeName===t.Shape.POLYLINE){var c=e.parsedStyle,f=c.points.points;r={x1:f[0][0],y1:f[0][1],x2:f[f.length-1][0],y2:f[f.length-1][1],z1:0,z2:0,lineCap:c.lineCap,lineDash:p=c.lineDash,lineDashOffset:E=c.lineDashOffset,isBillboard:c.isBillboard,isSizeAttenuation:c.isSizeAttenuation,markerStart:R=c.markerStart,markerEnd:v=c.markerEnd,markerStartOffset:T=c.markerStartOffset,markerEndOffset:A=c.markerEndOffset},u=e.getTotalLength()}else if(e.nodeName===t.Shape.PATH){for(var d=e.parsedStyle,h=d.d.absolutePath,_=d.lineCap,p=d.lineDash,E=d.lineDashOffset,R=d.markerStart,v=d.markerEnd,T=d.markerStartOffset,A=d.markerEndOffset,m=d.isBillboard,g=d.isSizeAttenuation,S=0,y=0,C=n.calcSubpathIndex(e),M=0;h.length>M;M++){if("M"===h[M][0]){if(S===C){y=M;break}S++}}r={x1:h[y][1],y1:h[y][2],x2:h[y+1][1],y2:h[y+1][2],z1:0,z2:0,lineCap:_,lineDash:p,lineDashOffset:E,isBillboard:m,isSizeAttenuation:g,markerStart:R,markerEnd:v,markerStartOffset:T,markerEndOffset:A},u=e.getTotalLength()}var P=r.x1,B=r.y1,N=r.x2,x=r.y2,O=r.z1,I=r.z2,D=r.lineCap,F=r.isBillboard,b=r.isSizeAttenuation,L=n.calcOffset(r),U=L.startOffsetX,G=L.startOffsetY,w=L.endOffsetX,k=L.endOffsetY,V=n.calcDash(r,u),X=V.dashOffset,W=V.dashSegmentPercent,H=V.dashRatioInEachSegment;o.push(Mo[D]),a.push(X,W,H,F||b?1:0),i.push(P+U,B+G,O,N+w,x+k,I),s.push(0+l,2+l,1+l,0+l,3+l,2+l),l+=4})),this.geometry.setIndexBuffer(new Uint32Array(s)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Wi.POSITION,byteStride:20,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:mo.POSITION,divisor:0},{format:fe.F32_RG,bufferByteOffset:12,location:mo.UV,divisor:0}],data:new Float32Array(So)}),this.geometry.setVertexBuffer({bufferIndex:Ao.POINT,byteStride:24,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:mo.POINTA,divisor:1},{format:fe.F32_RGB,bufferByteOffset:12,location:mo.POINTB,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Ao.CAP,byteStride:4,stepMode:$.INSTANCE,attributes:[{format:fe.F32_R,bufferByteOffset:0,location:mo.CAP,divisor:1}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:Ao.DASH,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:mo.DASH,divisor:1}],data:new Float32Array(a)})},r.prototype.updateAttribute=function(r,n,i,o){var a=this;if(e.prototype.updateAttribute.call(this,r,n,i,o),this.updateBatchedAttribute(r,n,i,o),"x1"===i||"y1"===i||"x2"===i||"y2"===i||"z1"===i||"z2"===i||"markerStartOffset"===i||"markerEndOffset"===i||"markerStart"===i||"markerEnd"===i||"points"===i||"d"===i){var s=[];r.forEach((function(e){var r;if(e.nodeName===t.Shape.LINE)r=e.parsedStyle;else if(e.nodeName===t.Shape.POLYLINE){var n=e.parsedStyle,i=n.points.points;r={x1:i[0][0],y1:i[0][1],x2:i[i.length-1][0],y2:i[i.length-1][1],z1:0,z2:0,lineCap:n.lineCap,isSizeAttenuation:n.isSizeAttenuation,isBillboard:n.isBillboard,markerStart:n.markerStart,markerEnd:n.markerEnd,markerStartOffset:n.markerStartOffset,markerEndOffset:n.markerEndOffset}}else if(e.nodeName===t.Shape.PATH){var o=e.parsedStyle,l=o.d.absolutePath;r={x1:l[0][1],y1:l[0][2],x2:l[1][1],y2:l[1][2],z1:0,z2:0,lineCap:o.lineCap,isBillboard:o.isBillboard,isSizeAttenuation:o.isSizeAttenuation,markerStart:o.markerStart,markerEnd:o.markerEnd,markerStartOffset:o.markerStartOffset,markerEndOffset:o.markerEndOffset}}var u=r.x1,c=r.y1,f=r.x2,d=r.y2,h=r.z1,_=r.z2,p=a.calcOffset(r);s.push(u+p.startOffsetX,c+p.startOffsetY,h,f+p.endOffsetX,d+p.endOffsetY,_)})),this.geometry.updateVertexBuffer(Ao.POINT,mo.POINTA,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===i||"lineDash"===i||"isSizeAttenuation"===i||"isBillboard"===i){var l=[];r.forEach((function(e){var t=e.getTotalLength(),r=a.calcDash(e.parsedStyle,t);l.push(r.dashOffset,r.dashSegmentPercent,r.dashRatioInEachSegment,e.parsedStyle.isBillboard||e.parsedStyle.isSizeAttenuation?1:0)})),this.geometry.updateVertexBuffer(Ao.DASH,mo.DASH,n,new Uint8Array(new Float32Array(l).buffer))}else if("lineCap"===i){var u=[];r.forEach((function(e){u.push(Mo[e.parsedStyle.lineCap])})),this.geometry.updateVertexBuffer(Ao.CAP,mo.CAP,n,new Uint8Array(new Float32Array(u).buffer))}},r.prototype.calcOffset=function(e){var r=e.x1,n=e.y1,i=e.x2,o=e.y2,a=e.markerStart,s=e.markerEnd,l=e.markerStartOffset,u=e.markerEndOffset,c=0,f=0,d=0,h=0,_=0;return a&&t.isDisplayObject(a)&&l&&(c=Math.cos(_=Math.atan2(o-n,i-r))*(l||0),f=Math.sin(_)*(l||0)),s&&t.isDisplayObject(s)&&u&&(d=Math.cos(_=Math.atan2(n-o,r-i))*(u||0),h=Math.sin(_)*(u||0)),{startOffsetX:c,startOffsetY:f,endOffsetX:d,endOffsetY:h}},r.prototype.calcDash=function(e,t){var r=e.lineDash,n=0,i=1,o=0;if(r&&r.length){n=(e.lineDashOffset||0)/t;var a=r.reduce((function(e,t){return e+t}),0);0===a?(i=1,o=0):(i=a/t,o=r[1]/a)}return{dashOffset:n,dashSegmentPercent:i,dashRatioInEachSegment:o}},r}(Zi);!function(e){e[e.PACKED_STYLE=5]="PACKED_STYLE",e[e.SIZE=8]="SIZE"}(yo||(yo={})),function(e){e[e.PACKED_STYLE3=12]="PACKED_STYLE3",e[e.SIZE=13]="SIZE"}(Co||(Co={}));var Bo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.shouldMerge=function(t,r){return!!e.prototype.shouldMerge.call(this,t,r)&&this.instance.parsedStyle.src===t.parsedStyle.src},t.prototype.createMaterial=function(e){var t=e[0].parsedStyle.src;this.material.defines=i(i({},this.material.defines),wi(Co)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = SIZE) in vec2 a_Size;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size;\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}";var r=this.texturePool.getOrCreateTexture(this.context.device,t,void 0);this.material.setUniforms({u_Map:r})},t.prototype.createGeometry=function(t){e.prototype.createGeometry.call(this,t);var r=[],n=[],i=[];t.forEach((function(e,t){var o=e.parsedStyle,a=o.x,s=o.y,l=o.z,u=o.width,c=o.height,f=o.isBillboard,d=o.billboardRotation,h=o.isSizeAttenuation;r.push(void 0===a?0:a,void 0===s?0:s,void 0===l?0:l),n.push(u,c),i.push(f?1:0,null!=d?d:0,h?1:0,0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Wi.POSITION,byteStride:12,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:Hi.POSITION}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:yo.SIZE,byteStride:8,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:Co.SIZE}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:yo.PACKED_STYLE,byteStride:16,stepMode:$.INSTANCE,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Co.PACKED_STYLE3,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Wi.UV,byteStride:8,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:Hi.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})},t.prototype.updateAttribute=function(t,r,n,i){if(e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i),"x"===n||"y"===n||"z"===n){var o=[];t.forEach((function(e){var t=e.parsedStyle,r=t.x,n=t.y,i=t.z;o.push(void 0===r?0:r,void 0===n?0:n,void 0===i?0:i)})),this.geometry.updateVertexBuffer(Wi.POSITION,Hi.POSITION,r,new Uint8Array(new Float32Array(o).buffer))}else if("width"===n||"height"===n){var a=[];t.forEach((function(e){var t=e.parsedStyle;a.push(t.width,t.height)})),this.geometry.updateVertexBuffer(yo.SIZE,Co.SIZE,r,new Uint8Array(new Float32Array(a).buffer))}else if("isBillboard"===n||"billboardRotation"===n||"isSizeAttenuation"===n){var s=[];t.forEach((function(e){var t=e.parsedStyle,r=t.billboardRotation;s.push(t.isBillboard?1:0,null!=r?r:0,t.isSizeAttenuation?1:0,0)})),this.geometry.updateVertexBuffer(yo.PACKED_STYLE,Co.PACKED_STYLE3,r,new Uint8Array(new Float32Array(s).buffer))}else if("src"===n){var l=this.texturePool.getOrCreateTexture(this.context.device,i);this.material.setUniforms({u_Map:l})}},t}(Zi);function No(e,t,r,n){var i=t.width,o=t.height;if(n){if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return e.width=i,e.height=o,e.data=n,e}function xo(e,t,r,n,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=e.data,s=t.data,l=0;i.height>l;l++)for(var u=((r.y+l)*e.width+r.x)*o,c=((n.y+l)*t.width+n.x)*o,f=0;i.width*o>f;f++)s[c+f]=a[u+f];return t}var Oo=function(){function e(e,t){No(this,e,1,t)}return e.prototype.resize=function(e){!function(e,t,r){var n=t.width,i=t.height;if(n!==e.width||i!==e.height){var o=No({},{width:n,height:i},r);xo(e,o,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=o.data}}(this,e,1)},e.prototype.clone=function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))},e.copy=function(e,t,r,n,i){xo(e,t,r,n,i,1)},e}();var Io=function(e){var t={},r=[];for(var n in e){var i=e[n],o=t[n]={};for(var a in i)(c=i[+a])&&0!==c.bitmap.width&&0!==c.bitmap.height&&(r.push(f={x:0,y:0,w:c.bitmap.width+2,h:c.bitmap.height+2}),o[a]={rect:f,metrics:c.metrics})}var s=function(e){var t,r,n,i,o=0,a=0;try{for(var s=l(e),u=s.next();!u.done;u=s.next())o+=(p=u.value).w*p.h,a=Math.max(a,p.w)}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}e.sort((function(e,t){return t.h-e.h}));var c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),a),h:1/0}],f=0,d=0;try{for(var h=l(e),_=h.next();!_.done;_=h.next())for(var p=_.value,E=c.length-1;E>=0;E--){var R=c[E];if(R.w>=p.w&&R.h>=p.h){if(p.x=R.x,p.y=R.y,d=Math.max(d,p.y+p.h),f=Math.max(f,p.x+p.w),p.w===R.w&&p.h===R.h){var v=c.pop();c.length>E&&(c[E]=v)}else p.h===R.h?(R.x+=p.w,R.w-=p.w):p.w===R.w?(R.y+=p.h,R.h-=p.h):(c.push({x:R.x+p.w,y:R.y,w:R.w-p.w,h:p.h}),R.y+=p.h,R.h-=p.h);break}}}catch(e){n={error:e}}finally{try{_&&!_.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return{w:f,h:d,fill:o/(f*d)||0}}(r),u=new Oo({width:s.w||1,height:s.h||1});for(var n in e)for(var a in i=e[n]){var c,f;(c=i[+a])&&0!==c.bitmap.width&&0!==c.bitmap.height&&Oo.copy(c.bitmap,u,{x:0,y:0},{x:(f=t[n][a].rect).x+1,y:f.y+1},c.bitmap)}this.image=u,this.positions=t};var Do,Fo,bo,Lo=function(){function e(e){this.runtime=e,this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={}}return e.prototype.destroy=function(){this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy()},e.prototype.getMap=function(){return this.glyphMap},e.prototype.getAtlas=function(){return this.glyphAtlas},e.prototype.getAtlasTexture=function(){return this.glyphAtlasTexture},e.prototype.layout=function(e,t,r,n,i,o,a){var s=this,l=[],u=o,c=a,f="right"===n||"end"===n?1:"left"===n||"start"===n?0:.5;return e.forEach((function(e){var n=l.length;Array.from(e).forEach((function(e){var r=s.glyphMap[t],n=e.charCodeAt(0),o=r&&r[n];o&&(l.push({glyph:n,x:u,y:c,scale:1,fontStack:t}),u+=o.metrics.advance+i)}));for(var o=u-i,a=n;l.length>a;a++)l[a].x=l[a].x-f*o;u=0,c+=r})),l},e.prototype.generateAtlas=function(e,t,r,n,o,a,s){var l=this;void 0===t&&(t=""),void 0===o&&(o="");var u=[];this.glyphMap[t]||(u=function(){for(var e=[],t=32;128>t;t++)e.push(String.fromCharCode(t));return e}());var c=Object.keys(this.glyphMap[t]||{});if(Array.from(new Set(a.split(""))).forEach((function(e){-1===c.indexOf(""+e.charCodeAt(0))&&u.push(e)})),u.length){var f=u.map((function(i){return l.generateSDF(e,t,r,n,o,i)})).reduce((function(e,t){return e[t.id]=t,e}),{});this.glyphMap[t]=i(i({},this.glyphMap[t]),f),this.glyphAtlas=new Io(this.glyphMap);var d=this.glyphAtlas.image,h=d.width,_=d.height,p=d.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=s.createTexture(i(i({},he(fe.ALPHA,h,_,1)),{pixelStore:{unpackFlipY:!1,unpackAlignment:1}})),this.glyphAtlasTexture.setImageData([p])}},e.prototype.generateSDF=function(e,t,r,n,i,o){void 0===t&&(t="");var a=o.charCodeAt(0),s=this.sdfGeneratorCache[t];s||(s=this.sdfGeneratorCache[t]=new ao({canvas:e,fontSize:24,fontFamily:r,fontWeight:n,fontStyle:i,buffer:3,radius:8,cutoff:.25},this.runtime)),this.textMetricsCache[t]||(this.textMetricsCache[t]={}),this.textMetricsCache[t][o]||(this.textMetricsCache[t][o]=s.ctx.measureText(o).width);var l=s.draw(o),u=l.glyphWidth,c=l.glyphHeight,f=l.glyphLeft,d=l.glyphTop,h=l.glyphAdvance;return{id:a,bitmap:new Oo({width:l.width,height:l.height},l.data),metrics:{width:u,height:c,left:f,top:d-24+3,advance:h}}},e}();!function(e){e[e.INSTANCED=5]="INSTANCED",e[e.TEX=6]="TEX"}(Do||(Do={})),function(e){e[e.TEX=12]="TEX",e[e.OFFSET=13]="OFFSET"}(Fo||(Fo={})),function(e){e.SDF_MAP="u_SDFMap",e.SDF_MAP_SIZE="u_SDFMapSize",e.FONT_SIZE="u_FontSize",e.GAMMA_SCALE="u_GammaScale",e.STROKE_BLUR="u_StrokeBlur",e.HAS_STROKE="u_HasStroke"}(bo||(bo={}));var Uo=function(e){function r(t,r,n,i,o,a,s){var l=e.call(this,t,r,n,i,o,a,s)||this;return l.renderHelper=t,l.texturePool=r,l.lightPool=n,l.packedBufferObjectMap=new WeakMap,l.tmpMat4=T(),l.fontHash=l.calcFontHash(i),l.glyphManager=new Lo(l.context),l}return n(r,e),r.prototype.calcFontHash=function(e){e.getBounds();return e.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(t,r){return t+e.parsedStyle[r]}),"")},r.prototype.shouldMerge=function(t,r){return!!e.prototype.shouldMerge.call(this,t,r)&&(this.index===r&&this.fontHash===this.calcFontHash(t))},r.prototype.createGeometry=function(e){var t=this,r=this.instance,n=r.parsedStyle,i=n.fontSize,o=n.letterSpacing,a=void 0===o?0:o,s=r.parsedStyle.textBaseline,l=void 0===s?"alphabetic":s,f=24/(void 0===i?16:i),d=[],h=[],_=[],p=[],E=0;e.forEach((function(e){var r=e.parsedStyle,n=r.metrics,i=r.dx,o=r.dy,s=n.font,R=n.lines,v=n.height,T=n.lineHeight,A=void 0===i?0:i,m=void 0===o?0:o;t.context.enableCSSParsing||"alphabetic"!==l||(l="bottom");var g=0;"middle"===l?g+=-v/2:"bottom"===l?g+=-v:"top"===l||"hanging"===l?g+=0:"alphabetic"===l?g+=.25*T-v:"ideographic"===l&&(g+=-v);var S=t.glyphManager.getAtlas(),y=t.buildTextBuffers({object:e,lines:R,fontStack:s,lineHeight:f*T,offsetX:f*A,offsetY:f*(g+m),letterSpacing:f*a,glyphAtlas:S,indicesOffset:E}),C=y.indexBuffer,M=y.charUVOffsetBuffer,P=y.charPositionsBuffer;E=y.indicesOffset;var B=p.length;p.push.apply(p,c([],u(y.charPackedBuffer),!1)),t.packedBufferObjectMap.set(e,[B,p.length]),_.push.apply(_,c([],u(M),!1)),h.push.apply(h,c([],u(P),!1)),d.push.apply(d,c([],u(C),!1))})),this.geometry.vertexCount=d.length,this.geometry.setIndexBuffer(new Uint32Array(d)),this.geometry.setVertexBuffer({bufferIndex:Do.INSTANCED,byteStride:128,stepMode:$.VERTEX,attributes:[{format:fe.F32_RGBA,bufferByteOffset:0,location:Hi.MODEL_MATRIX0},{format:fe.F32_RGBA,bufferByteOffset:16,location:Hi.MODEL_MATRIX1},{format:fe.F32_RGBA,bufferByteOffset:32,location:Hi.MODEL_MATRIX2},{format:fe.F32_RGBA,bufferByteOffset:48,location:Hi.MODEL_MATRIX3},{format:fe.F32_RGBA,bufferByteOffset:64,location:Hi.PACKED_COLOR},{format:fe.F32_RGBA,bufferByteOffset:80,location:Hi.PACKED_STYLE1},{format:fe.F32_RGBA,bufferByteOffset:96,location:Hi.PACKED_STYLE2},{format:fe.F32_RGBA,bufferByteOffset:112,location:Hi.PICKING_COLOR}],data:new Float32Array(p)}),this.geometry.setVertexBuffer({bufferIndex:Wi.POSITION,byteStride:12,stepMode:$.VERTEX,attributes:[{format:fe.F32_RGB,bufferByteOffset:0,location:Hi.POSITION}],data:new Float32Array(h)}),this.geometry.setVertexBuffer({bufferIndex:Do.TEX,byteStride:16,stepMode:$.VERTEX,attributes:[{format:fe.F32_RG,bufferByteOffset:0,location:Fo.TEX},{format:fe.F32_RG,bufferByteOffset:8,location:Fo.OFFSET}],data:new Float32Array(_)})},r.prototype.createMaterial=function(e){var t;this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + + bufferOffset;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  if (isBillboard) {\n    float rotation =  a_StylePacked2.w;\n    bool isSizeAttenuation = a_StylePacked2.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position );\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float fontScale = u_FontSize / 24.0;\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = fwidth(dist);\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < epsilon) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=W.BACK,this.material.defines=i(i({},this.material.defines),wi(Fo));var r=this.instance.parsedStyle,n=r.fontSize,o=void 0===n?16:n,a=r.fontFamily,s=void 0===a?"sans-serif":a,l=r.fontWeight,u=void 0===l?"normal":l,c=r.fontStyle,f=void 0===c?"normal":c,d=r.metrics.font,h=e.map((function(e){return e.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,d,s,""+u,f,h,this.context.device);var _=this.glyphManager.getAtlasTexture(),p=this.glyphManager.getAtlas();this.context.device.setResourceName(_,"TextSDF Texture");var E=p.image,R=E.width,v=E.height;this.material.setUniforms(((t={})[bo.SDF_MAP]=_,t[bo.SDF_MAP_SIZE]=[R,v],t[bo.FONT_SIZE]=o,t[bo.GAMMA_SCALE]=1,t[bo.STROKE_BLUR]=.2,t[bo.HAS_STROKE]=this.index,t))},r.prototype.changeRenderOrder=function(e,t){for(var r=this.geometry.vertices[Do.INSTANCED],n=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Do.INSTANCED].arrayStride/4,i=u(this.packedBufferObjectMap.get(e),2),o=i[0],a=i[1],s=r.slice(o,a),l=0;a-o>l;l+=n)s[l+n-1]=t*bi;this.geometry.updateVertexBuffer(Do.INSTANCED,Hi.MODEL_MATRIX0,o/n,new Uint8Array(s.buffer))},r.prototype.updateAttribute=function(e,r,n,i){var o=this;if("text"===n||"fontFamily"===n||"fontSize"===n||"fontWeight"===n||"fontStyle"===n||"fontVariant"===n||"textBaseline"===n||"letterSpacing"===n||"wordWrapWidth"===n||"lineHeight"===n||"wordWrap"===n||"textAlign"===n||"x"===n||"y"===n||"dx"===n||"dy"===n)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===n||"fill"===n||"fillOpacity"===n||"stroke"===n||"strokeOpacity"===n||"opacity"===n||"lineWidth"===n||"visibility"===n||"pointerEvents"===n||"isBillboard"===n||"billboardRotation"===n||"isSizeAttenuation"===n){var a=this.geometry.vertices[Do.INSTANCED],s=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Do.INSTANCED].arrayStride/4;e.forEach((function(e){var r,n=e.parsedStyle,i=n.fill,l=n.stroke,c=n.opacity,f=void 0===c?1:c,d=n.fillOpacity,h=void 0===d?1:d,_=n.strokeOpacity,p=void 0===_?1:_,E=n.lineWidth,R=void 0===E?1:E,v=n.visibility,T=n.isBillboard,m=n.billboardRotation,g=n.isSizeAttenuation,S=[0,0,0,0];t.isCSSRGB(i)&&(S=[Number(i.r),Number(i.g),Number(i.b),255*Number(i.alpha)]);var y=[0,0,0,0];t.isCSSRGB(l)&&(y=[Number(l.r),Number(l.g),Number(l.b),255*Number(l.alpha)]);for(var C=e.isInteractive()&&(null===(r=e.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0],M=A(o.tmpMat4,e.getWorldTransform()),P=u(o.packedBufferObjectMap.get(e),2),B=P[0],N=P[1],x=a.slice(B,N),O=0;N-B>O;O+=s)x[O+0]=M[0],x[O+1]=M[1],x[O+2]=M[2],x[O+3]=M[3],x[O+4]=M[4],x[O+5]=M[5],x[O+6]=M[6],x[O+7]=M[7],x[O+8]=M[8],x[O+9]=M[9],x[O+10]=M[10],x[O+11]=M[11],x[O+12]=M[12],x[O+13]=M[13],x[O+14]=M[14],x[O+15]=M[15],x[O+16]=Xi(S[0],S[1]),x[O+17]=Xi(S[2],S[3]),x[O+18]=Xi(y[0],y[1]),x[O+19]=Xi(y[2],y[3]),x[O+20]=f,x[O+21]=h,x[O+22]=p,x[O+23]=R,x[O+24]="hidden"!==v?1:0,x[O+25]=T?1:0,x[O+26]=g?1:0,x[O+27]=null!=m?m:0,x[O+28]=C[0],x[O+29]=C[1],x[O+30]=C[2];o.geometry.updateVertexBuffer(Do.INSTANCED,Hi.MODEL_MATRIX0,B/s,new Uint8Array(x.buffer))}))}},r.prototype.buildTextBuffers=function(e){var r,n=e.object,i=e.lines,o=e.fontStack,a=e.lineHeight,s=e.letterSpacing,l=e.offsetX,f=e.offsetY,d=e.glyphAtlas,h=e.indicesOffset,_=n.parsedStyle,p=_.textAlign,E=void 0===p?"start":p,R=_.fill,v=_.stroke,T=_.opacity,m=void 0===T?1:T,g=_.fillOpacity,S=void 0===g?1:g,y=_.strokeOpacity,C=void 0===y?1:y,M=_.lineWidth,P=void 0===M?1:M,B=_.visibility,N=_.isBillboard,x=_.billboardRotation,O=_.isSizeAttenuation,I=_.x,D=void 0===I?0:I,F=_.y,b=void 0===F?0:F,L=_.z,U=void 0===L?0:L,G=[0,0,0,0];t.isCSSRGB(R)&&(G=[Number(R.r),Number(R.g),Number(R.b),255*Number(R.alpha)]);var w=[0,0,0,0];t.isCSSRGB(v)&&(w=[Number(v.r),Number(v.g),Number(v.b),255*Number(v.alpha)]);var k=n.isInteractive()&&(null===(r=n.renderable3D)||void 0===r?void 0:r.encodedPickingColor)||[0,0,0],V=A(this.tmpMat4,n.getWorldTransform()),X=[],W=[],H=[],z=[],Y=h,K=function(e,t){for(var r=[],n=0;e.length>n;n++){var i=e[n],o=t[i.fontStack],a=o&&o[i.glyph];if(a){var s=a.rect;if(s){var l=a.metrics.advance*i.scale/2,u=[i.x+l,i.y],c=(a.metrics.left-4)*i.scale-l+u[0],f=(-a.metrics.top-4)*i.scale+u[1],d=c+s.w*i.scale,h=f+s.h*i.scale;r.push({tl:{x:c,y:f},tr:{x:d,y:f},bl:{x:c,y:h},br:{x:d,y:h},tex:s,glyphOffset:[0,0]})}}}return r}(this.glyphManager.layout(i,o,a,E,s,l,f),d.positions);return K.forEach((function(e){var t=[];t.push.apply(t,c([],u(V),!1));var r=c(c(c(c([],u(t),!1),[Xi(G[0],G[1]),Xi(G[2],G[3]),Xi(w[0],w[1]),Xi(w[2],w[3]),m,S,C,P,"hidden"!==B?1:0,N?1:0,O?1:0,null!=x?x:0],!1),u(k),!1),[n.sortable.renderOrder*bi],!1);X.push.apply(X,c(c(c(c([],u(r),!1),u(r),!1),u(r),!1),u(r),!1)),W.push(e.tex.x,e.tex.y,e.tl.x,e.tl.y),W.push(e.tex.x+e.tex.w,e.tex.y,e.tr.x,e.tr.y),W.push(e.tex.x+e.tex.w,e.tex.y+e.tex.h,e.br.x,e.br.y),W.push(e.tex.x,e.tex.y+e.tex.h,e.bl.x,e.bl.y),H.push(D,b,U,D,b,U,D,b,U,D,b,U),z.push(0+Y,2+Y,1+Y),z.push(2+Y,0+Y,3+Y),Y+=4})),{indexBuffer:z,charUVOffsetBuffer:W,charPositionsBuffer:H,charPackedBuffer:X,indicesOffset:Y}},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.glyphManager.destroy()},r}(Zi),Go=function(e){function r(){var t=e.apply(this,c([],u(arguments),!1))||this;return t.mergeXYZIntoModelMatrix=!1,t}return n(r,e),r.prototype.shouldMerge=function(r,n){return!!e.prototype.shouldMerge.call(this,r,n)&&(this.instance.nodeName!==t.Shape.MESH||this.instance.parsedStyle.material===r.parsedStyle.material&&this.instance.parsedStyle.geometry===r.parsedStyle.geometry)},r.prototype.updateAttribute=function(t,r,n,i){e.prototype.updateAttribute.call(this,t,r,n,i),this.updateBatchedAttribute(t,r,n,i)},r.prototype.createMaterial=function(e){this.material=this.instance.parsedStyle.material,this.observeMaterialChanged()},r.prototype.createGeometry=function(t){this.geometry=this.instance.parsedStyle.geometry,e.prototype.createGeometry.call(this,t),this.geometry.build(t),this.observeGeometryChanged()},r}(Zi),wo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(e){var t=[],r=e.parsedStyle.fill;return r&&!r.isNone&&t.push(Qi),this.needDrawStrokeSeparately(e)&&t.push(ho),t},t.prototype.needDrawStrokeSeparately=function(e){var t=e.parsedStyle,r=t.fill,n=t.stroke,i=t.lineDash,o=t.lineWidth,a=t.strokeOpacity,s=r&&!r.isNone,l=n&&!n.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&o>0&&(1>a||u)},t}(Li),ko=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.getDrawcallCtors=function(e){var r=e.parsedStyle,n=r.fill,i=r.stroke,o=r.opacity,a=r.strokeOpacity,s=r.lineWidth,l=i&&!i.isNone,u=ho.calcSubpathNum(e),c=[];if(e.nodeName!==t.Shape.POLYLINE&&!(null==n?void 0:n.isNone))for(var f=0;u>f;f++)c.push(go);for(f=0;u>f;f++)if(0!==a&&0!==o&&0!==s&&l){var d=Po.isLine(e,f);c.push(d?Po:ho)}return c},r}(Li);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e),t.prototype.getDrawcallCtors=function(){return[]}}(Li);var Vo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(){return[Bo]},t}(Li),Xo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(e){var t=[],r=e.parsedStyle,n=r.stroke,i=r.lineWidth;return!(!n||n.isNone||!(void 0===i?1:i))&&t.push(Uo),t.push(Uo),t},t.prototype.beforeUploadUBO=function(e,t){var r;t.material.setUniforms(((r={})[bo.HAS_STROKE]=1===t.instance.renderable3D.drawcalls.length?0:1-t.index,r))},t}(Li),Wo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(){return[Po]},t}(Li),Ho=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(){return[Go]},t}(Li),zo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDrawcallCtors=function(e){var t=[],r=e.parsedStyle,n=r.fill,i=r.radius,o=i&&i.length&&i.some((function(e){return e!==i[0]}));return(null==n?void 0:n.isNone)||o||t.push(Qi),o&&t.push(go),(o||this.needDrawStrokeSeparately(e))&&t.push(ho),t},t.prototype.needDrawStrokeSeparately=function(e){var t=e.parsedStyle,r=t.fill,n=t.stroke,i=t.lineDash,o=t.lineWidth,a=t.strokeOpacity,s=r&&!r.isNone,l=n&&!n.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&o>0&&(1>a||u)},t}(Li),Yo=1,Ko=function(){function e(e,t,r,n){this.renderHelper=e,this.rendererFactory=t,this.texturePool=r,this.lightPool=n,this.drawcalls=[],this.pendingUpdatePatches={},this.stencilRefCache={}}return e.prototype.destroy=function(){this.drawcalls.forEach((function(e){e.destroy()})),this.drawcalls=[],this.pendingUpdatePatches={}},e.prototype.render=function(e,t){var r=this;void 0===t&&(t=!1),t||this.updatePendingPatches(),this.drawcalls.forEach((function(n){n.init();var i=n.objects;n.clipPathTarget&&(i=[n.clipPath]);var o=r.renderHelper.renderInstManager.newRenderInst();o.setAllowSkippingIfPipelineNotReady(!1),n.applyRenderInst(o,i),r.renderHelper.renderInstManager.submitRenderInst(o,e),t||n.objects.forEach((function(e){e.renderable.dirty=!1}))}))},e.prototype.attach=function(e){this.context=e},e.prototype.add=function(e){var t=this,r=e.renderable3D;if(r&&!r.drawcalls.length){var n=this.rendererFactory[e.nodeName];n&&n.getDrawcallCtors(e).forEach((function(i,o,a){var s=t.drawcalls.find((function(t){return i===t.constructor&&t.index===o&&t.maxInstances>t.objects.length&&t.shouldMerge(e,o)}));s&&s.key===e.parsedStyle.batchKey||((s=new i(t.renderHelper,t.texturePool,t.lightPool,e,a,o,t.context)).renderer=n,t.drawcalls.push(s),e.parsedStyle.batchKey&&(s.key=e.parsedStyle.batchKey)),s&&(s.objects.push(e),r.drawcalls[o]=s,s.geometryDirty=!0)}))}},e.prototype.remove=function(e){var t=this,r=e.renderable3D;r&&(r.drawcalls.forEach((function(r){if(r){var n=r.objects.indexOf(e);if(n>-1&&(r.objects.splice(n,1),r.geometryDirty=!0),0===r.objects.length)t.drawcalls.splice(t.drawcalls.indexOf(r),1).forEach((function(e){e.destroy()}))}})),r.drawcalls=[])},e.prototype.updateAttribute=function(e,t,r,n){var i=this;void 0===n&&(n=!1);var o=e.renderable3D,a=this.rendererFactory[e.nodeName];if(a){var s=a.getDrawcallCtors(e);if(s.forEach((function(s,l,u){var c=o.drawcalls.find((function(e){return e&&e.index===l&&e.constructor===s}));if(c||((c=o.drawcalls[l])&&(c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&i.drawcalls.splice(i.drawcalls.indexOf(c),1),o.drawcalls[o.drawcalls.indexOf(c)]=void 0),(c=i.drawcalls.find((function(t){return s===t.constructor&&t.index===l&&t.maxInstances>t.objects.length&&t.shouldMerge(e,l)})))?c.geometryDirty=!0:((c=new s(i.renderHelper,i.texturePool,i.lightPool,e,u,l,i.context)).renderer=a,c.init(),i.drawcalls.push(c)),c.objects.push(e),o.drawcalls[l]=c),c.inited&&!c.geometryDirty)if(c.shouldMerge(e,l)){var f=c.objects.indexOf(e);if(n)e.parsedStyle[t]=r,c.updateAttribute([e],f,t,r);else{var d=c.id+t;i.pendingUpdatePatches[d]||(i.pendingUpdatePatches[d]={instance:c,objectIndices:[],name:t,value:r}),-1===i.pendingUpdatePatches[d].objectIndices.indexOf(f)&&i.pendingUpdatePatches[d].objectIndices.push(f)}}else i.remove(e),i.add(e);else i.remove(e),i.add(e)})),o.drawcalls.length>s.length)for(var l=o.drawcalls.length-1;l>=s.length;l--){var u=o.drawcalls[l];u.objects.splice(u.objects.indexOf(e),1),u.geometryDirty=!0,0===u.objects.length&&this.drawcalls.splice(this.drawcalls.indexOf(u),1),o.drawcalls.pop()}}},e.prototype.changeRenderOrder=function(e,t){var r=e.renderable3D;r&&r.drawcalls.length&&r.drawcalls.forEach((function(r){r&&r.inited&&!r.geometryDirty&&r.inited&&r.changeRenderOrder(e,t)}))},e.prototype.getStencilRef=function(e){return this.stencilRefCache[e.entity]||(this.stencilRefCache[e.entity]=Yo++),this.stencilRefCache[e.entity]},e.prototype.updatePendingPatches=function(){var e=this;Object.keys(this.pendingUpdatePatches).forEach((function(t){var r=e.pendingUpdatePatches[t],n=r.instance,i=r.objectIndices,o=r.name,a=r.value;i.sort((function(e,t){return e-t}));var s=[];i.forEach((function(e){var t=s[s.length-1];t&&e===t[t.length-1]+1?t.push(e):s.push([e])})),s.forEach((function(e){n.updateAttribute(n.objects.slice(e[0],e[0]+e.length),e[0],o,a)}))})),this.pendingUpdatePatches={}},e}(),jo=function(){function e(e,t){this.context=e,this.runtime=t,this.textureCache={}}return e.prototype.getOrCreateTexture=function(e,r,n,o){var a,s=this,l="string"==typeof r?r:r.src||"";if(l&&this.textureCache[l])(a=this.textureCache[l]).emit(J.LOADED);else if(a=e.createTexture(i({format:fe.U8_RGBA_NORM,width:1,height:1,depthOrArrayLayers:1,mipLevelCount:1,dimension:ee.TEXTURE_2D,usage:te.SAMPLED,pixelStore:{unpackFlipY:!1}},n)),l&&(this.textureCache[l]=a),_(r)){var u,c=this.context.config.createImage;c?u=c(r):t.isBrowser&&(u=new window.Image),u&&(u.onload=function(){var e=function(e){s.textureCache[l].setImageData([e]),s.textureCache[l].emit(J.LOADED),s.context.renderingService.dirtify(),o&&o(s.textureCache[l],e)};s.runtime.globalThis.createImageBitmap?s.runtime.globalThis.createImageBitmap(u).then((function(t){return e(t)})).catch((function(){e(u)})):e(u)},u.onerror=function(){},u.crossOrigin="Anonymous",u.src=r)}else a.setImageData([r]),a.emit(J.LOADED),this.context.renderingService.dirtify();return a},e.prototype.getOrCreateCanvas=function(){return this.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)},e.prototype.getOrCreateGradient=function(e){var t=e.gradients,r=e.instance.getGeometryBounds().halfExtents,n=2*r[0]||1,o=2*r[1]||1,a=this.context.config.offscreenCanvas,s=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(a),l=this.runtime.offscreenCanvasCreator.getOrCreateContext(a);s.width=n,s.height=o;var u=this.context.imagePool;t.forEach((function(e){var t=u.getOrCreateGradient(i(i({type:e.type},e.value),{width:n,height:o,min:[0,0]}),l);l.fillStyle=t,l.fillRect(0,0,n,o)}))},e.prototype.getOrCreatePattern=function(e,r,n){var i,o=e.image,a=e.repetition,s=e.transform,l=r.getGeometryBounds().halfExtents,u=2*l[0]||1,c=2*l[1]||1,f=this.context.config.offscreenCanvas,d=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(f),h=this.runtime.offscreenCanvasCreator.getOrCreateContext(f);d.width=u,d.height=c;var p=(i=_(o)?this.context.imagePool.getImageSync(o,n):o)&&h.createPattern(i,a);if(s){var E=t.parsedTransformToMat4(t.parseTransform(s),new t.DisplayObject({}));p.setTransform({a:E[0],b:E[1],c:E[4],d:E[5],e:E[12],f:E[13]})}h.fillStyle=p,h.fillRect(0,0,u,c)},e.prototype.destroy=function(){for(var e in this.textureCache)this.textureCache[e].destroy();this.textureCache={}},e}(),Zo=function(e){function r(t){void 0===t&&(t={});var r=e.call(this)||this;return r.options=t,r.name="device-renderer",r.parameters={toneMapping:bn.NONE,toneMappingExposure:1},r}return n(r,e),r.prototype.init=function(e){var r;e.geometryUpdaterFactory[t.Shape.MESH]=new Tn;var n=new ui(this.parameters),i=new Rn,o=new jo(this.context,e),a=new An,s=new wo,l=new ko,u=((r={})[t.Shape.CIRCLE]=s,r[t.Shape.ELLIPSE]=s,r[t.Shape.POLYLINE]=l,r[t.Shape.PATH]=l,r[t.Shape.POLYGON]=l,r[t.Shape.RECT]=new zo,r[t.Shape.IMAGE]=new Vo,r[t.Shape.LINE]=new Wo,r[t.Shape.TEXT]=new Xo,r[t.Shape.MESH]=new Ho,r[t.Shape.GROUP]=void 0,r[t.Shape.HTML]=void 0,r),c=new Ko(n,u,o,i),f=new Di(n,i,o,c,this.options);this.addRenderingPlugin(f),this.addRenderingPlugin(new Fi(n,f,a,c))},r.prototype.destroy=function(e){delete e.geometryUpdaterFactory[t.Shape.MESH]},r.prototype.getRenderGraphPlugin=function(){return this.plugins[0]},r.prototype.getDevice=function(){return this.getRenderGraphPlugin().getDevice()},r.prototype.getSwapChain=function(){return this.getRenderGraphPlugin().getSwapChain()},r.prototype.loadTexture=function(e,t,r){return this.getRenderGraphPlugin().loadTexture(e,t,r)},r.prototype.toDataURL=function(e){return this.getRenderGraphPlugin().toDataURL(e)},r.prototype.setParameters=function(e){this.parameters=i(i({},this.parameters),e)},r}(t.AbstractRendererPlugin),qo=Object.freeze({__proto__:null,get AntialiasingMode(){return di},Batch:Li,BufferGeometry:Pi,DeviceProgram:mn,DynamicUniformBuffer:gn,FILL_TEXTURE_MAPPING:Yi,Fog:Si,get FogType(){return vi},get GeometryEvent(){return gi},HashMap:Pn,ImageDrawcall:Bo,Instanced:Zi,InstancedFillDrawcall:go,InstancedLineDrawcall:Po,InstancedPathDrawcall:ho,get JOINT_TYPE(){return fo},Light:mi,Material:Ui,get MaterialEvent(){return Ii},Mesh:vn,MeshDrawcall:Go,Plugin:Zo,get RGAttachmentSlot(){return Ln},RenderCache:Un,RenderGraphPlugin:Di,RenderHelper:ui,RenderInst:ii,get RenderInstExecutionOrder(){return ni},get RenderInstFlags(){return ei},RenderInstList:ai,RenderInstManager:li,Renderable3D:En,get RendererLayer(){return Gn},SDFDrawcall:Qi,ShaderMaterial:Gi,SingleSampledTexture:Vn,TemporalTexture:Ai,TextDrawcall:Uo,get TextUniform(){return bo},TextureMapping:Ti,TexturePool:jo,TinySDF:ao,get ToneMapping(){return bn},get VertexAttributeBufferIndex(){return Wi},get VertexAttributeLocation(){return Hi},bezierCurveTo:ro,compareDefines:ki,definedProps:Vi,enumToObject:wi,fillColor:function(e,t,r,n){return void 0===n&&(n=r.a),e[t+0]=r.r,e[t+1]=r.g,e[t+2]=r.b,e[t+3]=n,4},fillMatrix4x4:function(e,t,r){return e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],16},fillVec3v:function(e,t,r,n){return void 0===n&&(n=0),e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=n,4},fillVec4:ri,fillVec4v:function(e,t,r){return e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],4},getSortKeyDepth:function(e){return!!(e>>>31&1)?e>>>8&65535:e>>>8&65532|3&e},getSortKeyLayer:function(e){return e>>>24&255},hashCodeNumberFinish:yn,hashCodeNumberUpdate:Sn,makeAttachmentClearDescriptor:fi,makeBackbufferDescSimple:Ri,makeDataBuffer:yi,makeDepthKey:Yn,makeSortKey:function(e,t){return void 0===t&&(t=0),e&Gn.TRANSLUCENT?Qn(e):Zn(e,t)},makeSortKeyOpaque:Zn,makeSortKeyTranslucent:Qn,nullHashFunc:Cn,opaqueBlackFullClearRenderPassDescriptor:_i,opaqueWhiteFullClearRenderPassDescriptor:pi,projectionMatrixConvertClipSpaceNearZ:function(e,t,r){t!==r&&(t===ae.NEGATIVE_ONE?function(e){I(e,Jn,e)}(e):t===ae.ZERO&&function(e){I(e,ti,e)}(e))},pushFXAAPass:xi,quadCurveTo:to,renderInstCompareNone:null,renderInstCompareSortKey:oi,segmentInstanceGeometry:So,setBackbufferDescSimple:Ei,setSortKeyBias:function(e,t){return!!(e>>>31&1)?(4294967040&e|255&t)>>>0:e},setSortKeyDepth:function(e,t,r){void 0===r&&(r=Hn);var n=!!(e>>>31&1),i=Yn(t,n,r);return n?$n(e,i):qn(e,i)},setSortKeyDepthKey:function(e,t){return!!(e>>>31&1)?$n(e,t):qn(e,t)},setSortKeyLayer:Kn,setSortKeyOpaqueDepth:qn,setSortKeyProgramKey:jn,setSortKeyTranslucentDepth:$n,standardFullClearRenderPassDescriptor:hi,updateBuffer:Eo}),Qo=function(){function e(){}return e.prototype.apply=function(t,r){var n=this,i=t.renderingService,o=t.renderingContext,a=t.config;this.context=t;var s=o.root.ownerDocument.defaultView,l=function(e){i.hooks.pointerMove.call(e)},u=function(e){i.hooks.pointerUp.call(e)},c=function(e){i.hooks.pointerDown.call(e)},f=function(e){i.hooks.pointerOver.call(e)},d=function(e){i.hooks.pointerOut.call(e)},h=function(e){i.hooks.pointerCancel.call(e)},_=function(e){i.hooks.pointerWheel.call(e)},p=function(e){i.hooks.click.call(e)};i.hooks.init.tap(e.tag,(function(){var e=n.context.contextService.getDomElement();r.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="none",e.style.msTouchAction="none"):s.supportsPointerEvents&&(e.style.touchAction="none"),s.supportsPointerEvents?function(e){r.globalThis.document.addEventListener("pointermove",l,!0),e.addEventListener("pointerdown",c,!0),e.addEventListener("pointerleave",d,!0),e.addEventListener("pointerover",f,!0),r.globalThis.addEventListener("pointerup",u,!0),r.globalThis.addEventListener("pointercancel",h,!0)}(e):function(e){r.globalThis.document.addEventListener("mousemove",l,!0),e.addEventListener("mousedown",c,!0),e.addEventListener("mouseout",d,!0),e.addEventListener("mouseover",f,!0),r.globalThis.addEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.addEventListener("touchstart",c,!0),e.addEventListener("touchend",u,!0),e.addEventListener("touchmove",l,!0),e.addEventListener("touchcancel",h,!0)}(e),a.useNativeClickEvent&&e.addEventListener("click",p,!0),e.addEventListener("wheel",_,{passive:!0,capture:!0})})),i.hooks.destroy.tap(e.tag,(function(){var e=n.context.contextService.getDomElement();r.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="",e.style.msTouchAction=""):s.supportsPointerEvents&&(e.style.touchAction=""),s.supportsPointerEvents?function(e){r.globalThis.document.removeEventListener("pointermove",l,!0),e.removeEventListener("pointerdown",c,!0),e.removeEventListener("pointerleave",d,!0),e.removeEventListener("pointerover",f,!0),r.globalThis.removeEventListener("pointerup",u,!0)}(e):function(e){r.globalThis.document.removeEventListener("mousemove",l,!0),e.removeEventListener("mousedown",c,!0),e.removeEventListener("mouseout",d,!0),e.removeEventListener("mouseover",f,!0),r.globalThis.removeEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.removeEventListener("touchstart",c,!0),e.removeEventListener("touchend",u,!0),e.removeEventListener("touchmove",l,!0),e.removeEventListener("touchcancel",h,!0)}(e),a.useNativeClickEvent&&e.removeEventListener("click",p,!0),e.removeEventListener("wheel",_,!0)}))},e.tag="DOMInteraction",e}(),$o=function(e){function t(){var t=e.apply(this,c([],u(arguments),!1))||this;return t.name="dom-interaction",t}return n(t,e),t.prototype.init=function(){this.addRenderingPlugin(new Qo)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(t.AbstractRendererPlugin),Jo=Object.freeze({__proto__:null,Plugin:$o}),ea=function(){function e(){this.displayObjectHTMLElementMap=new WeakMap}return e.prototype.joinTransformMatrix=function(e){return"matrix(".concat([e[0],e[1],e[4],e[5],e[12],e[13]].join(","),")")},e.prototype.apply=function(r,n){var i=this,o=r.camera,a=r.renderingContext,s=r.renderingService;this.context=r;var l=a.root.ownerDocument.defaultView,u=l.context.eventService.nativeHTMLMap,c=function(e,t){t.style.transform=i.joinTransformMatrix(e.getWorldTransform())},f=function(e){var r=e.target;if(r.nodeName===t.Shape.HTML){i.$camera||(i.$camera=i.createCamera(o));var a=i.getOrCreateEl(r);if(i.$camera.appendChild(a),n.enableCSSParsing){var s=r.ownerDocument.documentElement.attributes;Object.keys(s).forEach((function(e){a.style[e]=s[e]}))}Object.keys(r.attributes).forEach((function(e){i.updateAttribute(e,r)})),c(r,a),u.set(a,r)}},d=function(e){var r=e.target;if(r.nodeName===t.Shape.HTML&&i.$camera){var n=i.getOrCreateEl(r);n&&(n.remove(),u.delete(n))}},h=function(e){var r=e.target;r.nodeName===t.Shape.HTML&&i.updateAttribute(e.attrName,r)},_=function(e){var r=e.target;if(r.nodeName===t.Shape.HTML){var n=i.getOrCreateEl(r);c(r,n)}},p=function(){if(i.$camera){var e=i.context.config,t=e.height;i.$camera.style.width="".concat(e.width||0,"px"),i.$camera.style.height="".concat(t||0,"px")}};s.hooks.init.tap(e.tag,(function(){l.addEventListener(t.CanvasEvent.RESIZE,p),l.addEventListener(t.ElementEvent.MOUNTED,f),l.addEventListener(t.ElementEvent.UNMOUNTED,d),l.addEventListener(t.ElementEvent.ATTR_MODIFIED,h),l.addEventListener(t.ElementEvent.BOUNDS_CHANGED,_)})),s.hooks.endFrame.tap(e.tag,(function(){i.$camera&&a.renderReasons.has(t.RenderReason.CAMERA_CHANGED)&&(i.$camera.style.transform=i.joinTransformMatrix(o.getOrthoMatrix()))})),s.hooks.destroy.tap(e.tag,(function(){i.$camera&&i.$camera.remove(),l.removeEventListener(t.CanvasEvent.RESIZE,p),l.removeEventListener(t.ElementEvent.MOUNTED,f),l.removeEventListener(t.ElementEvent.UNMOUNTED,d),l.removeEventListener(t.ElementEvent.ATTR_MODIFIED,h),l.removeEventListener(t.ElementEvent.BOUNDS_CHANGED,_)}))},e.prototype.createCamera=function(e){var t=this.context.config,r=t.document,n=t.width,i=t.height,o=this.context.contextService.getDomElement(),a=o.parentNode;if(a){var s="g-canvas-camera",l=a.querySelector("#"+s);if(!l){var u=(r||document).createElement("div");l=u,u.id=s,u.style.position="absolute",u.style.left="".concat(o.offsetLeft||0,"px"),u.style.top="".concat(o.offsetTop||0,"px"),u.style.transformOrigin="left top",u.style.transform=this.joinTransformMatrix(e.getOrthoMatrix()),u.style.overflow="hidden",u.style.pointerEvents="none",u.style.width="".concat(n||0,"px"),u.style.height="".concat(i||0,"px"),a.appendChild(u)}return l}return null},e.prototype.getOrCreateEl=function(e){var t=this.context.config.document,r=this.displayObjectHTMLElementMap.get(e);return r||(r=(t||document).createElement("div"),e.parsedStyle.$el=r,this.displayObjectHTMLElementMap.set(e,r),e.id&&(r.id=e.id),e.name&&r.setAttribute("name",e.name),e.className&&(r.className=e.className),r.style.position="absolute",r.style["will-change"]="transform",r.style.transform=this.joinTransformMatrix(e.getWorldTransform())),r},e.prototype.updateAttribute=function(e,r){var n=this.getOrCreateEl(r);switch(e){case"innerHTML":var i=r.parsedStyle.innerHTML;_(i)?n.innerHTML=i:(n.innerHTML="",n.appendChild(i));break;case"x":n.style.left="".concat(r.parsedStyle.x,"px");break;case"y":n.style.top="".concat(r.parsedStyle.y,"px");break;case"transformOrigin":var o=r.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(o[0].value," ").concat(o[1].value);break;case"width":if(this.context.enableCSSParsing){var a=r.computedStyleMap().get("width");n.style.width=""+a}else{n.style.width=E(a=r.parsedStyle.width)?"".concat(a,"px"):""+a}break;case"height":if(this.context.enableCSSParsing){var s=r.computedStyleMap().get("height");n.style.height=""+s}else{n.style.height=E(s=r.parsedStyle.height)?"".concat(s,"px"):""+s}break;case"zIndex":n.style["z-index"]="".concat(r.parsedStyle.zIndex);break;case"visibility":n.style.visibility=r.parsedStyle.visibility;break;case"pointerEvents":var l=r.parsedStyle.pointerEvents;n.style.pointerEvents=void 0===l?"auto":l;break;case"opacity":n.style.opacity="".concat(r.parsedStyle.opacity);break;case"fill":var u=r.parsedStyle.fill,c="";t.isCSSRGB(u)?c=u.isNone?"transparent":r.getAttribute("fill"):Array.isArray(u)?c=r.getAttribute("fill"):t.isPattern(u),n.style.background=c;break;case"stroke":var d=r.parsedStyle.stroke,h="";t.isCSSRGB(d)?h=d.isNone?"transparent":r.getAttribute("stroke"):Array.isArray(d)?h=r.getAttribute("stroke"):t.isPattern(d),n.style["border-color"]=h,n.style["border-style"]="solid";break;case"lineWidth":n.style["border-width"]="".concat(r.parsedStyle.lineWidth||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":n.style.filter=r.style.filter;break;default:f(r.style[e])||""===r.style[e]||(n.style[e]=r.style[e])}},e.tag="HTMLRendering",e}(),ta=function(e){function t(){var t=e.apply(this,c([],u(arguments),!1))||this;return t.name="html-renderer",t}return n(t,e),t.prototype.init=function(){this.addRenderingPlugin(new ea)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(t.AbstractRendererPlugin),ra=Object.freeze({__proto__:null,Plugin:ta}),na=function(){function e(e){this.canvasConfig=e,this.imageCache={},this.gradientCache={},this.patternCache={}}return e.prototype.getImageSync=function(e,t){return this.imageCache[e]?t&&t(this.imageCache[e]):this.getOrCreateImage(e).then((function(e){t&&t(e)})),this.imageCache[e]},e.prototype.getOrCreateImage=function(e){var r=this;if(this.imageCache[e])return Promise.resolve(this.imageCache[e]);var n=this.canvasConfig.createImage;return new Promise((function(i,o){var a;n?a=n(e):t.isBrowser&&(a=new window.Image),a&&(a.onload=function(){r.imageCache[e]=a,i(a)},a.onerror=function(e){o(e)},a.crossOrigin="Anonymous",a.src=e)}))},e.prototype.getOrCreatePatternSync=function(e,r,n,i,o,a){var s=this.generatePatternKey(e);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=e.image,c=e.repetition,f=e.transform,d=!1;_(u)?l=this.getImageSync(u,a):n?(l=n,d=!0):l=u;var h=l&&r.createPattern(l,c);if(h){var p=void 0;p=f?t.parsedTransformToMat4(t.parseTransform(f),new t.DisplayObject({})):g(T()),d&&C(p,p,[1/i,1/i,1]),h.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12]+o[0],f:p[13]+o[1]})}return s&&h&&(this.patternCache[s]=h),h},e.prototype.getOrCreateGradient=function(e,r){var n=this.generateGradientKey(e),i=e.type,o=e.steps,a=e.min,s=e.width,l=e.height,u=e.cx,c=e.cy,f=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(i===t.GradientType.LinearGradient){var h=t.computeLinearGradient(a,s,l,e.angle);d=r.createLinearGradient(h.x1,h.y1,h.x2,h.y2)}else if(i===t.GradientType.RadialGradient){var _=t.computeRadialGradient(a,s,l,u,c,f),p=_.x,E=_.y;d=r.createRadialGradient(p,E,0,p,E,_.r)}return d&&(o.forEach((function(e){var r=e.offset;r.unit===t.UnitType.kPercentage&&(null==d||d.addColorStop(r.value/100,""+e.color))})),this.gradientCache[n]=d),this.gradientCache[n]},e.prototype.generateGradientKey=function(e){var t=e.min,r=e.width,n=e.height,i=e.steps,o=e.angle,a=e.cx,s=e.cy,l=e.size;return"gradient-".concat(e.type,"-").concat((null==o?void 0:""+o)||0,"-").concat((null==a?void 0:""+a)||0,"-").concat((null==s?void 0:""+s)||0,"-").concat((null==l?void 0:""+l)||0,"-").concat(t[0],"-").concat(t[1],"-").concat(r,"-").concat(n,"-").concat(i.map((function(e){var t=e.color;return"".concat(e.offset).concat(t)})).join("-"))},e.prototype.generatePatternKey=function(e){var t=e.image,r=e.repetition;return _(t)?"pattern-".concat(t,"-").concat(r):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(r):void 0},e}(),ia=function(){function e(){}return e.prototype.apply=function(r){var n=r.renderingService,i=r.imagePool,o=r.renderingContext.root.ownerDocument.defaultView,a=function(e,t,r){var n=e.parsedStyle,i=n.width,o=n.height;i&&!o?e.setAttribute("height",r/t*i):!i&&o&&e.setAttribute("width",t/r*o)},s=function(e){var r=e.target,o=r.attributes;if(r.nodeName===t.Shape.IMAGE){var s=o.src,l=o.keepAspectRatio;_(s)&&i.getImageSync(s,(function(e){l&&a(r,e.width,e.height),r.renderable.dirty=!0,n.dirtify()}))}},l=function(e){var r=e.target,o=e.newValue;r.nodeName===t.Shape.IMAGE&&"src"===e.attrName&&_(o)&&i.getOrCreateImage(o).then((function(e){r.attributes.keepAspectRatio&&a(r,e.width,e.height),r.renderable.dirty=!0,n.dirtify()}))};n.hooks.init.tap(e.tag,(function(){o.addEventListener(t.ElementEvent.MOUNTED,s),o.addEventListener(t.ElementEvent.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){o.removeEventListener(t.ElementEvent.MOUNTED,s),o.removeEventListener(t.ElementEvent.ATTR_MODIFIED,l)}))},e.tag="LoadImage",e}(),oa=function(e){function t(){var t=e.apply(this,c([],u(arguments),!1))||this;return t.name="image-loader",t}return n(t,e),t.prototype.init=function(){this.context.imagePool=new na(this.context.config),this.addRenderingPlugin(new ia)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(t.AbstractRendererPlugin),aa=function(){function e(e){this.canvasConfig=e.config,this.deviceRendererPlugin=e.deviceRendererPlugin}return e.prototype.init=function(){var e=this.canvasConfig,t=e.container,r=e.canvas;if(r)this.$canvas=r,t&&r.parentElement!==t&&t.appendChild(r),this.$container=r.parentElement,this.canvasConfig.container=this.$container;else if(t&&(this.$container=_(t)?document.getElementById(t):t,this.$container)){var n=document.createElement("canvas");this.$container.appendChild(n),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=n}this.resize(this.canvasConfig.width,this.canvasConfig.height)},e.prototype.getDomElement=function(){return this.$canvas},e.prototype.getContext=function(){return this.deviceRendererPlugin.getDevice().gl},e.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},e.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},e.prototype.resize=function(e,r){var n=this.canvasConfig.devicePixelRatio||t.isBrowser&&window.devicePixelRatio||1;if(this.dpr=n=1>n?1:Math.ceil(n),this.$canvas){var i=this.getDPR();this.$canvas.width=i*e,this.$canvas.height=i*r,t.setDOMSize(this.$canvas,e,r)}},e.prototype.getDPR=function(){return this.dpr},e.prototype.applyCursorStyle=function(e){this.$container&&this.$container.style&&(this.$container.style.cursor=e)},e.prototype.toDataURL=function(e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.deviceRendererPlugin.toDataURL(e)]}))}))},e}(),sa=function(e){function t(t,r){var n=e.call(this)||this;return n.rendererPlugin=t,n.config=r,n.name="webgl-context-register",n}return n(t,e),t.prototype.init=function(){this.context.ContextService=aa,this.context.deviceRendererPlugin=this.rendererPlugin;var e=this.config;this.context.deviceContribution=new vr(i(i({},(null==e?void 0:e.targets)?{targets:e.targets}:{targets:["webgl2","webgl1"]}),{onContextLost:null==e?void 0:e.onContextLost,onContextRestored:null==e?void 0:e.onContextRestored,onContextCreationError:null==e?void 0:e.onContextCreationError}))},t.prototype.destroy=function(){delete this.context.ContextService},t}(t.AbstractRendererPlugin),la=new t.CustomEvent(""),ua=function(){function e(){this.targetRay=null}return e.prototype.connect=function(e){return this.dispatchEvent({type:"connected",data:e}),this},e.prototype.disconnect=function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this.targetRay&&(this.targetRay.style.visible=!1),this},e.prototype.update=function(e,t,r){var n,i,o=null,a=this.targetRay;return e&&"visible-blurred"!==t.session.visibilityState&&null!==a&&null!==(o=t.getPose(e.targetRaySpace,r))&&(a.setLocalTransform(o.transform.matrix),o.linearVelocity?(a.style.hasLinearVelocity=!0,(n=a.style.linearVelocity)[0]=(i=o.linearVelocity)[0],n[1]=i[1],n[2]=i[2]):a.style.hasLinearVelocity=!1,o.angularVelocity?(a.style.hasAngularVelocity=!0,a.style.angularVelocity.copy(o.angularVelocity)):a.style.hasAngularVelocity=!1,this.dispatchEvent({type:"move"})),null!==a&&(a.style.visible=null!==o),this},e.prototype.getTargetRaySpace=function(){return null===this.targetRay&&(this.targetRay=new t.Group,this.targetRay.style.visible=!1,this.targetRay.style.hasLinearVelocity=!1,this.targetRay.style.linearVelocity=F(),this.targetRay.style.hasAngularVelocity=!1,this.targetRay.style.angularVelocity=F()),this.targetRay},e.prototype.dispatchEvent=function(e){var t=e.data;return la.type=e.type,la.detail=t,null!==this.targetRay&&this.targetRay.dispatchEvent(la),this},e}(),ca=function(){function e(e){var t=this;this.plugin=e,this.controllers=[],this.controllerInputSources=[],this.onSessionEnd=function(){t.session.removeEventListener("select",t.onSessionEvent),t.session.removeEventListener("selectstart",t.onSessionEvent),t.session.removeEventListener("selectend",t.onSessionEvent),t.session.removeEventListener("squeeze",t.onSessionEvent),t.session.removeEventListener("squeezestart",t.onSessionEvent),t.session.removeEventListener("squeezeend",t.onSessionEvent),t.session.removeEventListener("end",t.onSessionEnd),t.session.removeEventListener("inputsourceschange",t.onInputSourcesChange);for(var e=0;t.controllers.length>e;e++){var r=t.controllerInputSources[e];null!==r&&(t.controllerInputSources[e]=null,t.controllers[e].disconnect(r))}},this.onSessionEvent=function(e){var r=t.controllerInputSources.indexOf(e.inputSource);if(-1!==r){var n=t.controllers[r];void 0!==n&&(n.update(e.inputSource,e.frame,t.session.referenceSpace),n.dispatchEvent({type:e.type,data:e.inputSource}))}},this.onInputSourcesChange=function(e){for(var r=0;e.removed.length>r;r++){var n=t.controllerInputSources.indexOf(i=e.removed[r]);0>n||(t.controllerInputSources[n]=null,t.controllers[n].disconnect(i))}for(r=0;e.added.length>r;r++){var i,o=t.controllerInputSources.indexOf(i=e.added[r]);if(-1===o){for(var a=0;t.controllers.length>a;a++){if(a>=t.controllerInputSources.length){t.controllerInputSources.push(i),o=a;break}if(null===t.controllerInputSources[a]){t.controllerInputSources[a]=i,o=a;break}}if(-1===o)break}var s=t.controllers[o];s&&s.connect(i)}}}return e.prototype.setSession=function(e,t){return a(this,void 0,void 0,(function(){var r,n,i;return s(this,(function(o){switch(o.label){case 0:return t?(this.session=t,r=this.plugin.getDevice().gl,!0===(n=r.getContextAttributes()).xrCompatible?[3,2]:[4,r.makeXRCompatible()]):[3,5];case 1:o.sent(),o.label=2;case 2:return t.addEventListener("select",this.onSessionEvent),t.addEventListener("selectstart",this.onSessionEvent),t.addEventListener("selectend",this.onSessionEvent),t.addEventListener("squeeze",this.onSessionEvent),t.addEventListener("squeezestart",this.onSessionEvent),t.addEventListener("squeezeend",this.onSessionEvent),t.addEventListener("end",this.onSessionEnd),t.addEventListener("inputsourceschange",this.onInputSourcesChange),void 0!==t.renderState.layers?[3,4]:(this.glBaseLayer=new XRWebGLLayer(t,r,{antialias:n.antialias,alpha:!0,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:1}),t.updateRenderState({baseLayer:this.glBaseLayer}),i=this,[4,t.requestReferenceSpace(this.referenceSpaceType)]);case 3:i.referenceSpace=o.sent(),t.referenceSpace=this.referenceSpace,o.label=4;case 4:e.requestAnimationFrame=t.requestAnimationFrame.bind(t),o.label=5;case 5:return[2]}}))}))},e.prototype.setReferenceSpaceType=function(e){this.referenceSpaceType=e},e.prototype.getSession=function(){return this.session},e.prototype.getReferenceSpace=function(){return this.referenceSpace},e.prototype.getOrCreateController=function(e){var t=this.controllers[e];return void 0===t&&(t=new ua,this.controllers[e]=t),t},e.prototype.getController=function(e){return this.getOrCreateController(e).getTargetRaySpace()},e}(),fa=function(){function e(){}return e.createButton=function(e,t,r){var n=this;void 0===r&&(r={});var i=document.createElement("button"),o=function(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null},l=function(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"};if("xr"in navigator)return i.id="ARButton",i.style.display="none",l(i),navigator.xr.isSessionSupported("immersive-ar").then((function(l){l?function(){var o;i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="START AR";var l=function(){o.removeEventListener("end",l),i.textContent="START AR",r.domOverlay.root.style.display="none",o=void 0},u=function(u){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return u.addEventListener("end",l),t.xr.setReferenceSpaceType("local"),[4,t.xr.setSession(e,u)];case 1:return n.sent(),i.textContent="STOP AR",r.domOverlay.root.style.display="",o=u,[2]}}))}))};if(void 0===r.domOverlay){var c=document.createElement("div");c.style.display="none",document.body.appendChild(c);var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("width","38"),f.setAttribute("height","38"),f.style.position="absolute",f.style.right="20px",f.style.top="20px",f.addEventListener("click",(function(){o.end()})),c.appendChild(f);var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),d.setAttribute("stroke","#fff"),d.setAttribute("stroke-width","2"),f.appendChild(d),void 0===r.optionalFeatures&&(r.optionalFeatures=[]),r.optionalFeatures.push("dom-overlay"),r.domOverlay={root:c}}i.onclick=function(){o?o.end():navigator.xr.requestSession("immersive-ar",r).then(u)},i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"}}():(o(),i.textContent="AR NOT SUPPORTED")})).catch((function(e){o(),console.warn("Exception when trying to call xr.isSessionSupported",e),i.textContent="AR NOT ALLOWED"})),i;var u=document.createElement("a");return!1===window.isSecureContext?(u.href=document.location.href.replace(/^http:/,"https:"),u.innerHTML="WEBXR NEEDS HTTPS"):(u.href="https://immersiveweb.dev/",u.innerHTML="WEBXR NOT AVAILABLE"),u.style.left="calc(50% - 90px)",u.style.width="180px",u.style.textDecoration="none",l(u),u},e}(),da=function(e){function t(t){var r=e.call(this,i({enableSizeAttenuation:!1},t))||this,n=new Zo(t);return r.xr=new ca(n),r.registerPlugin(new sa(n,t)),r.registerPlugin(new oa),r.registerPlugin(n),r.registerPlugin(new $o),r.registerPlugin(new ta),r}return n(t,e),t}(t.AbstractRenderer);e.ARButton=fa,e.DeviceRenderer=qo,e.DomInteraction=Jo,e.HTMLRenderer=ra,e.Renderer=da,e.WebXRManager=ca}));
//# sourceMappingURL=index.umd.min.js.map
