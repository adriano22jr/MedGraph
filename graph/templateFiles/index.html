<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Force Graph</title>
    <style>
        body { margin: 0; }
        #3d-graph { width: 1920; height: 1080; }
    </style>
    <script src="//unpkg.com/3d-force-graph"></script>

</head>
<body>
    <div id="3d-graph"></div>

    <script type="module">
        const response = await fetch('/data');
        const gData = await response.json();
        const Graph = ForceGraph3D()(document.getElementById('3d-graph')).nodeAutoColorBy("id").linkAutoColorBy('entity').linkVisibility(false).graphData(gData);
        
        Graph.onNodeClick(node => {
            Graph.linkVisibility((link) => {
                return link.source.id === node.id || link.target.id === node.id;
            });
            const distance = 200;
          const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);

          const newPos = node.x || node.y  || node.z
            ? { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }
          : { x: 0, y: 0, z: distance }; // special case if node is in (0,0,0)

          Graph.cameraPosition(
            newPos, // new position
            node, // lookAt ({ x, y, z })
            1000  // ms transition duration
          );
        })
        .nodeLabel('id')
        .linkLabel('term')
        .d3Force('link')
        .distance(d => {return 1000;}).strength(0)
        .linkOpacity(1);
        

    </script>

</body>
</html>
